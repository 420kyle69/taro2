// Domain Public by Eric Wendelin http://eriwen.com/ (2008)
//                  Luke Smith http://lucassmith.name/ (2008)
//                  Loic Dachary <loic@dachary.org> (2008)
//                  Johan Euphrosine <proppy@aminche.com> (2008)
//                  Oyvind Sean Kinsey http://kinsey.no/blog (2010)
//                  Victor Homyakov <victor-homyakov@users.sourceforge.net> (2010)
/**
 * Main function giving a function stack trace with a forced or passed in Error
 *
 * @cfg {Error} e The error to create a stacktrace from (optional)
 * @cfg {Boolean} guess If we should try to resolve the names of anonymous functions
 * @return {Array} of Strings with functions, lines, files, and arguments where possible
 */function printStackTrace(options){options=options||{guess:true};var ex=options.e||null;var guess=!!options.guess;var p=new printStackTrace.implementation();var result=p.run(ex);var res=guess?p.guessAnonymousFunctions(result):result;for(var k=0;k<4;k++){res.shift();}return res;}printStackTrace.implementation=function(){};printStackTrace.implementation.prototype={run:function(ex){ex=ex||this.createException();// Do not use the stored mode: different exceptions in Chrome
// may or may not have arguments or stack
var mode=this.mode(ex);// Use either the stored mode, or resolve it
// var mode = this._mode || this.mode(ex);
if(mode==='other'){return this.other(arguments.callee);}else{return this[mode](ex);}},createException:function(){try{this.undef();return null;}catch(e){return e;}},/**
     * @return {String} mode of operation for the environment in question.
     */mode:function(e){if(e.arguments&&e.stack){return this._mode='chrome';}else if(e.message&&typeof window!=='undefined'&&window.opera){return this._mode=e.stacktrace?'opera10':'opera';}else if(e.stack){return this._mode='firefox';}return this._mode='other';},/**
     * Given a context, function name, and callback function, overwrite it so that it calls
     * printStackTrace() first with a callback and then runs the rest of the body.
     *
     * @param {Object} context of execution (e.g. window)
     * @param {String} functionName to instrument
     * @param {Function} function to call with a stack trace on invocation
     */instrumentFunction:function(context,functionName,callback){context=context||window;var original=context[functionName];context[functionName]=function instrumented(){callback.call(this,printStackTrace().slice(4));return context[functionName]._instrumented.apply(this,arguments);};context[functionName]._instrumented=original;},/**
     * Given a context and function name of a function that has been
     * instrumented, revert the function to it's original (non-instrumented)
     * state.
     *
     * @param {Object} context of execution (e.g. window)
     * @param {String} functionName to de-instrument
     */deinstrumentFunction:function(context,functionName){if(context[functionName].constructor===Function&&context[functionName]._instrumented&&context[functionName]._instrumented.constructor===Function){context[functionName]=context[functionName]._instrumented;}},/**
     * Given an Error object, return a formatted Array based on Chrome's stack string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */chrome:function(e){var stack=`${e.stack}\n`.replace(/^\S[^\(]+?[\n$]/gm,'').replace(/^\s+at\s+/gm,'').replace(/^([^\(]+?)([\n$])/gm,'{anonymous}()@$1$2').replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,'{anonymous}()@$1').split('\n');stack.pop();return stack;},/**
     * Given an Error object, return a formatted Array based on Firefox's stack string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,'').replace(/^\(/gm,'{anonymous}(').split('\n');},/**
     * Given an Error object, return a formatted Array based on Opera 10's stacktrace string.
     *
     * @param e - Error object to inspect
     * @return Array<String> of function calls, files and line numbers
     */opera10:function(e){var stack=e.stacktrace;var lines=stack.split('\n');var ANON='{anonymous}';var lineRE=/.*line (\d+), column (\d+) in ((<anonymous function\:?\s*(\S+))|([^\(]+)\([^\)]*\))(?: in )?(.*)\s*$/i;var i;var j;var len;for(i=2,j=0,len=lines.length;i<len-2;i++){if(lineRE.test(lines[i])){var location=`${RegExp.$6}:${RegExp.$1}:${RegExp.$2}`;var fnName=RegExp.$3;fnName=fnName.replace(/<anonymous function\:?\s?(\S+)?>/g,ANON);lines[j++]=`${fnName}@${location}`;}}lines.splice(j,lines.length-j);return lines;},// Opera 7.x-9.x only!
opera:function(e){var lines=e.message.split('\n');var ANON='{anonymous}';var lineRE=/Line\s+(\d+).*script\s+(http\S+)(?:.*in\s+function\s+(\S+))?/i;var i;var j;var len;for(i=4,j=0,len=lines.length;i<len;i+=2){// TODO: RegExp.exec() would probably be cleaner here
if(lineRE.test(lines[i])){lines[j++]=`${RegExp.$3?`${RegExp.$3}()@${RegExp.$2}${RegExp.$1}`:`${ANON}()@${RegExp.$2}:${RegExp.$1}`} -- ${lines[i+1].replace(/^\s+/,'')}`;}}lines.splice(j,lines.length-j);return lines;},// Safari, IE, and others
other:function(curr){var ANON='{anonymous}';var fnRE=/function\s*([\w\-$]+)?\s*\(/i;var stack=[];var fn;var args;var maxStackSize=10;while(curr&&stack.length<maxStackSize){fn=fnRE.test(curr.toString())?RegExp.$1||ANON:ANON;args=Array.prototype.slice.call(curr.arguments||[]);stack[stack.length]=`${fn}(${this.stringifyArguments(args)})`;curr=curr.caller;}return stack;},/**
     * Given arguments array as a String, subsituting type names for non-string types.
     *
     * @param {Arguments} object
     * @return {Array} of Strings with stringified arguments
     */stringifyArguments:function(args){var slice=Array.prototype.slice;for(var i=0;i<args.length;++i){var arg=args[i];if(arg===undefined){args[i]='undefined';}else if(arg===null){args[i]='null';}else if(arg.constructor){if(arg.constructor===Array){if(arg.length<3){args[i]=`[${this.stringifyArguments(arg)}]`;}else{args[i]=`[${this.stringifyArguments(slice.call(arg,0,1))}...${this.stringifyArguments(slice.call(arg,-1))}]`;}}else if(arg.constructor===Object){args[i]='#object';}else if(arg.constructor===Function){args[i]='#function';}else if(arg.constructor===String){args[i]=`"${arg}"`;}}}return args.join(',');},sourceCache:{},/**
     * @return {*} the text from a given URL.
     */ajax:function(url){var req=this.createXMLHTTPObject();if(!req){return;}req.open('GET',url,false);// req.setRequestHeader('User-Agent', 'XMLHTTP/1.0');
req.send('');return req.responseText;},/**
     * Try XHR methods in order and store XHR factory.
     *
     * @return <Function> XHR function or equivalent
     */createXMLHTTPObject:function(){var xmlhttp;var XMLHttpFactories=[function(){return new XMLHttpRequest();},function(){return new ActiveXObject('Msxml2.XMLHTTP');},function(){return new ActiveXObject('Msxml3.XMLHTTP');},function(){return new ActiveXObject('Microsoft.XMLHTTP');}];for(var i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]();// Use memoization to cache the factory
this.createXMLHTTPObject=XMLHttpFactories[i];return xmlhttp;}catch(e){}}},/**
     * Given a URL, check if it is in the same domain (so we can get the source
     * via Ajax).
     *
     * @param url <String> source url
     * @return False if we need a cross-domain request
     */isSameDomain:function(url){return url.indexOf(location.hostname)!==-1;},/**
     * Get source code from given URL if in the same domain.
     *
     * @param url <String> JS source URL
     * @return <Array> Array of source code lines
     */getSource:function(url){if(!(url in this.sourceCache)){this.sourceCache[url]=this.ajax(url).split('\n');}return this.sourceCache[url];},guessAnonymousFunctions:function(stack){for(var i=0;i<stack.length;++i){var reStack=/\{anonymous\}\(.*\)@(\w+:\/\/([\-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/;var frame=stack[i];var m=reStack.exec(frame);if(m){var file=m[1];var lineno=m[4];var charno=m[7]||0;// m[7] is character position in Chrome
if(file&&this.isSameDomain(file)&&lineno){var functionName=this.guessAnonymousFunction(file,lineno,charno);stack[i]=frame.replace('{anonymous}',functionName);}}}return stack;},guessAnonymousFunction:function(url,lineNo,charNo){var ret;try{ret=this.findFunctionName(this.getSource(url),lineNo);}catch(e){ret=`getSource failed with url: ${url}, exception: ${e.toString()}`;}return ret;},findFunctionName:function(source,lineNo){// FIXME findFunctionName fails for compressed source
// (more than one function on the same line)
// TODO use captured args
// function {name}({args}) m[1]=name m[2]=args
var reFunctionDeclaration=/function\s+([^(]*?)\s*\(([^)]*)\)/;// {name} = function ({args}) TODO args capture
// /['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function(?:[^(]*)/
var reFunctionExpression=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/;// {name} = eval()
var reFunctionEvaluation=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/;// Walk backwards in the source lines until we find
// the line which matches one of the patterns above
var code='';var line;var maxLines=10;var m;for(var i=0;i<maxLines;++i){// FIXME lineNo is 1-based, source[] is 0-based
line=source[lineNo-i];if(line){code=line+code;m=reFunctionExpression.exec(code);if(m&&m[1]){return m[1];}m=reFunctionDeclaration.exec(code);if(m&&m[1]){// return m[1] + "(" + (m[2] || "") + ")";
return m[1];}m=reFunctionEvaluation.exec(code);if(m&&m[1]){return m[1];}}}return'(?)';}};;/************************/ /* Isogenic Game Engine */ /************************/ige=null;// When setting a new version please use this format:
// v{MAJOR}.{MINOR}.{SUB}@{YYYY-MM-DD}.{REVISION}
//
// For example, to tag version 1.1.2 on 25th April 2013
// as the third revision of the day:
// v1.1.2@2013-04-25.003
igeVersion='v1.6.0@2015-04-29.001';// Define the global storage object for classes
igeClassStore={};igeConfig={debug:{_enabled:false,_node:typeof module!=='undefined'&&typeof module.exports!=='undefined',_level:['log','warning','error'],_stacks:true,_throwErrors:true,_timing:true,enabled:function(val){if(val!==undefined){this._enabled=val;if(!val){this._timing=false;// Check if the engine exists
if(ige){// Turn off stats display in the engine
ige.showStats(0);}}return this;}return this._enabled;}}};if(igeConfig.debug._node){igeConfig.debug._util=require('util');}/**
 * Make property non-enumerable.
 */Object.defineProperty(Object.prototype,'tween',{enumerable:false,writable:true,configurable:true});/**
 * Augments all objects with the tween() method. Creates a new $i_49
 * with the passed parameters that will act upon the object's properties.
 * The returned tween will not start tweening until a call to start() is
 * made.
 * @param {Object} props
 * @param {Number} durationMs
 * @param {Object=} options
 * @return {$i_49}
 */ // Object.prototype.tween = function (props, durationMs, options) {
// 	var newTween = new $i_49()
// 		.targetObj(this)
// 		.properties(props)
// 		.duration(durationMs);
// 	if (options) {
// 		if (options.beforeTween) { newTween.beforeTween(options.beforeTween); }
// 		if (options.afterTween) { newTween.afterTween(options.afterTween); }
// 		if (options.easing) { newTween.easing(options.easing); }
// 		if (options.startTime) { newTween.startTime(options.startTime); }
// 	}
// 	return newTween;
// };
/**
 * Make property non-enumerable.
 */Object.defineProperty(Object.prototype,'theSameAs',{enumerable:false,writable:true,configurable:true});/**
 * Augments all objects with the theSameAs() method. Checks if the
 * property values of this object are equal to the property values
 * of the passed object. If they are the same then this method will
 * return true. Objects must not contain circular references!
 * @param {Object} obj The object to compare this one to.
 * @return {Boolean}
 */Object.prototype.theSameAs=function(obj){return JSON.stringify(this)===JSON.stringify(obj);};/**
 * Make property non-enumerable.
 */Object.defineProperty(Array.prototype,'clone',{enumerable:false,writable:true,configurable:true});/**
 * Clones the array and returns a new non-referenced
 * array.
 * @return {*}
 */Array.prototype.clone=function(){var i;var newArray=[];for(i in this){if(this.hasOwnProperty(i)){if(this[i]instanceof Array){newArray[i]=this[i].clone();}else{newArray[i]=this[i];}}}return newArray;};/**
 * Make property non-enumerable.
 */Object.defineProperty(Array.prototype,'pull',{enumerable:false,writable:true,configurable:true});/**
 * Removes the passed item from an array, the opposite of push().
 * @param item
 * @return {*}
 */Array.prototype.pull=function(item){var index=this.indexOf(item);if(index>-1){this.splice(index,1);return index;}else{return-1;}};/**
 * Make property non-enumerable.
 */Object.defineProperty(Array.prototype,'pushUnique',{enumerable:false,writable:true,configurable:true});/**
 * Adds an item to an array, only if it does not already exist in the array.
 * @param item
 * @return {Boolean} True if the item was added, false if it already exists.
 */Array.prototype.pushUnique=function(item){var index=this.indexOf(item);if(index===-1){this.push(item);return true;}return false;};/**
 * Make property non-enumerable.
 */Object.defineProperty(Array.prototype,'each',{enumerable:false,writable:true,configurable:true});/**
 * Iterates through an array's items and calls the callback method
 * passing each item one by one.
 * @param {Function} callback
 */Array.prototype.each=function(callback){var len=this.length;var i;for(i=0;i<len;i++){callback(this[i]);}};/**
 * Make property non-enumerable.
 */Object.defineProperty(Array.prototype,'eachReverse',{enumerable:false,writable:true,configurable:true});/**
 * Iterates through an array's items and calls the callback method
 * passing each item one by one in reverse order.
 * @param {Function} callback
 */Array.prototype.eachReverse=function(callback){var arrCount=this.length;var i;for(i=arrCount-1;i>=0;i--){callback(this[i]);}};/**
 * Make property non-enumerable.
 */Object.defineProperty(Array.prototype,'destroyAll',{enumerable:false,writable:true,configurable:true});/**
 * Iterates through an array's items and calls each item's
 * destroy() method if it exists. Useful for destroying an
 * array of $i_56 instances.
 */Array.prototype.destroyAll=function(){var arrCount=this.length;var i;for(i=arrCount-1;i>=0;i--){if(typeof this[i].destroy==='function'){this[i].destroy();}}};/**
 * Make property non-enumerable.
 */Object.defineProperty(Array.prototype,'eachIsolated',{enumerable:false,writable:true,configurable:true});/**
 * Iterates through an array's items and calls the callback method
 * passing each item one by one. Altering the array's structure
 * during the callback method will not affect the iteration of the
 * items.
 *
 * @param {Function} callback
 */Array.prototype.eachIsolated=function(callback){var arr=[];var arrCount=arr.length;var i;// Create a copy of the array
for(i=0;i<arrCount;i++){arr[i]=this[i];}// Now iterate the array, passing the copied
// array value at the index(i). Any changes to
// "this" will not affect the index(i) values.
for(i=0;i<arrCount;i++){callback(arr[i]);}};/**
 * Make property non-enumerable.
 */Object.defineProperty(Math,'PI180',{enumerable:false,writable:true,configurable:true});/**
 * Stores a pre-calculated PI / 180 value.
 * @type {Number}
 */Math.PI180=Math.PI/180;/**
 * Make property non-enumerable.
 */Object.defineProperty(Math,'PI180R',{enumerable:false,writable:true,configurable:true});/**
 * Stores a pre-calculated 180 / PI value.
 * @type {Number}
 */Math.PI180R=180/Math.PI;/**
 * Make property non-enumerable.
 */Object.defineProperty(Math,'toIso',{enumerable:false,writable:true,configurable:true});Math.toIso=function(x,y,z){var sx=x-y;var sy=-z*1.2247+(x+y)*0.5;return{x:sx,y:sy};};/**
 * Make property non-enumerable.
 */Object.defineProperty(Math,'radians',{enumerable:false,writable:true,configurable:true});/**
 * Converts degrees to radians.
 * @param {Number} degrees
 * @return {Number} radians
 */Math.radians=function(degrees){return degrees*Math.PI180;};/**
 * Make property non-enumerable.
 */Object.defineProperty(Math,'degrees',{enumerable:false,writable:true,configurable:true});/**
 * Converts radians to degrees.
 * @param {Number} radians
 * @return {Number} degrees
 */Math.degrees=function(radians){return radians*Math.PI180R;};/**
 * Make property non-enumerable.
 */Object.defineProperty(Math,'distance',{enumerable:false,writable:true,configurable:true});/**
 * Calculates the distance from the first point to the second point.
 * @param x1
 * @param y1
 * @param x2
 * @param y2
 * @return {Number}
 */Math.distance=function(x1,y1,x2,y2){return Math.sqrt((x1-x2)*(x1-x2)+(y1-y2)*(y1-y2));};if(typeof CanvasRenderingContext2D!=='undefined'){// Extend the canvas context to add some helper methods
/**
	 * Make property non-enumerable.
	 */Object.defineProperty(CanvasRenderingContext2D.prototype,'circle',{enumerable:false,writable:true,configurable:true});Object.defineProperty(CanvasRenderingContext2D.prototype,'strokeCircle',{enumerable:false,writable:true,configurable:true});Object.defineProperty(CanvasRenderingContext2D.prototype,'fillCircle',{enumerable:false,writable:true,configurable:true});CanvasRenderingContext2D.prototype.circle=function(x,y,radius){this.arc(x,y,radius,0,2*Math.PI,false);};CanvasRenderingContext2D.prototype.strokeCircle=function(x,y,radius){this.save();this.beginPath();this.arc(x,y,radius,0,2*Math.PI,false);this.stroke();this.restore();};CanvasRenderingContext2D.prototype.fillCircle=function(x,y,radius){this.save();this.beginPath();this.arc(x,y,radius,0,2*Math.PI,false);this.fill();this.restore();};}if(typeof ImageData!=='undefined'){/**
	 * Make property non-enumerable.
	 */Object.defineProperty(ImageData.prototype,'pixelAt',{enumerable:false,writable:true,configurable:true});/**
	 * Augments the canvas context getImageData() object "ImageData" with the
	 * pixelAt() method. Gets the pixel color data for the given pixel at the
	 * x, y co-ordinates specified.
	 * @param {Number} x The x co-ordinate of the pixel.
	 * @param {Number} y The y co-ordinate of the pixel.
	 * @return {Object} An object containing the pixel color data in properties
	 * {r, g, b, a}.
	 */ImageData.prototype.pixelAt=function(x,y){var data=this.data;var pixelStart=y*this.width*4+x*4;return{r:data[pixelStart],g:data[pixelStart+1],b:data[pixelStart+2],a:data[pixelStart+3]};};/**
	 * Make property non-enumerable.
	 */Object.defineProperty(ImageData.prototype,'isTransparent',{enumerable:false,writable:true,configurable:true});/**
	 * Augments the canvas context getImageData() object "ImageData" with the
	 * isTransparent() method. Determines if the pixel at the passed x, y is
	 * fully transparent or not.
	 * @param {Number} x The x co-ordinate of the pixel.
	 * @param {Number} y The y co-ordinate of the pixel.
	 * @return {Boolean} True if fully transparent, false if not.
	 */ImageData.prototype.isTransparent=function(x,y){var data=this.data;var pixelStart=y*this.width*4+x*4;return data[pixelStart+3]===0;};/**
	 * Make property non-enumerable.
	 */Object.defineProperty(ImageData.prototype,'makeTransparent',{enumerable:false,writable:true,configurable:true});/**
	 * Augments the canvas context getImageData() object "ImageData" with the
	 * makeTransparent() method. Makes the pixel at the passed x, y fully
	 * transparent.
	 * @param {Number} x The x co-ordinate of the pixel.
	 * @param {Number} y The y co-ordinate of the pixel.
	 */ImageData.prototype.makeTransparent=function(x,y){var data=this.data;var pixelStart=y*this.width*4+x*4;data[pixelStart+3]=0;};}/**
 * Turn off the right-click default behaviour in the browser for the passed element.
 * @param obj
 */var disableContextMenu=function(obj){if(obj!==null){// this.log('Disabling context menus for ' + obj, 'info');
obj.oncontextmenu=function(){return false;};}};/**
 * Adds the indexOf method to all array objects if it does not already exist which
 * would you believe can still happen even in 2012!
 */if(!Array.prototype.indexOf){/**
	 * Make property non-enumerable.
	 */Object.defineProperty(Array.prototype,'indexOf',{enumerable:false,writable:true,configurable:true});/**
	 * Get the index of the passed item.
	 * @param {*} obj The item to find the index for.
	 * @return {Number} The index of the passed item or -1 if not found.
	 */Array.prototype.indexOf=function(obj){var i;var l=this.length;for(i=0;i<l;i++){if(this[i]===obj){return i;}}return-1;};}if(typeof window!=='undefined'){/**
	 * A cross-browser/platform requestAnimationFrame method.
	 */ /* window.requestAnimFrame = (function(){
		return function(callback, element){
			setTimeout(function () { callback(new Date().getTime()); }, 1000 / 60);
		};
	}()); */requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){setTimeout(function(){callback(new Date().getTime());},1000/60);};}();}else{/**
	 * A cross-browser/platform requestAnimationFrame method.
	 */requestAnimFrame=function(){return function(callback,element){setTimeout(function(){callback(new Date().getTime());},1000/60);};}();}// Check console method existence
if(typeof console==='object'){if(typeof console.log==='function'){if(typeof console.info==='undefined'){// We have console.log but not console.info so add it as a replica of console.log
console.info=console.log;}if(typeof console.warn==='undefined'){// We have console.log but not console.warn so add it as a replica of console.log
console.warn=console.log;}}}else{// Create dummy console
console={log:function(){},warn:function(){},info:function(){},error:function(){}};};try{global.cenv=process.env.ENV||'staging';global.isDev=false;}catch(e){}var $i_2=function(){var initializing=false;var fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;// The base Class implementation (does nothing)
var $i_2=function(){};/**
		 * Provides logging capabilities to all $i_2 instances.
		 * @param {String} text The text to log.
		 * @param {String} type The type of log to output, can be 'log',
		 * 'info', 'warning' or 'error'.
		 * @param {Object=} obj An optional object that will be output
		 * before the log text is output.
		 * @example #Log a message
		 *     var entity = new $i_56();
		 *
		 *     // Will output:
		 *     //     IGE *log* [$i_56] : hello
		 *     entity.log('Hello');
		 * @example #Log an info message with an optional parameter
		 *     var entity = new $i_56(),
		 *         param = 'moo';
		 *
		 *     // Will output:
		 *     //    moo
		 *     //    IGE *log* [$i_56] : hello
		 *     entity.log('Hello', 'info', param);
		 * @example #Log a warning message (which will cause a stack trace to be shown)
		 *     var entity = new $i_56();
		 *
		 *     // Will output (stack trace is just an example here, real one will be more useful):
		 *     //    Stack: {anonymous}()@<anonymous>:2:8
		 *     //    ---- Object.InjectedScript._evaluateOn (<anonymous>:444:39)
		 *     //    ---- Object.InjectedScript._evaluateAndWrap (<anonymous>:403:52)
		 *     //    ---- Object.InjectedScript.evaluate (<anonymous>:339:21)
		 *     //    IGE *warning* [$i_56] : A test warning
		 *     entity.log('A test warning', 'warning');
		 * @example #Log an error message (which will cause an exception to be raised and a stack trace to be shown)
		 *     var entity = new $i_56();
		 *
		 *     // Will output (stack trace is just an example here, real one will be more useful):
		 *     //    Stack: {anonymous}()@<anonymous>:2:8
		 *     //    ---- Object.InjectedScript._evaluateOn (<anonymous>:444:39)
		 *     //    ---- Object.InjectedScript._evaluateAndWrap (<anonymous>:403:52)
		 *     //    ---- Object.InjectedScript.evaluate (<anonymous>:339:21)
		 *     //    IGE *error* [$i_56] : An error message
		 *     entity.log('An error message', 'error');
		 */var log=function(text,type,obj){// selective blocking to reduce log noise
/*
            if (this._classId == '$i_56Box2d') return;
            if (this._classId == 'PhysicsComponent') return;
            if (this._classId == 'Unit') return;
            if (this._classId == 'Item') return;
            if (this._classId == 'ActionComponent') return;
            if (this._classId == 'Player') return;
            if (this._classId == 'ScriptComponent') return;
            if (this._classId == '$i_18') return;
            if (this._classId == '$i_56') return;
            */if(false&&igeConfig.debug._enabled){var indent='';var stack;var thisId;if(typeof this._id!=='undefined'){thisId=`:${this._id}`;}else{thisId='';}type=type||'log';if(obj!==undefined){console.warn(obj);}if(type==='warning'||type==='error'){if(igeConfig.debug._stacks){if(igeConfig.debug._node){if(console.trace){Error.stackTraceLimit=Infinity;// console.log("ERROR: ip/port is already being used by other server")
console.log('ERROR: ',text);ige.server.kill('ERROR: ip/port is already being used by other server');console.trace();}else{stack=new Error().stack;console.log(color.magenta('Stack:'),color.red(stack));console.log('Stack:',stack);}}else{if(typeof printStackTrace==='function'){console.log('Stack:',printStackTrace().join('\n ---- '));}}}}if(type==='error'){if(typeof ige!=='undefined'){console.log(`${indent}IGE *${type}* [${this._classId||this.prototype._classId}${thisId}] : `+'Error encountered, stopping engine to prevent console spamming...');ige.stop();}if(igeConfig.debug._throwErrors){throw`${indent}IGE *${type}* [${this._classId||this.prototype._classId}${thisId}] : ${text}`;}else{console.log(`${indent}IGE *${type}* [${this._classId||this.prototype._classId}${thisId}] : ${text}`);}}else{console.log(`${indent}IGE *${type}* [${this._classId||this.prototype._classId}${thisId}] : ${text}`);}}return this;};/**
		 * Returns the class id. Primarily used to help identify
		 * what class an instance was instantiated with and is also
		 * output during the ige.scenegraph() method's console logging
		 * to show what class an object belongs to.
		 * @example #Get the class id of an object
		 *     var entity = new $i_56();
		 *
		 *     // Will output "$i_56"
		 *     console.log(entity.classId());
		 */var classId=function(){return this._classId;};/**
		 * Creates a new instance of the component argument passing
		 * the options argument to the component as it is initialised.
		 * The new component instance is then added to "this" via
		 * a property name that is defined in the component class as
		 * "componentId".
		 * @param {$i_2} component The class definition of the component.
		 * @param {Object=} options An options parameter to pass to the component
		 * on init.
		 * @example #Add the velocity component to an entity
		 *     var entity = new $i_56();
		 *     entity.addComponent($i_11);
		 *
		 *     // Now that the component is added, we can access
		 *     // the component via it's namespace. Call the
		 *     // "byAngleAndPower" method of the velocity component:
		 *     entity.velocity.byAngleAndPower(Math.radians(20), 0.1);
		 */var addComponent=function(component,options){var newComponent=new component(this,options);this[newComponent.componentId]=newComponent;// Add the component reference to the class component array
this._components=this._components||[];this._components.push(newComponent);return this;};/**
		 * Removes a component by it's id.
		 * @param {String} componentId The id of the component to remove.
		 * @example #Remove a component by it's id (namespace)
		 *     var entity = new $i_56();
		 *
		 *     // Let's add the velocity component
		 *     entity.addComponent($i_11);
		 *
		 *     // Now that the component is added, let's remove
		 *     // it via it's id ("velocity")
		 *     entity.removeComponent('velocity');
		 */var removeComponent=function(componentId){// If the component has a destroy method, call it
if(this[componentId]&&this[componentId].destroy){this[componentId].destroy();}// Remove the component from the class component array
if(this._components){this._components.pull(this[componentId]);}// Remove the component namespace from the class object
delete this[componentId];return this;};/**
		 * Copies all properties and methods from the classObj object
		 * to "this". If the overwrite flag is not set or set to false,
		 * only properties and methods that don't already exists in
		 * "this" will be copied. If overwrite is true, they will be
		 * copied regardless.
		 * @param {Function} classObj
		 * @param {Boolean} overwrite
		 * @example #Implement all the methods of an object into another object
		 *     // Create a couple of test entities with ids
		 *     var entity1 = new $i_56().id('entity1'),
		 *         entity2 = new $i_56().id('entity2');
		 *
		 *     // Let's define an object with a couple of methods
		 *     var obj = {
		 *         newMethod1: function () {
		 *             console.log('method1 called on object: ' + this.id());
		 *         },
		 *
		 *         newMethod2: function () {
		 *             console.log('method2 called on object: ' + this.id());
		 *         }
		 *     };
		 *
		 *     // Now let's implement the methods on our entities
		 *     entity1.implement(obj);
		 *     entity2.implement(obj);
		 *
		 *     // The entities now have the newMethod1 and newMethod2
		 *     // methods as part of their instance so we can call them:
		 *     entity1.newMethod1();
		 *
		 *     // The output to the console is:
		 *     //    method1 called on object: entity1
		 *
		 *     // Now let's call newMethod2 on entity2:
		 *     entity2.newMethod2();
		 *
		 *     // The output to the console is:
		 *     //    method2 called on object: entity2
		 *
		 *     // As you can see, this is a great way to add extra modular
		 *     // functionality to objects / entities at runtime.
		 */var implement=function(classObj,overwrite){var i;var obj=classObj.prototype||classObj;// Copy the class object's properties to (this)
for(i in obj){// Only copy the property if this doesn't already have it
if(obj.hasOwnProperty(i)&&(overwrite||this[i]===undefined)){this[i]=obj[i];}}return this;};/**
		 * Gets / sets a key / value pair in the object's data object. Useful for
		 * storing arbitrary game data in the object.
		 * @param {String} key The key under which the data resides.
		 * @param {*=} value The data to set under the specified key.
		 * @example #Set some arbitrary data key value pair
		 *     var entity = new $i_56();
		 *     entity.data('playerScore', 100);
		 *     entity.data('playerName', 'iRock');
		 * @example #Get the value of a data key
		 *     console.log(entity.data('playerScore'));
		 *     console.log(entity.data('playerName'));
		 * @return {*}
		 */var data=function(key,value){if(key!==undefined){if(value!==undefined){this._data=this._data||{};this._data[key]=value;return this;}if(this._data){return this._data[key];}else{return null;}}};/**
	 * Create a new $i_2 that inherits from this class
	 * @name extend
	 * @example #Creating a new class by extending an existing one
	 *     var NewClass = $i_2.extend({
	 *         // Init is your constructor
	 *         init: function () {
	 *             console.log('I\'m alive!');
	 *         }
	 *     });
	 *
	 * Further reading: [Extending Classes](http://www.isogenicengine.com/documentation/isogenic-game-engine/versions/1-1-0/manual/engine-fundamentals/classes/extending-classes/)
	 * @return {Function}
	 */$i_2.extend=function(){var name;var prototype;// Set prop to the last argument passed
var prop=arguments[arguments.length-1];var extensionArray=arguments[0];var extensionItem;var extensionOverwrite;var extensionIndex;var propertyIndex;var propertyObject;// Check that the class has been assigned a classId and bug out if not
if(!prop.classId){console.log(prop);throw'Cannot create a new class without giving the class a classId property!';}// Check that the classId is not already in use
if(igeClassStore[prop.classId]){// This classId has already been used, bug out
throw`Cannot create class with classId "${prop.classId}" because a class with that ID has already been created!`;}// Instantiate a base class (but only create the instance,
// don't run the init constructor)
initializing=true;prototype=new this();initializing=false;// Copy the properties over onto the new prototype
for(name in prop){if(prop.hasOwnProperty(name)){// Copy the property
prototype[name]=prop[name];}}// try{
// 	var oinit = prototype.init;
// 	if(global && global.isDev)
// 	{
// 		prototype.init = function(){
// 			try{
// 				if(global && global.isServer)
// 				{
// 					if(global.classes==undefined)global.classes = {};
// 					if(global.traces==undefined)global.traces = {};
// 					if(global.classes[prop.classId]==undefined)
// 					{
// 						global.classes[prop.classId] = 0;
// 						global.traces[prop.classId] = {};
// 					}
// 					var str = new Error().stack;
// 					if(global.traces[prop.classId][str]==undefined)global.traces[prop.classId][str]=0;
// 					global.traces[prop.classId][str]++;
// 					global.classes[prop.classId]++;
// 				}
// 				oinit.apply(this, arguments);
// 			}catch(e)
// 			{
// 			}
// 		};
// 	}
// }catch(e){}
// Now implement any other extensions
if(arguments.length>1){if(extensionArray&&extensionArray.length){for(extensionIndex=0;extensionIndex<extensionArray.length;extensionIndex++){extensionItem=extensionArray[extensionIndex];propertyObject=extensionItem.extension.prototype||extensionItem.extension;extensionOverwrite=extensionItem.overwrite;// Copy the class object's properties to (this)
for(propertyIndex in propertyObject){// Only copy the property if this doesn't already have it or
// the extension is set to overwrite any existing properties
if(propertyObject.hasOwnProperty(propertyIndex)&&(extensionOverwrite||prototype[propertyIndex]===undefined)){prototype[propertyIndex]=propertyObject[propertyIndex];}}}}}// prototype._superClass = this.prototype;
// console.log(prop.classId, 'extends', this.prototype._classId);
// The dummy class constructor
function $i_2(){if(!initializing&&this.init){// Call the class init method
this.init.apply(this,arguments);}}// Populate our constructed prototype object
$i_2.prototype=prototype;// Enforce the constructor to be what we expect
$i_2.prototype.constructor=$i_2;// And make this class extensible
$i_2.extend=arguments.callee;// Add log capability
$i_2.prototype.log=log;// Add data capability
$i_2.prototype.data=data;// Add class name capability
$i_2.prototype.classId=classId;// This is a method that returns _classId
$i_2.prototype._classId=prop.classId||'$i_2';// Add the addComponent method
$i_2.prototype.addComponent=addComponent;// Add the removeComponent method
$i_2.prototype.removeComponent=removeComponent;// Add the implement method
$i_2.prototype.implement=implement;// Add editor settings
$i_2.prototype.__igeEditor=prop.editorOptions;// Register the class with the class store
igeClassStore[prop.classId]=$i_2;return $i_2;};/**
	 * Test method
	 * @param prop
	 * @return {Function}
	 */$i_2.vanilla=function(prop){var $i_2=prop.init||function(){};var prototype=new this();// Copy the properties over onto the new prototype
for(name in prop){if(prop.hasOwnProperty(name)&&name!=='init'){// Copy the property
prototype[name]=prop[name];}}// Populate our constructed prototype object
$i_2.prototype=prototype;// Enforce the constructor to be what we expect
$i_2.prototype.constructor=$i_2;// And make this class extensible
$i_2.extend=this.extend;// Add log capability
$i_2.prototype.log=log;// Add data capability
$i_2.prototype.data=data;// Add class name capability
$i_2.prototype.classId=classId;// This is a method that returns _classId
$i_2.prototype._classId=prop.classId||'$i_2';// Add the addComponent method
$i_2.prototype.addComponent=addComponent;// Add the removeComponent method
$i_2.prototype.removeComponent=removeComponent;// Add the implement method
$i_2.prototype.implement=implement;// Register the class with the class store
igeClassStore[prop.classId]=$i_2;return $i_2;};$i_2.prototype._classId='$i_2';return $i_2;}();if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_2;};/**
 * Creates a new class with the capability to emit events.
 */var $i_3=$i_2.extend({classId:'$i_3',/**
	 * Add an event listener method for an event.
	 * @param {String || Array} eventName The name of the event to listen for (string), or an array of events to listen for.
	 * @param {Function} call The method to call when the event listener is triggered.
	 * @param {Object=} context The context in which the call to the listening method will be made (sets the 'this' variable in the method to the object passed as this parameter).
	 * @param {Boolean=} oneShot If set, will instruct the listener to only listen to the event being fired once and will not fire again.
	 * @param {Boolean=} sendEventName If set, will instruct the emitter to send the event name as the argument instead of any emitted arguments.
	 * @return {Object} The event listener object. Hold this value if you later want to turn off the event listener.
	 * @example #Add an Event Listener
	 *     // Register event lister and store in "evt"
	 *     var evt = myEntity.on('mouseDown', function () { console.log('down'); });
	 * @example #Listen for Event Data
	 *     // Set a listener to listen for the data (multiple values emitted
	 *     // from an event are passed as function arguments)
	 *     myEntity.on('hello', function (arg1, arg2) {
	 *         console.log(arg1, arg2);
	 *     }
	 *
	 *     // Emit the event named "hello"
	 *     myEntity.emit('hello', ['data1', 'data2']);
	 *
	 *     // The console output is:
	 *     //    data1, data2
	 */on:function(eventName,call,context,oneShot,sendEventName){var self=this;var newListener;var addListener;var existingIndex;var elArr;var multiEvent;var eventIndex;var eventData;var eventObj;var multiEventName;var i;// Check that we have an event listener object
this._eventListeners=this._eventListeners||{};if(typeof call==='function'){if(typeof eventName==='string'){// Compose the new listener
newListener={call:call,context:context,oneShot:oneShot,sendEventName:sendEventName};elArr=this._eventListeners[eventName]=this._eventListeners[eventName]||[];// Check if we already have this listener in the list
addListener=true;// TO-DO - Could this do with using indexOf? Would that work? Would be faster?
existingIndex=elArr.indexOf(newListener);if(existingIndex>-1){addListener=false;}// Add this new listener
if(addListener){elArr.push(newListener);}return newListener;}else{// The eventName is an array of names, creating a group of events
// that must be fired to fire this event callback
if(eventName.length){// Loop the event array
multiEvent=[];multiEvent[0]=0;// This will hold our event count total
multiEvent[1]=0;// This will hold our number of events fired
// Define the multi event callback
multiEvent[3]=function(firedEventName){multiEvent[1]++;if(multiEvent[0]===multiEvent[1]){// All the multi-event events have fired
// so fire the callback
call.apply(context||self);}};for(eventIndex in eventName){if(eventName.hasOwnProperty(eventIndex)){eventData=eventName[eventIndex];eventObj=eventData[0];multiEventName=eventData[1];// Increment the event listening count total
multiEvent[0]++;// Register each event against the event object with a callback
eventObj.on(multiEventName,multiEvent[3],null,true,true);}}}}}else{if(typeof eventName!=='string'){eventName='*Multi-Event*';}this.log(`Cannot register event listener for event "${eventName}" because the passed callback is not a function!`,'error');}},/**
	 * Remove an event listener. If the _processing flag is true
	 * then the removal will be placed in the removals array to be
	 * processed after the event loop has completed in the emit()
	 * method.
	 * @param {Boolean} eventName The name of the event you originally registered to listen for.
	 * @param {Object} evtListener The event listener object to cancel. This object is the one
	 * returned when calling the on() method. It is NOT the method you passed as the second argument
	 * to the on() method.
	 * @param {Function} callback The callback method to call when the event listener has been
	 * successfully removed. If you attempt to remove a listener during the event firing loop
	 * then the listener will not immediately be removed but will be queued for removal before
	 * the next listener loop is fired. In this case you may like to be informed via callback
	 * when the listener has been fully removed in which case, provide a method for this argument.
	 *
	 * The callback will be passed a single boolean argument denoting if the removal was successful
	 * (true) or the listener did not exist to remove (false).
	 * @example #Switch off an Event Listener
	 *     // Register event lister and store in "evt"
	 *     var evt = myEntity.on('mouseDown', function () { console.log('down'); });
	 *
	 *     // Switch off event listener
	 *     myEntity.off('mouseDown', evt);
	 * @return {Boolean}
	 */off:function(eventName,evtListener,callback){if(this._eventListeners){if(!this._eventListeners._processing){if(this._eventListeners[eventName]){// Find this listener in the list
var evtListIndex=this._eventListeners[eventName].indexOf(evtListener);if(evtListIndex>-1){// Remove the listener from the event listener list
this._eventListeners[eventName].splice(evtListIndex,1);if(callback){callback(true);}return true;}else{this.log(`Failed to cancel event listener for event named "${eventName}" !`,'warning',evtListener);}}else{this.log('Failed to cancel event listener!');}}else{// Add the removal to a remove queue since we are processing
// listeners at the moment and removing one would mess up the
// loop!
this._eventListeners._removeQueue=this._eventListeners._removeQueue||[];this._eventListeners._removeQueue.push([eventName,evtListener,callback]);return-1;}}if(callback){callback(false);}return false;},/**
	 * Emit an event by name.
	 * @param {Object} eventName The name of the event to emit.
	 * @param {Object || Array} args The arguments to send to any listening methods.
	 * If you are sending multiple arguments, use an array containing each argument.
	 * @return {Number}
	 * @example #Emit an Event
	 *     // Emit the event named "hello"
	 *     myEntity.emit('hello');
	 * @example #Emit an Event With Data Object
	 *     // Emit the event named "hello"
	 *     myEntity.emit('hello', {moo: true});
	 * @example #Emit an Event With Multiple Data Values
	 *     // Emit the event named "hello"
	 *     myEntity.emit('hello', [{moo: true}, 'someString']);
	 * @example #Listen for Event Data
	 *     // Set a listener to listen for the data (multiple values emitted
	 *     // from an event are passed as function arguments)
	 *     myEntity.on('hello', function (arg1, arg2) {
	 *         console.log(arg1, arg2);
	 *     }
	 *
	 *     // Emit the event named "hello"
	 *     myEntity.emit('hello', ['data1', 'data2']);
	 *
	 *     // The console output is:
	 *     //    data1, data2
	 */emit:function(eventName,args){if(this._eventListeners){// Check if the event has any listeners
if(this._eventListeners[eventName]){// Fire the listeners for this event
var eventCount=this._eventListeners[eventName].length;var eventCount2=this._eventListeners[eventName].length-1;var finalArgs;var i;var cancelFlag;var eventIndex;var tempEvt;var retVal;// If there are some events, ensure that the args is ready to be used
if(eventCount){finalArgs=[];if(typeof args==='object'&&args!==null&&args[0]!==null&&args[0]!==undefined){for(i in args){if(args.hasOwnProperty(i)){finalArgs[i]=args[i];}}}else{finalArgs=[args];}// Loop and emit!
cancelFlag=false;this._eventListeners._processing=true;while(eventCount--){eventIndex=eventCount2-eventCount;tempEvt=this._eventListeners[eventName][eventIndex];// If the sendEventName flag is set, overwrite the arguments with the event name
if(tempEvt.sendEventName){finalArgs=[eventName];}// Call the callback
retVal=tempEvt.call.apply(tempEvt.context||this,finalArgs);// If the retVal === true then store the cancel flag and return to the emitting method
if(retVal===true){// The receiver method asked us to send a cancel request back to the emitter
cancelFlag=true;}// Check if we should now cancel the event
if(tempEvt.oneShot){// The event has a oneShot flag so since we have fired the event,
// lets cancel the listener now
if(this.off(eventName,tempEvt)===true){eventCount2--;}}}// Check that the array still exists because an event
// could have triggered a method that destroyed our object
// which would have deleted the array!
if(this._eventListeners){this._eventListeners._processing=false;// Now process any event removal
this._processRemovals();}if(cancelFlag){return 1;}}}}},/**
	 * Returns an object containing the current event listeners.
	 * @return {Object}
	 */eventList:function(){return this._eventListeners;},/**
	 * Loops the removals array and processes off() calls for
	 * each array item.
	 * @private
	 */_processRemovals:function(){if(this._eventListeners){var remArr=this._eventListeners._removeQueue;var arrCount;var item;var result;// If the removal array exists
if(remArr){// Get the number of items in the removal array
arrCount=remArr.length;// Loop the array
while(arrCount--){item=remArr[arrCount];// Call the off() method for this item
result=this.off(item[0],item[1]);// Check if there is a callback
if(typeof remArr[2]==='function'){// Call the callback with the removal result
remArr[2](result);}}}// Remove the removal array
delete this._eventListeners._removeQueue;}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_3;};/**
 * Creates a new 2d point (x, y).
 */var $i_4=$i_2.extend({classId:'$i_4',init:function(x,y,floor){// Set values to the passed parameters or
// zero if they are undefined
// Commented for increase performance over stability checks
/* if (x === undefined) { debugger; }
		if (y === undefined) { debugger; } */this.x=x=x!==undefined?x:0;this.y=y=y!==undefined?y:0;this._floor=floor!==undefined;if(this._floor){this.x2=Math.floor(x/2);this.y2=Math.floor(y/2);}else{this.x2=x/2;this.y2=y/2;}return this;},/**
	 * Gets / sets the floor mode of this point. If set to true the point's
	 * data will be mathematically floored when they are assigned.
	 * @param val
	 * @return {*}
	 */floor:function(val){if(val!==undefined){this._floor=val;return this;}return this._floor;},/**
	 * Compares this point's x, y data with the passed point and returns
	 * true if they are the same and false if any is different.
	 * @param {$i_4} point The point to compare data with.
	 * @return {Boolean}
	 */compare:function(point){return point&&this.x===point.x&&this.y===point.y;},/**
	 * Copies the x, y data from the passed point and overwrites this
	 * point's data with those values.
	 * @param {$i_4} point The point to copy values from.
	 * @returns {*}
	 */copy:function(point){this.x=point.x;this.y=point.y;this.z=point.z;return this;},/**
	 * Converts the point's x, y to an isometric x, y 2d co-ordinate
	 * and returns an object whose x, y values are the result.
	 * @return {Object}
	 */toIso:function(){var sx=this.x-this.y;var sy=(this.x+this.y)*0.5;return{x:sx,y:sy};},/**
	 * Converts this point's x, y data into isometric co-ordinate space
	 * and overwrites the previous x, y values with the result.
	 * @return {*}
	 */thisToIso:function(){var val=this.toIso();this.x=val.x;this.y=val.y;return this;},/**
	 * Converts this point's x, y data into 2d co-ordinate space
	 * and returns an object whose x, y values are the result.
	 * @return {Object}
	 */to2d:function(){var sx=this.y+this.x/2;var sy=this.y-this.x/2;return{x:sx,y:sy};},/**
	 * Converts this point's x, y data into 2d co-ordinate space
	 * and overwrites the previous x, y values with the result.
	 * @return {*}
	 */thisTo2d:function(){var val=this.to2d();this.x=val.x;this.y=val.y;return this;},/**
	 * Adds this point's data by the x, y, values specified
	 * and returns a new $i_4 whose values are the result.
	 * @param point
	 * @return {*}
	 */addPoint:function(point){return new $i_4(this.x+point.x,this.y+point.y);},/**
	 * Adds this point's data by the x, y values specified and
	 * overwrites the previous x, y values with the result.
	 * @param point
	 * @return {*}
	 */thisAddPoint:function(point){this.x+=point.x;this.y+=point.y;return this;},/**
	 * Minuses this point's data by the x, y values specified
	 * and returns a new $i_4 whose values are the result.
	 * @param point
	 * @return {*}
	 */minusPoint:function(point){return new $i_4(this.x-point.x,this.y-point.y);},/**
	 * Minuses this point's data by the x, y values specified and
	 * overwrites the previous x, y values with the result.
	 * @param point
	 * @return {*}
	 */thisMinusPoint:function(point){this.x-=point.x;this.y-=point.y;return this;},/**
	 * Multiplies this point's data by the x, y values specified
	 * and returns a new $i_4 whose values are the result.
	 * @param x
	 * @param y
	 * @return {*}
	 */multiply:function(x,y){return new $i_4(this.x*x,this.y*y);},/**
	 * Multiplies this point's data by the point specified
	 * and returns a new $i_4 whose values are the result.
	 * @param {$i_4} point
	 * @return {*}
	 */multiplyPoint:function(point){return new $i_4(this.x*point.x,this.y*point.y);},/**
	 * Multiplies this point's data by the x, y values specified and
	 * overwrites the previous x, y values with the result.
	 * @param x
	 * @param y
	 * @param z
	 * @return {*}
	 */thisMultiply:function(x,y){this.x*=x;this.y*=y;return this;},/**
	 * Divides this point's data by the x, y values specified
	 * and returns a new $i_4 whose values are the result.
	 * @param x
	 * @param y
	 * @return {*}
	 */divide:function(x,y){return new $i_4(this.x/x,this.y/y);},/**
	 * Divides this point's data by the point specified
	 * and returns a new $i_4 whose values are the result.
	 * @param {$i_4} point
	 * @return {*}
	 */dividePoint:function(point){var newX=this.x;var newY=this.y;if(point.x){newX=this.x/point.x;}if(point.y){newY=this.y/point.y;}return new $i_4(newX,newY);},/**
	 * Divides this point's data by the x, y values specified and
	 * overwrites the previous x, y values with the result.
	 * @param x
	 * @param y
	 * @return {*}
	 */thisDivide:function(x,y){this.x/=x;this.y/=y;return this;},/**
	 * Returns a clone of this $i_4's data as a new instance.
	 * @return {*}
	 */clone:function(){return new $i_4(this.x,this.y);},/**
	 * Interpolates the x, y values of this point towards the endPoint's
	 * x, y values based on the passed time variables and returns a new
	 * $i_4 whose values are the result.
	 * @param endPoint
	 * @param startTime
	 * @param currentTime
	 * @param endTime
	 * @return {*}
	 */interpolate:function(endPoint,startTime,currentTime,endTime){var totalX=endPoint.x-this.x;var totalY=endPoint.y-this.y;var totalTime=endTime-startTime;var deltaTime=totalTime-(currentTime-startTime);var timeRatio=deltaTime/totalTime;return new $i_4(endPoint.x-totalX*timeRatio,endPoint.y-totalY*timeRatio);},/**
	 * Rotates the point by the given radians.
	 * @param {Number} radians Radians to rotate by.
	 * @return {$i_4} A new point with the rotated x, y.
	 */rotate:function(radians){var s=Math.sin(radians);var c=Math.cos(radians);var x=c*this.x-s*this.y;var y=s*this.x-c*this.y;return new $i_4(x,y);},/**
	 * Rotates the point by the given radians and updates this point
	 * to the new x, y values.
	 * @param {Number} radians Radians to rotate by.
	 * @return {$i_4} This point.
	 */thisRotate:function(radians){var s=Math.sin(radians);var c=Math.cos(radians);var x=this.x;var y=this.y;this.x=c*x-s*y;this.y=s*x-c*y;return this;},/**
	 * Returns a string representation of the point's x, y
	 * converting floating point values into fixed using the
	 * passed precision parameter. If no precision is specified
	 * then the precision defaults to 2.
	 * @param {Number=} precision
	 * @return {String}
	 */toString:function(precision){if(precision===undefined){precision=2;}if(this.x==undefined||this.y==undefined){return'0,0';}return`${parseFloat(this.x).toFixed(precision)},${parseFloat(this.y).toFixed(precision)}`;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_4;};/**
 * Creates a new 3d point (x, y, z).
 */var $i_5=$i_2.extend({classId:'$i_5',init:function(x,y,z,floor){// Set values to the passed parameters or
// zero if they are undefined
// Commented for increase performance over stability checks
/* if (x === undefined) { debugger; }
		if (y === undefined) { debugger; }
		if (z === undefined) { debugger; } */this.x=x=x!==undefined?x:0;this.y=y=y!==undefined?y:0;this.z=z=z!==undefined?z:0;this._floor=floor!==undefined;if(this._floor){this.x2=Math.floor(x/2);this.y2=Math.floor(y/2);this.z2=Math.floor(z/2);}else{this.x2=x/2;this.y2=y/2;this.z2=z/2;}return this;},/**
	 * Gets / sets the floor mode of this point. If set to true the point's
	 * data will be mathematically floored when they are assigned.
	 * @param val
	 * @return {*}
	 */floor:function(val){if(val!==undefined){this._floor=val;return this;}return this._floor;},/**
	 * Compares this point's x, y, z data with the passed point and returns
	 * true if they are the same and false if any is different.
	 * @param {$i_5} point The point to compare data with.
	 * @return {Boolean}
	 */compare:function(point){return point&&this.x===point.x&&this.y===point.y&&this.z===point.z;},/**
	 * Copies the x, y, z data from the passed point and overwrites this
	 * point's data with those values.
	 * @param {$i_5} point The point to copy values from.
	 * @returns {*}
	 */copy:function(point){this.x=point.x;this.y=point.y;this.z=point.z;return this;},/**
	 * Converts the point's x, y, z to an isometric x, y 2d co-ordinate
	 * and returns an object whose x, y values are the result.
	 * @return {Object}
	 */toIso:function(){var sx=this.x-this.y;var sy=-this.z*1.2247+(this.x+this.y)*0.5;return{x:sx,y:sy};},/**
	 * Converts this point's x, y, z data into isometric co-ordinate space
	 * and overwrites the previous x, y, z values with the result.
	 * @return {*}
	 */thisToIso:function(){var val=this.toIso();this.x=val.x;this.y=val.y;return this;},/**
	 * Converts this point's x, y, z data into 2d co-ordinate space
	 * and returns an object whose x, y values are the result.
	 * @return {Object}
	 */to2d:function(){var sx=this.y+this.x/2;var sy=this.y-this.x/2;return{x:sx,y:sy};},/**
	 * Converts this point's x, y, z data into 2d co-ordinate space
	 * and overwrites the previous x, y, z values with the result.
	 * @return {*}
	 */thisTo2d:function(){var val=this.to2d();this.x=val.x;this.y=val.y;this.z=0;return this;},/**
	 * Adds this point's data by the x, y, z, values specified
	 * and returns a new $i_5 whose values are the result.
	 * @param point
	 * @return {*}
	 */addPoint:function(point){return new $i_5(this.x+point.x,this.y+point.y,this.z+point.z);},/**
	 * Adds this point's data by the x, y, z values specified and
	 * overwrites the previous x, y, z values with the result.
	 * @param point
	 * @return {*}
	 */thisAddPoint:function(point){this.x+=point.x;this.y+=point.y;this.z+=point.z;return this;},/**
	 * Minuses this point's data by the x, y, z, values specified
	 * and returns a new $i_5 whose values are the result.
	 * @param point
	 * @return {*}
	 */minusPoint:function(point){return new $i_5(this.x-point.x,this.y-point.y,this.z-point.z);},/**
	 * Minuses this point's data by the x, y, z values specified and
	 * overwrites the previous x, y, z values with the result.
	 * @param point
	 * @return {*}
	 */thisMinusPoint:function(point){this.x-=point.x;this.y-=point.y;this.z-=point.z;return this;},/**
	 * Multiplies this point's data by the x, y, z, values specified
	 * and returns a new $i_5 whose values are the result.
	 * @param x
	 * @param y
	 * @param z
	 * @return {*}
	 */multiply:function(x,y,z){return new $i_5(this.x*x,this.y*y,this.z*z);},/**
	 * Multiplies this point's data by the point specified
	 * and returns a new $i_5 whose values are the result.
	 * @param {$i_5} point
	 * @return {*}
	 */multiplyPoint:function(point){return new $i_5(this.x*point.x,this.y*point.y,this.z*point.z);},/**
	 * Multiplies this point's data by the x, y, z values specified and
	 * overwrites the previous x, y, z values with the result.
	 * @param x
	 * @param y
	 * @param z
	 * @return {*}
	 */thisMultiply:function(x,y,z){this.x*=x;this.y*=y;this.z*=z;return this;},/**
	 * Divides this point's data by the x, y, z, values specified
	 * and returns a new $i_5 whose values are the result.
	 * @param x
	 * @param y
	 * @param z
	 * @return {*}
	 */divide:function(x,y,z){return new $i_5(this.x/x,this.y/y,this.z/z);},/**
	 * Divides this point's data by the point specified
	 * and returns a new $i_5 whose values are the result.
	 * @param {$i_5} point
	 * @return {*}
	 */dividePoint:function(point){var newX=this.x;var newY=this.y;var newZ=this.z;if(point.x){newX=this.x/point.x;}if(point.y){newY=this.y/point.y;}if(point.z){newZ=this.z/point.z;}return new $i_5(newX,newY,newZ);},/**
	 * Divides this point's data by the x, y, z values specified and
	 * overwrites the previous x, y, z values with the result.
	 * @param x
	 * @param y
	 * @param z
	 * @return {*}
	 */thisDivide:function(x,y,z){this.x/=x;this.y/=y;this.z/=z;return this;},/**
	 * Returns a clone of this $i_5's data as a new instance.
	 * @return {*}
	 */clone:function(){return new $i_5(this.x,this.y,this.z);},/**
	 * Interpolates the x, y, z values of this point towards the endPoint's
	 * x, y, z values based on the passed time variables and returns a new
	 * $i_5 whose values are the result.
	 * @param endPoint
	 * @param startTime
	 * @param currentTime
	 * @param endTime
	 * @return {*}
	 */interpolate:function(endPoint,startTime,currentTime,endTime){var totalX=endPoint.x-this.x;var totalY=endPoint.y-this.y;var totalZ=endPoint.z-this.z;var totalTime=endTime-startTime;var deltaTime=totalTime-(currentTime-startTime);var timeRatio=deltaTime/totalTime;return new $i_5(endPoint.x-totalX*timeRatio,endPoint.y-totalY*timeRatio,endPoint.z-totalZ*timeRatio);},/**
	 * Rotates the point by the given radians.
	 * @param {Number} radians Radians to rotate by.
	 * @return {$i_5} A new point with the rotated x, y.
	 */rotate:function(radians){var s=Math.sin(radians);var c=Math.cos(radians);var x=c*this.x-s*this.y;var y=s*this.x-c*this.y;return new $i_5(x,y,this.z);},/**
	 * Rotates the point by the given radians and updates this point
	 * to the new x, y values.
	 * @param {Number} radians Radians to rotate by.
	 * @return {$i_5} This point.
	 */thisRotate:function(radians){var s=Math.sin(radians);var c=Math.cos(radians);var x=this.x;var y=this.y;this.x=c*x-s*y;this.y=s*x-c*y;return this;},/**
	 * Returns a string representation of the point's x, y, z
	 * converting floating point values into fixed using the
	 * passed precision parameter. If no precision is specified
	 * then the precision defaults to 2.
	 * @param {Number=} precision
	 * @return {String}
	 */toString:function(precision){if(precision===undefined){precision=2;}if(this.x==undefined||this.y==undefined||this.z==undefined){return'0,0,0';}return`${parseFloat(this.x).toFixed(precision)},${parseFloat(this.y).toFixed(precision)},${parseFloat(this.z).toFixed(precision)}`;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_5;};/**
 * Creates a new 2d polygon made up of $i_4 instances.
 */var $i_6=$i_2.extend({classId:'$i_6',init:function(){this._poly=[];this._scale=new $i_4(1,1);},scale:function(x,y){if(x!==undefined&&y!==undefined){this._scale.x=x;this._scale.y=y;return this;}return this._scale;},/**
	 * Multiplies the points of the polygon by the supplied factor.
	 * @param {Number} factor The multiplication factor.
	 * @return {*}
	 */multiply:function(factor){if(factor!==undefined){var polyPoints=this._poly;var pointCount=polyPoints.length;var pointIndex;for(pointIndex=0;pointIndex<pointCount;pointIndex++){polyPoints[pointIndex].x*=factor;polyPoints[pointIndex].y*=factor;}}return this;},/**
	 * Divides the points of the polygon by the supplied value.
	 * @param {Number} value The divide value.
	 * @return {*}
	 */divide:function(value){if(value!==undefined){var polyPoints=this._poly;var pointCount=polyPoints.length;var pointIndex;for(pointIndex=0;pointIndex<pointCount;pointIndex++){polyPoints[pointIndex].x/=value;polyPoints[pointIndex].y/=value;}}return this;},/**
	 * Adds a point to the polygon relative to the polygon center at 0, 0.
	 * @param x
	 * @param y
	 */addPoint:function(x,y){this._poly.push(new $i_4(x,y));return this;},/**
	 * Returns the length of the poly array.
	 * @return {Number}
	 */length:function(){return this._poly.length;},/**
	 * Check if a point is inside this polygon.
	 * @param {$i_4} point
	 * @return {Boolean}
	 */pointInPoly:function(point){var polyPoints=this._poly;var pointCount=polyPoints.length;var pointIndex;var oldPointIndex=pointCount-1;var c=0;for(pointIndex=0;pointIndex<pointCount;oldPointIndex=pointIndex++){if(polyPoints[pointIndex].y>point.y!==polyPoints[oldPointIndex].y>point.y&&point.x<(polyPoints[oldPointIndex].x-polyPoints[pointIndex].x)*(point.y-polyPoints[pointIndex].y)/(polyPoints[oldPointIndex].y-polyPoints[pointIndex].y)+polyPoints[pointIndex].x){c=!c;}}return Boolean(c);},/**
	 * Check if the passed x and y are inside this polygon.
	 * @param {Number} x
	 * @param {Number} y
	 * @return {Boolean}
	 */xyInside:function(x,y){var polyPoints=this._poly;var pointCount=polyPoints.length;var pointIndex;var oldPointIndex=pointCount-1;var c=0;for(pointIndex=0;pointIndex<pointCount;oldPointIndex=pointIndex++){if(polyPoints[pointIndex].y>y!==polyPoints[oldPointIndex].y>y&&x<(polyPoints[oldPointIndex].x-polyPoints[pointIndex].x)*(y-polyPoints[pointIndex].y)/(polyPoints[oldPointIndex].y-polyPoints[pointIndex].y)+polyPoints[pointIndex].x){c=!c;}}return Boolean(c);},aabb:function(){var minX;var minY;var maxX;var maxY;var xArr=[];var yArr=[];var arr=this._poly;var arrIndex;var arrCount=arr.length;for(arrIndex=0;arrIndex<arrCount;arrIndex++){xArr.push(arr[arrIndex].x);yArr.push(arr[arrIndex].y);}// Get the extents of the newly transformed poly
minX=Math.min.apply(Math,xArr);minY=Math.min.apply(Math,yArr);maxX=Math.max.apply(Math,xArr);maxY=Math.max.apply(Math,yArr);return new $i_7(minX,minY,maxX-minX,maxY-minY);},/**
	 * Returns a copy of this $i_6 object that is
	 * it's own version, separate from the original.
	 * @return {$i_6}
	 */clone:function(){var newPoly=new $i_6();var arr=this._poly;var arrCount=arr.length;var i;for(i=0;i<arrCount;i++){newPoly.addPoint(arr[i].x,arr[i].y);}newPoly.scale(this._scale.x,this._scale.y);return newPoly;},/**
	 * Determines if the polygon is clockwise or not.
	 * @return {Boolean} A boolean true if clockwise or false
	 * if not.
	 */clockWiseTriangle:function(){// Loop the polygon points and determine if they are counter-clockwise
var arr=this._poly;var val;var p1;var p2;var p3;p1=arr[0];p2=arr[1];p3=arr[2];val=p1.x*p2.y+p2.x*p3.y+p3.x*p1.y-p2.y*p3.x-p3.y*p1.x-p1.y*p2.x;return val>0;},makeClockWiseTriangle:function(){// If our data is already clockwise exit
if(!this.clockWiseTriangle()){var p0=this._poly[0];var p1=this._poly[1];var p2=this._poly[2];this._poly[2]=p1;this._poly[1]=p2;}},triangulate:function(){// Get the indices of each new triangle
var poly=this._poly;var triangles=[];var indices=this.triangulationIndices();var i;var point1;var point2;var point3;var newPoly;// Generate new polygons from the index data
for(i=0;i<indices.length;i+=3){point1=poly[indices[i]];point2=poly[indices[i+1]];point3=poly[indices[i+2]];newPoly=new $i_6();newPoly.addPoint(point1.x,point1.y);newPoly.addPoint(point2.x,point2.y);newPoly.addPoint(point3.x,point3.y);// Check the new poly and make sure it's clockwise
newPoly.makeClockWiseTriangle();triangles.push(newPoly);}return triangles;},triangulationIndices:function(){var indices=[];var n=this._poly.length;var v=[];var V=[];var nv;var count;var m;var u;var w;var a;var b;var c;var s;var t;if(n<3){return indices;}if(this._area()>0){for(v=0;v<n;v++){V[v]=v;}}else{for(v=0;v<n;v++){V[v]=n-1-v;}}nv=n;count=2*nv;m=0;for(v=nv-1;nv>2;){if(count--<=0){return indices;}u=v;if(nv<=u){u=0;}v=u+1;if(nv<=v){v=0;}w=v+1;if(nv<=w){w=0;}if(this._snip(u,v,w,nv,V)){a=V[u];b=V[v];c=V[w];indices.push(a);indices.push(b);indices.push(c);m++;s=v;for(t=v+1;t<nv;t++){V[s]=V[t];s++;}nv--;count=2*nv;}}indices.reverse();return indices;},_area:function(){var n=this._poly.length;var a=0.0;var q=0;var p;var pval;var qval;for(p=n-1;q<n;p=q++){pval=this._poly[p];qval=this._poly[q];a+=pval.x*qval.y-qval.x*pval.y;}return a*0.5;},_snip:function(u,v,w,n,V){var p;var A=this._poly[V[u]];var B=this._poly[V[v]];var C=this._poly[V[w]];var P;// Replaced Math.Epsilon with 0.00001
if((B.x-A.x)*(C.y-A.y)-(B.y-A.y)*(C.x-A.x)<0.00001){return false;}for(p=0;p<n;p++){if(p==u||p==v||p==w){continue;}P=this._poly[V[p]];if(this._insideTriangle(A,B,C,P)){return false;}}return true;},_insideTriangle:function(A,B,C,P){var ax,ay,bx,by,cx,cy,apx,apy,bpx,bpy,cpx,cpy,cCROSSap,bCROSScp,aCROSSbp;ax=C.x-B.x;ay=C.y-B.y;bx=A.x-C.x;by=A.y-C.y;cx=B.x-A.x;cy=B.y-A.y;apx=P.x-A.x;apy=P.y-A.y;bpx=P.x-B.x;bpy=P.y-B.y;cpx=P.x-C.x;cpy=P.y-C.y;aCROSSbp=ax*bpy-ay*bpx;cCROSSap=cx*apy-cy*apx;bCROSScp=bx*cpy-by*cpx;return aCROSSbp>=0.0&&bCROSScp>=0.0&&cCROSSap>=0.0;},/**
	 * Draws the polygon bounding lines to the passed context.
	 * @param {CanvasRenderingContext2D} ctx
	 */render:function(ctx,fill){var polyPoints=this._poly;var pointCount=polyPoints.length;var scaleX=this._scale.x;var scaleY=this._scale.y;var i;ctx.beginPath();ctx.moveTo(polyPoints[0].x*scaleX,polyPoints[0].y*scaleY);for(i=1;i<pointCount;i++){ctx.lineTo(polyPoints[i].x*scaleX,polyPoints[i].y*scaleY);}ctx.lineTo(polyPoints[0].x*scaleX,polyPoints[0].y*scaleY);if(fill){ctx.fill();}ctx.stroke();return this;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_6;};/**
 * Creates a new rectangle (x, y, width, height).
 */var $i_7=$i_2.extend({classId:'$i_7',init:function(x,y,width,height){// Set values to the passed parameters or
// zero if they are undefined
this.x=x=x!==undefined?x:0;this.y=y=y!==undefined?y:0;this.width=width=width!==undefined?width:0;this.height=height=height!==undefined?height:0;this.x2=this.x/2;this.y2=this.y/2;return this;},/**
	 * Combines the extents of the passed $i_7 with this rect
	 * to create a new rect whose bounds encapsulate both rects.
	 * @param {$i_7} rect The rect to combine with this one.
	 * @return {$i_7} The new rect encapsulating both rects.
	 */combineRect:function(rect){var thisRectMaxX=this.x+this.width;var thisRectMaxY=this.y+this.height;var thatRectMaxX=rect.x+rect.width;var thatRectMaxY=rect.y+rect.height;var x=Math.min(this.x,rect.x);var y=Math.min(this.y,rect.y);var width=Math.max(thisRectMaxX-this.x,thatRectMaxX-this.x);var height=Math.max(thisRectMaxY-this.y,thatRectMaxY-this.y);return new $i_7(x,y,width,height);},/**
	 * Combines the extents of the passed $i_7 with this rect
	 * and replaces this rect with one whose bounds encapsulate
	 * both rects.
	 * @param {$i_7} rect The rect to combine with this one.
	 */thisCombineRect:function(rect){var thisRectMaxX=this.x+this.width;var thisRectMaxY=this.y+this.height;var thatRectMaxX=rect.x+rect.width;var thatRectMaxY=rect.y+rect.height;this.x=Math.min(this.x,rect.x);this.y=Math.min(this.y,rect.y);this.width=Math.max(thisRectMaxX-this.x,thatRectMaxX-this.x);this.height=Math.max(thisRectMaxY-this.y,thatRectMaxY-this.y);},minusPoint:function(point){return new $i_7(this.x-point.x,this.y-point.y,this.width,this.height);},/**
	 * Compares this rect's dimensions with the passed rect and returns
	 * true if they are the same and false if any is different.
	 * @param {$i_7} rect
	 * @return {Boolean}
	 */compare:function(rect){return rect&&this.x===rect.x&&this.y===rect.y&&this.width===rect.width&&this.height===rect.height;},/**
	 * Returns boolean indicating if the passed x, y is
	 * inside the rectangle.
	 * @param x
	 * @param y
	 * @return {Boolean}
	 */xyInside:function(x,y){return x>=this.x&&y>this.y&&x<=this.x+this.width&&y<=this.y+this.height;},/**
	 * Returns boolean indicating if the passed point is
	 * inside the rectangle.
	 * @param {$i_5} point
	 * @return {Boolean}
	 */pointInside:function(point){return point.x>=this.x&&point.y>this.y&&point.x<=this.x+this.width&&point.y<=this.y+this.height;},/**
	 * Returns boolean indicating if the passed $i_7 is
	 * intersecting the rectangle.
	 * @param {$i_7} rect
	 * @return {Boolean}
	 */rectIntersect:function(rect){this.log('rectIntersect has been renamed to "intersects". Please update your code. rectIntersect will be removed in a later version of IGE.','warning');return this.intersects(rect);},/**
	 * Returns boolean indicating if the passed $i_7 is
	 * intersecting the rectangle.
	 * @param {$i_7} rect
	 * @return {Boolean}
	 */intersects:function(rect){if(rect){var sX1=this.x;var sY1=this.y;var sW=this.width;var sH=this.height;var dX1=rect.x;var dY1=rect.y;var dW=rect.width;var dH=rect.height;var sX2=sX1+sW;var sY2=sY1+sH;var dX2=dX1+dW;var dY2=dY1+dH;if(sX1<dX2&&sX2>dX1&&sY1<dY2&&sY2>dY1){return true;}}return false;},/**
	 * Multiplies this rect's data by the values specified
	 * and returns a new $i_7 whose values are the result.
	 * @param x1
	 * @param y1
	 * @param x2
	 * @param y2
	 * @return {*}
	 */multiply:function(x1,y1,x2,y2){return new $i_7(this.x*x1,this.y*y1,this.width*x2,this.height*y2);},/**
	 * Multiplies this rects's data by the values specified and
	 * overwrites the previous values with the result.
	 * @param x1
	 * @param y1
	 * @param x2
	 * @param y2
	 * @return {*}
	 */thisMultiply:function(x1,y1,x2,y2){this.x*=x1;this.y*=y1;this.width*=x2;this.height*=y2;return this;},/**
	 * Returns a clone of this object that is not a reference
	 * but retains the same values.
	 * @return {$i_7}
	 */clone:function(){return new $i_7(this.x,this.y,this.width,this.height);},/**
	 * Returns a string representation of the rect's x, y, width,
	 * height, converting floating point values into fixed using the
	 * passed precision parameter. If no precision is specified
	 * then the precision defaults to 2.
	 * @param {Number=} precision
	 * @return {String}
	 */toString:function(precision){if(precision===undefined){precision=2;}return`${this.x.toFixed(precision)},${this.y.toFixed(precision)},${this.width.toFixed(precision)},${this.height.toFixed(precision)}`;},/**
	 * Draws the polygon bounding lines to the passed context.
	 * @param {CanvasRenderingContext2D} ctx
	 */render:function(ctx,fill){ctx.rect(this.x,this.y,this.width,this.height);if(fill){ctx.fill();}ctx.stroke();return this;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_7;};// TODO: Clean up the variable declarations in this file so they all run on the same var call at the top of the method.
/**
 * Creates a new transformation matrix.
 */var $i_8=function(){this.matrix=[1.0,0.0,0.0,0.0,1.0,0.0,0.0,0.0,1.0];this._rotateOrigin=new $i_5(0,0,0);this._scaleOrigin=new $i_5(0,0,0);};$i_8.prototype={matrix:null,/**
	 * Transform a point by this matrix. The parameter point will be modified with the transformation values.
	 * @param {$i_5} point
	 * @return {$i_5} The passed point.
	 */transformCoord:function(point,obj){var x=point.x;var y=point.y;var tm=this.matrix;point.x=x*tm[0]+y*tm[1]+tm[2];point.y=x*tm[3]+y*tm[4]+tm[5];/* DEXCLUDE */if(isNaN(tm[0])||isNaN(tm[1])||isNaN(tm[2])||isNaN(tm[3])||isNaN(tm[4])||isNaN(tm[5])){// ige.devLog('The matrix operation produced a NaN value!');
ige.script.errorLog('The matrix operation produced a NaN value!');// ige.server.unpublish()
}/* DEXCLUDE */return point;},/**
	 * Transform a point by this matrix in inverse. The parameter point will be modified with the transformation values.
	 * @param {$i_5} point.
	 * @return {$i_5} The passed point.
	 */transformCoordInverse:function(point,obj){var x=point.x;var y=point.y;var tm=this.matrix;point.x=x*tm[0]-y*tm[1]+tm[2];point.y=x*tm[3]+y*tm[4]-tm[5];/* DEXCLUDE */if(isNaN(tm[0])||isNaN(tm[1])||isNaN(tm[2])||isNaN(tm[3])||isNaN(tm[4])||isNaN(tm[5])){// console.log('The matrix operation produced a NaN value!', 'error');
// console.trace()
}/* DEXCLUDE */return point;},transform:function(points,obj){var pointIndex;var pointCount=points.length;for(pointIndex=0;pointIndex<pointCount;pointIndex++){this.transformCoord(points[pointIndex],obj);}return points;},/**
	 * Create a new rotation matrix and set it up for the specified angle in radians.
	 * @param {Number} angle
	 * @return {$i_8} A new matrix object.
	 */_newRotate:function(angle){var m=new $i_8();m.rotateTo(angle);return m;},rotateBy:function(angle){var m=new $i_8();m.translateBy(this._rotateOrigin.x,this._rotateOrigin.y);m.rotateTo(angle);m.translateBy(-this._rotateOrigin.x,-this._rotateOrigin.y);this.multiply(m);return this;},rotateTo:function(angle){var tm=this.matrix;var c=Math.cos(angle);var s=Math.sin(angle);tm[0]=c;tm[1]=-s;tm[3]=s;tm[4]=c;/* DEXCLUDE */if(isNaN(tm[0])||isNaN(tm[1])||isNaN(tm[2])||isNaN(tm[3])||isNaN(tm[4])||isNaN(tm[5])){// invalid holdingDistance is known to cause this issue
console.log('The matrix operation produced a NaN value!',tm,ige.matrixEntityId,ige.matrixAngle);// console.trace()
}/* DEXCLUDE */return this;},/**
	 * Gets the rotation from the matrix and returns it in
	 * radians.
	 * @return {Number}
	 */rotationRadians:function(){return Math.asin(this.matrix[3]);},/**
	 * Gets the rotation from the matrix and returns it in
	 * degrees.
	 * @return {Number}
	 */rotationDegrees:function(){return Math.degrees(Math.acos(this.matrix[0]));},/**
	 * Create a scale matrix.
	 * @param {Number} x X scale magnitude.
	 * @param {Number} y Y scale magnitude.
	 *
	 * @return {$i_8} a matrix object.
	 *
	 * @static
	 */_newScale:function(x,y){var m=new $i_8();m.matrix[0]=x;m.matrix[4]=y;return m;},scaleBy:function(x,y){var m=new $i_8();m.matrix[0]=x;m.matrix[4]=y;this.multiply(m);return this;},scaleTo:function(x,y){var tm=this.matrix;// this.identity();
tm[0]=x;tm[4]=y;/* DEXCLUDE */if(isNaN(tm[0])||isNaN(tm[1])||isNaN(tm[2])||isNaN(tm[3])||isNaN(tm[4])||isNaN(tm[5])){console.log('The matrix operation produced a NaN value!','error');console.trace();}/* DEXCLUDE */return this;},/**
	 * Create a translation matrix.
	 * @param {Number} x X translation magnitude.
	 * @param {Number} y Y translation magnitude.
	 * @return {$i_8} A new matrix object.
	 */_newTranslate:function(x,y){var m=new $i_8();m.matrix[2]=x;m.matrix[5]=y;return m;},translateBy:function(x,y){var m=new $i_8();m.matrix[2]=x;m.matrix[5]=y;this.multiply(m);return this;},/**
	 * Sets this matrix as a translation matrix.
	 * @param x
	 * @param y
	 */translateTo:function(x,y){var tm=this.matrix;tm[2]=x;tm[5]=y;/* DEXCLUDE */if(isNaN(tm[0])||isNaN(tm[1])||isNaN(tm[2])||isNaN(tm[3])||isNaN(tm[4])||isNaN(tm[5])){console.log('The matrix operation produced a NaN value!','error');console.trace();}/* DEXCLUDE */return this;},/**
	 * Copy into this matrix the given matrix values.
	 * @param {$i_8} matrix
	 * @return {Object} "this".
	 */copy:function(matrix){matrix=matrix.matrix;var tmatrix=this.matrix;tmatrix[0]=matrix[0];tmatrix[1]=matrix[1];tmatrix[2]=matrix[2];tmatrix[3]=matrix[3];tmatrix[4]=matrix[4];tmatrix[5]=matrix[5];tmatrix[6]=matrix[6];tmatrix[7]=matrix[7];tmatrix[8]=matrix[8];return this;},compare:function(matrix){var thisMatrix=this.matrix;var thatMatrix=matrix.matrix;for(var i=0;i<9;i++){if(thisMatrix[i]!==thatMatrix[i]){return false;}}return true;},/**
	 * Set this matrix to the identity matrix.
	 * @return {Object} "this".
	 */identity:function(){var m=this.matrix;m[0]=1.0;m[1]=0.0;m[2]=0.0;m[3]=0.0;m[4]=1.0;m[5]=0.0;m[6]=0.0;m[7]=0.0;m[8]=1.0;return this;},/**
	 * Multiply this matrix by a given matrix.
	 * @param {$i_8} m The $i_8 to multiply the
	 * current matrix by.
	 * @return {Object} "this".
	 */multiply:function(m){var tm=this.matrix;var mm=m.matrix;var tm0=tm[0];var tm1=tm[1];var tm2=tm[2];var tm3=tm[3];var tm4=tm[4];var tm5=tm[5];var tm6=tm[6];var tm7=tm[7];var tm8=tm[8];var mm0=mm[0];var mm1=mm[1];var mm2=mm[2];var mm3=mm[3];var mm4=mm[4];var mm5=mm[5];var mm6=mm[6];var mm7=mm[7];var mm8=mm[8];tm[0]=tm0*mm0+tm1*mm3+tm2*mm6;tm[1]=tm0*mm1+tm1*mm4+tm2*mm7;tm[2]=tm0*mm2+tm1*mm5+tm2*mm8;tm[3]=tm3*mm0+tm4*mm3+tm5*mm6;tm[4]=tm3*mm1+tm4*mm4+tm5*mm7;tm[5]=tm3*mm2+tm4*mm5+tm5*mm8;tm[6]=tm6*mm0+tm7*mm3+tm8*mm6;tm[7]=tm6*mm1+tm7*mm4+tm8*mm7;tm[8]=tm6*mm2+tm7*mm5+tm8*mm8;return this;},/**
	 * Premultiply this matrix by a given matrix.
	 * @param {$i_8} m The $i_8 to premultiply the
	 * current matrix by.
	 * @return {Object} "this".
	 */premultiply:function(m){var m00=m.matrix[0]*this.matrix[0]+m.matrix[1]*this.matrix[3]+m.matrix[2]*this.matrix[6];var m01=m.matrix[0]*this.matrix[1]+m.matrix[1]*this.matrix[4]+m.matrix[2]*this.matrix[7];var m02=m.matrix[0]*this.matrix[2]+m.matrix[1]*this.matrix[5]+m.matrix[2]*this.matrix[8];var m10=m.matrix[3]*this.matrix[0]+m.matrix[4]*this.matrix[3]+m.matrix[5]*this.matrix[6];var m11=m.matrix[3]*this.matrix[1]+m.matrix[4]*this.matrix[4]+m.matrix[5]*this.matrix[7];var m12=m.matrix[3]*this.matrix[2]+m.matrix[4]*this.matrix[5]+m.matrix[5]*this.matrix[8];var m20=m.matrix[6]*this.matrix[0]+m.matrix[7]*this.matrix[3]+m.matrix[8]*this.matrix[6];var m21=m.matrix[6]*this.matrix[1]+m.matrix[7]*this.matrix[4]+m.matrix[8]*this.matrix[7];var m22=m.matrix[6]*this.matrix[2]+m.matrix[7]*this.matrix[5]+m.matrix[8]*this.matrix[8];this.matrix[0]=m00;this.matrix[1]=m01;this.matrix[2]=m02;this.matrix[3]=m10;this.matrix[4]=m11;this.matrix[5]=m12;this.matrix[6]=m20;this.matrix[7]=m21;this.matrix[8]=m22;return this;},/**
	 * Creates a new inverse matrix from this matrix.
	 * @return {$i_8} An inverse matrix.
	 */getInverse:function(){var tm=this.matrix;var m00=tm[0];var m01=tm[1];var m02=tm[2];var m10=tm[3];var m11=tm[4];var m12=tm[5];var m20=tm[6];var m21=tm[7];var m22=tm[8];var newMatrix=new $i_8();var determinant=m00*(m11*m22-m21*m12)-m10*(m01*m22-m21*m02)+m20*(m01*m12-m11*m02);if(determinant===0){return null;}var m=newMatrix.matrix;m[0]=m11*m22-m12*m21;m[1]=m02*m21-m01*m22;m[2]=m01*m12-m02*m11;m[3]=m12*m20-m10*m22;m[4]=m00*m22-m02*m20;m[5]=m02*m10-m00*m12;m[6]=m10*m21-m11*m20;m[7]=m01*m20-m00*m21;m[8]=m00*m11-m01*m10;newMatrix.multiplyScalar(1/determinant);return newMatrix;},/**
	 * Multiply this matrix by a scalar.
	 * @param scalar {number} Scalar value.
	 * @return this
	 */multiplyScalar:function(scalar){var i;for(i=0;i<9;i++){this.matrix[i]*=scalar;}return this;},/**
	 * Transforms the passed rendering context by the current matrix
	 * data using the setTransform() method so that the matrix data
	 * is set non-cumulative with the previous matrix data.
	 * @param {CanvasRenderingContext2d} ctx The rendering context to
	 * set the transform matrix for.
	 */transformRenderingContextSet:function(ctx){var m=this.matrix;ctx.setTransform(m[0],m[3],m[1],m[4],m[2],m[5]);return this;},/**
	 * Transforms the passed rendering context by the current matrix
	 * data using the transform() method so that the matrix data
	 * is set cumulative with the previous matrix data.
	 * @param {CanvasRenderingContext2d} ctx The rendering context to
	 * set the transform matrix for.
	 */transformRenderingContext:function(ctx){var m=this.matrix;ctx.transform(m[0],m[3],m[1],m[4],m[2],m[5]);return this;}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_8;};var $i_9=$i_3.extend({classId:'$i_9',componentId:'time',/**
	 * @constructor
	 * @param {Object} entity The parent object that this component is being added to.
	 * @param {Object=} options An optional object that is passed to the component when it is being initialised.
	 */init:function(entity,options){this._entity=entity;this._timers=[];this._additions=[];this._removals=[];// Add the animation behaviour to the entity
entity.addBehaviour('time',this._update);},addTimer:function(timer){if(timer){if(!this._updating){this._timers.push(timer);}else{this._additions.push(timer);}}return this;},removeTimer:function(timer){if(timer){if(!this._updating){this._timers.pull(timer);}else{this._removals.push(timer);}}return this;},_update:function(){// Get the ige tick delta and tell our timers / intervals that an update has occurred
var self=ige.time;var delta=ige._tickDelta;var arr=self._timers;var arrCount=arr.length;while(arrCount--){arr[arrCount].addTime(delta).update();}// Process removing any timers that were scheduled for removal
self._processRemovals();// Now process any additions to the timers that were scheduled to be added
self._processAdditions();return self;},_processAdditions:function(){var arr=this._additions;var arrCount=arr.length;if(arrCount){while(arrCount--){this._timers.push(arr[arrCount]);}this._additions=[];}return this;},_processRemovals:function(){var arr=this._removals;var arrCount=arr.length;if(arrCount){while(arrCount--){this._timers.pull(arr[arrCount]);}this._removals=[];}return this;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_9;};// TODO: Doc this class!
var $i_11=$i_2.extend({classId:'$i_11',componentId:'velocity',init:function(entity,options){this._entity=entity;this._velocity=new $i_5(0,0,0);this._friction=new $i_5(1,1,1);// Add the velocity behaviour to the entity
entity.addBehaviour('velocity',this._behaviour);},/**
	 * The behaviour method executed each tick.
	 * @param ctx
	 * @private
	 */_behaviour:function(ctx){if(this.velocity!=undefined)this.velocity.tick(ctx);},byAngleAndPower:function(radians,power,relative){var vel=this._velocity;var x=Math.cos(radians)*power;var y=Math.sin(radians)*power;var z=0;if(!relative){vel.x=x;vel.y=y;vel.z=z;}else{vel.x+=x;vel.y+=y;vel.z+=z;}return this._entity;},xyz:function(x,y,z,relative){var vel=this._velocity;if(!relative){vel.x=x;vel.y=y;vel.z=z;}else{vel.x+=x;vel.y+=y;vel.z+=z;}return this._entity;},x:function(x,relative){var vel=this._velocity;if(!relative){vel.x=x;}else{vel.x+=x;}return this._entity;},y:function(y,relative){var vel=this._velocity;if(!relative){vel.y=y;}else{vel.y+=y;}return this._entity;},z:function(z,relative){var vel=this._velocity;if(!relative){vel.z=y;}else{vel.z+=z;}return this._entity;},vector3:function(vector,relative){if(typeof vector.scale!=='number'){vector.scale=1;// Default to 1
}var vel=this._velocity;var x=vector.x;var y=vector.y;var z=vector.z;if(!relative){vel.x=x;vel.y=y;vel.z=z;}else{vel.x+=x;vel.y+=y;vel.z+=z;}return this._entity;},friction:function(val){var finalFriction=1-val;if(finalFriction<0){finalFriction=0;}this._friction=new $i_5(finalFriction,finalFriction,finalFriction);return this._entity;},linearForce:function(degrees,power){power/=1000;var radians=degrees*Math.PI/180;var x=Math.cos(radians)*power;var y=Math.sin(radians)*power;var z=x*y;this._linearForce=new $i_5(x,y,z);return this._entity;},linearForceXYZ:function(x,y,z){this._linearForce=new $i_5(x,y,z);return this._entity;},linearForceVector3:function(vector,power,relative){var force=this._linearForce=this._linearForce||new $i_5(0,0,0);var x=vector.x/1000;var y=vector.y/1000;var z=vector.z/1000;if(!relative){force.x=x||0;force.y=y||0;force.z=z||0;}else{force.x+=x||0;force.y+=y||0;force.z+=z||0;}return this._entity;},_applyLinearForce:function(delta){if(this._linearForce){var vel=this._velocity;vel.x+=this._linearForce.x*delta;vel.y+=this._linearForce.y*delta;vel.z+=this._linearForce.z*delta;}},_applyFriction:function(){var vel=this._velocity;var fric=this._friction;vel.x*=fric.x;vel.y*=fric.y;vel.z*=fric.z;},tick:function(ctx){var delta=ige._tickDelta;var vel=this._velocity;var x;var y;var z;if(delta){this._applyLinearForce(delta);// this._applyFriction();
x=vel.x*delta;y=vel.y*delta;z=vel.z*delta;if(x||y||z){this._entity.translateBy(x,y,z);}}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_11;};/**
 * This component is already included in the $i_102 (ige)
 * instance and is not designed for use in any other way!
 * It handles global tween processing on all tweening values.
 */var $i_12=$i_2.extend({classId:'$i_12',componentId:'tween',init:function(entity,options){this._entity=entity;this._transform=entity.transform;// Setup the array that will hold our active tweens
this._tweens=[];// Add the tween behaviour to the entity
entity.addBehaviour('tween',this.update);},/**
	 * Start tweening particular properties for the object.
	 * @param {$i_49} tween The tween to start.
	 * @return {Number} The index of the added tween or -1 on error.
	 */start:function(tween){if(tween._startTime>ige._currentTime){// The tween is scheduled for later
// Push the tween into the $i_12's _tweens array
this._tweens.push(tween);}else{// The tween should start immediately
tween._currentStep=0;// Setup the tween's step
if(this._setupStep(tween,false)){// Push the tween into the $i_12's _tweens array
this._tweens.push(tween);}}// Enable tweening on the $i_12
this.enable();// Return the tween
return tween;},_setupStep:function(tween,newTime){var targetObj=tween._targetObj;var step=tween._steps[tween._currentStep];var propertyNameAndValue;// = tween._propertyObj
var durationMs;var endTime;var easing;var propertyIndex;var targetData=[];if(step){propertyNameAndValue=step.props;}if(targetObj){// Check / fill some option defaults
if(tween._currentStep===0&&!newTime){// Because we are on step zero we can check for a start time
if(tween._startTime===undefined){tween._startTime=ige._currentTime;}}else{// We're not on step zero anymore so the new step start time
// is NOW!
tween._startTime=ige._currentTime;}durationMs=step.durationMs?step.durationMs:tween._durationMs;tween._selectedEasing=step.easing?step.easing:tween._easing;// Calculate the end time
tween._endTime=tween._startTime+durationMs;for(propertyIndex in propertyNameAndValue){if(propertyNameAndValue.hasOwnProperty(propertyIndex)){targetData.push({targetObj:targetObj,propName:propertyIndex,deltaVal:propertyNameAndValue[propertyIndex]-(step.isDelta?0:targetObj[propertyIndex]),// The diff between end and start values
oldDelta:0// Var to save the old delta in order to get the actual difference data.
});}}tween._targetData=targetData;tween._destTime=tween._endTime-tween._startTime;return tween;// Return the tween
}else{this.log(`Cannot start tweening properties of the specified object "${obj}" because it does not exist!`,'error');}},/**
	 * Removes the specified tween from the active tween list.
	 * @param {$i_49} tween The tween to stop.
	 */stop:function(tween){// Store the new tween details in the item
this._tweens.pull(tween);if(!this._tweens.length){// Disable tweening on this item as there are
// no more tweens to process
this.disable();}return this;},/**
	 * Stop all tweening for the object.
	 */stopAll:function(){// Disable tweening
this.disable();// Remove all tween details
delete this._tweens;this._tweens=[];return this;},/**
	 * Enable tweening for the object.
	 */enable:function(){// Check if the item is currently tweening
if(!this._tweening){// Set the item to tweening
this._tweening=true;}return this;},/**
	 * Disable tweening for the object.
	 */disable:function(){// Check if the item is currently tweening
if(this._tweening){// Set the item to not tweening
this._tweening=false;}return this;},/**
	 * Process tweening for the object.
	 */update:function(ctx){var thisTween=this.tween;if(thisTween._tweens&&thisTween._tweens.length){var currentTime=ige._tickStart;var tweens=thisTween._tweens;var tweenCount=tweens.length;var tween;var deltaTime;var destTime;var easing;var item;var targetProp;var targetPropVal;var targets;var targetIndex;var stepIndex;var stopped;var currentDelta;// Loop the item's tweens
while(tweenCount--){tween=tweens[tweenCount];stopped=false;// Check if we should be starting this tween yet
if(tween._started||currentTime>=tween._startTime){if(!tween._started){// Check if the tween's step is -1 indicating no step
// data has been set up yet
if(tween._currentStep===-1){// Setup the tween step now
tween._currentStep=0;thisTween._setupStep(tween,false);}// Check if we have a beforeTween callback to fire
if(typeof tween._beforeTween==='function'){// Fire the beforeTween callback
tween._beforeTween(tween);// Delete the callback so we don't store it any longer
delete tween._beforeTween;}// Check if we have a beforeStep callback to fire
if(typeof tween._beforeStep==='function'){// Fire the beforeStep callback
if(tween._stepDirection){stepIndex=tween._steps.length-(tween._currentStep+1);}else{stepIndex=tween._currentStep;}tween._beforeStep(tween,stepIndex);}tween._started=true;}deltaTime=currentTime-tween._startTime;// Delta from start time to current time
destTime=tween._destTime;easing=tween._selectedEasing;// Check if the tween has reached it's destination based upon
// the current time
if(deltaTime>=destTime){// The tween time indicates the tween has ended so set to
// the ending value
targets=tween._targetData;for(targetIndex in targets){if(targets.hasOwnProperty(targetIndex)){item=targets[targetIndex];targetProp=item.targetObj;targetPropVal=targetProp[item.propName];// Check if the destination time is not zero
// because otherwise the easing method will provide
// a divide by zero error resulting in a NaN value
if(destTime!==0){// Add the delta amount to destination
currentDelta=thisTween.easing[easing](destTime,item.deltaVal,destTime);}else{currentDelta=item.deltaVal;}targetPropVal+=currentDelta-item.oldDelta;// Round the value to correct floating point operation imprecision
var roundingPrecision=Math.pow(10,15-targetPropVal.toFixed(0).toString().length);targetProp[item.propName]=Math.round(targetPropVal*roundingPrecision)/roundingPrecision;}}// Check if we have a afterStep callback to fire
if(typeof tween._afterStep==='function'){// Fire the afterStep
if(tween._stepDirection){stepIndex=tween._steps.length-(tween._currentStep+1);}else{stepIndex=tween._currentStep;}tween._afterStep(tween,stepIndex);}if(tween._steps.length===tween._currentStep+1){// The tween has ended, is the tween repeat mode enabled?
if(tween._repeatMode){// We have a repeat mode, lets check for a count
if(tween._repeatCount!==-1){// Check if the repeat count has reached the
// number of repeats we wanted
tween._repeatedCount++;if(tween._repeatCount===tween._repeatedCount){// The tween has ended
stopped=true;}}if(!stopped){// Work out what mode we're running on
if(tween._repeatMode===1){tween._currentStep=0;}if(tween._repeatMode===2){// We are on "reverse loop" mode so now
// reverse the tween's steps and then
// start from step zero
tween._stepDirection=!tween._stepDirection;tween._steps.reverse();tween._currentStep=1;}// Check if we have a stepsComplete callback to fire
if(typeof tween._stepsComplete==='function'){// Fire the stepsComplete callback
tween._stepsComplete(tween,tween._currentStep);}// Check if we have a beforeStep callback to fire
if(typeof tween._beforeStep==='function'){// Fire the beforeStep callback
if(tween._stepDirection){stepIndex=tween._steps.length-(tween._currentStep+1);}else{stepIndex=tween._currentStep;}tween._beforeStep(tween,stepIndex);}thisTween._setupStep(tween,true);}}else{stopped=true;}if(stopped){// Now stop tweening this tween
tween.stop();// If there is a callback, call it
if(typeof tween._afterTween==='function'){// Fire the afterTween callback
tween._afterTween(tween);// Delete the callback so we don't store it any longer
delete tween._afterTween;}}}else{// Start the next step
tween._currentStep++;// Check if we have a beforeStep callback to fire
if(typeof tween._beforeStep==='function'){// Fire the beforeStep callback
if(tween._stepDirection){stepIndex=tween._steps.length-(tween._currentStep+1);}else{stepIndex=tween._currentStep;}tween._beforeStep(tween,stepIndex);}thisTween._setupStep(tween,true);}if(typeof tween._afterChange==='function'){tween._afterChange(tween,stepIndex);}}else{// The tween is still active, process the tween by passing it's details
// to the selected easing method
targets=tween._targetData;for(targetIndex in targets){if(targets.hasOwnProperty(targetIndex)){item=targets[targetIndex];var currentDelta=thisTween.easing[easing](deltaTime,item.deltaVal,destTime);item.targetObj[item.propName]+=currentDelta-item.oldDelta;item.oldDelta=currentDelta;}}if(typeof tween._afterChange==='function'){tween._afterChange(tween,stepIndex);}}}}}},/** tweenEasing - Contains all the tween easing functions. {
		category:"property",
		type:"object",
	} **/easing:{// Easing equations converted from AS to JS from original source at
// http://robertpenner.com/easing/
none:function(t,c,d){return c*t/d;},inQuad:function(t,c,d){return c*(t/=d)*t;},outQuad:function(t,c,d){return-c*(t/=d)*(t-2);},inOutQuad:function(t,c,d){if((t/=d/2)<1){return c/2*t*t;}return-c/2*(--t*(t-2)-1);},inCubic:function(t,c,d){return c*(t/=d)*t*t;},outCubic:function(t,c,d){return c*((t=t/d-1)*t*t+1);},inOutCubic:function(t,c,d){if((t/=d/2)<1){return c/2*t*t*t;}return c/2*((t-=2)*t*t+2);},outInCubic:function(t,c,d){if(t<d/2){return this.outCubic(t*2,c/2,d);}return this.inCubic(t*2-d,c/2,c/2,d);},inQuart:function(t,c,d){return c*(t/=d)*t*t*t;},outQuart:function(t,c,d){return-c*((t=t/d-1)*t*t*t-1);},inOutQuart:function(t,c,d){if((t/=d/2)<1){return c/2*t*t*t*t;}return-c/2*((t-=2)*t*t*t-2);},outInQuart:function(t,c,d){if(t<d/2){return this.outQuart(t*2,c/2,d);}return this.inQuart(t*2-d,c/2,c/2,d);},inQuint:function(t,c,d){return c*(t/=d)*t*t*t*t;},outQuint:function(t,c,d){return c*((t=t/d-1)*t*t*t*t+1);},inOutQuint:function(t,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t;}return c/2*((t-=2)*t*t*t*t+2);},outInQuint:function(t,c,d){if(t<d/2){return this.outQuint(t*2,c/2,d);}return this.inQuint(t*2-d,c/2,c/2,d);},inSine:function(t,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c;},outSine:function(t,c,d){return c*Math.sin(t/d*(Math.PI/2));},inOutSine:function(t,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1);},outInSine:function(t,c,d){if(t<d/2){return this.outSine(t*2,c/2,d);}return this.inSine(t*2-d,c/2,c/2,d);},inExpo:function(t,c,d){return t===0?0:c*Math.pow(2,10*(t/d-1))-c*0.001;},outExpo:function(t,c,d){return t===d?c:c*1.001*(-Math.pow(2,-10*t/d)+1);},inOutExpo:function(t,c,d){if(t===0){return 0;}if(t===d){return c;}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))-c*0.0005;}return c/2*1.0005*(-Math.pow(2,-10*--t)+2);},outInExpo:function(t,c,d){if(t<d/2){return this.outExpo(t*2,c/2,d);}return this.inExpo(t*2-d,c/2,c/2,d);},inCirc:function(t,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1);},outCirc:function(t,c,d){return c*Math.sqrt(1-(t=t/d-1)*t);},inOutCirc:function(t,c,d){if((t/=d/2)<1){return-c/2*(Math.sqrt(1-t*t)-1);}return c/2*(Math.sqrt(1-(t-=2)*t)+1);},outInCirc:function(t,c,d){if(t<d/2){return this.outCirc(t*2,c/2,d);}return this.inCirc(t*2-d,c/2,c/2,d);},inElastic:function(t,c,d,a,p){var s;if(t===0){return 0;}if((t/=d)===1){return c;}if(!p){p=d*0.3;}if(!a||a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p));},outElastic:function(t,c,d,a,p){var s;if(t===0){return 0;}if((t/=d)===1){return c;}if(!p){p=d*0.3;}if(!a||a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c;},inOutElastic:function(t,c,d,a,p){var s;if(t===0){return 0;}if((t/=d/2)===2){return c;}if(!p){p=d*(0.3*1.5);}if(!a||a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}if(t<1){return-0.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p));}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*0.5+c;},outInElastic:function(t,c,d,a,p){if(t<d/2){return this.outElastic(t*2,c/2,d,a,p);}return this.inElastic(t*2-d,c/2,c/2,d,a,p);},inBack:function(t,c,d,s){if(s===undefined){s=1.70158;}return c*(t/=d)*t*((s+1)*t-s);},outBack:function(t,c,d,s){if(s===undefined){s=1.70158;}return c*((t=t/d-1)*t*((s+1)*t+s)+1);},inOutBack:function(t,c,d,s){if(s===undefined){s=1.70158;}if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s));}return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2);},outInBack:function(t,c,d,s){if(t<d/2){return this.outBack(t*2,c/2,d,s);}return this.inBack(t*2-d,c/2,c/2,d,s);},inBounce:function(t,c,d){return c-this.outBounce(d-t,0,c,d);},outBounce:function(t,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t);}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+0.75);}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+0.9375);}else{return c*(7.5625*(t-=2.625/2.75)*t+0.984375);}},inOutBounce:function(t,c,d){if(t<d/2){return this.inBounce(t*2,0,c,d)*0.5;}else{return this.outBounce(t*2-d,0,c,d)*0.5+c*0.5;}},outInBounce:function(t,c,d){if(t<d/2){return this.outBounce(t*2,c/2,d);}return this.inBounce(t*2-d,c/2,c/2,d);}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_12;};var $i_14=$i_3.extend({classId:'$i_14',componentId:'input',init:function(){// Setup the input objects to hold the current input state
var self=this;this._eventQueue=[];this._eventControl={_cancelled:false,stopPropagation:function(){this._cancelled=true;}};this.lastMousePosition={x:undefined,y:undefined};this.lastEvent=undefined;this.tick();this.mouse={// Virtual codes
dblClick:-302,down:-301,up:-300,move:-259,wheel:-258,wheelUp:-257,wheelDown:-256,x:-255,y:-254,button1:-253,button2:-252,button3:-251};this.pad1={// Virtual codes
button1:-250,button2:-249,button3:-248,button4:-247,button5:-246,button6:-245,button7:-244,button8:-243,button9:-242,button10:-241,button11:-240,button12:-239,button13:-238,button14:-237,button15:-236,button16:-235,button17:-234,button18:-233,button19:-232,button20:-231,stick1:-230,stick2:-229,stick1Up:-228,stick1Down:-227,stick1Left:-226,stick1Right:-225,stick2Up:-224,stick2Down:-223,stick2Left:-222,stick2Right:-221};this.pad2={// Virtual codes
button1:-220,button2:-219,button3:-218,button4:-217,button5:-216,button6:-215,button7:-214,button8:-213,button9:-212,button10:-211,button11:-210,button12:-209,button13:-208,button14:-207,button15:-206,button16:-205,button17:-204,button18:-203,button19:-202,button20:-201,stick1:-200,stick2:-199,stick1Up:-198,stick1Down:-197,stick1Left:-196,stick1Right:-195,stick2Up:-194,stick2Down:-193,stick2Left:-192,stick2Right:-191};// Keycodes from http://www.asciitable.com/
// and general console.log efforts :)
this.key={// Virtual codes
shift:-3,ctrl:-2,alt:-1,// Read codes
backspace:8,tab:9,enter:13,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,del:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90};this._controlMap=[];this._state=[];this.lastMovedAt=0;// Set default values for the mouse position
this._state[this.mouse.x]=0;this._state[this.mouse.y]=0;// check if any key is currently down.
// if (ige.isClient) {
// 	setInterval(function () {
// 	}, 100);
// }
},processInputOnEveryFps:function(){var self=this;for(var i in self._state){if(self._state[i]){self._updateMouseData(self.lastEvent);break;}}},debug:function(val){if(val!==undefined){this._debug=val;return this;}return this._debug;},/**
	 * Sets up the event listeners on the main window and front
	 * buffer DOM objects.
	 * @private
	 */setupListeners:function(canvas){this.log('Setting up input event listeners...');this._canvas=canvas;// Setup the event listeners
var self=this;// Define event functions and keep references for later removal
this._evRef={mousedown:function(event){event.igeType='mouse';self._rationalise(event,undefined,true);self._mouseDown(event);},mouseup:function(event){event.igeType='mouse';self._rationalise(event);self._mouseUp(event);},mousemove:function(event){event.igeType='mouse';self._rationalise(event);self._mouseMove(event);},mousewheel:function(event){event.igeType='mouse';self._rationalise(event);self._mouseWheel(event);},touchmove:function(event){event.igeType='touch';self._rationalise(event,true);self._mouseMove(event);},touchstart:function(event){event.igeType='touch';self._rationalise(event,true);self._mouseDown(event);},touchend:function(event){event.igeType='touch';self._rationalise(event,true);self._mouseUp(event);},contextmenu:function(event){event.preventDefault();event.igeType='mouse';self._rationalise(event);self._contextMenu(event);},keydown:function(event){event.igeType='key';self._rationalise(event);self._keyDown(event);},keyup:function(event){event.igeType='key';self._rationalise(event);self._keyUp(event);}};// Listen for mouse events
window.addEventListener('mousedown',this._evRef.mousedown,false);window.addEventListener('mouseup',this._evRef.mouseup,false);this._canvas.addEventListener('mousemove',this._evRef.mousemove,false);this._canvas.addEventListener('mousewheel',this._evRef.mousewheel,false);// Touch events
this._canvas.addEventListener('touchmove',this._evRef.touchmove,false);this._canvas.addEventListener('touchstart',this._evRef.touchstart,false);this._canvas.addEventListener('touchend',this._evRef.touchend,false);// Kill the context menu on right-click, urgh!
this._canvas.addEventListener('contextmenu',this._evRef.contextmenu,false);// Listen for keyboard events
window.addEventListener('keydown',this._evRef.keydown,false);window.addEventListener('keyup',this._evRef.keyup,false);},destroyListeners:function(){this.log('Removing input event listeners...');// Remove the event listeners
var canvas=this._canvas;// Listen for mouse events
this._canvas.removeEventListener('mousedown',this._evRef.mousedown,false);this._canvas.removeEventListener('mouseup',this._evRef.mouseup,false);this._canvas.removeEventListener('mousemove',this._evRef.mousemove,false);this._canvas.removeEventListener('mousewheel',this._evRef.mousewheel,false);// Touch events
this._canvas.removeEventListener('touchmove',this._evRef.touchmove,false);this._canvas.removeEventListener('touchstart',this._evRef.touchstart,false);this._canvas.removeEventListener('touchend',this._evRef.touchend,false);// Kill the context menu on right-click, urgh!
this._canvas.removeEventListener('contextmenu',this._evRef.contextmenu,false);// Listen for keyboard events
window.removeEventListener('keydown',this._evRef.keydown,false);window.removeEventListener('keyup',this._evRef.keyup,false);},/**
	 * Fires an input event that didn't occur on the main canvas, as if it had
	 * occurred on the main canvas, allowing you to pass through events like
	 * mousedown and mouseup that occurred elsewhere on the DOM but might be
	 * useful for the engine to be aware of, such as if you are dragging an entity
	 * and then the mouse goes off-canvas and the button is released.
	 * @param {String} eventName The lowercase name of the event to fire e.g. mousedown.
	 * @param {Object} eventObj The event object that was passed by the DOM.
	 */fireManualEvent:function(eventName,eventObj){if(eventName&&eventObj){if(this._evRef[eventName]){this._evRef[eventName](eventObj);}else{this.log(`Cannot fire manual event "${eventName}" because no listener exists in the engine for this event type!`,'warning');}}else{this.log('Cannot fire manual event because both eventName and eventObj params are required.','warning');}},/**
	 * Sets igeX and igeY properties in the event object that
	 * can be relied on to provide the x, y co-ordinates of the
	 * mouse event including the canvas offset.
	 * @param {Event} event The event object.
	 * @param {Boolean} touch If the event was a touch event or
	 * not.
	 * @private
	 */_rationalise:function(event,touch,debug){// Check if we want to prevent default behaviour
if(event.igeType==='key'){if(event.keyCode===8){// Backspace
// Check if the event occurred on the body
var elem=event.srcElement||event.target;if(elem.tagName.toLowerCase()==='body'){// The event occurred on our body element so prevent
// default behaviour. This allows other elements on
// the page to retain focus such as text boxes etc
// and allows them to behave normally.
event.preventDefault();}}}if(event.igeType==='touch'){event.preventDefault();}if(touch){event.button=0;// Emulate left mouse button
// Handle touch changed
if(event.changedTouches&&event.changedTouches.length){event.igePageX=event.changedTouches[0].pageX;event.igePageY=event.changedTouches[0].pageY;}}else{event.igePageX=event.pageX;event.igePageY=event.pageY;}event.igeX=event.igePageX-ige._canvasPosition().left;event.igeY=event.igePageY-ige._canvasPosition().top;this.emit('inputEvent',event);},/**
	 * Emits the "mouseDown" event.
	 * @param event
	 * @private
	 */_mouseDown:function(event){if(this._debug){console.log('Mouse Down',event);}// Update the mouse position within the viewports
this._updateMouseData(event);if($('#chat-message-input').css('display')==='block'){$('#chat-message-input').css('display','none');}var mx=event.igeX-ige._bounds2d.x2;var my=event.igeY-ige._bounds2d.y2;var self=this;if(event.button===0){this._state[this.mouse.button1]=true;}if(event.button===1){this._state[this.mouse.button2]=true;}if(event.button===2){this._state[this.mouse.button3]=true;}this.mouseDown=event;if(!self.emit('preMouseDown',[event,mx,my,event.button+1])){this.queueEvent(this,function(){self.emit('mouseDown',[event,mx,my,event.button+1]);});}},/**
	 * Emits the "mouseUp" event.
	 * @param event
	 * @private
	 */_mouseUp:function(event){if(this._debug){console.log('Mouse Up',event);}// Update the mouse position within the viewports
this._updateMouseData(event);var mx=event.igeX-ige._bounds2d.x2;var my=event.igeY-ige._bounds2d.y2;var self=this;if(event.button===0){this._state[this.mouse.button1]=false;}if(event.button===1){this._state[this.mouse.button2]=false;}if(event.button===2){this._state[this.mouse.button3]=false;}this.mouseUp=event;if(!self.emit('preMouseUp',[event,mx,my,event.button+1])){this.queueEvent(this,function(){self.emit('mouseUp',[event,mx,my,event.button+1]);});}},_contextMenu:function(event){if(this._debug){console.log('Context Menu',event);}// Update the mouse position within the viewports
this._updateMouseData(event);var mx=event.igeX-ige._bounds2d.x2;var my=event.igeY-ige._bounds2d.y2;var self=this;if(event.button===0){this._state[this.mouse.button1]=false;}if(event.button===1){this._state[this.mouse.button2]=false;}// sure we're hiding the context menu when right-click is clicked, but why the hell are we setting button pressed as false again?!
// if (event.button === 2) {
// 	this._state[this.mouse.button3] = false;
// }
this.contextMenu=event;if(!self.emit('preContextMenu',[event,mx,my,event.button+1])){this.queueEvent(this,function(){self.emit('contextMenu',[event,mx,my,event.button+1]);});}},/**
	 * Emits the "mouseMove" event.
	 * @param event
	 * @private
	 */_mouseMove:function(event){// Update the mouse position within the viewports
ige._mouseOverVp=this._updateMouseData(event);// ige.client.mouseEvent = event;
// var mx = event.igeX - ige._bounds2d.x2,
// 	my = event.igeY - ige._bounds2d.y2,
var self=this;// this._state[this.mouse.x] = mx;
// this._state[this.mouse.y] = my;
self.mouseMove=event;ige.client.mouseMove=event;if(!self.emit('preMouseMove',[event,event.igeX,event.igeY,event.button+1])){this.queueEvent(this,function(){self.emit('mouseMove',[event,event.igeX,event.igeY,event.button+1]);});}},/**
	 * Emits the "mouseWheel" event.
	 * @param event
	 * @private
	 */_mouseWheel:function(event){// Update the mouse position within the viewports
this._updateMouseData(event);var mx=event.igeX-ige._bounds2d.x2;var my=event.igeY-ige._bounds2d.y2;var self=this;this._state[this.mouse.wheel]=event.wheelDelta;if(event.wheelDelta>0){this._state[this.mouse.wheelUp]=true;}else{this._state[this.mouse.wheelDown]=true;}this.mouseWheel=event;if(!self.emit('preMouseWheel',[event,mx,my,event.button+1])){this.queueEvent(this,function(){self.emit('mouseWheel',[event,mx,my,event.button+1]);});}},/**
	 * Emits the "keyDown" event.
	 * @param event
	 * @private
	 */_keyDown:function(event){var self=this;this._updateMouseData(event);this._chatHandler(event);if(this._state[event.keyCode]==false){// reset streamed target position & existing force when key is pressed
if(ige.game.data.defaultData&&ige.client.selectedUnit){this.lastMovedAt=ige.currentTime();}}this._state[event.keyCode]=true;if(this._debug){console.log('Key Down',event);}if(!self.emit('preKeyDown',[event,event.keyCode])){this.queueEvent(this,function(){self.emit('keyDown',[event,event.keyCode]);});}},_chatHandler:function(e){var isChatInputHidden=$('#chat-message-input').css('display')==='none';if(e.keyCode===13){// ignore enter click if modal is open because it was pressed to skip text
var isModalOpen=$('.modal').hasClass('show');// ignore enter if menu is visible
var isMenuVisible=$('#menu-wrapper').is(':visible');if(isChatInputHidden&&!isModalOpen&&!isMenuVisible){// if (ige.client.myPlayer && ige.client.myPlayer._stats.email) {
$('#chat-message-input').show();setTimeout(function(){$('#message').focus();},0);// }
// else {
// 	$('#enter-email-modal').modal({
// 		show: true,
// 		keyboard: true
// 	});
// }
}else if(!isChatInputHidden&&!isModalOpen){if($('#message').is(':focus')){ige.chat.sendChatMessage();}}else if($('#player-input-field').is(':focus')){$('button#player-input-submit').click();}}else if(e.keyCode===27&&!isChatInputHidden){$('#chat-message-input').hide();}},/**
	 * Emits the "keyUp" event.
	 * @param event
	 * @private
	 */_keyUp:function(event){var self=this;this._updateMouseData(event);if(this._state[event.keyCode]==true){// reset streamed target position & existing force when key is pressed
if(ige.game.data.defaultData&&ige.client.selectedUnit){this.lastMovedAt=ige.currentTime();}}this._state[event.keyCode]=false;if(this._debug){console.log('Key Up',event);}if(!self.emit('preKeyUp',[event,event.keyCode])){this.queueEvent(this,function(){self.emit('keyUp',[event,event.keyCode]);});}},/**
	 * Loops the mounted viewports and updates their respective mouse
	 * co-ordinates so that mouse events can work out where on a viewport
	 * they occurred.
	 *
	 * @param event
	 * @return {*}
	 * @private
	 */_updateMouseData:function(event){if(!event)return;this.lastEvent=event;// Loop the viewports and check if the mouse is inside
var resolvedCoordinate={};if(!isNaN(event.igeX)||!isNaN(event.igeY)){this.lastMousePosition.x=event.igeX;this.lastMousePosition.y=event.igeY;resolvedCoordinate.x=event.igeX;resolvedCoordinate.y=event.igeY;}else{resolvedCoordinate.x=this.lastMousePosition.x;resolvedCoordinate.y=this.lastMousePosition.y;}var arr=ige._children;var arrCount=arr.length;var vp;var vpUpdated;// low resolution has half bound as compared to high quality bounds so multiply bound by 2
if(ige.client.resolutionQuality=='low'){var mx=resolvedCoordinate.x-ige._bounds2d.x2*2-ige._translate.x;var my=resolvedCoordinate.y-ige._bounds2d.y2*2-ige._translate.y;}else{var mx=resolvedCoordinate.x-ige._bounds2d.x2-ige._translate.x;var my=resolvedCoordinate.y-ige._bounds2d.y2-ige._translate.y;}ige._mouseAbsoluteTranslation=[event.clientX,event.clientY];ige._mousePos.x=mx;ige._mousePos.y=my;// while (arrCount--) {
// 	vp = arr[arr.length - (arrCount + 1)];
// 	// Check if the mouse is inside this viewport's bounds
// 	// TODO: Update this code to take into account viewport rotation and camera rotation
// 	if (ige.client.resolutionQuality != 'low' && mx > vp._translate.x - vp._bounds2d.x / 2 && mx < vp._translate.x + vp._bounds2d.x / 2) {
// 		if (my > vp._translate.y - vp._bounds2d.y / 2 && my < vp._translate.y + vp._bounds2d.y / 2) {
// 			// Mouse is inside this viewport
// 			vp._mousePos = new $i_5(
// 				Math.floor((mx - vp._translate.x) / vp.camera._scale.x + vp.camera._translate.x),
// 				Math.floor((my - vp._translate.y) / vp.camera._scale.y + vp.camera._translate.y),
// 				0
// 			);
// 			vpUpdated = vp;
// 			// Record the viewport that this event occurred on in the
// 			// event object
// 			event.igeViewport = vp;
// 			break;
// 		}
// 	} else if (vp.id() === 'vp1' && ige.client.resolutionQuality == 'low') {
// 		vp._mousePos = new $i_5(
// 			Math.floor((mx - vp._translate.x) / vp.camera._scale.x + vp.camera._translate.x),
// 			Math.floor((my - vp._translate.y) / vp.camera._scale.y + vp.camera._translate.y),
// 			0
// 		);
// 		vpUpdated = vp;
// 		// Record the viewport that this event occurred on in the
// 		// event object
// 		event.igeViewport = vp;
// 		break;
// 	}
// }
return vpUpdated;},/**
	 * Defines an action that will be emitted when the specified event type
	 * occurs.
	 * @param actionName
	 * @param eventCode
	 */mapAction:function(actionName,eventCode){this._controlMap[actionName]=eventCode;},/**
	 * Returns the passed action's input state value.
	 * @param actionName
	 */actionVal:function(actionName){return this._state[this._controlMap[actionName]];},/**
	 * Returns true if the passed action's input is pressed or it's state
	 * is not zero.
	 * @param actionName
	 */actionState:function(actionName){var val=this._state[this._controlMap[actionName]];return!!val;// "Not not" to convert to boolean true/false
},/**
	 * Returns an input's current value.
	 * @param actionName
	 * @return {*}
	 */val:function(inputId){return this._state[inputId];},/**
	 * Returns an input's current state as a boolean.
	 * @param stateId
	 * @return {Boolean}
	 */state:function(inputId){return!!this._state[inputId];},/**
	 * Stops further event propagation for this tick.
	 * @return {*}
	 */stopPropagation:function(){this._eventControl._cancelled=true;return this;},/**
	 * Adds an event method to the eventQueue array. The array is
	 * processed during each tick after the scenegraph has been
	 * rendered.
	 * @param context
	 * @param ev
	 */queueEvent:function(context,ev,data){if(ev!==undefined){this._eventQueue.push([context,ev,data]);}return this;},/**
	 * Called by the engine after ALL other tick methods have processed.
	 * Call originates in $i_102.js. Allows us to reset any flags etc.
	 */tick:function(){// If we have an event queue, process it
var arr=this._eventQueue;var arrCount=arr.length;var evc=this._eventControl;while(arrCount--){arr[arrCount][1].apply(arr[arrCount][0],[evc,arr[arrCount][2]]);if(evc._cancelled){// The last event queue method stopped propagation so cancel all further
// event processing (the last event took control of the input)
break;}}// Reset all the flags and variables for the next tick
this._eventQueue=[];this._eventControl._cancelled=false;this.dblClick=false;// TODO: Add double-click event handling
this.mouseMove=false;this.mouseDown=false;this.mouseUp=false;this.mouseWheel=false;},/**
	 * Emit an event by name. Overrides the $i_3 emit method and
	 * checks for propagation stopped by calling ige.input.stopPropagation().
	 * @param {Object} eventName The name of the event to emit.
	 * @param {Object || Array} args The arguments to send to any listening methods.
	 * If you are sending multiple arguments, use an array containing each argument.
	 * @return {Number}
	 */emit:function(eventName,args){if(this._eventListeners){// Check if the event has any listeners
if(this._eventListeners[eventName]){// Fire the listeners for this event
var eventCount=this._eventListeners[eventName].length;var eventCount2=this._eventListeners[eventName].length-1;var evc=this._eventControl;var finalArgs;var i;var cancelFlag;var eventIndex;var tempEvt;var retVal;// If there are some events, ensure that the args is ready to be used
if(eventCount){finalArgs=[];if(typeof args==='object'&&args!==null&&args[0]!==null){for(i in args){if(args.hasOwnProperty(i)){finalArgs[i]=args[i];}}}else{finalArgs=[args];}// Loop and emit!
cancelFlag=false;this._eventListeners._processing=true;while(eventCount--){if(evc._cancelled){// The stopPropagation() method was called, cancel all other event calls
break;}eventIndex=eventCount2-eventCount;tempEvt=this._eventListeners[eventName][eventIndex];// If the sendEventName flag is set, overwrite the arguments with the event name
if(tempEvt.sendEventName){finalArgs=[eventName];}// Call the callback
retVal=tempEvt.call.apply(tempEvt.context||this,finalArgs);// If the retVal === true then store the cancel flag and return to the emitting method
if(retVal===true||evc._cancelled===true){// The receiver method asked us to send a cancel request back to the emitter
cancelFlag=true;}// Check if we should now cancel the event
if(tempEvt.oneShot){// The event has a oneShot flag so since we have fired the event,
// lets cancel the listener now
this.off(eventName,tempEvt);}}this._eventListeners._processing=false;// Now process any event removal
this._processRemovals();if(cancelFlag){return 1;}}}}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_14;};/**
 * Loads slightly modified Tiled-format json map data into the Isogenic Engine.
 */var $i_18=$i_2.extend({classId:'$i_18',componentId:'tiled',/**
	 * @constructor
	 * @param entity
	 * @param options
	 */init:function(entity,options){this._entity=entity;this._options=options;},/**
	 * Loads a .js Tiled json-format file and converts to IGE format,
	 * then calls the callback with the newly created scene and the
	 * various layers as $i_50Map instances.
	 * @param url
	 * @param callback
	 */loadJson:function(url,callback){var self=this;var scriptElem;if(typeof url==='string'){if(ige.isClient){scriptElem=document.createElement('script');scriptElem.src=url;scriptElem.onload=function(){self.log('Tiled data loaded, processing...');self._processData(tiled,callback);};document.getElementsByTagName('head')[0].appendChild(scriptElem);}else{$i_18.prototype.log('URL-based Tiled data is only available client-side. If you want to load Tiled map data on the server please include the map file in your ServerConfig.js file and then specify the map\'s data object instead of the URL.','error');}}else{self._processData(url,callback);}},_processData:function(data,callback){if(ige.isServer&&(data==undefined||data.layers==undefined)){$i_18.prototype.log('layer doesn\'t exist. unpublishing...');ige.server.unpublish('$i_18#51');}var mapClass=ige.isServer===true?$i_63:$i_50Map;var mapWidth=data.width;var mapHeight=data.height;var layerArray=data.layers;var layerCount=layerArray?layerArray.length:0;var layer;var layerType;var layerData;var layerDataCount;var maps=[];var layersById={};var tileSetArray=data.tilesets;var tileSetCount=tileSetArray?tileSetArray.length:0;var tileSetItem;var tileSetsTotal=tileSetCount;var tileSetsLoaded=0;var textureCellLookup=[];var currentTexture;var currentCell;var onLoadFunc;var image;var textures=[];var allTexturesLoadedFunc;var i;var k;var x;var y;var z;var ent;if(ige.isClient){ige.layersById=layersById;}// Define the function to call when all textures have finished loading
allTexturesLoadedFunc=function(){// Create a map for each layer
for(i=0;i<layerCount;i++){layer=layerArray[i];layerType=layer.type;// Check if the layer is a tile layer or an object layer
if(layerType==='tilelayer'){layerData=layer.data;$i_18.prototype.log(`setting ${layer.name} to depth ${i}`);maps[i]=new mapClass(data.tilewidth,data.tileheight);if(typeof maps[i].tileWidth=='function'){maps[i].tileWidth(data.tilewidth).tileHeight(data.tilewidth).depth(i);}else{$i_18.prototype.log('ERROR while loading map. Chris might have fixed this');ige.server.unpublish('$i_18#109');return;}maps[i].type=layerType;maps[i].name=layer.name;// Check if the layer should be isometric mounts enabled
if(data.orientation==='isometric'){maps[i].isometricMounts(true);}layersById[layer.name]=maps[i];tileSetCount=tileSetArray.length;if(ige.isClient){for(k=0;k<tileSetCount;k++){maps[i].addTexture(textures[k]);}}// Loop through the layer data and paint the tiles
layerDataCount=layerData.length;for(y=0;y<mapHeight;y++){for(x=0;x<mapWidth;x++){z=x+y*mapWidth;if(layerData[z]>0&&layerData[z]!==2147483712){maps[i].occupyTile(x,y,1,1,layerData[z]);}}}}if(layerType==='objectgroup'){maps[i]=layer;layersById[layer.name]=maps[i];}}callback(maps,layersById);};if(ige.isClient){onLoadFunc=function(textures,tileSetCount,tileSetItem){return function(){var i,cc;var imageUrl=tileSetItem.image;var scaleFactor=ige.scaleMapDetails.scaleFactor;if(imageUrl.includes('tilesheet')||tileSetCount===0){tileSetItem.tilewidth=ige.scaleMapDetails.originalTileWidth;tileSetItem.tileheight=ige.scaleMapDetails.originalTileHeight;}var cs=new $i_51(imageUrl,this.width*scaleFactor.x/tileSetItem.tilewidth,this.height*scaleFactor.y/tileSetItem.tileheight,ige.scaleMapDetails.shouldScaleTilesheet).id(tileSetItem.name).on('loaded',function(){if(ige.scaleMapDetails.shouldScaleTilesheet&&(imageUrl.includes('tilesheet')||tileSetCount===0)){this.resize(this._sizeX*scaleFactor.x,this._sizeY*scaleFactor.y);}cc=this.cellCount();this._tiledStartingId=tileSetItem.firstgid;// Fill the lookup array
for(i=0;i<cc;i++){textureCellLookup[this._tiledStartingId+i]=this;}textures.push(this);tileSetsLoaded++;if(tileSetsLoaded===tileSetsTotal){// All textures loaded, fire processing function
allTexturesLoadedFunc();}});};};// Load the tile sets as textures
while(tileSetCount--){// Load the image into memory first so we can read the total width and height
image=new Image();tileSetItem=tileSetArray[tileSetCount];image.onload=onLoadFunc(textures,tileSetCount,tileSetItem);image.src=tileSetItem.image;}}else{// We're on the server so no textures are actually loaded
allTexturesLoadedFunc();}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_18;};var $i_19=$i_2.extend({classId:'$i_19',componentId:'ui',init:function(entity,options){var self=this;this._entity=entity;this._options=options;this._focus=null;// The element that currently has focus
this._caret=null;// The caret position within the focused element
this._register=[];this._styles={};this._elementsByStyle={};ige.input.on('keyDown',function(event){self._keyDown(event);});},/**
	 * Get / set a style by name.
	 * @param {String} name The unique name of the style.
	 * @param {Object=} data The style properties and values to assign to the
	 * style.
	 * @returns {*}
	 */style:function(name,data){if(name!==undefined){if(data!==undefined){// Set the data against the name, update any elements using the style
this._styles[name]=data;return this;}// Get the data and return
return this._styles[name];}return this;},/**
	 * Registers a UI element with the UI manager.
	 * @param elem
	 */registerElement:function(elem){this._register.push(elem);},/**
	 * Un-registers a UI element with the UI manager.
	 * @param elem
	 */unRegisterElement:function(elem){this._register.pull(elem);// Kill any styles defined for this element id
delete this._styles[`#${elem._id}`];delete this._styles[`#${elem._id}:active`];delete this._styles[`#${elem._id}:focus`];delete this._styles[`#${elem._id}:hover`];},/**
	 * Registers a UI element against a style for quick lookup.
	 * @param elem
	 */registerElementStyle:function(elem){if(elem&&elem._styleClass){this._elementsByStyle[elem._styleClass]=this._elementsByStyle[elem._styleClass]||[];this._elementsByStyle[elem._styleClass].push(elem);}},/**
	 * Un-registers a UI element from a style.
	 * @param elem
	 */unRegisterElementStyle:function(elem){if(elem&&elem._styleClass){this._elementsByStyle[elem._styleClass]=this._elementsByStyle[elem._styleClass]||[];this._elementsByStyle[elem._styleClass].push(elem);}},canFocus:function(elem){return elem._allowFocus;},focus:function(elem){if(elem!==undefined){if(elem!==this._focus){// The element is not our current focus so focus to it
var previousFocus=this._focus;// Tell the current focused element that it is about to loose focus
if(!previousFocus||!previousFocus.emit('blur',elem)){if(previousFocus){previousFocus._focused=false;previousFocus.blur();}// The blur was not cancelled
if(!elem.emit('focus',previousFocus)){// The focus was not cancelled
this._focus=elem;elem._focused=true;return true;}}}else{// We are already focused
return true;}}return false;},blur:function(elem){// console.log('blur', elem._id, elem);
if(elem!==undefined){if(elem===this._focus){// The element is currently focused
// Tell the current focused element that it is about to loose focus
if(!elem.emit('blur')){// The blur was not cancelled
this._focus=null;elem._focused=false;elem._updateStyle();return true;}}}return false;},_keyUp:function(event){// Direct the key event to the focused element
if(this._focus){this._focus.emit('keyUp',event);ige.input.stopPropagation();}},_keyDown:function(event){// Direct the key event to the focused element
if(this._focus){this._focus.emit('keyDown',event);ige.input.stopPropagation();}}});;/**
 * Adds client/server time sync capabilities to the network system.
 * This handles calculating the time difference between the clock
 * on the server and the clock on connected clients.
 */var $i_23={/**
	 * Gets / sets the number of milliseconds between client/server
	 * clock sync events. The shorter the time, the more accurate the
	 * client simulation will be but the more network traffic you
	 * will transceive. Default value of ten seconds (10000) is usually
	 * enough to provide very accurate results without over-using the
	 * bandwidth.
	 * @param val
	 * @return {*}
	 */timeSyncInterval:function(val){if(val!==undefined){this._timeSyncInterval=val;return this._entity;}return this._timeSyncInterval;},timeSyncStart:function(){if(ige.isClient){this._timeSyncStarted=true;// Send a time sync request now so we
// have a starting value to work with
var self=this;console.log('Starting client/server clock sync running every',this._timeSyncInterval);this._timeSyncTimer=setInterval(function(){self._sendTimeSync(ige.network.id());},this._timeSyncInterval);}return this._entity;},// timeSyncStop: function () {
// 	this.log('Stopping client/server clock sync...');
// 	clearInterval(this._timeSyncTimer);
// 	this._timeSyncStarted = false;
// 	return this._entity;
// },
_sendTimeSync:function(clientId){this.send('_igeNetTimeSync',ige._currentTime,clientId);this.lastTimeSyncSentAt=Date.now();},_onTimeSync:function(serverTime,clientId){if(ige.isClient){// update ping
if(this.lastTimeSyncSentAt){this.timeSync(serverTime);}}// when server receives timeSync from client, send timeSync back.
if(ige.isServer){this._sendTimeSync(clientId);// send response
}},// // speed up or slow down ige.timeScale depending on discrepancy between client & server's time.
timeSync:function(serverTime){var latency=Math.floor(Date.now()-this.lastTimeSyncSentAt);// ping (round trip)
// this.latency = latency;
// this.latencyHistory.push(this.latency)
// if (this.latencyHistory.length > 20) {
// 	this.latencyHistory.shift();
// }
// this.bestLatency = this.getMedian(this.latencyHistory)
// // console.log(this.bestLatency)
// if (!ige.renderTime) {
// 	ige.renderTime = serverTime - 50;
// }
// else {
// 	var diff = (serverTime - 50) - ige.renderTime
// 	ige.renderTime += diff/5
// 	ige.renderTime = Math.max(ige.renderTime, serverTime - 70);
// 	ige.renderTime = Math.min(ige.renderTime, serverTime - 20);
// }
if(statsPanels.latency){statsPanels.latency._latencyPanel.update(latency,1000);}$('#updateping').html(Math.floor(latency));// round trip time
},getMedian:function(arr){const mid=Math.floor(arr.length/2);const nums=[...arr].sort((a,b)=>a-b);return arr.length%2!==0?nums[mid]:(nums[mid-1]+nums[mid])/2;}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_23;};/**
 * Adds stream capabilities to the network system.
 */var $i_24=$i_3.extend({classId:'$i_24',componentId:'stream',/**
	 * @constructor
	 * @param entity
	 * @param options
	 */init:function(entity,options){this._entity=entity;this._options=options;var self=this;// Set the stream data section designator character
this._sectionDesignator='¬';if(ige.isClient){// Define the network stream command
this._entity.define('_igeStreamCreate',function(){self._onStreamCreate.apply(self,arguments);});this._entity.define('_igeStreamDestroy',function(){self._onStreamDestroy.apply(self,arguments);});this._entity.define('_igeStreamData',function(){self._onStreamData.apply(self,arguments);});this._entity.define('_igeStreamTime',function(){self._onStreamTime.apply(self,arguments);});this._entity.define('_igeStreamCreateSnapshot',function(){self._onStreamCreateSnapshot.apply(self,arguments);});}},/**
	 * Gets /Sets the amount of milliseconds in the past that the renderer will
	 * show updates from the stream. This allows us to interpolate from a previous
	 * position to the next position in the stream update. Updates come in and
	 * are already in the past when they are received so we need to set this
	 * latency value to something greater than the highest level of acceptable
	 * network latency. Usually this is a value between 100 and 200ms. If your
	 * game requires much tighter latency you will have to reduce the number of
	 * players / network updates / data size in order to compensate. A value of
	 * 100 in this call is the standard that most triple-A FPS games accept as
	 * normal render latency and should be OK for your game.
	 *
	 * @param latency
	 */renderLatency:function(latency){if(latency!==undefined){// this._renderLatency = latency;
ige._renderLatency=latency;return this._entity;}return ige._renderLatency;},/**
	 * Handles receiving the start time of the stream data.
	 * @param data
	 * @private
	 */_onStreamTime:function(data){this._streamDataTime=data;},_onStreamCreateSnapshot:function(data){console.log(data);},_onStreamCreate:function(data){var classId=data[0];var entityId=data[1];var parentId=data[2];var transformData=data[3];var createData=data[4];var parent=ige.$(parentId);var classConstructor;var ntransdata;var entity;// ige.devLog("onStreamCreate", entityId, classId, createData);
if(transformData){var ntransdata=[parseInt(transformData[0],16),parseInt(transformData[1],16),parseInt(transformData[2],16)/1000];// x, y, rotation
}// Check the required class exists
if(parent){// Check that the entity doesn't already exist
if(!ige.$(entityId)){classConstructor=igeClassStore[classId];if(classConstructor){createData.defaultData={translate:{x:ntransdata[0],y:ntransdata[1]},rotate:ntransdata[2]};entity=new classConstructor(createData,entityId);// don't send 'create' stream for spriteonly/weldjoint items
var body=entity._stats.currentBody;if(entity._category!='item'||body&&body.jointType!='weldJoint'){entity.bypassSmoothing=true;entity.streamSectionData('transform',ntransdata);}// Set the just created flag which will stop the renderer
// from handling this entity until after the first stream
// data has been received for it
if(entity._streamEmitCreated){entity.emit('streamCreated');}// entity.bypassSmoothing = false;
// $i_24.prototype.log(entity)
// Since we just created an entity through receiving stream
// data, inform any interested listeners
this.emit('entityCreated',entity);delete entity.bypassSmoothing;}else{ige.network.stop();ige.stop();$i_24.prototype.log(`Network stream cannot create entity with class ${classId} because the class has not been defined! The engine will now stop.`,'error');}}}else{$i_24.prototype.log(`Cannot properly handle network streamed entity with id ${entityId} because it's parent with id ${parentId} does not exist on the scenegraph!`,'warning');}},_onStreamDestroy:function(data){var entity=ige.$(data[1]);var self=this;if(entity){// Calculate how much time we have left before the entity
// should be removed from the simulation given the render
// latency setting and the current time
entity.destroy();self.emit('entityDestroyed',entity);}}});function arr2hex(byteArray){return Array.from(byteArray,function(byte){return`0${(byte&0xFF).toString(16)}`.slice(-2);}).join('');}if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_24;};// Our namespace
var $i_28={};/**
 * Define the debug options object.
 * @type {Object}
 * @private
 */$i_28._debug={_enabled:true,_node:typeof module!=='undefined'&&typeof module.exports!=='undefined',_level:['log','warning','error'],_stacks:false,_throwErrors:true,_trace:{setup:false,enabled:false,match:''},enabled:function(val){if(val!==undefined){this._enabled=val;return this;}return this._enabled;}};/**
 * Define the class system.
 * @type {*}
 */$i_28.Class=$i_2;$i_28.EventingClass=$i_3;$i_28.Client=$i_28.EventingClass.extend({classId:'$i_28.Client',init:function(url,options){this.log('Net.io client starting...');this._options=options||{};this._socket=null;this._state=0;this._debug=false;this._connectionAttempts=0;this._sentBytesSinceLastUpdate=0;this._sentBytesTotal=0;this._receivedBytesSinceLastUpdate=0;this._receivedBytesTotal=0;this._started=new Date();this._lastSentUpdated=new Date();this._lastReceiveUpdated=new Date();this._receiveRate=0;this._sendRate=0;// this.COMPRESSION_THRESHOLD = 30000;
// Set some default options
if(this._options.connectionRetry===undefined){this._options.connectionRetry=true;}if(this._options.connectionRetryMax===undefined){this._options.connectionRetryMax=10;}if(this._options.reconnect===undefined){this._options.reconnect=true;}// If we were passed a url, connect to it
if(url!==undefined){this.connect(url);}},/**
	 * Gets / sets the debug flag. If set to true, net.io
	 * will output debug data about every network event as
	 * it occurs to the console.
	 * @param {Boolean=} val
	 * @return {*}
	 */debug:function(val){if(val!==undefined){this._debug=val;return this;}return this._debug;},connect:function(url){this.log(`Connecting to server at ${url}`);var self=this;// Set the state to connecting
this._state=1;/*
		// Replace http:// with ws://
		if (window.location.protocol == 'https:'){
				url = url.replace('http://', 'wss://');
		} else {
				url = url.replace('http://', 'ws://');
		}
		*/ // Create new websocket to the url
this._socket=new WebSocket(`${url}?token=${localStorage.getItem('token')}`,'netio1');// Setup event listeners
this._socket.onopen=function(){self._onOpen.apply(self,arguments);};this._socket.onmessage=function(){self._onData.apply(self,arguments);};this._socket.onclose=function(){self._onClose.apply(self,arguments);};this._socket.onerror=function(){self._onError.apply(self,arguments);};},disconnect:function(reason){this._socket.close(1000,reason);this.emit('_igeStreamDestroy');},send:function(data){if(this._socket.readyState==1){var str=this._encode(data);this._socket.send(str);// how many UTF8 characters did we send (assume 1 byte per char and mostly ascii)
var sentBytes=str.length;this._sentBytesSinceLastUpdate+=sentBytes;this._sentBytesTotal+=sentBytes;// all time average
var now=new Date();var elapsedSinceStarted=(now-this._started)*0.001;this._averageSendRate=this._sentBytesTotal/elapsedSinceStarted;// average in last second
var elapsed=(now-this._lastSentUpdated)*0.001;if(elapsed>=1){this._sendRate=this._sentBytesSinceLastUpdate/elapsed;this._lastSentUpdated=now;this._sentBytesSinceLastUpdate=0;// plot against 2x all time average
if(statsPanels.sent){statsPanels.sent._sentPanel.update(this._sendRate,this._averageSendRate*2);}}}else{this.disconnect();}},_onOpen:function(event){var url=event.target.url;var urlWithoutProtocol=url.split('://')[1];var serverDomain=urlWithoutProtocol.split('/')[0];var serverName=serverDomain.split(':')[0];// $.ajax({
// 	url: '/socket-error-count',
// 	dataType: 'json',
// 	type: 'POST',
// 	data: {
// 		status: true,
// 		server: serverName,
// 		tier: window.tier
// 	}
// });
this._state=2;},_onData:function(data){// Decode packet and emit message event
this._decode(data);},_onDecode:function(packet,data){// how many UTF8 characters did we receive (assume 1 byte per char and mostly ascii)
// var receivedBytes = data.data.size;
var receivedBytes=data.data&&data.data.length||0;this._receivedBytesSinceLastUpdate+=receivedBytes;this._receivedBytesTotal+=receivedBytes;// all time average
var now=new Date();var elapsedSinceStarted=(now-this._started)*0.001;this._averageReceiveRate=this._receivedBytesTotal/elapsedSinceStarted;// average in last second
var elapsed=(now-this._lastReceiveUpdated)*0.001;if(elapsed>=1){this._receiveRate=this._receivedBytesSinceLastUpdate/elapsed;this._lastReceiveUpdated=now;this._receivedBytesSinceLastUpdate=0;// plot against 2x all time average
if(statsPanels.received){statsPanels.received._receivedPanel.update(this._receiveRate,this._averageReceiveRate*2);}var bandwidthUsed=(this._receivedBytesTotal+this._sentBytesTotal)/1024;if(statsPanels.bandwidth){statsPanels.bandwidth._bandwidthPanel.update(bandwidthUsed,bandwidthUsed*2);}}// Output debug if required
if(this._debug){console.log('Incoming data (event, decoded data):',data,packet);}if(packet._netioCmd){// The packet is a netio command
switch(packet._netioCmd){case'id':// Store the new id in the socket
this.id=packet.data;// Now we have an id, set the state to connected
this._state=3;// Emit the connect event
this.emit('connect',this.id);break;case'close':// The server told us our connection has been closed
// so store the reason the server gave us!
this._disconnectReason=packet.data;break;}}else{// The packet is normal data
this.emit('message',[packet]);}},_onClose:function(event){var wasClean=event.wasClean;var reason=event.reason;var code=event.code;console.log('close event',event,{state:this._state,reason:this._disconnectReason});if(code===1006){var url=event.target.url;var urlWithoutProtocol=url.split('://')[1];var serverDomain=urlWithoutProtocol.split('/')[0];// $.ajax({
// 	url: '/socket-error-count',
// 	dataType: 'json',
// 	type: 'POST',
// 	data: {
// 		status: false,
// 		server: serverDomain,
// 		tier: window.tier
// 	}
// });
}// if (code === 1006) {
// 	console.log('experienced issue 1006');
// 	var baseUrl = location.host + location.pathname;
// 	var queryString = '?serverId=' + window.connectedServer.id + '&joinGame=true&redirected=' + location.protocol;
// 	if (baseUrl[baseUrl.length - 1] === '/') {
// 		baseUrl += queryString;
// 	}
// 	else {
// 		baseUrl += '/' + queryString;
// 	}
// 	if (location.protocol === 'https:') {
// 		var newUrl = 'http://' + baseUrl;
// 		console.log('redirecting from https to http', newUrl);
// 		// was already redirected from http version
// 		// if (location.search.indexOf('redirected=http:') > -1) {
// 		// }
// 		// Rollbar.critical("socket error 1006 over https", { data: { code: code, reason: reason, wasClean: wasClean } });
// 		location.href = newUrl;
// 	}
// 	else if (location.protocol === 'http:') {
// 		var newUrl = 'https://' + baseUrl;
// 		console.log('redirecting from http to https', newUrl);
// 		// was already redirected from https version
// 		// if (location.search.indexOf('redirected=https:') > -1) {
// 		// 	Rollbar.critical("socket error 1006 over http", { data: { code: code, reason: reason, wasClean: wasClean } });
// 		// }
// 		// Rollbar.critical("socket error 1006 over http", { data: { code: code, reason: reason, wasClean: wasClean } });
// 		if (location.hostname !== 'localhost') {
// 			location.href = newUrl;
// 		}
// 	}
// }
// If we are already connected and have an id...
if(this._state===3){this._state=0;this.emit('disconnect',{reason:this._disconnectReason,wasClean:wasClean,code:code});}// If we are connected but have no id...
if(this._state===2){this._state=0;this.emit('disconnect',{reason:this._disconnectReason,wasClean:wasClean,code:code});}// If we were trying to connect...
if(this._state===1){this._state=0;this.emit('error',{reason:'Cannot establish connection, is server running?'});}// Remove the last disconnect reason
delete this._disconnectReason;},_onError:function(){this.log('An error occurred with the net.io socket!','error',arguments);console.log('An error occurred with the net.io socket!','error',arguments);this.emit('error',arguments);},_encode:function(data){return JSON.stringify(data);},_decode:function(data){var self=this;var jsonString=LZString.decompressFromUTF16(data.data);// var jsonString = data.data;
// NOTE: make sure than COMPRESSION_THRESHOLD is same on both client and server
// LOGIC:
//     1. if json string has less than COMPRESSION_THRESHOLD chars (e.g. 9998)
//        then it was compressed on server side so decompress it
//        (because we are comparing with COMPRESSION_THRESHOLD before compressing it)
//     2. if json string has more than COMPRESSION_THRESHOLD chars (10001)
//        then it was not compressed on server side so don't run decompression on it
//        and just parse the data as is
// var jsonString = data.data.length > self.COMPRESSION_THRESHOLD
// 	? data.data
// 	: LZString.decompressFromUTF16(data.data);
self._onDecode(JSON.parse(jsonString),data);// self._onDecode(JSON.parse(data.data), data);
// var blob = data.data;
// var fileReader = new FileReader();
// fileReader.onload = function () {
// 	arrayBuffer = this.result;
// 	var uint8Array = new Uint8Array(arrayBuffer);
// 	//console.log(uint8Array);
// 	var packet = msgpack.decode(uint8Array);
// 	//console.log(packet);
// 	self._onDecode(packet, data);
// };
// fileReader.readAsArrayBuffer(blob);
}});;/**
 * The client-side net.io component. Handles all client-side
 * networking systems.
 */var Ige$i_28Client={version:'1.0.0',_initDone:false,_idCounter:0,_requests:{},_state:0,usedServers:[],/**
	 * Gets the current socket id.
	 * @returns {String} The id of the socket connection to the server.
	 */id:function(){return this._id||'';},/**
	 * Starts the network for the client.
	 * @param {*} url The game server URL.
	 * @param {Function=} callback A callback method to call once the
	 * network has started.
	 */start:function(server,callback){if(this._state===3){// We're already connected
if(typeof callback==='function'){callback(server);}}else{this.artificialDelay=0;this.lagVariance=0;var self=this;var gameId=ige.client.servers[0].gameId;self._startCallback=callback;var sortedServers=[server];var ignoreServerIds=[server.id];while(server=ige.client.getBestServer(ignoreServerIds)){ignoreServerIds.push(server.id);sortedServers.push(server);}sortedServers.reduce(function(p,server){var defer=$.Deferred();p.then(function(){// console.log(server, self._state);
// if client's is not connected yet
if(self._state<2){if(window.isStandalone){console.log('connecting to a standalone server');url=`ws://${window.location.hostname}:2001`;}else{url=server.url;}self._url=url;var msg=`Connecting to net.io server at "${self._url}"...`;self.log(msg);console.log(msg);window.connectedServer=server;if(typeof WebSocket!=='undefined'){self.connectToGS(url).done(function(){window.activatePlayGame=true;// if (gameId && typeof analyticsUrl != 'undefined' && analyticsUrl) {
// 	$.post(`${analyticsUrl}api/game-report/game-access/${gameId}/gs-connected`)
// 		.then(function () { }, function (xhr, status, error) {
// 			$.post('/api/log', {
// 				event: 'gs-connected',
// 				game: gameId,
// 				status: xhr.status,
// 				text: xhr.statusText
// 			});
// 		});
// }
defer.resolve();}).fail(function(err){console.log('connection failed, retrying...',err||'');// defer.resolve();
});}else{defer.reject('websockets are not available');}}else{defer.resolve();}});return defer;},$.when()).done(function(){// we have gone through every possible server
// and still client's not connected properly
console.log('final stage',self._state);if(self._state<3){console.log('disconnecting from the server');self._state=0;// Disconnected
self._onDisconnectFromServer.apply(self,arguments);if(gameId&&typeof analyticsUrl!=undefined){$.post(`${analyticsUrl}api/game-report/game-access/${gameId}/could-not-connect`).fail(function(xhr){$.post('/api/log',{event:'could-not-connect',game:gameId,status:xhr.status,text:xhr.statusText});});}if($('#menu-wrapper').is(':visible')){$('#play-game-button .content').addClass('bg-danger');$('#play-game-button .content').html('<i class=\'fa fa-group pr-3\'></i>'+'<div class="p-1">'+'<div>'+'<span>Connection Failed</span>'+'</div>'+'<div>'+'<small style=\'font-size: 10px;\'>Please select a different server</small>'+'</div>'+'</div>');$('#play-game-button').prop('disabled',false);console.log(ige.client.eventLog);window.activatePlayGame=true;}else{ige.menuUi.onDisconnectFromServer('ige$i_28Client #143');}}}).fail(function(error){$.post('/api/log',{event:'could-not-connect',game:gameId,text:error.toString()});});}},/**
	 * @param {string} url the game server URL
	 */connectToGS:function(url){var self=this;var defer=$.Deferred();if(!url){defer.reject('invalid url provided');return defer.promise();}this._io=new $i_28.Client(url);self._state=1;// Connecting
var timer=setTimeout(function(){console.log('connection timed out',url);// self._io.disconnect('connection timed out');
clearTimeout(timer);self._state=0;self._io.disconnect('Client timed out');defer.reject();},7000);// Define connect listener
this._io.on('connect',function(clientId){self._state=2;// Connected
self._id=clientId;self._onConnectToServer.apply(self,arguments);});// Define message listener
this._io.on('message',function(data){// if data receive before init queue that data
if(!self._initDone&&data&&data.cmd!='init'){if(!self.dataB4Init){self.dataB4Init=[];}self.dataB4Init.push(arguments);}if(data.cmd){var i;var commandCount=0;// Check if the data is an init packet
if(data.cmd==='init'){clearTimeout(timer);// Set flag to show we've now received an init command
self._initDone=true;self._state=3;// Connected and init done
// Setup the network commands storage
self._networkCommandsLookup=data.ncmds;// Fill the reverse lookup on the commands
for(i in self._networkCommandsLookup){if(self._networkCommandsLookup.hasOwnProperty(i)){self._networkCommandsIndex[self._networkCommandsLookup[i]]=i;commandCount++;}}// Setup default commands
self.define('_igeRequest',function(){self._onRequest.apply(self,arguments);});self.define('_igeResponse',function(){self._onResponse.apply(self,arguments);});self.define('_igeNetTimeSync',function(){self._onTimeSync.apply(self,arguments);});self.log(`Received network command list with count: ${commandCount}`);// Setup time scale and current time
ige.timeScale(parseFloat(data.ts));// Now fire the start() callback
if(typeof self._startCallback==='function'){self._startCallback({url:url});delete self._startCallback;}// apply dataB4Init queue data
if(self.dataB4Init&&self.dataB4Init.length>0){for(var i=0;i<self.dataB4Init.length;i++){self._onMessageFromServer.apply(self,self.dataB4Init[i]);}}self.timeSyncStart();// setTimeout(function () {
// 	if (location.protocol === 'http:' && location.search.indexOf('redirected=true') > -1) {
// 		// Rollbar.info("Redirect User stayed connected for 10s, current socket state" + self._state);
// 	}
// 	if (window.history) {
// 		var parts = location.href.split('?');
// 		var domain = parts[0];
// 		var queryString = parts[1] || '';
// 		var queryParameters = queryString.split('&');
// 		// remove query param redirect from string to prevent it's misuse on reload
// 		queryParameters = queryParameters.filter(function (params) {
// 			return params.indexOf('redirected=') === -1;
// 		});
// 		queryString = queryParameters.join('&');
// 		var url = [domain, queryString].join('?');
// 		window.history.pushState(null, "", url)
// 	}
// }, 10000);
defer.resolve();}}else{self._onMessageFromServer.apply(self,arguments);}});// Define disconnect listener
self._io.on('disconnect',function(data){var reason=data.reason;var code=data.code;var wasClean=data.wasClean;ige.menuUi.onDisconnectFromServer('ige$i_28Client #263',reason);});// Define error listener
this._io.on('error',function(){console.log('socket error',arguments);// Rollbar.critical("Error in socket connection", { arguments: arguments });
self._onError.apply(self,arguments);});return defer.promise();},stop:function(){// Check we are connected
if(self._state===3){this._io.disconnect('Client requested disconnect');}},/**
	 * Gets / sets a network command and callback. When a network command
	 * is received by the client, the callback set up for that command will
	 * automatically be called and passed the data from the incoming network
	 * packet.
	 * @param {String} commandName The name of the command to define.
	 * @param {Function} callback A function to call when the defined network
	 * command is received by the network.
	 * @return {*}
	 */define:function(commandName,callback){if(commandName!==undefined&&callback!==undefined){// Check if this command has been defined by the server
if(this._networkCommandsLookup[commandName]!==undefined){this._networkCommands[commandName]=callback;}else{this.log(`Cannot define network command "${commandName}" because it does not exist on the server. Please edit your server code and define the network command there before trying to define it on the client!`,'error');}return this._entity;}else{this.log('Cannot define network command either the commandName or callback parameters were undefined!','error');}},/**
	 * Sends a network message with the given command name
	 * and data.
	 * @param commandName
	 * @param data
	 */send:function(commandName,data){var self=this;var commandIndex=this._networkCommandsLookup[commandName];var ciEncoded;// console.log("sending");
if(commandIndex!==undefined){if(this.debug()){console.log(`Sending "${commandName}" (index ${commandIndex}) with data:`,data);this._debugCounter++;}ciEncoded=String.fromCharCode(commandIndex);if(ige.env){setTimeout(function(ci,d){self._io.send([ci,d]);},Math.random()*self.lagVariance+self.artificialDelay,ciEncoded,data);}else{this._io.send([ciEncoded,data]);}// console.log("sent");
}else{// console.log("error ?");
this.log(`Cannot send network packet with command "${commandName}" because the command has not been defined!`,'error');}},/**
	 * Sends a network request. This is different from a standard
	 * call to send() because the recipient code will be able to
	 * respond by calling ige.network.response(). When the response
	 * is received, the callback method that was passed in the
	 * callback parameter will be fired with the response data.
	 * @param {String} commandName
	 * @param {Object} data
	 * @param {Function} callback
	 */request:function(commandName,data,callback){// Build the request object
var req={id:this.newIdHex(),cmd:commandName,data:data,callback:callback,timestamp:new Date().getTime()};// Store the request object
this._requests[req.id]=req;// Send the network request packet
this.send('_igeRequest',{id:req.id,cmd:commandName,data:req.data});},/**
	 * Sends a response to a network request.
	 * @param {String} requestId
	 * @param {Object} data
	 */response:function(requestId,data){// Grab the original request object
var req=this._requests[requestId];if(req){// Send the network response packet
this.send('_igeResponse',{id:requestId,cmd:req.commandName,data:data});// Remove the request as we've now responded!
delete this._requests[requestId];}},/**
	 * Generates a new 16-character hexadecimal unique ID
	 * @return {String}
	 */newIdHex:function(){this._idCounter++;return(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16);},_onRequest:function(data){// The message is a network request so fire
// the command event with the request id and
// the request data
this._requests[data.id]=data;if(this.debug()){console.log('onRequest',data);this._debugCounter++;}if(this._networkCommands[data.cmd]){this._networkCommands[data.cmd](data.id,data.data);}this.emit(data.cmd,[data.id,data.data]);},_onResponse:function(data){var id,req;// The message is a network response
// to a request we sent earlier
id=data.id;// Get the original request object from
// the request id
req=this._requests[id];if(this.debug()){console.log('onResponse',data);this._debugCounter++;}if(req){// Fire the request callback!
req.callback(req.cmd,data.data);// Delete the request from memory
delete this._requests[id];}},/**
	 * Called when the network connects to the server.
	 * @private
	 */_onConnectToServer:function(){this.log('Connected to server!');this.emit('connected');},/**
	 * Called when data from the server is received on the client.
	 * @param data
	 * @private
	 */_onMessageFromServer:function(data){var ciDecoded=data[0].charCodeAt(0);var commandName=this._networkCommandsIndex[ciDecoded];// console.log("name = " + commandName, data);
if(commandName==='_snapshot'){var snapshot=_.cloneDeep(data)[1];var newSnapshotTimeStamp=snapshot[snapshot.length-1][1];// see how far apart the newly received snapshot is from currentTime
if(snapshot.length){var obj={};// iterate through each entities
for(var i=0;i<snapshot.length;i++){var ciDecoded=snapshot[i][0].charCodeAt(0);var commandName=this._networkCommandsIndex[ciDecoded];var entityData=snapshot[i][1];if(commandName==='_igeStreamData'){var entityData=snapshot[i].slice(1).split('&');var entityId=entityData[0];entityData.splice(0,1);// removing entityId
entityData=[parseInt(entityData[0],16),// x
parseInt(entityData[1],16),// y
parseInt(entityData[2],16)/1000// rotation
];obj[entityId]=entityData;}else{this._networkCommands[commandName](entityData);}}if(Object.keys(obj).length){// sync server's timestamp with client's
if(ige._currentTime>newSnapshotTimeStamp+100||ige._currentTime<newSnapshotTimeStamp-100){ige.timeDiscrepancy=newSnapshotTimeStamp-Date.now();}else{ige.timeDiscrepancy+=(newSnapshotTimeStamp-Date.now()-ige.timeDiscrepancy)/5;// rubberband
}// add the new snapshot into empty array
if(ige.snapshots.length==0){ige.snapshots.push([newSnapshotTimeStamp,obj]);}// if not empty, add it as ascending order based on timestamp
else{var i=0;while(ige.snapshots[i]&&ige.snapshots[i][0]<newSnapshotTimeStamp){i++;var spliceIndex=i;}if(spliceIndex!=undefined){ige.snapshots.splice(spliceIndex,0,[newSnapshotTimeStamp,obj]);}}}}}else{if(this._networkCommands[commandName]){if(this.debug()){console.log(`Received "${commandName}" (index ${ciDecoded}) with data:`,data[1]);this._debugCounter++;}this._networkCommands[commandName](data[1]);}this.emit(commandName,data[1]);}},/**
	 * Called when the client is disconnected from the server.
	 * @param data
	 * @private
	 */_onDisconnectFromServer:function(data){if(data==='booted'){this.log('Server rejected our connection because it is not accepting connections at this time!','warning');}else{this.log('Disconnected from server!');}this.emit('disconnected');},/**
	 * Called when the client has an error with the connection.
	 * @param {Object} data
	 * @private
	 */_onError:function(data){this.log(`Error with connection: ${data.reason}`,'error');}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=Ige$i_28Client;};var Ige$i_28Server={_idCounter:0,_requests:{},/**
   * Starts the network for the server.
   * @param {*} data The port to listen on.
   * @param {Function=} callback A callback method to call once the
   * network has started.
   */start:function(data,callback){var self=this;this.artificialDelay=0;// simulated lag (ms)
this.lagVariance=0;this._socketById={};this._socketsByRoomId={};this.clientIds=[];this.snapshot=[];this.sendQueue={};if(typeof data!=='undefined'){this._port=data;}// Start net.io
console.log(`Starting net.io listener on port ${this._port}`);this._io=new this._netio(this._port,callback);// Setup listeners
this._io.on('connection',function(){self._onClientConnect.apply(self,arguments);});// Setup default commands
this.define('_igeRequest',function(){self._onRequest.apply(self,arguments);});this.define('_igeResponse',function(){self._onResponse.apply(self,arguments);});this.define('_igeNetTimeSync',function(){self._onTimeSync.apply(self,arguments);});this.define('_snapshot',function(){self._snapshot(self,arguments);});// Start network sync
// this.timeSyncStart();
return this._entity;},/**
   * Sets a network command and optional callback. When a network command
   * is received by the server, the callback set up for that command will
   * automatically be called and passed the data from the incoming network
   * packet.
   * @param {String} commandName The name of the command to define.
   * @param {Function=} callback A function to call when the defined network
   * command is received by the network.
   * @return {*}
   */define:function(commandName,callback){if(commandName!==undefined){this._networkCommands[commandName]=callback;// Record reverse lookups
var index=this._networkCommandsIndex.length;this._networkCommandsIndex[index]=commandName;this._networkCommandsLookup[commandName]=index;return this._entity;}else{this.log('Cannot define a network command without a commandName parameter!','error');}},/**
   * Adds a client to a room by id. All clients are added to room id
   * "ige" by default when they connect to the server.
   * @param {String} clientId The id of the client to add to the room.
   * @param {String} roomId The id of the room to add the client to.
   * @returns {*}
   */clientJoinRoom:function(clientId,roomId){if(clientId!==undefined){if(roomId!==undefined){this._clientRooms[clientId]=this._clientRooms[clientId]||[];this._clientRooms[clientId].push(roomId);this._socketsByRoomId[roomId]=this._socketsByRoomId[roomId]||{};this._socketsByRoomId[roomId][clientId]=this._socketById[clientId];if(this.debug()){this.log(`Client ${clientId} joined room ${roomId}`);}return this._entity;}this.log('Cannot add client to room because no roomId was provided!','warning');return this._entity;}this.log('Cannot add client to room because no clientId was provided!','warning');return this._entity;},/**
   * Removes a client from a room by id. All clients are added to room id
   * "ige" by default when they connect to the server and you can remove
   * them from it if your game defines custom rooms etc.
   * @param {String} clientId The id of the client to remove from the room.
   * @param {String} roomId The id of the room to remove the client from.
   * @returns {*}
   */clientLeaveRoom:function(clientId,roomId){if(clientId!==undefined){if(roomId!==undefined){console.log(`removing client ${clientId} from a room ${roomId}`);if(this._clientRooms[clientId]){this._clientRooms[clientId].pull(roomId);delete this._socketsByRoomId[roomId][clientId];}return this._entity;}this.log('Cannot remove client from room because no roomId was provided!','warning');return this._entity;}this.log('Cannot remove client from room because no clientId was provided!','warning');return this._entity;},/**
   * Removes a client from all rooms that it is a member of.
   * @param {String} clientId The client id to remove from all rooms.
   * @returns {*}
   */clientLeaveAllRooms:function(clientId){if(clientId!=undefined){var arr=this._clientRooms[clientId];// temp fix. not sure if what im doing is a good thing... LOL
// maybe this while statement was freezing up the game - Jaeyun Oct 8, 2017
if(arr!=undefined){for(var i=arr.length-1;i>=0;i--){console.log(`client ${clientId} is leaving the room ${arr[i]}(${i})`);this.clientLeaveRoom(clientId,arr[i]);}delete this._clientRooms[clientId];return this._entity;}}else{this.log('Cannot remove client from room because no clientId was provided!','warning');}return this._entity;},/**
   * Gets the array of room ids that the client has joined.
   * @param clientId
   * @returns {Array} An array of string ids for each room the client has joined.
   */clientRooms:function(clientId){if(clientId!==undefined){return this._clientRooms[clientId]||[];}this.log('Cannot get/set the clientRoom id because no clientId was provided!','warning');return[];},/**
   * Returns an associative array of all connected clients
   * by their ID.
   * @param {String=} roomId Optional, if provided will only return clients
   * that have joined room specified by the passed roomId.
   * @return {Array}
   */clients:function(roomId){if(roomId!==undefined){return this._socketsByRoomId[roomId];}return this._socketById;},/**
   * Returns the socket associated with the specified client id.
   * @param {String=} clientId
   * @return {*}
   */socket:function(clientId){return this._socketById[clientId];},/**
   * Gets / sets the current flag that determines if client connections
   * should be allowed to connect (true) or dropped instantly (false).
   * @param {Boolean} val Set to true to allow connections or false
   * to drop any incoming connections.
   * @return {*}
   */acceptConnections:function(val){if(typeof val!=='undefined'){this._acceptConnections=val;if(val){this.log('Server now accepting connections!');}else{this.log('Server no longer accepting connections!');}return this._entity;}return this._acceptConnections;},/**
   * Sends a message over the network.
   * @param {String} commandName
   * @param {Object} data
   * @param {*=} clientId If specified, sets the recipient socket id or a array of socket ids to send to.
   */send:function(commandName,data,clientId){var self=this;var commandIndex=this._networkCommandsLookup[commandName];var ciEncoded;if(commandIndex!==undefined){ciEncoded=String.fromCharCode(commandIndex);// console.log("ige$i_28Server send(): ",commandName, ciEncoded, data, clientId)
if(!self.sendQueue[clientId])self.sendQueue[clientId]=[];if(!clientId)clientId='undefined';self.sendQueue[clientId].push([ciEncoded,data]);}else{this.log(`Cannot send network packet with command "${commandName}" because the command has not been defined!`,'error');}},add:function(commandName,data,clientId){var commandIndex=this._networkCommandsLookup[commandName];var ciEncoded;if(commandIndex!==undefined){ciEncoded=String.fromCharCode(commandIndex);// to save space transform data of entities are send as a single string
// <ciEncoded><id><x><y><rot>
const snapshotData=typeof data==='string'?ciEncoded+data:[ciEncoded,data];this.snapshot.push(snapshotData);}else{this.log(`Cannot send network packet with command "${commandName}" because the command has not been defined!`,'error');}},flush:function(timestamp){// console.log('SNAPSHOT CONTAINS', this.snapshot)
var self=this;var commandIndex=this._networkCommandsLookup._snapshot;var ciEncoded=String.fromCharCode(commandIndex);if(commandIndex!==undefined){// send sendQueue
if(self.sendQueue){for(var clientId in self.sendQueue){// simulate lag for dev environment
if(global.isDev){setTimeout(function(data,id,ci){self._io.send([ci,data],id==='undefined'?undefined:id);},Math.random()*self.lagVariance+self.artificialDelay,self.sendQueue[clientId],clientId,ciEncoded);}else{// production we don't simulate lag
self._io.send([ciEncoded,self.sendQueue[clientId]],clientId==='undefined'?undefined:clientId);}}self.sendQueue={};}// send snapshot
if(this.snapshot.length==0){return;}// append serverTime timestamp to the snapshot
self.snapshot.push([String.fromCharCode(this._networkCommandsLookup._igeStreamTime),timestamp]);if(global.isDev){// generate artificial lag in dev environment
setTimeout(function(data,ci){self._io.send([ci,data]);},Math.random()*self.lagVariance+self.artificialDelay,self.snapshot,ciEncoded);}else{self._io.send([ciEncoded,self.snapshot]);}ige.server.lastSnapshot=self.snapshot;this.snapshot=[];}else{this.log('_snapshot error @ flush');}},/**
   * Sends a network request. This is different from a standard
   * call to send() because the recipient code will be able to
   * respond by calling ige.network.response(). When the response
   * is received, the callback method that was passed in the
   * callback parameter will be fired with the response data.
   * @param {String} commandName
   * @param {Object} data
   * @param {Function} callback
   */request:function(commandName,data,callback){// Build the request object
var req={id:this.newIdHex(),cmd:commandName,data:data,callback:callback,timestamp:new Date().getTime()};// Store the request object
this._requests[req.id]=req;// Send the network request packet
this.send('_igeRequest',{id:req.id,cmd:commandName,data:req.data});},/**
   * Sends a response to a network request.
   * @param {String} requestId
   * @param {Object} data
   */response:function(requestId,data){// Grab the original request object
var req=this._requests[requestId];if(req){// Send the network response packet
this.send('_igeResponse',{id:requestId,cmd:req.commandName,data:data},req.clientId);// Remove the request as we've now responded!
delete this._requests[requestId];}},/**
   * Generates a new 16-character hexadecimal unique ID
   * @return {String}
   */newIdHex:function(){this._idCounter++;return(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16);},/**
   * Determines if the origin of a request should be allowed or denied.
   * @param origin
   * @return {Boolean}
   * @private
   */_originIsAllowed:function(origin){// put logic here to detect whether the specified origin is allowed.
return true;},/**
   * Called when the server receives a client connection request. Sets
   * up event listeners on the socket and sends the client the initial
   * networking data required to allow network commands to operate
   * correctly over the connection.
   * @param {Object} socket The client socket object.
   * @private
   */_onClientConnect:function(socket){var self=this;var remoteAddress=socket._remoteAddress;console.log('client is attempting to connect',remoteAddress);var reason='';var bannedIps=ige.server.bannedIps;// ip is banned
var playerIsBanned=false;for(index in bannedIps){if(bannedIps[remoteAddress]!=undefined){console.log(`banned player detected! IP ${remoteAddress}`);playerIsBanned=true;reason+=' player is banned.';}}const playerCount=ige.$$('player').filter(function(player){return player._stats.controlledBy=='human';}).length;var clientRejectReason=[];if(this._acceptConnections!=true)clientRejectReason.push('server not accepting connections');if(playerCount>ige.server.maxPlayers)clientRejectReason.push('server is full');if(playerIsBanned)clientRejectReason.push('player ',socket._remoteAddress,' is banned');if(clientRejectReason.length==0){// Check if any listener cancels this
if(!this.emit('connect',socket)){this.log(`Accepted connection with socket id ${socket.id} ip ${remoteAddress}`);this._socketById[socket.id]=socket;this.clientIds.push(socket.id);self._socketById[socket.id].start=Date.now();ige.server.socketConnectionCount.connected++;// Store a rooms array for this client
this._clientRooms[socket.id]=this._clientRooms[socket.id]||[];socket.on('message',function(data){if(data.type==='ping'){socket.send({type:'pong',clientSentAt:data.sentAt,serverSentAt:Date.now(),timeTookToReceive:Date.now()-data.sentAt});return;}self._onClientMessage.apply(self,[data,socket.id]);});socket.on('disconnect',function(data){var isClient=self.clientIds.includes(socket.id);if(isClient){var end=Date.now();ige.server.socketConnectionCount.disconnected++;if(end-self._socketById[socket.id].start<3000){ige.server.socketConnectionCount.immediatelyDisconnected++;}}self._onClientDisconnect.apply(self,[data,socket]);});// Send an init message to the client
socket.send({cmd:'init',ncmds:this._networkCommandsLookup,ts:ige._timeScale,ct:ige._currentTime});// Send a clock sync command
this._sendTimeSync(socket.id);}else{// Reject the connection
var reason='cannot connect to socket this.emit("connect", socket)';console.log(reason);socket.close(reason);}}else{// console.log('Rejecting connection with id ' + socket.id + ' ' + reason);
// ige.network.send('playerDisconnect', {reason: reason, clientId: socket.id});
console.log('rejecting connection',clientRejectReason);socket.close(clientRejectReason);}},/**
   * Called when the server receives a network message from a client.
   * @param {Object} data The data sent by the client.
   * @param {String} clientId The client socket id.
   * @private
   */_onClientMessage:function(data,clientId){// added by Jaeyun to prevent error
if(typeof data[0]==='string'){if(data[0].charCodeAt(0)!=undefined){var ciDecoded=data[0].charCodeAt(0);var commandName=this._networkCommandsIndex[ciDecoded];if(this._networkCommands[commandName]){this._networkCommands[commandName](data[1],clientId);}// console.log(commandName, data, clientId)
this.emit(commandName,[data[1],clientId]);}}},_onRequest:function(data,clientId){// The message is a network request so fire
// the command event with the request id and
// the request data
data.clientId=clientId;this._requests[data.id]=data;if(this.debug()){console.log('onRequest',data);console.log('emitting',data.cmd,[data.id,data.data]);this._debugCounter++;}if(this._networkCommands[data.cmd]){this._networkCommands[data.cmd](data.data,clientId,data.id);}this.emit(data.cmd,[data.id,data.data,clientId]);},_onResponse:function(data,clientId){// The message is a network response
// to a request we sent earlier
id=data.id;// Get the original request object from
// the request id
req=this._requests[id];if(this.debug()){console.log('onResponse',data);this._debugCounter++;}if(req){// Fire the request callback!
req.callback(req.cmd,[data.data,clientId]);// Delete the request from memory
delete this._requests[id];}},/**
   * Called when a client disconnects from the server.
   * @param {Object} data Any data sent along with the disconnect.
   * @param {Object} socket The client socket object.
   * @private
   */_onClientDisconnect:function(data,socket){this.log(`Client disconnected with id ${socket.id}`);// this.emit('disconnect', socket.id, { code: 'DUPLICATE_IP' });
this.emit('disconnect',socket.id);// Remove them from all rooms
this.clientLeaveAllRooms(socket.id);delete ige.server.clients[socket.id];delete this._socketById[socket.id];let indexToRemove=this.clientIds.findIndex(function(id){if(id===socket.id)return true;});if(indexToRemove>-1){this.clientIds.splice(indexToRemove,1);}}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=Ige$i_28Server;};var Ige$i_28Component=$i_3.extend([{extension:$i_23,overwrite:false}],{classId:'Ige$i_28Component',componentId:'network',init:function(entity,options){this._entity=entity;this._options=options;// Setup the network commands storage
this._networkCommands={};this._networkCommandsIndex=[];this._networkCommandsLookup={};// Set some defaults
this._port=2001;this._debug=false;this._debugCounter=0;this._debugMax=0;this._clientRooms={};// Time sync defaults
this._timeSyncInterval=1000;// Sync the client/server clocks every ten seconds by default
this._timeSyncLog={};this._latency=0;this.latency=0;this.latencyHistory=[];this.rttSamples=[];this.lastClientTime=0;this.lastServerTime=0;this.totalClientTimeElapsed=[];this.totalServerTimeElapsed=[];if(ige.isClient){this._netio=Ige$i_28Client;this.implement(Ige$i_28Client);}this.log(`Network component initiated with Net.IO version: ${this._netio.version}`);},/**
	 * Gets / sets debug flag that determines if debug output
	 * is logged to the console.
	 * @param {Boolean=} val
	 * @return {*}
	 */debug:function(val){if(val!==undefined){this._debug=val;return this._entity;}// Check the debug counter settings
if(this._debugMax>0&&this._debugCounter>=this._debugMax){this._debug=false;this._debugCounter=0;}return this._debug;},/**
	 * Gets / sets the maximum number of debug messages that
	 * should be allowed to be output to the console before
	 * debugging is automatically turned off. This is useful
	 * if you want to sample a certain number of outputs and
	 * then automatically disable output so your console is
	 * not flooded.
	 * @param {Number=} val Number of debug messages to allow
	 * to be output to the console. Set to zero to allow
	 * infinite amounts.
	 * @return {*}
	 */debugMax:function(val){if(val!==undefined){this._debugMax=val;return this._entity;}return this._debugMax;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=Ige$i_28Component;};/**
 * The client-side chat component. Handles all client-side
 * chat methods and events.
 */var openChatBubble={};var $i_32={/**
	 * Asks the serve to let us join the room specified.
	 * @param {String} roomId The room id of the room to join.
	 */joinRoom:function(roomId){ige.network.send('igeChatJoinRoom',roomId);},sendToRoom:function(roomId,message,to){if(roomId!==undefined&&message!==undefined){msg={roomId:roomId,text:message,to:to};ige.network.send('igeChatMsg',msg);}},_onMessageFromServer:function(data){var self=ige.chat;var player=ige.game.getPlayerByClientId(data.from);var isPlayerMuted=ige.client.myPlayer&&ige.client.myPlayer._stats&&ige.client.myPlayer._stats.mutedUsers&&ige.client.myPlayer._stats.mutedUsers.indexOf(player._stats.userId)>-1;if(!player||isPlayerMuted){return;}var isChatHidden=$('#chat-box').hasClass('d-none');// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('messageFromServer',[data])){// commented out by Jaeyun
if(!isChatHidden){var selectedUnit=player.getSelectedUnit();if(selectedUnit&&selectedUnit.gluedEntities){// destroy existing chat bubble if it exists
for(var i=0;i<selectedUnit.gluedEntities.length;i++){var gluedEntity=selectedUnit.gluedEntities[i];if(gluedEntity.type==='chatBubble'){var igeEntity=ige.$(gluedEntity.id);if(igeEntity){igeEntity.destroy();}}}// create a new chat bubble
// var bubbleText = data.text.substring(0, 40);
// if (data.text.length > bubbleText.length) {
// 	bubbleText += '...';
// }
if(openChatBubble[selectedUnit.id()]&&selectedUnit._category==='unit'){openChatBubble[selectedUnit.id()].destroy();delete openChatBubble[selectedUnit.id()];}openChatBubble[selectedUnit.id()]=new IgePixiChatBubble(data.text,{parentUnit:selectedUnit.id()}).fade(3000);//phaser chat bubble rendering - logic for destroying and fading moved to PhaserChatBubble.ts
selectedUnit.emit('render-chat-bubble',data.text);}// console.log("chatMsg from " + player._stats.name + ': ', data.text);
}}},_onJoinedRoom:function(data){var self=ige.chat;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('joinedRoom',[data])){if(data.joined===true){// console.log('Server says we have joined room:', data.roomId);
}else{// console.log('Server says we failed to join room:', data.roomId);
}}},_onLeftRoom:function(data){var self=ige.chat;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('leftRoom',[data])){console.log('We have left room:',data);}},_onServerSentRoomList:function(data){var self=ige.chat;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('roomList',[data])){console.log('Server sent room list:',data);}},_onServerSentRoomUserList:function(data){var self=ige.chat;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('roomUserList',[data])){console.log('Server sent room user list:',data);}},_onRoomCreated:function(data){var self=ige.chat;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('roomCreated',[data])){console.log('Server told us room was created:',data);}},_onRoomRemoved:function(data){var self=ige.chat;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('roomRemoved',[data])){console.log('Server told us room was removed:',data);}}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_32;};/**
 * The server-side chat component. Handles all server-side
 * chat methods and events.
 */var $i_33={/**
     * Creates a new room with the specified room name and options.
     * @param roomName The display name of the room.
     * @param options An object containing options key/values.
	 * @param {String=} roomId If specified, becomes the new room's ID.
     * @return {String} The new room's ID.
     */createRoom:function(roomName,options,roomId){var self=ige.chat;var newRoomId=roomId||ige.newIdHex();self._rooms[roomId]={id:newRoomId,name:roomName,options:options,users:[]};// Inform all users that the room was created
ige.network.send('igeChatRoomCreated',roomId);return roomId;},/**
	 * Removes an existing room with the specified id.
	 * @param roomId
	 * @return {Boolean}
	 */removeRoom:function(roomId){var self=ige.chat;if(self._rooms[roomId]){// Inform all users that the room was removed
ige.network.send('igeChatRoomRemoved',roomId);delete self._rooms[roomId];return true;}else{return false;}},/**
	 * Sends a message to a room.
	 * @param {String} roomId The ID of the room to send the message to.
	 * @param {String} message The text body of the message to send.
	 * @param {String=} to The id of the user to send the message to.
	 * @param {String} from The id of the user that sent the message.
	 */sendToRoom:function(roomId,message,to,from){if(!to&&!from){ige.devLog('sending chatt message inside sendChatRoom',message);}ige.devLog(`chat - sendToRoom: ${message}`);var self=ige.chat;var player=ige.game.getPlayerByClientId(from);var gameData=ige.game.data&&ige.game.data.defaultData;if(from&&player&&player._stats){// don't send message if player is ban from sending message or unverified
if(!global.isDev&&(player._stats.banChat||gameData&&gameData.allowVerifiedUserToChat&&!player._stats.isUserVerified)){return;}else if(this.isSpamming(from,message)){// permanently mute player from this game;
player._stats.banChat=true;var msg={roomId:roomId,text:'You have been muted for spamming.',to:from};ige.network.send('igeChatMsg',msg,from);ige.clusterClient.banChat({gameId:gameData._id,userId:player._stats.userId});return;}ige.game.lastChatMessageSentByPlayer=message;ige.trigger.fire('playerSendsChatMessage',{playerId:player.id()});}if(message!=undefined&&message[0]=='/'){// do not show command messages that start with '/'. e.g. /ban user
return;}if(self._rooms[roomId]){var room=self._rooms[roomId];var msg;var i;if(message!==undefined){msg={roomId:roomId,text:message,from:from,to:to};if(msg.text&&msg.text.length>80){msg.text=msg.text.substr(0,80);}if(to){// Send message to individual user
if(room.users.indexOf(to)>-1){ige.network.send('igeChatMsg',msg,to);}else{self.log(`Cannot send to user because specified user is not in room: ${to}`);}}else{// Send this message to all users in the room
// self.log('Sending to all users...');
ige.network.send('igeChatMsg',msg);}}else{self.log('Cannot send message to room with blank message!');}}else{self.log(`Cannot send message to room with id "${roomId}" because it does not exist!`);}},// added by Jaeyun to prevent spammers
isSpamming:function(from,message){now=new Date();// if this is the user's first message. init
if(this.lastMessageSentAt[from]==undefined){this.lastMessageSentAt[from]=now;this.sentMessages[from]=[];return false;}// console.log("anti spam", now - this.lastMessageSentAt[from]);
// prevent user from sending messages every second
// 1500
this.lastMessageSentAt[from]=now;this.sentMessages[from].push({time:new Date(),message:message});var returnValue=false;if(this.sentMessages[from].length>4){var timeElapsed=0;var charCount=0;timeElapsed=now-this.sentMessages[from][0].time;for(i in this.sentMessages[from]){charCount+=this.sentMessages[from][i].message.length;}// sending 4 or more separate messages in 2 seconds
if(timeElapsed<=2000){returnValue=true;}// sending more than 80 characters in 4 seconds
if(timeElapsed<=4000&&charCount>80){returnValue=true;}// maintain last 4 message in array
this.sentMessages[from].shift();}return returnValue;},_onMessageFromClient:function(msg,clientId){var self=ige.chat;var room;// prevent non-string or non-unicode (e.g. emoji) from being broadcasted as it can disconnect all connected clients
if(typeof msg.text!='string'||self.regexUnicode.test(msg.text)==true){return;}// msg.text = self.validator.blacklist(msg.text, self.regex);
// msg.text = self.validator.whitelist(msg.text, self.regex)
// msg.text = self.sanitizer.sanitize(msg.text);
// msg.text = self.validator.escape(msg.text);
// msg.text = self.filter.clean(msg.text);
msg.text=self.filter.cleanHacked(msg.text);// https://github.com/web-mech/badwords/issues/93
if(msg==undefined||msg.text==undefined)return;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('messageFromClient',[msg,clientId])){var player=ige.game.getPlayerByClientId(clientId);if(player){var playerName=player._stats&&self.xssFilters.inHTMLData(player._stats.name);ige.devLog(`Message from client: (${playerName}): ${msg.text}`);player.lastMessageSent=msg.text;ige.trigger.fire('playerSendsMessage',{playerId:player.id()});}if(msg.roomId&&typeof msg.roomId=='string'||typeof msg.roomId=='number'){room=self._rooms[msg.roomId];if(room){if(room.users.indexOf(clientId)>-1){var text=msg.text;if(text){// console.log('Sending message to room...');
self.sendToRoom(msg.roomId,msg.text,msg.to,clientId);}else{// console.log('Cannot send message because message text is empty!', msg);
}}else{// The user is not in the room specified
ige.devLog('User tried to send message to room they are not joined in!',msg);}}else{// Room id specified does not exist
ige.devLog('User tried to send message to room that doesn\'t exist!',msg);}}else{// No room id in the message
ige.devLog('User tried to send message to room but didn\'t specify room id!',msg);}}},_onJoinRoomRequestFromClient:function(roomId,clientId){var self=ige.chat;// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('clientJoinRoomRequest',[roomId,clientId])){var room=self._rooms[roomId];self.log(`Client wants to join room: (${clientId})`,roomId);// Check the room exists
if(room){// Check that the user isn't already part of the room user list
if(!room.users[clientId]){// Add the user to the room
room.users.push(clientId);ige.network.send('igeChatJoinRoom',{roomId:roomId,joined:true},clientId);// console.log('User "' + clientId + '" joined room ' + roomId);
}else{// User is already in the room!
}}else{// Room does not exist!
}}},_onLeaveRoomRequestFromClient:function(roomId,clientId){// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('clientLeaveRoomRequest',[roomId,clientId])){console.log(`Client wants to leave room: (${clientId})`,roomId);}},_onClientWantsRoomList:function(data,clientId){// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('clientRoomListRequest',[data,clientId])){console.log(`Client wants the room list: (${clientId})`,data);}},_onClientWantsRoomUserList:function(roomId,clientId){// Emit the event and if it wasn't cancelled (by returning true) then
// process this ourselves
if(!self.emit('clientRoomUserListRequest',[roomId,clientId])){console.log(`Client wants the room user list: (${clientId})`,roomId);}}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_33;};var $i_34=$i_3.extend({classId:'$i_34',componentId:'chat',init:function(entity,options){var self=this;this._options=options;this._rooms={};// made by jaeyun
this.lastMessageSentAt=[];this.sentMessages=[];if(ige.isClient){this.implement($i_32);// Define the chat system network command listeners
ige.network.define('igeChatMsg',this._onMessageFromServer);ige.network.define('igeChatJoinRoom',this._onJoinedRoom);ige.network.define('igeChatLeaveRoom',this._onLeftRoom);ige.network.define('igeChatRoomList',this._onServerSentRoomList);ige.network.define('igeChatRoomUserList',this._onServerSentRoomUserList);ige.network.define('igeChatRoomCreated',this._onRoomCreated);ige.network.define('igeChatRoomRemoved',this._onRoomRemoved);$('#send-message').on('click',function(){self.sendChatMessage();});$('#hide-chat').on('click',function(){$('#show-chat').removeClass('d-none');$('#chat-box').addClass('d-none');});$('#show-chat').on('click',function(){$('#show-chat').addClass('d-none');$('#chat-box').removeClass('d-none');});}this.log('Chat component initiated!');},sendChatMessage:function(){if(ige.isClient){var player=ige.client.myPlayer;var gameData=ige.game&&ige.game.data&&ige.game.data.defaultData;var message=$('#message').val();// set character limit to 100 characters
if(message.length>80)message=message.substr(0,80);// don't send chat message if user is ban or unverified.
if(ige.env!='local'&&player&&(player._stats.banChat||gameData&&gameData.allowVerifiedUserToChat&&!player._stats.isUserVerified)){// don't send message
}else{ige.network.send('igeChatMsg',{text:message,roomId:'1'});}$('#message').blur();$('#message').val('');$('#chat-message-input').hide();}},escapeOutput:function(str){return str.replace(/\&/g,'&amp;').replace(/\</g,'&lt;').replace(/\>/g,'&gt;').replace(/\"/g,'&quot;').replace(/\'/g,'&#x27').replace(/\//g,'&#x2F');},postMessage:function(msgData){ige.devLog('message received',msgData);if(ige.isClient){var msgDiv='';if(msgData.from){var player=ige.game.getPlayerByClientId(msgData.from);var playerName=this.escapeOutput(player._stats.name);if(player&&player._stats){msgDiv=$('<div><span class=\'author\' style=\'color: #99F000;\'></span>:<span class=\'msg ml-1\'></span></div>');$(msgDiv).find('.author').text(player._stats.name);$(msgDiv).find('.msg').text(msgData.text);}}else// system message
{msgDiv=$('<div/>',{style:'color: yellow'});if(msgData.isHtml){msgDiv.append(`* ${msgData.text} *`);}else{msgDiv.text(`* ${msgData.text} *`);}}// append new message for both mobile & web chat-history div
$('#chat-history').each(function(){messageCount=$(this).find('div').length;if(messageCount>50){$(this).find('div:first-child').remove();}// console.log("messageCount", messageCount)
var scrollDifference=Math.abs(parseInt(this.scrollTop+this.clientHeight)-parseInt(this.scrollHeight));var shouldScroll=parseInt($(this).scrollTop+$(this).clientHeight)===parseInt($(this).scrollHeight)||scrollDifference<2;// console.log(scrollDifference, shouldScroll)
$(this).append(msgDiv);if(shouldScroll){// auto scroll down to bottom
$(this).scrollTop(this.scrollHeight);}});}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_34;};var $i_39=$i_3.extend({classId:'$i_39',componentId:'cocoonJs',init:function(){this.detected=typeof ext!=='undefined'&&typeof ext.IDTK_APP!=='undefined';if(this.detected){this.log('CocoonJS support enabled!');}},// TODO: Finish keyboard implementation
showInputDialog:function(title,message,initialValue,type,cancelText,okText){if(this.detected){title=title||'';message=message||'';initialValue=initialValue||'';type=type||'text';cancelText=cancelText||'Cancel';okText=okText||'OK';ext.IDTK_APP.makeCall('showTextDialog',title,message,initialValue,type,cancelText,okText);}else{this.log('Cannot open CocoonJS input dialog! CocoonJS is not detected!','error');}},/**
	 * Asks the API to load the url and show the web view.
	 * @param url
	 */showWebView:function(url){if(this.detected){// Forward a JS call to the webview IDTK API
ext.IDTK_APP.makeCall('forward',`ext.IDTK_APP.makeCall('loadPath', '${url}')`);ext.IDTK_APP.makeCall('forward','ext.IDTK_APP.makeCall(\'show\');');}},/**
	 * Asks the API to hide the web view.
	 */hideWebView:function(){if(this.detected){// Forward a JS call to the webview IDTK API
ext.IDTK_APP.makeCall('forward','ext.IDTK_APP.makeCall(\'hide\');');}}});;var $i_40={/**
	 * Gets / sets the entity's x position relative to the left of
	 * the canvas.
	 * @param {Number} px
	 * @param {Boolean=} noUpdate
	 * @return {Number}
	 */left:function(px,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiLeft;delete this._uiLeftPercent;}else{delete this._uiCenter;delete this._uiCenterPercent;if(typeof px==='string'){// Store the percentage value
this._uiLeftPercent=px;// Check if we are already mounted
var parentWidth;var val=parseInt(px,10);var newVal;if(this._parent){// We have a parent, use it's geometry
parentWidth=this._parent._bounds2d.x;}else{// We don't have a parent so use the main canvas
// as a reference
parentWidth=ige._bounds2d.x;}// Calculate real width from percentage
newVal=parentWidth/100*val|0;this._uiLeft=newVal;}else{// The value passed is not a percentage, directly assign it
this._uiLeft=px;delete this._uiLeftPercent;}}if(!noUpdate){this._updateUiPosition();}return this;}return this._uiLeft;},/**
	 * Gets / sets the entity's x position relative to the right of
	 * the canvas.
	 * @param {Number} px
	 * @param {Boolean=} noUpdate
	 * @return {Number}
	 */right:function(px,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiRight;delete this._uiRightPercent;}else{delete this._uiCenter;delete this._uiCenterPercent;if(typeof px==='string'){// Store the percentage value
this._uiRightPercent=px;// Check if we are already mounted
var parentWidth;var val=parseInt(px,10);var newVal;if(this._parent){// We have a parent, use it's geometry
parentWidth=this._parent._bounds2d.x;}else{// We don't have a parent so use the main canvas
// as a reference
parentWidth=ige._bounds2d.x;}// Calculate real width from percentage
newVal=parentWidth/100*val|0;this._uiRight=newVal;}else{// The value passed is not a percentage, directly assign it
this._uiRight=px;delete this._uiRightPercent;}}if(!noUpdate){this._updateUiPosition();}return this;}return this._uiRight;},/**
	 * Gets / sets the viewport's x position relative to the center of
	 * the entity parent.
	 * @param {Number} px
	 * @param {Boolean=} noUpdate
	 * @return {Number}
	 */center:function(px,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiCenter;delete this._uiCenterPercent;}else{delete this._uiLeft;delete this._uiLeftPercent;delete this._uiRight;delete this._uiRightPercent;if(typeof px==='string'){// Store the percentage value
this._uiCenterPercent=px;// Check if we are already mounted
var parentWidth;var val=parseInt(px,10);var newVal;if(this._parent){// We have a parent, use it's geometry
parentWidth=this._parent._bounds2d.x2;}else{// We don't have a parent so use the main canvas
// as a reference
parentWidth=ige._bounds2d.x2;}// Calculate real width from percentage
newVal=parentWidth/100*val|0;this._uiCenter=newVal;}else{// The value passed is not a percentage, directly assign it
this._uiCenter=px;delete this._uiCenterPercent;}}if(!noUpdate){this._updateUiPosition();}return this;}return this._uiCenter;},/**
	 * Gets / sets the entity's y position relative to the top of
	 * the canvas.
	 * @param {Number} px
	 * @param {Boolean=} noUpdate
	 * @return {Number}
	 */top:function(px,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiTop;delete this._uiTopPercent;}else{delete this._uiMiddle;delete this._uiMiddlePercent;if(typeof px==='string'){// Store the percentage value
this._uiTopPercent=px;// Check if we are already mounted
var parentHeight;var val=parseInt(px,10);var newVal;if(this._parent){// We have a parent, use it's geometry
parentHeight=this._parent._bounds2d.y;}else{// We don't have a parent so use the main canvas
// as a reference
parentHeight=ige._bounds2d.y;}// Calculate real width from percentage
newVal=parentHeight/100*val|0;this._uiTop=newVal;}else{// The value passed is not a percentage, directly assign it
this._uiTop=px;delete this._uiTopPercent;}}if(!noUpdate){this._updateUiPosition();}return this;}return this._uiTop;},/**
	 * Gets / sets the entity's y position relative to the bottom of
	 * the canvas.
	 * @param {Number} px
	 * @param {Boolean=} noUpdate
	 * @return {Number}
	 */bottom:function(px,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiBottom;delete this._uiBottomPercent;}else{delete this._uiMiddle;delete this._uiMiddlePercent;if(typeof px==='string'){// Store the percentage value
this._uiBottomPercent=px;// Check if we are already mounted
var parentHeight;var val=parseInt(px,10);var newVal;if(this._parent){// We have a parent, use it's geometry
parentHeight=this._parent._bounds2d.y;}else{// We don't have a parent so use the main canvas
// as a reference
parentHeight=ige._bounds2d.y;}// Calculate real width from percentage
newVal=parentHeight/100*val|0;this._uiBottom=newVal;}else{// The value passed is not a percentage, directly assign it
this._uiBottom=px;delete this._uiBottomPercent;}}if(!noUpdate){this._updateUiPosition();}return this;}return this._uiBottom;},/**
	 * Gets / sets the viewport's y position relative to the middle of
	 * the canvas.
	 * @param {Number} px
	 * @param {Boolean=} noUpdate
	 * @return {Number}
	 */middle:function(px,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiMiddle;delete this._uiMiddlePercent;}else{delete this._uiTop;delete this._uiTopPercent;delete this._uiBottom;delete this._uiBottomPercent;if(typeof px==='string'){// Store the percentage value
this._uiMiddlePercent=px;// Check if we are already mounted
var parentWidth;var val=parseInt(px,10);var newVal;if(this._parent){// We have a parent, use it's geometry
parentWidth=this._parent._bounds2d.y2;}else{// We don't have a parent so use the main canvas
// as a reference
parentWidth=ige._bounds2d.y2;}// Calculate real width from percentage
newVal=parentWidth/100*val|0;this._uiMiddle=newVal;}else{// The value passed is not a percentage, directly assign it
this._uiMiddle=px;delete this._uiMiddlePercent;}}if(!noUpdate){this._updateUiPosition();}return this;}return this._uiMiddle;},/**
	 * Gets / sets the geometry.x in pixels.
	 * @param {Number, String=} px Either the width in pixels or a percentage
	 * @param {Boolean=} lockAspect
	 * @param {Number=} modifier A value to add to the final width. Useful when
	 * you want to alter a percentage value by a certain number of pixels after
	 * it has been calculated.
	 * @param {Boolean=} noUpdate
	 * @return {*}
	 */width:function(px,lockAspect,modifier,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiWidth;this._bounds2d.x=0;this._bounds2d.x2=0;}else{this._uiWidth=px;this._widthModifier=modifier!==undefined?modifier:0;if(typeof px==='string'){if(this._parent){// Percentage
var parentWidth=this._parent._bounds2d.x;var val=parseInt(px,10);var newVal;var ratio;// Calculate real width from percentage
newVal=parentWidth/100*val+this._widthModifier|0;if(lockAspect){// Calculate the height from the change in width
ratio=newVal/this._bounds2d.x;this.height(this._bounds2d.y/ratio,false,0,noUpdate);}this._bounds2d.x=newVal;this._bounds2d.x2=Math.floor(this._bounds2d.x/2);}else{// We don't have a parent so use the main canvas
// as a reference
var parentWidth=ige._bounds2d.x;var val=parseInt(px,10);// Calculate real height from percentage
this._bounds2d.x=parentWidth/100*val+this._widthModifier|0;this._bounds2d.x2=Math.floor(this._bounds2d.x/2);}}else{if(lockAspect){// Calculate the height from the change in width
var ratio=px/this._bounds2d.x;this.height(this._bounds2d.y*ratio,false,0,noUpdate);}this._bounds2d.x=px;this._bounds2d.x2=Math.floor(this._bounds2d.x/2);}}if(!noUpdate){this._updateUiPosition();}return this;}return this._bounds2d.x;},/**
	 * Gets / sets the geometry.y in pixels.
	 * @param {Number=} px
	 * @param {Boolean=} lockAspect
	 * @param {Number=} modifier A value to add to the final height. Useful when
	 * you want to alter a percentage value by a certain number of pixels after
	 * it has been calculated.
	 * @param {Boolean=} noUpdate
	 * @return {*}
	 */height:function(px,lockAspect,modifier,noUpdate){if(px!==undefined){if(px===null){// Remove all data
delete this._uiHeight;this._bounds2d.y=0;this._bounds2d.y2=0;}else{this._uiHeight=px;this._heightModifier=modifier!==undefined?modifier:0;if(typeof px==='string'){if(this._parent){// Percentage
var parentHeight=this._parent._bounds2d.y;var val=parseInt(px,10);var newVal;var ratio;// Calculate real height from percentage
// Calculate real width from percentage
newVal=parentHeight/100*val+this._heightModifier|0;if(lockAspect){// Calculate the height from the change in width
ratio=newVal/this._bounds2d.y;this.width(this._bounds2d.x/ratio,false,0,noUpdate);}this._bounds2d.y=newVal;this._bounds2d.y2=Math.floor(this._bounds2d.y/2);}else{// We don't have a parent so use the main canvas
// as a reference
var parentHeight=ige._bounds2d.y;var val=parseInt(px,10);// Calculate real height from percentage
this._bounds2d.y=parentHeight/100*val+this._heightModifier|0;this._bounds2d.y2=Math.floor(this._bounds2d.y/2);}}else{if(lockAspect){// Calculate the height from the change in width
var ratio=px/this._bounds2d.y;this.width(this._bounds2d.x*ratio,false,0,noUpdate);}this._bounds2d.y=px;this._bounds2d.y2=Math.floor(this._bounds2d.y/2);}}if(!noUpdate){this._updateUiPosition();}return this;}return this._bounds2d.y;},autoScaleX:function(val,lockAspect){if(val!==undefined){this._autoScaleX=val;this._autoScaleLockAspect=lockAspect;this._updateUiPosition();return this;}return this._autoScaleX;},autoScaleY:function(val,lockAspect){if(val!==undefined){this._autoScaleY=val;this._autoScaleLockAspect=lockAspect;this._updateUiPosition();return this;}return this._autoScaleY;},/**
	 * Updates the UI position of every child entity down the scenegraph
	 * for this UI entity.
	 * @return {*}
	 */updateUiChildren:function(){var arr=this._children;var arrCount;var arrItem;if(arr){arrCount=arr.length;while(arrCount--){arrItem=arr[arrCount];if(arrItem._updateUiPosition){arrItem._updateUiPosition();}if(typeof arrItem.updateUiChildren==='function'){arrItem.updateUiChildren();}}}return this;},/**
	 * Sets the correct translate x and y for the viewport's left, right
	 * top and bottom co-ordinates.
	 * @private
	 */_updateUiPosition:function(){if(this._parent){var parentGeom=this._parent._bounds2d;var geomScaled=this._bounds2d.multiplyPoint(this._scale);var percent;var newVal;var ratio;/* if (this._ignoreCamera && ige._currentCamera) {
				// Handle cam ignore when calculating
				parentGeom = parentGeom.dividePoint(ige._currentCamera._scale);
			} */if(this._autoScaleX){// Get the percentage as an integer
percent=parseInt(this._autoScaleX,10);// Calculate new width from percentage
newVal=parentGeom.x/100*percent;// Calculate scale ratio
ratio=newVal/this._bounds2d.x;// Set the new scale
this._scale.x=ratio;if(this._autoScaleLockAspect){this._scale.y=ratio;}}if(this._autoScaleY){// Get the percentage as an integer
percent=parseInt(this._autoScaleY,10);// Calculate new height from percentage
newVal=parentGeom.y/100*percent;// Calculate scale ratio
ratio=newVal/this._bounds2d.y;// Set the new scale
this._scale.y=ratio;if(this._autoScaleLockAspect){this._scale.x=ratio;}}if(this._uiWidth){this.width(this._uiWidth,false,this._widthModifier,true);}if(this._uiHeight){this.height(this._uiHeight,false,this._heightModifier,true);}if(this._uiCenterPercent){this.center(this._uiCenterPercent,true);}if(this._uiMiddlePercent){this.middle(this._uiMiddlePercent,true);}if(this._uiLeftPercent){this.left(this._uiLeftPercent,true);}if(this._uiRightPercent){this.right(this._uiRightPercent,true);}if(this._uiTopPercent){this.top(this._uiTopPercent,true);}if(this._uiBottomPercent){this.bottom(this._uiBottomPercent,true);}if(this._uiCenter!==undefined){// The element is center-aligned
this._translate.x=Math.floor(this._uiCenter);}else{// The element is not center-aligned, process left and right
if(this._uiLeft!==undefined&&this._uiRight!==undefined){// Both left and right values are set, position left and assign width to reach right
this.width(parentGeom.x-this._uiLeft-this._uiRight,false,0,true);// Update translation
this._translate.x=Math.floor(this._uiLeft+geomScaled.x2-parentGeom.x2);}else{if(this._uiLeft!==undefined){// Position left aligned
this._translate.x=Math.floor(this._uiLeft+geomScaled.x2-parentGeom.x2);}if(this._uiRight!==undefined){// Position right aligned
this._translate.x=Math.floor(parentGeom.x2-geomScaled.x2-this._uiRight);}}}if(this._uiMiddle!==undefined){// The element is middle-aligned
this._translate.y=Math.floor(this._uiMiddle);}else{// The element is not middle-aligned, process top and bottom
if(this._uiTop!==undefined&&this._uiBottom!==undefined){// Both top and bottom values are set, position top and assign height to reach bottom
this.height(parentGeom.y-this._uiTop-this._uiBottom,false,0,true);// Update translation
this._translate.y=Math.floor(this._uiTop+geomScaled.y2-parentGeom.y2);}else{if(this._uiTop!==undefined){// Position top aligned
this._translate.y=Math.floor(this._uiTop+geomScaled.y2-parentGeom.y2);}if(this._uiBottom!==undefined){// Position bottom aligned
this._translate.y=Math.floor(parentGeom.y2-geomScaled.y2-this._uiBottom);}}}this.emit('uiUpdate');this.cacheDirty(true);}}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_40;};// TODO: Add "overflow" with automatic scroll-bars
var $i_41={/**
	 * Gets / sets the color to use as the font color.
	 * @param {CSSColor, CanvasGradient, CanvasPattern=} color
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */color:function(color){if(color!==undefined){this._color=color;this.cacheDirty(true);return this;}return this._color;},/**
	 * Sets the current background texture and the repeatType
	 * to determine in which axis the image should be repeated.
	 * @param {$i_50=} texture
	 * @param {String=} repeatType Accepts "repeat", "repeat-x",
	 * "repeat-y" and "no-repeat".
	 * @return {*} Returns this if any parameter is specified or
	 * the current background image if no parameters are specified.
	 */backgroundImage:function(texture,repeatType){if(texture&&texture.image){if(!repeatType){repeatType='no-repeat';}// Store the repeatType
this._patternRepeat=repeatType;// Store the texture
this._patternTexture=texture;// Resize the image if required
if(this._backgroundSize){texture.resize(this._backgroundSize.x,this._backgroundSize.y);this._patternWidth=this._backgroundSize.x;this._patternHeight=this._backgroundSize.y;}else{this._patternWidth=texture.image.width;this._patternHeight=texture.image.height;}if(this._cell>1){// We are using a cell sheet, render the cell to a
// temporary canvas and set that as the pattern image
var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var cellData=texture._cells[this._cell];canvas.width=cellData[2];canvas.height=cellData[3];ctx.drawImage(texture.image,cellData[0],cellData[1],cellData[2],cellData[3],0,0,cellData[2],cellData[3]);// Create the pattern from the texture cell
this._patternFill=ige._ctx.createPattern(canvas,repeatType);}else{// Create the pattern from the texture
this._patternFill=ige._ctx.createPattern(texture.image,repeatType);}texture.restoreOriginal();this.cacheDirty(true);return this;}return this._patternFill;},backgroundSize:function(x,y){if(x!==undefined&&y!==undefined){if(typeof x==='string'&&x!=='auto'){// Work out the actual size in pixels
// from the percentage
x=this._bounds2d.x/100*parseInt(x,10);}if(typeof y==='string'&&y!=='auto'){// Work out the actual size in pixels
// from the percentage
y=this._bounds2d.y/100*parseInt(y,10);}if(x==='auto'&&y==='auto'){this.log('Cannot set background x and y both to auto!','error');return this;}else if(x==='auto'){if(this._patternTexture&&this._patternTexture.image){// find out y change and apply it to the x
x=this._patternTexture.image.width*(y/this._patternTexture.image.height);}else{x=this._bounds2d.x*(y/this._bounds2d.y);}}else if(y==='auto'){if(this._patternTexture&&this._patternTexture.image){// find out x change and apply it to the y
y=this._patternTexture.image.height*(x/this._patternTexture.image.width);}else{y=this._bounds2d.y*(x/this._bounds2d.x);}}if(x!==0&&y!==0){this._backgroundSize={x:x,y:y};// Reset the background image
if(this._patternTexture&&this._patternRepeat){this.backgroundImage(this._patternTexture,this._patternRepeat);}this.cacheDirty(true);}else{this.log('Cannot set background to zero-sized x or y!','error');}return this;}return this._backgroundSize;},/**
	 * Gets / sets the color to use as a background when
	 * rendering the UI element.
	 * @param {CSSColor, CanvasGradient, CanvasPattern=} color
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */backgroundColor:function(color){if(color!==undefined){this._backgroundColor=color;this.cacheDirty(true);return this;}return this._backgroundColor;},/**
	 * Gets / sets the position to start rendering the background image at.
	 * @param {Number=} x
	 * @param {Number=} y
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */backgroundPosition:function(x,y){if(x!==undefined&&y!==undefined){this._backgroundPosition={x:x,y:y};this.cacheDirty(true);return this;}return this._backgroundPosition;},borderColor:function(color){if(color!==undefined){this._borderColor=color;this._borderLeftColor=color;this._borderTopColor=color;this._borderRightColor=color;this._borderBottomColor=color;this.cacheDirty(true);return this;}return this._borderColor;},borderLeftColor:function(color){if(color!==undefined){this._borderLeftColor=color;this.cacheDirty(true);return this;}return this._borderLeftColor;},borderTopColor:function(color){if(color!==undefined){this._borderTopColor=color;this.cacheDirty(true);return this;}return this._borderTopColor;},borderRightColor:function(color){if(color!==undefined){this._borderRightColor=color;this.cacheDirty(true);return this;}return this._borderRightColor;},borderBottomColor:function(color){if(color!==undefined){this._borderBottomColor=color;this.cacheDirty(true);return this;}return this._borderBottomColor;},borderWidth:function(px){if(px!==undefined){this._borderWidth=px;this._borderLeftWidth=px;this._borderTopWidth=px;this._borderRightWidth=px;this._borderBottomWidth=px;this.cacheDirty(true);return this;}return this._borderWidth;},borderLeftWidth:function(px){if(px!==undefined){this._borderLeftWidth=px;this.cacheDirty(true);return this;}return this._borderLeftWidth;},borderTopWidth:function(px){if(px!==undefined){this._borderTopWidth=px;this.cacheDirty(true);return this;}return this._borderTopWidth;},borderRightWidth:function(px){if(px!==undefined){this._borderRightWidth=px;this.cacheDirty(true);return this;}return this._borderRightWidth;},borderBottomWidth:function(px){if(px!==undefined){this._borderBottomWidth=px;this.cacheDirty(true);return this;}return this._borderBottomWidth;},borderRadius:function(px){if(px!==undefined){this._borderRadius=px;this._borderTopLeftRadius=px;this._borderTopRightRadius=px;this._borderBottomRightRadius=px;this._borderBottomLeftRadius=px;this.cacheDirty(true);return this;}return this._borderRadius;},padding:function(left,top,right,bottom){this._paddingLeft=left;this._paddingTop=top;this._paddingRight=right;this._paddingBottom=bottom;this.cacheDirty(true);return this;},paddingLeft:function(px){if(px!==undefined){this._paddingLeft=px;this.cacheDirty(true);return this;}return this._paddingLeft;},paddingTop:function(px){if(px!==undefined){this._paddingTop=px;this.cacheDirty(true);return this;}return this._paddingTop;},paddingRight:function(px){if(px!==undefined){this._paddingRight=px;this.cacheDirty(true);return this;}return this._paddingRight;},paddingBottom:function(px){if(px!==undefined){this._paddingBottom=px;this.cacheDirty(true);return this;}return this._paddingBottom;}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_41;};var nullMethod=function(){};var $i_45=function(){this.dummy=true;this.width=0;this.height=0;};$i_45.prototype.getContext=function(){return $i_46;};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_45;};var nullMethod=function(){};var $i_46={dummy:true,save:nullMethod,restore:nullMethod,translate:nullMethod,rotate:nullMethod,scale:nullMethod,drawImage:nullMethod,fillRect:nullMethod,strokeRect:nullMethod,stroke:nullMethod,fill:nullMethod,rect:nullMethod,moveTo:nullMethod,lineTo:nullMethod,arc:nullMethod,clearRect:nullMethod,beginPath:nullMethod,clip:nullMethod,transform:nullMethod,setTransform:nullMethod,fillText:nullMethod};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_46;};/**
 * Creates a new tween instance.
 */var $i_49=$i_2.extend({classId:'$i_49',init:function(targetObj,propertyObj,durationMs,options){// Create a new tween object and return it
// so the user can decide when to start it
this._targetObj=targetObj;this._steps=[];this._currentStep=-1;if(propertyObj!==undefined){this.stepTo(propertyObj);}this._durationMs=durationMs!==undefined?durationMs:0;this._started=false;this._stepDirection=false;// Sort out the options
if(options&&options.easing){this.easing(options.easing);}else{this.easing('none');}if(options&&options.startTime!==undefined){this.startTime(options.startTime);}if(options&&options.beforeTween!==undefined){this.beforeTween(options.beforeTween);}if(options&&options.afterTween!==undefined){this.afterTween(options.afterTween);}},/**
	 * Sets the object in which the properties to tween exist.
	 * @param targetObj
	 * @return {*}
	 */targetObj:function(targetObj){if(targetObj!==undefined){this._targetObj=targetObj;}return this;},/**
	 * Sets the tween's target properties to tween to.
	 * @param propertyObj
	 * @return {*}
	 */properties:function(propertyObj){if(propertyObj!==undefined){// Reset any existing steps and add this new one
this._steps=[];this._currentStep=-1;this.stepTo(propertyObj);}return this;},/**
	 * Gets / sets the repeat mode for the tween. If the mode
	 * is set to 1 the tween will repeat from the first step.
	 * If set to 2 the tween will reverse the order of the steps
	 * each time the repeat occurs. The count determines the
	 * number of times the tween will be repeated before stopping.
	 * Setting the count to -1 will make it repeat infinitely.
	 * @param val
	 * @param count
	 * @return {*}
	 */repeatMode:function(val,count){if(val!==undefined){this._repeatMode=val;this.repeatCount(count);return this;}return this._repeatMode;},/**
	 * Gets / sets the repeat count. The count determines the
	 * number of times the tween will be repeated before stopping.
	 * Setting the count to -1 will make it repeat infinitely.
	 * This setting is used in conjunction with the repeatMode()
	 * method. If you just set a repeat count and no mode then
	 * the tween will not repeat.
	 * @param val
	 * @return {*}
	 */repeatCount:function(val){if(val!==undefined){this._repeatCount=val;this._repeatedCount=0;return this;}return this._repeatCount;},/**
	 * DEPRECIATED, Renamed to stepTo().
	 */step:function(propertyObj,durationMs,easing){this.log('The step method has been renamed to stepTo(). Please update your code as the step() method will soon be removed.','warning');this.stepTo(propertyObj,durationMs,easing);return this;},/**
	 * Defines a step in a multi-stage tween. Uses the properties
	 * as destination value.
	 * @param {Object} propertyObj The properties to
	 * tween during this step.
	 * @param {Number=} durationMs The number of milliseconds
	 * to spend tweening this step, or if not provided uses
	 * the current tween durationMs setting.
	 * @param {String=} easing The name of the easing method
	 * to use during this step.
	 * @param {Boolean=} delta If true will set the step to use
	 * delta values instead of absolute values as the destination.
	 * @return {*}
	 */stepTo:function(propertyObj,durationMs,easing,delta){if(propertyObj!==undefined){// Check if we have already been given a standard
// non-staged property
this._steps.push({props:propertyObj,durationMs:durationMs,easing:easing,isDelta:delta});}return this;},/**
	 * Defines a step in a multi-stage tween. Uses the properties
	 * as deltas, not as destination values
	 * @param {Object} propertyObj The properties to
	 * tween during this step.
	 * @param {Number=} durationMs The number of milliseconds
	 * to spend tweening this step, or if not provided uses
	 * the current tween durationMs setting.
	 * @param {String=} easing The name of the easing method
	 * to use during this step.
	 * @return {*}
	 */stepBy:function(propertyObj,durationMs,easing){this.stepTo(propertyObj,durationMs,easing,true);return this;},/**
	 * Sets the duration of the tween in milliseconds.
	 * @param durationMs
	 * @return {*}
	 */duration:function(durationMs){if(durationMs!==undefined){this._durationMs=durationMs;}return this;},/**
	 * Sets the method to be called just before the tween has started.
	 * @param callback
	 * @return {*}
	 */beforeTween:function(callback){if(callback!==undefined){this._beforeTween=callback;}return this;},/**
	 * Sets the method to be called just after the tween has ended.
	 * @param callback
	 * @return {*}
	 */afterTween:function(callback){if(callback!==undefined){this._afterTween=callback;}return this;},/**
	 * Sets the method to be called just before a tween step has
	 * started.
	 * @param callback
	 * @return {*}
	 */beforeStep:function(callback){if(callback!==undefined){this._beforeStep=callback;}return this;},/**
	 * Sets the method to be called just after a tween step has
	 * ended.
	 * @param callback
	 * @return {*}
	 */afterStep:function(callback){if(callback!==undefined){this._afterStep=callback;}return this;},/**
	 * Sets the method to be called just after a tween has changed
	 * the values of the target object every update tick.
	 * @param callback
	 * @return {*}
	 */afterChange:function(callback){if(callback!==undefined){this._afterChange=callback;}return this;},/**
	 * Returns the object that this tween is modifying.
	 * @return {*}
	 */targetObject:function(){return this._targetObj;},/**
	 * Sets the name of the easing method to use with the tween.
	 * @param methodName
	 * @return {*}
	 */easing:function(methodName){if(methodName!==undefined){if(ige.tween.easing[methodName]){this._easing=methodName;}else{this.log('The easing method you have selected does not exist, please use a valid easing method. For a list of easing methods please inspect ige.tween.easing from your console.','error',ige.tween.easing);}}return this;},/**
	 * Sets the timestamp at which the tween should start.
	 * @param timeMs
	 * @return {*}
	 */startTime:function(timeMs){if(timeMs!==undefined){this._startTime=timeMs;}return this;},/**
	 * Starts the tweening operation.
	 * @param {Number=} timeMs If set, the tween will start this
	 * many milliseconds in the future.
	 */start:function(timeMs){if(timeMs!==undefined){this.startTime(timeMs+ige._currentTime);}ige.tween.start(this);// Add the tween to the target object's tween array
this._targetObj._tweenArr=this._targetObj._tweenArr||[];this._targetObj._tweenArr.push(this);return this;},/**
	 * Stops the tweening operation.
	 */stop:function(){ige.tween.stop(this);if(this._targetObj._tweenArr){this._targetObj._tweenArr.pull(this);}return this;},/**
	 * Starts all tweens registered to an object.
	 * @private
	 */startAll:function(){if(this._targetObj._tweenArr){this._targetObj._tweenArr.eachReverse(function(tweenItem){tweenItem.start();});}return this;},/**
	 * Stops all tweens registered to an object.
	 * @private
	 */stopAll:function(){if(this._targetObj._tweenArr){this._targetObj._tweenArr.eachReverse(function(tweenItem){tweenItem.stop();});}return this;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_49;};/**
 * Creates a new texture.
 */var $i_50=$i_3.extend({classId:'$i_50',$i_50:true,/**
	 * Constructor for a new $i_50.
	 * @param {String, Object} urlOrObject Either a string URL that
	 * points to the path of the image or script you wish to use as
	 * the texture image, or an object containing a smart texture.
	 * @return {*}
	 */init:function(urlOrObject,callback){this._loaded=false;// console.log("loading", urlOrObject)
// Create an array that is used to store cell dimensions
this._cells=[];this._smoothing=ige._globalSmoothing;this.callback=callback;// Instantiate filter lists for filter combinations
this._applyFilters=[];this._applyFiltersData=[];this._preFilters=[];this._preFiltersData=[];var type=typeof urlOrObject;if(type==='string'){// Load the texture URL
if(urlOrObject){this.url(urlOrObject);}}if(type==='object'){// Assign the texture script object
this.assignSmartTextureImage(urlOrObject);}},/**
	 * Gets / sets the current object id. If no id is currently assigned and no
	 * id is passed to the method, it will automatically generate and assign a
	 * new id as a 16 character hexadecimal value typed as a string.
	 * @param {String=} id
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */id:function(id){if(id!==undefined){// Check if this ID already exists in the object register
if(ige._register[id]){if(ige._register[id]===this){// We are already registered as this id
return this;}// Already an object with this ID!
this.log(`Cannot set ID of object to "${id}" because that ID is already in use by another object!`,'error');}else{// Check if we already have an id assigned
if(this._id&&ige._register[this._id]){// Unregister the old ID before setting this new one
ige.unRegister(this);}this._id=id;// Now register this object with the object register
ige.register(this);return this;}}if(!this._id){// The item has no id so generate one automatically
if(this._url){// Generate an ID from the URL string of the image
// this texture is using. Useful for always reproducing
// the same ID for the same texture :)
this._id=ige.newIdFromString(this._url);}else{// We don't have a URL so generate a random ID
this._id=ige.newIdHex();}ige.register(this);}return this._id;},/**
	 * Gets / sets the source file for this texture.
	 * @param {String=} url "The url used to load the file for this texture.
	 * @return {*}
	 */url:function(url){if(url!==undefined){this._url=url;if(url.substr(url.length-2,2)==='js'){// This is a script-based texture, load the script
this._loadScript(url);}else{// This is an image-based texture, load the image
this._loadImage(url);}return this;}return this._url;},/**
	 * Loads an image into an img tag and sets an onload event
	 * to capture when the image has finished loading.
	 * @param {String} imageUrl The image url used to load the
	 * image data.
	 * @private
	 */_loadImage:function(imageUrl){var image;var self=this;if(ige.isClient){// Increment the texture load count
ige.textureLoadStart(imageUrl,this);// Check if the image url already exists in the image cache
if(!ige._textureImageStore[imageUrl]){// Image not in cache, create the image object
image=ige._textureImageStore[imageUrl]=this.image=this._originalImage=new Image();image._igeTextures=image._igeTextures||[];// Add this texture to the textures that are using this image
image._igeTextures.push(this);image.onload=function(){// Mark the image as loaded
image._loaded=true;// Log success
ige.devLog(`Texture image (${imageUrl}) loaded successfully`);/* if (image.width % 2) {
						self.log('The texture ' + imageUrl + ' width (' + image.width + ') is not divisible by 2 to a whole number! This can cause rendering artifacts. It can also cause performance issues on some GPUs. Please make sure your texture width is divisible by 2!', 'warning');
					}

					if (image.height % 2) {
						self.log('The texture ' + imageUrl + ' height (' + image.height + ') is not divisible by 2 to a whole number! This can cause rendering artifacts. It can also cause performance issues on some GPUs. Please make sure your texture height is divisible by 2!', 'warning');
					} */ // Loop textures that are using this image
var arr=image._igeTextures;var arrCount=arr.length;var i;var item;for(i=0;i<arrCount;i++){item=arr[i];item._mode=0;item.sizeX(image.width);item.sizeY(image.height);item._cells[1]=[0,0,item._sizeX,item._sizeY];// Mark texture as loaded
item._textureLoaded();}};image.onerror=function(){if(self.callback){self.callback(true);}};// Start the image loading by setting the source url
image.src=imageUrl;}else{// Grab the cached image object
image=this.image=this._originalImage=ige._textureImageStore[imageUrl];// Add this texture to the textures that are using this image
image._igeTextures.push(this);if(image._loaded){// The cached image object is already loaded so
// fire off the relevant events
self._mode=0;self.sizeX(image.width);self.sizeY(image.height);if(image.width%2){this.log(`This texture's width is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: ${this._url}`,'warning');}if(image.height%2){this.log(`This texture's height is not divisible by 2 which will cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: ${this._url}`,'warning');}self._cells[1]=[0,0,self._sizeX,self._sizeY];// Mark texture as loaded
self._textureLoaded();}}}},_textureLoaded:function(){var self=this;// Set a timeout here so that when this event is emitted,
// the code creating the texture is given a chance to
// set a listener first, otherwise this will be emitted
// but nothing will have time to register a listener!
setTimeout(function(){self._loaded=true;self.emit('loaded');if(self.callback){self.callback();}// Inform the engine that this image has loaded
ige.textureLoadEnd(self.image.src,self);},5);},/**
	 * Loads a render script into a script tag and sets an onload
	 * event to capture when the script has finished loading.
	 * @param {String} scriptUrl The script url used to load the
	 * script data.
	 * @private
	 */_loadScript:function(scriptUrl){var textures=ige.textures;var rs_sandboxContext;var self=this;var scriptElem;ige.textureLoadStart(scriptUrl,this);if(ige.isClient){scriptElem=document.createElement('script');scriptElem.onload=function(data){self.log(`Texture script "${scriptUrl}" loaded successfully`);// Parse the JS with evil eval and store the result in the asset
eval(data);// Store the eval data (the "image" variable is declared
// by the texture script and becomes available in this scope
// because we evaluated it above)
self._mode=1;self.script=image;// Run the asset script init method
if(typeof image.init==='function'){image.init.apply(image,[self]);}// self.sizeX(image.width);
// self.sizeY(image.height);
self._loaded=true;self.emit('loaded');ige.textureLoadEnd(scriptUrl,self);};scriptElem.addEventListener('error',function(){self.log(`Error loading smart texture script file: ${scriptUrl}`,'error');},true);scriptElem.src=scriptUrl;document.getElementsByTagName('head')[0].appendChild(scriptElem);}},/**
	 * Assigns a render script to the smart texture.
	 * @param {String} scriptObj The script object.
	 * @private
	 */assignSmartTextureImage:function(scriptObj){var textures=ige.textures;var rs_sandboxContext;var self=this;var scriptElem;// Check the object has a render method
if(typeof scriptObj.render==='function'){// ige.textureLoadStart(scriptUrl, this);
// Store the script data
self._mode=1;self.script=scriptObj;// Run the asset script init method
if(typeof scriptObj.init==='function'){scriptObj.init.apply(scriptObj,[self]);}// self.sizeX(image.width);
// self.sizeY(image.height);
self._loaded=true;self.emit('loaded');// ige.textureLoadEnd(scriptUrl, self);
}else{this.log('Cannot assign smart texture because it doesn\'t have a render() method!','error');}},/**
	 * Sets the image element that the $i_50 will use when
	 * rendering. This is a special method not designed to be called
	 * directly by any game code and is used specifically when
	 * assigning an existing canvas element to an $i_50.
	 * @param {Image} imageElement The canvas / image to use as
	 * the image data for the $i_50.
	 * @private
	 */_setImage:function(imageElement){var image;var self=this;if(ige.isClient){// Create the image object
image=this.image=this._originalImage=imageElement;image._igeTextures=image._igeTextures||[];// Mark the image as loaded
image._loaded=true;this._mode=0;this.sizeX(image.width);this.sizeY(image.height);this._cells[1]=[0,0,this._sizeX,this._sizeY];}},/**
	 * Creates a new texture from a cell in the existing texture
	 * and returns the new texture.
	 * @param {Number, String} indexOrId The cell index or id to use.
	 * @return {*}
	 */textureFromCell:function(indexOrId){var tex=new $i_50();var self=this;if(this._loaded){this._textureFromCell(tex,indexOrId);}else{// The texture has not yet loaded, return the new texture and set a listener to handle
// when this texture has loaded so we can assign the texture's image properly
this.on('loaded',function(){self._textureFromCell(tex,indexOrId);});}return tex;},/**
	 * Called by textureFromCell() when the texture is ready
	 * to be processed. See textureFromCell() for description.
	 * @param {$i_50} tex The new texture to paint to.
	 * @param {Number, String} indexOrId The cell index or id
	 * to use.
	 * @private
	 */_textureFromCell:function(tex,indexOrId){var index,cell,canvas,ctx;if(typeof indexOrId==='string'){index=this.cellIdToIndex(indexOrId);}else{index=indexOrId;}if(this._cells[index]){// Create a new $i_50, then draw the existing cell
// to it's internal canvas
cell=this._cells[index];canvas=document.createElement('canvas');ctx=canvas.getContext('2d');// Set smoothing mode
// TODO: Does this cause a costly context change? If so maybe we set a global value to keep
// TODO: track of the value and evaluate first before changing?
if(!this._smoothing){ctx.imageSmoothingEnabled=false;// ctx.webkitImageSmoothingEnabled = false;
ctx.mozImageSmoothingEnabled=false;}else{ctx.imageSmoothingEnabled=true;// ctx.webkitImageSmoothingEnabled = true;
ctx.mozImageSmoothingEnabled=true;}canvas.width=cell[2];canvas.height=cell[3];// Draw the cell to the canvas
ctx.drawImage(this._originalImage,cell[0],cell[1],cell[2],cell[3],0,0,cell[2],cell[3]);// Set the new texture's image to the canvas
tex._setImage(canvas);tex._loaded=true;// Fire the loaded event
setTimeout(function(){tex.emit('loaded');},1);}else{this.log(`Unable to create new texture from passed cell index (${indexOrId}) because the cell does not exist!`,'warning');}},/**
	 * Sets the _sizeX property.
	 * @param {Number} val
	 */sizeX:function(val){this._sizeX=val;},/**
	 * Sets the _sizeY property.
	 * @param {Number} val
	 */sizeY:function(val){this._sizeY=val;},/**
	 * Resizes the original texture image to a new size. This alters
	 * the image that the texture renders so all entities that use
	 * this texture will output the newly resized version of the image.
	 * @param {Number} x The new width.
	 * @param {Number} y The new height.
	 * @param {Boolean=} dontDraw If true the resized image will not be
	 * drawn to the texture canvas. Useful for just resizing the texture
	 * canvas and not the output image. Use in conjunction with the
	 * applyFilter() and preFilter() methods.
	 */resize:function(x,y,dontDraw){if(this._originalImage){if(this._loaded){if(!this._textureCtx){// Create a new canvas
this._textureCanvas=document.createElement('canvas');}this._textureCanvas.width=x;this._textureCanvas.height=y;this._textureCtx=this._textureCanvas.getContext('2d');// Set smoothing mode
if(!this._smoothing){this._textureCtx.imageSmoothingEnabled=false;this._textureCtx.webkitImageSmoothingEnabled=false;this._textureCtx.mozImageSmoothingEnabled=false;}else{this._textureCtx.imageSmoothingEnabled=true;this._textureCtx.webkitImageSmoothingEnabled=true;this._textureCtx.mozImageSmoothingEnabled=true;}if(!dontDraw){// Draw the original image to the new canvas
// scaled as required
this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,x,y);}// Swap the current image for this new canvas
this.image=this._textureCanvas;}else{this.log(`Cannot resize texture because the texture image (${this._url}) has not loaded into memory yet!`,'error');}}},/**
	 * Resizes the original texture image to a new size based on percentage.
	 * This alters the image that the texture renders so all entities that use
	 * this texture will output the newly resized version of the image.
	 * @param {Number} x The new width.
	 * @param {Number} y The new height.
	 * @param {Boolean=} dontDraw If true the resized image will not be
	 * drawn to the texture canvas. Useful for just resizing the texture
	 * canvas and not the output image. Use in conjunction with the
	 * applyFilter() and preFilter() methods.
	 */resizeByPercent:function(x,y,dontDraw){if(this._originalImage){if(this._loaded){// Calc final x/y values
x=Math.floor(this.image.width/100*x);y=Math.floor(this.image.height/100*y);if(!this._textureCtx){// Create a new canvas
this._textureCanvas=document.createElement('canvas');}this._textureCanvas.width=x;this._textureCanvas.height=y;this._textureCtx=this._textureCanvas.getContext('2d');// Set smoothing mode
if(!this._smoothing){this._textureCtx.imageSmoothingEnabled=false;this._textureCtx.webkitImageSmoothingEnabled=false;this._textureCtx.mozImageSmoothingEnabled=false;}else{this._textureCtx.imageSmoothingEnabled=true;this._textureCtx.webkitImageSmoothingEnabled=true;this._textureCtx.mozImageSmoothingEnabled=true;}if(!dontDraw){// Draw the original image to the new canvas
// scaled as required
this._textureCtx.drawImage(this._originalImage,0,0,this._originalImage.width,this._originalImage.height,0,0,x,y);}// Swap the current image for this new canvas
this.image=this._textureCanvas;}else{this.log(`Cannot resize texture because the texture image (${this._url}) has not loaded into memory yet!`,'error');}}},/**
	 * Sets the texture image back to the original image that the
	 * texture first loaded. Useful if you have applied filters
	 * or resized the image and now want to revert back to the
	 * original.
	 */restoreOriginal:function(){this.image=this._originalImage;delete this._textureCtx;delete this._textureCanvas;this.removeFilters();},smoothing:function(val){if(val!==undefined){this._smoothing=val;return this;}return this._smoothing;},/**
	 * Renders the texture image to the passed canvas context.
	 * @param {CanvasRenderingContext2d} ctx The canvas context to draw to.
	 * @param {$i_56} entity The entity that this texture is
	 * being drawn for.
	 */render:function(ctx,entity){// Check that the cell is not set to null. If it is then
// we don't render anything which effectively makes the
// entity "blank"
if(entity._cell!==null){// TODO: Does this cause a costly context change? If so maybe we set a global value to keep
// TODO: track of the value and evaluate first before changing?
if(!this._smoothing){ige._ctx.imageSmoothingEnabled=false;// ige._ctx.webkitImageSmoothingEnabled = false;
ige._ctx.mozImageSmoothingEnabled=false;}else{ige._ctx.imageSmoothingEnabled=true;// ige._ctx.webkitImageSmoothingEnabled = true;
ige._ctx.mozImageSmoothingEnabled=true;}if(this._mode===0){// This texture is image-based
var cell=this._cells[entity._cell];var geom=entity._bounds2d;var poly=entity._renderPos;// Render pos is calculated in the $i_56.aabb() method
if(cell){if(this._preFilters.length>0&&this._textureCtx){// Call the drawing of the original image
this._textureCtx.clearRect(0,0,this._textureCanvas.width,this._textureCanvas.height);this._textureCtx.drawImage(this._originalImage,0,0);var self=this;// Call the applyFilter and preFilter methods one by one
this._applyFilters.forEach(function(method,index){self._textureCtx.save();method(self._textureCanvas,self._textureCtx,self._originalImage,self,self._applyFiltersData[index]);self._textureCtx.restore();});this._preFilters.forEach(function(method,index){self._textureCtx.save();method(self._textureCanvas,self._textureCtx,self._originalImage,self,self._preFiltersData[index]);self._textureCtx.restore();});}ctx.drawImage(this.image,cell[0],// texture x
cell[1],// texture y
cell[2],// texture width
cell[3],// texture height
poly.x,// render x
poly.y,// render y
geom.x,// render width
geom.y// render height
);ige._drawCount++;}else{this.log(`Cannot render texture using cell ${entity._cell} because the cell does not exist in the assigned texture!`,'error');}}if(this._mode===1){// This texture is script-based (a "smart texture")
ctx.save();this.script.render(ctx,entity,this);ctx.restore();ige._drawCount++;}}},/**
	 * Removes a certain filter from the texture
	 * Useful if you want to keep resizings, etc.
	 */removeFilter:function(method){var i;while((i=this._preFilters.indexOf(method))>-1){this._preFilters[i]=undefined;this._preFiltersData[i]=undefined;}while((i=this._applyFilters.indexOf(method))>-1){this._applyFilters[i]=undefined;this._applyFiltersData[i]=undefined;}this._preFilters=this._preFilters.clean();this._preFiltersData=this._preFiltersData.clean();this._applyFilters=this._applyFilters.clean();this._applyFiltersData=this._applyFiltersData.clean();this._rerenderFilters();},/**
	 * Removes all filters on the texture
	 * Useful if you want to keep resizings, etc.
	 */removeFilters:function(){this._applyFilters=[];this._applyFiltersData=[];this._preFilters=[];this._preFiltersData=[];this._rerenderFilters();},/**
	 * Rerenders image with filter list. Keeps sizings.
	 * Useful if you have no preFilters
	 */_rerenderFilters:function(){if(!this._textureCanvas)return;// Rerender applyFilters from scratch:
// Draw the basic image
// resize it to the old boundaries
this.resize(this._textureCanvas.width,this._textureCanvas.height,false);// Draw applyFilter layers upon it
var self=this;this._applyFilters.forEach(function(method,index){self._textureCtx.save();method(self._textureCanvas,self._textureCtx,self._originalImage,self,self._applyFiltersData[index]);self._textureCtx.restore();});},/**
	 * Gets / sets the pre-filter method that will be called before
	 * the texture is rendered and will allow you to modify the texture
	 * image before rendering each tick.
	 * @param method
	 * @return {*}
	 */preFilter:function(method,data){if(method!==undefined){if(this._originalImage){if(!this._textureCtx){// Create a new canvas
this._textureCanvas=document.createElement('canvas');this._textureCanvas.width=this._originalImage.width;this._textureCanvas.height=this._originalImage.height;this._textureCtx=this._textureCanvas.getContext('2d');// Set smoothing mode
if(!this._smoothing){this._textureCtx.imageSmoothingEnabled=false;this._textureCtx.webkitImageSmoothingEnabled=false;this._textureCtx.mozImageSmoothingEnabled=false;}else{this._textureCtx.imageSmoothingEnabled=true;this._textureCtx.webkitImageSmoothingEnabled=true;this._textureCtx.mozImageSmoothingEnabled=true;}}// Swap the current image for this new canvas
this.image=this._textureCanvas;// Save filter in active preFilter list
this._preFilters[this._preFilters.length]=method;this._preFiltersData[this._preFiltersData.length]=!data?{}:data;}return this;}else{this.log('Cannot use pre-filter, no filter method was passed!','warning');}return this._preFilters[this._preFilters.length-1];},/**
	 * Applies a filter to the texture. The filter is a method that will
	 * take the canvas, context and originalImage parameters and then
	 * use context calls to alter / paint the context with the texture
	 * and any filter / adjustments that you want to apply.
	 * @param {Function} method
	 * @param {Object=} data
	 * @return {*}
	 */applyFilter:function(method,data){if(this._loaded){if(method!==undefined){if(this._originalImage){if(!this._textureCtx){// Create a new canvas
this._textureCanvas=document.createElement('canvas');this._textureCanvas.width=this._originalImage.width;this._textureCanvas.height=this._originalImage.height;this._textureCtx=this._textureCanvas.getContext('2d');// Draw the basic image
this._textureCtx.clearRect(0,0,this._textureCanvas.width,this._textureCanvas.height);this._textureCtx.drawImage(this._originalImage,0,0);// Set smoothing mode
if(!this._smoothing){this._textureCtx.imageSmoothingEnabled=false;this._textureCtx.webkitImageSmoothingEnabled=false;this._textureCtx.mozImageSmoothingEnabled=false;}else{this._textureCtx.imageSmoothingEnabled=true;this._textureCtx.webkitImageSmoothingEnabled=true;this._textureCtx.mozImageSmoothingEnabled=true;}}// Swap the current image for this new canvas
this.image=this._textureCanvas;// Call the passed method
if(this._preFilters.length<=0){this._textureCtx.save();method(this._textureCanvas,this._textureCtx,this._originalImage,this,data);this._textureCtx.restore();}// Save filter in active applyFiler list
this._applyFilters[this._applyFilters.length]=method;this._applyFiltersData[this._applyFiltersData.length]=!data?{}:data;}}else{this.log('Cannot apply filter, no filter method was passed!','warning');}}else{this.log('Cannot apply filter, the texture you are trying to apply the filter to has not yet loaded!','error');}return this;},/**
	 * Retrieves pixel data from x,y texture coordinate (starts from top-left).
	 * Important: If the texture has a cross-domain url, the image host must allow
	 * cross-origin resource sharing or a security error will be thrown.
	 * Reference: http://blog.chromium.org/2011/07/using-cross-domain-images-in-webgl-and.html
	 * @param  {Number} x
	 * @param  {Number} y
	 * @return {Array} [r,g,b,a] Pixel data.
	 */pixelData:function(x,y){if(this._loaded){if(this.image){// Check if the texture is already using a canvas
if(!this._textureCtx){// Create a new canvas
this._textureCanvas=document.createElement('canvas');this._textureCanvas.width=this.image.width;this._textureCanvas.height=this.image.height;this._textureCtx=this._textureCanvas.getContext('2d');// Set smoothing mode
if(!this._smoothing){this._textureCtx.imageSmoothingEnabled=false;this._textureCtx.webkitImageSmoothingEnabled=false;this._textureCtx.mozImageSmoothingEnabled=false;}else{this._textureCtx.imageSmoothingEnabled=true;this._textureCtx.webkitImageSmoothingEnabled=true;this._textureCtx.mozImageSmoothingEnabled=true;}// Draw the image to the canvas
this._textureCtx.drawImage(this.image,0,0);}else{this._textureCtx=this._textureCtx;}return this._textureCtx.getImageData(x,y,1,1).data;}}else{this.log('Cannot read pixel data, the texture you are trying to read data from has not yet loaded!','error');}return this;},/**
	 * Creates a clone of the texture.
	 * @return {$i_50} A new, distinct texture with the same attributes
	 * as the one being cloned.
	 */clone:function(){return this.textureFromCell(1);},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object.
	 * @return {String}
	 */stringify:function(){var str=`new ${this.classId()}('${this._url}')`;// Every object has an ID, assign that first
// We've commented this because ids for textures are actually generated
// from their asset so will ALWAYS produce the same ID as long as the asset
// is the same path.
// str += ".id('" + this.id() + "')";
// Now get all other properties
str+=this._stringify();return str;},_stringify:function(){return'';},/**
	 * Destroys the item.
	 */destroy:function(){delete this._eventListeners;// Remove us from the image store reference array
if(this.image&&this.image._igeTextures){this.image._igeTextures.pull(this);}// Remove the texture from the texture store
ige._textureStore.pull(this);delete this.image;delete this.script;delete this._textureCanvas;delete this._textureCtx;this._destroyed=true;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_50;};/**
 * Creates a new cell sheet. Cell sheets are textures that are
 * automatically split up into individual cells based on a cell
 * width and height.
 */var $i_51=$i_50.extend({classId:'$i_51',$i_52:true,init:function(url,horizontalCells,verticalCells,shouldScale,spriteCellSheet,entity){var self=this;self.shouldScale=shouldScale;self.spriteCellSheet=spriteCellSheet;self.horizontalCells(horizontalCells||1);self.verticalCells(verticalCells||1);var callbackIfNotLoaded=function(err){if(err&&entity){var entityType=entity._category==='item'?entity._stats.itemTypeId:entity._stats.type;var defaultUrl=ige.game.getAsset(`${entity._category}Types`,entityType).cellSheet.url;$i_50.prototype.init.call(self,defaultUrl);}};$i_50.prototype.init.call(this,url,spriteCellSheet&&entity?callbackIfNotLoaded:undefined);},_textureLoaded:function(){if(this.image){// Store the cell sheet image
this._sheetImage=this.image;this._applyCells();}else{// Unable to create cells from non-image texture
// TODO: Low-priority - Support cell sheets from smart-textures
this.log('Cannot create cell-sheet because texture has not loaded an image!','error');}$i_50.prototype._textureLoaded.call(this);},/**
	 * Returns the total number of cells in the cell sheet.
	 * @return {Number}
	 */cellCount:function(){return this.horizontalCells()*this.verticalCells();},/**
	 * Gets / sets the number of horizontal cells in the cell sheet.
	 * @param {Number=} val The integer count of the number of horizontal cells in the cell sheet.
	 */horizontalCells:function(val){if(val!==undefined){this._cellColumns=val;return this;}return this._cellColumns;},/**
	 * Gets / sets the number of vertical cells in the cell sheet.
	 * @param {Number=} val The integer count of the number of vertical cells in the cell sheet.
	 */verticalCells:function(val){if(val!==undefined){this._cellRows=val;return this;}return this._cellRows;},/**
	 * Sets the x, y, width and height of each sheet cell and stores
	 * that information in the this._cells array.
	 * @private
	 */_applyCells:function(){var imgWidth,imgHeight,rows,columns,cellWidth,cellHeight,cellIndex,xPos,yPos;// Do we have an image to use?
if(this.image){// Check we have the correct data for a uniform cell layout
if(this._cellRows&&this._cellColumns){imgWidth=this._sizeX;imgHeight=this._sizeY;if(this.shouldScale){imgWidth=this._sizeX*ige.scaleMapDetails.scaleFactor.x;imgHeight=this._sizeY*ige.scaleMapDetails.scaleFactor.y;}rows=this._cellRows;columns=this._cellColumns;// Store the width and height of a single cell
cellWidth=this._cellWidth=imgWidth/columns;cellHeight=this._cellHeight=imgHeight/rows;// Check if the cell width and height are non-floating-point
if(cellWidth!==parseInt(cellWidth,10)){this.log(`Cell width is a floating-point number! (Image Width ${imgWidth} / Number of Columns ${columns} = ${cellWidth}) in file: ${this._url}`,'warning');}if(cellHeight!==parseInt(cellHeight,10)){this.log(`Cell height is a floating-point number! (Image Height ${imgHeight} / Number of Rows ${rows} = ${cellHeight})  in file: ${this._url}`,'warning');}// Check if we need to calculate individual cell data
if(rows>1||columns>1){for(cellIndex=1;cellIndex<=rows*columns;cellIndex++){yPos=Math.ceil(cellIndex/columns)-1;xPos=cellIndex-columns*yPos-1;// Store the xy in the sheet frames variable
this._cells[cellIndex]=[xPos*cellWidth,yPos*cellHeight,cellWidth,cellHeight];}}else{// The cell data shows only one cell so just store the whole image data
this._cells[1]=[0,0,this._sizeX,this._sizeY];}}}},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object.
	 * @return {String}
	 */stringify:function(){var str=`new ${this.classId()}('${this.url()}', ${this.horizontalCells()}, ${this.verticalCells()})`;// Every object has an ID, assign that first
// IDs are automatically generated from texture urls
// str += ".id('" + this.id() + "');";
return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_50;};/**
 * Creates a new sprite sheet that cuts an image up into
 * arbitrary sections.
 */var $i_52=$i_50.extend({classId:'$i_52',$i_52:true,init:function(url,cells){this._spriteCells=cells;$i_50.prototype.init.call(this,url);},_textureLoaded:function(){if(this.image){// Store the cell sheet image
this._sheetImage=this.image;var i;var cells=this._spriteCells;if(!cells){// Try to automatically determine cells
this.log('No cell data provided for sprite sheet, attempting to automatically detect sprite bounds...');cells=this.detectCells(this._sheetImage);}// Cells in the sheets always start at index
// 1 so move all the cells one forward
for(i=0;i<cells.length;i++){this._cells[i+1]=cells[i];if(this._checkModulus){// Check cell for division by 2 modulus warnings
if(cells[i][2]%2){this.log(`This texture's cell definition defines a cell width is not divisible by 2 which can cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: ${this._url}`,'warning',cells[i]);}if(cells[i][3]%2){this.log(`This texture's cell definition defines a cell height is not divisible by 2 which can cause the texture to use sub-pixel rendering resulting in a blurred image. This may also slow down the renderer on some browsers. Image file: ${this._url}`,'warning',cells[i]);}}}}else{// Unable to create cells from non-image texture
// TODO: Low-priority - Support cell sheets from smart-textures
this.log('Cannot create cell-sheet because texture has not loaded an image!','error');}$i_50.prototype._textureLoaded.call(this);},/**
	 * Uses the sprite sheet image pixel data to detect distinct sprite
	 * bounds.
	 * @param img
	 * @return {Array} An array of cell bounds.
	 */detectCells:function(img){// Create a temp canvas
var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var pixels;var x;var y;var newRect;var spriteRects=[];canvas.width=img.width;canvas.height=img.height;// Draw the sheet to the canvas
ctx.drawImage(img,0,0);// Read the pixel data
pixels=ctx.getImageData(0,0,canvas.width,canvas.height);// Loop the pixels and find non-transparent one
for(y=0;y<canvas.height;y++){for(x=0;x<canvas.width;x++){// Check if the pixel is not transparent
if(!pixels.isTransparent(x,y)){// We found a non-transparent pixel so
// is it in a rect we have already defined?
if(!this._pixelInRects(spriteRects,x,y)){// The pixel is not already in a rect,
// so determine the bounding rect for
// the new sprite whose pixel we've found
newRect=this._determineRect(pixels,x,y);if(newRect){spriteRects.push(newRect);}else{this.log('Cannot automatically determine sprite bounds!','warning');return[];}}}}}return spriteRects;},_pixelInRects:function(rects,x,y){var rectIndex;var rectCount=rects.length;var rect;for(rectIndex=0;rectIndex<rectCount;rectIndex++){rect=rects[rectIndex];// Check if the x, y is inside this rect
if(x>=rect.x&&x<=rect.x+rect.width&&y>=rect.y&&y<=rect.y+rect.height){// The x, y is inside this rect
return true;}}return false;},_determineRect:function(pixels,x,y){var pixArr=[{x:x,y:y}];var rect={x:x,y:y,width:1,height:1};var currentPixel;while(pixArr.length){// De-queue front item
currentPixel=pixArr.shift();// Expand rect to include pixel position
if(currentPixel.x>rect.x+rect.width){rect.width=currentPixel.x-rect.x+1;}if(currentPixel.y>rect.y+rect.height){rect.height=currentPixel.y-rect.y+1;}if(currentPixel.x<rect.x){rect.width+=rect.x-currentPixel.x;rect.x=currentPixel.x;}if(currentPixel.y<rect.y){rect.height+=rect.y-currentPixel.y;rect.y=currentPixel.y;}// Check surrounding pixels
if(!pixels.isTransparent(currentPixel.x-1,currentPixel.y-1)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x-1,currentPixel.y-1);// Add pixel position to queue
pixArr.push({x:currentPixel.x-1,y:currentPixel.y-1});}if(!pixels.isTransparent(currentPixel.x,currentPixel.y-1)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x,currentPixel.y-1);// Add pixel position to queue
pixArr.push({x:currentPixel.x,y:currentPixel.y-1});}if(!pixels.isTransparent(currentPixel.x+1,currentPixel.y-1)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x+1,currentPixel.y-1);// Add pixel position to queue
pixArr.push({x:currentPixel.x+1,y:currentPixel.y-1});}if(!pixels.isTransparent(currentPixel.x-1,currentPixel.y)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x-1,currentPixel.y);// Add pixel position to queue
pixArr.push({x:currentPixel.x-1,y:currentPixel.y});}if(!pixels.isTransparent(currentPixel.x+1,currentPixel.y)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x+1,currentPixel.y);// Add pixel position to queue
pixArr.push({x:currentPixel.x+1,y:currentPixel.y});}if(!pixels.isTransparent(currentPixel.x-1,currentPixel.y+1)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x-1,currentPixel.y+1);// Add pixel position to queue
pixArr.push({x:currentPixel.x-1,y:currentPixel.y+1});}if(!pixels.isTransparent(currentPixel.x,currentPixel.y+1)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x,currentPixel.y+1);// Add pixel position to queue
pixArr.push({x:currentPixel.x,y:currentPixel.y+1});}if(!pixels.isTransparent(currentPixel.x+1,currentPixel.y+1)){// Mark pixel so we dont use it again
pixels.makeTransparent(currentPixel.x+1,currentPixel.y+1);// Add pixel position to queue
pixArr.push({x:currentPixel.x+1,y:currentPixel.y+1});}}return[rect.x,rect.y,rect.width,rect.height];},/**
	 * Returns the total number of cells in the cell sheet.
	 * @return {Number}
	 */cellCount:function(){return this._cells.length;},/**
	 * Returns the cell index that the passed cell id corresponds
	 * to.
	 * @param {String} id
	 * @return {Number} The cell index that the cell id corresponds
	 * to or -1 if a corresponding index could not be found.
	 */cellIdToIndex:function(id){var cells=this._cells;var i;for(i=1;i<cells.length;i++){if(cells[i][4]===id){// Found the cell id so return the index
return i;}}return-1;},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object.
	 * @return {String}
	 */stringify:function(){var str=`new ${this.classId()}('${this.url()}', ${this._cells.toString()})`;// Every object has an ID, assign that first
// IDs are automatically generated from texture urls
// str += ".id('" + this.id() + "');";
return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_52;};/* TODO: URGENT - Make this alignment stuff work inside the bounds of the entity it is attached to
 * so that bottom-right aligns to the lower-right point of the bounding box of the entity
 * whilst maintaining the current text-alignment as well
* */ /**
 * Creates a new font sheet. A font sheet is an image that contains
 * letters and numbers rendered to specifications. It allows you to
 * use and render text fonts without the font actually existing on
 * the target system that the engine is running in.
 */var $i_53=$i_50.extend({classId:'$i_53',init:function(url){$i_50.prototype.init.call(this,url);if(arguments[1]){this.log('Font sheets no longer accept a caching limit value. All font output is now cached by default via the actual font entity - fontEntity.cache(true);','warning');}// Set the _noDimensions flag which tells any entity
// that assigns this texture that the texture has an
// unknown width/height so it should not get it's
// dimension data from the texture
this._noDimensions=true;// Set a listener for when the texture loads
this.on('loaded',function(){if(this.image){// Store the cell sheet image
this._sheetImage=this.image;// Get the font sheet data header
try{this._fontData=this.decodeHeader();// Cache access to looped data
if(this._fontData){this._charCodeMap=this._fontData.characters.charCodes;this._charPosMap=this._fontData.characters.charPosition;this._measuredWidthMap=this._fontData.characters.measuredWidth;this._pixelWidthMap=this._fontData.characters.pixelWidth;var header=this._fontData.font;this.log(`Loaded font sheet for font: ${header.fontName} @ ${header.fontSize}${header.fontSizeUnit} in ${header.fontColor}`);}else{this.log(`Could not load data header for font sheet: ${this.image.src}`,'error');}}catch(e){this.log(`Could not load data header for font sheet: ${this.image.src} = ${e.toString()}`,'error');}}});},decodeHeader:function(){// Create a temporary canvas
var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');// Set canvas width to match font sheet image and
// height to 1 as we have 1 line of header data
canvas.width=this.image.width;canvas.height=1;// Draw the font sheet to the canvas
ctx.drawImage(this.image,0,0);// Decode the font sheet pixel-encoded data
return this._decode(canvas,0,0,this.image.width);},_decode:function(canvas,x,y,maxX){'use strict';var ctx=canvas.getContext('2d');var imageData=ctx.getImageData(x,y,maxX,canvas.height).data;var run=true;var quadCode;var i=0;var jsonString='';while(run){quadCode=`${String(imageData[i])} ${String(imageData[i+1])} ${String(imageData[i+2])}`;if(quadCode==='3 2 1'){// We have scanned the terminal code
// so exit the loop
run=false;return JSON.parse(jsonString);}else{jsonString+=String.fromCharCode(imageData[i])+String.fromCharCode(imageData[i+1])+String.fromCharCode(imageData[i+2]);}i+=4;if(i>imageData.length){run=false;console.log('Image JSON Decode Error!');}}},lineHeightModifier:function(val){if(typeof val!=='undefined'){this._lineHeightModifier=val;}},/**
	 * Returns the width in pixels of the text passed in the
	 * argument.
	 * @param {String} text The text to measure.
	 * @returns {number}
	 */measureTextWidth:function(text){if(this._loaded){var characterIndex;var charCodeMap=this._charCodeMap;var measuredWidthMap=this._measuredWidthMap;var charIndex;var lineArr=[];var lineIndex;var measuredWidth;var maxWidth=0;// Handle multi-line text
if(text.indexOf('\n')>-1){// Split each line into an array item
lineArr=text.split('\n');}else{// Store the text as a single line
lineArr.push(text);}for(lineIndex=0;lineIndex<lineArr.length;lineIndex++){// Calculate the total width of the line of text
measuredWidth=0;for(characterIndex=0;characterIndex<lineArr[lineIndex].length;characterIndex++){charIndex=charCodeMap[lineArr[lineIndex].charCodeAt(characterIndex)];measuredWidth+=measuredWidthMap[charIndex]||0;}if(measuredWidth>maxWidth){maxWidth=measuredWidth;}}// Store the width of this line so we can align it correctly
return measuredWidth;}return-1;},render:function(ctx,entity){if(entity._renderText&&this._loaded){var _ctx=ctx;var text=entity._renderText;var lineText;var lineArr=[];var lineIndex;var characterIndex;var charCodeMap=this._charCodeMap;var charPosMap=this._charPosMap;var measuredWidthMap=this._measuredWidthMap;var pixelWidthMap=this._pixelWidthMap;var renderX=0;var renderY=0;var renderStartX=0;var renderStartY=0;var masterX=0;var masterY=0;var lineWidth=[];var lineHeight=this._sizeY-2;var singleLineWidth=0;var totalWidth=0;var totalHeight;var charIndex;// Handle multi-line text
if(text.indexOf('\n')>-1){// Split each line into an array item
lineArr=text.split('\n');}else{// Store the text as a single line
lineArr.push(text);}totalHeight=lineHeight*lineArr.length;// TODO: Y-based alignment doesn't work at the moment. Fix it!
// Handle text alignment y
switch(entity._textAlignY){case 0:// Align top
renderStartY=-(lineHeight*lineArr.length/2)-entity._textLineSpacing*((lineArr.length-1)/2);// 0;
break;case 1:// Align middle
renderStartY=-(lineHeight*lineArr.length/2)-entity._textLineSpacing*((lineArr.length-1)/2);break;case 2:// Align bottom
renderStartY=-(lineHeight*lineArr.length/2)-entity._textLineSpacing*((lineArr.length-1)/2);// -((lineHeight) * (lineArr.length)) - (entity._textLineSpacing * (lineArr.length - 1));
break;}// Calculate the total text width of each line
for(lineIndex=0;lineIndex<lineArr.length;lineIndex++){lineText=lineArr[lineIndex];for(characterIndex=0;characterIndex<lineText.length;characterIndex++){charIndex=charCodeMap[lineText.charCodeAt(characterIndex)];singleLineWidth+=measuredWidthMap[charIndex]||0;}// Store the width of this line so we can align it correctly
lineWidth[lineIndex]=singleLineWidth;if(singleLineWidth>totalWidth){totalWidth=singleLineWidth;}singleLineWidth=0;}// Handle text cached alignment x
switch(entity._textAlignX){case 0:// Align left
renderStartX=-entity._bounds2d.x2;break;case 1:// Align center
renderStartX=-totalWidth/2;break;case 2:// Align right
renderStartX=entity._bounds2d.x2-totalWidth;break;}/* _ctx.strokeStyle = '#ff0000';
			_ctx.strokeRect(renderStartX, renderStartY, totalWidth, totalHeight); */for(lineIndex=0;lineIndex<lineArr.length;lineIndex++){lineText=lineArr[lineIndex];renderY=lineHeight*lineIndex+entity._textLineSpacing*lineIndex;// Handle text alignment x
switch(entity._textAlignX){case 0:// Align left
renderX=-entity._bounds2d.x2;break;case 1:// Align center
renderX=-lineWidth[lineIndex]/2;break;case 2:// Align right
renderX=entity._bounds2d.x2-lineWidth[lineIndex];break;}for(characterIndex=0;characterIndex<lineText.length;characterIndex++){charIndex=charCodeMap[lineText.charCodeAt(characterIndex)];_ctx.drawImage(this.image,charPosMap[charIndex],// texture x
2,// texture y
pixelWidthMap[charIndex],// texture width
this._sizeY-2,// texture height
Math.floor(masterX+renderX),// render x TODO: Performance - Cache these?
Math.floor(masterY+renderStartY+renderY),// render y
pixelWidthMap[charIndex],// render width
this._sizeY-2// render height
);// Check if we should overlay with a colour
if(entity._colorOverlay){_ctx.save();// Set the composite operation and draw the colour over the top
_ctx.globalCompositeOperation='source-atop';_ctx.fillStyle=entity._colorOverlay;_ctx.fillRect(Math.floor(masterX+renderX),// render x TODO: Performance - Cache these?
Math.floor(masterY+renderStartY+renderY),// render y
pixelWidthMap[charIndex],// render width
this._sizeY-2// render height
);_ctx.restore();}renderX+=measuredWidthMap[charIndex]||0;ige._drawCount++;}renderX=0;}}},destroy:function(){this.image=null;this.script=null;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_53;};/**
 * Provides native canvas font rendering supporting multi-line
 * text and alignment options.
 */var $i_54={measureTextWidth:function(text,entity){if(entity._nativeFont){var lineArr=[];var lineIndex;var measuredWidth;var maxWidth=0;var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');// Handle multi-line text
if(text.indexOf('\n')>-1){// Split each line into an array item
lineArr=text.split('\n');}else{// Store the text as a single line
lineArr.push(text);}ctx.font=entity._nativeFont;ctx.textBaseline='middle';if(entity._nativeStroke){ctx.lineWidth=entity._nativeStroke;if(entity._nativeStrokeColor){ctx.strokeStyle=entity._nativeStrokeColor;}else{ctx.strokeStyle=entity._colorOverlay;}}for(lineIndex=0;lineIndex<lineArr.length;lineIndex++){// Measure text
measuredWidth=ctx.measureText(lineArr[lineIndex]).width;if(measuredWidth>maxWidth){maxWidth=measuredWidth;}}return maxWidth;}return-1;},render:function(ctx,entity){if(entity._nativeFont&&entity._renderText){var text=entity._renderText;var lineArr=[];var textSize;var renderStartY;var renderY;var lineHeight;var i;ctx.font=entity._nativeFont;ctx.textBaseline='middle';if(entity._colorOverlay){ctx.fillStyle=entity._colorOverlay;}// Text alignment
if(entity._textAlignX===0){ctx.textAlign='left';ctx.translate(-entity._bounds2d.x2,0);}if(entity._textAlignX===1){ctx.textAlign='center';// ctx.translate(-entity._bounds2d.x2, 0);
}if(entity._textAlignX===2){ctx.textAlign='right';ctx.translate(entity._bounds2d.x2,0);}if(entity._nativeStroke){ctx.lineWidth=entity._nativeStroke;if(entity._nativeStrokeColor){ctx.strokeStyle=entity._nativeStrokeColor;}else{ctx.strokeStyle=entity._colorOverlay;}}// Handle multi-line text
if(text.indexOf('\n')>-1){// Split each line into an array item
lineArr=text.split('\n');}else{// Store the text as a single line
lineArr.push(text);}lineHeight=Math.floor(entity._bounds2d.y/lineArr.length);renderStartY=-((lineHeight+entity._textLineSpacing)/2)*(lineArr.length-1);for(i=0;i<lineArr.length;i++){renderY=renderStartY+lineHeight*i+entity._textLineSpacing*i;// Measure text
textSize=ctx.measureText(lineArr[i]);// Check if we should stroke the text too
if(entity._nativeStroke){ctx.strokeText(lineArr[i],0,renderY);}// Draw text
ctx.fillText(lineArr[i],0,renderY);}}}};;/**
 * Creates a new object.
 */var $i_55=$i_3.extend({classId:'$i_55',init:function(){this._newBorn=true;this._alive=true;this._mode=0;this._mountMode=0;this._parent=null;this._children=[];this._layer=0;this._depth=0;this._depthSortMode=0;this._serverStream=[];this._inView=true;this._managed=1;this._specialProp=['_id','_parent','_children'];// if (ige.isClient) {
// 	this.viewChecking(true);
// }
},/**
	 * Determines if the object is alive or not. The alive
	 * value is automatically set to false when the object's
	 * destroy() method is called. Useful for checking if
	 * an object that you are holding a reference to has been
	 * destroyed.
	 * @param {Boolean=} val The value to set the alive flag
	 * to.
	 * @example #Get the alive flag value
	 *     var entity = new $i_56();
	 *     console.log(entity.alive());
	 * @example #Set the alive flag value
	 *     var entity = new $i_56();
	 *     entity.alive(true);
	 * @return {*}
	 */alive:function(val){if(val!==undefined){this._alive=val;return this;}return this._alive;},/**
	 * Gets / set the managed mode from 0 to 2. 0 = off, 1 = static, 2 = dynamic.
	 *
	 * @param {Number=} val Set to 0 to switch off managed mode, 1 to set to static
	 * managed mode or 2 to dynamic managed mode. When in a managed mode and when
	 * the parent of this entity has an entity manager component enabled, the entity
	 * will be checked to see if it is inside the visible area of a viewport. If it
	 * is deemed not to be in a visible area (via it's AABB non-intersection with
	 * viewport view area) then it will either be un-mounted from the parent (mode 1)
	 * or marked as no longer in view (mode 2). Mode 2 in view = false will cause the
	 * entity to no longer be depth-sorted or rendered but will still have it's
	 * update() method called each frame allowing logic processing to occur as normal.
	 * The default managed mode is 1.
	 * @returns {*}
	 */managed:function(val){if(val!==undefined){this._managed=val;return this;}return this._managed;},/**
	 * Gets / sets the current object id. If no id is currently assigned and no
	 * id is passed to the method, it will automatically generate and assign a
	 * new id as a 16 character hexadecimal value typed as a string.
	 * @param {String=} id
	 * @example #Get the id of an entity
	 *     var entity = new $i_56();
	 *     console.log(entity.id());
	 * @example #Set the id of an entity
	 *     var entity = new $i_56();
	 *     entity.id('myNewId');
	 * @example #Set the id of an entity via chaining
	 *     var entity = new $i_56()
	 *         .id('myNewId');
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */id:function(id){if(id!==undefined){// Check if we're changing the id
if(id!==this._id){// Check if this ID already exists in the object register
if(ige._register[id]){// Already an object with this ID!
if(ige._register[id]!==this){this.log(`Cannot set ID of object to "${id}" because that ID is already in use by another object!`,'error');}}else{// Check if we already have an id assigned
if(this._id&&ige._register[this._id]){// Unregister the old ID before setting this new one
ige.unRegister(this);}this._id=id;// Now register this object with the object register
ige.register(this);return this;}}else{// The same ID we already have is being applied,
// ignore the request and return
return this;}}if(!this._id){// The item has no id so generate one automatically
this._id=ige.newIdHex();ige.register(this);}return this._id;},/**
	 * Gets / sets the arbitrary category name that the object belongs to.
	 * @param {String=} val
	 * @example #Get the category of an entity
	 *     var entity = new $i_56();
	 *     console.log(entity.category());
	 * @example #Set the category of an entity
	 *     var entity = new $i_56();
	 *     entity.category('myNewCategory');
	 * @example #Set the category of an entity via chaining
	 *     var entity = new $i_56()
	 *         .category('myNewCategory');
	 * @example #Get all the entities belonging to a category
	 *     var entityArray = ige.$$('categoryName');
	 * @example #Remove the category of an entity
	 *     // Set category to some name
	 *     var entity = new $i_56()
	 *         .category('myCategory');
	 *
	 *     // Will output "myCategory"
	 *     console.log(entity.category());
	 *
	 *     // Now remove the category
	 *     entity.category('');
	 *
	 *     // Will return ""
	 *     console.log(entity.category());
	 * @return {*}
	 */category:function(val){if(val!==undefined){// Check if we already have a category
if(this._category){// Check if the category being assigned is different from
// the current one
if(this._category!==val){// The category is different so remove this object
// from the current category association
ige.categoryUnRegister(this);}}this._category=val;// Check the category is not a blank string
if(val){// Now register this object with the category it has been assigned
ige.categoryRegister(this);}return this;}return this._category;},/**
	 * DEPRECIATED - Use category() instead. A warning method to
	 * help developers move to the new groups system.
	 */group:function(){this.log('The group() method has been renamed to category(). Please update your code.','error');},/**
	 * Adds this entity to a group or groups passed as
	 * arguments.
	 * @param {*} groupName A group or array of group names
	 * to add the entity to.
	 * @example #Add entity to a single group
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1');
	 * @example #Add entity to multiple groups
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2', 'g3');
	 * @example #Add entity to multiple groups via an array
	 *     var entity = new $i_56();
	 *     entity.addGroup(['g1', 'g2', 'g3']);
	 * @example #Add entity to multiple groups via multiple arrays
	 *     var entity = new $i_56();
	 *     entity.addGroup(['g1', 'g2', 'g3'], ['g4', 'g5']);
	 * @return {*}
	 */addGroup:function(){var arrCount=arguments.length;var groupName;var groupItemCount;while(arrCount--){groupName=arguments[arrCount];// Check if the argument is an array
if(groupName instanceof Array){groupItemCount=groupName.length;// Add each group of the array to the entity
while(groupItemCount--){if(!this._groups||this._groups.indexOf(groupName[groupItemCount])===-1){this._groups=this._groups||[];this._groups.push(groupName[groupItemCount]);// Now register this object with the group it has been assigned
ige.groupRegister(this,groupName[groupItemCount]);}}}else{if(!this._groups||this._groups.indexOf(groupName)===-1){this._groups=this._groups||[];this._groups.push(groupName);// Now register this object with the group it has been assigned
ige.groupRegister(this,groupName);}}}return this;},/**
	 * Checks if the entity is in the group or array of group
	 * names passed.
	 * @param {*} groupName A group name or array of names.
	 * @param {Boolean=} matchAllGroups If set to true, will cause
	 * the method to check if the entity is in ALL the groups,
	 * otherwise the method will check if the entity is in ANY group.
	 * @example #Check if the entity is in a group
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2');
	 *
	 *     // Will output true since entity is part of g1 group
	 *     console.log(entity.inGroup('g1', false);
	 *
	 *     // Will output false since entity is not part of g3 group
	 *     console.log(entity.inGroup('g3', false);
	 * @example #Check if the entity is in an array of groups using ANY and ALL options
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2');
	 *
	 *     // Will output true since entity is part of g1 group
	 *     console.log(entity.inGroup(['g1, 'g3'], false);
	 *
	 *     // Will output false since entity is not part of g3 group
	 *     console.log(entity.inGroup(['g1, 'g3'], true);
	 * @return {Boolean}
	 */inGroup:function(groupName,matchAllGroups){if(groupName){if(matchAllGroups){return this.inAllGroups(groupName);}else{return this.inAnyGroup(groupName);}}return false;},/**
	 * Checks if the entity is in the specified group or
	 * array of groups. If multiple group names are passed,
	 * as an array the method will only return true if the
	 * entity is in ALL the passed groups.
	 * @param {*} groupName The name of the group or array
	 * if group names to check if this entity is a member of.
	 * @example #Check if entity belongs to all of the passed groups
	 *     // Add a couple of groups
	 *     var entity = new $i_56();
	 *     entity.addGroup(['g1', 'g2']);
	 *
	 *     // This will output "false" (entity is not part of g3)
	 *     console.log(entity.inAllGroups(['g1', 'g3']));
	 *
	 *     // This will output "true"
	 *     console.log(entity.inAllGroups('g1'));
	 *
	 *     // This will output "true"
	 *     console.log(entity.inAllGroups(['g1', 'g2']));
	 * @return {Boolean}
	 */inAllGroups:function(groupName){var arrItem,arrCount;if(groupName instanceof Array){arrCount=groupName.length;while(arrCount--){arrItem=groupName[arrCount];if(arrItem){if(!this._groups||this._groups.indexOf(arrItem)===-1){return false;}}}}else{return!(!this._groups||this._groups.indexOf(groupName)===-1);}return true;},/**
	 * Checks if the entity is in the specified group or
	 * array of group names. If multiple group names are passed
	 * as an array, the method will return true if the entity
	 * is in ANY of the the passed groups.
	 * @param {*} groupName The name of the group or array of
	 * group names to check if this entity is a member of.
	 * @example #Check if entity belongs to any of the passed groups
	 *     // Add a couple of groups
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2');
	 *
	 *     // This will output "false"
	 *     console.log(entity.inAnyGroup('g3'));
	 *
	 *     // This will output "true"
	 *     console.log(entity.inAnyGroup(['g3', 'g1']));
	 * @return {Boolean}
	 */inAnyGroup:function(groupName){var arrItem,arrCount;if(groupName instanceof Array){arrCount=groupName.length;while(arrCount--){arrItem=groupName[arrCount];if(arrItem){if(this._groups&&this._groups.indexOf(arrItem)>-1){return true;}}}}else{return this._groups&&this._groups.indexOf(groupName)>-1;}return false;},/**
	 * Gets an array of all groups this entity belongs to.
	 * @example #Get array of groups entity belongs to
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2');
	 *
	 *     // This will output "['g1', 'g2']"
	 *     console.log(entity.groups());
	 * @return {*}
	 */groups:function(){return this._groups||[];},/**
	 * Gets the number of groups this entity belongs to.
	 * @example #Get number of groups entity belongs to
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2');
	 *
	 *     // This will output "2"
	 *     console.log(entity.groupCount());
	 * @return {Number}
	 */groupCount:function(){return this._groups?this._groups.length:0;},/**
	 * Removes the entity from the group or groups passed. This
	 * method accepts multiple arguments and will remove the entity
	 * from all groups passed as arguments.
	 * @param {*} groupName The name of the group or array of group
	 * names to remove this entity as a member of.
	 * @example #Remove entity from single group
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2');
	 *
	 *     // This will output "['g1', 'g2']"
	 *     console.log(entity.groups());
	 *
	 *     // Remove entity from a single group
	 *     entity.removeGroup('g1');
	 *
	 *     // This will output "['g2']"
	 *     console.log(entity.groups());
	 * @example #Remove entity from multiple groups
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g3', 'g2');
	 *
	 *     // This will output "['g1', 'g3', 'g2']"
	 *     console.log(entity.groups());
	 *
	 *     // Remove entity from multiple groups
	 *     entity.removeGroup('g1', 'g3');
	 *
	 *     // This will output "['g2']"
	 *     console.log(entity.groups());
	 * @example #Remove entity from multiple groups via an array
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g3', 'g2');
	 *
	 *     // This will output "['g1', 'g3', 'g2']"
	 *     console.log(entity.groups());
	 *
	 *     // Remove entity from multiple groups
	 *     entity.removeGroup(['g1', 'g3']);
	 *
	 *     // This will output "['g2']"
	 *     console.log(entity.groups());
	 * @example #Remove entity from multiple groups via multiple arrays
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g2', 'g3', 'g4', 'g5', 'g6', 'g7');
	 *
	 *     // This will output "['g1', 'g2', 'g3', 'g4', 'g5', 'g6', 'g7']"
	 *     console.log(entity.groups());
	 *
	 *     // Remove entity from multiple groups
	 *     entity.removeGroup(['g1', 'g3'], ['g5', 'g6', 'g7']);
	 *
	 *     // This will output "['g2', 'g4']"
	 *     console.log(entity.groups());
	 * @return {*}
	 */removeGroup:function(){if(this._groups){var arrCount=arguments.length;var groupName;var groupNameCount;while(arrCount--){groupName=arguments[arrCount];if(groupName instanceof Array){groupNameCount=groupName.length;while(groupNameCount--){this._groups.pull(groupName[groupNameCount]);// Now un-register this object with the group it has been assigned
ige.groupUnRegister(this,groupName[groupNameCount]);}}else{this._groups.pull(groupName);// Now un-register this object with the group it has been assigned
ige.groupUnRegister(this,groupName);}}}return this;},/**
	 * Removes the entity from all groups it is a member of.
	 * @example #Remove entity from all groups
	 *     var entity = new $i_56();
	 *     entity.addGroup('g1', 'g3', 'g2');
	 *
	 *     // This will output "['g1', 'g3', 'g2']"
	 *     console.log(entity.groups());
	 *
	 *     // Remove all the groups
	 *     entity.removeAllGroups();
	 *
	 *     // This will output "[]"
	 *     console.log(entity.groups());
	 * @return {*}
	 */removeAllGroups:function(){if(this._groups){// Loop through all groups and un-register one at a time
var arr=this._groups;var arrCount=arr.length;while(arrCount--){ige.groupUnRegister(this,arr[arrCount]);}delete this._groups;}return this;},/**
	 * Adds a behaviour to the object's active behaviour list.
	 * @param {String} id
	 * @param {Function} behaviour
	 * @param {Boolean=} duringTick If true, will execute the behaviour
	 * during the tick() method instead of the update() method.
	 * @example #Add a behaviour with the id "myBehaviour"
	 *     var entity = new $i_56();
	 *     entity.addBehaviour('myBehaviour', function () {
	 *         // Code here will execute during each engine update for
	 *         // this entity. I can access the entity via the "this"
	 *         // keyword such as:
	 *         this._somePropertyOfTheEntity = 'moo';
	 *     });
	 *
	 *     // Now since each update we are setting _somePropertyOfTheEntity
	 *     // to equal "moo" we can console log the property and get
	 *     // the value as "moo"
	 *     console.log(entity._somePropertyOfTheEntity);
	 * @return {*} Returns this on success or false on failure.
	 */addBehaviour:function(id,behaviour,duringTick){if(typeof id==='string'){if(typeof behaviour==='function'){if(duringTick){this._tickBehaviours=this._tickBehaviours||[];this._tickBehaviours.push({id:id,method:behaviour});}else{this._updateBehaviours=this._updateBehaviours||[];this._updateBehaviours.push({id:id,method:behaviour});}return this;}else{this.log('The behaviour you passed is not a function! The second parameter of the call must be a function!','error');}}else{this.log('Cannot add behaviour to object because the specified behaviour id is not a string. You must provide two parameters with the addBehaviour() call, an id:String and a behaviour:Function. Adding a behaviour with an id allows you to remove it by it\'s id at a later stage!','error');}return false;},/**
	 * Removes a behaviour to the object's active behaviour list by it's id.
	 * @param {String} id
	 * @param {Boolean=} duringTick If true will look to remove the behaviour
	 * from the tick method rather than the update method.
	 * @example #Remove a behaviour with the id "myBehaviour"
	 *     var entity = new $i_56();
	 *     entity.addBehaviour('myBehaviour', function () {
	 *         // Code here will execute during each engine update for
	 *         // this entity. I can access the entity via the "this"
	 *         // keyword such as:
	 *         this._somePropertyOfTheEntity = 'moo';
	 *     });
	 *
	 *     // Now remove the "myBehaviour" behaviour
	 *     entity.removeBehaviour('myBehaviour');
	 * @return {*} Returns this on success or false on failure.
	 */removeBehaviour:function(id,duringTick){if(id!==undefined){var arr,arrCount;if(duringTick){arr=this._tickBehaviours;}else{arr=this._updateBehaviours;}// Find the behaviour
if(arr){arrCount=arr.length;while(arrCount--){if(arr[arrCount].id===id){// Remove the item from the array
arr.splice(arrCount,1);return this;}}}}return false;},/**
	 * Checks if the object has the specified behaviour already added to it.
	 * @param {String} id
	 * @param {Boolean=} duringTick If true will look to remove the behaviour
	 * from the tick method rather than the update method.
	 * @example #Check for a behaviour with the id "myBehaviour"
	 *     var entity = new $i_56();
	 *     entity.addBehaviour('myBehaviour', function () {
	 *         // Code here will execute during each engine update for
	 *         // this entity. I can access the entity via the "this"
	 *         // keyword such as:
	 *         this._somePropertyOfTheEntity = 'moo';
	 *     });
	 *
	 *     // Now check for the "myBehaviour" behaviour
	 *     console.log(entity.hasBehaviour('myBehaviour')); // Will log "true"
	 * @return {*} Returns this on success or false on failure.
	 */hasBehaviour:function(id,duringTick){if(id!==undefined){var arr,arrCount;if(duringTick){arr=this._tickBehaviours;}else{arr=this._updateBehaviours;}// Find the behaviour
if(arr){arrCount=arr.length;while(arrCount--){if(arr[arrCount].id===id){return true;}}}}return false;},/**
	 * Gets / sets the boolean flag determining if this object should have
	 * it's bounds drawn when the bounds for all objects are being drawn.
	 * In order for bounds to be drawn the viewport the object is being drawn
	 * to must also have draw bounds enabled.
	 * @param {Boolean} val
	 * @example #Enable draw bounds
	 *     var entity = new $i_56();
	 *     entity.drawBounds(true);
	 * @example #Disable draw bounds
	 *     var entity = new $i_56();
	 *     entity.drawBounds(false);
	 * @example #Get the current flag value
	 *     console.log(entity.drawBounds());
	 * @return {*}
	 */drawBounds:function(val){if(val!==undefined){this._drawBounds=val;return this;}return this._drawBounds;},/**
	 * Gets / sets the boolean flag determining if this object should have
	 * it's bounds data drawn when the bounds for all objects are being drawn.
	 * Bounds data includes the object ID and it's current depth etc.
	 * @param {Boolean} val
	 * @example #Enable draw bounds data
	 *     var entity = new $i_56();
	 *     entity.drawBoundsData(true);
	 * @example #Disable draw bounds data
	 *     var entity = new $i_56();
	 *     entity.drawBoundsData(false);
	 * @example #Get the current flag value
	 *     console.log(entity.drawBoundsData());
	 * @return {*}
	 */drawBoundsData:function(val){if(val!==undefined){this._drawBoundsData=val;return this;}return this._drawBoundsData;},/**
	 * Gets / sets the boolean flag determining if this object should have
	 * it's mouse position drawn, usually for debug purposes.
	 * @param {Boolean=} val
	 * @example #Enable draw mouse position data
	 *     var entity = new $i_56();
	 *     entity.drawMouse(true);
	 * @example #Disable draw mouse position data
	 *     var entity = new $i_56();
	 *     entity.drawMouse(false);
	 * @example #Get the current flag value
	 *     console.log(entity.drawMouse());
	 * @return {*}
	 */drawMouse:function(val){if(val!==undefined){this._drawMouse=val;return this;}return this._drawMouse;},/**
	 * Gets / sets the boolean flag determining if this object should have
	 * it's extra mouse data drawn for debug purposes. For instance, on tilemaps
	 * ($i_63) instances, when enabled you will see the tile x and y
	 * co-ordinates currently being hoverered over by the mouse.
	 * @param {Boolean=} val
	 * @example #Enable draw mouse data
	 *     var entity = new $i_56();
	 *     entity.drawMouseData(true);
	 * @example #Disable draw mouse data
	 *     var entity = new $i_56();
	 *     entity.drawMouseData(false);
	 * @example #Get the current flag value
	 *     console.log(entity.drawMouseData());
	 * @return {*}
	 */drawMouseData:function(val){if(val!==undefined){this._drawMouseData=val;return this;}return this._drawMouseData;},/**
	 * Finds a child entity that matches the id mounted to this
	 * or any other child entity down the scenegraph chain. Will
	 * only return an object if the entity found has this entity
	 * as an ancestor (parent or parent of parent etc).
	 * @param {String} id The id of the entity to find.
	 * @returns {*} The entity or undefined.
	 */$:function(id){var obj=ige.$(id);if(obj._parent===this){// We found a child and it's parent is this object so return it
return obj;}else{// Scan up the object's parent chain to see if this object is
// an ancestor at some point
var ancestor=obj.parent(this.id());if(ancestor){return obj;}else{return undefined;}}},/**
	 * Finds all child entities of this or any child of this entity
	 * down the scenegraph who's category matches the category name
	 * passed.
	 * @param {String} categoryName The category name to scan for.
	 * @returns {Array}
	 */$$:function(categoryName){var objArr=ige.$$(categoryName);var arrCount=objArr.length;var obj;var finalArr=[];var thisId=this.id();// Scan all objects that have the specified category
// and see if we are it's parent or an ancestor
while(arrCount--){obj=objArr[arrCount];if(obj._parent===this||obj.parent(thisId)){finalArr.push(obj);}}return finalArr;},/**
	 * Returns the object's parent object (the object that
	 * it is mounted to).
	 * @param {String=} id Optional, if present will scan up
	 * the parent chain until a parent with the matching id is
	 * found. If none is found, returns undefined.
	 * @example #Get the object parent
	 *     // Create a couple of entities and give them ids
	 *     var entity1 = new $i_56().id('entity1'),
	 *         entity2 = new $i_56().id('entity2');
	 *
	 *     // Mount entity2 to entity1
	 *     entity2.mount(entity1);
	 *
	 *     // Get the parent of entity2 (which is entity1)
	 *     var parent = entity2.parent();
	 *
	 *     // Log the parent's id (will output "entity1")
	 *     console.log(parent.id());
	 * @return {*}
	 */parent:function(id){if(!id){return this._parent;}if(this._parent){if(this._parent.id()===id){return this._parent;}else{return this._parent.parent(id);}}return undefined;},/**
	 * Returns the object's children as an array of objects.
	 * @example #Get the child objects array
	 *     // Create a couple of entities and give them ids
	 *     var entity1 = new $i_56().id('entity1'),
	 *         entity2 = new $i_56().id('entity2');
	 *
	 *     // Mount entity2 to entity1
	 *     entity2.mount(entity1);
	 *
	 *     // Get the chilren array entity1
	 *     var childArray = entity1.children();
	 *
	 *     // Log the child array contents (will contain entity2)
	 *     console.log(childArray);
	 * @return {Array} The array of child objects.
	 */children:function(){return this._children;},/**
	 * Mounts this object to the passed object in the scenegraph.
	 * @param {$i_55} obj
	 * @example #Mount an entity to another entity
	 *     // Create a couple of entities and give them ids
	 *     var entity1 = new $i_56().id('entity1'),
	 *         entity2 = new $i_56().id('entity2');
	 *
	 *     // Mount entity2 to entity1
	 *     entity2.mount(entity1);
	 * @return {*} Returns this on success or false on failure.
	 */mount:function(obj){if(obj){if(obj===this){this.log('Cannot mount an object to itself!','error');return this;}if(this._pixiContainer&&!this._pixiContainer._destroyed){if(this._pixiContainer.parent){this.unMount();}let pixiEntity=obj._pixiContainer||obj;obj.addChild(this._pixiContainer);return this;}if(obj._children){// Check that the engine will allow us to register this object
this.id();// Generates a new id if none is currently set, and registers it on the object register!
if(this._parent){if(this._parent===obj){// We are already mounted to the parent!
return this;}else{// We are already mounted to a different parent
this.unMount();}}this._parent=obj;// Delete orphans after entity is mounted actually - Entity Manager
if(ige.isClient&&ige.$('baseScene')._orphans){delete ige.$('baseScene')._orphans[this._id];}// Check if we need to set the ignore camera flag
if(!this._ignoreCamera&&this._parent._ignoreCamera){this._ignoreCamera=this._parent._ignoreCamera;/* if (this.ignoreCameraComposite) {
						this.ignoreCameraComposite(this._parent._ignoreCamera);
					} */}// Make sure we keep the child's room id in sync with it's parent
if(this._parent._streamRoomId){this._streamRoomId=this._parent._streamRoomId;}obj._children.push(this);this._parent._childMounted(this);if(obj.updateTransform){obj.updateTransform();obj.aabb(true);}if(obj._compositeCache){this._compositeParent=true;}else{delete this._compositeParent;}this._mounted(this._parent);this.emit('mounted',this._parent);return this;}else{// The object has no _children array!
this.log('Cannot mount object because it has no _children array! If you are mounting to a custom class, ensure that you have called the prototype.init() method of your super-class during the init of your custom class.','warning');return false;}}else{this.log('Cannot mount non-existent object!','error');}},/**
	 * Unmounts this object from it's parent object in the scenegraph.
	 * @example #Unmount an entity from another entity
	 *     // Create a couple of entities and give them ids
	 *     var entity1 = new $i_56().id('entity1'),
	 *         entity2 = new $i_56().id('entity2');
	 *
	 *     // Mount entity2 to entity1
	 *     entity2.mount(entity1);
	 *
	 *     // Now unmount entity2 from entity1
	 *     entity2.unMount();
	 * @return {*} Returns this on success or false on failure.
	 */unMount:function(){var self=this;if(this._pixiContainer){if(this._pixiContainer.parent&&self.entityId){if(this._pixiTexture.parent.children){var index=this._pixiContainer.parent.children.findIndex(function(child){return child.entityId==self.entityId;});if(index>-1){this._pixiContainer.parent.removeChildAt(index);}}}return this;}if(this._parent){var childArr=this._parent._children;var index=childArr.indexOf(this);var oldParent=this._parent;if(index>-1){// Found this in the parent._children array so remove it
childArr.splice(index,1);this._parent._childUnMounted(this);this._parent=null;this._unMounted(oldParent);return this;}else{// Cannot find this in the parent._children array
return false;}}else{return false;}},/**
	 * Determines if the object has a parent up the scenegraph whose
	 * id matches the one passed. Will traverse each parent object
	 * checking if the id matches. This information will be cached when
	 * first called and can be refreshed by setting the "fresh" parameter
	 * to true.
	 * @param {String} parentId The id of the parent to check for.
	 * @param {Boolean=} fresh If true will force a full check instead of
	 * using the cached value from an earlier check.
	 */hasParent:function(parentId,fresh){var bool=false;// Check for a cached value
if(!fresh&&this._hasParent&&this._hasParent[parentId]!==undefined){return this._hasParent[parentId];}if(this._parent){if(this._parent.id()===parentId){bool=true;}else{bool=this._parent.hasParent(parentId,fresh);}}this._hasParent=this._hasParent||{};this._hasParent[parentId]=bool;return bool;},/**
	 * Clones the object and all it's children and returns a new object.
	 */clone:function(options){// Make sure we have an options object
if(options===undefined){options={};}// Set some default option values
if(options.id===undefined){options.id=false;}if(options.mount===undefined){options.mount=false;}if(options.transform===undefined){options.transform=true;}// Loop all children and clone them, then return cloned version of ourselves
var newObject=eval(this.stringify(options));return newObject;},/**
	 * Gets / sets the positioning mode of the entity.
	 * @param {Number=} val 0 = 2d, 1 = isometric
	 * @example #Set the positioning mode to 2d
	 *     var entity = new $i_56()
	 *         .mode(0);
	 * @example #Set the positioning mode to isometric
	 *     var entity = new $i_56()
	 *         .mode(1);
	 * @return {*}
	 */mode:function(val){if(val!==undefined){this._mode=val;return this;}return this._mode;},/**
	 * Gets / sets if this object should be positioned isometrically
	 * or in 2d.
	 * @param {Boolean} val Set to true to position this object in
	 * isometric space or false to position it in 2d space.
	 * @example #Set the positioning mode to isometric
	 *     var entity = new $i_56()
	 *         .isometric(true);
	 * @example #Set the positioning mode to 2d
	 *     var entity = new $i_56()
	 *         .isometric(false);
	 * @return {*}
	 */isometric:function(val){if(val===true){this._mode=1;return this;}if(val===false){this._mode=0;return this;}return this._mode===1;},/**
	 * Gets / sets if objects mounted to this object should be positioned
	 * and depth-sorted in an isometric fashion or a 2d fashion.
	 * @param {Boolean=} val Set to true to enabled isometric positioning
	 * and depth sorting of objects mounted to this object, or false to
	 * enable 2d positioning and depth-sorting of objects mounted to this
	 * object.
	 * @example #Set children to be positioned and depth sorted in 2d
	 *     var entity = new $i_56()
	 *         .isometricMounts(false);
	 * @example #Set children to be positioned and depth sorted in isometric
	 *     var entity = new $i_56()
	 *         .isometricMounts(true);
	 * @return {*}
	 */isometricMounts:function(val){if(val===true){this._mountMode=1;return this;}if(val===false){this._mountMode=0;return this;}return this._mountMode===1;},/**
	 * Gets / sets the indestructible flag. If set to true, the object will
	 * not be destroyed even if a call to the destroy() method is made.
	 * @param {Number=} val
	 * @example #Set an entity to indestructible
	 *     var entity = new $i_56()
	 *         .indestructible(true);
	 * @example #Set an entity to destructible
	 *     var entity = new $i_56()
	 *         .indestructible(false);
	 * @example #Get an entity's indestructible flag value
	 *     var entity = new $i_56()
	 *     console.log(entity.indestructible());
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */indestructible:function(val){if(typeof val!=='undefined'){this._indestructible=val;return this;}return this._indestructible;},/**
	 * Gets / sets the current entity layer. This affects how the entity is depth-sorted
	 * against other entities of the same parent. Please note that entities are first sorted
	 * by their layer and then by their depth, and only entities of the same layer will be
	 * sorted against each other by their depth values.
	 * @param {Number=} val
	 * @example #Set an entity's layer to 22
	 *     var entity = new $i_56()
	 *         .layer(22);
	 * @example #Get an entity's layer value
	 *     var entity = new $i_56()
	 *     console.log(entity.layer());
	 * @example #How layers and depths are handled together
	 *     var entity1 = new $i_56(),
	 *         entity2 = new $i_56(),
	 *         entity3 = new $i_56();
	 *
	 *     // Set entity1 to at layer zero and depth 100
	 *     entity1.layer(0)
	 *         .depth(100);
	 *
	 *     // Set entity2 and 3 to be at layer 1
	 *     entity2.layer(1);
	 *     entity3.layer(1);
	 *
	 *     // Set entity3 to have a higher depth than entity2
	 *     entity2.depth(0);
	 *     entity3.depth(1);
	 *
	 *     // The engine sorts first based on layer from lowest to highest
	 *     // and then within each layer, by depth from lowest to highest.
	 *     // This means that entity1 will be drawn before entity 2 and 3
	 *     // because even though it's depth is higher, it is not on the same
	 *     // layer as entity 2 and 3.
	 *
	 *     // Based on the layers and depths we have assigned, here
	 *     // is how the engine will sort the draw order of the entities
	 *     // entity1
	 *     // entity2
	 *     // entity3
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */layer:function(val){if(val!==undefined){this._layer=val;if(this._pixiContainer){this._pixiContainer.zIndex=val;}return this;}return this._layer;},/**
	 * Gets / sets the current render depth of the object (higher depths
	 * are drawn over lower depths). Please note that entities are first sorted
	 * by their layer and then by their depth, and only entities of the same layer will be
	 * sorted against each other by their depth values.
	 * @param {Number=} val
	 * @example #Set an entity's depth to 1
	 *     var entity = new $i_56()
	 *         .depth(1);
	 * @example #Get an entity's depth value
	 *     var entity = new $i_56()
	 *     console.log(entity.depth());
	 * @example #How layers and depths are handled together
	 *     var entity1 = new $i_56(),
	 *         entity2 = new $i_56(),
	 *         entity3 = new $i_56();
	 *
	 *     // Set entity1 to at layer zero and depth 100
	 *     entity1.layer(0)
	 *         .depth(100);
	 *
	 *     // Set entity2 and 3 to be at layer 1
	 *     entity2.layer(1);
	 *     entity3.layer(1);
	 *
	 *     // Set entity3 to have a higher depth than entity2
	 *     entity2.depth(0);
	 *     entity3.depth(1);
	 *
	 *     // The engine sorts first based on layer from lowest to highest
	 *     // and then within each layer, by depth from lowest to highest.
	 *     // This means that entity1 will be drawn before entity 2 and 3
	 *     // because even though it's depth is higher, it is not on the same
	 *     // layer as entity 2 and 3.
	 *
	 *     // Based on the layers and depths we have assigned, here
	 *     // is how the engine will sort the draw order of the entities
	 *     // entity1
	 *     // entity2
	 *     // entity3
	 * @return {*} Returns this when setting the value or the current value if none is specified.
	 */depth:function(val){if(val!==undefined){this._depth=val;if(this._pixiContainer){this._pixiContainer.depth=val;}return this;}return this._depth;},/**
	 * Loops through all child objects of this object and destroys them
	 * by calling each child's destroy() method then clears the object's
	 * internal _children array.
	 */destroyChildren:function(){var arr=this._children;var arrCount;if(arr){arrCount=arr.length;while(arrCount--){arr[arrCount].destroy();}}this._children=[];return this;},/**
	 * Removes all references to any behaviour methods that were added to
	 * this object.
	 */destroyBehaviours:function(){delete this._updateBehaviours;delete this._tickBehaviours;},/**
	 * Loops through all components added to this object and calls their
	 * destroy() method, then removes any references to the components.
	 * @return {*}
	 */destroyComponents:function(){var arr=this._components;var arrCount;if(arr){arrCount=arr.length;while(arrCount--){if(arr[arrCount].destroy){arr[arrCount].destroy();}}}delete this._components;return this;},/**
	 * Gets / sets the depth sort mode that is used when
	 * depth sorting this object's children against each other. This
	 * mode only applies if this object's mount mode is isometric,
	 * as set by calling isometricMounts(true). If the mount mode is
	 * 2d, the depth sorter will use a very fast 2d depth sort that
	 * does not use 3d bounds at all.
	 * @param {Number=} val The mode to use when depth sorting
	 * this object's children, given as an integer value.
	 * @example #Turn off all depth sorting for this object's children
	 *     entity.depthSortMode(-1);
	 * @example #Use 3d bounds when sorting this object's children
	 *     entity.depthSortMode(0);
	 * @example #Use 3d bounds optimised for mostly cube-shaped bounds when sorting this object's children
	 *     entity.depthSortMode(1);
	 * @example #Use 3d bounds optimised for all cube-shaped bounds when sorting this object's children
	 *     entity.depthSortMode(2);
	 * @return {*}
	 */depthSortMode:function(val){if(val!==undefined){this._depthSortMode=val;return this;}return this._depthSortMode;},/**
	 * Sorts the _children array by the layer and then depth of each object.
	 */depthSortChildren:function(){if(this._depthSortMode!==-1){// TODO: Optimise this method, it is not especially efficient at the moment!
var arr=this._children;var arrCount;var sortObj;var i;var j;if(arr){arrCount=arr.length;// See if we can bug-out early
if(arrCount>1){// Check if the mount mode is isometric
if(this._mountMode===1){// Check the depth sort mode
if(this._depthSortMode===0){// Slowest, uses 3d bounds
// Calculate depths from 3d bounds
sortObj={adj:[],c:[],p:[],order:[],order_ind:arrCount-1};for(i=0;i<arrCount;++i){sortObj.c[i]=0;sortObj.p[i]=-1;for(j=i+1;j<arrCount;++j){sortObj.adj[i]=sortObj.adj[i]||[];sortObj.adj[j]=sortObj.adj[j]||[];if(arr[i]._inView&&arr[j]._inView&&arr[i]._projectionOverlap&&arr[j]._projectionOverlap){if(arr[i]._projectionOverlap(arr[j])){if(arr[i].isBehind(arr[j])){sortObj.adj[j].push(i);}else{sortObj.adj[i].push(j);}}}}}for(i=0;i<arrCount;++i){if(sortObj.c[i]===0){this._depthSortVisit(i,sortObj);}}for(i=0;i<sortObj.order.length;i++){arr[sortObj.order[i]].depth(i);}this._children.sort(function(a,b){var layerIndex=b._layer-a._layer;if(layerIndex===0){// On same layer so sort by depth
return b._depth-a._depth;}else{// Not on same layer so sort by layer
return layerIndex;}});}if(this._depthSortMode===1){// Medium speed, optimised for almost-cube shaped 3d bounds
// Now sort the entities by depth
this._children.sort(function(a,b){var layerIndex=b._layer-a._layer;if(layerIndex===0){// On same layer so sort by depth
// if (a._projectionOverlap(b)) {
if(a.isBehind(b)){return-1;}else{return 1;}// }
}else{// Not on same layer so sort by layer
return layerIndex;}});}if(this._depthSortMode===2){// Fastest, optimised for cube-shaped 3d bounds
while(arrCount--){sortObj=arr[arrCount];j=sortObj._translate;if(j){sortObj._depth=j.x+j.y+j.z;}}// Now sort the entities by depth
this._children.sort(function(a,b){var layerIndex=b._layer-a._layer;if(layerIndex===0){// On same layer so sort by depth
return b._depth-a._depth;}else{// Not on same layer so sort by layer
return layerIndex;}});}}else{// 2d mode
// Now sort the entities by depth
this._children.sort(function(a,b){var layerIndex=b._layer-a._layer;if(layerIndex===0){// On same layer so sort by depth
return b._depth-a._depth;}else{// Not on same layer so sort by layer
return layerIndex;}});}}}}},/**
	 * Gets / sets the view checking flag that if set to true
	 * will ask the engine to check during each tick if this
	 * object is actually "on screen" or not, and bypass it
	 * if it is not. The default is this flag set to false.
	 * @param {Boolean=} val The boolean flag value.
	 * @return {*}
	 */viewChecking:function(val){if(val!==undefined){this._viewChecking=val;return this;}return this._viewChecking;},/**
	 * ALPHA CODE DO NOT USE YET.
	 * When view checking is enabled, this method is called to
	 * determine if this object is within the bounds of an active
	 * viewport, essentially determining if the object is
	 * "on screen" or not.
	 */viewCheckChildren:function(){if(ige._currentViewport){var arr=this._children;var arrCount=arr.length;var vpViewArea=ige._currentViewport.viewArea();var item;while(arrCount--){item=arr[arrCount];if(item._category==='minimapUnit'){item._inView=true;}else{if(item._alwaysInView){item._inView=true;}else{if(item.aabb){// Check the entity to see if its bounds are "inside" the
// viewport's visible area
if(vpViewArea.intersects(item.aabb(true))){// The entity is inside the viewport visible area
item._inView=true;}else{item._inView=false;}}else{item._inView=false;}}}}}return this;},update:function(ctx,tickDelta){// Check that we are alive before processing further
// if(this._category === 'regionUi') return;
if(this._alive){if(ige.isClient&&!this._inView)return;// ige.client.tickAndUpdateData[this.id()] = this;
// if(ige.isClient){
// 	if (!ige.client.countingEntities) {
// 		ige.client.countingEntities = {};
// 	}
// 	if (this._category === undefined) {
// 		this._category = 0;
// 	}
// 	if(ige.client.countingEntities[this._category] ==undefined){
// 		ige.client.countingEntities[this._category] = {};
// 	}
// 	if (ige.client.countingEntities[this._category][this.id()] === undefined) {
// 		ige.client.countingEntities[this._category][this.id()] = 0;
// 	}
// 	else {
// 		ige.client.countingEntities[this._category][this.id()] += 1;
// 	}
// }
if(this._newBorn){this._newBorn=false;}var arr=this._children;var arrCount;var ts;var td;if(arr){arrCount=arr.length;// Depth sort all child objects
// if (arrCount && !ige._headless) {
// 	if (igeConfig.debug._timing) {
// 		if (!ige._timeSpentLastTick[this.id()]) {
// 			ige._timeSpentLastTick[this.id()] = {};
// 		}
// 		ts = new Date().getTime();
// 		this.depthSortChildren();
// 		td = new Date().getTime() - ts;
// 		ige._timeSpentLastTick[this.id()].depthSortChildren = td;
// 	} else {
// 		this.depthSortChildren();
// 	}
// }
// Loop our children and call their update methods
if(igeConfig.debug._timing){while(arrCount--){ts=new Date().getTime();arr[arrCount].update(ctx,tickDelta);td=new Date().getTime()-ts;if(arr[arrCount]){if(!ige._timeSpentInTick[arr[arrCount].id()]){ige._timeSpentInTick[arr[arrCount].id()]=0;}if(!ige._timeSpentLastTick[arr[arrCount].id()]){ige._timeSpentLastTick[arr[arrCount].id()]={};}ige._timeSpentInTick[arr[arrCount].id()]+=td;ige._timeSpentLastTick[arr[arrCount].id()].tick=td;}}}else{while(arrCount--){if(arr[arrCount])// added by Jaeyun, because something causes arr[arrCount] to be undefined
arr[arrCount].update(ctx,tickDelta);}}}}},/**
	 * Processes the actions required each render frame.
	 */tick:function(ctx,renderChildBelowUnit){// Check that we are alive before processing further
if(this._alive){var arr=this._children;var parentLayer=parseInt(this.layer());var parentDepth=parseInt(this.depth());var arrCount;var ts;var td;if(this._viewChecking){// Set the in-scene flag for each child based on
// the current viewport
this.viewCheckChildren();}// dont render regions if they are not visible
if(this._category==='regionUi'&&this._stats.default&&!(this._stats.default.inside||this._stats.default.outside)){return;}// Loop the child objects of this object
if(arr){arrCount=arr.length;// Loop our children and call their tick methods
if(igeConfig.debug._timing){while(arrCount--){if(!arr[arrCount]){this.log(`Object _children is undefined for index ${arrCount} and _id: ${this._id}`,'error');continue;}if(!arr[arrCount]._newBorn){var renderChild=false;if(renderChildBelowUnit){var childLayer=parseInt(arr[arrCount].layer());var childDepth=parseInt(arr[arrCount].depth());// render child if its depth is below units depth
if(childLayer<=parentLayer&&childDepth<parentDepth){renderChild=true;if(!arr[arrCount]._hidden){arr[arrCount]._renderBelowUnit=true;}}}else{// dont render item if it is already rendered below unit
renderChild=true&&!arr[arrCount]._renderBelowUnit;}if(renderChild){// ctx.save();
ts=new Date().getTime();arr[arrCount].tick(ctx);td=new Date().getTime()-ts;if(arr[arrCount]){if(!ige._timeSpentInTick[arr[arrCount].id()]){ige._timeSpentInTick[arr[arrCount].id()]=0;}if(!ige._timeSpentLastTick[arr[arrCount].id()]){ige._timeSpentLastTick[arr[arrCount].id()]={};}ige._timeSpentInTick[arr[arrCount].id()]+=td;ige._timeSpentLastTick[arr[arrCount].id()].tick=td;}// ctx.restore();
}}}}else{while(arrCount--){if(!arr[arrCount]){this.log(`Object _children is undefined for index ${arrCount} and _id: ${this._id}`,'error');continue;}if(!arr[arrCount]._newBorn){var renderChild=false;if(renderChildBelowUnit){var childLayer=parseInt(arr[arrCount].layer());var childDepth=parseInt(arr[arrCount].depth());// render child if its depth is below units depth
if(childLayer<=parentLayer&&childDepth<parentDepth){renderChild=true;if(!arr[arrCount]._hidden){arr[arrCount]._renderBelowUnit=true;}}}else{// dont render item if it is already rendered below unit
renderChild=true&&!arr[arrCount]._renderBelowUnit;}if(renderChild){// ctx.save();
arr[arrCount].tick(ctx);// ctx.restore();
}}}}}arr=null;}},_depthSortVisit:function(u,sortObj){var arr=sortObj.adj[u];var arrCount=arr.length;var i;var v;sortObj.c[u]=1;for(i=0;i<arrCount;++i){v=arr[i];if(sortObj.c[v]===0){sortObj.p[v]=u;this._depthSortVisit(v,sortObj);}}sortObj.c[u]=2;sortObj.order[sortObj.order_ind]=u;--sortObj.order_ind;},/**
	 * Handles screen resize events. Calls the _resizeEvent method of
	 * every child object mounted to this object.
	 * @param event
	 * @private
	 */_resizeEvent:function(event){var arr=this._children;var arrCount;if(arr){arrCount=arr.length;while(arrCount--){arr[arrCount]._resizeEvent(event);}}},/**
	 * Calls each behaviour method for the object.
	 * @private
	 */_processUpdateBehaviours:function(ctx,tickDelta){var arr=this._updateBehaviours;var arrCount;if(arr){arrCount=arr.length;while(arrCount--){arr[arrCount].method.apply(this,arguments);}}},/**
	 * Calls each behaviour method for the object.
	 * @private
	 */_processTickBehaviours:function(ctx){var arr=this._tickBehaviours;var arrCount;if(arr){arrCount=arr.length;while(arrCount--){arr[arrCount].method.apply(this,arguments);}}},/**
	 * Called when a child object is mounted to this object.
	 * @param obj
	 * @private
	 */_childMounted:function(obj){this._resizeEvent(null);},/**
	 * Called when a child object is un-mounted to this object.
	 * @param obj
	 * @private
	 */_childUnMounted:function(obj){},/**
	 * Called when this object is mounted to another object.
	 * @param obj
	 * @private
	 */_mounted:function(obj){},/**
	 * Called when this object is un-mounted from it's parent.
	 * @param obj
	 * @private
	 */_unMounted:function(obj){},/**
	 * Destroys the object and all it's child objects, removing them from the
	 * scenegraph and from memory.
	 */destroy:function(){// Remove ourselves from any parent
this.unMount();// Remove any children
if(this._children){this.destroyChildren();}// Remove any components
this.destroyComponents();// Remove any behaviours
this.destroyBehaviours();// Remove the object from the lookup system
ige.unRegister(this);ige.categoryUnRegister(this);ige.groupUnRegister(this);// Set a flag in case a reference to this object
// has been held somewhere, shows that the object
// should no longer be interacted with
this._alive=false;// Remove the event listeners array in case any
// object references still exist there
delete this._eventListeners;return this;},objSave:function(){return{igeClass:this.classId(),data:this._objSaveReassign(this,[])};},objLoad:function(obj){this._objLoadReassign(this,obj.data);},saveSpecialProp:function(obj,i){switch(i){case'_id':if(obj._id){return{_id:obj._id};}break;case'_parent':if(obj._parent){return{_parent:obj._parent.id()};}break;case'_children':if(obj._children.length){var childIndex;var child;var arr=[];for(childIndex=0;childIndex<obj._children.length;childIndex++){child=obj._children[childIndex];arr.push(child.objSave());}return{_children:arr};}break;}return undefined;},loadSpecialProp:function(obj,i){switch(i){case'_id':return{_id:obj[i]};break;case'_parent':return{_parent:obj[i]};break;case'_children':return{_children:obj[i]};break;}return undefined;},loadGraph:function(obj){if(obj.igeClass&&obj.data){// Create a new class instance
var classInstance=ige.newClassInstance(obj.igeClass);var newId;var childArr;var childIndex;var parentId;classInstance.objLoad(obj);if(classInstance._parent){// Record the id and delete it
parentId=classInstance._parent;delete classInstance._parent;}// Process item id
if(classInstance._id){newId=classInstance._id;delete classInstance._id;classInstance.id(newId);}// Check for children and process them if exists
if(classInstance._children&&classInstance._children.length){childArr=classInstance._children;classInstance._children=[];for(childIndex=0;childIndex<childArr.length;childIndex++){classInstance.loadGraph(childArr[childIndex]);}}// Now mount the instance if it has a parent
classInstance.mount(this);}},_objSaveReassign:function(obj,ref){var copyObj;var specialKeys=this._specialProp;var refIndex;var specProp;var specPropKey;var i;if(typeof obj==='object'&&!(obj instanceof Array)){copyObj={};for(i in obj){if(obj.hasOwnProperty(i)){if(typeof obj[i]==='object'){if(specialKeys.indexOf(i)===-1){// Check if the ref already exists
refIndex=ref.indexOf(obj[i]);if(refIndex>-1){copyObj[i]=`{ref:${refIndex}}`;this.log(`Possible circular reference for property ${i}`);}else{ref.push(obj[i]);copyObj[i]=this._objSaveReassign(obj[i],ref);}}else{// This is a special property that needs handling via
// it's own method to return an appropriate data value
// so check if there is a method for it
specProp=this.saveSpecialProp(obj,i);if(specProp){if(typeof specProp==='object'&&!(specProp instanceof Array)){// Process the returned object properties
for(specPropKey in specProp){if(specProp.hasOwnProperty(specPropKey)){// Copy the special property data to the key in
// our return object
copyObj[specPropKey]=specProp[specPropKey];}}}else{copyObj[i]=specProp;}}}}else{copyObj[i]=obj[i];}}}return copyObj;}else{return obj;}},_objLoadReassign:function(obj,newProps){var specialKeys=this._specialProp;var specProp;var specPropKey;var i;for(i in newProps){if(newProps.hasOwnProperty(i)){if(specialKeys.indexOf(i)===-1){if(typeof newProps[i]==='object'&&obj[i]){this._objLoadReassign(obj[i],newProps[i]);}else{// Assign the property value directly
obj[i]=newProps[i];}}else{// This is a special property that needs handling via
// it's own method to return an appropriate data value
// so check if there is a method for it
specProp=this.loadSpecialProp(newProps,i);if(specProp){if(typeof specProp==='object'&&!(specProp instanceof Array)){// Process the returned object properties
for(specPropKey in specProp){if(specProp.hasOwnProperty(specPropKey)){// Copy the special property data to the key in
// our return object
obj[specPropKey]=specProp[specPropKey];}}}else{obj[i]=specProp;}}}}}},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object.
	 * @return {String}
	 */stringify:function(options){// Make sure we have an options object
if(options===undefined){options={};}var str=`new ${this.classId()}()`;// Every object has an ID, assign that first
if(options.id!==false){str+=`.id('${this.id()}')`;}// Now check if there is a parent and mount that
if(options.mount!==false&&this.parent()){str+=`.mount(ige.$('${this.parent().id()}'))`;}// Now get all other properties
str+=this._stringify(options);return str;},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object's properties via
	 * chained commands. This method will only check for
	 * properties that are directly related to this class.
	 * Other properties are handled by their own class method.
	 * @return {String}
	 */_stringify:function(options){// Make sure we have an options object
if(options===undefined){options={};}var str='';var i;// Loop properties and add property assignment code to string
for(i in this){if(this.hasOwnProperty(i)&&this[i]!==undefined){switch(i){case'_category':str+=`.category(${this.category()})`;break;case'_drawBounds':str+=`.drawBounds(${this.drawBounds()})`;break;case'_drawBoundsData':str+=`.drawBoundsData(${this.drawBoundsData()})`;break;case'_drawMouse':str+=`.drawMouse(${this.drawMouse()})`;break;case'_mode':str+=`.mode(${this.mode()})`;break;case'_isometricMounts':str+=`.isometricMounts(${this.isometricMounts()})`;break;case'_indestructible':str+=`.indestructible(${this.indestructible()})`;break;case'_layer':str+=`.layer(${this.layer()})`;break;case'_depth':str+=`.depth(${this.depth()})`;break;}}}return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_55;};/**
 * Creates an entity and handles the entity's life cycle and
 * all related entity actions / methods.
 */var $i_56=$i_55.extend({classId:'$i_56',init:function(defaultData={}){$i_55.prototype.init.call(this);// Register the $i_56 special properties handler for
// serialise and de-serialise support
var translateX=defaultData.translate&&defaultData.translate.x?defaultData.translate.x:0;var translateY=defaultData.translate&&defaultData.translate.y?defaultData.translate.y:0;var rotate=defaultData.rotate||0;this._specialProp.push('_texture');this._specialProp.push('_eventListeners');this._specialProp.push('_aabb');this._anchor=new $i_4(0,0);this._renderPos={x:0,y:0};this._computedOpacity=1;this._opacity=1;this._cell=1;this._flip=0;// texture flip code 1=horiz 2=vert 3=both
this._deathTime=undefined;this._bornTime=ige._currentTime;this._translate=new $i_5(translateX,translateY,rotate);this._oldTranform=[];this._hasMoved=true;this._rotate=new $i_5(0,0,rotate);this._scale=new $i_5(1,1,1);this._origin=new $i_5(0.5,0.5,0.5);this._bounds2d=new $i_4(40,40);this._bounds3d=new $i_5(0,0,0);this._oldBounds2d=new $i_4(40,40);this._oldBounds3d=new $i_5(0,0,0);this._highlight=false;this._mouseEventsActive=false;this._velocity=new $i_5(0,0,0);this._localMatrix=new $i_8();this._worldMatrix=new $i_8();this._oldWorldMatrix=new $i_8();this._lastSeenBy={};this._inView=true;this._hidden=false;this._stats={};this._streamDataQueued=[];this._isBeingRemoved=false;// this ensures entity is spawning at a correct position initially. particularily useful for projectiles
this._keyFrames=[];this.prevKeyFrame=[ige.now,[this._translate.x,this._translate.y,this._rotate.z]];this._lastTransformAt=null;this.lastServerStreamedPosition=null;this.lastTeleportedAt=0;if(ige.isClient){this.anchorOffset={x:0,y:0,rotate:0};this.addComponent(TweenComponent);}// this.compositeCache(true);
// Set the default stream sections as just the transform data
this.streamSections(['transform']);},/**
     * Sets the entity as visible and able to be interacted with.
     * @example #Show a hidden entity
     *     entity.show();
     * @return {*} The object this method was called from to allow
     * method chaining.
     */show:function(){var self=this;if(ige.isServer){// self._hidden = false; // never hide it, because it'll stop processing stream queue
this.streamUpdateData([{isHidden:false}]);}else if(ige.isClient){// this.disableInterpolation(false)
// add a little bit of delay before showing the item, so we don't see item translating from old location to new location
self._hidden=false;var pixiEntity=self._pixiText||self._pixiTexture;if(pixiEntity){pixiEntity.visible=true;}}return this;},// update item's body & texture based on stateId given
setState:function(stateId,defaultData){var self=this;// if invalid stateId is given, set state to default state
if(stateId==undefined||self._stats.states==undefined||self._stats.states[stateId]==undefined){stateId=this.getDefaultStateId();}var newState=self._stats.states&&self._stats.states[stateId]||{};if(newState&&newState.body){/*
			* if state is 'unselected' newState.body = 'none'
				will evaluate to currentBody = undefined

			*/self._stats.currentBody=self._stats.bodies[newState.body];// if (ige.isSever && ige.physics.engine == 'CRASH') {
// 	self._stats.currentBody = self._stats.bodies[newState.body] ? self._stats.bodies[newState.body] : 'none';
// }
}// console.log("setState", stateId, "new body", (newState)?newState.body:"null")
if(ige.isServer){self.streamUpdateData([{stateId:stateId}]);}else if(ige.isClient){self._stats.stateId=stateId;if(newState.sound){for(var soundId in newState.sound){var sound=newState.sound[soundId];ige.sound.playSound(sound,this._translate,soundId);}}}self.previousState=newState;self.updateBody(defaultData);},/**
     * Sets the entity as hidden and cannot be interacted with.
     * @example #Hide a visible entity
     *     entity.hide();
     * @return {*} The object this method was called from to allow
     * method chaining.
     */hide:function(){var self=this;if(ige.isServer){// self._hidden = true; // never hide it, because it'll stop processing stream queue
this.streamUpdateData([{isHidden:true}]);}else if(ige.isClient){// this.disableInterpolation(true)
// add a little bit of delay before showing the item, so we don't see item translating from old location to new location
// self.opacity(0)
self._hidden=true;var pixiEntity=self._pixiText||self._pixiTexture;if(pixiEntity){pixiEntity.visible=false;}self.texture('');}return this;},/**
     * Checks if the entity is hidden.
     * @returns {boolean} True if the entity is hidden.
     */isHidden:function(){return this._hidden===true;},/* Checks if entity should be invisible depending on diplomacy status of the owner player of this entity */shouldBeInvisible:function(playerA,playerB){return playerA&&playerB&&(playerA.isHostileTo(playerB)&&this._stats.isInvisible==true||playerA.isFriendlyTo(playerB)&&this._stats.isInvisibleToFriendly==true||playerA.isNeutralTo(playerB)&&this._stats.isInvisibleToNeutral==true);},imageUrlToHash:function(url){var hash=0;if(url.length==0){return hash;}for(var i=0;i<url.length;i++){var char=url.charCodeAt(i);hash=(hash<<5)-hash+char;hash=hash&hash;// Convert to 32bit integer
}return hash;},updateLayer:function(){var self=this;var defaultLayer={depth:0,layer:0};// parseFloat(Math.random().toFixed(4))
if(self._category=='unit'){defaultLayer.layer=3;defaultLayer.depth=3;}else if(self._category=='item'){if(self.getOwnerUnit()){defaultLayer.layer=3;defaultLayer.depth=3;}else{// doesn't have owner. show it above floor2
defaultLayer.layer=2;defaultLayer.depth=5;}}else if(self._category=='projectile'){defaultLayer.layer=3;defaultLayer.depth=3;}var body=self._stats.currentBody;if(body&&!body['z-index']){body['z-index']=defaultLayer;}if(isNaN(body['z-index'].depth)){body['z-index'].depth=defaultLayer.depth;}if(isNaN(body['z-index'].layer)){body['z-index'].layer=defaultLayer.layer;}self.layer(body['z-index'].layer)// above "floor 2 layer", but under "trees layer"
.depth(body['z-index'].depth);},applyAnimationById:function(animationId){var self=this;var animation=null;if(self._stats.stateId&&self._stats.states&&self._stats.states[self._stats.stateId]&&self._stats.animations[animationId]){animation=self._stats.animations[animationId];}var cellSheet=null;cellSheet=self._stats.cellSheet;if(animation&&cellSheet){// cell sheet animation id will be concatenation of unit type and animation id
var cellSheetAnimId;var url=cellSheet.url;var rows=cellSheet.rowCount;var columns=cellSheet.columnCount;cellSheetAnimId=self._stats.cellSheet.url;ige.client.cellSheets[cellSheetAnimId]=this.pixianimation.define(url,columns,rows,cellSheetAnimId,animationId);var fps=animation.framesPerSecond||15;var loopCount=animation.loopCount-1;// Subtract 1 for Jaeyun convention on front end
// default loop to undefined;
this.pixianimation.select(animation.frames,fps,loopCount,cellSheetAnimId,animation.name);this.emit('play-animation',animationId);}},applyAnimationForState:function(stateId){var self=this;// players can purchase unit skins
// these custom cellsheets override the default unit cellsheet
// they should also therefore be geometrically compatible
var state=ige.game.data.states[stateId];// unit or item state config (overrides if present)
if(self._stats&&self._stats.states&&self._stats.states[stateId]){state=self._stats.states[stateId];}if(state){var animationId=state.animation;if(animationId){self.applyAnimationById(animationId);}// if (state.sound) {
// 	for (var soundKey in state.sound) {
// 		var sound = state.sound[soundKey];
// 		ige.sound.playSound(sound, self._translate, soundKey);
// 	}
// }
}},updateTexture:function(){var stateId=this._stats.stateId;// if state not explicitly set, use default state
if(stateId==null){stateId=this.getDefaultStateId();}if(stateId){this.applyAnimationForState(stateId);}ige.pixi.isUpdateLayersOrderQueued=true;},getDefaultStateId:function(){var defaultStateId=null;var states=this._stats.states;for(i in states){var state=states[i];if(!state){continue;}if(this._category==='item'){if(state.name=='dropped'){defaultStateId=i;}}else{if(state.name=='default'){defaultStateId=i;}}}return defaultStateId;},/**
     * Gets / sets the cache flag that determines if the entity's
     * texture rendering output should be stored on an off-screen
     * canvas instead of calling the texture.render() method each
     * tick. Useful for expensive texture calls such as rendering
     * fonts etc. If enabled, this will automatically disable advanced
     * composite caching on this entity with a call to
     * compositeCache(false).
     * @param {Boolean=} val True to enable caching, false to
     * disable caching.
     * @example #Enable entity caching
     *     entity.cache(true);
     * @example #Disable entity caching
     *     entity.cache(false);
     * @example #Get caching flag value
     *     var val = entity.cache();
     * @return {*}
     */cache:function(val){if(val!==undefined){this._cache=val;if(val){// Create the off-screen canvas
if(ige.isClient){// Use a real canvas
this._cacheCanvas=document.createElement('canvas');}else{// Use dummy objects for canvas and context
this._cacheCanvas=new $i_45();}this._cacheCtx=this._cacheCanvas.getContext('2d');this._cacheDirty=true;// Set smoothing mode
var smoothing=this._cacheSmoothing!==undefined?this._cacheSmoothing:ige._globalSmoothing;if(!smoothing){this._cacheCtx.imageSmoothingEnabled=false;// this._cacheCtx.webkitImageSmoothingEnabled = false;
this._cacheCtx.mozImageSmoothingEnabled=false;}else{this._cacheCtx.imageSmoothingEnabled=true;// this._cacheCtx.webkitImageSmoothingEnabled = true;
this._cacheCtx.mozImageSmoothingEnabled=true;}// Switch off composite caching
if(this.compositeCache()){this.compositeCache(false);}}else{// Remove the off-screen canvas
delete this._cacheCanvas;}return this;}return this._cache;},/**
     * When using the caching system, this boolean determines if the
     * cache canvas should have image smoothing enabled or not. If
     * not set, the ige global smoothing setting will be used instead.
     * @param {Boolean=} val True to enable smoothing, false to disable.
     * @returns {*}
     */cacheSmoothing:function(val){if(val!==undefined){this._cacheSmoothing=val;return this;}return this._cacheSmoothing;},/**
     * Gets / sets composite caching. Composite caching draws this entity
     * and all of it's children (and their children etc) to a single off
     * screen canvas so that the entity does not need to be redrawn with
     * all it's children every tick. For composite entities where little
     * change occurs this will massively increase rendering performance.
     * If enabled, this will automatically disable simple caching on this
     * entity with a call to cache(false).
     * @param {Boolean=} val
     * @example #Enable entity composite caching
     *     entity.compositeCache(true);
     * @example #Disable entity composite caching
     *     entity.compositeCache(false);
     * @example #Get composite caching flag value
     *     var val = entity.cache();
     * @return {*}
     */compositeCache:function(val){if(ige.isClient){if(val!==undefined){if(val){// Switch off normal caching
this.cache(false);// Create the off-screen canvas
this._cacheCanvas=document.createElement('canvas');this._cacheCtx=this._cacheCanvas.getContext('2d');this._cacheDirty=true;// Set smoothing mode
var smoothing=this._cacheSmoothing!==undefined?this._cacheSmoothing:ige._globalSmoothing;if(!smoothing){this._cacheCtx.imageSmoothingEnabled=false;this._cacheCtx.webkitImageSmoothingEnabled=false;this._cacheCtx.mozImageSmoothingEnabled=false;}else{this._cacheCtx.imageSmoothingEnabled=true;this._cacheCtx.webkitImageSmoothingEnabled=true;this._cacheCtx.mozImageSmoothingEnabled=true;}}// Loop children and set _compositeParent to the correct value
this._children.each(function(){if(val){this._compositeParent=true;}else{delete this._compositeParent;}});this._compositeCache=val;return this;}return this._compositeCache;}else{return this;}},/**
     * Gets / sets the cache dirty flag. If set to true this will
     * instruct the entity to re-draw it's cached image from the
     * assigned texture. Once that occurs the flag will automatically
     * be set back to false. This works in either standard cache mode
     * or composite cache mode.
     * @param {Boolean=} val True to force a cache update.
     * @example #Get cache dirty flag value
     *     var val = entity.cacheDirty();
     * @example #Set cache dirty flag value
     *     entity.cacheDirty(true);
     * @return {*}
     */cacheDirty:function(val){if(val!==undefined){this._cacheDirty=val;// Check if the entity is a child of a composite or composite
// entity chain and propagate the dirty cache up the chain
if(val&&this._compositeParent&&this._parent){this._parent.cacheDirty(val);if(!this._cache&&!this._compositeCache){// Set clean immediately as no caching is enabled on this child
this._cacheDirty=false;}}return this;}return this._cacheDirty;},/**
     * Gets the position of the mouse relative to this entity's
     * center point.
     * @param {$i_68=} viewport The viewport to use as the
     * base from which the mouse position is determined. If no
     * viewport is specified then the current viewport the engine
     * is rendering to is used instead.
     * @example #Get the mouse position relative to the entity
     *     // The returned value is an object with properties x, y, z
     *     var mousePos = entity.mousePos();
     * @return {$i_5} The mouse point relative to the entity
     * center.
     */mousePos:function(viewport){viewport=viewport||ige._currentViewport;if(viewport){var mp=viewport._mousePos.clone();var cam;if(this._ignoreCamera){/* cam = ige._currentCamera;
				mp.thisMultiply(1 / cam._scale.x, 1 / cam._scale.y, 1 / cam._scale.z);
				//mp.thisRotate(-cam._rotate.z);
				mp.thisAddPoint(cam._translate); */}mp.x+=viewport._translate.x;mp.y+=viewport._translate.y;this._transformPoint(mp);return mp;}else{return new $i_5(0,0,0);}},/**
     * Gets the position of the mouse relative to this entity not
     * taking into account viewport translation.
     * @param {$i_68=} viewport The viewport to use as the
     * base from which the mouse position is determined. If no
     * viewport is specified then the current viewport the engine
     * is rendering to is used instead.
     * @example #Get absolute mouse position
     *     var mousePosAbs = entity.mousePosAbsolute();
     * @return {$i_5} The mouse point relative to the entity
     * center.
     */mousePosAbsolute:function(viewport){viewport=viewport||ige._currentViewport;if(viewport){var mp=viewport._mousePos.clone();this._transformPoint(mp);return mp;}return new $i_5(0,0,0);},/**
     * Gets the position of the mouse in world co-ordinates.
     * @param {$i_68=} viewport The viewport to use as the
     * base from which the mouse position is determined. If no
     * viewport is specified then the current viewport the engine
     * is rendering to is used instead.
     * @example #Get mouse position in world co-ordinates
     *     var mousePosWorld = entity.mousePosWorld();
     * @return {$i_5} The mouse point relative to the world
     * center.
     */mousePosWorld:function(viewport){viewport=viewport||ige._currentViewport;var mp=this.mousePos(viewport);this.localToWorldPoint(mp,viewport);if(this._ignoreCamera){// viewport.camera._worldMatrix.getInverse().transform([mp]);
}return mp;},/**
     * Rotates the entity to point at the target point around the z axis.
     * @param {$i_5} point The point in world co-ordinates to
     * point the entity at.
     * @example #Point the entity at another entity
     *     entity.rotateToPoint(otherEntity.worldPosition());
     * @example #Point the entity at mouse
     *     entity.rotateToPoint(ige._currentViewport.mousePos());
     * @example #Point the entity at an arbitrary point x, y
     *     entity.rotateToPoint(new $i_5(x, y, 0));
     * @return {*}
     */rotateToPoint:function(point){var worldPos=this.worldPosition();this.rotateTo(this._rotate.x,this._rotate.y,this._rotate.z// (Math.atan2(worldPos.y - point.y, worldPos.x - point.x) - this._parent._rotate.z) + Math.radians(270)
);return this;},/**
     * Gets / sets the texture to use as the background
     * pattern for this entity.
     * @param {$i_50} texture The texture to use as
     * the background.
     * @param {String=} repeat The type of repeat mode either: "repeat",
     * "repeat-x", "repeat-y" or "none".
     * @param {Boolean=} trackCamera If set to true, will track the camera
     * translation and "move" the background with the camera.
     * @param {Boolean=} isoTile If true the tiles of the background will
     * be treated as isometric and will therefore be drawn so that they are
     * layered seamlessly in isometric view.
     * @example #Set a background pattern for this entity with 2d tiling
     *     var texture = new $i_50('path/to/my/texture.png');
     *     entity.backgroundPattern(texture, 'repeat', true, false);
     * @example #Set a background pattern for this entity with isometric tiling
     *     var texture = new $i_50('path/to/my/texture.png');
     *     entity.backgroundPattern(texture, 'repeat', true, true);
     * @return {*}
     */backgroundPattern:function(texture,repeat,trackCamera,isoTile){if(texture!==undefined){this._backgroundPattern=texture;this._backgroundPatternRepeat=repeat||'repeat';this._backgroundPatternTrackCamera=trackCamera;this._backgroundPatternIsoTile=isoTile;this._backgroundPatternFill=null;return this;}return this._backgroundPattern;},createPixiTexture:function(defaultSprite=0,defaultData){var texture=new IgePixiTexture(this._stats.cellSheet.url,this._stats.cellSheet.columnCount,this._stats.cellSheet.rowCount,this);texture=texture.spriteFromCellSheet(defaultSprite);if(!texture){return;}texture.width=this._stats.currentBody&&this._stats.currentBody.width||this._stats.width;texture.height=this._stats.currentBody&&this._stats.currentBody.height||this._stats.height;if(texture.anchor){texture.anchor.set(0.5);}this._pixiContainer.zIndex=this._stats.currentBody&&this._stats.currentBody['z-index']&&this._stats.currentBody['z-index'].layer||3;this._pixiContainer.depth=this._stats.currentBody&&this._stats.currentBody['z-index']&&this._stats.currentBody['z-index'].depth||3;this._pixiContainer.depth+=parseInt(Math.random()*1000)/1000;this._pixiContainer.entityId=this.entityId;this._pixiContainer._category=this._category;this._pixiTexture=texture;this._pixiContainer.addChild(texture);if(defaultData){this._pixiContainer.x=defaultData.translate.x;this._pixiContainer.y=defaultData.translate.y;this._pixiTexture.rotation=defaultData.rotate;}ige.pixi.trackEntityById[this.entityId]=this._pixiContainer;},// drawCrashCollider: function (defaultData) {
// 	var collider = new IgePixiCollider(this);
// 	collider = collider.drawCollider();
// 	this._pixiCollider = collider;
// 	this._pixiContainer.addChild(collider);
// 	if (defaultData) {
// 		this._pixiContainer.x = defaultData.translate.x;
// 		this._pixiContainer.y = defaultData.translate.y;
// 		// new
// 		//this._pixiCollider.rotation = defaultData.rotate;
// 	}
// 	ige.pixi.trackEntityById[this.entityId] = this._pixiContainer;
// },
/**
     * Set the object's width to the number of tile width's specified.
     * @param {Number} val Number of tiles.
     * @param {Boolean=} lockAspect If true, sets the height according
     * to the texture aspect ratio and the new width.
     * @example #Set the width of the entity based on the tile width of the map the entity is mounted to
     *     // Set the entity width to the size of 1 tile with
     *     // lock aspect enabled which will automatically size
     *     // the height as well so as to maintain the aspect
     *     // ratio of the entity
     *     entity.widthByTile(1, true);
     * @return {*} The object this method was called from to allow
     * method chaining.
     */widthByTile:function(val,lockAspect){if(this._parent&&this._parent._tileWidth!==undefined&&this._parent._tileHeight!==undefined){var tileSize=this._mode===0?this._parent._tileWidth:this._parent._tileWidth*2;var ratio;this.width(val*tileSize);if(lockAspect){if(this._texture){// Calculate the height based on the new width
ratio=this._texture._sizeX/this._bounds2d.x;this.height(this._texture._sizeY/ratio);}else{$i_56.prototype.log('Cannot set height based on texture aspect ratio and new width because no texture is currently assigned to the entity!','error');}}}else{$i_56.prototype.log('Cannot set width by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.','warning');}return this;},/**
     * Set the object's height to the number of tile height's specified.
     * @param {Number} val Number of tiles.
     * @param {Boolean=} lockAspect If true, sets the width according
     * to the texture aspect ratio and the new height.
     * @example #Set the height of the entity based on the tile height of the map the entity is mounted to
     *     // Set the entity height to the size of 1 tile with
     *     // lock aspect enabled which will automatically size
     *     // the width as well so as to maintain the aspect
     *     // ratio of the entity
     *     entity.heightByTile(1, true);
     * @return {*} The object this method was called from to allow
     * method chaining.
     */heightByTile:function(val,lockAspect){if(this._parent&&this._parent._tileWidth!==undefined&&this._parent._tileHeight!==undefined){var tileSize=this._mode===0?this._parent._tileHeight:this._parent._tileHeight*2;var ratio;this.height(val*tileSize);if(lockAspect){if(this._texture){// Calculate the width based on the new height
ratio=this._texture._sizeY/this._bounds2d.y;this.width(this._texture._sizeX/ratio);}else{$i_56.prototype.log('Cannot set width based on texture aspect ratio and new height because no texture is currently assigned to the entity!','error');}}}else{$i_56.prototype.log('Cannot set height by tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.','warning');}return this;},/**
     * Adds the object to the tile map at the passed tile co-ordinates. If
     * no tile co-ordinates are passed, will use the current tile position
     * and the tileWidth() and tileHeight() values.
     * @param {Number=} x X co-ordinate of the tile to occupy.
     * @param {Number=} y Y co-ordinate of the tile to occupy.
     * @param {Number=} width Number of tiles along the x-axis to occupy.
     * @param {Number=} height Number of tiles along the y-axis to occupy.
     */occupyTile:function(x,y,width,height){// Check that the entity is mounted to a tile map
if(this._parent&&this._parent.$i_63){if(x!==undefined&&y!==undefined){this._parent.occupyTile(x,y,width,height,this);}else{// Occupy tiles based upon tile point and tile width/height
var trPoint=new $i_5(this._translate.x-(this._tileWidth/2-0.5)*this._parent._tileWidth,this._translate.y-(this._tileHeight/2-0.5)*this._parent._tileHeight,0);var tilePoint=this._parent.pointToTile(trPoint);if(this._parent._mountMode===1){tilePoint.thisToIso();}this._parent.occupyTile(tilePoint.x,tilePoint.y,this._tileWidth,this._tileHeight,this);}}return this;},/**
     * Removes the object from the tile map at the passed tile co-ordinates.
     * If no tile co-ordinates are passed, will use the current tile position
     * and the tileWidth() and tileHeight() values.
     * @param {Number=} x X co-ordinate of the tile to un-occupy.
     * @param {Number=} y Y co-ordinate of the tile to un-occupy.
     * @param {Number=} width Number of tiles along the x-axis to un-occupy.
     * @param {Number=} height Number of tiles along the y-axis to un-occupy.
     * @private
     */unOccupyTile:function(x,y,width,height){// Check that the entity is mounted to a tile map
if(this._parent&&this._parent.$i_63){if(x!==undefined&&y!==undefined){this._parent.unOccupyTile(x,y,width,height);}else{// Un-occupy tiles based upon tile point and tile width/height
var trPoint=new $i_5(this._translate.x-(this._tileWidth/2-0.5)*this._parent._tileWidth,this._translate.y-(this._tileHeight/2-0.5)*this._parent._tileHeight,0);var tilePoint=this._parent.pointToTile(trPoint);if(this._parent._mountMode===1){tilePoint.thisToIso();}this._parent.unOccupyTile(tilePoint.x,tilePoint.y,this._tileWidth,this._tileHeight);}}return this;},/**
     * Returns an array of tile co-ordinates that the object is currently
     * over, calculated using the current world co-ordinates of the object
     * as well as it's 3d geometry.
     * @private
     * @return {Array} The array of tile co-ordinates as $i_5 instances.
     */overTiles:function(){// Check that the entity is mounted to a tile map
if(this._parent&&this._parent.$i_63){var x;var y;var tileWidth=this._tileWidth||1;var tileHeight=this._tileHeight||1;var tile=this._parent.pointToTile(this._translate);var tileArr=[];for(x=0;x<tileWidth;x++){for(y=0;y<tileHeight;y++){tileArr.push(new $i_5(tile.x+x,tile.y+y,0));}}return tileArr;}},/**
     * Gets / sets the anchor position that this entity's texture
     * will be adjusted by.
     * @param {Number=} x The x anchor value.
     * @param {Number=} y The y anchor value.
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */anchor:function(x,y){if(x!==undefined&&y!==undefined){this._anchor=new $i_4(x,y);return this;}return this._anchor;},/**
     * Gets / sets the geometry x value.
     * @param {Number=} px The new x value in pixels.
     * @example #Set the width of the entity
     *     entity.width(40);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */width:function(px,lockAspect){if(px!==undefined){if(lockAspect){// Calculate the height from the change in width
var ratio=px/this._bounds2d.x;this.height(this._bounds2d.y*ratio);}this._bounds2d.x=px;this._bounds2d.x2=px/2;if(this._pixiTexture&&!this._pixiTexture._destroyed){this._pixiTexture.width=px;}else if(this._pixiContainer&&!this._pixiContainer._destroyed){this._pixiContainer.width=px;}else if(this._pixiText&&!this._pixiText._destroyed){this._pixiText.width=px;}return this;}if(this._pixiTexture){return this._pixiTexture.width;}else if(this._pixiContainer){return this._pixiContainer.width;}else if(this._pixiText){return this._pixiText.width;}return this._bounds2d.x;},/**
     * Gets / sets the geometry y value.
     * @param {Number=} px The new y value in pixels.
     * @example #Set the height of the entity
     *     entity.height(40);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */height:function(px,lockAspect){if(px!==undefined){if(lockAspect){// Calculate the width from the change in height
var ratio=px/this._bounds2d.y;this.width(this._bounds2d.x*ratio);}this._bounds2d.y=px;this._bounds2d.y2=px/2;if(this._pixiTexture&&!this._pixiTexture._destroyed){this._pixiTexture.height=px;}else if(this._pixiContainer&&!this._pixiContainer._destroyed){this._pixiContainer.height=px;}else if(this._pixiText&&!this._pixiText._destroyed){return this._pixiText.height=px;}return this;}if(this._pixiTexture){return this._pixiTexture.height;}else if(this._pixiContainer){return this._pixiContainer.height;}else if(this._pixiText){return this._pixiText.height;}return this._bounds2d.y;},/**
     * Gets / sets the 2d geometry of the entity. The x and y values are
     * relative to the center of the entity. This geometry is used when
     * rendering textures for the entity and positioning in world space as
     * well as UI positioning calculations. It holds no bearing on isometric
     * positioning.
     * @param {Number=} x The new x value in pixels.
     * @param {Number=} y The new y value in pixels.
     * @example #Set the dimensions of the entity (width and height)
     *     entity.bounds2d(40, 40);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */bounds2d:function(x,y){if(x!==undefined&&y!==undefined){this._bounds2d=new $i_4(x,y,0);return this;}if(x!==undefined&&y===undefined){// x is considered an $i_4 instance
this._bounds2d=new $i_4(x.x,x.y);}return this._bounds2d;},getBounds:function(){// for entities with bodies like unit/item/projectile/etc
var bounds={x:this._translate.x-this.width()/2,y:this._translate.y-this.height()/2,width:this.width(),height:this.height()};// get bounds of spriteOnly item carried by unit
if(this._category=='item'){var ownerUnit=this.getOwnerUnit();if(ownerUnit&&this._stats&&this._stats.currentBody.type=='spriteOnly'&&!this.body){bounds={x:ownerUnit._translate.x+this.anchorOffset.x-this._stats.currentBody.width/2,y:ownerUnit._translate.y+this.anchorOffset.y-this._stats.currentBody.height/2,width:this._stats.currentBody.width,height:this._stats.currentBody.height};}}return bounds;},/**
     * Gets / sets the 3d geometry of the entity. The x and y values are
     * relative to the center of the entity and the z value is wholly
     * positive from the "floor". Used to define a 3d bounding cuboid for
     * the entity used in isometric depth sorting and hit testing.
     * @param {Number=} x The new x value in pixels.
     * @param {Number=} y The new y value in pixels.
     * @param {Number=} z The new z value in pixels.
     * @example #Set the dimensions of the entity (width, height and length)
     *     entity.bounds3d(40, 40, 20);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */bounds3d:function(x,y,z){if(x!==undefined&&y!==undefined&&z!==undefined){this._bounds3d=new $i_5(x,y,z);return this;}return this._bounds3d;},/**
     * @deprecated Use bounds3d instead
     * @param x
     * @param y
     * @param z
     */size3d:function(x,y,z){$i_56.prototype.log('size3d has been renamed to bounds3d but is exactly the same so please search/replace your code to update calls.','warning');},/**
     * Gets / sets the life span of the object in milliseconds. The life
     * span is how long the object will exist for before being automatically
     * destroyed.
     * @param {Number=} milliseconds The number of milliseconds the entity
     * will live for from the current time.
     * @param {Function=} deathCallback Optional callback method to call when
     * the entity is destroyed from end of lifespan.
     * @example #Set the lifespan of the entity to 2 seconds after which it will automatically be destroyed
     *     entity.lifeSpan(2000);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */lifeSpan:function(milliseconds,deathCallback){if(milliseconds!=undefined){this.deathTime(ige._currentTime+milliseconds,deathCallback);return this;}return this.deathTime()-ige._currentTime;},/**
     * Gets / sets the timestamp in milliseconds that denotes the time
     * that the entity will be destroyed. The object checks it's own death
     * time during each tick and if the current time is greater than the
     * death time, the object will be destroyed.
     * @param {Number=} val The death time timestamp. This is a time relative
     * to the engine's start time of zero rather than the current time that
     * would be retrieved from new Date().getTime(). It is usually easier
     * to call lifeSpan() rather than setting the deathTime directly.
     * @param {Function=} deathCallback Optional callback method to call when
     * the entity is destroyed from end of lifespan.
     * @example #Set the death time of the entity to 60 seconds after engine start
     *     entity.deathTime(60000);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */deathTime:function(val,deathCallback){this._deathTime=val;if(val!==undefined){if(deathCallback!==undefined){this._deathCallBack=deathCallback;}return this;}return this._deathTime;},/**
     * Gets / sets the entity opacity from 0.0 to 1.0.
     * @param {Number=} val The opacity value.
     * @example #Set the entity to half-visible
     *     entity.opacity(0.5);
     * @example #Set the entity to fully-visible
     *     entity.opacity(1.0);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */opacity:function(val){if(val!==undefined){this._opacity=val;return this;}return this._opacity;},/**
     * Gets / sets the noAabb flag that determines if the entity's axis
     * aligned bounding box should be calculated every tick or not. If
     * you don't need the AABB data (for instance if you don't need to
     * detect mouse events on this entity or you DO want the AABB to be
     * updated but want to control it manually by calling aabb(true)
     * yourself as needed).
     * @param {Boolean=} val If set to true will turn off AABB calculation.
     * @returns {*}
     */noAabb:function(val){if(val!==undefined){this._noAabb=val;return this;}return this._noAabb;},/**
     * Gets / sets the texture to use when rendering the entity.
     * @param {$i_50=} texture The texture object.
     * @example #Set the entity texture (image)
     *     var texture = new $i_50('path/to/some/texture.png');
     *     entity.texture(texture);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */texture:function(texture){if(texture!==undefined){this._texture=texture;return this;}return this._texture;},/**
     * Gets / sets the current texture cell used when rendering the game
     * object's texture. If the texture is not cell-based, this value is
     * ignored.
     * @param {Number=} val The cell index.
     * @example #Set the entity texture as a 4x4 cell sheet and then set the cell to use
     *     var texture = new $i_51('path/to/some/cellSheet.png', 4, 4);
     *     entity.texture(texture)
     *         .cell(3);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */cell:function(val){if(val>0||val===null){this._cell=val;return this;}return this._cell;},/**
     * Gets / sets the current texture cell used when rendering the game
     * object's texture. If the texture is not cell-based, this value is
     * ignored. This differs from cell() in that it accepts a string id
     * as the cell
     * @param {Number=} val The cell id.
     * @example #Set the entity texture as a sprite sheet with cell ids and then set the cell to use
     *     var texture = new $i_52('path/to/some/cellSheet.png', [
     *         [0, 0, 40, 40, 'robotHead'],
     *         [40, 0, 40, 40, 'humanHead'],
     *     ]);
     *
     *     // Assign the texture, set the cell to use and then
     *     // set the entity to the size of the cell automatically!
     *     entity.texture(texture)
     *         .cellById('robotHead')
     *         .dimensionsFromCell();
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */cellById:function(val){if(val!==undefined){if(this._texture){// Find the cell index this id corresponds to
var i;var tex=this._texture;var cells=tex._cells;for(i=1;i<cells.length;i++){if(cells[i][4]===val){// Found the cell id so assign this cell index
this.cell(i);return this;}}// We were unable to find the cell index from the cell
// id so produce an error
$i_56.prototype.log(`Could not find the cell id "${val}" in the assigned entity texture ${tex.id()}, please check your sprite sheet (texture) cell definition to ensure the cell id "${val}" has been assigned to a cell!`,'error');}else{$i_56.prototype.log('Cannot assign cell index from cell ID until an $i_52 has been set as the texture for this entity. Please set the texture before calling cellById().','error');}}return this._cell;},/**
     * Sets the geometry of the entity to match the width and height
     * of the assigned texture.
     * @param {Number=} percent The percentage size to resize to.
     * @example #Set the entity dimensions based on the assigned texture
     *     var texture = new $i_50('path/to/some/texture.png');
     *
     *     // Assign the texture, and then set the entity to the
     *     // size of the texture automatically!
     *     entity.texture(texture)
     *         .dimensionsFromTexture();
     * @return {*} The object this method was called from to allow
     * method chaining.
     */dimensionsFromTexture:function(percent){if(this._texture){if(percent===undefined){this.width(this._texture._sizeX);this.height(this._texture._sizeY);}else{this.width(Math.floor(this._texture._sizeX/100*percent));this.height(Math.floor(this._texture._sizeY/100*percent));}// Recalculate localAabb
this.localAabb(true);}return this;},/**
     * Sets the geometry of the entity to match the width and height
     * of the assigned texture cell. If the texture is not cell-based
     * the entire texture width / height will be used.
     * @param {Number=} percent The percentage size to resize to.
     * @example #Set the entity dimensions based on the assigned texture and cell
     *     var texture = new $i_52('path/to/some/cellSheet.png', [
     *         [0, 0, 40, 40, 'robotHead'],
     *         [40, 0, 40, 40, 'humanHead'],
     *     ]);
     *
     *     // Assign the texture, set the cell to use and then
     *     // set the entity to the size of the cell automatically!
     *     entity.texture(texture)
     *         .cellById('robotHead')
     *         .dimensionsFromCell();
     * @return {*} The object this method was called from to allow
     * method chaining
     */dimensionsFromCell:function(percent){if(this._texture){if(this._texture._cells&&this._texture._cells.length){if(percent===undefined){this.width(this._texture._cells[this._cell][2]);this.height(this._texture._cells[this._cell][3]);}else{this.width(Math.floor(this._texture._cells[this._cell][2]/100*percent));this.height(Math.floor(this._texture._cells[this._cell][3]/100*percent));}// Recalculate localAabb
this.localAabb(true);}}return this;},/**
     * Gets / sets the highlight mode. True is on false is off.
     * @param {Boolean} val The highlight mode true or false.
     * @example #Set the entity to render highlighted
     *     entity.highlight(true);
     * @example #Get the current highlight state
     *     var isHighlighted = entity.highlight();
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */highlight:function(val){if(val!==undefined){this._highlight=val;return this;}return this._highlight;},/**
     * Returns the absolute world position of the entity as an
     * $i_5.
     * @example #Get the world position of the entity
     *     var wordPos = entity.worldPosition();
     * @return {$i_5} The absolute world position of the
     * entity.
     */worldPosition:function(){return new $i_5(this._worldMatrix.matrix[2],this._worldMatrix.matrix[5],0);},/**
     * Returns the absolute world rotation z of the entity as a
     * value in radians.
     * @example #Get the world rotation of the entity's z axis
     *     var wordRot = entity.worldRotationZ();
     * @return {Number} The absolute world rotation z of the
     * entity.
     */worldRotationZ:function(){return this._worldMatrix.rotationRadians();},/**
     * Converts an array of points from local space to this entity's
     * world space using it's world transform matrix. This will alter
     * the points passed in the array directly.
     * @param {Array} points The array of IgePoints to convert.
     */localToWorld:function(points,viewport,inverse){viewport=viewport||ige._currentViewport;if(this._adjustmentMatrix){// Apply the optional adjustment matrix
this._worldMatrix.multiply(this._adjustmentMatrix);}if(!inverse){this._worldMatrix.transform(points,this);}else{this._localMatrix.transform(points,this);// this._worldMatrix.getInverse().transform(points, this);
}if(this._ignoreCamera){// viewport.camera._worldMatrix.transform(points, this);
}},/**
     * Converts a point from local space to this entity's world space
     * using it's world transform matrix. This will alter the point's
     * data directly.
     * @param {$i_5} point The $i_5 to convert.
     */localToWorldPoint:function(point,viewport){viewport=viewport||ige._currentViewport;this._worldMatrix.transform([point],this);},/**
     * Returns the screen position of the entity as an $i_5 where x is the
     * "left" and y is the "top", useful for positioning HTML elements at the
     * screen location of an IGE entity. This method assumes that the top-left
     * of the main canvas element is at 0, 0. If not you can adjust the values
     * yourself to allow for offset.
     * @example #Get the screen position of the entity
     *     var screenPos = entity.screenPosition();
     * @return {$i_5} The screen position of the entity.
     */screenPosition:function(){return new $i_5(Math.floor((this._worldMatrix.matrix[2]-ige._currentCamera._translate.x)*ige._currentCamera._scale.x+ige._bounds2d.x2),Math.floor((this._worldMatrix.matrix[5]-ige._currentCamera._translate.y)*ige._currentCamera._scale.y+ige._bounds2d.y2),0);},/**
     * @deprecated Use bounds3dPolygon instead
     */localIsoBoundsPoly:function(){},localBounds3dPolygon:function(recalculate){if(this._bounds3dPolygonDirty||!this._localBounds3dPolygon||recalculate){var geom=this._bounds3d;var poly=new $i_6();// Bottom face
var bf2=Math.toIso(+geom.x2,-geom.y2,-geom.z2);var bf3=Math.toIso(+geom.x2,+geom.y2,-geom.z2);var bf4=Math.toIso(-geom.x2,+geom.y2,-geom.z2);// Top face
var tf1=Math.toIso(-geom.x2,-geom.y2,geom.z2);var tf2=Math.toIso(+geom.x2,-geom.y2,geom.z2);var tf4=Math.toIso(-geom.x2,+geom.y2,geom.z2);poly.addPoint(tf1.x,tf1.y).addPoint(tf2.x,tf2.y).addPoint(bf2.x,bf2.y).addPoint(bf3.x,bf3.y).addPoint(bf4.x,bf4.y).addPoint(tf4.x,tf4.y).addPoint(tf1.x,tf1.y);this._localBounds3dPolygon=poly;this._bounds3dPolygonDirty=false;}return this._localBounds3dPolygon;},/**
     * @deprecated Use bounds3dPolygon instead
     */isoBoundsPoly:function(){},bounds3dPolygon:function(recalculate){if(this._bounds3dPolygonDirty||!this._bounds3dPolygon||recalculate){var poly=this.localBounds3dPolygon(recalculate).clone();// Convert local co-ordinates to world based on entities world matrix
this.localToWorld(poly._poly);this._bounds3dPolygon=poly;}return this._bounds3dPolygon;},/**
     * @deprecated Use mouseInBounds3d instead
     */mouseInIsoBounds:function(){},mouseInBounds3d:function(recalculate){var poly=this.localBounds3dPolygon(recalculate);var mp=this.mousePos();return poly.pointInside(mp);},/**
     * Calculates and returns the current axis-aligned bounding box in
     * world co-ordinates.
     * @param {Boolean=} recalculate If true this will force the
     * recalculation of the AABB instead of returning a cached
     * value.
     * @example #Get the entity axis-aligned bounding box dimensions
     *     var aabb = entity.aabb();
     *
     *     $i_56.prototype.log(aabb.x);
     *     $i_56.prototype.log(aabb.y);
     *     $i_56.prototype.log(aabb.width);
     *     $i_56.prototype.log(aabb.height);
     * @example #Get the entity axis-aligned bounding box dimensions forcing the engine to update the values first
     *     var aabb = entity.aabb(true); // Call with true to force update
     *
     *     $i_56.prototype.log(aabb.x);
     *     $i_56.prototype.log(aabb.y);
     *     $i_56.prototype.log(aabb.width);
     *     $i_56.prototype.log(aabb.height);
     * @return {$i_7} The axis-aligned bounding box in world co-ordinates.
     */aabb:function(recalculate,inverse){if(this._aabbDirty||!this._aabb||recalculate){//  && this.newFrame()
var poly=new $i_6();var minX;var minY;var maxX;var maxY;var box;var anc=this._anchor;var ancX=anc.x;var ancY=anc.y;var geom;var geomX2;var geomY2;var x;var y;geom=this._bounds2d;geomX2=geom.x2;geomY2=geom.y2;x=geomX2;y=geomY2;poly.addPoint(-x+ancX,-y+ancY);poly.addPoint(x+ancX,-y+ancY);poly.addPoint(x+ancX,y+ancY);poly.addPoint(-x+ancX,y+ancY);this._renderPos={x:-x+ancX,y:-y+ancY};// Convert the poly's points from local space to world space
this.localToWorld(poly._poly,null,inverse);// Get the extents of the newly transformed poly
minX=Math.min(poly._poly[0].x,poly._poly[1].x,poly._poly[2].x,poly._poly[3].x);minY=Math.min(poly._poly[0].y,poly._poly[1].y,poly._poly[2].y,poly._poly[3].y);maxX=Math.max(poly._poly[0].x,poly._poly[1].x,poly._poly[2].x,poly._poly[3].x);maxY=Math.max(poly._poly[0].y,poly._poly[1].y,poly._poly[2].y,poly._poly[3].y);box=new $i_7(minX,minY,maxX-minX,maxY-minY);this._aabb=box;this._aabbDirty=false;}return this._aabb;},/**
     * Calculates and returns the local axis-aligned bounding box
     * for the entity. This is the AABB relative to the entity's
     * center point.
     * @param {Boolean=} recalculate If true this will force the
     * recalculation of the local AABB instead of returning a cached
     * value.
     * @example #Get the entity local axis-aligned bounding box dimensions
     *     var aabb = entity.localAabb();
     *
     *     $i_56.prototype.log(aabb.x);
     *     $i_56.prototype.log(aabb.y);
     *     $i_56.prototype.log(aabb.width);
     *     $i_56.prototype.log(aabb.height);
     * @example #Get the entity local axis-aligned bounding box dimensions forcing the engine to update the values first
     *     var aabb = entity.localAabb(true); // Call with true to force update
     *
     *     $i_56.prototype.log(aabb.x);
     *     $i_56.prototype.log(aabb.y);
     *     $i_56.prototype.log(aabb.width);
     *     $i_56.prototype.log(aabb.height);
     * @return {$i_7} The local AABB.
     */localAabb:function(recalculate){if(!this._localAabb||recalculate){var aabb=this.aabb();this._localAabb=new $i_7(-Math.floor(aabb.width/2),-Math.floor(aabb.height/2),Math.floor(aabb.width),Math.floor(aabb.height));}return this._localAabb;},/**
     * Calculates the axis-aligned bounding box for this entity, including
     * all child entity bounding boxes and returns the final composite
     * bounds.
     * @example #Get the composite AABB
     *     var entity = new $i_56(),
     *         aabb = entity.compositeAabb();
     * @return {$i_7}
     */compositeAabb:function(inverse){var arr=this._children;var arrCount;var rect;if(inverse){rect=this.aabb(true,inverse).clone();}else{rect=this.aabb().clone();}// Now loop all children and get the aabb for each of them
// them add those bounds to the current rect
if(arr){arrCount=arr.length;var x=0;while(arrCount--){x++;if(x>10000){$i_56.prototype.log('$i_56 1255');break;}// for detecting infinite loops
rect.thisCombineRect(arr[arrCount].compositeAabb(inverse));}}return rect;},/**
     * Gets / sets the composite stream flag. If set to true, any objects
     * mounted to this one will have their streamMode() set to the same
     * value as this entity and will also have their compositeStream flag
     * set to true. This allows you to easily automatically stream any
     * objects mounted to a root object and stream them all.
     * @param val
     * @returns {*}
     */compositeStream:function(val){if(val!==undefined){this._compositeStream=val;return this;}return this._compositeStream;},/**
     * Override the _childMounted method and apply entity-based flags.
     * @param {$i_56} child
     * @private
     */_childMounted:function(child){// Check if we need to set the compositeStream and streamMode
if(this.compositeStream()){child.compositeStream(true);child.streamMode(this.streamMode());child.streamControl(this.streamControl());}$i_55.prototype._childMounted.call(this,child);// Check if we are compositeCached and update the cache
if(this.compositeCache()){this.cacheDirty(true);}},/**
     * Takes two values and returns them as an array where index [0]
     * is the y argument and index[1] is the x argument. This method
     * is used specifically in the 3d bounds intersection process to
     * determine entity depth sorting.
     * @param {Number} x The first value.
     * @param {Number} y The second value.
     * @return {Array} The swapped arguments.
     * @private
     */_swapVars:function(x,y){return[y,x];},_internalsOverlap:function(x0,x1,y0,y1){var tempSwap;if(x0>x1){tempSwap=this._swapVars(x0,x1);x0=tempSwap[0];x1=tempSwap[1];}if(y0>y1){tempSwap=this._swapVars(y0,y1);y0=tempSwap[0];y1=tempSwap[1];}if(x0>y0){tempSwap=this._swapVars(x0,y0);x0=tempSwap[0];y0=tempSwap[1];tempSwap=this._swapVars(x1,y1);x1=tempSwap[0];y1=tempSwap[1];}return y0<x1;},_projectionOverlap:function(otherObject){var thisG3d=this._bounds3d;var thisMin={x:this._translate.x-thisG3d.x/2,y:this._translate.y-thisG3d.y/2,z:this._translate.z-thisG3d.z};var thisMax={x:this._translate.x+thisG3d.x/2,y:this._translate.y+thisG3d.y/2,z:this._translate.z+thisG3d.z};var otherG3d=otherObject._bounds3d;var otherMin={x:otherObject._translate.x-otherG3d.x/2,y:otherObject._translate.y-otherG3d.y/2,z:otherObject._translate.z-otherG3d.z};var otherMax={x:otherObject._translate.x+otherG3d.x/2,y:otherObject._translate.y+otherG3d.y/2,z:otherObject._translate.z+otherG3d.z};return this._internalsOverlap(thisMin.x-thisMax.y,thisMax.x-thisMin.y,otherMin.x-otherMax.y,otherMax.x-otherMin.y)&&this._internalsOverlap(thisMin.x-thisMax.z,thisMax.x-thisMin.z,otherMin.x-otherMax.z,otherMax.x-otherMin.z)&&this._internalsOverlap(thisMin.z-thisMax.y,thisMax.z-thisMin.y,otherMin.z-otherMax.y,otherMax.z-otherMin.y);},/**
     * Compares the current entity's 3d bounds to the passed entity and
     * determines if the current entity is "behind" the passed one. If an
     * entity is behind another, it is drawn first during the scenegraph
     * render phase.
     * @param {$i_56} otherObject The other entity to check this
     * entity's 3d bounds against.
     * @example #Determine if this entity is "behind" another entity based on the current depth-sort
     *     var behind = entity.isBehind(otherEntity);
     * @return {Boolean} If true this entity is "behind" the passed entity
     * or false if not.
     */isBehind:function(otherObject){var thisG3d=this._bounds3d;var otherG3d=otherObject._bounds3d;var thisTranslate=this._translate.clone();var otherTranslate=otherObject._translate.clone();// thisTranslate.thisToIso();
// otherTranslate.thisToIso();
if(this._origin.x!==0.5||this._origin.y!==0.5){thisTranslate.x+=this._bounds2d.x*(0.5-this._origin.x);thisTranslate.y+=this._bounds2d.y*(0.5-this._origin.y);}if(otherObject._origin.x!==0.5||otherObject._origin.y!==0.5){otherTranslate.x+=otherObject._bounds2d.x*(0.5-otherObject._origin.x);otherTranslate.y+=otherObject._bounds2d.y*(0.5-otherObject._origin.y);}var thisX=thisTranslate.x;var thisY=thisTranslate.y;var otherX=otherTranslate.x;var otherY=otherTranslate.y;var thisMin=new $i_5(thisX-thisG3d.x/2,thisY-thisG3d.y/2,this._translate.z);var thisMax=new $i_5(thisX+thisG3d.x/2,thisY+thisG3d.y/2,this._translate.z+thisG3d.z);var otherMin=new $i_5(otherX-otherG3d.x/2,otherY-otherG3d.y/2,otherObject._translate.z);var otherMax=new $i_5(otherX+otherG3d.x/2,otherY+otherG3d.y/2,otherObject._translate.z+otherG3d.z);if(thisMax.x<=otherMin.x){return false;}if(otherMax.x<=thisMin.x){return true;}if(thisMax.y<=otherMin.y){return false;}if(otherMax.y<=thisMin.y){return true;}if(thisMax.z<=otherMin.z){return false;}if(otherMax.z<=thisMin.z){return true;}return thisX+thisY+this._translate.z>otherX+otherY+otherObject._translate.z;},/**
     * Get / set the flag determining if this entity will respond
     * to mouse interaction or not. When you set a mouse* event e.g.
     * mouseUp, mouseOver etc this flag will automatically be reset
     * to true.
     * @param {Boolean=} val The flag value true or false.
     * @example #Set entity to ignore mouse events
     *     entity.mouseEventsActive(false);
     * @example #Set entity to receive mouse events
     *     entity.mouseEventsActive(true);
     * @example #Get current flag value
     *     var val = entity.mouseEventsActive();
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */mouseEventsActive:function(val){if(val!==undefined){this._mouseEventsActive=val;return this;}return this._mouseEventsActive;},/**
     * Sets the _ignoreCamera internal flag to the value passed for this
     * and all child entities down the scenegraph.
     * @param val
     */ignoreCameraComposite:function(val){var i;var arr=this._children;var arrCount=arr.length;this._ignoreCamera=val;for(i=0;i<arrCount;i++){if(arr[i].ignoreCameraComposite){arr[i].ignoreCameraComposite(val);}}},/**
     * Determines if the frame alternator value for this entity
     * matches the engine's frame alternator value. The entity's
     * frame alternator value will be set to match the engine's
     * after each call to the entity.tick() method so the return
     * value of this method can be used to determine if the tick()
     * method has already been run for this entity.
     *
     * This is useful if you have multiple viewports which will
     * cause the entity tick() method to fire once for each viewport
     * but you only want to execute update code such as movement etc
     * on the first time the tick() method is called.
     *
     * @example #Determine if the entity has already had it's tick method called
     *     var tickAlreadyCalled = entity.newFrame();
     * @return {Boolean} If false, the entity's tick method has
     * not yet been processed for this tick.
     */newFrame:function(){return ige._frameAlternator!==this._frameAlternatorCurrent;},/**
     * Sets the canvas context transform properties to match the the game
     * object's current transform values.
     * @param {CanvasRenderingContext2D} ctx The canvas context to apply
     * the transformation matrix to.
     * @example #Transform a canvas context to the entity's local matrix values
     *     var canvas = document.createElement('canvas');
     *     canvas.width = 800;
     *     canvas.height = 600;
     *
     *     var ctx = canvas.getContext('2d');
     *     entity._transformContext(ctx);
     * @private
     */_transformContext:function(ctx,inverse){if(this._parent){ctx.globalAlpha=this._computedOpacity=this._parent._computedOpacity*this._opacity;}else{ctx.globalAlpha=this._computedOpacity=this._opacity;}if(!inverse){this._localMatrix.transformRenderingContext(ctx);}else{this._localMatrix.getInverse().transformRenderingContext(ctx);}},mouseAlwaysInside:function(val){if(val!==undefined){this._mouseAlwaysInside=val;return this;}return this._mouseAlwaysInside;},/**
     * Processes the updates required each render frame. Any code in the update()
     * method will be called ONCE for each render frame BEFORE the tick() method.
     * This differs from the tick() method in that the tick method can be called
     * multiple times during a render frame depending on how many viewports your
     * simulation is being rendered to, whereas the update() method is only called
     * once. It is therefore the perfect place to put code that will control your
     * entity's motion, AI etc.
     * @param {CanvasRenderingContext2D} ctx The canvas context to render to.
     */update:function(ctx,tickDelta,isForOrphans){// var category = this._category || 'etc';
// if (ige.updateCount[category] == undefined)
// 	ige.updateCount[category] = 0;
// ige.updateCount[category]++;
// if (ige.physics.engine === 'CRASH' && this.body) {
// 	this._behaviourCrash();
// }
if(this._deathTime!==undefined&&this._deathTime<=ige._tickStart){// Check if the deathCallBack was set
if(this._deathCallBack){this._deathCallBack.apply(this);delete this._deathCallback;}this.destroy();}else{// Check that the entity has been born
if(this._bornTime===undefined||ige._currentTime>=this._bornTime){// Remove the stream data cache
delete this._streamDataCache;if(!isForOrphans&&ige.gameLoopTickHasExecuted){// Process any behaviours assigned to the entity
this._processUpdateBehaviours(ctx,tickDelta);}// Update this object's current frame alternator value
// which allows us to determine if we are still on the
// same frame
this._frameAlternatorCurrent=ige._frameAlternator;}else{// sometimes when user returns to the game's tab/window, this._parent is set to null and causing errors
if(this._parent){// The entity is not yet born, unmount it and add to the spawn queue
this._birthMount=this._parent.id();}this.unMount();ige.spawnQueue(this);}}// dont process super class if its from orphan. bcz orphan only need to update stream data and its translate
if(!isForOrphans){// Process super class
$i_55.prototype.update.call(this,ctx,tickDelta);}},// convert numbers stored as string in database to int
parseEntityObject:function(stats){var self=this;if(typeof stats==='object'){for(var key in stats){if(typeof stats[key]==='object'){self.parseEntityObject(stats[key]);}else if(/^-?\d+$/.test(stats[key])){stats[key]=parseFloat(stats[key]);}}}},/**
     * Processes the actions required each render frame.
     * @param {CanvasRenderingContext2D} ctx The canvas context to render to.
     * @param {Boolean} dontTransform If set to true, the tick method will
     * not transform the context based on the entity's matrices. This is useful
     * if you have extended the class and want to process down the inheritance
     * chain but have already transformed the entity in a previous overloaded
     * method.
     */tick:function(ctx,dontTransform){if(this._inView)ige.inViewCount++;if(!this._hidden&&this._inView&&(!this._parent||this._parent._inView)||mode!='play'){// var category = this._category || 'etc';
// if (ige.tickCount[category] == undefined)
// 	ige.tickCount[category] = 0;
// ige.tickCount[category]++;
ige.tickCount++;// Process any behaviours assigned to the entity
this._processTickBehaviours(ctx);// Process any mouse events we need to do
if(this._mouseEventsActive){if(this._processTriggerHitTests()){// Point is inside the trigger bounds
ige.input.queueEvent(this,this._mouseInTrigger,null);}else{if(ige.input.mouseMove){// There is a mouse move event but we are not inside the entity
// so fire a mouse out event (_handleMouseOut will check if the
// mouse WAS inside before firing an out event).
this._handleMouseOut(ige.input.mouseMove);}}}// _dontRender doesn't exist anywhere! ??? - jaeyun
if(!this._dontRender){// Check for cached version
if(this._cache||this._compositeCache){// Caching is enabled
if(this._cacheDirty){// The cache is dirty, redraw it
this._refreshCache(dontTransform);}// Now render the cached image data to the main canvas
this._renderCache(ctx);}else{// Non-cached output
// Transform the context by the current transform settings
if(!dontTransform){this._transformContext(ctx);}// Render item below unit currently disabled
// if (this._category === 'unit') {
// 	if (this._compositeCache) {
// 		if (this._cacheDirty) {
// 			// Process children
// 			$i_55.prototype.tick.call(this, this._cacheCtx, true);
// 			this._renderCache(ctx);
// 			this._cacheDirty = false;
// 		}
// 	} else {
// 		// Process children
// 		$i_55.prototype.tick.call(this, ctx, true);
// 	}
// }
this._renderEntity(ctx,dontTransform);}}// Process any automatic-mode stream updating required
if(this._streamMode===1||this._streamMode===2){this.streamSync();}if(this._compositeCache){if(this._cacheDirty){// Process children
$i_55.prototype.tick.call(this,this._cacheCtx);this._renderCache(ctx);this._cacheDirty=false;}}else{// Process children
$i_55.prototype.tick.call(this,ctx);}}},playEffect:function(type){if(this._stats&&this._stats.effects&&this._stats.effects[type]){var effect=this._stats.effects[type];if(ige.isServer){if(type=='move'||type=='idle'||type=='none'){this.streamUpdateData([{effect:type}]);}}else if(ige.isClient){if(this._pixiContainer&&this._pixiContainer._destroyed){return;}var position=this._translate;if(this._category==='item'&&this._stats.currentBody&&(this._stats.currentBody.type==='spriteOnly'||this._stats.currentBody.type==='none')){var ownerUnit=this.getOwnerUnit();position=ownerUnit&&ownerUnit._pixiContainer||position;}// play default animation if animation isn't set.
if(effect.animation==undefined||effect.animation=='none'){var currentState=this._stats.states[this._stats.stateId];this.applyAnimationById(currentState.animation);}else{this.applyAnimationById(effect.animation);}if(effect.projectileType){var projectile=ige.game.getAsset('projectileTypes',effect.projectileType);if(projectile){var position=ige.game.lastProjectileHitPosition||this.body&&this.body.getPosition()||this._translate;if(this.body){position.x*=this._b2dRef._scaleRatio;position.y*=this._b2dRef._scaleRatio;}projectile.defaultData={//type: effect.projectileType,
translate:{x:position.x,y:position.y},rotate:this._rotate.z};//fix added for correct phaser projectile texture
projectile.type=effect.projectileType;new Projectile(projectile);}}var shouldRepeat=type==='move';var isAlreadyPlaying=false;if(this.isPlayingSound){this.isPlayingSound.loop=shouldRepeat;if(shouldRepeat){isAlreadyPlaying=true;this.isPlayingSound.play();}}if(effect.sound){for(var soundKey in effect.sound){if(!isAlreadyPlaying){this.isPlayingSound=ige.sound.playSound(effect.sound[soundKey],position,soundKey,shouldRepeat);if(this.isPlayingSound){this.isPlayingSound.effect=effect.sound[soundKey];}}}}var angle=this._rotate.z;if(type=='attacked'){// get angle between attacked unit and attacking unit
var attacker=this.lastAttackedBy;if(attacker){angle=Math.atan2(attacker._translate.y-this._translate.y,attacker._translate.x-this._translate.x)+Math.radians(90);}}this.tween.start(effect.tween,angle);}else if(ige.isServer){if(effect.runScript){ige.script.runScript(effect.runScript,{});}}}else{if(ige.isClient){this.applyAnimationById('default');// play default animation if effect isn't set
}}},_processTriggerHitTests:function(){var mp,mouseTriggerPoly;if(ige._currentViewport){if(!this._mouseAlwaysInside){mp=this.mousePosWorld();if(mp){// Use the trigger polygon if defined
if(this._triggerPolygon&&this[this._triggerPolygon]){mouseTriggerPoly=this[this._triggerPolygon](mp);}else{// Default to either aabb or bounds3dPolygon depending on entity parent mounting mode
if(this._parent&&this._parent._mountMode===1){// Use bounds3dPolygon
mouseTriggerPoly=this.bounds3dPolygon();}else{// Use aabb
mouseTriggerPoly=this.aabb();}}// Check if the current mouse position is inside this aabb
return mouseTriggerPoly.xyInside(mp.x,mp.y);}}else{return true;}}return false;},_refreshCache:function(dontTransform){// The cache is not clean so re-draw it
// Render the entity to the cache
var _canvas=this._cacheCanvas;var _ctx=this._cacheCtx;if(this._compositeCache){// Get the composite entity AABB and alter the internal canvas
// to the composite size so we can render the entire entity
var aabbC=this.compositeAabb(true);this._compositeAabbCache=aabbC;if(aabbC.width>0&&aabbC.height>0){_canvas.width=Math.ceil(aabbC.width);_canvas.height=Math.ceil(aabbC.height);}else{// We cannot set a zero size for a canvas, it will
// cause the browser to freak out
_canvas.width=2;_canvas.height=2;}// Translate to the center of the canvas
_ctx.translate(-aabbC.x,-aabbC.y);/**
             * Fires when the entity's composite cache is ready.
             * @event $i_56#compositeReady
             */this.emit('compositeReady');}else{if(this._bounds2d.x>0&&this._bounds2d.y>0){_canvas.width=this._bounds2d.x;_canvas.height=this._bounds2d.y;}else{// We cannot set a zero size for a canvas, it will
// cause the browser to freak out
_canvas.width=1;_canvas.height=1;}// Translate to the center of the canvas
_ctx.translate(this._bounds2d.x2,this._bounds2d.y2);this._cacheDirty=false;}// Transform the context by the current transform settings
if(!dontTransform){this._transformContext(_ctx);}this._renderEntity(_ctx,dontTransform);},flip:function(flip){// if (this._category == 'item') {
// 	if (flip == 1)
// 	console.trace()
// console.log("flip", flip)
// }
// execute below iff flip orientation changes
if(ige.isServer){if(flip!=this._stats.flip){// if (this._category == 'unit' && this._stats.name != 'm0dE')
// 	console.log(flip)
this.streamUpdateData([{flip:flip}]);}}else if(ige.isClient){if(this._stats.flip!=flip){// if (this._category =='unit' && this._stats.name != 'm0dE')
// 	console.log("wtf", flip)
var entity=this._pixiTexture;if(entity){var x=Math.abs(entity.scale.x);var y=Math.abs(entity.scale.y);if(flip==0){entity.scale.set(x,y);}if(flip==1){entity.scale.set(-x,y);}if(flip==2){entity.scale.set(x,-y);}if(flip==3){entity.scale.set(-x,-y);}}}}this._stats.flip=flip;},/**
     * Handles calling the texture.render() method if a texture
     * is applied to the entity. This part of the tick process has
     * been abstracted to allow it to be overridden by an extending
     * class.
     * @param {CanvasRenderingContext2D} ctx The canvas context to render
     * the entity to.
     * @private
     */_renderEntity:function(ctx){if(this._opacity>0){// Check if the entity has a background pattern
if(this._backgroundPattern){if(!this._backgroundPatternFill){// We have a pattern but no fill produced
// from it. Check if we have a context to
// generate a pattern from
if(ctx){// Produce the pattern fill
this._backgroundPatternFill=ctx.createPattern(this._backgroundPattern.image,this._backgroundPatternRepeat);}}if(this._backgroundPatternFill){// Draw the fill
ctx.save();ctx.fillStyle=this._backgroundPatternFill;// TODO: When firefox has fixed their bug regarding negative rect co-ordinates, revert this change
// This is the proper way to do this but firefox has a bug which I'm gonna report
// so instead I have to use ANOTHER translate call instead. So crap!
// ctx.rect(-this._bounds2d.x2, -this._bounds2d.y2, this._bounds2d.x, this._bounds2d.y);
ctx.translate(-this._bounds2d.x2,-this._bounds2d.y2);ctx.rect(0,0,this._bounds2d.x,this._bounds2d.y);if(this._backgroundPatternTrackCamera){ctx.translate(-ige._currentCamera._translate.x,-ige._currentCamera._translate.y);ctx.scale(ige._currentCamera._scale.x,ige._currentCamera._scale.y);}ctx.fill();ige._drawCount++;if(this._backgroundPatternIsoTile){ctx.translate(-Math.floor(this._backgroundPattern.image.width)/2,-Math.floor(this._backgroundPattern.image.height/2));ctx.fill();ige._drawCount++;}ctx.restore();}}var texture=this._texture;// Check if the entity is visible based upon its opacity
if(texture&&texture._loaded){// Draw the entity image
// flip texture horizontally/vertically if requested
if(this._stats.flip==1){ctx.save();ctx.scale(-1,1);}if(this._stats.flip==2){ctx.save();ctx.scale(1,-1);}if(this._stats.flip==3){ctx.save();ctx.scale(-1,-1);}texture.render(ctx,this,ige._tickDelta);if(this._stats.flip>0){ctx.restore();}if(this._highlight){ctx.globalCompositeOperation='lighter';texture.render(ctx,this);}}if(this._compositeCache&&ige._currentViewport._drawCompositeBounds){// $i_56.prototype.log('moo');
ctx.fillStyle='rgba(0, 0, 255, 0.3)';ctx.fillRect(-this._bounds2d.x2,-this._bounds2d.y2,this._bounds2d.x,this._bounds2d.y);ctx.fillStyle='#ffffff';ctx.fillText('Composite Entity',-this._bounds2d.x2,-this._bounds2d.y2-15);ctx.fillText(this.id(),-this._bounds2d.x2,-this._bounds2d.y2-5);}}},/**
     * Draws the cached off-screen canvas image data to the passed canvas
     * context.
     * @param {CanvasRenderingContext2D} ctx The canvas context to render
     * the entity to.
     * @private
     */_renderCache:function(ctx){ctx.save();if(this._compositeCache){var aabbC=this._compositeAabbCache;ctx.translate(this._bounds2d.x2+aabbC.x,this._bounds2d.y2+aabbC.y);if(this._parent&&this._parent._ignoreCamera){// Translate the entity back to negate the scene translate
var cam=ige._currentCamera;// ctx.translate(-cam._translate.x, -cam._translate.y);
/* this.scaleTo(1 / cam._scale.x, 1 / cam._scale.y, 1 / cam._scale.z);
				this.rotateTo(-cam._rotate.x, -cam._rotate.y, -cam._rotate.z); */}}// We have a clean cached version so output that
ctx.drawImage(this._cacheCanvas,-this._bounds2d.x2,-this._bounds2d.y2);if(ige._currentViewport._drawCompositeBounds){ctx.fillStyle='rgba(0, 255, 0, 0.5)';ctx.fillRect(-this._bounds2d.x2,-this._bounds2d.y2,this._cacheCanvas.width,this._cacheCanvas.height);ctx.fillStyle='#ffffff';ctx.fillText('Composite Cache',-this._bounds2d.x2,-this._bounds2d.y2-15);ctx.fillText(this.id(),-this._bounds2d.x2,-this._bounds2d.y2-5);}ige._drawCount++;if(this._highlight){ctx.globalCompositeOperation='lighter';ctx.drawImage(this._cacheCanvas,-this._bounds2d.x2,-this._bounds2d.y2);ige._drawCount++;}ctx.restore();},/**
     * Transforms a point by the entity's parent world matrix and
     * it's own local matrix transforming the point to this entity's
     * world space.
     * @param {$i_5} point The point to transform.
     * @example #Transform a point by the entity's world matrix values
     *     var point = new $i_5(0, 0, 0);
     *     entity._transformPoint(point);
     *
     *     $i_56.prototype.log(point);
     * @return {$i_5} The transformed point.
     * @private
     */_transformPoint:function(point){if(this._parent){var tempMat=new $i_8();// Copy the parent world matrix
tempMat.copy(this._parent._worldMatrix);// Apply any local transforms
tempMat.multiply(this._localMatrix);// Now transform the point
tempMat.getInverse().transformCoord(point,this);}else{this._localMatrix.transformCoord(point,this);}return point;},/**
     * Helper method to transform an array of points using _transformPoint.
     * @param {Array} points The points array to transform.
     * @private
     */_transformPoints:function(points){var point;var pointCount=points.length;var x=0;while(pointCount--){x++;if(x>10000){$i_56.prototype.log('$i_56 1964');break;}// for detecting infinite loops
point=points[pointCount];if(this._parent){var tempMat=new $i_8();// Copy the parent world matrix
tempMat.copy(this._parent._worldMatrix);// Apply any local transforms
tempMat.multiply(this._localMatrix);// Now transform the point
tempMat.getInverse().transformCoord(point,this);}else{this._localMatrix.transformCoord(point,this);}}},/**
     * Generates a string containing a code fragment that when
     * evaluated will reproduce this object's properties via
     * chained commands. This method will only check for
     * properties that are directly related to this class.
     * Other properties are handled by their own class method.
     * @return {String} The string code fragment that will
     * reproduce this entity when evaluated.
     */_stringify:function(options){// Make sure we have an options object
if(options===undefined){options={};}// Get the properties for all the super-classes
var str=$i_55.prototype._stringify.call(this,options);var i;// Loop properties and add property assignment code to string
for(i in this){if(this.hasOwnProperty(i)&&this[i]!==undefined){switch(i){case'_opacity':str+=`.opacity(${this.opacity()})`;break;case'_texture':str+=`.texture(ige.$('${this.texture().id()}'))`;break;case'_cell':str+=`.cell(${this.cell()})`;break;case'_translate':if(options.transform!==false&&options.translate!==false){str+=`.translateTo(${this._translate.x}, ${this._translate.y}, ${this._translate.z})`;}break;case'_rotate':if(options.transform!==false&&options.rotate!==false){str+=`.rotateTo(${this._rotate.x}, ${this._rotate.y}, ${this._rotate.z})`;}break;case'_scale':if(options.transform!==false&&options.scale!==false){str+=`.scaleTo(${this._scale.x}, ${this._scale.y}, ${this._scale.z})`;}break;case'_origin':if(options.origin!==false){str+=`.originTo(${this._origin.x}, ${this._origin.y}, ${this._origin.z})`;}break;case'_anchor':if(options.anchor!==false){str+=`.anchor(${this._anchor.x}, ${this._anchor.y})`;}break;case'_width':if(typeof this.width()==='string'){str+=`.width('${this.width()}')`;}else{str+=`.width(${this.width()})`;}break;case'_height':if(typeof this.height()==='string'){str+=`.height('${this.height()}')`;}else{str+=`.height(${this.height()})`;}break;case'_bounds3d':str+=`.bounds3d(${this._bounds3d.x}, ${this._bounds3d.y}, ${this._bounds3d.z})`;break;case'_deathTime':if(options.deathTime!==false&&options.lifeSpan!==false){str+=`.deathTime(${this.deathTime()})`;}break;case'_highlight':str+=`.highlight(${this.highlight()})`;break;}}}return str;},/**
     * Destroys the entity by removing it from the scenegraph,
     * calling destroy() on any child entities and removing
     * any active event listeners for the entity. Once an entity
     * has been destroyed it's this._alive flag is also set to
     * false.
     * @example #Destroy the entity
     *     entity.destroy();
     */destroy:function(destroyOrphan){$i_56.prototype.log(`igeEntity: destroy ${this._category} ${this.id()}`);this._alive=false;if(this.gluedEntities&&this.gluedEntities.length>0){this.gluedEntities.forEach(function(glueEntity){var entity=ige.$(glueEntity.id);if(entity&&(entity._pixiText||entity._pixiTexture)){var texture=entity._pixiText||entity._pixiTexture;entity.unMount();entity.destroy();// texture.destroy({ children: true, texture: true });
delete ige.pixi.trackEntityById[glueEntity.id];}});}if(ige.isClient){var entityId=this.entityId||this.id();if(ige.pixi.trackEntityById[entityId]){// entity.destroy()
// ige.pixi.viewport.follow();
if(ige.client.myPlayer&&ige.client.myPlayer.currentFollowUnit==this.id()){ige.pixi.viewport.removePlugin('follow');this.emit('stop-follow');}var texture=ige.pixi.trackEntityById[entityId]._pixiTexture||ige.pixi.trackEntityById[entityId]._pixiText||ige.pixi.trackEntityById[entityId];// its not instance of ige
if(texture&&!texture.componentId&&!texture._destroyed){ige.pixi.world.removeChild(texture);texture.destroy({children:true,texture:true});if(ige.pixiMap.layersGroup&&!ige.pixiMap.layersGroup.floor.parent&&!ige.isLog){ige.isLog=true;}}ige.pixi.trackEntityById[entityId]._destroyed=true;delete ige.pixi.trackEntityById[entityId];}// destory attribute bars
if(this.attributeBars){for(var attributeBarInfo of this.attributeBars){var pixiBarId=attributeBarInfo.id;var pixiBar=ige.$(pixiBarId);pixiBar.destroy();}}}/**
         * Fires when the entity has been destroyed.
         * @event $i_56#destroyed
         * @param {$i_56} The entity that has been destroyed.
         */for(var region in ige.regionManager.entitiesInRegion){delete ige.regionManager.entitiesInRegion[region][this.id()];}$i_56.prototype.log(`entity destroyed ${this.id()} category: ${this._category} ${this._stats?this._stats.name:''}`);this.emit('destroyed',this);// Call $i_55.destroy()
$i_55.prototype.destroy.call(this);if(ige.isClient&&ige.$('baseScene')._orphans){delete ige.$('baseScene')._orphans[this._id];}},// remove all pointers referencing to this entity
clearAllPointers:function(){var keysToDelete=['ability','animation','attribute','attributeBarsContainer','fadingTextContainer','inventory','minimapUnit','unitNameLabel','unitUi','_aabb','_bounds2d','_bounds3d','_rotate','_velocity'];for(var i=0;i<keysToDelete.length;i++){var key=keysToDelete[i];if(this[key]&&typeof this[key].destroy==='function'){this[key].destroy();delete this[key];}}},saveSpecialProp:function(obj,i){switch(i){case'_texture':if(obj._texture){return{_texture:obj._texture.id()};}break;default:// Call super-class saveSpecialProp
return $i_55.prototype.saveSpecialProp.call(this,obj,i);break;}return undefined;},loadSpecialProp:function(obj,i){switch(i){case'_texture':return{_texture:ige.$(obj[i])};break;default:// Call super-class loadSpecialProp
return $i_55.prototype.loadSpecialProp.call(this,obj,i);break;}return undefined;},/// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
// INTERACTION
/// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
     * Gets / sets the callback that is fired when a mouse
     * move event is triggered.
     * @param {Function=} callback
     * @example #Hook the mouse move event and stop it propagating further down the scenegraph
     *     entity.mouseMove(function (event, control) {
     *         // Mouse moved with button
     *         $i_56.prototype.log('Mouse move button: ' + event.button);
     *
     *         // Stop the event propagating further down the scenegraph
     *         control.stopPropagation();
     *
     *         // You can ALSO stop propagation without the control object
     *         // reference via the global reference:
     *         ige.input.stopPropagation();
     *     });
     * @return {*}
     */mouseMove:function(callback){if(callback){this._mouseMove=callback;this._mouseEventsActive=true;return this;}return this._mouseMove;},/**
     * Gets / sets the callback that is fired when a mouse
     * over event is triggered.
     * @param {Function=} callback
     * @example #Hook the mouse over event and stop it propagating further down the scenegraph
     *     entity.mouseOver(function (event, control) {
     *         // Mouse over with button
     *         $i_56.prototype.log('Mouse over button: ' + event.button);
     *
     *         // Stop the event propagating further down the scenegraph
     *         control.stopPropagation();
     *
     *         // You can ALSO stop propagation without the control object
     *         // reference via the global reference:
     *         ige.input.stopPropagation();
     *     });
     * @return {*}
     */mouseOver:function(callback){if(callback){this._mouseOver=callback;this._mouseEventsActive=true;return this;}return this._mouseOver;},/**
     * Gets / sets the callback that is fired when a mouse
     * out event is triggered.
     * @param {Function=} callback
     * @example #Hook the mouse out event and stop it propagating further down the scenegraph
     *     entity.mouseOut(function (event, control) {
     *         // Mouse out with button
     *         $i_56.prototype.log('Mouse out button: ' + event.button);
     *
     *         // Stop the event propagating further down the scenegraph
     *         control.stopPropagation();
     *
     *         // You can ALSO stop propagation without the control object
     *         // reference via the global reference:
     *         ige.input.stopPropagation();
     *     });
     * @return {*}
     */mouseOut:function(callback){if(callback){this._mouseOut=callback;this._mouseEventsActive=true;return this;}return this._mouseOut;},/**
     * Gets / sets the callback that is fired when a mouse
     * up event is triggered.
     * @param {Function=} callback
     * @example #Hook the mouse up event and stop it propagating further down the scenegraph
     *     entity.mouseUp(function (event, control) {
     *         // Mouse up with button
     *         $i_56.prototype.log('Mouse up button: ' + event.button);
     *
     *         // Stop the event propagating further down the scenegraph
     *         control.stopPropagation();
     *
     *         // You can ALSO stop propagation without the control object
     *         // reference via the global reference:
     *         ige.input.stopPropagation();
     *     });
     * @return {*}
     */mouseUp:function(callback){if(callback){this._mouseUp=callback;this._mouseEventsActive=true;return this;}return this._mouseUp;},/**
     * Gets / sets the callback that is fired when a mouse
     * down event is triggered.
     * @param {Function=} callback
     * @example #Hook the mouse down event and stop it propagating further down the scenegraph
     *     entity.mouseDown(function (event, control) {
     *         // Mouse down with button
     *         $i_56.prototype.log('Mouse down button: ' + event.button);
     *
     *         // Stop the event propagating further down the scenegraph
     *         control.stopPropagation();
     *
     *         // You can ALSO stop propagation without the control object
     *         // reference via the global reference:
     *         ige.input.stopPropagation();
     *     });
     * @return {*}
     */mouseDown:function(callback){if(callback){this._mouseDown=callback;this._mouseEventsActive=true;return this;}return this._mouseDown;},/**
     * Gets / sets the callback that is fired when a mouse
     * wheel event is triggered.
     * @param {Function=} callback
     * @example #Hook the mouse wheel event and stop it propagating further down the scenegraph
     *     entity.mouseWheel(function (event, control) {
     *         // Mouse wheel with button
     *         $i_56.prototype.log('Mouse wheel button: ' + event.button);
     *         $i_56.prototype.log('Mouse wheel delta: ' + event.wheelDelta);
     *
     *         // Stop the event propagating further down the scenegraph
     *         control.stopPropagation();
     *
     *         // You can ALSO stop propagation without the control object
     *         // reference via the global reference:
     *         ige.input.stopPropagation();
     *     });
     * @return {*}
     */mouseWheel:function(callback){if(callback){this._mouseWheel=callback;this._mouseEventsActive=true;return this;}return this._mouseWheel;},/**
     * Removes the callback that is fired when a mouse
     * move event is triggered.
     */mouseMoveOff:function(){delete this._mouseMove;return this;},/**
     * Removes the callback that is fired when a mouse
     * over event is triggered.
     */mouseOverOff:function(){delete this._mouseOver;return this;},/**
     * Removes the callback that is fired when a mouse
     * out event is triggered.
     */mouseOutOff:function(){delete this._mouseOut;return this;},/**
     * Removes the callback that is fired when a mouse
     * up event is triggered.
     */mouseUpOff:function(){delete this._mouseUp;return this;},/**
     * Removes the callback that is fired when a mouse
     * down event is triggered if the listener was registered
     * via the mouseDown() method.
     */mouseDownOff:function(){delete this._mouseDown;return this;},/**
     * Removes the callback that is fired when a mouse
     * wheel event is triggered.
     */mouseWheelOff:function(){delete this._mouseWheel;return this;},triggerPolygon:function(poly){if(poly!==undefined){this._triggerPolygon=poly;return this;}return this._triggerPolygon;},/**
     * Gets / sets the shape / polygon that the mouse events
     * are triggered against. There are two options, 'aabb' and
     * 'isoBounds'. The default is 'aabb'.
     * @param val
     * @returns {*}
     * @deprecated
     */mouseEventTrigger:function(val){$i_56.prototype.log('mouseEventTrigger is no longer in use. Please see triggerPolygon() instead.','warning');/* if (val !== undefined) {
			// Set default value
			this._mouseEventTrigger = 0;

			switch (val) {
				case 'isoBounds':
					this._mouseEventTrigger = 1;
					break;

				case 'custom':
					this._mouseEventTrigger = 2;
					break;

				case 'aabb':
					this._mouseEventTrigger = 0;
					break;
			}
			return this;
		}

		return this._mouseEventTrigger === 0 ? 'aabb' : 'isoBounds'; */},/**
     * Handler method that determines which mouse-move event
     * to fire, a mouse-over or a mouse-move.
     * @private
     */_handleMouseIn:function(event,evc,data){// Check if the mouse move is a mouse over
if(!this._mouseStateOver){this._mouseStateOver=true;if(this._mouseOver){this._mouseOver(event,evc,data);}/**
             * Fires when the mouse moves over the entity.
             * @event $i_56#mouseOver
             * @param {Object} The DOM event object.
             * @param {Object} The IGE event control object.
             * @param {*} Any further event data.
             */this.emit('mouseOver',[event,evc,data]);}if(this._mouseMove){this._mouseMove(event,evc,data);}this.emit('mouseMove',[event,evc,data]);},/**
     * Handler method that determines if a mouse-out event
     * should be fired.
     * @private
     */_handleMouseOut:function(event,evc,data){// The mouse went away from this entity so
// set mouse-down to false, regardless of the situation
this._mouseStateDown=false;// Check if the mouse move is a mouse out
if(this._mouseStateOver){this._mouseStateOver=false;if(this._mouseOut){this._mouseOut(event,evc,data);}/**
             * Fires when the mouse moves away from the entity.
             * @event $i_56#mouseOut
             * @param {Object} The DOM event object.
             * @param {Object} The IGE event control object.
             * @param {*} Any further event data.
             */this.emit('mouseOut',[event,evc,data]);}},/**
     * Handler method that determines if a mouse-wheel event
     * should be fired.
     * @private
     */_handleMouseWheel:function(event,evc,data){if(this._mouseWheel){this._mouseWheel(event,evc,data);}/**
         * Fires when the mouse wheel is moved over the entity.
         * @event $i_56#mouseWheel
         * @param {Object} The DOM event object.
         * @param {Object} The IGE event control object.
         * @param {*} Any further event data.
         */this.emit('mouseWheel',[event,evc,data]);},/**
     * Handler method that determines if a mouse-up event
     * should be fired.
     * @private
     */_handleMouseUp:function(event,evc,data){// Reset the mouse-down flag
this._mouseStateDown=false;if(this._mouseUp){this._mouseUp(event,evc,data);}/**
         * Fires when a mouse up occurs on the entity.
         * @event $i_56#mouseUp
         * @param {Object} The DOM event object.
         * @param {Object} The IGE event control object.
         * @param {*} Any further event data.
         */this.emit('mouseUp',[event,evc,data]);},/**
     * Handler method that determines if a mouse-down event
     * should be fired.
     * @private
     */_handleMouseDown:function(event,evc,data){if(!this._mouseStateDown){this._mouseStateDown=true;if(this._mouseDown){this._mouseDown(event,evc,data);}/**
             * Fires when a mouse down occurs on the entity.
             * @event $i_56#mouseDown
             * @param {Object} The DOM event object.
             * @param {Object} The IGE event control object.
             * @param {*} Any further event data.
             */this.emit('mouseDown',[event,evc,data]);}},/**
     * Checks mouse input types and fires the correct mouse event
     * handler. This is an internal method that should never be
     * called externally.
     * @param {Object} evc The input component event control object.
     * @param {Object} data Data passed by the input component into
     * the new event.
     * @private
     */_mouseInTrigger:function(evc,data){if(ige.input.mouseMove){// There is a mouse move event
this._handleMouseIn(ige.input.mouseMove,evc,data);}if(ige.input.mouseDown){// There is a mouse down event
this._handleMouseDown(ige.input.mouseDown,evc,data);}if(ige.input.mouseUp){// There is a mouse up event
this._handleMouseUp(ige.input.mouseUp,evc,data);}if(ige.input.mouseWheel){// There is a mouse wheel event
this._handleMouseWheel(ige.input.mouseWheel,evc,data);}},/// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
// TRANSFORM
/// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
     * Enables tracing calls which inadvertently assign NaN values to
     * transformation properties. When called on an entity this system
     * will break with a debug line when a transform property is set
     * to NaN allowing you to step back through the call stack and
     * determine where the offending value originated.
     * @returns {$i_56}
     */debugTransforms:function(){ige.traceSet(this._translate,'x',1,function(val){return isNaN(val);});ige.traceSet(this._translate,'y',1,function(val){return isNaN(val);});ige.traceSet(this._translate,'z',1,function(val){return isNaN(val);});ige.traceSet(this._rotate,'x',1,function(val){return isNaN(val);});ige.traceSet(this._rotate,'y',1,function(val){return isNaN(val);});ige.traceSet(this._rotate,'z',1,function(val){return isNaN(val);});ige.traceSet(this._scale,'x',1,function(val){return isNaN(val);});ige.traceSet(this._scale,'y',1,function(val){return isNaN(val);});ige.traceSet(this._scale,'z',1,function(val){return isNaN(val);});return this;},velocityTo:function(x,y,z){if(x!==undefined&&y!==undefined&&z!==undefined){this._velocity.x=x;this._velocity.y=y;this._velocity.z=z;}else{$i_56.prototype.log('velocityTo() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},velocityBy:function(x,y,z){if(x!==undefined&&y!==undefined&&z!==undefined){this._velocity.x+=x;this._velocity.y+=y;this._velocity.z+=z;}else{$i_56.prototype.log('velocityBy() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},/**
     * Translates the entity by adding the passed values to
     * the current translation values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Translate the entity by 10 along the x axis
     *     entity.translateBy(10, 0, 0);
     * @return {*}
     */translateBy:function(x,y,z){if(!isNaN(x)&&!isNaN(y)&&!isNaN(z)&&x!==undefined&&y!==undefined&&z!==undefined){this._translate.x+=x;this._translate.y+=y;this._translate.z+=z;}else{$i_56.prototype.log('translateBy() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},/**
     * Translates the entity to the passed values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Translate the entity to 10, 0, 0
     *     entity.translateTo(10, 0, 0);
     * @return {*}
     */translateTo:function(x,y){// console.log('start translate', x, y)
if(x!==undefined&&y!==undefined){// console.log('non-crash translate', this._translate)
/* if (ige.physics && ige.physics.engine == 'CRASH') {
				console.log('crash translate');
				this.translateColliderTo(x, y);
			} */if(this._translate){this._translate.x=x;this._translate.y=y;}// ensure this entity is created at its latest position to the new clients. (instead of spawnPosition)
// this.defaultData.translate = this._translate;
}else{$i_56.prototype.log('translateTo() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},transformPixiEntity:function(x,y,z,type){if(!ige.isClient)return;var entity=this._pixiText||this._pixiContainer;if(entity&&!entity._destroyed){if(this._pixiTexture){this._pixiTexture.rotation=z;}// new
if(this._pixiCollider){this._pixiCollider.rotation=z;}//
if(!type){entity.x=x;entity.y=y;}entity.dirty=true;if(ige.pixi.viewport){ige.pixi.viewport.dirty=true;}}return this;},teleportTo:function(x,y,rotate){// console.log("teleporting to ", x, y);
this.translateTo(x,y);if(rotate!=undefined){this.rotateTo(0,0,rotate);}if(ige.isServer){ige.network.send('teleport',{entityId:this.id(),position:[x,y]});this.clientStreamedPosition=undefined;//////////////////////////////////////////
if(ige.physics&&ige.physics.engine=='CRASH'){this.translateColliderTo(x,y);}///////////////////////////////////////////
}else if(ige.isClient){this.lastServerStreamedPosition=undefined;if(this.body){this.body.setPosition({x:x/this._b2dRef._scaleRatio,y:y/this._b2dRef._scaleRatio});if(rotate!=undefined){this.body.setAngle(rotate);}}}this.discrepancyCount=0;this.lastTeleportedAt=ige._currentTime;if(this._category=='unit'){// teleport unit's attached items
for(entityId in this.jointsAttached){if(attachedEntity=ige.$(entityId)){if(attachedEntity._category=='item'){// to prevent infinite loop, only move items that are attached to unit
attachedEntity.teleportTo(attachedEntity._translate.x+offsetX,attachedEntity._translate.y+offsetY,attachedEntity._rotate.z);}}}}},isInVP:function(rect2){var vp=ige.pixi.viewport.getVisibleBounds();var rect1={x1:vp.x,y1:vp.y,x2:vp.x+vp.width,y2:vp.y+vp.height};if(rect1.x1>=rect2.x2||rect2.x1>=rect1.x2){return false;}// If one rectangle is above other
if(rect1.y1>=rect2.y2||rect2.y1>=rect1.y2){return false;}return true;},/**
     * Translates the entity to the passed point.
     * @param {$i_5} point The point with co-ordinates.
     * @example #Translate the entity to 10, 0, 0
     *     var point = new $i_5(10, 0, 0),
     *         entity = new $i_56();
     *
     *     entity.translateToPoint(point);
     * @return {*}
     */translateToPoint:function(point){if(point!==undefined){this._translate.x=point.x;this._translate.y=point.y;this._translate.z=point.z;}else{$i_56.prototype.log('translateToPoint() called with a missing or undefined point parameter!','error');}return this._entity||this;},/**
     * Translates the object to the tile co-ordinates passed.
     * @param {Number} x The x tile co-ordinate.
     * @param {Number} y The y tile co-ordinate.
     * @param {Number=} z The z tile co-ordinate.
     * @example #Translate entity to tile
     *     // Create a tile map
     *     var tileMap = new $i_63()
     *         .tileWidth(40)
     *         .tileHeight(40);
     *
     *     // Mount our entity to the tile map
     *     entity.mount(tileMap);
     *
     *     // Translate the entity to the tile x:10, y:12
     *     entity.translateToTile(10, 12, 0);
     * @return {*} The object this method was called from to allow
     * method chaining.
     */translateToTile:function(x,y,z){if(this._parent&&this._parent._tileWidth!==undefined&&this._parent._tileHeight!==undefined){var finalZ;// Handle being passed a z co-ordinate
if(z!==undefined){finalZ=z*this._parent._tileWidth;}else{finalZ=this._translate.z;}this.translateTo(x*this._parent._tileWidth+this._parent._tileWidth/2,y*this._parent._tileHeight+this._parent._tileWidth/2,finalZ);}else{$i_56.prototype.log('Cannot translate to tile because the entity is not currently mounted to a tile map or the tile map has no tileWidth or tileHeight values.','warning');}return this;},/**
     * Gets the translate accessor object.
     * @example #Use the translate accessor object to alter the y co-ordinate of the entity to 10
     *     entity.translate().y(10);
     * @return {*}
     */translate:function(){if(arguments.length){$i_56.prototype.log('You called translate with arguments, did you mean translateTo or translateBy instead of translate?','warning');}this.x=this._translateAccessorX;this.y=this._translateAccessorY;this.z=this._translateAccessorZ;return this._entity||this;},/**
     * The translate accessor method for the x axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.translate().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_translateAccessorX:function(val){if(val!==undefined){this._translate.x=val;return this._entity||this;}return this._translate.x;},/**
     * The translate accessor method for the y axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.translate().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_translateAccessorY:function(val){if(val!==undefined){this._translate.y=val;return this._entity||this;}return this._translate.y;},/**
     * The translate accessor method for the z axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.translate().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_translateAccessorZ:function(val){// TODO: Do we need to do anything to the matrix here for iso views?
// this._localMatrix.translateTo(this._translate.x, this._translate.y);
if(val!==undefined){this._translate.z=val;return this._entity||this;}return this._translate.z;},/**
     * Rotates the entity by adding the passed values to
     * the current rotation values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Rotate the entity by 10 degrees about the z axis
     *     entity.rotateBy(0, 0, Math.radians(10));
     * @return {*}
     */rotateBy:function(x,y,z){if(!isNaN(x)&&!isNaN(y)&&!isNaN(z)&&x!==undefined&&y!==undefined&&z!==undefined){this._rotate.x+=x;this._rotate.y+=y;this._rotate.z+=z;this.transformPixiEntity(0,0,z,'rotateBy');}else{$i_56.prototype.log('rotateBy() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},/**
     * Rotates the entity to the passed values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Rotate the entity to 10 degrees about the z axis
     *     entity.rotateTo(0, 0, Math.radians(10));
     * @return {*}
     */rotateTo:function(x,y,z){// if (this._category == 'item')
// 	console.log("asdf!", z)
if(!isNaN(x)&&!isNaN(y)&&!isNaN(z)&&x!==undefined&&y!==undefined&&z!==undefined){this._rotate.x=x;this._rotate.y=y;this._rotate.z=z;}else{$i_56.prototype.log('rotateTo() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},/**
     * Gets the translate accessor object.
     * @example #Use the rotate accessor object to rotate the entity about the z axis 10 degrees
     *     entity.rotate().z(Math.radians(10));
     * @return {*}
     */rotate:function(){if(arguments.length){$i_56.prototype.log('You called rotate with arguments, did you mean rotateTo or rotateBy instead of rotate?','warning');}this.x=this._rotateAccessorX;this.y=this._rotateAccessorY;this.z=this._rotateAccessorZ;return this._entity||this;},/**
     * The rotate accessor method for the x axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.rotate().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_rotateAccessorX:function(val){if(val!==undefined){this._rotate.x=val;return this._entity||this;}return this._rotate.x;},/**
     * The rotate accessor method for the y axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.rotate().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_rotateAccessorY:function(val){if(val!==undefined){this._rotate.y=val;return this._entity||this;}return this._rotate.y;},/**
     * The rotate accessor method for the z axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.rotate().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_rotateAccessorZ:function(val){if(val!==undefined){this._rotate.z=val;return this._entity||this;}return this._rotate.z;},/**
     * Scales the entity by adding the passed values to
     * the current scale values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Scale the entity by 2 on the x axis
     *     entity.scaleBy(2, 0, 0);
     * @return {*}
     */scaleBy:function(x,y,z){if(x!==undefined&&y!==undefined&&z!==undefined){this._scale.x+=x;this._scale.y+=y;this._scale.z+=z;}else{$i_56.prototype.log('scaleBy() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},/**
     * Scale the entity to the passed values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Set the entity scale to 1 on all axes
     *     entity.scaleTo(1, 1, 1);
     * @return {*}
     */pixiScaleTo:function(x,y){// if (this._category == 'item') {
// }
if(x!==undefined&&y!==undefined){if(this._pixiTexture&&!this._pixiTexture._destroyed){this._pixiTexture.scale.set(x,y);}else if(this._pixiText&&!this._pixiText._destroyed){this._pixiText.scale.set(x,y);}else if(this._pixiContainer&&!this._pixiContainer._destroyed){this._pixiContainer.scale.set(x,y);}}},scaleTo:function(x,y,z){this.pixiScaleTo(x,y);if(this._scale&&x!==undefined&&y!==undefined&&z!==undefined){this._scale.x=x;this._scale.y=y;this._scale.z=z;// $i_56.prototype.log("scaling to ", this._scale)
}else{$i_56.prototype.log('scaleTo() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},scaleDimensions:function(width,height){if(this._stats.scaleDimensions){var originalWidth=this.width();var originalHeight=this.height();var scaleX=width/originalWidth;var scaleY=height/originalHeight;if(ige.isServer){this.scaleTo(scaleX,scaleY,0);this.updateBody(undefined,false,true);}else{this.height(height);this.width(width);}}},/**
     * Gets the scale accessor object.
     * @example #Use the scale accessor object to set the scale of the entity on the x axis to 1
     *     entity.scale().x(1);
     * @return {*}
     */scale:function(){if(arguments.length){$i_56.prototype.log('You called scale with arguments, did you mean scaleTo or scaleBy instead of scale?','warning');}this.x=this._scaleAccessorX;this.y=this._scaleAccessorY;this.z=this._scaleAccessorZ;return this._entity||this;},/**
     * The scale accessor method for the x axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.scale().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_scaleAccessorX:function(val){if(val!==undefined){this._scale.x=val;return this._entity||this;}return this._scale.x;},/**
     * The scale accessor method for the y axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.scale().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_scaleAccessorY:function(val){if(val!==undefined){this._scale.y=val;return this._entity||this;}return this._scale.y;},/**
     * The scale accessor method for the z axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.scale().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_scaleAccessorZ:function(val){if(val!==undefined){this._scale.z=val;return this._entity||this;}return this._scale.z;},/**
     * Sets the origin of the entity by adding the passed values to
     * the current origin values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Add 0.5 to the origin on the x axis
     *     entity.originBy(0.5, 0, 0);
     * @return {*}
     */originBy:function(x,y,z){if(x!==undefined&&y!==undefined&&z!==undefined){this._origin.x+=x;this._origin.y+=y;this._origin.z+=z;}else{$i_56.prototype.log('originBy() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},/**
     * Set the origin of the entity to the passed values.
     * @param {Number} x The x co-ordinate.
     * @param {Number} y The y co-ordinate.
     * @param {Number} z The z co-ordinate.
     * @example #Set the entity origin to 0.5 on all axes
     *     entity.originTo(0.5, 0.5, 0.5);
     * @return {*}
     */originTo:function(x,y,z){if(x!==undefined&&y!==undefined&&z!==undefined){this._origin.x=x;this._origin.y=y;this._origin.z=z;}else{$i_56.prototype.log('originTo() called with a missing or undefined x, y or z parameter!','error');}return this._entity||this;},/**
     * Gets the origin accessor object.
     * @example #Use the origin accessor object to set the origin of the entity on the x axis to 1
     *     entity.origin().x(1);
     * @return {*}
     */origin:function(){this.x=this._originAccessorX;this.y=this._originAccessorY;this.z=this._originAccessorZ;return this._entity||this;},/**
     * The origin accessor method for the x axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.origin().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_originAccessorX:function(val){if(val!==undefined){this._origin.x=val;return this._entity||this;}return this._origin.x;},/**
     * The origin accessor method for the y axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.origin().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_originAccessorY:function(val){if(val!==undefined){this._origin.y=val;return this._entity||this;}return this._origin.y;},/**
     * The origin accessor method for the z axis. This
     * method is not called directly but is accessed through
     * the accessor object obtained by calling entity.origin().
     * @param {Number=} val The new value to apply to the co-ordinate.
     * @return {*}
     * @private
     */_originAccessorZ:function(val){if(val!==undefined){this._origin.z=val;return this._entity||this;}return this._origin.z;},_rotatePoint:function(point,radians,origin){var cosAngle=Math.cos(radians);var sinAngle=Math.sin(radians);return{x:origin.x+(point.x-origin.x)*cosAngle+(point.y-origin.y)*sinAngle,y:origin.y-(point.x-origin.x)*sinAngle+(point.y-origin.y)*cosAngle};},/**
     * Checks the current transform values against the previous ones. If
     * any value is different, the appropriate method is called which will
     * update the transformation matrix accordingly.
     */updateTransform:function(){ige.updateTransform++;this._localMatrix.identity();if(this._mode===0){// 2d translation
this._localMatrix.multiply(this._localMatrix._newTranslate(this._translate.x,this._translate.y));}if(this._mode===1){if(!isNaN(this._translate.x)&&!isNaN(this._translate.y)){// iso translation
var isoPoint=this._translateIso=new $i_5(this._translate.x,this._translate.y,this._translate.z+this._bounds3d.z/2).toIso();if(this._parent&&this._parent._bounds3d.z){// This adjusts the child entity so that 0, 0, 0 inside the
// parent is the center of the base of the parent
isoPoint.y+=this._parent._bounds3d.z/1.6;}this._localMatrix.multiply(this._localMatrix._newTranslate(isoPoint.x,isoPoint.y));}else{console.log('localMatrix translate error: ',this._category,this._translate);if(ige.chat)ige.chat.postMessage({text:`localMatrix translate error: ${this._category}${this._stats}`?this._stats.name:''});}}ige.matrixEntityId=this.id();ige.matrixAngle=this._rotate.z;this._localMatrix.rotateBy(this._rotate.z);this._localMatrix.scaleBy(this._scale.x,this._scale.y);// Adjust local matrix for origin values if not at center
if(this._origin.x!==0.5||this._origin.y!==0.5){this._localMatrix.translateBy(this._bounds2d.x*(0.5-this._origin.x),this._bounds2d.y*(0.5-this._origin.y));}// TODO: If the parent and local transforms are unchanged, we should used cached values
if(this._parent){this._worldMatrix.copy(this._parent._worldMatrix);this._worldMatrix.multiply(this._localMatrix);}else{this._worldMatrix.copy(this._localMatrix);}// Check if the world matrix has changed and if so, set a few flags
// to allow other methods to know that a matrix change has occurred
if(!this._worldMatrix.compare(this._oldWorldMatrix)){this._oldWorldMatrix.copy(this._worldMatrix);this._transformChanged=true;this._aabbDirty=true;this._bounds3dPolygonDirty=true;}else{this._transformChanged=false;}// Check if the geometry has changed and if so, update the aabb dirty
if(!this._oldBounds2d.compare(this._bounds2d)){this._aabbDirty=true;// Record the new geometry to the oldGeometry data
this._oldBounds2d.copy(this._bounds2d);}if(!this._oldBounds3d.compare(this._bounds3d)){this._bounds3dPolygonDirty=true;// Record the new geometry to the oldGeometry data
this._oldBounds3d.copy(this._bounds3d);}return this;},/**
     * Gets / sets the disable interpolation flag. If set to true then
     * stream data being received by the client will not be interpolated
     * and will be instantly assigned instead. Useful if your entity's
     * transformations should not be interpolated over time.
     * @param val
     * @returns {*}
     */disableInterpolation:function(val){if(val!==undefined){this._disableInterpolation=val;return this;}return this._disableInterpolation;},/// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
// STREAM
/// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
     * Gets / sets the array of sections that this entity will
     * encode into its stream data.
     * @param {Array=} sectionArray An array of strings.
     * @example #Define the sections this entity will use in the network stream. Use the default "transform" section as well as a "custom1" section
     *     entity.streamSections('transform', 'custom1');
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */streamSections:function(sectionArray){if(sectionArray!==undefined){this._streamSections=sectionArray;return this;}return this._streamSections;},/**
     * Adds a section into the existing streamed sections array.
     * @param {String} sectionName The section name to add.
     */streamSectionsPush:function(sectionName){this._streamSections=this._streamSections||[];this._streamSections.push(sectionName);return this;},getPersistentData:function(type){var self=this;var dataToBeSaved={};var variables={};var unit=null;var player=null;var isUnitExists=false;dataToBeSaved[type]={};if(type=='player'){player=self;unit=ige.$(player._stats.selectedUnitId);if(!player||!player._stats)return;}else if(type=='unit'){unit=self;player=unit.getOwner();if(!unit||!unit._stats)return;}isUnitExists=!!(unit&&unit._stats);var variablesToBeIgnored=['unit','item','player','playerGroup','itemGroup','unitGroup','projectile','region'];for(var variablesId in self.variables){var variable=self.variables[variablesId];if(!variablesToBeIgnored.includes(variable.dataType)){variables[variablesId]=JSON.parse(JSON.stringify(variable));}}if(isUnitExists){// remove all passive attributes applyed to this unit
unit._stats.itemIds.forEach(function(itemId){if(itemId){var item=ige.$(itemId);if(item._stats.bonus&&item._stats.bonus.passive){if(item._stats.slotIndex<unit._stats.inventorySize||item._stats.bonus.passive.isDisabledInBackpack!=true){unit.updateStats(itemId,true);}}else{unit.updateStats(itemId,true);}}});}dataToBeSaved[type]={attributes:_.cloneDeep(self._stats.attributes),variables:variables};if(isUnitExists){// add all passive attributes applyed to this unit
unit._stats.itemIds.forEach(function(itemId){if(itemId){var item=ige.$(itemId);if(item._stats.bonus&&item._stats.bonus.passive){if(item._stats.slotIndex<unit._stats.inventorySize||item._stats.bonus.passive.isDisabledInBackpack!=true){unit.updateStats(itemId);}}else{unit.updateStats(itemId);}}});}if(isUnitExists&&type=='unit'&&unit._stats.itemIds){var inventoryItems=unit._stats.itemIds.reduce(function(pv,cv){if(cv){var item=ige.$(cv);if(item){var itemVariable={};for(var variablesId in item.variables){var variable=item.variables[variablesId];if(!variablesToBeIgnored.includes(variable.dataType)){itemVariable[variablesId]=JSON.parse(JSON.stringify(variable));}}var itemStatsToBeSaved={itemTypeId:item._stats.itemTypeId,attributes:_.cloneDeep(item._stats.attributes),variables:_.cloneDeep(itemVariable),quantity:item._stats.quantity};pv.push(itemStatsToBeSaved);}}return pv;},[]);dataToBeSaved[type].inventoryItems=inventoryItems;}return _.cloneDeep(dataToBeSaved[type]);},updateStats:function(itemId,removeAttributes){var self=this;var item=ige.$(itemId);if(!ige.isServer)return;// 1. store the unit's current attribute values. let's say we had 500/600 HP (base max 100hp)
var currentType=this._category==='unit'?'unitTypes':'playerTypes';var bonusType=this._category==='unit'?'unitAttribute':'playerAttribute';var currentEntityTypeId=this._category==='unit'?'type':'playerTypeId';var baseEntityStats=ige.game.getAsset(currentType,this._stats[currentEntityTypeId]);if(!baseEntityStats){return;}var unit=self;if(currentType==='playerTypes'){unit=this.getSelectedUnit();}if(item&&item._stats.bonus&&item._stats.bonus.passive&&unit&&(unit.canUseItem(item._stats)||removeAttributes)){var attributePassiveBonuses=item._stats.bonus.passive[bonusType];if(attributePassiveBonuses){for(var attrId in attributePassiveBonuses){var selectedAttribute=this._stats.attributes[attrId];var bonus=attributePassiveBonuses[attrId];if(selectedAttribute&&bonus){var currentAttributeValue=parseFloat(selectedAttribute.value)||1;var maxValue=parseFloat(selectedAttribute.max);if(currentAttributeValue!=undefined){if(removeAttributes){if(bonus.type==='percentage'){var newValue=currentAttributeValue/(1+parseFloat(bonus.value)/100);var newMax=maxValue/(1+parseFloat(bonus.value)/100);}else{var newMax=maxValue-parseFloat(bonus.value);var newValue=Math.min(newMax,Math.max(selectedAttribute.min,currentAttributeValue));}}else{if(bonus.type==='percentage'){var newValue=currentAttributeValue*(1+parseFloat(bonus.value)/100);var newMax=maxValue*(1+parseFloat(bonus.value)/100);}else{var newMax=maxValue+parseFloat(bonus.value);var newValue=Math.min(newMax,Math.max(selectedAttribute.min,currentAttributeValue));}}// this._stats.attributes[attrId].value = newValue;
// this._stats.attributes[attrId].max = newMax;
// updatedAttributes[attrId] = newValue;
// updatedAttributes[attrId] = newMax;
this.attribute.setMax(attrId,newMax);this.attribute.update(attrId,newValue,true);}}}}}// update player attributes;
if(currentType==='unitTypes'){var player=this.getOwner();player&&player.updateStats(itemId,removeAttributes);}},loadPersistentData:function(persistData){var self=this;if(persistData){var attributes=persistData.attributes;var variables=persistData.variables;var max={};var min={};var regSpeed={};var keysToStream=['min','max','regenerateSpeed','value'];for(var attrKey in attributes){var persistAttribute=attributes[attrKey];var playerAttribute=self._stats&&self._stats.attributes&&self._stats.attributes[attrKey];if(playerAttribute){for(var i=0;i<keysToStream.length;i++){var key=keysToStream[i];switch(key){// we are persisting min, max and regenerating speed for
// consumed item giving any bonuses
case'min':playerAttribute.min=persistAttribute[key];min[attrKey]=persistAttribute[key];break;case'max':playerAttribute.max=persistAttribute[key];max[attrKey]=persistAttribute[key];break;case'regenerateSpeed':playerAttribute.regenerateSpeed=persistAttribute[key];regSpeed[attrKey]=persistAttribute[key];break;case'value':var newValue=Math.max(playerAttribute.min,Math.min(persistAttribute[key],playerAttribute.max));self.attribute.update(attrKey,newValue,true);break;}}}}self.streamUpdateData([{attributesMax:max},{attributesMin:min},{attributesRegenerateRate:regSpeed}]);for(var variableKey in variables){var persistVariable=variables[variableKey];if(self&&self.variables&&self.variables[variableKey]){self.variables[variableKey]=persistVariable;}}}},mouseEvents:function(defaultData){var self=this;if(typeof mode==='string'&&mode==='sandbox'){$i_55.prototype.mount.call(this,ige.client.rootScene);self.mount(ige.client.rootScene);self.drawMouse(true).drawBoundsData(false).mouseDown(function(event,evc){if(event.which===1&&ige.mapEditor.selectEntities){this.onMouseDown=true;this.onMouseMove=false;}}).mouseMove(function(event){if(this.onMouseDown&&ige.mapEditor.selectEntities){this.onMouseMove=true;this.translateTo(ige.mapEditor.mouseCoordinatesWRTVp.x,ige.mapEditor.mouseCoordinatesWRTVp.y,0);}}).mouseUp(function(event){if(this.onMouseDown===true){if(this.onMouseMove===true){self.scriptValues.x=ige.mapEditor.mouseCoordinatesWRTVp.x;self.scriptValues.y=ige.mapEditor.mouseCoordinatesWRTVp.y;ige.mapEditor.upsertMapEntities(self.scriptValues,parseInt(self.scriptValues.index));}else if(this.onMouseMove===false&&ige.mapEditor.selectEntities&&event.which===1){ige.mapEditor.openEntitiesModal(self.scriptValues,true);this.selectedEntityForMovement=true;}}this.onMouseDown=false;this.onMouseMove=false;});}},// use to apply max,min value before attributes value
// orderData: function (data) {
// 	var attributes = data.attributes && _.cloneDeep(data.attributes);
// 	var attributesMax = data.attributesMax && _.cloneDeep(data.attributesMax);
// 	var attributesMin = data.attributesMin && _.cloneDeep(data.attributesMin);
// 	if (attributesMax) {
// 		delete data.attributesMax;
// 		data.attributesMax = attributesMax;
// 	}
// 	if (attributesMin) {
// 		delete data.attributesMin;
// 		data.attributesMin = attributesMin;
// 	}
// 	if (attributes) {
// 		delete data.attributes;
// 		data.attributes = attributes;
// 	}
// 	return data;
// },
streamUpdateData:function(queuedData){var oldStats={};if(queuedData!=undefined){for(var i=0;i<queuedData.length;i++){var data=queuedData[i];for(attrName in data){var newValue=data[attrName];// console.log(this._category, this.id(), attrName, newValue)
switch(attrName){case'attributes':// only on client side to prevent circular recursion
if(ige.isClient){var attributesObject=_.cloneDeep(this._stats.attributes);if(attributesObject){for(var attributeTypeId in data.attributes){var attributeData=attributesObject[attributeTypeId];if(attributeData){var newAttributeValue=data.attributes[attributeTypeId];var oldAttributeValue=attributeData.value;attributeData.hasChanged=newAttributeValue!==oldAttributeValue;attributeData.value=newAttributeValue;attributeData.type=attributeTypeId;this.attribute.update(attributeTypeId,attributeData.value);if(this._category==='unit'){this.updateAttributeBar(attributeData);}}// update attribute if entity has such attribute
}}}else if(ige.isServer){for(var attributeTypeId in data.attributes){// prevent attribute being passed to client if it is invisible
if(this._stats.attributes&&this._stats.attributes[attributeTypeId]){var attribute=this._stats.attributes[attributeTypeId];if((attribute.isVisible&&typeof attribute.isVisible==='boolean'&&attribute.isVisible==false||// will be deprecated.
attribute.isVisible&&attribute.isVisible.constructor===Array&&attribute.isVisible.length==0)&&attributeTypeId!==ige.game.data.settings.scoreAttributeId){delete data[attrName];}}}}break;case'attributesMax':if(this._stats.attributes){// only on client side to prevent circular recursion
for(var attributeTypeId in data.attributesMax){if(this._stats.attributes&&this._stats.attributes[attributeTypeId]){this._stats.attributes[attributeTypeId].max=data.attributesMax[attributeTypeId];}// update attribute if entity has such attribute
if(ige.isClient){if(this._category==='unit'){// this.updateAttributeBar(this._stats.attributes[attributeTypeId]);
this.unitUi&&this.unitUi.updateAttributeBar(this._stats.attributes[attributeTypeId]);}}}}break;case'attributesMin':// only on client side to prevent circular recursion
for(var attributeTypeId in data.attributesMin){if(this._stats.attributes&&this._stats.attributes[attributeTypeId]){this._stats.attributes[attributeTypeId].min=data.attributesMin[attributeTypeId];// update attribute if entity has such attribute
if(ige.isClient){if(this._category==='unit'){this.updateAttributeBar(this._stats.attributes[attributeTypeId]);this.unitUi&&this.unitUi.updateAttributeBar(this._stats.attributes[attributeTypeId]);}}}}break;case'attributesRegenerateRate':// only on client side to prevent circular recursion
for(var attributeTypeId in data.attributesRegenerateRate){if(this._stats.attributes&&this._stats.attributes[attributeTypeId]){this._stats.attributes[attributeTypeId].regenerateSpeed=data.attributesRegenerateRate[attributeTypeId];}}break;case'depth':if(ige.isClient){this.depth(data.depth);}break;case'flip':// ignore flip command from server for my own unit, because it's already done locally
if(ige.isClient&&this!=ige.client.selectedUnit&&!(this._category=='item'&&this.getOwnerUnit()==ige.client.selectedUnit)){this.flip(newValue);}break;case'isBeingUsed':// this case is in igeEntity.js instead of item.js, because if it's in item.js,
// we cannot prevent updating my own unit's isBeingUsed, and item._stats.isBeingUsed will be updated regardless.
if(ige.isClient){if(this.getOwnerUnit()!=ige.client.selectedUnit){this._stats.isBeingUsed=newValue;if(newValue==false){this.playEffect('none');}}}break;case'stopUsing':// This will only be called when we stop the unit from using an item from the server side, to prevent issues.
if(ige.isClient){this._stats.isBeingUsed=newValue;if(newValue==false){this.playEffect('none');}}break;default:// setting oldownerId b4 owner change
if(attrName==='ownerId'){this.oldOwnerId=this._stats[attrName];}this._stats[attrName]=newValue;break;}if(ige.isServer){// keys that will stream even if its new value is same as the previous value
var forceStreamKeys=['anim','coin','stateId','ownerId','name','slotIndex','newItemId','quantity','spriteOnly','setFadingText','playerJoinedAgain','use','hidden'];if(typeof this.queueStreamData==='function'){if(data[attrName]!=oldStats[attrName]||forceStreamKeys.includes(attrName)){// console.log("queueStreamData", attrName, data[attrName])
var streamData={};streamData[attrName]=data[attrName];this.queueStreamData(streamData);}}}else if(ige.isClient){switch(attrName){case'stateId':// console.log('stateId', this.id(), this._stats.name, newValue);
break;case'effect':// don't use streamed effect call for my own unit or its items
if(this==ige.client.selectedUnit||this._category=='item'&&this.getOwnerUnit()==ige.client.selectedUnit)return;this.playEffect(newValue);break;case'makePlayerSelectUnit':// this unit was queued to be selected by a player
ige.client.myPlayer.selectUnit(this.id());break;case'makePlayerCameraTrackUnit':// this unit was queued to be tracked by a player's camera
ige.client.myPlayer.cameraTrackUnit(this);break;case'hideUnit':this.hide();break;case'showUnit':this.show();break;case'hideNameLabel':this.unitNameLabel&&this.unitNameLabel.hide();break;case'showNameLabel':this.unitNameLabel&&this.unitNameLabel.show();break;}}}}}},// combine all data that'll be sent to the client, and send them altogether at the tick
queueStreamData:function(data){this._streamDataQueued=this._streamDataQueued.concat(data);ige.server.bandwidthUsage[this._category]+=JSON.stringify(this._streamDataQueued).length;},/**
     * Removes a section into the existing streamed sections array.
     * @param {String} sectionName The section name to remove.
     */streamSectionsPull:function(sectionName){if(this._streamSections){this._streamSections.pull(sectionName);}return this;},/**
     * Gets / sets a streaming property on this entity. If set, the
     * property's new value is streamed to clients on the next packet.
     *
     * @param {String} propName The name of the property to get / set.
     * @param {*=} propVal Optional. If provided, the property is set
     * to this value.
     * @return {*} "this" when a propVal argument is passed to allow method
     * chaining or the current value if no propVal argument is specified.
     */streamProperty:function(propName,propVal){this._streamProperty=this._streamProperty||{};// this._streamPropertyChange = this._streamPropertyChange || {};
if(propName!==undefined){if(propVal!==undefined){// this._streamPropertyChange[propName] = this._streamProperty[propName] !== propVal;
this._streamProperty[propName]=propVal;return this;}return this._streamProperty[propName];}return undefined;},/**
     * Gets / sets the data for the specified data section id. This method
     * is usually not called directly and instead is part of the network
     * stream system. General use case is to write your own custom streamSectionData
     * method in a class that extends $i_56 so that you can control the
     * data that the entity will send and receive over the network stream.
     * @param {String} sectionId A string identifying the section to
     * handle data get / set for.
     * @param {*=} data If present, this is the data that has been sent
     * from the server to the client for this entity.
     * @param {Boolean=} bypassSmoothing If true, will assign transform
     * directly to entity instead of adding the values to the time stream.
     * @return {*} "this" when a data argument is passed to allow method
     * chaining or the current value if no data argument is specified.
     */streamSectionData:function(sectionId,data){switch(sectionId){case'transform':if(ige.isServer){var x=this._translate.x.toFixed(0);var y=this._translate.y.toFixed(0);var angle=(this._rotate.z%(2*Math.PI)*1000).toFixed(0);if(x==this._oldTranform[0]&&y==this._oldTranform[1]&&angle==this._oldTranform[2]){this._hasMoved=false;}else{this._hasMoved=true;this._oldTranform=[x,y,angle];// var distanceTravelled = x - ige.lastX;
// console.log(this.id(), ige._currentTime - ige.lastSnapshotTime, ige._currentTime, x,  distanceTravelled / (ige._currentTime - ige.lastSnapshotTime))
// ige.lastX = x
// ige.lastSnapshotTime = ige._currentTime;
let buffArr=[];buffArr.push(Number(x));buffArr.push(Number(y));buffArr.push(Number(angle));// $i_56.prototype.log(this._size, this._translate, this._rotate)
if(this.bypassSmoothing){buffArr.push(1);// ige.devLog("streamData", buff)
this.bypassSmoothing=false;}buffArr=buffArr.map(item=>item.toString(16));this._streamSectionData=buffArr;}}break;case'depth':if(data!==undefined){if(ige.isClient){this.depth(parseInt(data));}}else{return String(this.depth());}break;case'layer':if(data!==undefined){if(ige.isClient){this.layer(parseInt(data));}}else{return String(this.layer());}break;case'bounds2d':if(data!==undefined){if(ige.isClient){var geom=data.split(',');this.bounds2d(parseFloat(geom[0]),parseFloat(geom[1]));}}else{return String(`${this._bounds2d.x},${this._bounds2d.y}`);}break;case'bounds3d':if(data!==undefined){if(ige.isClient){var geom=data.split(',');this.bounds3d(parseFloat(geom[0]),parseFloat(geom[1]),parseFloat(geom[2]));}}else{return String(`${this._bounds3d.x},${this._bounds3d.y},${this._bounds3d.z}`);}break;case'hidden':if(data!==undefined){if(ige.isClient){if(data=='true'){this.hide();}else{this.show();}}}else{return String(this.isHidden());}break;case'mount':if(data!==undefined){if(ige.isClient){if(data){var newParent=ige.$(data);if(newParent){this.mount(newParent);}}else{// Unmount
this.unMount();}}}else{var parent=this.parent();if(parent){return this.parent().id();}else{return'';}}break;case'origin':if(data!==undefined){if(ige.isClient){var geom=data.split(',');this.origin(parseFloat(geom[0]),parseFloat(geom[1]),parseFloat(geom[2]));}}else{return String(`${this._origin.x},${this._origin.y},${this._origin.z}`);}break;case'props':var newData,changed,i;if(data!==undefined){if(ige.isClient){var props=JSON.parse(data);// Update properties that have been sent through
for(i in props){changed=false;if(props.hasOwnProperty(i)){if(this._streamProperty[i]!=props[i]){changed=true;}this._streamProperty[i]=props[i];this.emit('streamPropChange',[i,props[i]]);}}}}else{newData={};for(i in this._streamProperty){if(this._streamProperty.hasOwnProperty(i)){// if (this._streamPropertyChange[i]) {
newData[i]=this._streamProperty[i];// this._streamPropertyChange[i] = false;
// }
}}return JSON.stringify(newData);}break;}},getQueuedStreamData:function(){return this._streamDataQueued;},/**
     * Gets / sets the stream mode that the stream system will use when
     * handling pushing data updates to connected clients.
     * @param {Number=} val A value representing the stream mode.
     * @example #Set the entity to disable streaming
     *     entity.streamMode(0);
     * @example #Set the entity to automatic streaming
     *     entity.streamMode(1);
     * @example #Set the entity to manual (advanced mode) streaming
     *     entity.streamMode(2);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */streamMode:function(val){// console.log("streamMode (" + val + ")", (this._stats) ? this._stats.name : this._category)
if(val!==undefined){this._streamMode=val;return this;}return this._streamMode;},/**
     * Gets / sets the stream control callback function that will be called
     * each time the entity tick method is called and stream-able data is
     * updated.
     * @param {Function=} method The stream control method.
     * @example #Set the entity's stream control method to control when this entity is streamed and when it is not
     *     entity.streamControl(function (clientId) {
     *         // Let's use an example where we only want this entity to stream
     *         // to one particular client with the id 4039589434
     *         if (clientId === '4039589434') {
     *             // Returning true tells the network stream to send data
     *             // about this entity to the client
     *             return true;
     *         } else {
     *             // Returning false tells the network stream NOT to send
     *             // data about this entity to the client
     *             return false;
     *         }
     *     });
     *
     * Further reading: [Controlling Streaming](http://www.isogenicengine.com/documentation/isogenic-game-engine/versions/1-1-0/manual/networking-multiplayer/realtime-network-streaming/stream-modes-and-controlling-streaming/)
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */streamControl:function(method){if(method!==undefined){this._streamControl=method;return this;}return this._streamControl;},/**
     * Gets / sets the stream sync interval. This value
     * is in milliseconds and cannot be lower than 16. It will
     * determine how often data from this entity is added to the
     * stream queue.
     * @param {Number=} val Number of milliseconds between adding
     * stream data for this entity to the stream queue.
     * @param {String=} sectionId Optional id of the stream data
     * section you want to set the interval for. If omitted the
     * interval will be applied to all sections.
     * @example #Set the entity's stream update (sync) interval to 1 second because this entity's data is not highly important to the simulation so save some bandwidth!
     *     entity.streamSyncInterval(1000);
     * @example #Set the entity's stream update (sync) interval to 16 milliseconds because this entity's data is very important to the simulation so send as often as possible!
     *     entity.streamSyncInterval(16);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */streamSyncInterval:function(val,sectionId){if(val!==undefined){if(!sectionId){if(val<16){delete this._streamSyncInterval;}else{this._streamSyncDelta=0;this._streamSyncInterval=val;}}else{this._streamSyncSectionInterval=this._streamSyncSectionInterval||{};this._streamSyncSectionDelta=this._streamSyncSectionDelta||{};if(val<16){delete this._streamSyncSectionInterval[sectionId];}else{this._streamSyncSectionDelta[sectionId]=0;this._streamSyncSectionInterval[sectionId]=val;}}return this;}return this._streamSyncInterval;},/**
     * Gets / sets the precision by which floating-point values will
     * be encoded and sent when packaged into stream data.
     * @param {Number=} val The number of decimal places to preserve.
     * @example #Set the float precision to 2
     *     // This will mean that any data using floating-point values
     *     // that gets sent across the network stream will be rounded
     *     // to 2 decimal places. This helps save bandwidth by not
     *     // having to send the entire number since precision above
     *     // 2 decimal places is usually not that important to the
     *     // simulation.
     *     entity.streamFloatPrecision(2);
     * @return {*} "this" when arguments are passed to allow method
     * chaining or the current value if no arguments are specified.
     */streamFloatPrecision:function(val){if(val!==undefined){this._streamFloatPrecision=val;var i;var floatRemove='\\.';// Update the floatRemove regular expression pattern
for(i=0;i<this._streamFloatPrecision;i++){floatRemove+='0';}// Add the trailing comma
floatRemove+=',';// Create the new regexp
this._floatRemoveRegExp=new RegExp(floatRemove,'g');return this;}return this._streamFloatPrecision;},/**
     * Override this method if your entity should send data through to
     * the client when it is being created on the client for the first
     * time through the network stream. The data will be provided as the
     * first argument in the constructor call to the entity class so
     * you should expect to receive it as per this example:
     * @example #Using and Receiving Stream Create Data
     *     var MyNewClass = $i_56.extend({
     *         classId: 'MyNewClass',
     *
     *         // Define the init with the parameter to receive the
     *         // data you return in the streamCreateData() method
     *         init: function (myCreateData) {
     *             this._myData = myCreateData;
     *         },
     *
     *         streamCreateData: function () {
     *             return this._myData;
     *         }
     *     });
     *
     * Valid return values must not include circular references!
     */streamCreateData:function(clientId){if(ige.isServer){// remove _stats which are static and can be added from client as well. which will save our bandwidth
var keys=ige.server.keysToRemoveBeforeSend.slice();if(this._category==='debris'&&keys.indexOf('cellSheet')>-1){keys.splice(keys.indexOf('cellSheet'),1);keys=keys.concat(['rotation','type','density','friction','restitution','rotation','y','x']);}else if(this._category==='region'){keys=keys.concat('value');}const statKeys=Object.keys(this._stats);const data={};statKeys.forEach(key=>{if(!keys.includes(key)){data[key]=this._stats[key];}});return data;}},/**
     * Gets / sets the stream emit created flag. If set to true this entity
     * emit a "streamCreated" event when it is created by the stream, but
     * after the id and initial transform are set.
     * @param val
     * @returns {*}
     */streamEmitCreated:function(val){if(val!==undefined){this._streamEmitCreated=val;return this;}return this._streamEmitCreated;},/**
     * Queues stream data for this entity to be sent to the
     * specified client id or array of client ids.
     * @param {Array} clientId An array of string IDs of each
     * client to send the stream data to.
     * @return {$i_56} "this".
     */streamSync:function(clientId){if(this._streamMode===1||this._streamMode===2){// Check if we have a stream sync interval
if(this._streamSyncInterval){this._streamSyncDelta+=ige._tickDelta;if(this._streamSyncDelta<this._streamSyncInterval){// The stream sync interval is still higher than
// the stream sync delta so exit without calling the
// stream sync method
return this;}else{// We've reached the delta we want so zero it now
// ready for the next loop
this._streamSyncDelta=0;}}this._streamSync();return this;}// if (this._streamMode === 2) {
// 	// Stream mode is advanced
// 	this._streamSync(clientId, this._streamRoomId);
// 	return this;
// }
recipientArr=null;return this;},/**
     * Asks the stream system to queue the stream data to the specified
     * client id or array of ids.
     * @param {Array} recipientArr The array of ids of the client(s) to
     * queue stream data for. The stream data being queued
     * is returned by a call to this._streamData().
     * @param {String} streamRoomId The id of the room the entity belongs
     * in (can be undefined or null if no room assigned).
     * @private
     */_streamSync:function(){var recipientArr=ige.network.clientIds;var arrCount=recipientArr.length;var arrIndex;var clientId;var thisId=this.id();var createResult=true;// We set this to true by default
var data=this._streamData();// Loop the recipient array
for(arrIndex=0;arrIndex<arrCount;arrIndex++){clientId=recipientArr[arrIndex];// Check if the client has already received a create
// command for this entity
if(!ige.network.stream._streamClientCreated[thisId]){ige.network.stream._streamClientCreated[thisId]={};}if(!ige.network.stream._streamClientCreated[thisId][clientId]){createResult=this.streamCreate(clientId);this._hasMoved=true;}}if(data&&recipientArr.length&&this._streamMode===1&&this._hasMoved){ige.server.bandwidthUsage[this._category]+=data.length;ige.network.stream.queue(thisId,data,recipientArr);}},/**
     * Issues a create entity command to the passed client id
     * or array of ids. If no id is passed it will issue the
     * command to all connected clients. If using streamMode(1)
     * this method is called automatically.
     * @param {*} clientId The id or array of ids to send
     * the command to.
     * @example #Send a create command for this entity to all clients
     *     entity.streamCreate();
     * @example #Send a create command for this entity to an array of client ids
     *     entity.streamCreate(['43245325', '326755464', '436743453']);
     * @example #Send a create command for this entity to a single client id
     *     entity.streamCreate('43245325');
     * @return {Boolean}
     */streamCreate:function(clientId){// $i_56.prototype.log("streamCreate")
if(this._parent&&ige.network.stream._streamClientCreated!==undefined){var thisId=this.id();var arr;var i;// Send the client an entity create command first
var streamCreateData=this.streamCreateData(clientId);this.streamSectionData('transform');// prepare this._streamSectionData
ige.network.send('_igeStreamCreate',[this.classId(),thisId,this._parent.id(),this._streamSectionData,streamCreateData],clientId);ige.server.bandwidthUsage[this._category]+=JSON.stringify(streamCreateData).length;ige.network.stream._streamClientCreated[thisId]=ige.network.stream._streamClientCreated[thisId]||{};if(clientId){// Mark the client as having received a create
// command for this entity
ige.network.stream._streamClientCreated[thisId][clientId]=true;}else{// Mark all clients as having received this create
arr=ige.network.clients();for(i in arr){if(arr.hasOwnProperty(i)){ige.network.stream._streamClientCreated[thisId][i]=true;}}}return true;}return false;},/**
     * Issues a destroy entity command to the passed client id
     * or array of ids. If no id is passed it will issue the
     * command to all connected clients. If using streamMode(1)
     * this method is called automatically.
     * @param {*} clientId The id or array of ids to send
     * the command to.
     * @example #Send a destroy command for this entity to all clients
     *     entity.streamDestroy();
     * @example #Send a destroy command for this entity to an array of client ids
     *     entity.streamDestroy(['43245325', '326755464', '436743453']);
     * @example #Send a destroy command for this entity to a single client id
     *     entity.streamDestroy('43245325');
     * @return {Boolean}
     */streamDestroy:function(clientId){var thisId=this.id();var arr;var i;// Send clients the stream destroy command for this entity
ige.network.send('_igeStreamDestroy',[ige._currentTime,thisId],clientId);if(!ige.network.stream)return true;ige.network.stream._streamClientCreated[thisId]=ige.network.stream._streamClientCreated[thisId]||{};if(clientId){// Mark the client as having received a destroy
// command for this entity
ige.network.stream._streamClientCreated[thisId][clientId]=false;}else{// Mark all clients as having received this destroy
arr=ige.network.clients();delete ige.network.stream._streamClientCreated[thisId];}return true;},/**
     * Generates and returns the current stream data for this entity. The
     * data will usually include only properties that have changed since
     * the last time the stream data was generated. The returned data is
     * a string that has been compressed in various ways to reduce network
     * overhead during transmission.
     * @return {String} The string representation of the stream data for
     * this entity.
     * @private
     */_streamData:function(){// Check if we already have a cached version of the streamData
if(this._streamDataCache){return this._streamDataCache;}else{// Let's generate our stream data
var sectionDataString='';var sectionData;var sectionIndex;var sectionId;// Only send further data if the entity is still "alive"
if(this._alive){// Now loop the data sections array and compile the rest of the
// data string from the data section return data
for(sectionIndex=0;sectionIndex<this._streamSections.length;sectionIndex++){sectionData='';sectionId=this._streamSections[sectionIndex];// if (this._streamMode === 2 && sectionId === 'transform') break;
// Stream section sync intervals allow individual stream sections
// to be streamed at different (usually longer) intervals than other
// sections so you could for instance reduce the number of updates
// a particular section sends out in a second because the data is
// not that important compared to updated transformation data
if(this._streamSyncSectionInterval&&this._streamSyncSectionInterval[sectionId]){// Check if the section interval has been reached
this._streamSyncSectionDelta[sectionId]+=ige._tickDelta;if(this._streamSyncSectionDelta[sectionId]>=this._streamSyncSectionInterval[sectionId]){// Get the section data for this section id
this.streamSectionData(sectionId);// Reset the section delta
this._streamSyncSectionDelta[sectionId]=0;}}else{// Get the section data for this section id
this.streamSectionData(sectionId);}}if(this._streamSectionData!==undefined){// Add the section start designator character. We do this
// regardless of if there is actually any section data because
// we want to be able to identify sections in a serial fashion
// on receipt of the data string on the client
// // sectionDataString += ige.network.stream._sectionDesignator;
// Add any custom data to the stream string at this point
streamData=this.encodedStreamData();// Remove any .00 from the string since we don't need that data
// TODO: What about if a property is a string with something.00 and it should be kept?
// // streamData = streamData.replace(this._floatRemoveRegExp, ',');
// Store the data in cache in case we are asked for it again this tick
// the update() method of the $i_56 class clears this every tick
this._streamDataCache=streamData;return streamData;}}}},encodedStreamData:function(){var data=this.id();return[data].concat(this._streamSectionData).join('&');},/* CEXCLUDE */ /// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
// INTERPOLATOR
/// /////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
     * Calculates the current value based on the time along the
     * value range.
     * @param {Number} startValue The value that the interpolation started from.
     * @param {Number} endValue The target value to be interpolated to.
     * @param {Number} startTime The time the interpolation started.
     * @param {Number} currentTime The current time.
     * @param {Number} endTime The time the interpolation will end.
     * @return {Number} The interpolated value.
     */interpolateValue:function(startValue,endValue,startTime,currentTime,endTime){var totalValue=endValue-startValue;var dataDelta=endTime-startTime;var offsetDelta=currentTime-startTime;var deltaTime=offsetDelta/dataDelta;// Clamp the current time from 0
if(deltaTime<0){deltaTime=0;}return totalValue*deltaTime+startValue;},reconcileValue:function(startValue,endValue,startTime,currentTime,endTime){var totalValue=endValue-startValue;var dataDelta=endTime-startTime;var offsetDelta=currentTime-startTime;var t=Math.abs(offsetDelta/dataDelta);var deltaTime=t<0.5?2*t*t:-1+(4-2*t)*t;// easeInOutQuad (acceleration until halfway, then deceleration)
return totalValue*deltaTime+startValue;},/**
     * Processes the time stream for the entity.
     * @param {Number} renderTime The time that the time stream is
     * targeting to render the entity at.
     */_processTransform:function(){if(// prevent igePixi calling this function multiple times for a same entity
this._lastTransformAt==ige._currentTime||// entity has no body
this._translate==undefined||this._stats.currentBody==undefined||// ignore server stream of my own unit's sprite-only item
this._stats.currentBody&&this._stats.currentBody.type=='spriteOnly'&&(this.getOwnerUnit&&this.getOwnerUnit())==ige.client.selectedUnit){return;}// interpolate projectiles using data provided by physicsComponent. as snapshot data isn't streamed from server.
var x=this._translate.x;var y=this._translate.y;var rotate=this._rotate.z;var prevKeyFrame=null;var nextKeyFrame=null;if(ige.nextSnapshot){var nextTransform=ige.nextSnapshot[1][this.id()];if(nextTransform){nextKeyFrame=[ige.nextSnapshot[0],nextTransform];}}// by default, prevTransform is where this unit currently is
if(ige.prevSnapshot){// Set variables up to store the previous and next data
var prevTransform=ige.prevSnapshot[1][this.id()];if(prevTransform){prevKeyFrame=[ige.prevSnapshot[0],prevTransform];}}// interpolate using client side's physics frames. (this doesn't use snapshot streamed from the server)
// this is necessary, because physics don't run at 60 fps on clientside
if(ige.physics&&(// 1. we're using cspMovement (experimental) for my own unit OR
ige.game.cspEnabled&&ige.client.selectedUnit==this||// 2. item-fired projectiles
this._category=='projectile'&&this._stats.sourceItemId!=undefined&&!this._streamMode)){if(this.nextPhysicsFrame){if(this.prevPhysicsFrame){// interpolate using prev/next physics key frames provided by physicsComponent
x=this.interpolateValue(this.prevPhysicsFrame[1][0],this.nextPhysicsFrame[1][0],this.prevPhysicsFrame[0],ige._currentTime,this.nextPhysicsFrame[0]);y=this.interpolateValue(this.prevPhysicsFrame[1][1],this.nextPhysicsFrame[1][1],this.prevPhysicsFrame[0],ige._currentTime,this.nextPhysicsFrame[0]);if(this==ige.client.selectedUnit){rotate=this.interpolateValue(this.prevPhysicsFrame[1][2],this.nextPhysicsFrame[1][2],this.prevPhysicsFrame[0],ige._currentTime,this.nextPhysicsFrame[0]);}}else{// unit is teleporting
x=this.nextPhysicsFrame[1][0];y=this.nextPhysicsFrame[1][1];rotate=this.nextPhysicsFrame[1][2];// console.log("teleport")
}// for debugging my unit's x-movement interpolation
}}// interpolate using snapshots streamed from the server.
if(prevTransform!=undefined&&nextTransform!=undefined&&prevKeyFrame[0]!=nextKeyFrame[0]&&prevKeyFrame[0]<ige.renderTime&&ige.renderTime<nextKeyFrame[0]){targetX=this.interpolateValue(prevTransform[0],nextTransform[0],prevKeyFrame[0],ige.renderTime,nextKeyFrame[0]);targetY=this.interpolateValue(prevTransform[1],nextTransform[1],prevKeyFrame[0],ige.renderTime,nextKeyFrame[0]);// a hack to prevent rotational interpolation suddnely jumping by 2 PI (e.g. 0.01 to -6.27)
var startValue=prevKeyFrame[1][2];var endValue=nextKeyFrame[1][2];if(Math.abs(endValue-startValue)>Math.PI){if(endValue>startValue)startValue+=Math.PI*2;else startValue-=Math.PI*2;}if(this==ige.client.selectedUnit&&this.angleToTarget!=undefined&&!isNaN(this.angleToTarget)&&this._stats.controls&&this._stats.controls.mouseBehaviour.rotateToFaceMouseCursor&&this._stats.currentBody&&!this._stats.currentBody.fixedRotation){targetRotate=this.angleToTarget;}else{targetRotate=this.interpolateValue(startValue,endValue,prevKeyFrame[0],ige.renderTime,nextKeyFrame[0]);}// don't set lastServerStreamedPosition unless more than 500ms has passed since last teleport.
// this prevents teleported position data getting overwritten by latest streamed snapshot
// console.log("this.lastReconciledAt != prevKeyFrame[0]", this.lastReconciledAt, prevKeyFrame[0])
if(this==ige.client.selectedUnit&&this.lastReconciledAt!=prevKeyFrame[0]){this.lastServerStreamedPosition=[targetX,targetY,targetRotate];}// apply rubberbanding to all non-player entities when csp is enabled
if(ige.physics&&ige.game.cspEnabled&&this!=ige.client.selectedUnit){xDiff=targetX-x;yDiff=targetY-y;x+=xDiff/2;y+=yDiff/2;}else if(!ige.physics||!ige.game.cspEnabled||this!=ige.client.selectedUnit){// if physics isn't set, or csp is disabled, use server-streamed data to move entities
x=targetX;y=targetY;}rotate=targetRotate;if(this._debugEntity){this._debugEntity.position.set(targetX,targetY);this._debugEntity.rotation=targetRotate;this._debugEntity.pivot.set(this._debugEntity.width/2,this._debugEntity.height/2);}// // for debugging my unit's x-movement interpolation
// if (this == ige.client.selectedUnit) {
// 	let distanceTraveled = x - this.previousX
// 	let timeElapsed = (ige.renderTime-this.previousRenderTime).toFixed(0)
// 	console.log(ige.snapshots.length, 'x', prevTransform[0], x.toFixed(0), '(' + distanceTraveled.toFixed(1) + ')', nextTransform[0],
// 		'time', prevKeyFrame[0], ige.renderTime.toFixed(0), '(' + timeElapsed + 'ms '+ ((ige.renderTime - prevKeyFrame[0]) / (nextKeyFrame[0] - prevKeyFrame[0]) * 100).toFixed(0) +'%)', nextKeyFrame[0], "speed", (distanceTraveled/timeElapsed).toFixed(2)
// 		)
// 	this.previousX = x;
// 	this.previousRenderTime = ige.renderTime;
// }
}// instantly rotate unit to mouse cursor
if(this==ige.client.selectedUnit){var ownerPlayer=ige.$(this._stats.ownerId);if(ownerPlayer&&ownerPlayer.control&&ownerPlayer.control.input){var mouse=ownerPlayer.control.input.mouse;if(mouse){this.angleToTarget=Math.atan2(mouse.y-this._translate.y,mouse.x-this._translate.x)+Math.radians(90);if(this.angleToTarget!=undefined&&!isNaN(this.angleToTarget)&&this._stats.controls&&this._stats.controls.mouseBehaviour.rotateToFaceMouseCursor&&this._stats.currentBody&&!this._stats.currentBody.fixedRotation){rotate=this.angleToTarget;}}}}if(this._stats.isStunned==undefined||this._stats.isStunned!=true){this.rotateTo(0,0,rotate);}this.translateTo(x,y,0);this._lastTransformAt=ige._currentTime;},getAttributeBarContainer:function(){var self=this;var attributeContainerId=self._stats&&self._stats.attributeBarContainer&&self._stats.attributeBarContainer.id;if(attributeContainerId){return ige.$(attributeContainerId);}return null;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_56;};// TODO: Implement the _stringify() method for this class
/**
 * Creates a new UI entity. UI entities use more resources and CPU
 * than standard $i_56 instances so only use them if an $i_56
 * won't do the job.
 */var $i_57=$i_56.extend([{extension:$i_41,overwrite:true},{extension:$i_40,overwrite:true}],{classId:'$i_57',init:function(){$i_56.prototype.init.call(this);// Set some defaults
this._color='#000000';this._borderLeftWidth=0;this._borderTopWidth=0;this._borderRightWidth=0;this._borderBottomWidth=0;this._borderTopLeftRadius=0;this._borderTopRightRadius=0;this._borderBottomRightRadius=0;this._borderBottomLeftRadius=0;this._backgroundPosition={x:0,y:0};this._paddingLeft=0;this._paddingTop=0;this._paddingRight=0;this._paddingBottom=0;},disabled:function(val){if(val!==undefined){this._disabled=val;return this;}return this._disabled;},overflow:function(val){if(val!==undefined){this._overflow=val;return this;}return this._overflow;},_renderBackground:function(ctx){var geom=this._bounds2d;var left;var top;var width;var height;if(this._backgroundColor||this._patternFill){left=-(geom.x/2)|0;top=-(geom.y/2)|0;width=geom.x;height=geom.y;ctx.save();ctx.beginPath();// Check for early exit if we are rendering a rectangle
if(!this._borderTopRightRadius&&!this._borderBottomRightRadius&&!this._borderBottomLeftRadius&&!this._borderTopLeftRadius){ctx.rect(left,top,width,height);}else{// Top border
ctx.moveTo(left+this._borderTopLeftRadius,top);ctx.lineTo(left+width-this._borderTopRightRadius,top);if(this._borderTopRightRadius>0){// Top-right corner
ctx.arcTo(left+width,top,left+width,top+this._borderTopRightRadius,this._borderTopRightRadius);}// Right border
ctx.lineTo(left+width,top+height-this._borderBottomRightRadius);if(this._borderBottomRightRadius>0){// Bottom-right corner
ctx.arcTo(left+width,top+height,left+width-this._borderBottomRightRadius,top+height,this._borderBottomRightRadius);}// Bottom border
ctx.lineTo(left+this._borderBottomLeftRadius,top+height);if(this._borderBottomLeftRadius>0){// Bottom-left corner
ctx.arcTo(left,top+height,left,top+height-this._borderBottomLeftRadius,this._borderBottomLeftRadius);}// Left border
ctx.lineTo(left,top+this._borderTopLeftRadius);if(this._borderTopLeftRadius>0){// Top-left corner
ctx.arcTo(left,top,left+this._borderTopLeftRadius,top,this._borderTopLeftRadius);}ctx.clip();}// If there is a background colour, paint it here
if(this._backgroundColor){ctx.fillStyle=this._backgroundColor;ctx.fill();}// If there is a background image, paint it here
if(this._patternFill){ctx.translate(-(width/2|0)+this._backgroundPosition.x,-(height/2|0)+this._backgroundPosition.y);ctx.fillStyle=this._patternFill;ctx.fill();}ctx.restore();}},_renderBorder:function(ctx){var rad;var geom=this._bounds2d;var left=(-geom.x2|0)+0.5;var top=(-geom.y2|0)+0.5;var width=geom.x-1;var height=geom.y-1;// Check for early exit if we are rendering a rectangle
if(!this._borderTopRightRadius&&!this._borderBottomRightRadius&&!this._borderBottomLeftRadius&&!this._borderTopLeftRadius&&this._borderLeftWidth===this._borderWidth&&this._borderTopWidth===this._borderWidth&&this._borderRightWidth===this._borderWidth&&this._borderBottomWidth===this._borderWidth){ctx.strokeStyle=this._borderColor;ctx.lineWidth=this._borderWidth;ctx.strokeRect(left,top,width,height);}else{var startNewStroke=function(){ctx.stroke();ctx.beginPath();};rad=Math.PI/180;ctx.beginPath();if(this._borderTopWidth){// Top-left corner top-half
ctx.strokeStyle=this._borderTopColor;ctx.lineWidth=this._borderTopWidth;if(this._borderTopLeftRadius>0){// Top-left corner top-half
ctx.arc(left+this._borderTopLeftRadius,top+this._borderTopLeftRadius,this._borderTopLeftRadius,225*rad,270*rad);}// Top border
ctx.moveTo(left+this._borderTopLeftRadius,top);ctx.lineTo(left+width-this._borderTopRightRadius,top);if(this._borderTopRightRadius>0){// Top-right corner top-half
ctx.arc(left+width-this._borderTopRightRadius,top+this._borderTopRightRadius,this._borderTopRightRadius,-90*rad,-44*rad);// use -44 instead of -45 to fully connect with next piece
}}if(!this._borderRightWidth||this._borderTopColor!=this._borderRightColor||this._borderTopWidth!=this._borderRightWidth)startNewStroke();if(this._borderRightWidth){// Top-right corner bottom-half
ctx.strokeStyle=this._borderRightColor;ctx.lineWidth=this._borderRightWidth;if(this._borderTopRightRadius>0){ctx.arc(left+width-this._borderTopRightRadius,top+this._borderTopRightRadius,this._borderTopRightRadius,-45*rad,0);}// Right border
ctx.moveTo(left+width,top+this._borderTopRightRadius);ctx.lineTo(left+width,top+height-this._borderBottomRightRadius);if(this._borderBottomRightRadius>0){// Bottom-right corner top-half
ctx.arc(left+width-this._borderBottomRightRadius,top+height-this._borderBottomRightRadius,this._borderTopRightRadius,0,46*rad);// use 46 instead of 45 to fully connect with next piece
}}if(!this._borderBottomWidth||this._borderRightColor!=this._borderBottomColor||this._borderRightWidth!=this._borderBottomWidth)startNewStroke();if(this._borderBottomWidth){// Bottom-right corner bottom-half
ctx.strokeStyle=this._borderBottomColor;ctx.lineWidth=this._borderBottomWidth;if(this._borderBottomRightRadius>0){ctx.arc(left+width-this._borderBottomRightRadius,top+height-this._borderBottomRightRadius,this._borderBottomRightRadius,45*rad,90*rad);}// Bottom border
ctx.moveTo(left+width-this._borderBottomRightRadius,top+height);ctx.lineTo(left+this._borderBottomLeftRadius,top+height);if(this._borderBottomLeftRadius>0){// Bottom-left corner bottom-half
ctx.arc(left+this._borderBottomLeftRadius,top+height-this._borderBottomLeftRadius,this._borderBottomLeftRadius,90*rad,136*rad);// use 136 instead of 135 to fully connect with next piece
}}if(!this._borderLeftWidth||this._borderBottomColor!=this._borderLeftColor||this._borderBottomWidth!=this._borderLeftWidth)startNewStroke();if(this._borderLeftWidth){// Bottom-left corner top-half
ctx.strokeStyle=this._borderLeftColor;ctx.lineWidth=this._borderLeftWidth;if(this._borderBottomLeftRadius>0){ctx.arc(left+this._borderBottomLeftRadius,top+height-this._borderBottomLeftRadius,this._borderBottomLeftRadius,135*rad,180*rad);}// Left border
ctx.moveTo(left,top+height-this._borderBottomLeftRadius);ctx.lineTo(left,top+this._borderTopLeftRadius);if(this._borderTopLeftRadius>0){// Top-left corner bottom-half
ctx.arc(left+this._borderTopLeftRadius,top+this._borderTopLeftRadius,this._borderTopLeftRadius,180*rad,226*rad);// use 226 instead of 225 to fully connect with next piece
}}ctx.stroke();}},cell:function(val){var ret=$i_56.prototype.cell.call(this,val);if(ret===this&&this._patternTexture){this.backgroundImage(this._patternTexture,this._patternRepeat);}return ret;},mount:function(obj){var ret=$i_56.prototype.mount.call(this,obj);if(this._parent){// Now we're mounted update our ui calculations since we have a parent
// to calculate from
if(this._updateUiPosition){this._updateUiPosition();}// Also update any children if we have any
if(this._children.length){this.updateUiChildren();}if(this._updateStyle){this._updateStyle();}}return ret;},tick:function(ctx,dontTransform){if(ige.isClient&&!ige.client.uiEntityRenderEnabled)return;if(!this._hidden&&this._inView&&(!this._parent||this._parent._inView)&&!this._streamJustCreated){if(!dontTransform){this._transformContext(ctx);}// TODO: Investigate caching expensive background and border calls
// if (!this._cache || this._cacheDirty) {
this._renderBackground(ctx);this._renderBorder(ctx);// }
if(this._overflow==='hidden'){// Limit drawing of child entities to within the bounds
// of this one
var geom=this._bounds2d;var left=-(geom.x/2)+this._paddingLeft|0;var top=-(geom.y/2)+this._paddingTop|0;var width=geom.x+this._paddingRight;var height=geom.y+this._paddingBottom;ctx.rect(left,top,width,height);// ctx.stroke();
ctx.clip();}ctx.translate(this._paddingLeft,this._paddingTop);$i_56.prototype.tick.call(this,ctx,true);}},/**
		 * Handles screen resize events.
		 * @param event
		 * @private
		 */_resizeEvent:function(event){if(this._updateUiPosition){this._updateUiPosition();}else{debugger;}if(this._updateStyle){this._updateStyle();}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_57;};/**
 * Creates a new font entity. A font entity will use a font sheet
 * ($i_53) or native font and render text.
 */var $i_59=$i_57.extend({classId:'$i_59',init:function(){$i_57.prototype.init.call(this);this._renderText=undefined;this._text=undefined;this._textAlignX=1;this._textAlignY=1;this._textLineSpacing=0;this._nativeMode=false;// Enable caching by default for font entities!
this.cache(true);},/**
	 * Extends the $i_57.width() method and if the value being
	 * set is different from the current width value then the font's
	 * cache is invalidated so it gets redrawn.
	 * @param val
	 * @param lockAspect
	 * @param modifier
	 * @param noUpdate
	 * @returns {*}
	 */width:function(val,lockAspect,modifier,noUpdate){if(val!==undefined){if(this._bounds2d.x!==val){this.clearCache();}}var retVal=$i_57.prototype.width.call(this,val,lockAspect,modifier,noUpdate);if(this._autoWrap){this._applyAutoWrap();}return retVal;},/**
	 * Extends the $i_57.height() method and if the value being
	 * set is different from the current height value then the font's
	 * cache is invalidated so it gets redrawn.
	 * @param val
	 * @param lockAspect
	 * @param modifier
	 * @param noUpdate
	 * @returns {*|number}
	 */height:function(val,lockAspect,modifier,noUpdate){if(val!==undefined){if(this._bounds2d.y!==val){this.clearCache();}}return $i_57.prototype.height.call(this,val,lockAspect,modifier,noUpdate);},/**
	 * Sets the text to render for this font entity. This sets both
	 * the private properties "_text" and "_renderText". If auto-wrapping
	 * has been enabled then the "_text" remains equal to whatever
	 * text you pass into this method but "_renderText" becomes the
	 * line-broken text that the auto-wrapper method creates. When the
	 * entity renders it's text string it ALWAYS renders from "_renderText"
	 * and not the value of "_text". Effectively this means that "_text"
	 * contains the unaltered version of your original text and
	 * "_renderText" will be either the same as "_text" if auto-wrapping
	 * is disable or a wrapped version otherwise.
	 * @param {String} text The text string to render.
	 * @returns {*}
	 */text:function(text){if(text!==undefined){var wasDifferent=false;// Ensure we have a string
text=String(text);if(this._text!==text){this.clearCache();wasDifferent=true;}this._text=text;if(this._autoWrap&&wasDifferent){this._applyAutoWrap();}else{this._renderText=text;}return this;}return this._text;},/**
	 * Allows you to bind the text output of this font entity to match
	 * the value of an object's property so that when it is updated the
	 * text will automatically update on this entity. Useful for score,
	 * position etc output where data is stored in an object and changes
	 * frequently.
	 * @param {Object} obj The object to read the property from.
	 * @param {String} propName The name of the property to read value from.
	 * @param {String} preText Text to place before the output.
	 * @param {String} postText Text to place after the output.
	 * @returns {*}
	 */bindData:function(obj,propName,preText,postText){if(obj!==undefined&&propName!==undefined){this._bindDataObject=obj;this._bindDataProperty=propName;this._bindDataPreText=preText||'';this._bindDataPostText=postText||'';}return this;},/**
	 * Gets / sets the current horizontal text alignment. Accepts
	 * a value of 0, 1 or 2 (left, centre, right) respectively.
	 * @param {Number=} val
	 * @returns {*}
	 */textAlignX:function(val){if(val!==undefined){if(this._textAlignX!==val){this.clearCache();}this._textAlignX=val;return this;}return this._textAlignX;},/**
	 * Gets / sets the current vertical text alignment. Accepts
	 * a value of 0, 1 or 2 (top, middle, bottom) respectively.
	 * @param {Number=} val
	 * @returns {*}
	 */textAlignY:function(val){if(val!==undefined){if(this._textAlignY!==val){this.clearCache();}this._textAlignY=val;return this;}return this._textAlignY;},/**
	 * Gets / sets the amount of spacing between the lines of text being
	 * rendered. Accepts negative values as well as positive ones.
	 * @param {Number=} val
	 * @returns {*}
	 */textLineSpacing:function(val){if(val!==undefined){if(this._textLineSpacing!==val){this.clearCache();}this._textLineSpacing=val;return this;}return this._textLineSpacing;},/**
	 * Gets / sets the string hex or rgba value of the colour
	 * to use as an overlay when rending this entity's texture.
	 * @param {String=} val The colour value as hex e.g. '#ff0000'
	 * or as rgba e.g. 'rbga(255, 0, 0, 0.5)'. To remove an overlay
	 * colour simply passed an empty string.
	 * @return {*} "this" when arguments are passed to allow method
	 * chaining or the current value if no arguments are specified.
	 */colorOverlay:function(val){if(val!==undefined){if(this._colorOverlay!==val){this.clearCache();}this._colorOverlay=val;return this;}return this._colorOverlay;},/**
	 * A proxy for colorOverlay().
	 */color:function(val){return this.colorOverlay(val);},/**
	 * Clears the texture cache for this entity's text string.
	 */clearCache:function(){if(this._cache){this.cacheDirty(true);}if(this._texture&&this._texture._caching&&this._texture._cacheText[this._renderText]){delete this._texture._cacheText[this._renderText];}},/**
	 * When using native font rendering (canvasContext.fillText())
	 * this sets the font and size as per the canvasContext.font
	 * string specification.
	 * @param {String=} val The font style string.
	 * @return {*} "this" when arguments are passed to allow method
	 * chaining or the current value if no arguments are specified.
	 */nativeFont:function(val){if(val!==undefined){// Check if this font is different from the current
// assigned font
if(this._nativeFont!==val){// The fonts are different, clear existing cache
this.clearCache();}this._nativeFont=val;// Assign the native font smart texture
var tex=new $i_50($i_54);this.texture(tex);// Set the flag indicating we are using a native font
this._nativeMode=true;return this;}return this._nativeFont;},/**
	 * Gets / sets the text stroke size that applies when using
	 * a native font for text rendering.
	 * @param {Number=} val The size of the text stroke.
	 * @return {*}
	 */nativeStroke:function(val){if(val!==undefined){if(this._nativeStroke!==val){this.clearCache();}this._nativeStroke=val;return this;}return this._nativeStroke;},/**
	 * Gets / sets the text stroke color that applies when using
	 * a native font for text rendering.
	 * @param {Number=} val The color of the text stroke.
	 * @return {*}
	 */nativeStrokeColor:function(val){if(val!==undefined){if(this._nativeStrokeColor!==val){this.clearCache();}this._nativeStrokeColor=val;return this;}return this._nativeStrokeColor;},/**
	 * Gets / sets the auto-wrapping mode. If set to true then the
	 * text this font entity renders will be automatically line-broken
	 * when a line reaches the width of the entity.
	 * @param val
	 * @returns {*}
	 */autoWrap:function(val){if(val!==undefined){this._autoWrap=val;// Execute an auto-wrap modification of the text
if(this._text){this._applyAutoWrap();this.clearCache();}return this;}return this._autoWrap;},/**
	 * Automatically detects where line-breaks need to occur in the text
	 * assigned to the entity and adds them.
	 * @private
	 */_applyAutoWrap:function(){if(this._text){// Un-wrap the text so it is all on one line
var oneLineText=this._text.replace(/\n/g,' ');var words;var wordIndex;var textArray=[];var currentTextLine='';var lineWidth;// Break the text into words
words=oneLineText.split(' ');// There are multiple words - loop the words
for(wordIndex=0;wordIndex<words.length;wordIndex++){if(currentTextLine){currentTextLine+=' ';}currentTextLine+=words[wordIndex];// Check the width and if greater than the width of the entity,
// add a line break before the word
lineWidth=this.measureTextWidth(currentTextLine);if(lineWidth>=this._bounds2d.x){// Start a new line
currentTextLine=words[wordIndex];// Add a line break
textArray.push(`\n${words[wordIndex]}`);}else{textArray.push(words[wordIndex]);}}this._renderText=textArray.join(' ');}},/**
	 * Will measure and return the width in pixels of a line or multiple
	 * lines of text. If no text parameter is passed, will use the current
	 * text assigned to the font entity.
	 * @param {String=} text Optional text to measure, used existing entity
	 * text value if none is provided.
	 * @returns {Number} The width of the text in pixels.
	 */measureTextWidth:function(text){text=text||this._text;// Both $i_53 and the $i_54 have a method
// called measureTextWidth() so we can just asks the current
// texture for the width :)
if(this._texture._mode===0){return this._texture.measureTextWidth(text);}else{return this._texture.script.measureTextWidth(text,this);}},tick:function(ctx){// Check for an auto-progress update
if(this._bindDataObject&&this._bindDataProperty){if(this._bindDataObject._alive===false){// The object we have bind data from has been
// destroyed so release our reference to it!
delete this._bindDataObject;}else{this.text(this._bindDataPreText+this._bindDataObject[this._bindDataProperty]+this._bindDataPostText);}}$i_57.prototype.tick.call(this,ctx);},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object's properties via
	 * chained commands. This method will only check for
	 * properties that are directly related to this class.
	 * Other properties are handled by their own class method.
	 * @return {String}
	 */_stringify:function(){// Get the properties for all the super-classes
var str=$i_57.prototype._stringify.call(this);var i;// Loop properties and add property assignment code to string
for(i in this){if(this.hasOwnProperty(i)&&this[i]!==undefined){switch(i){case'_text':str+=`.text(${this.text()})`;break;case'_textAlignX':str+=`.textAlignX(${this.textAlignX()})`;break;case'_textAlignY':str+=`.textAlignY(${this.textAlignY()})`;break;case'_textLineSpacing':str+=`.textLineSpacing(${this.textLineSpacing()})`;break;}}}return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_59;};/**
 * Creates a new particle emitter.
 */var $i_60=$i_57.extend({classId:'$i_60',$i_60:true,init:function(){// IgeBody.init()
$i_57.prototype.init.call(this);// Set some defaults
this._currentDelta=0;this._started=false;this._particles=[];this.texture=new $i_50(`${assetsProvider}/assets/particles/Rectangle.js`);this.applyDepthToParticles(true);this.applyLayerToParticles(true);this.quantityTimespan(1000);this.quantityBase(10);this.quantityVariance(0,0);this.translateBaseX(0);this.translateBaseY(0);this.translateBaseZ(0);this.translateVarianceX(0,0);this.translateVarianceY(0,0);this.translateVarianceZ(0,0);this.rotateBase(0);this.rotateVariance(0,1);this.deathRotateBase(0);this.deathRotateVariance(0,0);this.scaleBaseX(1);this.scaleBaseY(1);this.scaleBaseZ(1);this.scaleVarianceX(0,0);this.scaleVarianceY(0,0);this.scaleVarianceZ(0,0);this.scaleLockAspect(false);this.deathScaleBaseX(0);this.deathScaleBaseY(0);this.deathScaleBaseZ(0);this.deathScaleVarianceX(0,0);this.deathScaleVarianceY(0,0);this.deathScaleVarianceZ(0,0);this.deathScaleLockAspect(false);this.opacityBase(1);this.opacityVariance(0,0);this.deathOpacityBase(1);this.deathOpacityVariance(0,0);this.lifeBase(1000);this.lifeVariance(0,0);},/**
	 * Sets the class that all particles emitted from this
	 * emitter will be created from.
	 * @param {$i_56} obj
	 * @return {*}
	 */particle:function(obj){this._particle=obj;return this;},size:function(width,height){this.size={width:width,height:height};return this;},color:function(color){this.color=color;return this;},particleMountTarget:function(obj){this._particleMountTarget=obj;return this;},applyDepthToParticles:function(val){this._applyDepthToParticles=val;return this;},applyLayerToParticles:function(val){this._applyLayerToParticles=val;return this;},quantityTimespan:function(val){this._quantityTimespan=val;return this;},quantityBase:function(val){this._quantityBase=val;return this;},quantityVariance:function(a,b){this._quantityVariance=[a,b];return this;},quantityMax:function(val){this._quantityMax=val;this._quantityProduced=0;return this;},translateBaseX:function(val){this._translateBaseX=val;return this;},translateBaseY:function(val){this._translateBaseY=val;return this;},translateBaseZ:function(val){this._translateBaseZ=val;return this;},translateVarianceX:function(a,b){this._translateVarianceX=[a,b];return this;},translateVarianceY:function(a,b){this._translateVarianceY=[a,b];return this;},translateVarianceZ:function(a,b){this._translateVarianceZ=[a,b];return this;},rotateBase:function(val){this._rotateBase=val;return this;},rotateVariance:function(a,b){this._rotateVariance=[a,b];return this;},deathRotateBase:function(val){this._deathRotateBase=val;return this;},deathRotateVariance:function(a,b){this._deathRotateVariance=[a,b];return this;},scaleBaseX:function(val){this._scaleBaseX=val;return this;},scaleBaseY:function(val){this._scaleBaseY=val;return this;},scaleBaseZ:function(val){this._scaleBaseZ=val;return this;},scaleVarianceX:function(a,b){this._scaleVarianceX=[a,b];return this;},scaleVarianceY:function(a,b){this._scaleVarianceY=[a,b];return this;},scaleVarianceZ:function(a,b){this._scaleVarianceZ=[a,b];return this;},scaleLockAspect:function(val){this._scaleLockAspect=val;return this;},deathScaleBaseX:function(val){this._deathScaleBaseX=val;return this;},deathScaleBaseY:function(val){this._deathScaleBaseY=val;return this;},deathScaleBaseZ:function(val){this._deathScaleBaseZ=val;return this;},deathScaleVarianceX:function(a,b){this._deathScaleVarianceX=[a,b];return this;},deathScaleVarianceY:function(a,b){this._deathScaleVarianceY=[a,b];return this;},deathScaleVarianceZ:function(a,b){this._deathScaleVarianceZ=[a,b];return this;},deathScaleLockAspect:function(val){this._deathScaleLockAspect=val;return this;},opacityBase:function(val){this._opacityBase=val;return this;},opacityVariance:function(a,b){this._opacityVariance=[a,b];return this;},deathOpacityBase:function(val){this._deathOpacityBase=val;return this;},deathOpacityVariance:function(a,b){this._deathOpacityVariance=[a,b];return this;},lifeBase:function(val){this._lifeBase=val;return this;},lifeVariance:function(a,b){this._lifeVariance=[a,b];return this;},/**
	 * Sets the base velocity vector of each emitted particle and optionally
	 * the min and max vectors that are used to randomize the resulting particle
	 * velocity vector.
	 * @param baseVector
	 * @param minVector
	 * @param maxVector
	 */velocityVector:function(baseVector,minVector,maxVector){this._velocityVector={base:baseVector,min:minVector,max:maxVector};return this;},linearForceVector:function(baseVector,minVector,maxVector){this._linearForceVector={base:baseVector,min:minVector,max:maxVector};return this;},/**
	 * Starts the particle emitter which will begin spawning
	 * particle entities based upon the emitter's current settings.
	 * @return {*}
	 */start:function(){if(this._particle){// Update the transform matrix before starting
// otherwise some particles might read the old
// matrix values if the start method was chained!
this.updateTransform();this._quantityTimespan=this._quantityTimespan!==undefined?this._quantityTimespan:1000;this._maxParticles=this.baseAndVarianceValue(this._quantityBase,this._quantityVariance,true);this._particlesPerTimeVector=this._quantityTimespan/this._maxParticles;// 1 Particle every x milliseconds (x stored in this._particlesPerTimeVector)
this._currentDelta=0;// Set the emitter started flag
this._quantityProduced=0;this._started=true;}else{this.log('Cannot start particle emitter because no particle class was specified with a call to particle()','error');}return this;},updateSettings:function(){this._maxParticles=this.baseAndVarianceValue(this._quantityBase,this._quantityVariance,true);this._particlesPerTimeVector=this._quantityTimespan/this._maxParticles;// 1 Particle every x milliseconds (x stored in this._particlesPerTimeVector)
},/**
	 * Stops the particle emitter. The current particles will
	 * continue to process until they reach their natural lifespan.
	 * @return {*}
	 */stop:function(){this._started=false;return this;},/**
	 * Stops the particle emitter. The current particles will be
	 * destroyed immediately.
	 * @return {*}
	 */stopAndKill:function(){this._started=false;// Loop the particles array and destroy all the particles
var arr=this._particles;var arrCount=arr.length;while(arrCount--){arr[arrCount].destroy();}// Remove all references to the particles by
// re-initialising the particles array
this._particles=[];return this;},/*
		start emitting particles.
		once the quantity required of particles are emitted, stop emitting
	*/emitOnce:function(){this.start();this._emitOnce=true;},/**
	 * Takes a base value and a variance range and returns a random
	 * value between the range, added to the base.
	 * @param {Number} base The base value.
	 * @param {Array} variance An array containing the two values of
	 * the variance range.
	 * @param {Boolean} floorIt If set to true, will cause the returned
	 * value to be passed through Math.floor().
	 * @return {Number} Returns the final value based upon the base
	 * value and variance range.
	 */baseAndVarianceValue:function(base,variance,floorIt){base=base||0;variance=variance||[0,0];var variant=0;if(floorIt){variant=Math.floor(variance[0]+Math.random()*(variance[1]-variance[0]));}else{variant=variance[0]+Math.random()*(variance[1]-variance[0]);}return base+variant;},vectorFromBaseMinMax:function(vectorData){if(vectorData.min&&vectorData.max){var base=vectorData.base;var min=vectorData.min;var max=vectorData.max;var newVector={};newVector.x=base.x+(min.x+Math.random()*(max.x-min.x));newVector.y=base.y+(min.y+Math.random()*(max.y-min.y));newVector.z=base.z+(min.z+Math.random()*(max.z-min.z));return newVector;}else{// There was no variance data so return the base vector
return vectorData.base;}},/**
	 * Creates and maintains the particles that this emitter is
	 * responsible for spawning and controlling.
	 * @param ctx
	 */tick:function(ctx){this._currentDelta+=ige._tickDelta;// Check if the emitter is mounted to anything and started, if not
// then don't bother creating particles!
if(this._parent&&this._started){if(!this._quantityMax||this._quantityProduced<this._quantityMax){var particleCount,translateX,translateY,translateZ,// vectorAngle,
// vectorPower,
velocityVector,newVecX,newVecY,rotX,rotY,cosRot,sinRot,scaleX,scaleY,scaleZ,rotate,opacity,life,// linearForceAngle,
// linearForcePower,
linearForceVector,deathScaleX,deathScaleY,deathScaleZ,deathRotate,deathOpacity,tempParticle,tweens,scaleProps,i;if(this._currentDelta>this._quantityTimespan){this._currentDelta=this._quantityTimespan;}if(this._currentDelta>=this._particlesPerTimeVector){particleCount=this._currentDelta/this._particlesPerTimeVector|0;// Bitwise floor
this._currentDelta-=this._particlesPerTimeVector*particleCount;// Loop the particle array and if no particle exists,
// create one to fill the space. Basically this keeps
// the emitters creating new particles until it is
// stopped.
if(particleCount){while(particleCount--){if(this._quantityMax){this._quantityProduced++;// If the number of particles produced is equal to or greater
// than the max we should produce then exit the loop
if(this._quantityProduced>=this._quantityMax){this.stop();break;}}// Create the initial particle values based on
// the emitter options values
// Generate the particle's initial translate values
translateX=this.baseAndVarianceValue(this._translateBaseX,this._translateVarianceX,true);translateY=this.baseAndVarianceValue(this._translateBaseY,this._translateVarianceY,true);translateZ=this.baseAndVarianceValue(this._translateBaseZ,this._translateVarianceZ,true);// translateX += this._worldMatrix.matrix[2];
// translateY += this._worldMatrix.matrix[5];
if(this._velocityVector){// Generate the particle's initial vector angle and power
velocityVector=this.vectorFromBaseMinMax(this._velocityVector);// Rotate the vector's point to match the current emitter rotation
rotX=velocityVector.x;rotY=velocityVector.y;cosRot=this._worldMatrix.matrix[0];// Math.cos(this._rotate.z);
sinRot=this._worldMatrix.matrix[3];// Math.sin(this._rotate.z);
newVecX=rotX*cosRot-rotY*sinRot;newVecY=rotY*cosRot+rotX*sinRot;// Assign the rotated vector back again
velocityVector.x=newVecX;velocityVector.y=newVecY;}// vectorAngle = this.baseAndVarianceValue(this._vectorAngleBase, this._vectorAngleVariance, true);
// vectorPower = this.baseAndVarianceValue(this._vectorPowerBase, this._vectorPowerVariance, false);
// Generate the particle's initial scale
scaleX=this.baseAndVarianceValue(this._scaleBaseX,this._scaleVarianceX,false);scaleZ=scaleY=scaleX;if(!this._scaleLockAspect){scaleY=this.baseAndVarianceValue(this._scaleBaseY,this._scaleVarianceY,false);scaleZ=this.baseAndVarianceValue(this._scaleBaseZ,this._scaleVarianceZ,false);}// Generate the particle's initial rotation
rotate=this.baseAndVarianceValue(this._rotateBase,this._rotateVariance,true);// Generate the particle's initial opacity
opacity=this.baseAndVarianceValue(this._opacityBase,this._opacityVariance,false);// Generate the particle's initial lifespan
life=this.baseAndVarianceValue(this._lifeBase,this._lifeVariance,true);// Generate the particle's linear force vector angle and power
if(this._linearForceVector){linearForceVector=this.vectorFromBaseMinMax(this._linearForceVector);// Rotate the vector's point to match the current emitter rotation
rotX=linearForceVector.x;rotY=linearForceVector.y;cosRot=this._worldMatrix.matrix[0];// Math.cos(this._rotate.z);
sinRot=this._worldMatrix.matrix[3];// Math.sin(this._rotate.z);
newVecX=rotX*cosRot-rotY*sinRot;newVecY=rotY*cosRot+rotX*sinRot;// Assign the rotated vector back again
linearForceVector.x=newVecX;linearForceVector.y=newVecY;}// linearForceAngle = this.baseAndVarianceValue(this._linearForceAngleBase, this._linearForceAngleVariance);
// linearForcePower = this.baseAndVarianceValue(this._linearForcePowerBase, this._linearForcePowerVariance, false);
// Generate the particle's death scale
if(typeof this._deathScaleBaseX!=='undefined'){deathScaleX=this.baseAndVarianceValue(this._deathScaleBaseX,this._deathScaleVarianceX,false);}if(typeof this._deathScaleBaseY!=='undefined'&&!this._deathScaleLockAspect){deathScaleY=this.baseAndVarianceValue(this._deathScaleBaseY,this._deathScaleVarianceY,false);}if(typeof this._deathScaleBaseZ!=='undefined'&&!this._deathScaleLockAspect){deathScaleZ=this.baseAndVarianceValue(this._deathScaleBaseZ,this._deathScaleVarianceZ,false);}if(this._deathScaleLockAspect){deathScaleZ=deathScaleY=deathScaleX;}// Generate the particle's death rotation
if(typeof this._deathRotateBase!=='undefined'){deathRotate=this.baseAndVarianceValue(this._deathRotateBase,this._deathRotateVariance,true);}// Generate the particle's death opacity
if(typeof this._deathOpacityBase!=='undefined'){deathOpacity=this.baseAndVarianceValue(this._deathOpacityBase,this._deathOpacityVariance,false);}// Create the particle entity
tempParticle=new this._particle(this,this.color);// Add the current transform of the emitter to the final
// particle transforms
if(this._ignoreCamera){translateX+=this._translate.x;translateY+=this._translate.y;}else{translateX+=this._worldMatrix.matrix[2];translateY+=this._worldMatrix.matrix[5];}translateZ+=this._translate.z;scaleX*=this._scale.x;scaleY*=this._scale.y;scaleZ*=this._scale.z;deathScaleX*=this._scale.x;deathScaleY*=this._scale.y;deathScaleZ*=this._scale.z;// console.log("tileOccupied", ige.map.isTileOccupied(translateX, translateY, 5, 5))
// Apply all the transforms (don't do this in the initial
// entity definition because some components may already
// have initialised due to the particle template
tempParticle.translateTo(translateX,translateY,translateZ);tempParticle.rotateTo(0,0,Math.radians(rotate));tempParticle.scaleTo(scaleX,scaleY,scaleZ);tempParticle.opacity(opacity);if(this._applyDepthToParticles){tempParticle.depth(this._depth);}if(this._applyLayerToParticles){tempParticle.layer(this._layer);}if(typeof velocityVector==='object'){tempParticle.velocity.vector3(velocityVector,false);}if(typeof linearForceVector==='object'){tempParticle.velocity.linearForceVector3(linearForceVector,false);}tweens=[];if(typeof deathRotate!=='undefined'){tweens.push(new $i_49().targetObj(tempParticle._rotate).properties({z:Math.radians(deathRotate)}).duration(life));}if(typeof deathOpacity!=='undefined'){tweens.push(new $i_49().targetObj(tempParticle).properties({_opacity:deathOpacity}).duration(life));}scaleProps={};if(typeof deathScaleX!=='undefined'){scaleProps.x=deathScaleX;}if(typeof deathScaleY!=='undefined'){scaleProps.y=deathScaleY;}if(typeof deathScaleZ!=='undefined'){scaleProps.z=deathScaleZ;}if(scaleProps.x||scaleProps.y||scaleProps.z){tweens.push(new $i_49().targetObj(tempParticle._scale).properties(scaleProps).duration(life));}if(typeof life==='number'){tempParticle.lifeSpan(life);}// Add the particle to this emitter's particle array
this._particles.push(tempParticle);// Add the particle to the scene
tempParticle.mount(this._particleMountTarget||this._parent);// Start the relevant tweens
for(i=0;i<tweens.length;i++){tweens[i].start();}}}}}if(this._emitOnce)// if quality has been fulfilled, and we're suppose to emit only once
{// ige.devLog("stopping!!")
this.stop();this._emitOnce=false;}}$i_57.prototype.tick.call(this,ctx);},/**
	 * Returns an array of the current particle entities that this
	 * emitter has spawned.
	 * @return {Array} The array of particle entities the emitter spawned.
	 */particles:function(){return this._particles;},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object's properties via
	 * chained commands. This method will only check for
	 * properties that are directly related to this class.
	 * Other properties are handled by their own class method.
	 * @return {String}
	 */_stringify:function(){// Get the properties for all the super-classes
var str=$i_57.prototype._stringify.call(this);var i;return str;// TODO: WRITE THIS FOR THIS CLASS - EPIC AMOUNT OF WORK HERE
// Loop properties and add property assignment code to string
for(i in this){if(this.hasOwnProperty(i)&&this[i]!==undefined){switch(i){case'':str+=`.text(${this.text()})`;break;}}}return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_60;};var $i_61=$i_56.extend({classId:'$i_61',init:function(emitter){this._emitter=emitter;$i_56.prototype.init.call(this);// Setup the particle default values
this.addComponent($i_11);},destroy:function(){// Remove ourselves from the emitter
if(this._emitter!==undefined){this._emitter._particles.pull(this);}$i_56.prototype.destroy.call(this);}});;/**
 * Creates a new map that has two dimensions (x and y) to it's data.
 */var $i_62=$i_2.extend({classId:'$i_62',init:function(data){this._mapData=data||[];},/**
	 * Gets / sets a value on the specified map tile co-ordinates.
	 * @param {Number} x
	 * @param {Number} y
	 * @param {*=} val The data to set on the map tile co-ordinate.
	 * @return {*}
	 */tileData:function(x,y,val){if(x!==undefined&&y!==undefined){if(val!==undefined){// Assign a value
this._mapData[y]=this._mapData[y]||[];this._mapData[y][x]=val;return this;}else{// No assignment so see if we have data to return
if(this._mapData[y]){return this._mapData[y][x];}}}// Either no x, y was specified or there was
// no data at the x, y so return undefined
return undefined;},/**
	 * Clears any data set at the specified map tile co-ordinates.
	 * @param x
	 * @param y
	 * @return {Boolean} True if data was cleared or false if no data existed.
	 */clearData:function(x,y){if(x!==undefined&&y!==undefined){if(this._mapData[y]!==undefined){delete this._mapData[y][x];return true;}}return false;},/**
	 * Checks if the tile area passed has any data stored in it. If
	 * so, returns true, otherwise false.
	 * @param x
	 * @param y
	 * @param width
	 * @param height
	 */collision:function(x,y,width,height){var xi,yi;if(width===undefined){width=1;}if(height===undefined){height=1;}if(x!==undefined&&y!==undefined){for(yi=0;yi<height;yi++){for(xi=0;xi<width;xi++){if(this.tileData(x+xi,y+yi)){return true;}}}}return false;},/**
	 * Checks if the tile area passed has data stored in it that matches
	 * the passed data. If so, returns true, otherwise false.
	 * @param x
	 * @param y
	 * @param width
	 * @param height
	 * @param data
	 */collisionWith:function(x,y,width,height,data){var xi,yi;if(width===undefined){width=1;}if(height===undefined){height=1;}if(x!==undefined&&y!==undefined){for(yi=0;yi<height;yi++){for(xi=0;xi<width;xi++){if(this.tileData(x+xi,y+yi)===data){return true;}}}}return false;},/**
	 * Checks if the tile area passed has data stored in it that matches
	 * the passed data and does not collide with any other stored tile
	 * data. If so, returns true, otherwise false.
	 * @param x
	 * @param y
	 * @param width
	 * @param height
	 * @param data
	 */collisionWithOnly:function(x,y,width,height,data){var xi;var yi;var tileData;var withData=false;if(width===undefined){width=1;}if(height===undefined){height=1;}if(x!==undefined&&y!==undefined){for(yi=0;yi<height;yi++){for(xi=0;xi<width;xi++){tileData=this.tileData(x+xi,y+yi);if(tileData){if(this.tileData(x+xi,y+yi)===data){withData=true;}else{return false;}}}}}return withData;},/**
	 * Gets / sets the map's tile data.
	 * @param {Array} val The map data array.
	 * @param {Integer} startX The start x co-ordinate of the data.
	 * @param {Integer} startY The start y co-ordinate of the data.
	 * @return {*}
	 */mapData:function(val,startX,startY){if(val!==undefined){if(!startX&&!startY){this._mapData=val;}else{// Loop the map data and apply based on the start positions
var x,y;for(y in val){for(x in val[y]){this._mapData[startY+parseInt(y)][startX+parseInt(x)]=val[y][x];}}}return this;}return this._mapData;},sortedMapDataAsArray:function(){var data=this.mapData();var finalData={};var x,y,xArr,yArr,i,k;yArr=this._sortKeys(data);for(i=0;i<yArr.length;i++){y=yArr[i];xArr=this._sortKeys(data[y]);finalData[y]=finalData[y]||{};for(k=0;k<xArr.length;k++){x=xArr[k];finalData[y][x]=data[y][x];}}return finalData;},_sortKeys:function(obj){var arr=[];for(var i in obj){arr.push(i);}arr.sort();return arr;},/**
	 * Returns a string of the map's data in JSON format.
	 * @return {String}
	 */mapDataString:function(){return JSON.stringify(this.mapData());},/**
	 * Inserts map data into the map at the given co-ordinates. Please note this
	 * is not used for setting a tile's value. This is used to add large sections
	 * of map data at the specified co-ordinates. To set an individual tile value,
	 * please use tile(x, y, val).
	 * @param {Number} x
	 * @param {Number} y
	 * @param {Array} val The map data array.
	 */ // TODO: Write this function's internals!
insertMapData:function(x,y,val){// Loop the data and fill the map data with it
},/**
	 * Rotates map data either -90 degrees (anti-clockwise), 90 degrees (clockwise) or
	 * 180 degrees. Useful when you want to define one section of a map and then re-use
	 * it in slightly different layouts.
	 * @param {Array} val The map data array to rotate.
	 * @param {Number} mode Either -90, 90 or 180 to denote the type of rotation to perform.
	 */ // TODO: Write this function's internals!
rotateData:function(val,mode){switch(mode){case-90:// Rotate the data
break;case 180:break;case 90:default:break;}},translateDataBy:function(transX,transY){var yArr=this.mapData();var newArr=[];var x;var y;var xArr;var i;var k;for(y in yArr){if(yArr.hasOwnProperty(y)){i=parseInt(y,10);xArr=yArr[i];newArr[i+transY]=newArr[i+transY]||{};for(x in xArr){if(xArr.hasOwnProperty(x)){k=parseInt(x,10);newArr[i+transY][k+transX]=yArr[y][x];}}}}this.mapData(newArr,0,0);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_62;};/**
 * Tile maps provide a way to align mounted child objects to a tile-based grid.
 * NOTE: These are not to be confused with $i_50Map's which allow you to
 * paint a bunch of tiles to a grid.
 */var $i_63=$i_56.extend({classId:'$i_63',$i_63:true,init:function(tileWidth,tileHeight){$i_56.prototype.init.call(this);tileWidth=tileWidth!==undefined?tileWidth:40;tileHeight=tileHeight!==undefined?tileHeight:40;var self=this;if(!ige.isServer){var tex=new $i_50($i_63SmartTexture);self.texture(tex);}self.map=new $i_62();self._adjustmentMatrix=new $i_8();self.tileWidth(tileWidth);self.tileHeight(tileHeight);self.gridSize(3,3);self._drawGrid=0;self._gridColor='#ffffff';},/**
	 * Gets / sets the flag that determines if the tile map will paint the
	 * occupied tiles with an overlay colour so that it is easy to spot them.
	 * @param val
	 * @return {*}
	 */highlightOccupied:function(val){if(val!==undefined){this._highlightOccupied=val;return this;}return this._highlightOccupied;},highlightTileRect:function(val){if(val!==undefined){this._highlightTileRect=val;return this;}return this._highlightTileRect;},/**
	 * Gets / sets the map's tile width.
	 * @param {Number} val Tile width.
	 * @return {*}
	 */tileWidth:function(val){if(val!==undefined){this._tileWidth=val;if(this._gridSize&&this._gridSize.x){this.width(this._tileWidth*this._gridSize.x);this._updateAdjustmentMatrix();}return this;}return this._tileWidth;},/**
	 * Gets / sets the map's tile height.
	 * @param {Number} val Tile height.
	 * @return {*}
	 */tileHeight:function(val){if(val!==undefined){this._tileHeight=val;if(this._gridSize&&this._gridSize.y){this.height(this._tileHeight*this._gridSize.y);this._updateAdjustmentMatrix();}return this;}return this._tileHeight;},gridSize:function(x,y){if(x!==undefined&&y!==undefined){this._gridSize=new $i_4(x,y);// If in 2d mount mode
if(this._mountMode===0){if(this._tileWidth){this.width(this._tileWidth*this._gridSize.x);}}// If in isometric mount mode
if(this._mountMode===1){if(this._tileWidth){this.width(this._tileWidth*2*this._gridSize.x);}}if(this._tileHeight){this.height(this._tileHeight*this._gridSize.y);}this._updateAdjustmentMatrix();return this;}return this._gridSize;},/**
	 * Gets / sets if the tile map should paint a grid to the context during
	 * the tick method.
	 * @param {Boolean=} val If true, will paint the grid on tick.
	 * @return {*}
	 */drawGrid:function(val){if(val!==undefined){this._drawGrid=val;return this;}return this._drawGrid;},/**
	 * Gets / sets the color of the grid overlay. It accepts a string color
	 * definition with the same specifications as the canvas context strokeStyle
	 * property.
	 * @param {String=} val The color of the grid.
	 * @return {*}
	 */gridColor:function(val){if(val!==undefined){this._gridColor=val;return this;}return this._gridColor;},/**
	 * Sets a tile or area as occupied by the passed obj parameter.
	 * Any previous occupy data on the specified tile or area will be
	 * overwritten.
	 * @param {Number} x X co-ordinate of the tile to un-occupy.
	 * @param {Number} y Y co-ordinate of the tile to un-occupy.
	 * @param {Number} width Number of tiles along the x-axis to occupy.
	 * @param {Number} height Number of tiles along the y-axis to occupy.
	 * @param {*} obj
	 * @return {*}
	 */occupyTile:function(x,y,width,height,obj){var xi,yi;if(width===undefined){width=1;}if(height===undefined){height=1;}// Floor the values
x=Math.floor(x);y=Math.floor(y);width=Math.floor(width);height=Math.floor(height);if(x!==undefined&&y!==undefined){for(xi=0;xi<width;xi++){for(yi=0;yi<height;yi++){this.map.tileData(x+xi,y+yi,obj);}}// Create an $i_7 to represent the tiles this
// entity has just occupied
if(obj._classId){obj._occupiedRect=new $i_7(x,y,width,height);}}return this;},/**
	 * Removes all data from the specified tile or area.
	 * @param {Number} x
	 * @param {Number} y
	 * @param {Number=} width
	 * @param {Number=} height
	 * @return {*}
	 */unOccupyTile:function(x,y,width,height){var xi,yi,item;if(width===undefined){width=1;}if(height===undefined){height=1;}// Floor the values
x=Math.floor(x);y=Math.floor(y);width=Math.floor(width);height=Math.floor(height);if(x!==undefined&&y!==undefined){for(xi=0;xi<width;xi++){for(yi=0;yi<height;yi++){item=this.map.tileData(x+xi,y+yi);if(item&&item._occupiedRect){delete item._occupiedRect;}this.map.clearData(x+xi,y+yi);}}}return this;},/**
	 * Returns true if the specified tile or tile area has
	 * an occupied status.
	 * @param {Number} x
	 * @param {Number} y
	 * @param {Number=} width
	 * @param {Number=} height
	 * @return {*}
	 */isTileOccupied:function(x,y,width,height){if(width===undefined){width=1;}if(height===undefined){height=1;}return this.map.collision(x,y,width,height);},tileOccupiedBy:function(x,y){return this.map.tileData(x,y);},/**
	 * Returns the tile co-ordinates of the tile that the point's world
	 * co-ordinates reside inside.
	 * @param {$i_5} point
	 * @return {$i_5} The tile co-ordinates as a point object.
	 */pointToTile:function(point){// TODO: Could this do with some caching to check if the input values have changed and if not,
// TODO: supply the same pre-calculated data if it already exists?
var mx=point.x;var my=point.y;var dx;var dy;var tilePos;if(this._mountMode===0){// 2d
dx=mx;// + this._tileWidth / 2;
dy=my;// + this._tileHeight / 2;
tilePos=new $i_5(Math.floor(dx/this._tileWidth),Math.floor(dy/this._tileWidth),0);}if(this._mountMode===1){// iso
dx=mx;dy=my;tilePos=new $i_5(Math.floor(dx/this._tileWidth),Math.floor(dy/this._tileHeight),0);}return tilePos;},/**
	 * Returns the world co-ordinates of the tile the mouse is currently over.
	 * @return {$i_5}
	 */mouseTilePoint:function(){var tilePos=this.mouseToTile().thisMultiply(this._tileWidth,this._tileHeight,1);tilePos.x+=this._tileWidth/2;tilePos.y+=this._tileHeight/2;return tilePos;},tileToPoint:function(x,y){var point;if(this._mountMode===0){point=new $i_5(x,y,0).thisMultiply(this._tileWidth,this._tileHeight,1);point.x-=this._bounds2d.x2-this._tileWidth/2;point.y-=this._bounds2d.y2-this._tileHeight/2;}if(this._mountMode===1){point=new $i_5(x*this._tileWidth+this._tileWidth/2,y*this._tileHeight+this._tileHeight/2,0);point.x-=this._bounds2d.x2/2;point.y-=this._bounds2d.y2;}point.x2=point.x/2;point.y2=point.y/2;return point;},/**
	 * Returns the tile co-ordinates of the tile the mouse is currently over.
	 * @return {$i_5}
	 */mouseToTile:function(vp){var tilePos;if(!vp)vp=ige.client.vp1;if(this._mountMode===0){tilePos=this.pointToTile(vp.mousePos());}else{tilePos=this.pointToTile(vp.mousePos().to2d());}return tilePos;},/**
	 * Scans the map data and returns an array of rectangle
	 * objects that encapsulate the map data into discrete
	 * rectangle areas.
	 * @param {Function=} callback Returns true or false for
	 * the passed map data determining if it should be included
	 * in a rectangle or not.
	 * @return {Array}
	 */scanRects:function(callback){var x;var y;var rectArray=[];var mapData=this.map._mapData.clone();// Loop the map data and scan for blocks that can
// be converted into static box2d rectangle areas
for(y in mapData){if(mapData.hasOwnProperty(y)){for(x in mapData[y]){if(mapData[y].hasOwnProperty(x)){if(mapData[y][x]&&(!callback||callback&&callback(mapData[y][x],x,y))){rectArray.push(this._scanRects(mapData,parseInt(x,10),parseInt(y,10),callback));}}}}}return rectArray;},_scanRects:function(mapData,x,y,callback){var rect={x:x,y:y,width:1,height:1};var nx=x+1;var ny=y+1;// Clear the current x, y cell mapData
mapData[y][x]=0;while(mapData[y][nx]&&(!callback||callback&&callback(mapData[y][nx],nx,y))){rect.width++;// Clear the mapData for this cell
mapData[y][nx]=0;// Next column
nx++;}while(mapData[ny]&&mapData[ny][x]&&(!callback||callback&&callback(mapData[ny][x],x,ny))){// Check for mapData either side of the column width
if(mapData[ny][x-1]&&(!callback||callback&&callback(mapData[ny][x-1],x-1,ny))||mapData[ny][x+rect.width]&&(!callback||callback&&callback(mapData[ny][x+rect.width],x+rect.width,ny))){return rect;}// Loop the column's map data and check that there is
// an intact column the same width as the starting column
for(nx=x;nx<x+rect.width;nx++){if(!mapData[ny][nx]||callback&&!callback(mapData[ny][nx],nx,ny)){// This row has a different column width from the starting
// column so return the rectangle as it stands
return rect;}}// Mark the row as cleared
for(nx=x;nx<x+rect.width;nx++){mapData[ny][nx]=0;}rect.height++;ny++;}return rect;},inGrid:function(x,y,width,height){if(width===undefined){width=1;}if(height===undefined){height=1;}// Checks if the passed area is inside the tile map grid as defined by gridSize
return x>=0&&y>=0&&x+width<=this._gridSize.x&&y+height<=this._gridSize.y;},/**
	 * Gets / sets the mouse tile hover color used in conjunction with the
	 * drawMouse() method.
	 * @param {String=} val The hex or rbg string color definition e.g. #ff0099.
	 * @returns {*}
	 */hoverColor:function(val){if(val!==undefined){this._hoverColor=val;return this;}return this._hoverColor;},/**
	 * Loads map data from a saved map.
	 * @param {Object} map The map data object.
	 */loadMap:function(map){// Just fill in the map data
this.map.mapData(map.data,0,0);return this;},/**
	 * Returns a map JSON string that can be saved to a data file and loaded
	 * with the loadMap() method.
	 * @return {Object} The map data object.
	 */saveMap:function(layer){// in URL format
var textures=[];var i;var x;var y;var dataX=0;var dataY=0;var mapData=layer.map._mapData;// Get the lowest x, y
for(y in mapData){if(mapData.hasOwnProperty(y)){for(x in mapData[y]){if(mapData[y].hasOwnProperty(x)){if(parseInt(x)<parseInt(dataX)){dataX=parseInt(x);}if(parseInt(y)<parseInt(dataY)){dataY=parseInt(y);}}}}}return JSON.stringify({data:layer.map.sortedMapDataAsArray(),dataXY:[parseInt(dataX,10),parseInt(dataY,10)]});},isometricMounts:function(val){if(val!==undefined){$i_56.prototype.isometricMounts.call(this,val);// Re-call the methods that check iso mounts property
this.tileWidth(this._tileWidth);this.tileHeight(this._tileHeight);this.gridSize(this._gridSize.x,this._gridSize.y);this._updateAdjustmentMatrix();return this;}return this._mountMode;},tileMapHitPolygon:function(mousePoint){if(this._mountMode===0){return this.aabb();}if(this._mountMode===1){var aabb=this.aabb();var poly=new $i_6();poly.addPoint(aabb.x+aabb.width/2,aabb.y);poly.addPoint(aabb.x+aabb.width,aabb.y+aabb.height/2);poly.addPoint(aabb.x+aabb.width/2,aabb.y+aabb.height-1);poly.addPoint(aabb.x-1,aabb.y+aabb.height/2-1);return poly;}},_processTriggerHitTests:function(){// This method overrides the one in $i_56
if(this._mouseEventsActive&&ige._currentViewport){if(!this._mouseAlwaysInside){var mouseTile=this.mouseToTile(ige._selectedViewport);if(mouseTile.x>=0&&mouseTile.y>=0&&mouseTile.x<this._gridSize.x&&mouseTile.y<this._gridSize.y){return true;}else{return false;}}else{return true;}}return false;},_updateAdjustmentMatrix:function(){if(this._bounds2d.x2&&this._bounds2d.y2&&this._tileWidth&&this._tileHeight){if(this._mountMode===0){this._adjustmentMatrix.translateTo(this._bounds2d.x2,this._bounds2d.y2);}if(this._mountMode===1){this._adjustmentMatrix.translateTo(0,this._bounds2d.y2);}}},_childMounted:function(obj){// We can also re-use the tile size methods since
// they alter the same properties on the calling
// entity anyway.
obj.tileWidth=obj.tileWidth||this.tileWidth;obj.tileHeight=obj.tileHeight||this.tileHeight;// Set default values
obj._tileWidth=obj._tileWidth||1;obj._tileHeight=obj._tileHeight||1;$i_56.prototype._childMounted.call(this,obj);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_63;};// TODO: Implement the _stringify() method for this class
/**
 * Texture maps provide a way to display textures / cells across a tile map.
 */var $i_50Map=$i_63.extend({classId:'$i_50Map',init:function(tileWidth,tileHeight){$i_63.prototype.init.call(this,tileWidth,tileHeight);this.map=new $i_62();this._textureList=[];this._renderCenter=new $i_5(0,0,0);this._cacheDirty=true;},/**
	 * Gets / sets the auto sectioning mode. If enabled the texture map
	 * will render to off-screen canvases in sections denoted by the
	 * number passed. For instance if you pass 10, the canvas sections
	 * will be 10x10 tiles in size.
	 * @param {Number=} val The size in tiles of each section.
	 * @return {*}
	 */autoSection:function(val){if(val!==undefined){this._autoSection=val;return this;}return this._autoSection;},/**
	 * Gets / sets the draw sections flag. If true the texture map will
	 * output debug lines between each section of the map when using the
	 * auto section system.
	 * @param {Number=} val The boolean flag value.
	 * @return {*}
	 */drawSectionBounds:function(val){if(val!==undefined){this._drawSectionBounds=val;return this;}return this._drawSectionBounds;},/**
	 * Forces a cache redraw on the next tick.
	 */cacheForceFrame:function(){this._cacheDirty=true;},/**
	 * Takes another map and removes any data from this map where data already
	 * exists in the other.
	 * @param {$i_63} entity The other map to read map data from.
	 * @return {*}
	 */negate:function(entity){if(entity!==undefined){var x;var y;var entityMapData=entity.map._mapData;var thisMapData=this.map._mapData;for(y in entityMapData){if(entityMapData.hasOwnProperty(y)){for(x in entityMapData[y]){if(entityMapData[y].hasOwnProperty(x)){if(thisMapData[y]&&thisMapData[y][x]){// This map has data in the same place as the passed
// entity's map so remove this map's data
delete thisMapData[y][x];}}}}}}return this;},/**
	 * Adds a texture to the texture map's internal texture list so
	 * that it can be referenced via an index so that the texture map's
	 * data will be something like [[textureId, textureCell]]
	 * or a real world example: [[0, 1], [1, 1]].
	 * @param {$i_50} texture
	 * @return {Integer} The index of the texture you just added.
	 */addTexture:function(texture){this._textureList.push(texture);if(!texture._loaded){this._allTexturesLoaded=false;}return this._textureList.length-1;},/**
	 * Checks the status of all the textures that have been added to
	 * this texture map and returns true if they are all loaded.
	 * @return {Boolean} True if all textures are loaded, false if
	 * not.
	 */allTexturesLoaded:function(){if(!this._allTexturesLoaded){var arr=this._textureList;var arrCount=arr.length;while(arrCount--){if(!arr[arrCount]._loaded){return false;}}}this._allTexturesLoaded=true;return true;},/**
	 * Sets the specified tile's texture index and cell that will be used
	 * when rendering the texture map.
	 * @param {Number} x The tile x co-ordinate.
	 * @param {Number} y The tile y co-ordinate.
	 * @param {Number} textureIndex The texture index.
	 * @param {Number} cell The cell index.
	 */paintTile:function(x,y,textureIndex,cell){if(x!==undefined&&y!==undefined&&textureIndex!==undefined){if(cell===undefined||cell<1){cell=1;// Set the cell default to 1
}this.map.tileData(x,y,[textureIndex,cell]);}},/**
	 * Clears any previous tile texture and cell data for the specified
	 * tile co-ordinates.
	 * @param {Number} x The tile x co-ordinate.
	 * @param {Number} y The tile y co-ordinate.
	 */clearTile:function(x,y){this.map.clearData(x,y);},/**
	 * Reads the map data from a standard map object and fills the map
	 * with the data found.
	 * @param {Object} map The map data object.
	 */loadMap:function(map){if(map.textures){// Empty the existing array
this._textureList=[];var tex=[];var i;var self=this;// Loop the texture list and create each texture object
for(i=0;i<map.textures.length;i++){// Load each texture
eval(`tex[${i}] = ${map.textures[i]}`);self.addTexture(tex[i]);}// Fill in the map data
self.map.mapData(map.data);}else{// Just fill in the map data
this.map.mapData(map.data);}return this;},/**
	 * Returns a map JSON string that can be saved to a data file and loaded
	 * with the loadMap() method.
	 * @return {Object} The map data object.
	 */saveMap:function(){// in URL format
var textures=[];var i;var x;var y;var dataX=0;var dataY=0;var mapData=this.map._mapData;// Grab all the texture definitions
for(i=0;i<this._textureList.length;i++){textures.push(this._textureList[i].stringify());}// Get the lowest x, y
for(y in mapData){if(mapData.hasOwnProperty(y)){for(x in mapData[y]){if(mapData[y].hasOwnProperty(x)){if(x<dataX){dataX=x;}if(y<dataY){dataY=y;}}}}}return JSON.stringify({textures:textures,data:this.map.mapData(),dataXY:[dataX,dataY]});},/**
	 * Clears the tile data from the map effectively wiping it clean. All
	 * existing map data will be removed. The textures assigned to the texture
	 * map will not be affected.
	 * @returns {*}
	 */clearMap:function(){this.map.mapData([]);return this;},/**
	 * Clears tile data from the map and also removes any textures from the
	 * map that were previously assigned to it. This is useful for reverting
	 * the texture map to it's virgin state as if it had just been created.
	 * @returns {*}
	 */reset:function(){this.clearMap();this._textureList=[];return this;},/**
	 * Gets / sets the specified tile's texture index.
	 * @param {Number} x The tile x co-ordinate.
	 * @param {Number} y The tile y co-ordinate.
	 * @param {Number=} textureIndex The new texture index.
	 */tileTextureIndex:function(x,y,textureIndex){if(x!==undefined&&y!==undefined){var obj=this.map.tileData(x,y);if(textureIndex!==undefined){// Set the cell
obj[0]=textureIndex;}else{return obj[0];}}},/**
	 * Gets / sets the specified tile's texture cell.
	 * @param {Number} x The tile x co-ordinate.
	 * @param {Number} y The tile y co-ordinate.
	 * @param {Number} cell The new cell index.
	 */tileTextureCell:function(x,y,cell){if(x!==undefined&&y!==undefined){var obj=this.map.tileData(x,y);if(cell!==undefined){// Set the cell
obj[1]=cell;}else{return obj[1];}}},/**
	 * Converts data that is saved in the format [x][y] to the IGE standard
	 * of [y][x] and then returns the data.
	 * @param {Array} mapData The map data array.
	 * @return {Object} The new map data.
	 */convertHorizontalData:function(mapData){var newData=[];var x;var y;for(x in mapData){if(mapData.hasOwnProperty(x)){for(y in mapData[x]){if(mapData[x].hasOwnProperty(y)){// Displace the data from the x axis to the y axis
newData[y]=newData[y]||[];newData[y][x]=mapData[x][y];}}}}return newData;},/**
	 * Handles rendering the texture map during engine tick events.
	 * @param {CanvasRenderingContext2d} ctx
	 */tick:function(ctx){if(ige.isClient&&!ige.client.mapRenderEnabled)return;// TODO: This is being called at the wrong time, drawing children before this parent! FIX THIS
// Run the $i_63 tick method
$i_63.prototype.tick.call(this,ctx);// Draw each image that has been defined on the map
var mapData=this.map._mapData;var x;var y;var tx;var ty;var xInt;var yInt;var finalX;var finalY;var finalPoint;var tileData;var tileEntity=this._newTileEntity();// TODO: This is wasteful, cache it?
var sectionX;var sectionY;var tempSectionX;var tempSectionY;var _ctx;var regions;var region;var i;if(this._autoSection>0){if(this._cacheDirty){// Check that all the textures we need to use are loaded
if(this.allTexturesLoaded()){// We have a dirty cache so render the section cache
// data first
// TODO: Shouldn't we be replacing these arrays with new ones to drop the old ones from memory?
// TODO: Gonna do that now and see what the result is.
this._sections=[];// this._sections || [];
this._sectionCtx=[];// this._sectionCtx || [];
// TODO: This isn't ideal because we are almost certainly dropping sections that are still relevant,
// TODO: so we should scan and garbage collect I think, instead.
// Loop the map data
for(y in mapData){if(mapData.hasOwnProperty(y)){for(x in mapData[y]){if(mapData[y].hasOwnProperty(x)){xInt=parseInt(x);yInt=parseInt(y);// Calculate the tile's final resting position in absolute
// co-ordinates so we can work out which section canvas to
// paint the tile to
if(this._mountMode===0){// We're rendering a 2d map
finalX=xInt;finalY=yInt;}if(this._mountMode===1){// We're rendering an iso map
// Convert the tile x, y to isometric
tx=xInt*this._tileWidth;ty=yInt*this._tileHeight;finalX=(tx-ty)/this._tileWidth;finalY=(tx+ty)*0.5/this._tileHeight;}// Grab the tile data to paint
tileData=mapData[y][x];// Work out which section to paint to
sectionX=Math.floor(finalX/this._autoSection);sectionY=Math.floor(finalY/this._autoSection);// Check if an off-screen canvas already exists for this section
// and if not, create one
this._ensureSectionExists(sectionX,sectionY);// Grab the drawing context for the section
_ctx=this._sectionCtx[sectionX][sectionY];if(tileData){regions=this._renderTile(_ctx,xInt,yInt,tileData,tileEntity,null,sectionX,sectionY);// Check if the tile overlapped another section
if(regions){// Loop the regions and re-render the tile on the
// other sections that it overlaps
for(i=0;i<regions.length;i++){region=regions[i];tempSectionX=sectionX;tempSectionY=sectionY;if(region.x){tempSectionX+=region.x;}if(region.y){tempSectionY+=region.y;}this._ensureSectionExists(tempSectionX,tempSectionY);_ctx=this._sectionCtx[tempSectionX][tempSectionY];this._sectionTileRegion=this._sectionTileRegion||[];this._sectionTileRegion[tempSectionX]=this._sectionTileRegion[tempSectionX]||[];this._sectionTileRegion[tempSectionX][tempSectionY]=this._sectionTileRegion[tempSectionX][tempSectionY]||[];this._sectionTileRegion[tempSectionX][tempSectionY][xInt]=this._sectionTileRegion[tempSectionX][tempSectionY][xInt]||[];if(!this._sectionTileRegion[tempSectionX][tempSectionY][xInt][yInt]){this._sectionTileRegion[tempSectionX][tempSectionY][xInt][yInt]=true;this._renderTile(_ctx,xInt,yInt,tileData,tileEntity,null,tempSectionX,tempSectionY);}}}}}}}}// Set the cache to clean!
this._cacheDirty=false;// Remove the temporary section tile painted data
delete this._sectionTileRegion;}}this._drawSectionsToCtx(ctx);}else{// Check that all the textures we need to use are loaded
if(this.allTexturesLoaded()){// Render the whole map
for(y in mapData){if(mapData.hasOwnProperty(y)){for(x in mapData[y]){if(mapData[y].hasOwnProperty(x)){// Grab the tile data to paint
tileData=mapData[y][x];if(tileData){this._renderTile(ctx,x,y,tileData,tileEntity);}}}}}}}},/**
	 * Private method, checks if the specified section currently exists in the cache
	 * and if not, creates it.
	 * @param {Number} sectionX The section's x co-ordinate.
	 * @param {Number} sectionY The section's y co-ordinate.
	 * @private
	 */_ensureSectionExists:function(sectionX,sectionY){var sectionCtx;this._sections[sectionX]=this._sections[sectionX]||[];this._sectionCtx[sectionX]=this._sectionCtx[sectionX]||[];if(!this._sections[sectionX][sectionY]){this._sections[sectionX][sectionY]=document.createElement('canvas');this._sections[sectionX][sectionY].width=this._tileWidth*this._autoSection;this._sections[sectionX][sectionY].height=this._tileHeight*this._autoSection;sectionCtx=this._sectionCtx[sectionX][sectionY]=this._sections[sectionX][sectionY].getContext('2d');// Ensure the canvas is using the correct image antialiasing mode
if(!ige._globalSmoothing){sectionCtx.imageSmoothingEnabled=false;// sectionCtx.webkitImageSmoothingEnabled = false;
sectionCtx.mozImageSmoothingEnabled=false;}else{sectionCtx.imageSmoothingEnabled=true;// sectionCtx.webkitImageSmoothingEnabled = true;
sectionCtx.mozImageSmoothingEnabled=true;}// One-time translate the context
sectionCtx.translate(this._tileWidth/2,this._tileHeight/2);}},/**
	 * Private method, draws cached image sections to the canvas context.
	 * @param {CanvasRenderingContext2d} ctx
	 * @private
	 */_drawSectionsToCtx:function(ctx){var x;var y;var tileData;var sectionRenderX;var sectionRenderY;var sectionAbsX;var sectionAbsY;var sectionWidth;var sectionHeight;var viewArea=ige._currentViewport.viewArea();// Render the map sections
// ctx.translate(-(this._tileWidth / 2), -(this._tileHeight / 2));
sectionWidth=this._tileWidth*this._autoSection;sectionHeight=this._tileHeight*this._autoSection;for(x in this._sections){if(this._sections.hasOwnProperty(x)){for(y in this._sections[x]){if(this._sections[x].hasOwnProperty(y)){sectionRenderX=x*(this._tileWidth*this._autoSection);sectionRenderY=y*(this._tileHeight*this._autoSection);sectionAbsX=this._translate.x+sectionRenderX-ige._currentCamera._translate.x;sectionAbsY=this._translate.y+sectionRenderY-ige._currentCamera._translate.y;// Check if we are drawing isometrically and adjust
if(this._mountMode===1){sectionAbsX-=this._tileWidth/2;sectionAbsY-=this._tileHeight/2;}// Check if the section is "on screen"
if(sectionAbsX+sectionWidth+this._tileHeight/2>=-(viewArea.width/2)&&sectionAbsX-this._tileWidth/2<=viewArea.width/2&&sectionAbsY+sectionHeight+this._tileHeight/2>=-(viewArea.height/2)&&sectionAbsY<=viewArea.height/2){// Grab the canvas to paint
tileData=this._sections[x][y];ctx.drawImage(tileData,0,0,sectionWidth,sectionHeight,sectionRenderX,sectionRenderY,sectionWidth,sectionHeight);ige._drawCount++;if(this._drawSectionBounds){// Draw a bounding rectangle around the section
ctx.strokeStyle='#ff00f6';ctx.strokeRect(x*(this._tileWidth*this._autoSection),y*(this._tileHeight*this._autoSection),this._tileWidth*this._autoSection,this._tileHeight*this._autoSection);}}}}}}},/**
	 * Private method, renders a tile texture based on data from the texture map,
	 * to a cached section.
	 * @param {CanvasRenderingContext2d} ctx
	 * @param {Number} x The tile x co-ordinate.
	 * @param {Number} y The tile y co-ordinate.
	 * @param {Object} tileData The tile's texture and cell data.
	 * @param {Object} tileEntity The object that represents the tile.
	 * @param {$i_7=} rect The rectangular area to limit drawing to.
	 * @param {Number} sectionX The x co-ordinate of the section to draw to.
	 * @param {Number} sectionY The y co-ordinate of the section to draw to.
	 * @return {*}
	 * @private
	 */_renderTile:function(ctx,x,y,tileData,tileEntity,rect,sectionX,sectionY){// TODO: Handle scaling so tiles don't loose res on scaled cached sections
var finalX;var finalY;var regions;var xm1;var xp1;var ym1;var yp1;var regObj;var xAdjust=this._mountMode===1?this._tileWidth/2:0;var yAdjust=this._mountMode===1?this._tileHeight/2:0;var tx;var ty;var sx;var sy;var texture;// Translate the canvas to the tile position
if(this._mountMode===0){finalX=x*this._tileWidth;finalY=y*this._tileHeight;}if(this._mountMode===1){// Convert the tile x, y to isometric
tx=x*this._tileWidth;ty=y*this._tileHeight;sx=tx-ty;sy=(tx+ty)*0.5;finalX=sx-this._tileWidth/2;finalY=sy;}if(sectionX!==undefined){finalX-=sectionX*this._autoSection*this._tileWidth;}if(sectionY!==undefined){finalY-=sectionY*this._autoSection*this._tileHeight;}// If we have a rectangle region we are limiting to...
if(rect){// Check the bounds first
if(!rect.xyInside(finalX,finalY)){// The point is not inside the bounds, return
return;}}if(finalX-xAdjust<0){regions=regions||[];regions.push({x:-1});xm1=true;regObj=regObj||{};regObj.x=-1;}if(finalX+xAdjust>ctx.canvas.width-this._tileWidth){regions=regions||[];regions.push({x:1});xp1=true;regObj=regObj||{};regObj.x=1;}if(finalY-0<0){regions=regions||[];regions.push({y:-1});ym1=true;regObj=regObj||{};regObj.y=-1;}if(finalY+0>ctx.canvas.height-this._tileHeight){regions=regions||[];regions.push({y:1});yp1=true;regObj=regObj||{};regObj.y=1;}if(xm1||ym1||xp1||yp1){regions.push(regObj);}ctx.save();ctx.translate(finalX,finalY);// Set the correct texture data
texture=this._textureList[tileData[0]];tileEntity._cell=tileData[1];// Paint the texture
if(texture){texture.render(ctx,tileEntity,ige._tickDelta);}ctx.restore();return regions;},/**
	 * Private method, creates an entity object that a texture can use to render
	 * itself. This is basically a dummy object that has the minimum amount of data
	 * in it that a texture requires to render such as geometry, texture
	 * cell and rendering position.
	 * @return {Object} The new tile entity object.
	 * @private
	 */_newTileEntity:function(){if(this._mountMode===0){return{_cell:1,_bounds2d:{x:this._tileWidth,y:this._tileHeight},_renderPos:{x:-this._tileWidth/2,y:-this._tileHeight/2}};}if(this._mountMode===1){return{_cell:1,_bounds2d:{x:this._tileWidth*2,y:this._tileHeight},_renderPos:{x:-this._tileWidth,y:-this._tileHeight/2}};}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_50Map;};var $i_63SmartTexture={render:function(ctx,entity){var tileWidth=entity._tileWidth;var tileHeight=entity._tileHeight;var bounds2d=entity.bounds2d();var gridSize=entity._gridSize;var x=0;var y=0;/* ctx.save();
		var triggerPoly = entity.tileMapHitPolygon();

		ctx.strokeStyle = '#00ff00';
		ctx.fillStyle = '#ff99f4';

		if (entity._processTriggerHitTests()) {
			ctx.fillStyle = '#ff26e8';
		}

		if (entity._mountMode === 0) {
			ctx.translate(bounds2d.x2, bounds2d.y2);
		}

		if (entity._mountMode === 1) {
			ctx.translate(-entity._translate.x, -entity._translate.y);
			triggerPoly.render(ctx, true);
		}

		//
		ctx.restore(); */if(entity._drawGrid){ctx.strokeStyle=entity._gridColor;var gridMaxX=x+tileWidth*gridSize.x;var gridMaxY=y+tileHeight*gridSize.y;var index;var gStart;var gEnd;x=0;y=0;for(index=0;index<=gridSize.y;index++){gStart=new $i_4(x,y+tileHeight*index);gEnd=new $i_4(gridMaxX,y+tileHeight*index);if(entity._mountMode===1){// Iso grid
gStart=gStart.toIso();gEnd=gEnd.toIso();}ctx.beginPath();ctx.moveTo(gStart.x,gStart.y);ctx.lineTo(gEnd.x,gEnd.y);ctx.stroke();}for(index=0;index<=gridSize.x;index++){gStart=new $i_4(x+tileWidth*index,y);gEnd=new $i_4(x+tileWidth*index,gridMaxY);if(entity._mountMode===1){// Iso grid
gStart=gStart.toIso();gEnd=gEnd.toIso();}ctx.beginPath();ctx.moveTo(gStart.x,gStart.y);ctx.lineTo(gEnd.x,gEnd.y);ctx.stroke();}}if(entity._highlightOccupied){ctx.fillStyle='#ff0000';for(y in entity.map._mapData){if(entity.map._mapData[y]){for(x in entity.map._mapData[y]){if(entity.map._mapData[y][x]){// Tile is occupied
tilePoint=new $i_4(tileWidth*x,tileHeight*y);// TODO: Abstract out the tile drawing method so that it can be overridden for other projections etc
if(entity._mountMode===0){// 2d
ctx.fillRect(tilePoint.x,tilePoint.y,tileWidth,tileHeight);}if(entity._mountMode===1){// iso
tilePoint.thisToIso();ctx.beginPath();ctx.moveTo(tilePoint.x,tilePoint.y);ctx.lineTo(tilePoint.x+tileWidth,tilePoint.y+tileHeight/2);ctx.lineTo(tilePoint.x,tilePoint.y+tileHeight);ctx.lineTo(tilePoint.x-tileWidth,tilePoint.y+tileHeight/2);ctx.lineTo(tilePoint.x,tilePoint.y);ctx.fill();}}}}}}if(entity._highlightTileRect){ctx.fillStyle='#e4ff00';for(y=entity._highlightTileRect.y;y<entity._highlightTileRect.y+entity._highlightTileRect.height;y++){for(x=entity._highlightTileRect.x;x<entity._highlightTileRect.x+entity._highlightTileRect.width;x++){// Tile is occupied
tilePoint=new $i_4(tileWidth*x,tileHeight*y);// TODO: Abstract out the tile drawing method so that it can be overridden for other projections etc
if(entity._mountMode===0){// 2d
ctx.fillRect(tilePoint.x,tilePoint.y,tileWidth,tileHeight);}if(entity._mountMode===1){// iso
tilePoint.thisToIso();ctx.beginPath();ctx.moveTo(tilePoint.x,tilePoint.y-tileHeight/2);ctx.lineTo(tilePoint.x+tileWidth,tilePoint.y);ctx.lineTo(tilePoint.x,tilePoint.y+tileHeight/2);ctx.lineTo(tilePoint.x-tileWidth,tilePoint.y);ctx.lineTo(tilePoint.x,tilePoint.y-tileHeight/2);ctx.fill();}}}}if(entity._drawMouse){// console.log(entity.id(), ige._selectedViewport.id())
// Get mouse position
var mousePos=ige._selectedViewport.mousePos();var mouseTile=entity.mouseToTile(ige._selectedViewport);var tilePoint;var text;var textMeasurement;if(mouseTile.x>=0&&mouseTile.y>=0&&mouseTile.x<gridSize.x&&mouseTile.y<gridSize.y){// Paint the tile the mouse is currently intersecting
ctx.fillStyle=entity._hoverColor||'#6000ff';if(ige._selectedViewport.id()==='vp1'&&entity.id()!=='Tile_Map'){return;}if(ige._selectedViewport.id()==='vp2'&&entity.id()!=='Tilesheet_Map'){return;}if(entity._mountMode===0){// 2d
ctx.fillRect(mouseTile.x*tileWidth,mouseTile.y*tileHeight,tileWidth,tileHeight);}if(entity._mountMode===1){// iso
tilePoint=mouseTile.clone().thisMultiply(tileWidth,tileHeight,0).thisToIso();tilePoint.y+=tileHeight/2;ctx.beginPath();ctx.moveTo(tilePoint.x,tilePoint.y-tileHeight/2);ctx.lineTo(tilePoint.x+tileWidth,tilePoint.y);ctx.lineTo(tilePoint.x,tilePoint.y+tileHeight/2);ctx.lineTo(tilePoint.x-tileWidth,tilePoint.y);ctx.lineTo(tilePoint.x,tilePoint.y-tileHeight/2);ctx.fill();}if(entity._drawMouseData){text=`Tile X: ${mouseTile.x} Y: ${mouseTile.y}`;textMeasurement=ctx.measureText(text);ctx.fillStyle='rgba(0, 0, 0, 0.8)';ctx.fillRect(Math.floor(mousePos.x-textMeasurement.width/2-5),Math.floor(mousePos.y-40),Math.floor(textMeasurement.width+10),14);ctx.fillStyle='#ffffff';ctx.fillText(text,Math.floor(mousePos.x-textMeasurement.width/2),Math.floor(mousePos.y-30));}}}}};;/**
 * Creates a new camera that will be attached to a viewport.
 */var $i_67=$i_56.extend({classId:'$i_67',init:function(entity){$i_56.prototype.init.call(this);this._trackRotateTarget=undefined;this._trackTranslateTarget=undefined;this._trackRotateSmoothing=undefined;this._trackTranslateSmoothing=undefined;// Store the viewport this camera is attached to
this._entity=entity;},/**
	 * Gets / sets the rectangle that the camera translate
	 * will be limited to using an $i_7 instance.
	 * @param {$i_7=} rect
	 * @return {*}
	 */limit:function(rect){// TODO: Write the usage of this limit data, currently does nothing
if(rect!==undefined){this._limit=rect;return this._entity;}return this._limit;},/**
	 * Pan (tween) the camera to the new specified point in
	 * the specified time.
	 * @param {$i_5} point The point describing the co-ordinates to pan to.
	 * @param {Number} durationMs The number of milliseconds to span the pan operation over.
	 * @param {String=} easing Optional easing method name.
	 */panTo:function(point,durationMs,easing){if(point!==undefined){this._translate.tween().properties({x:point.x,y:point.y,z:point.z}).duration(durationMs).easing(easing).start();}return this._entity;},/**
	 * Pan (tween) the camera by the new specified point in
	 * the specified time.
	 * @param {$i_5} point The point describing the co-ordinates to pan by.
	 * @param {Number} durationMs The number of milliseconds to span the pan operation over.
	 * @param {String=} easing Optional easing method name.
	 */panBy:function(point,durationMs,easing){if(point!==undefined){this._translate.tween().properties({x:point.x+this._translate.x,y:point.y+this._translate.y,z:point.z+this._translate.z}).duration(durationMs).easing(easing).start();}return this._entity;},/**
	 * Tells the camera to track the movement of the specified
	 * target entity. The camera will center on the entity.
	 * @param {$i_56} entity
	 * @param {Number=} smoothing Determines how quickly the camera
	 * will track the target, the higher the number, the slower the
	 * tracking will be.
	 * @param {Boolean=} rounding Sets if the smoothing system is
	 * allowed to use floating point values or not. If enabled then
	 * it will not use floating point values.
	 * @return {*}
	 */trackTranslate:function(entity,smoothing,rounding){if(entity!==undefined){// if (entity._stats)
// 	console.log("trackTranslating entity defined:", entity._stats.name)
if(rounding!==undefined){this._trackTranslateRounding=rounding;}if(smoothing!==undefined){this._trackTranslateSmoothing=smoothing>=1?smoothing:0;}this._trackTranslateTarget=entity;return this._entity;}return this._trackTranslateTarget;},/**
	 * Gets / sets the translate tracking smoothing value.
	 * @param {Number=} val
	 * @return {*}
	 */trackTranslateSmoothing:function(val){if(val!==undefined){this._trackTranslateSmoothing=val;return this;}return this._trackTranslateSmoothing;},/**
	 * Gets / sets the translate tracking smoothing rounding
	 * either enabled or disabled. When enabled the translate
	 * smoothing value will be rounded so that floating point
	 * values are not used which can help when smoothing on a
	 * scene that has texture smoothing disabled so sub-pixel
	 * rendering doesn't work and objects appear to "snap"
	 * into position as the smoothing interpolates.
	 * @param {Boolean=} val
	 * @return {*}
	 */trackTranslateRounding:function(val){if(val!==undefined){this._trackTranslateRounding=val;return this;}return this._trackTranslateRounding;},/**
	 * Stops tracking the current tracking target's translation.
	 */unTrackTranslate:function(){delete this._trackTranslateTarget;},/**
	 * Tells the camera to track the rotation of the specified
	 * target entity.
	 * @param {$i_56} entity
	 * @param {Number=} smoothing Determines how quickly the camera
	 * will track the target, the higher the number, the slower the
	 * tracking will be.
	 * @return {*}
	 */trackRotate:function(entity,smoothing){if(entity!==undefined){this.log(`Camera on viewport ${this._entity.id()} is now tracking rotation of target ${entity.id()}`);this._trackRotateSmoothing=smoothing>=1?smoothing:0;this._trackRotateTarget=entity;return this._entity;}return this._trackRotateTarget;},/**
	 * Gets / sets the rotate tracking smoothing value.
	 * @param {Number=} val
	 * @return {*}
	 */trackRotateSmoothing:function(val){if(val!==undefined){this._trackRotateSmoothing=val;return this;}return this._trackRotateSmoothing;},/**
	 * Stops tracking the current tracking target.
	 */unTrackRotate:function(){delete this._trackRotateTarget;},/**
	 * Translates the camera to the center of the specified entity so
	 * that the camera is "looking at" the entity.
	 * @param {$i_56} entity The entity to look at.
	 * @param {Number=} durationMs If specified, will cause the
	 * camera to tween to the location of the entity rather than
	 * snapping to it instantly.
	 * @param {String=} easing The easing method name to use if
	 * tweening by duration.
	 * @return {*}
	 */lookAt:function(entity,durationMs,easing){if(entity!==undefined){entity.updateTransform();if(!durationMs){// Copy the target's world matrix translate data
this._translate.x=Math.floor(entity._worldMatrix.matrix[2]);this._translate.y=Math.floor(entity._worldMatrix.matrix[5]);}else{this._translate.tween().properties({x:Math.floor(entity._worldMatrix.matrix[2]),y:Math.floor(entity._worldMatrix.matrix[5]),z:0}).duration(durationMs).easing(easing).start();}this.updateTransform();}return this;},update:function(ctx){// Process any behaviours assigned to the camera
this._processUpdateBehaviours(ctx);// Check if we are tracking the translate value of a target
if(this._trackTranslateTarget){var targetEntity=this._trackTranslateTarget;var targetMatrix=targetEntity._worldMatrix.matrix;var targetX=targetMatrix[2];var targetY=targetMatrix[5];var sourceX;var sourceY;var distX;var distY;var destinationX;var destinationY;if(!this._trackTranslateSmoothing){// Copy the target's world matrix translate data
this.lookAt(this._trackTranslateTarget);}else{// Ease between the current and target values
sourceX=this._translate.x;sourceY=this._translate.y;distX=Math.round(targetX-sourceX);distY=Math.round(targetY-sourceY);if(this._trackTranslateRounding){destinationX=this._translate.x+Math.round(distX/this._trackTranslateSmoothing);destinationY=this._translate.y+Math.round(distY/this._trackTranslateSmoothing);}else{destinationX=this._translate.x+distX/this._trackTranslateSmoothing;destinationY=this._translate.y+distY/this._trackTranslateSmoothing;}// Check camera Limits
if(this._limit){if(destinationX<this._limit.x){destinationX=this._limit.x;}if(destinationX>this._limit.x+this._limit.width){destinationX=this._limit.x+this._limit.width;}if(destinationY<this._limit.y){destinationY=this._limit.y;}if(destinationY>this._limit.y+this._limit.height){destinationY=this._limit.y+this._limit.height;}}this._translate.x=destinationX;this._translate.y=destinationY;}}// Check if we are tracking the rotation values of a target
if(this._trackRotateTarget){var targetParentRZ=this._trackRotateTarget._parent!==undefined?this._trackRotateTarget._parent._rotate.z:0;var targetZ=-(targetParentRZ+this._trackRotateTarget._rotate.z);var sourceZ;var distZ;if(!this._trackRotateSmoothing){// Copy the target's rotate data
this._rotate.z=targetZ;}else{// Interpolate between the current and target values
sourceZ=this._rotate.z;distZ=targetZ-sourceZ;this._rotate.z+=distZ/this._trackRotateSmoothing;}}this.updateTransform();},/**
	 * Process operations during the engine tick.
	 * @param {CanvasRenderingContext2D} ctx
	 */tick:function(ctx){if(ige.isClient&&!ige.client.cameraEnabled)return;// Process any behaviours assigned to the camera
this._processTickBehaviours(ctx);// commented out because of redundancy. it's already declared in $i_56.js (jaeyun apr 2017)
// Updated local transform matrix and then transform the context
this._localMatrix.transformRenderingContext(ctx);},/**
	 * Checks the current transform values against the previous ones. If
	 * any value is different, the appropriate method is called which will
	 * update the transformation matrix accordingly. This version of the
	 * method is specifically designed for cameras!
	 */updateTransform:function(){if(ige.isServer)return;this._localMatrix.identity();// On cameras we do the rotation and scaling FIRST
this._localMatrix.multiply(this._localMatrix._newRotate(this._rotate.z));this._localMatrix.multiply(this._localMatrix._newScale(this._scale.x,this._scale.y));// 2d translation - cameras are never in iso mode!
this._localMatrix.multiply(this._localMatrix._newTranslate(-this._translate.x,-this._translate.y));if(this._parent){this._worldMatrix.copy(this._parent._worldMatrix);this._worldMatrix.multiply(this._localMatrix);}else{this._worldMatrix.copy(this._localMatrix);}},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object's properties via
	 * chained commands. This method will only check for
	 * properties that are directly related to this class.
	 * Other properties are handled by their own class method.
	 * @private
	 * @return {String}
	 */_stringify:function(){// Get the properties for all the super-classes
var str=$i_56.prototype._stringify.call(this);var i;// Loop properties and add property assignment code to string
for(i in this){if(this.hasOwnProperty(i)&&this[i]!==undefined){switch(i){case'_trackTranslateTarget':str+=`.trackTranslate(ige.$('${this._trackTranslateTarget.id()}'), ${this.trackTranslateSmoothing()})`;break;case'_trackRotateTarget':str+=`.trackRotate(ige.$('${this._trackRotateTarget.id()}'), ${this.trackRotateSmoothing()})`;break;}}}return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_67;};/**
 * Creates a new viewport.
 */var $i_68=$i_56.extend([{extension:$i_41,overwrite:true},{extension:$i_40,overwrite:true}],{classId:'$i_68',$i_68:true,init:function(options){var width,height;this._alwaysInView=true;$i_56.prototype.init.call(this);this._mouseAlwaysInside=true;this._mousePos=new $i_5(0,0,0);this._overflow='';this._clipping=true;this._bornTime=undefined;// Set default options if not specified
// TODO: Is this required or even used?
if(options){width=options.width;height=options.height;if(options&&options.scaleToWidth&&options.scaleToHeight){// Store the w/h we want to lock to
this._lockDimension=new $i_5(options.scaleToWidth,options.scaleToHeight,0);}}// Setup default objects
this._bounds2d=new $i_5(width||ige._bounds2d.x,height||ige._bounds2d.y,0);this.camera=new $i_67(this);this.camera._entity=this;// this._drawMouse = true;
},/**
	 * Sets the minimum amount of world in pixels to display in width and height.
	 * When set, if the viewport's geometry is reduced below the minimum width or
	 * height, the viewport's camera is automatically scaled to ensure that the
	 * minimum area remains visible in the viewport.
	 * @param {Integer} width Width in pixels.
	 * @param {Integer} height Height in pixels.
	 * @returns {*}
	 */minimumVisibleArea:function(width,height){// Store the w/h we want to lock to
this._lockDimension=new $i_5(width,height,0);if(ige.isClient){this._resizeEvent({});}return this;},/**
	 * Gets / sets the auto-size property. If set to true, the viewport will
	 * automatically resize to fill the entire scene.
	 * @param val
	 * @return {*}
	 */autoSize:function(val){if(typeof val!=='undefined'){this._autoSize=val;return this;}return this._autoSize;},/**
	 * Gets / sets the scene that the viewport will render.
	 * @param {$i_69} scene
	 * @return {*}
	 */scene:function(scene){if(typeof scene!=='undefined'){this._scene=scene;return this;}return this._scene;},/**
	 * Returns the viewport's mouse position.
	 * @return {$i_5}
	 */mousePos:function(){// Viewport mouse position is calculated and assigned in the
// $i_14 class.
return this._mousePos.clone();},mousePosWorld:function(){return this._transformPoint(this._mousePos.clone());},/**
	 * Gets the current rectangular area that the viewport is "looking at"
	 * in the world. The co-ordinates are in world space.
	 * @returns {$i_7}
	 */viewArea:function(){var aabb=this.aabb();var camTrans=this.camera._translate;var camScale=this.camera._scale;var width=aabb.width*(1/camScale.x);var height=aabb.height*(1/camScale.y);return new $i_7(camTrans.x-width/2,camTrans.y-height/2,width,height);},/**
	 * Processes the updates before the render tick is called.
	 * @param ctx
	 */update:function(ctx,tickDelta){// Check if we have a scene attached to this viewport
if(this._scene){// Store the viewport camera in the main ige so that
// down the scenegraph we can choose to negate the camera
// transform effects
ige._currentCamera=this.camera;ige._currentViewport=this;this._scene._parent=this;this.camera.update(ctx,tickDelta);$i_56.prototype.update.call(this,ctx,tickDelta);if(this._scene.newFrame()){this._scene.update(ctx,tickDelta);}}},/**
	 * Processes the actions required each render frame.
	 */tick:function(ctx,scene){// don't render minimap viewport if minimap turned off
if(this._id=='vpMiniMap'&&ige.isClient&&!ige.client.miniMapEnabled)return;// Check if we have a scene attached to this viewport
if(this._scene){// Store the viewport camera in the main ige so that
// down the scenegraph we can choose to negate the camera
// transform effects
ige._currentCamera=this.camera;ige._currentViewport=this;this._scene._parent=this;// Render our scene data
// ctx.globalAlpha = ctx.globalAlpha * this._parent._opacity * this._opacity;
$i_56.prototype.tick.call(this,ctx);// Translate to the top-left of the viewport
ctx.translate(-(this._bounds2d.x*this._origin.x)|0,-(this._bounds2d.y*this._origin.y)|0);// Clear the rectangle area of the viewport
if(ige.isClient&&ige.client.clearEveryFrame){ctx.clearRect(0,0,this._bounds2d.x,this._bounds2d.y);}// Clip the context so we only draw "inside" the viewport area
if(ige.isClient&&ige.client.viewportClippingEnabled){if(this._clipping||this._borderColor){ctx.beginPath();ctx.rect(0,0,this._bounds2d.x/ige._scale.x,this._bounds2d.y/ige._scale.x);// Paint a border if required
if(this._borderColor){ctx.strokeStyle=this._borderColor;ctx.stroke();}if(this._clipping){ctx.clip();}}}// Translate back to the center of the viewport
ctx.translate((this._bounds2d.x/2|0)+ige._translate.x,(this._bounds2d.y/2|0)+ige._translate.y);/* ctx.translate(ige._translate.x, ige._translate.y); */if(ige._scale.x!==1||ige._scale.y!==1){ctx.scale(ige._scale.x,ige._scale.y);}// Transform the context to the center of the viewport
// by processing the viewport's camera tick method
this.camera.tick(ctx);// Draw the scene
ctx.save();this._scene.tick(ctx);ctx.restore();// Check if we should draw guides
if(this._drawGuides&&ctx===ige._ctx){ctx.save();ctx.translate(-this._translate.x,-this._translate.y);this.paintGuides(ctx);ctx.restore();}// Check if we should draw bounds on this viewport
// (usually for debug purposes)
if(this._drawBounds&&ctx===ige._ctx){// Traverse the scenegraph and draw axis-aligned
// bounding boxes for every object
ctx.save();ctx.translate(-this._translate.x,-this._translate.y);this.paintAabbs(ctx,this._scene,0);ctx.restore();}// Check if we should draw the mouse position on this
// viewport (usually for debug purposes)
if(this._drawMouse&&ctx===ige._ctx){ctx.save();var mp=this.mousePos();var text;var mx;var my;var textMeasurement;// Re-scale the context to ensure that output is always 1:1
ctx.scale(1/this.camera._scale.x,1/this.camera._scale.y);// Work out the re-scale mouse position
mx=Math.floor(mp.x*this.camera._scale.x);my=Math.floor(mp.y*this.camera._scale.y);ctx.fillStyle='#fc00ff';ctx.fillRect(mx-5,my-5,10,10);text=`${this.id()} X: ${mx}, Y: ${my}`;textMeasurement=ctx.measureText(text);ctx.fillStyle='rgba(0, 0, 0, 0.8)';ctx.fillRect(Math.floor(mx-textMeasurement.width/2-5),Math.floor(my-25),Math.floor(textMeasurement.width+10),14);ctx.fillStyle='#ffffff';ctx.fillText(text,mx-textMeasurement.width/2,my-15);ctx.restore();}if(this._drawViewArea){ctx.save();var va=this.viewArea();ctx.rect(va.x,va.y,va.width,va.height);ctx.stroke();ctx.restore();}}},/**
	 * Returns the screen position of the viewport as an $i_5 where x is the
	 * "left" and y is the "top", useful for positioning HTML elements at the
	 * screen location of an IGE entity. The returned values indicate the center
	 * of the viewport on the screen.
	 *
	 * This method assumes that the top-left
	 * of the main canvas element is at 0, 0. If not you can adjust the values
	 * yourself to allow for offset.
	 * @example #Get the screen position of the entity
	 *     var screenPos = entity.screenPosition();
	 * @return {$i_5} The screen position of the entity.
	 */screenPosition:function(){return new $i_5(Math.floor(this._worldMatrix.matrix[2]+ige._bounds2d.x2),Math.floor(this._worldMatrix.matrix[5]+ige._bounds2d.y2),0);},drawViewArea:function(val){if(val!==undefined){this._drawViewArea=val;return this;}return this._drawViewArea;},drawBoundsLimitId:function(id){if(id!==undefined){this._drawBoundsLimitId=id;return this;}return this._drawBoundsLimitId;},drawBoundsLimitCategory:function(category){if(category!==undefined){this._drawBoundsLimitCategory=category;return this;}return this._drawBoundsLimitCategory;},drawCompositeBounds:function(val){if(val!==undefined){this._drawCompositeBounds=val;return this;}return this._drawCompositeBounds;},drawGuides:function(val){if(val!==undefined){this._drawGuides=val;return this;}return this._drawGuides;},paintGuides:function(ctx){var geom=ige._bounds2d;// Check draw-guides setting
if(this._drawGuides){ctx.strokeStyle='#ffffff';ctx.translate(0.5,0.5);// Draw guide lines in the center
ctx.beginPath();ctx.moveTo(0,-geom.y2);ctx.lineTo(0,geom.y);ctx.stroke();ctx.beginPath();ctx.moveTo(-geom.x2,0);ctx.lineTo(geom.x,0);ctx.stroke();}},/**
	 * Draws the bounding data for each entity in the scenegraph.
	 * @param ctx
	 * @param rootObject
	 * @param index
	 */paintAabbs:function(ctx,rootObject,index){var arr=rootObject._children;var arrCount;var obj;var aabb;var aabbC;var bounds3dPoly;var ga;var r3d;var xl1;var xl2;var xl3;var xl4;var xl5;var xl6;var bf1;var bf2;var bf3;var bf4;var tf1;var tf2;var tf3;var tf4;if(arr){arrCount=arr.length;while(arrCount--){obj=arr[arrCount];index++;if(obj._shouldRender!==false){if(obj._classId!=='$i_69'&&!this._drawBoundsLimitId&&!this._drawBoundsLimitCategory||this._drawBoundsLimitId&&(this._drawBoundsLimitId instanceof Array?this._drawBoundsLimitId.indexOf(obj.id())>-1:this._drawBoundsLimitId===obj.id())||this._drawBoundsLimitCategory&&this._drawBoundsLimitCategory===obj.category()){if(typeof obj.aabb==='function'){// Grab the AABB and then draw it
aabb=obj.aabb();if(this._drawCompositeBounds&&obj._compositeCache){aabbC=obj.compositeAabb();// Draw composite bounds
ctx.strokeStyle='#ff0000';ctx.strokeRect(aabbC.x,aabbC.y,aabbC.width,aabbC.height);}if(aabb){if(obj._drawBounds||obj._drawBounds===undefined){// if (!obj._parent || (obj._parent && obj._parent._mountMode !== 1)) {
// Draw a rect around the bounds of the object transformed in world space
/* ctx.save();
											obj._worldMatrix.transformRenderingContext(ctx);
											ctx.strokeStyle = '#9700ae';
											ctx.strokeRect(-obj._bounds2d.x2, -obj._bounds2d.y2, obj._bounds2d.x, obj._bounds2d.y);
										ctx.restore(); */ // Draw individual bounds
ctx.strokeStyle='#00deff';ctx.strokeRect(aabb.x,aabb.y,aabb.width,aabb.height);// }
// Check if the object is mounted to an isometric mount
if(obj._parent&&obj._parent._mountMode===1){bounds3dPoly=obj.bounds3dPolygon().aabb();ctx.save();ctx.strokeStyle='#0068b8';ctx.strokeRect(bounds3dPoly.x,bounds3dPoly.y,bounds3dPoly.width,bounds3dPoly.height);ctx.restore();ctx.save();ctx.translate(bounds3dPoly.x+bounds3dPoly.width/2,bounds3dPoly.y+bounds3dPoly.height/2);// obj._transformContext(ctx);
// Calculate the 3d bounds data
r3d=obj._bounds3d;xl1=new $i_5(-(r3d.x/2),0,0).toIso();xl2=new $i_5(+(r3d.x/2),0,0).toIso();xl3=new $i_5(0,-(r3d.y/2),0).toIso();xl4=new $i_5(0,+(r3d.y/2),0).toIso();xl5=new $i_5(0,0,-(r3d.z/2)).toIso();xl6=new $i_5(0,0,+(r3d.z/2)).toIso();// Bottom face
bf1=new $i_5(-(r3d.x/2),-(r3d.y/2),-(r3d.z/2)).toIso();bf2=new $i_5(+(r3d.x/2),-(r3d.y/2),-(r3d.z/2)).toIso();bf3=new $i_5(+(r3d.x/2),+(r3d.y/2),-(r3d.z/2)).toIso();bf4=new $i_5(-(r3d.x/2),+(r3d.y/2),-(r3d.z/2)).toIso();// Top face
tf1=new $i_5(-(r3d.x/2),-(r3d.y/2),r3d.z/2).toIso();tf2=new $i_5(+(r3d.x/2),-(r3d.y/2),r3d.z/2).toIso();tf3=new $i_5(+(r3d.x/2),+(r3d.y/2),r3d.z/2).toIso();tf4=new $i_5(-(r3d.x/2),+(r3d.y/2),r3d.z/2).toIso();ga=ctx.globalAlpha;// Axis lines
ctx.globalAlpha=1;ctx.strokeStyle='#ff0000';ctx.beginPath();ctx.moveTo(xl1.x,xl1.y);ctx.lineTo(xl2.x,xl2.y);ctx.stroke();ctx.strokeStyle='#00ff00';ctx.beginPath();ctx.moveTo(xl3.x,xl3.y);ctx.lineTo(xl4.x,xl4.y);ctx.stroke();ctx.strokeStyle='#fffc00';ctx.beginPath();ctx.moveTo(xl5.x,xl5.y);ctx.lineTo(xl6.x,xl6.y);ctx.stroke();ctx.strokeStyle='#a200ff';if(obj._highlight){ctx.globalAlpha=0.9;}else{ctx.globalAlpha=0.6;}// Left face
ctx.fillStyle='#545454';ctx.beginPath();ctx.moveTo(bf3.x,bf3.y);ctx.lineTo(bf4.x,bf4.y);ctx.lineTo(tf4.x,tf4.y);ctx.lineTo(tf3.x,tf3.y);ctx.lineTo(bf3.x,bf3.y);ctx.fill();ctx.stroke();// Right face
ctx.fillStyle='#282828';ctx.beginPath();ctx.moveTo(bf3.x,bf3.y);ctx.lineTo(bf2.x,bf2.y);ctx.lineTo(tf2.x,tf2.y);ctx.lineTo(tf3.x,tf3.y);ctx.lineTo(bf3.x,bf3.y);ctx.fill();ctx.stroke();// Top face
ctx.fillStyle='#676767';ctx.beginPath();ctx.moveTo(tf1.x,tf1.y);ctx.lineTo(tf2.x,tf2.y);ctx.lineTo(tf3.x,tf3.y);ctx.lineTo(tf4.x,tf4.y);ctx.lineTo(tf1.x,tf1.y);ctx.fill();ctx.stroke();ctx.globalAlpha=ga;ctx.restore();}}if(this._drawBoundsData&&(obj._drawBounds||obj._drawBoundsData===undefined)){ctx.globalAlpha=1;ctx.fillStyle='#f6ff00';ctx.fillText(`ID: ${obj.id()} `+`(${obj.classId()}) ${obj.layer()}:${obj.depth().toFixed(0)}`,aabb.x+aabb.width+3,aabb.y+10);ctx.fillText(`X: ${obj._translate.x.toFixed(2)}, `+`Y: ${obj._translate.y.toFixed(2)}, `+`Z: ${obj._translate.z.toFixed(2)}`,aabb.x+aabb.width+3,aabb.y+20);ctx.fillText(`Num Children: ${obj._children.length}`,aabb.x+aabb.width+3,aabb.y+40);}}}}this.paintAabbs(ctx,obj,index);}}}},/**
	 * Handles screen resize events.
	 * @param event
	 * @private
	 */_resizeEvent:function(event){if(this._autoSize&&this._parent){this._bounds2d=this._parent._bounds2d.clone();}this._updateUiPosition();// Resize the scene
if(this._scene){this._scene._resizeEvent(event);}// Process locked dimension scaling
if(this._lockDimension){// Calculate the new camera scale
var ratio=1;var tmpX;var tmpY;if(this._bounds2d.x>this._lockDimension.x&&this._bounds2d.y>this._lockDimension.y){// Scale using lowest ratio
tmpX=this._bounds2d.x/this._lockDimension.x;tmpY=this._bounds2d.y/this._lockDimension.y;ratio=tmpX<tmpY?tmpX:tmpY;}else{if(this._bounds2d.x>this._lockDimension.x&&this._bounds2d.y<this._lockDimension.y){// Scale out to show height
ratio=this._bounds2d.y/this._lockDimension.y;}if(this._bounds2d.x<this._lockDimension.x&&this._bounds2d.y>this._lockDimension.y){// Scale out to show width
ratio=this._bounds2d.x/this._lockDimension.x;}if(this._bounds2d.x<this._lockDimension.x&&this._bounds2d.y<this._lockDimension.y){// Scale using lowest ratio
tmpX=this._bounds2d.x/this._lockDimension.x;tmpY=this._bounds2d.y/this._lockDimension.y;ratio=tmpX<tmpY?tmpX:tmpY;}}this.camera.scaleTo(ratio,ratio,ratio);}},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object's properties via
	 * chained commands. This method will only check for
	 * properties that are directly related to this class.
	 * Other properties are handled by their own class method.
	 * @return {String}
	 */_stringify:function(){// Get the properties for all the super-classes
var str=$i_56.prototype._stringify.call(this);var i;// Loop properties and add property assignment code to string
for(i in this){if(this.hasOwnProperty(i)&&this[i]!==undefined){switch(i){case'_autoSize':str+=`.autoSize(${this._autoSize})`;break;case'_scene':str+=`.scene(ige.$('${this.scene().id()}'))`;break;}}}return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_68;};/**
 * Creates a new 2d scene.
 */var $i_69=$i_56.extend({classId:'$i_69',init:function(){this._mouseAlwaysInside=true;this._alwaysInView=true;$i_56.prototype.init.call(this);this._shouldRender=true;this._autoSize=true;// Set the geometry of the scene to the main canvas
// width / height - used when positioning UI elements
this._bounds2d.x=ige._bounds2d.x;this._bounds2d.y=ige._bounds2d.y;this.streamSections(['transform','ignoreCamera']);},/**
	 * Gets / sets the stream room id. If set, any streaming entities that
	 * are mounted to this scene will only sync with clients that have been
	 * assigned to this room id.
	 *
	 * @param {String} id The id of the room.
	 * @returns {*}
	 */streamRoomId:function(id){if(id!==undefined){this._streamRoomId=id;return this;}return this._streamRoomId;},/**
	 * Overrides the default entity stream sections to also stream important
	 * data about scenes to the client.
	 * @param sectionId
	 * @param data
	 * @returns {*}
	 */streamSectionData:function(sectionId,data){switch(sectionId){case'ignoreCamera':if(data!==undefined){// Setter
if(data==='false'){this.ignoreCamera(false);}else{this.ignoreCamera(true);}}else{// Getter
return String(this._ignoreCamera);}break;default:$i_56.prototype.streamSectionData.call(this,sectionId,data);break;}},/**
	 * Gets / sets the auto-size property. If set to true, the scene will
	 * automatically resize to the engine's canvas geometry.
	 * @param {Boolean=} val If true, will autosize the scene to match the
	 * main canvas geometry. This is enabled by default and is unlikely to
	 * help you if you switch it off.
	 * @return {*}
	 */autoSize:function(val){if(typeof val!=='undefined'){this._autoSize=val;return this;}return this._autoSize;},/**
	 * Gets / sets the _shouldRender property. If set to true, the scene's child
	 * object's tick methods will be called.
	 * @param {Boolean} val If set to false, no child entities will be rendered.
	 * @return {Boolean}
	 */shouldRender:function(val){if(val!==undefined){this._shouldRender=val;return this;}return this._shouldRender;},/**
	 * Gets / sets the flag that determines if the scene will ignore camera
	 * transform values allowing the scene to remain static on screen
	 * regardless of the camera transform.
	 * @param {Boolean=} val True to ignore, false to not ignore.
	 * @return {*}
	 */ignoreCamera:function(val){if(val!==undefined){this._ignoreCamera=val;return this;}return this._ignoreCamera;},update:function(ctx,tickDelta){if(this._ignoreCamera){// Translate the scene so it is always center of the camera
var cam=ige._currentCamera;this.translateTo(cam._translate.x,cam._translate.y,cam._translate.z);this.scaleTo(1/cam._scale.x,1/cam._scale.y,1/cam._scale.z);this.rotateTo(-cam._rotate.x,-cam._rotate.y,-cam._rotate.z);// this._localMatrix.multiply(ige._currentCamera._worldMatrix.getInverse());
}$i_56.prototype.update.call(this,ctx,tickDelta);},/**
	 * Processes the actions required each render frame.
	 * @param {CanvasRenderingContext2D} ctx The canvas context to render to.
	 */tick:function(ctx){if(this._shouldRender){$i_56.prototype.tick.call(this,ctx);}},/**
	 * Handles screen resize events.
	 * @param event
	 * @private
	 */_resizeEvent:function(event){// Set width / height of scene to match main ige (SCENES ARE ALWAYS THE FULL IGE SIZE!!)
if(this._autoSize){this._bounds2d=ige._bounds2d.clone();}// Resize any children
var arr=this._children;var arrCount=arr.length;while(arrCount--){arr[arrCount]._resizeEvent(event);}},/**
	 * Returns a string containing a code fragment that when
	 * evaluated will reproduce this object's properties via
	 * chained commands. This method will only check for
	 * properties that are directly related to this class.
	 * Other properties are handled by their own class method.
	 * @return {String}
	 */_stringify:function(){// Get the properties for all the super-classes
var str=$i_56.prototype._stringify.call(this);var i;// Loop properties and add property assignment code to string
for(i in this){if(this.hasOwnProperty(i)&&this[i]!==undefined){switch(i){case'_shouldRender':str+=`.shouldRender(${this.shouldRender()})`;break;case'_autoSize':str+=`.autoSize(${this.autoSize()})`;break;}}}return str;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_69;};var $i_75=function(){};$i_75.prototype=[];// Empower the $i_75 with all the method calls of the an $i_56
for(var methodName in $i_56.prototype){if($i_56.prototype.hasOwnProperty(methodName)){if(methodName!=='init'){$i_75.prototype[methodName]=function(methodName){return function(){var c=this.length;for(var i=0;i<c;i++){this[i][methodName].apply(this[i],arguments);}};}(methodName);}}}if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_75;};/**
 * The base engine class definition.
 */var $i_102=$i_56.extend({classId:'$i_102',init:function(options){// Deal with some debug settings first
$i_102.prototype.log('initializing IGE engine');if(igeConfig.debug){if(!igeConfig.debug._enabled){// Debug is not enabled so ensure that
// timing debugs are disabled
igeConfig.debug._timing=false;}}this._alwaysInView=true;this._id='ige';this.basePath='';// Determine the environment we are executing in
this.isServer=typeof module!=='undefined'&&typeof module.exports!=='undefined';this.isClient=!this.isServer;this.banIpsList=[];// Assign ourselves to the global variable
ige=this;// Output our header
/*
		$i_102.prototype.log('------------------------------------------------------------------------------');
		$i_102.prototype.log('* Powered by the Isogenic Game Engine ' + igeVersion + '                  *');
		$i_102.prototype.log('* (C)opyright ' + new Date().getFullYear() + ' Irrelon Software Limited                                  *');
		$i_102.prototype.log('* http://www.isogenicengine.com                                              *');
		$i_102.prototype.log('------------------------------------------------------------------------------');
		*/$i_56.prototype.init.call(this);// Check if we are running client-side
if(this.isClient){// Enable cocoonJS support because we are running client-side
this.addComponent($i_39);}// Create storage
this._textureStore=[];// Set the initial id as the current time in milliseconds. This ensures that under successive
// restarts of the engine, new ids will still always be created compared to earlier runs -
// which is important when storing persistent data with ids etc
this._idCounter=new Date().getTime();// use small numbers on the serverside for ids
if(this.isServer){// this._idCounter = 0
this.sanitizer=require('sanitizer').sanitize;this.emptyTimeLimit=3*60*1000;// in ms
this.lastCheckedAt=Date.now();}// Setup components
this.addComponent($i_14);this.addComponent($i_12);this.addComponent($i_9);if(this.isClient){// Enable UI element (virtual DOM) support
this.addComponent($i_19);this.delayedStreamCount=0;}// Set some defaults
this._renderModes=['2d','three'];this._requireScriptTotal=0;this._requireScriptLoading=0;this._loadingPreText=undefined;// The text to put in front of the loading percent on the loading progress screen
this._enableUpdates=true;this._enableRenders=true;this._showSgTree=false;this._debugEvents={};// Holds debug event booleans for named events
this._renderContext=ige.isServer?'2d':'webgl2';// The rendering context, default is 2d
this._renderMode=this._renderModes[this._renderContext];// Integer representation of the render context
this._tickTime='NA';// The time the tick took to process
this._updateTime='NA';// The time the tick update section took to process
this._renderTime='NA';// The time the tick render section took to process
this._tickDelta=0;// The time between the last tick and the current one
this._fpsRate=60;// Sets the frames per second to execute engine tick's at
this._physicsTickRate=20;// phyiscs tick rate
this._gameLoopTickRate=20;// "frameTick", input, and streaming
this._lastPhysicsTickAt=0;this._lastGameLoopTickAt=0;this._physicsTickRemainder=0;this._gameLoopTickRemainder=0;this.gameLoopTickHasExecuted=true;this.physicsTickHasExecuted=true;this._aSecondAgo=0;this._state=0;// Currently stopped
this._textureImageStore={};this._texturesLoading=0;// Holds a count of currently loading textures
this._texturesTotal=0;// Holds total number of textures loading / loaded
this._dependencyQueue=[];// Holds an array of functions that must all return true for the engine to start
this._drawCount=0;// Holds the number of draws since the last frame (calls to drawImage)
this._dps=0;// Number of draws that occurred last tick
this._dpf=0;this._frames=0;// Number of frames looped through since last second tick
this._fps=0;// Number of frames per second
this._frameAlternator=false;// Is set to the boolean not of itself each frame
this._viewportDepth=false;this._mousePos=new $i_5(0,0,0);this._currentViewport=null;// Set in $i_68.js tick(), holds the current rendering viewport
this._currentCamera=null;// Set in $i_68.js tick(), holds the current rendering viewport's camera
this._currentTime=0;// The current engine time
this._globalSmoothing=false;// Determines the default smoothing setting for new textures
this._register={ige:this};// Holds a reference to every item in the scenegraph by it's ID
this._categoryRegister={};// Holds reference to every item with a category
this._groupRegister={};// Holds reference to every item with a group
this._timeSpentInUpdate={};// An object holding time-spent-in-update (total time spent in this object's update method)
this._timeSpentLastUpdate={};// An object holding time-spent-last-update (time spent in this object's update method last tick)
this._timeSpentInTick={};// An object holding time-spent-in-tick (total time spent in this object's tick method)
this._timeSpentLastTick={};// An object holding time-spent-last-tick (time spent in this object's tick method last tick)
this._timeScale=1;// The default time scaling factor to speed up or slow down engine time
this._globalScale=new $i_5(1,1,1);this._graphInstances=[];// Holds an array of instances of graph classes
this._spawnQueue=[];// Holds an array of entities that are yet to be born
this._cullCounter=0;// Set the context to a dummy context to start
// with in case we are in "headless" mode and
// a replacement context never gets assigned
this._ctx=$i_46;this._headless=true;this.dependencyTimeout(30000);// Wait 30 seconds to load all dependencies then timeout
// Add the textures loaded dependency
this._dependencyQueue.push(this.texturesLoaded);// this._dependencyQueue.push(this.canvasReady);
// Start a timer to record every second of execution
this._secondTimer=setInterval(this._secondTick,1000);this.snapshots=[];this.entityCreateSnapshot={};this.prevSnapshot=undefined;this.tempSnapshot=[0,{}];this.nextSnapshot=[0,{}];this.renderTime=0;this.timeDiscrepancy=0;this.remainderFromLastStep=0;this.lagOccurenceCount=0;this.lastLagOccurenceAt=0;},getLifeSpan:function(){var maxLifeSpan=6*60*60*1000;var lifeSpan=ige.server.lifeSpan;if(lifeSpan>maxLifeSpan){lifeSpan=maxLifeSpan;}return lifeSpan;},getIdleTimeoutMs:function(){var defaultValue=5;var idleTimeoutHours=ige.server.tier=='0'?ige.game.data.defaultData.privateServerIdleTimeout:0;var timeoutMins=idleTimeoutHours?idleTimeoutHours*60:defaultValue;return timeoutMins*60*1000;},/**
	 * Returns an object from the engine's object register by
	 * the object's id. If the item passed is not a string id
	 * then the item is returned as is. If no item is passed
	 * the engine itself is returned.
	 * @param {String || Object} item The id of the item to return,
	 * or if an object, returns the object as-is.
	 */$:function(item){if(typeof item==='number'&&!isNaN(item)){item=item.toString();}if(typeof item==='string'){return this._register[item];}else if(typeof item==='object'){return item;}return undefined;// return this;
},/**
	 * Returns an array of all objects that have been assigned
	 * the passed category name.
	 * @param {String} categoryName The name of the category to return
	 * all objects for.
	 */$$:function(categoryName){var returnArray=this._categoryRegister[categoryName]||new $i_75();return returnArray.filter(({_isBeingRemoved})=>{return _isBeingRemoved!=true;});},/**
	 * Returns an array of all objects that have been assigned
	 * the passed group name.
	 * @param {String} groupName The name of the group to return
	 * all objects for.
	 */$$$:function(groupName){return this._groupRegister[groupName]||new $i_75();},/**
	 * Register an object with the engine object register. The
	 * register allows you to access an object by it's id with
	 * a call to ige.$(objectId).
	 * @param {Object} obj The object to register.
	 * @return {*}
	 */register:function(obj){if(obj!==undefined){if(!this._register[obj.id()]){this._register[obj.id()]=obj;obj._registered=true;return this;}else{obj._registered=false;$i_102.prototype.log(`Cannot add object id "${obj.id()}" to scenegraph because there is already another object in the graph with the same ID!`,'error');return false;}}return this._register;},/**
	 * Un-register an object with the engine object register. The
	 * object will no longer be accessible via ige.$().
	 * @param {Object} obj The object to un-register.
	 * @return {*}
	 */unRegister:function(obj){if(obj!==undefined){// Check if the object is registered in the ID lookup
if(this._register[obj.id()]){delete this._register[obj.id()];obj._registered=false;}}return this;},/**
	 * Register an object with the engine category register. The
	 * register allows you to access an object by it's category with
	 * a call to ige.$$(categoryName).
	 * @param {Object} obj The object to register.
	 * @return {*}
	 */categoryRegister:function(obj){if(obj!==undefined){this._categoryRegister[obj._category]=this._categoryRegister[obj._category]||new $i_75();this._categoryRegister[obj._category].push(obj);obj._categoryRegistered=true;}return this._register;},/**
	 * Un-register an object with the engine category register. The
	 * object will no longer be accessible via ige.$$().
	 * @param {Object} obj The object to un-register.
	 * @return {*}
	 */categoryUnRegister:function(obj){if(obj!==undefined){if(this._categoryRegister[obj._category]){this._categoryRegister[obj._category].pull(obj);obj._categoryRegistered=false;}}return this;},/**
	 * Register an object with the engine group register. The
	 * register allows you to access an object by it's groups with
	 * a call to ige.$$$(groupName).
	 * @param {Object} obj The object to register.
	 * @param {String} groupName The name of the group to register
	 * the object in.
	 * @return {*}
	 */groupRegister:function(obj,groupName){if(obj!==undefined){this._groupRegister[groupName]=this._groupRegister[groupName]||new $i_75();this._groupRegister[groupName].push(obj);obj._groupRegistered=true;}return this._register;},/**
	 * Un-register an object with the engine group register. The
	 * object will no longer be accessible via ige.$$$().
	 * @param {Object} obj The object to un-register.
	 * @param {String} groupName The name of the group to un-register
	 * the object from.
	 * @return {*}
	 */groupUnRegister:function(obj,groupName){if(obj!==undefined){if(groupName!==undefined){if(this._groupRegister[groupName]){this._groupRegister[groupName].pull(obj);if(!obj.groupCount()){obj._groupRegister=false;}}}else{// Call the removeAllGroups() method which will loop
// all the groups that the object belongs to and
// automatically un-register them
obj.removeAllGroups();}}return this;},sync:function(method,attrArr){if(typeof attrArr==='string'){attrArr=[attrArr];}this._syncArr=this._syncArr||[];this._syncArr.push({method:method,attrArr:attrArr});if(this._syncArr.length===1){// Start sync waterfall
this._syncIndex=0;this._processSync();}},_processSync:function(){var syncEntry;if(ige._syncIndex<ige._syncArr.length){syncEntry=ige._syncArr[ige._syncIndex];// Add the callback to the last attribute
syncEntry.attrArr.push(function(){ige._syncIndex++;setTimeout(ige._processSync,1);});// Call the method
syncEntry.method.apply(ige,syncEntry.attrArr);}else{// Reached end of sync cycle
delete ige._syncArr;delete ige._syncIndex;ige.emit('syncComplete');}},/**
	 * Load a js script file into memory via a path or url.
	 * @param {String} url The file's path or url.
	 * @param {Function=} callback Optional callback when script loads.
	 */requireScript:function(url,callback){if(url!==undefined){var self=this;// Add to the load counter
self._requireScriptTotal++;self._requireScriptLoading++;// Create the script element
var elem=document.createElement('script');elem.addEventListener('load',function(){self._requireScriptLoaded(this);if(callback){setTimeout(function(){callback();},100);}});// For compatibility with CocoonJS
document.body.appendChild(elem);// Set the source to load the url
elem.src=url;$i_102.prototype.log(`Loading script from: ${url}`);this.emit('requireScriptLoading',url);}},/**
	 * Called when a js script has been loaded via the requireScript
	 * method.
	 * @param {Element} elem The script element added to the DOM.
	 * @private
	 */_requireScriptLoaded:function(elem){this._requireScriptLoading--;this.emit('requireScriptLoaded',elem.src);if(this._requireScriptLoading===0){// All scripts have loaded, fire the engine event
this.emit('allRequireScriptsLoaded');}},/**
	 * Load a css style file into memory via a path or url.
	 * @param {String} url The file's path or url.
	 */requireStylesheet:function(url){if(url!==undefined){var self=this;// Load the engine stylesheet
var css=document.createElement('link');css.rel='stylesheet';css.type='text/css';css.media='all';css.href=url;document.getElementsByTagName('head')[0].appendChild(css);$i_102.prototype.log(`Load css stylesheet from: ${url}`);}},/**
	 * Adds a scenegraph class into memory.
	 * @param {String} className The name of the scenegraph class.
	 * @param {Object=} options Optional object to pass to the scenegraph class graph() method.
	 * @returns {*}
	 */addGraph:function(className,options){if(className!==undefined){var classObj=this.getClass(className);var classInstance;if(classObj){$i_102.prototype.log(`Loading SceneGraph data class: ${className}`);classInstance=this.newClassInstance(className);// Make sure the graph class implements the required methods "addGraph" and "removeGraph"
if(typeof classInstance.addGraph==='function'&&typeof classInstance.removeGraph==='function'){// Call the class's graph() method passing the options in
classInstance.addGraph(options);// Add the graph instance to the holding array
this._graphInstances[className]=classInstance;}else{$i_102.prototype.log(`Could not load graph for class name "${className}" because the class does not implement both the require methods "addGraph()" and "removeGraph()".`,'error');}}else{$i_102.prototype.log(`Cannot load graph for class name "${className}" because the class could not be found. Have you included it in your server/clientConfig.js file?`,'error');}}return this;},/**
	 * Removes a scenegraph class into memory.
	 * @param {String} className The name of the scenegraph class.
	 * @param {Object=} options Optional object to pass to the scenegraph class graph() method.
	 * @returns {*}
	 */removeGraph:function(className,options){if(className!==undefined){var classInstance=this._graphInstances[className];if(classInstance){$i_102.prototype.log(`Removing SceneGraph data class: ${className}`);// Call the class's graph() method passing the options in
classInstance.removeGraph(options);// Now remove the graph instance from the graph instance array
delete this._graphInstances[className];}else{$i_102.prototype.log(`Cannot remove graph for class name "${className}" because the class instance could not be found. Did you add it via ige.addGraph() ?`,'error');}}return this;},/**
	 * Allows the update() methods of the entire scenegraph to
	 * be temporarily enabled or disabled. Useful for debugging.
	 * @param {Boolean=} val If false, will disable all update() calls.
	 * @returns {*}
	 */enableUpdates:function(val){if(val!==undefined){this._enableUpdates=val;return this;}return this._enableUpdates;},/**
	 * Allows the tick() methods of the entire scenegraph to
	 * be temporarily enabled or disabled. Useful for debugging.
	 * @param {Boolean=} val If false, will disable all tick() calls.
	 * @returns {*}
	 */enableRenders:function(val){if(val!==undefined){this._enableRenders=val;return this;}return this._enableRenders;},/**
	 * Enables or disables the engine's debug mode. Enabled by default.
	 * @param {Boolean=} val If true, will enable debug mode.
	 * @returns {*}
	 */debugEnabled:function(val){if(val!==undefined){if(igeConfig.debug){igeConfig.debug._enabled=val;}return this;}return igeConfig.debug._enabled;},/**
	 * Enables or disables the engine's debug timing system. The
	 * timing system will time all update and rendering code down
	 * the scenegraph and is useful for tracking long-running code
	 * but comes with a small performance penalty when enabled.
	 * Enabled by default.
	 * @param {Boolean=} val If true, will enable debug timing mode.
	 * @returns {*}
	 */debugTiming:function(val){if(val!==undefined){if(igeConfig.debug){igeConfig.debug._timing=val;}return this;}return igeConfig.debug._timing;},debug:function(eventName){if(this._debugEvents[eventName]===true||this._debugEvents[eventName]===ige._frames){debugger;}},debugEventOn:function(eventName){this._debugEvents[eventName]=true;},debugEventOff:function(eventName){this._debugEvents[eventName]=false;},triggerDebugEventFrame:function(eventName){this._debugEvents[eventName]=ige._frames;},/**
	 * Sets the opacity of every object on the scenegraph to
	 * zero *except* the one specified by the given id argument.
	 * @param {String} id The id of the object not to hide.
	 */hideAllExcept:function(id){var i;var arr=this._register;for(i in arr){if(i!==id){arr[i].opacity(0);}}},/**
	 * Calls the show() method for every object on the scenegraph.
	 */showAll:function(){var i;var arr=this._register;for(i in arr){arr[i].show();}},/**
	 * Sets the frame rate at which new engine steps are fired.
	 * Setting this rate will override the default requestAnimFrame()
	 * method as defined in $i_1.js and on the client-side, will
	 * stop usage of any available requestAnimationFrame() method
	 * and will use a setTimeout()-based version instead.
	 * @param {Number} fpsRate
	 */setFps:function(fpsRate){var self=this;this._fpsRate=fpsRate;fpsRate=60;console.log('Tick rate at ',fpsRate);if(fpsRate!==undefined){// Override the default requestAnimFrame handler and set
// our own method up so that we can control the frame rate
if(this.isServer){// Server-side implementation
requestAnimFrame=function(callback,element){setTimeout(function(){callback(new Date().getTime());},1000/fpsRate);};}else{// Client-side implementation
window.requestAnimFrame=function(callback,element){if(typeof mode==='string'&&mode==='sandbox'){fpsRate=20;}setTimeout(function(){callback(new Date().getTime());},1000/fpsRate);// client will always run at 60 fps.
};}}},showStats:function(){$i_102.prototype.log('showStats has been removed from the ige in favour of the new editor component, please remove this call from your code.');},/**
	 * Defines a class in the engine's class repository.
	 * @param {String} id The unique class ID or name.
	 * @param {Object} obj The class definition.
	 */defineClass:function(id,obj){igeClassStore[id]=obj;},/**
	 * Retrieves a class by it's ID that was defined with
	 * a call to defineClass().
	 * @param {String} id The ID of the class to retrieve.
	 * @return {Object} The class definition.
	 */getClass:function(id){return igeClassStore[id];},/**
	 * Returns true if the class specified has been defined.
	 * @param {String} id The ID of the class to check for.
	 * @returns {*}
	 */classDefined:function(id){return Boolean(igeClassStore[id]);},/**
	 * Generates a new instance of a class defined with a call
	 * to the defineClass() method. Passes the options
	 * parameter to the new class during it's constructor call.
	 * @param id
	 * @param options
	 * @return {*}
	 */newClassInstance:function(id,options){return new igeClassStore[id](options);},/**
	 * Checks if all engine start dependencies have been satisfied.
	 * @return {Boolean}
	 */dependencyCheck:function(){var arr=this._dependencyQueue;var arrCount=arr.length;while(arrCount--){if(!this._dependencyQueue[arrCount]()){return false;}}return true;},/**
	 * Gets / sets the flag that determines if viewports should be sorted by depth
	 * like regular entities, before they are processed for rendering each frame.
	 * Depth-sorting viewports increases processing requirements so if you do not
	 * need to stack viewports in a particular order, keep this flag false.
	 * @param {Boolean} val
	 * @return {Boolean}
	 */viewportDepth:function(val){if(val!==undefined){this._viewportDepth=val;return this;}return this._viewportDepth;},/**
	 * Sets the number of milliseconds before the engine gives up waiting for dependencies
	 * to be satisfied and cancels the startup procedure.
	 * @param val
	 */dependencyTimeout:function(val){this._dependencyCheckTimeout=val;},/**
	 * Updates the loading screen DOM elements to show the update progress.
	 */updateProgress:function(){// Check for a loading progress bar DOM element
if(typeof document!=='undefined'&&document.getElementById){var elem=document.getElementById('loadingProgressBar');var textElem=document.getElementById('loadingText');if(elem){// Calculate the width from progress
var totalWidth=parseInt(elem.parentNode.offsetWidth);var currentWidth=Math.floor(totalWidth/this._texturesTotal*(this._texturesTotal-this._texturesLoading));// Set the current bar width
elem.style.width=`${currentWidth}px`;if(textElem){if(this._loadingPreText===undefined){// Fill the text to use
this._loadingPreText=textElem.innerHTML;}textElem.innerHTML=`${this._loadingPreText} ${Math.floor(100/this._texturesTotal*(this._texturesTotal-this._texturesLoading))}%`;}}}},/**
	 * Adds one to the number of textures currently loading.
	 */textureLoadStart:function(url,textureObj){this._texturesLoading++;this._texturesTotal++;this.updateProgress();this.emit('textureLoadStart',textureObj);},/**
	 * Subtracts one from the number of textures currently loading and if no more need
	 * to load, it will also call the _allTexturesLoaded() method.
	 */textureLoadEnd:function(url,textureObj){var self=this;if(!textureObj._destroyed){// Add the texture to the _textureStore array
this._textureStore.push(textureObj);}// Decrement the overall loading number
this._texturesLoading--;console.log('texture load remaining',this._texturesLoading);this.updateProgress();this.emit('textureLoadEnd',textureObj);// If we've finished...
if(this._texturesLoading===0){// All textures have finished loading
this.updateProgress();setTimeout(function(){console.log('all textures loaded (why is this being called twice?)');self._allTexturesLoaded();},100);}},/**
	 * Returns a texture from the texture store by it's url.
	 * @param {String} url
	 * @return {$i_50}
	 */textureFromUrl:function(url){var arr=this._textureStore;var arrCount=arr.length;var item;while(arrCount--){item=arr[arrCount];if(item._url===url){return item;}}},/**
	 * Checks if all textures have finished loading and returns true if so.
	 * @return {Boolean}
	 */texturesLoaded:function(){return ige._texturesLoading===0;},/**
	 * Emits the "texturesLoaded" event.
	 * @private
	 */_allTexturesLoaded:function(){if(!this._loggedATL){this._loggedATL=true;$i_102.prototype.log('All textures have loaded');}// Fire off an event about this
this.emit('texturesLoaded');},/**
	 * Gets / sets the default smoothing value for all new
	 * $i_50 class instances. If set to true, all newly
	 * created textures will have smoothing enabled by default.
	 * @param val
	 * @return {*}
	 */globalSmoothing:function(val){if(val!==undefined){this._globalSmoothing=val;return this;}return this._globalSmoothing;},/**
	 * Checks to ensure that a canvas has been assigned to the engine or that the
	 * engine is in server mode.
	 * @return {Boolean}
	 */canvasReady:function(){return ige._canvas!==undefined||ige.isServer;},/**
	 * Generates a new unique ID
	 * @return {String}
	 */newId:function(){this._idCounter++;return String(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)));},/**
	 * Generates a new 8-character hexadecimal unique ID
	 * @return {String}
	 */newIdHex:function(){this._idCounter++;// return 'e' + this._idCounter;
return(this._idCounter+(Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17)+Math.random()*Math.pow(10,17))).toString(16).slice(0,8);},/**
	 * Generates a new 16-character hexadecimal ID based on
	 * the passed string. Will always generate the same ID
	 * for the same string.
	 * @param {String} str A string to generate the ID from.
	 * @return {String}
	 */newIdFromString:function(str){if(str!==undefined){var id;var val=0;var count=str.length;var i;for(i=0;i<count;i++){val+=str.charCodeAt(i)*Math.pow(10,17);}id=val.toString(16);// Check if the ID is already in use
while(ige.$(id)){val+=Math.pow(10,17);id=val.toString(16);}return id;}},/**
	 * Starts the engine.
	 * @param callback
	 */start:function(callback){if(!ige._state){// Check if we are able to start based upon any registered dependencies
if(ige.dependencyCheck()){// Start the engine
$i_102.prototype.log('Starting engine...');ige._state=1;// Check if we have a DOM, that there is an igeLoading element
// and if so, remove it from the DOM now
if(this.isClient){if(document.getElementsByClassName&&document.getElementsByClassName('igeLoading')){var arr=document.getElementsByClassName('igeLoading');var arrCount=arr.length;while(arrCount--){arr[arrCount].parentNode.removeChild(arr[arrCount]);}}}if(ige.isServer){this.emptyTimeLimit=this.getIdleTimeoutMs();requestAnimFrame(ige.engineStep);}$i_102.prototype.log('Engine started');// Fire the callback method if there was one
if(typeof callback==='function'){callback(true);}}else{// Get the current timestamp
var curTime=new Date().getTime();// Record when we first started checking for dependencies
if(!ige._dependencyCheckStart){ige._dependencyCheckStart=curTime;}// Check if we have timed out
if(curTime-ige._dependencyCheckStart>this._dependencyCheckTimeout){$i_102.prototype.log(`Engine start failed because the dependency check timed out after ${this._dependencyCheckTimeout/1000} seconds`,'error');if(typeof callback==='function'){callback(false);}}else{// Start a timer to keep checking dependencies
setTimeout(function(){ige.start(callback);},200);}}}},/**
	 * Stops the engine.
	 * @return {Boolean}
	 */stop:function(){// If we are running, stop the engine
if(this._state){console.trace();$i_102.prototype.log('Stopping engine...');this._state=0;return true;}else{return false;}},/**
	 * Gets / sets the _autoSize property. If set to true, the engine will listen
	 * for any change in screen size and resize the front-buffer (canvas) element
	 * to match the new screen size.
	 * @param val
	 * @return {Boolean}
	 */autoSize:function(val){if(val!==undefined){this._autoSize=val;return this;}return this._autoSize;},pixelRatioScaling:function(val){if(val!==undefined){this._pixelRatioScaling=val;return this;}return this._pixelRatioScaling;},/**
	 * Gets / sets the rendering context that will be used when getting the
	 * context from canvas elements.
	 * @param {String=} contextId The context such as '2d'. Defaults to '2d'.
	 * @return {*}
	 */renderContext:function(contextId){if(contextId!==undefined){this._renderContext=contextId;this._renderMode=this._renderModes[contextId];$i_102.prototype.log(`Rendering mode set to: ${contextId}`);return this;}return this._renderContext;},/**
	 * Creates a front-buffer or "drawing surface" for the renderer.
	 *
	 * @param {Boolean} autoSize Determines if the canvas will auto-resize
	 * when the browser window changes dimensions. If true the canvas will
	 * automatically fill the window when it is resized.
	 *
	 * @param {Boolean=} dontScale If set to true, IGE will ignore device
	 * pixel ratios when setting the width and height of the canvas and will
	 * therefore not take into account "retina", high-definition displays or
	 * those whose pixel ratio is different from 1 to 1.
	 */createFrontBuffer:function(autoSize,dontScale){var self=this;if(this.isClient){if(!this._canvas){this._createdFrontBuffer=true;this._pixelRatioScaling=!dontScale;this._frontBufferSetup(autoSize,dontScale);}}},_frontBufferSetup:function(autoSize,dontScale){// Create a new canvas element to use as the
// rendering front-buffer
if(ige.isServer){// var tempCanvas = document.createElement('canvas');
// tempCanvas.id = 'igeFrontBuffer';
this.canvas(tempCanvas,autoSize);document.getElementById('game-div').appendChild(tempCanvas);}else{var tempCanvas=document.getElementById('igeFrontBuffer');this.canvas(tempCanvas,autoSize);}// Set the canvas element id
},/**
	 * Sets the canvas element that will be used as the front-buffer.
	 * @param elem The canvas element.
	 * @param autoSize If set to true, the engine will automatically size
	 * the canvas to the width and height of the window upon window resize.
	 */getCtx:function(){var alpha=true;if(ige.isClient&&ige.client){alpha=ige.client.ctxAlphaEnabled;}var contex=this._canvas.getContext('webgl2',{alpha:alpha})||this._canvas.getContext('webgl',{alpha:alpha})||this._canvas.getContext('2d',{alpha:alpha});this._ctx=contex.canvas;},canvas:function(elem,autoSize){if(elem!==undefined){if(!this._canvas){// Setup front-buffer canvas element
this._canvas=elem;this.getCtx();// Handle pixel ratio settings
if(this._pixelRatioScaling){// Support high-definition devices and "retina" (stupid marketing name)
// displays by adjusting for device and back store pixels ratios
this._devicePixelRatio=window.devicePixelRatio||1;this._backingStoreRatio=this._ctx.webkitBackingStorePixelRatio||this._ctx.mozBackingStorePixelRatio||this._ctx.msBackingStorePixelRatio||this._ctx.oBackingStorePixelRatio||this._ctx.backingStorePixelRatio||1;this._deviceFinalDrawRatio=this._devicePixelRatio/this._backingStoreRatio;}else{// No auto-scaling
this._devicePixelRatio=1;this._backingStoreRatio=1;this._deviceFinalDrawRatio=1;}if(autoSize){this._autoSize=autoSize;}// Add some event listeners even if autosize is off
window.addEventListener('resize',this._resizeEvent);// Fire the resize event for the first time
// which sets up initial canvas dimensions
this._resizeEvent();this.getCtx();this._headless=false;// Ask the input component to setup any listeners it has
this.input.setupListeners(this._canvas);}}return this._canvas;},/**
	 * Clears the entire canvas.
	 */clearCanvas:function(){if(this._ctx){// Clear the whole canvas
this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height);}},/**
	 * Removes the engine's canvas from the DOM.
	 */removeCanvas:function(){// Stop listening for input events
if(this.input){this.input.destroyListeners();}// Remove event listener
window.removeEventListener('resize',this._resizeEvent);if(this._createdFrontBuffer){// Remove the canvas from the DOM
document.body.removeChild(this._canvas);}// Clear internal references
delete this._canvas;delete this._ctx;this._ctx=$i_46;this._headless=true;},/**
	 * Opens a new window to the specified url. When running in a
	 * native wrapper, will load the url in place of any existing
	 * page being displayed in the native web view.
	 * @param url
	 */openUrl:function(url){if(url!==undefined){if(ige.cocoonJs&&ige.cocoonJs.detected){// Open URL via CocoonJS webview
ige.cocoonJs.openUrl(url);}else{// Open via standard JS open window
window.open(url);}}},/**
	 * Loads the specified URL as an HTML overlay on top of the
	 * front buffer in an iFrame. If running in a native wrapper,
	 * will load the url in place of any existing page being
	 * displayed in the native web view.
	 *
	 * When the overlay is in use, no mouse or touch events will
	 * be fired on the front buffer. Once you are finished with the
	 * overlay, call hideOverlay() to re-enable interaction with
	 * the front buffer.
	 * @param {String=} url
	 */showWebView:function(url){if(ige.cocoonJs&&ige.cocoonJs.detected){// Open URL via CocoonJS webview
ige.cocoonJs.showWebView(url);}else{// Load the iFrame url
var overlay=document.getElementById('igeOverlay');if(!overlay){// No overlay was found, create one
overlay=document.createElement('iframe');// Setup overlay styles
overlay.id='igeOverlay';overlay.style.position='absolute';overlay.style.border='none';overlay.style.left='0px';overlay.style.top='0px';overlay.style.width='100%';overlay.style.height='100%';// Append overlay to body
document.body.appendChild(overlay);}// If we have a url, set it now
if(url!==undefined){overlay.src=url;}// Show the overlay
overlay.style.display='block';}return this;},/**
	 * Hides the web view overlay.
	 * @return {*}
	 */hideWebView:function(){if(ige.cocoonJs&&ige.cocoonJs.detected){// Hide the cocoonJS webview
ige.cocoonJs.hideWebView();}else{var overlay=document.getElementById('igeOverlay');if(overlay){overlay.style.display='none';}}return this;},/**
	 * Evaluates javascript sent from another frame.
	 * @param js
	 */layerCall:function(js){if(js!==undefined){eval(js);}},/**
	 * Returns the mouse position relative to the main front buffer. Mouse
	 * position is set by the ige.input component ($i_14)
	 * @return {$i_5}
	 */mousePos:function(){return this._mousePos.clone();},/**
	 * Walks the scenegraph and returns an array of all entities that the mouse
	 * is currently over, ordered by their draw order from drawn last (above other
	 * entities) to first (underneath other entities).
	 */mouseOverList:function(obj,entArr){var arr;var arrCount;var mp;var mouseTriggerPoly;var first=false;if(!obj){obj=ige;entArr=[];first=true;}if(obj===ige){// Loop viewports
arr=obj._children;if(arr){arrCount=arr.length;// Loop our children
while(arrCount--){if(arr[arrCount]._scene){if(arr[arrCount]._scene._shouldRender){this.mouseOverList(arr[arrCount]._scene,entArr);}}}}}else{// Check if the mouse is over this entity
mp=this.mousePosWorld();if(mp&&obj.aabb){// Trigger mode is against the AABB
mouseTriggerPoly=obj.aabb();// this.localAabb();
// Check if the current mouse position is inside this aabb
if(mouseTriggerPoly.xyInside(mp.x,mp.y)){entArr.push(obj);}}// Check if the entity has children
arr=obj._children;if(arr){arrCount=arr.length;// Loop our children
while(arrCount--){this.mouseOverList(arr[arrCount],entArr);}}}if(first){entArr.reverse();}return entArr;},/**
	 * Handles the screen resize event.
	 * @param event
	 * @private
	 */_resizeEvent:function(event){var canvasBoundingRect;if(ige.isClient)return;if(ige._autoSize){var newWidth=window.innerWidth;var newHeight=window.innerHeight;var arr=ige._children;var arrCount=arr.length;// Only update canvas dimensions if it exists
if(ige._canvas){// Check if we can get the position of the canvas
canvasBoundingRect=ige._canvasPosition();// Adjust the newWidth and newHeight by the canvas offset
newWidth-=parseInt(canvasBoundingRect.left);newHeight-=parseInt(canvasBoundingRect.top);// Make sure we can divide the new width and height by 2...
// otherwise minus 1 so we get an even number so that we
// negate the blur effect of sub-pixel rendering
if(newWidth%2){newWidth--;}if(newHeight%2){newHeight--;}if(ige.client&&ige.client.resolutionQuality==='low'){ige._canvas.width=newWidth*ige._deviceFinalDrawRatio/2;ige._canvas.height=newHeight*ige._deviceFinalDrawRatio/2;ige._bounds2d=new $i_5(newWidth/2,newHeight/2,0);}else{ige._canvas.width=newWidth*ige._deviceFinalDrawRatio;ige._canvas.height=newHeight*ige._deviceFinalDrawRatio;ige._bounds2d=new $i_5(newWidth,newHeight,0);}if(ige._deviceFinalDrawRatio!==1||ige.client&&ige.client.resolutionQuality==='low'){ige._canvas.style.width=`${newWidth}px`;ige._canvas.style.height=`${newHeight}px`;// Scale the canvas context to account for the change
ige._ctx.scale(ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio);}}// ige._bounds2d = new $i_5(newWidth, newHeight, 0);
// Loop any mounted children and check if
// they should also get resized
while(arrCount--){arr[arrCount]._resizeEvent(event);}}else{if(ige._canvas){if(ige.isClient&&ige.client.scaleMode>0){if(ige.client.scaleMode==1||ige.client.scaleMode==3){// stretch
var newWidth=window.innerWidth;var newHeight=window.innerHeight;// fit
if(ige.client.scaleMode==1){var aspectWindow=window.innerWidth/window.innerHeight;var aspectResolution=$('#igeFrontBuffer').attr('width')/$('#igeFrontBuffer').attr('height');if(aspectWindow>=aspectResolution){newWidth=newHeight*aspectResolution;}else{newHeight=newWidth/aspectResolution;}}// Check if we can get the position of the canvas
canvasBoundingRect=ige._canvasPosition();// Adjust the newWidth and newHeight by the canvas offset
newWidth-=parseInt(canvasBoundingRect.left);newHeight-=parseInt(canvasBoundingRect.top);// Make sure we can divide the new width and height by 2...
// otherwise minus 1 so we get an even number so that we
// negate the blur effect of sub-pixel rendering
if(newWidth%2){newWidth--;}if(newHeight%2){newHeight--;}// ige._canvas.width = newWidth * ige._deviceFinalDrawRatio;
// ige._canvas.height = newHeight * ige._deviceFinalDrawRatio;
// if (ige._deviceFinalDrawRatio !== 1) {
ige._canvas.style.width=`${newWidth}px`;ige._canvas.style.height=`${newHeight}px`;// Scale the canvas context to account for the change
ige._ctx.scale(ige._deviceFinalDrawRatio,ige._deviceFinalDrawRatio);// }
}}else{var w=$('#igeFrontBuffer').attr('width');var h=$('#igeFrontBuffer').attr('height');ige._canvas.style.width=`${w}px`;ige._canvas.style.height=`${h}px`;}ige._bounds2d=new $i_5(ige._canvas.width,ige._canvas.height,0);}}if(ige._showSgTree){var sgTreeElem=document.getElementById('igeSgTree');canvasBoundingRect=ige._canvasPosition();sgTreeElem.style.top=`${parseInt(canvasBoundingRect.top)+5}px`;sgTreeElem.style.left=`${parseInt(canvasBoundingRect.left)+5}px`;sgTreeElem.style.height=`${ige._bounds2d.y-30}px`;}ige._resized=true;},scaleMap:function(map){// return map;
var gameMap=_.cloneDeep(map);// ige.game.data.defaultData.dontResize ||
if(ige.game.data.defaultData.dontResize){ige.scaleMapDetails={scaleFactor:{x:1,y:1},shouldScaleTilesheet:false,tileWidth:gameMap.tilewidth,tileHeight:gameMap.tileheight,originalTileHeight:gameMap.tileheight,originalTileWidth:gameMap.tilewidth};}else{gameMap.originalTileWidth=gameMap.tilewidth;gameMap.originalTileHeight=gameMap.tileheight;ige.scaleMapDetails={scaleFactor:{x:64/gameMap.originalTileWidth,y:64/gameMap.originalTileHeight},originalTileHeight:gameMap.originalTileHeight,originalTileWidth:gameMap.originalTileWidth,tileWidth:64,tileHeight:64,shouldScaleTilesheet:false};// if (ige.isClient) {
// 	ige.scaleMapDetails.tileWidth = gameMap.tilewidth;
// 	ige.scaleMapDetails.tileHeight = gameMap.tileheight;
// } else {
// 	gameMap.tilewidth = 64;
// 	gameMap.tileheight = 64;
// }
if(ige.scaleMapDetails.scaleFactor.x!==1||ige.scaleMapDetails.scaleFactor.y!==1){ige.scaleMapDetails.shouldScaleTilesheet=true;}}return gameMap;},/**
	 * Gets the bounding rectangle for the HTML canvas element being
	 * used as the front buffer for the engine. Uses DOM methods.
	 * @returns {ClientRect}
	 * @private
	 */_canvasPosition:function(){try{return ige._canvas.getBoundingClientRect();}catch(e){return{top:ige._canvas.offsetTop,left:ige._canvas.offsetLeft};}},/**
	 * Toggles full-screen output of the main ige canvas. Only works
	 * if called from within a user-generated HTML event listener.
	 */toggleFullScreen:function(){var elem=this._canvas;if(elem.requestFullscreen){elem.requestFullscreen();}else if(elem.mozRequestFullScreen){elem.mozRequestFullScreen();}else if(elem.webkitRequestFullscreen){elem.webkitRequestFullscreen();}},/**
	 * Adds a new watch expression to the watch list which will be
	 * displayed in the stats overlay during a call to _statsTick().
	 * @param {*} evalStringOrObject The expression to evaluate and
	 * display the result of in the stats overlay, or an object that
	 * contains a "value" property.
	 * @returns {Integer} The index of the new watch expression you
	 * just added to the watch array.
	 */watchStart:function(evalStringOrObject){this._watch=this._watch||[];this._watch.push(evalStringOrObject);return this._watch.length-1;},/**
	 * Removes a watch expression by it's array index.
	 * @param {Number} index The index of the watch expression to
	 * remove from the watch array.
	 */watchStop:function(index){this._watch=this._watch||[];this._watch.splice(index,1);},/**
	 * Sets a trace up on the setter of the passed object's
	 * specified property. When the property is set by any
	 * code the debugger line is activated and code execution
	 * will be paused allowing you to step through code or
	 * examine the call stack to see where the property set
	 * originated.
	 * @param {Object} obj The object whose property you want
	 * to trace.
	 * @param {String} propName The name of the property you
	 * want to put the trace on.
	 * @param {Number} sampleCount The number of times you
	 * want the trace to break with the debugger line before
	 * automatically switching off the trace.
	 * @param {Function=} callbackEvaluator Optional callback
	 * that if returns true, will fire debugger. Method is passed
	 * the setter value as first argument.
	 */traceSet:function(obj,propName,sampleCount,callbackEvaluator){obj.___igeTraceCurrentVal=obj.___igeTraceCurrentVal||{};obj.___igeTraceCurrentVal[propName]=obj[propName];obj.___igeTraceMax=sampleCount||1;obj.___igeTraceCount=0;Object.defineProperty(obj,propName,{get:function(){return obj.___igeTraceCurrentVal[propName];},set:function(val){if(callbackEvaluator){if(callbackEvaluator(val)){debugger;}}else{debugger;}obj.___igeTraceCurrentVal[propName]=val;obj.___igeTraceCount++;if(obj.___igeTraceCount===obj.___igeTraceMax){// Maximum amount of trace samples reached, turn off
// the trace system
ige.traceSetOff(obj,propName);}}});},/**
	 * Turns off a trace that was created by calling traceSet.
	 * @param {Object} object The object whose property you want
	 * to disable a trace against.
	 * @param {String} propName The name of the property you
	 * want to disable the trace for.
	 */traceSetOff:function(object,propName){Object.defineProperty(object,propName,{set:function(val){this.___igeTraceCurrentVal[propName]=val;}});},/**
	 * Finds the first Ige* based class that the passed object
	 * has been derived from.
	 * @param obj
	 * @return {*}
	 */findBaseClass:function(obj){if(obj&&obj._classId){if(obj._classId.substr(0,3)==='Ige'){return obj._classId;}else{if(obj.__proto__._classId){return this.findBaseClass(obj.__proto__);}else{return'';}}}else{return'';}},/**
	 * Returns an array of all classes the passed object derives from
	 * in order from current to base.
	 * @param obj
	 * @param arr
	 * @return {*}
	 */getClassDerivedList:function(obj,arr){if(!arr){arr=[];}else{if(obj._classId){arr.push(obj._classId);}}if(obj.__proto__._classId){this.getClassDerivedList(obj.__proto__,arr);}return arr;},spawnQueue:function(ent){if(ent!==undefined){this._spawnQueue.push(ent);return this;}return this._spawnQueue;},/**
	 * Is called every second and does things like calculate the current FPS.
	 * @private
	 */_secondTick:function(){var self=ige;// Store frames per second
self._renderFPS=self._renderFrames;self._physicsFPS=self._physicsFrames;// Store draws per second
self._dps=self._dpf*self._renderFPS;if(ige.isClient)$('#updatefps').html(self._renderFPS);// Zero out counters
self._renderFrames=0;self._physicsFrames=0;self._drawCount=0;},/**
	 * Gets / sets the current time scalar value. The engine's internal
	 * time is multiplied by this value and it's default is 1. You can set it to
	 * 0.5 to slow down time by half or 1.5 to speed up time by half. Negative
	 * values will reverse time but not all engine systems handle this well
	 * at the moment.
	 * @param {Number=} val The time scale value.
	 * @returns {*}
	 */timeScale:function(val){if(val!==undefined){this._timeScale=val;return this;}return this._timeScale;},/**
	 * Increments the engine's internal time by the passed number of milliseconds.
	 * @param {Number} val The number of milliseconds to increment time by.
	 * @param {Number=} lastVal The last internal time value, used to calculate
	 * delta internally in the method.
	 * @returns {Number}
	 */incrementTime:function(){var now=Date.now();// console.log("increment time", this._currentTime, now, this._timeScaleLastTimestamp, (now - this._timeScaleLastTimestamp))
this._currentTime=(now+this.timeDiscrepancy)*this._timeScale;this.renderTime=this._currentTime-100;// this.incrementCount++;
// if (now - this._aSecondAgo > 1000) {
// 	console.log((this._currentTime - this.lastIncrementAt), this.incrementCount, (this._currentTime - this.lastIncrementAt) / this.incrementCount)
// 	this._aSecondAgo = Date.now();
// 	this.incrementCount = 0
// 	this.lastIncrementAt = this._currentTime
// }
return this._currentTime;},/**
	 * Get the current time from the engine.
	 * @return {Number} The current time.
	 */currentTime:function(){return this._currentTime;},/**
	 * Gets / sets the pause flag. If set to true then the engine's
	 * internal time will no longer increment and will instead stay static.
	 * @param val
	 * @returns {*}
	 */pause:function(val){if(val!==undefined){this._pause=val;return this;}return this._pause;},/**
	 * Gets / sets the option to determine if the engine should
	 * schedule it's own ticks or if you want to manually advance
	 * the engine by calling tick when you wish to.
	 * @param {Boolean=} val
	 * @return {*}
	 */useManualTicks:function(val){if(val!==undefined){this._useManualTicks=val;return this;}return this._useManualTicks;},/**
	 * Schedules a manual tick.
	 */manualTick:function(){if(this._manualFrameAlternator!==this._frameAlternator){this._manualFrameAlternator=this._frameAlternator;requestAnimFrame(this.engineStep);}},/**
	 * Gets / sets the option to determine if the engine should
	 * render on every tick or wait for a manualRender() call.
	 * @param {Boolean=} val True to enable manual rendering, false
	 * to disable.
	 * @return {*}
	 */useManualRender:function(val){if(val!==undefined){this._useManualRender=val;return this;}return this._useManualRender;},/**
	 * Manually render a frame on demand. This is used in conjunction
	 * with the ige.useManualRender(true) call which will cause the
	 * engine to only render new graphics frames from the scenegraph
	 * once this method is called. You must call this method every time
	 * you wish to update the graphical output on screen.
	 *
	 * Calling this method multiple times during a single engine tick
	 * will NOT make it draw more than one frame, therefore it is safe
	 * to call multiple times if required by different sections of game
	 * logic without incurring extra rendering cost.
	 */manualRender:function(){this._manualRender=true;},// snapshot mechanism, UnderConstruction
updateCreateEntitySnapshot:function(){var allEntities=ige.$('baseScene')._children;if(allEntities){for(var i=0;i<allEntities.length;i++){var entity=allEntities[i];ige.entityCreateSnapshot[entity._id]=[entity.classId(),entity.id(),entity._parent.id(),entity._streamSectionData,entity.streamCreateData()];}}},sendEntityCreateSnapshot:function(clientId){this.updateCreateEntitySnapshot();for(var entityId in ige.entityCreateSnapshot){if(!ige.network.stream._streamClientCreated)ige.network.stream._streamClientCreated={};if(!ige.network.stream._streamClientCreated[entityId])ige.network.stream._streamClientCreated[entityId]={};ige.network.stream._streamClientCreated[entityId][clientId]=true;}ige.network.send('_igeStreamCreateSnapshot',ige.entityCreateSnapshot,clientId);},/**
	 * Called each frame to traverse and render the scenegraph.
	 */engineStep:function(timeStamp,ctx){if(ige.isClient){if(statsPanels.ms){statsPanels.ms.begin();statsPanels.fps.begin();}}/* TODO:
			Make the scenegraph process simplified. Walk the scenegraph once and grab the order in a flat array
			then process updates and ticks. This will also allow a layered rendering system that can render the
			first x number of entities then stop, allowing a step through of the renderer in realtime.
		 */var st;var et;var updateStart;var renderStart;var self=ige;var unbornQueue;var unbornCount;var unbornIndex;var unbornEntity;ige.incrementTime();timeStamp=Math.floor(self._currentTime);if(self._state){// Call the input system tick to reset any flags etc
self.input.tick();// Check if we were passed a context to work with
if(ctx===undefined){ctx=self._ctx;}// Alternate the boolean frame alternator flag
self._frameAlternator=!self._frameAlternator;// If the engine is not in manual tick mode...
if(!ige._useManualTicks){// Schedule a new frame
if(ige.isServer){requestAnimFrame(self.engineStep);}}else{self._manualFrameAlternator=!self._frameAlternator;}// Get the current time in milliseconds
self._tickStart=timeStamp;if(!self.lastTick){// This is the first time we've run so set some
// default values and set the delta to zero
self.lastTick=0;self._tickDelta=0;}else{// Calculate the frame delta
self._tickDelta=self._tickStart-self.lastTick;// console.log("wtf tick", self._tickStart, self.lastTick, self._tickDelta)
}ige.now=Date.now();timeElapsed=ige.now-ige._lastGameLoopTickAt;if(timeElapsed>=1000/ige._gameLoopTickRate-ige._gameLoopTickRemainder){ige._lastGameLoopTickAt=ige.now;ige._gameLoopTickRemainder=Math.min(timeElapsed-(1000/ige._gameLoopTickRate-ige._gameLoopTickRemainder),1000/ige._gameLoopTickRate);ige.gameLoopTickHasExecuted=true;}var timeElapsed=ige.now-ige._lastPhysicsTickAt;if(// physics update should execute as soon as gameloop has executed in order to stream the accurate, latest translation data computed from physics update
ige.physics&&(ige.gameLoopTickHasExecuted||// don't ask. - Jaeyun
timeElapsed>=1000/ige._physicsTickRate-ige._physicsTickRemainder)){ige._lastPhysicsTickAt=ige.now;ige._physicsTickRemainder=Math.min(timeElapsed-(1000/ige._physicsTickRate-ige._physicsTickRemainder),1000/ige._physicsTickRate);ige.physics.update(timeElapsed);ige.physicsTickHasExecuted=true;}if(ige.isServer){if(ige.gameLoopTickHasExecuted)ige.trigger.fire('frameTick');}else if(ige.isClient){// churn out all the old snapshots
var snapshot=ige.snapshots[0];while(snapshot&&(ige.renderTime>snapshot[0]||ige.nextSnapshot&&ige.renderTime>ige.nextSnapshot[0])){snapshot=ige.snapshots.shift();ige.prevSnapshot=ige.nextSnapshot;ige.nextSnapshot=snapshot;// console.log(ige.snapshots.length)
}// if (ige.nextSnapshot && ige.renderTime > ige.nextSnapshot[0]) {
// 	ige.nextSnapshot = undefined;
// }
if(ige.client.myPlayer){ige.client.myPlayer.control._behaviour();}return;}ige.updateCount=0;ige.tickCount=0;ige.updateTransform=0;ige.inViewCount=0;ige.entityManagerUpdateBehaviour=0;ige.entityManagerUpdateorphan=0;ige.entityManagerUpdateChildren=0;ige.totalChildren=0;ige.totalOrphans=0;// Update the scenegraph
if(self._enableUpdates){// ige.updateCount = {}
// ige.tickCount = {}
if(igeConfig.debug._timing){updateStart=Date.now();self.updateSceneGraph(ctx);ige._updateTime=Date.now()-updateStart;}else{self.updateSceneGraph(ctx);}}if(!ige.gameLoopTickHasExecuted){return;}// Check for unborn entities that should be born now
unbornQueue=ige._spawnQueue;unbornCount=unbornQueue.length;for(unbornIndex=unbornCount-1;unbornIndex>=0;unbornIndex--){unbornEntity=unbornQueue[unbornIndex];if(ige._currentTime>=unbornEntity._bornTime){// Now birth this entity
unbornEntity.mount(ige.$(unbornEntity._birthMount));unbornQueue.splice(unbornIndex,1);}}// Render the scenegraph
if(self._enableRenders){if(!self._useManualRender){if(igeConfig.debug._timing){renderStart=Date.now();self.renderSceneGraph(ctx);}else{self.renderSceneGraph(ctx);}}else{if(self._manualRender){if(igeConfig.debug._timing){renderStart=Date.now();self.renderSceneGraph(ctx);}else{self.renderSceneGraph(ctx);}self._manualRender=false;}}}// console.log(ige.updateCount, ige.tickCount, ige.updateTransform, ige.inViewCount, ige.entityManagerUpdateBehaviour, ige.entityManagerUpdateorphan, ige.entityManagerUpdateChildren, ige.totalOrphans, ige.totalChildren)
// console.log(ige.updateCount, ige.tickCount, ige.updateTransform,"inView", ige.inViewCount);
// Record the lastTick value so we can
// calculate delta on the next tick
self.lastTick=self._tickStart;self._dpf=self._drawCount;self._drawCount=0;if(ige.isServer){if(self.now-self.lastCheckedAt>1000){self.lastCheckedAt=self.now;// kill tier 1 servers that has been empty for over 15 minutes
var playerCount=ige.$$('player').filter(function(player){return player._stats.controlledBy=='human';}).length;if(playerCount<=0){// console.log('self.emptyTimeLimit', self.emptyTimeLimit);
if(!self.serverEmptySince){self.serverEmptySince=self.now;}if(self.now-self.serverEmptySince>self.emptyTimeLimit){ige.server.kill('game\'s been empty for too long (15 min)');}}else{self.serverEmptySince=null;}var lifeSpan=self.getLifeSpan();// if server's lifeSpan is over, kill it (e.g. kill server after 5 hours)
var age=self.now-ige.server.gameStartedAt;var shouldLog=ige.server.logTriggers&&ige.server.logTriggers.timerLogs;if(shouldLog){console.log(self.now,ige.server.gameStartedAt,age,lifeSpan,age>lifeSpan);}if(age>lifeSpan){console.log({lifeSpan,age,now:self.now,startedAt:ige.server.gameStartedAt});ige.server.kill(`server lifespan expired ${lifeSpan}`);}}}/// / for debugging
// if (ige.$$("unit")[0]) {
// 	var x = ige.$$("unit")[0]._translate.x
// 	// for debugging
// 	if (!ige.lastSnapshotTimeStamp) {
// 		ige.lastSnapshotTimeStamp = timeStamp
// 	}
// 	if (!ige.lastX) {
// 		ige.lastX = x
// 	}
// 	var timeElapsed = timeStamp - ige.lastSnapshotTimeStamp
// 	var distanceTravelled = x - ige.lastX;
// 	if (x) {
// 		console.log("unit speed", (distanceTravelled / timeElapsed * 100).toFixed(0), " (", distanceTravelled, "/", timeElapsed, ")")
// 	}
// 	ige.lastX = x
// 	ige.lastSnapshotTimeStamp = timeStamp;
// }
ige.network.stream._sendQueue(timeStamp);ige.network.stream.updateEntityAttributes();if(ige.count==undefined||ige.now-ige.lastSent<30){// console.log(ige.count, ige.now - ige.lastSent)
ige.count=0;}ige.lastSent=ige.now;ige.count++;}ige.gameLoopTickHasExecuted=false;ige.physicsTickHasExecuted=false;self._resized=false;et=new Date().getTime();ige._tickTime=et-ige.now;// console.log(ige._tickTime, ige._tickTime, 1000/self._fpsRate)
// slow engineTick restart only works on two houses (Braains.io)
if(ige.server&&ige.server.gameId=='5a7fd59b1014dc000eeec3dd')// restart server if physics engine is running slow as this will cause laggy experience for the players
if(ige._tickTime>1000/self._fpsRate){self.lagOccurenceCount++;self.lastLagOccurenceAt=et;if(self.lagOccurenceCount>50){console.log('engineTick is taking too long! (',ige._tickTime,'ms. It should be under',1000/self._fpsRate,`(${self.lagOccurenceCount}/100)`);}if(self.lagOccurenceCount>100){ige.server.kill('engineTick has been consistently running slow. killing the server. (this causes lag)');}}else{self.lagOccurenceCount=0;}// // reset lagOccurenceCount if no lag occured for 3s.
// if (et - self.lastLagOccurenceAt > 3000) {
// }
if(ige.isClient){if(statsPanels.ms){statsPanels.fps.end();statsPanels.ms.end();}}},updateSceneGraph:function(ctx){// ige cancel
// if (ige.isClient) {
// 	return;
// }
var arr=this._children;var arrCount;var us;var ud;var tickDelta=ige._tickDelta;// Process any behaviours assigned to the engine
this._processUpdateBehaviours(ctx,tickDelta);if(arr){arrCount=arr.length;// Loop our viewports and call their update methods
if(igeConfig.debug._timing){while(arrCount--){us=new Date().getTime();arr[arrCount].update(ctx,tickDelta);ud=new Date().getTime()-us;if(arr[arrCount]){if(!ige._timeSpentInUpdate[arr[arrCount].id()]){ige._timeSpentInUpdate[arr[arrCount].id()]=0;}if(!ige._timeSpentLastUpdate[arr[arrCount].id()]){ige._timeSpentLastUpdate[arr[arrCount].id()]={};}ige._timeSpentInUpdate[arr[arrCount].id()]+=ud;ige._timeSpentLastUpdate[arr[arrCount].id()].ms=ud;}}}else{while(arrCount--){arr[arrCount].update(ctx,tickDelta);}}}},renderSceneGraph:function(ctx){var ts,td;// Process any behaviours assigned to the engine
this._processTickBehaviours(ctx);if(ige.isServer){if(this._viewportDepth){if(igeConfig.debug._timing){ts=new Date().getTime();this.depthSortChildren();td=new Date().getTime()-ts;if(!ige._timeSpentLastTick[this.id()]){ige._timeSpentLastTick[this.id()]={};}ige._timeSpentLastTick[this.id()].depthSortChildren=td;}else{this.depthSortChildren();}}ctx.save();ctx.translate(this._bounds2d.x2,this._bounds2d.y2);// ctx.scale(this._globalScale.x, this._globalScale.y);
// Process the current engine tick for all child objects
var arr=this._children;var arrCount;if(arr){arrCount=arr.length;// Loop our viewports and call their tick methods
if(igeConfig.debug._timing){while(arrCount--){ctx.save();ts=new Date().getTime();arr[arrCount].tick(ctx);td=new Date().getTime()-ts;if(arr[arrCount]){if(!ige._timeSpentInTick[arr[arrCount].id()]){ige._timeSpentInTick[arr[arrCount].id()]=0;}if(!ige._timeSpentLastTick[arr[arrCount].id()]){ige._timeSpentLastTick[arr[arrCount].id()]={};}ige._timeSpentInTick[arr[arrCount].id()]+=td;ige._timeSpentLastTick[arr[arrCount].id()].ms=td;}ctx.restore();}}else{while(arrCount--){ctx.save();arr[arrCount].tick(ctx);ctx.restore();}}}ctx.restore();}// Depth-sort the viewports
},fps:function(){return this._renderFPS;},dpf:function(){return this._dpf;},dps:function(){return this._dps;},analyseTiming:function(){if(!igeConfig.debug._timing){$i_102.prototype.log('Cannot analyse timing because the igeConfig.debug._timing flag is not enabled so no timing data has been recorded!','warning');}},saveSceneGraph:function(item){var arr,arrCount,i;if(!item){item=this.getSceneGraphData();}if(item.obj.stringify){item.str=item.obj.stringify();}else{$i_102.prototype.log(`Class ${item.classId} has no stringify() method! For object: ${item.id}`,item.obj);}arr=item.items;if(arr){arrCount=arr.length;for(i=0;i<arrCount;i++){this.saveSceneGraph(arr[i]);}}return item;},isMobileDevice:function(){// https://stackoverflow.com/questions/11381673/detecting-a-mobile-browser
var isMobile={Android:function(){return navigator.userAgent.match(/Android/i);},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i);},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i);},Opera:function(){return navigator.userAgent.match(/Opera Mini/i);},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i);},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows();}};return isMobile.any()!=null;},/**
	 * Walks the scene graph and outputs a console map of the graph.
	 */sceneGraph:function(obj,currentDepth,lastDepth){var depthSpace='';var di;var timingString;var arr;var arrCount;if(currentDepth===undefined){currentDepth=0;}if(!obj){// Set the obj to the main ige instance
obj=ige;}for(di=0;di<currentDepth;di++){depthSpace+='----';}if(igeConfig.debug._timing){timingString='';timingString+=`T: ${ige._timeSpentInTick[obj.id()]}`;if(ige._timeSpentLastTick[obj.id()]){if(typeof ige._timeSpentLastTick[obj.id()].ms==='number'){timingString+=` | LastTick: ${ige._timeSpentLastTick[obj.id()].ms}`;}if(typeof ige._timeSpentLastTick[obj.id()].depthSortChildren==='number'){timingString+=` | ChildDepthSort: ${ige._timeSpentLastTick[obj.id()].depthSortChildren}`;}}$i_102.prototype.log(`${depthSpace+obj.id()} (${obj._classId}) : ${obj._inView} Timing(${timingString})`);}else{$i_102.prototype.log(`${depthSpace+obj.id()} (${obj._classId}) : ${obj._inView}`);}currentDepth++;if(obj===ige){// Loop the viewports
arr=obj._children;if(arr){arrCount=arr.length;// Loop our children
while(arrCount--){if(arr[arrCount]._scene){if(arr[arrCount]._scene._shouldRender){if(igeConfig.debug._timing){timingString='';timingString+=`T: ${ige._timeSpentInTick[arr[arrCount].id()]}`;if(ige._timeSpentLastTick[arr[arrCount].id()]){if(typeof ige._timeSpentLastTick[arr[arrCount].id()].ms==='number'){timingString+=` | LastTick: ${ige._timeSpentLastTick[arr[arrCount].id()].ms}`;}if(typeof ige._timeSpentLastTick[arr[arrCount].id()].depthSortChildren==='number'){timingString+=` | ChildDepthSort: ${ige._timeSpentLastTick[arr[arrCount].id()].depthSortChildren}`;}}$i_102.prototype.log(`${depthSpace}----${arr[arrCount].id()} (${arr[arrCount]._classId}) : ${arr[arrCount]._inView} Timing(${timingString})`);}else{$i_102.prototype.log(`${depthSpace}----${arr[arrCount].id()} (${arr[arrCount]._classId}) : ${arr[arrCount]._inView}`);}this.sceneGraph(arr[arrCount]._scene,currentDepth+1);}}}}}else{arr=obj._children;if(arr){arrCount=arr.length;// Loop our children
while(arrCount--){this.sceneGraph(arr[arrCount],currentDepth);}}}},/**
	 * Walks the scenegraph and returns a data object of the graph.
	 */getSceneGraphData:function(obj,noRef){var item;var items=[];var tempItem;var tempItem2;var tempCam;var arr;var arrCount;if(!obj){// Set the obj to the main ige instance
obj=ige;}item={text:`[${obj._classId}] ${obj.id()}`,id:obj.id(),classId:obj.classId()};if(!noRef){item.parent=obj._parent;item.obj=obj;}else{if(obj._parent){item.parentId=obj._parent.id();}else{item.parentId='sceneGraph';}}if(obj===ige){// Loop the viewports
arr=obj._children;if(arr){arrCount=arr.length;// Loop our children
while(arrCount--){tempItem={text:`[${arr[arrCount]._classId}] ${arr[arrCount].id()}`,id:arr[arrCount].id(),classId:arr[arrCount].classId()};if(!noRef){tempItem.parent=arr[arrCount]._parent;tempItem.obj=arr[arrCount];}else{if(arr[arrCount]._parent){tempItem.parentId=arr[arrCount]._parent.id();}}if(arr[arrCount].camera){// Add the viewport camera as an object on the scenegraph
tempCam={text:`[$i_67] ${arr[arrCount].id()}`,id:arr[arrCount].camera.id(),classId:arr[arrCount].camera.classId()};if(!noRef){tempCam.parent=arr[arrCount];tempCam.obj=arr[arrCount].camera;}else{tempCam.parentId=arr[arrCount].id();}if(arr[arrCount]._scene){tempItem2=this.getSceneGraphData(arr[arrCount]._scene,noRef);tempItem.items=[tempCam,tempItem2];}}else{if(arr[arrCount]._scene){tempItem2=this.getSceneGraphData(arr[arrCount]._scene,noRef);tempItem.items=[tempItem2];}}items.push(tempItem);}}}else{arr=obj._children;if(arr){arrCount=arr.length;// Loop our children
while(arrCount--){tempItem=this.getSceneGraphData(arr[arrCount],noRef);items.push(tempItem);}}}if(items.length>0){item.items=items;}return item;},_childMounted:function(child){if(child.$i_68){// The first mounted viewport gets set as the current
// one before any rendering is done
if(!ige._currentViewport){ige._currentViewport=child;ige._currentCamera=child.camera;}}$i_56.prototype._childMounted.call(this,child);},destroy:function(){// Stop the engine and kill any timers
this.stop();// Remove the front buffer (canvas) if we created it
if(this.isClient){this.removeCanvas();}// Call class destroy() super method
$i_56.prototype.destroy.call(this);$i_102.prototype.log('Engine destroy complete.');},devLog:function(){// return;
// if (ige.env == 'local') {
// 	var scriptInfo = '';
// 	if (ige.script) {
// 		var script = ige.game.data.scripts[ige.script.currentScriptId];
// 		scriptInfo = `Script '${(script) ? script.name : ''}' in Action '${ige.script.currentActionName}' : `;
// 	}
// 	var info = scriptInfo + (new Error()).stack.split('\n')[2];
// 	Array.prototype.push.call(arguments, `     --- ${info}`);
// 	console.log.apply(console, arguments);
// }
}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=$i_102;};(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):global.Stats=factory();})(this,function(){'use strict';/**
 * @author mrdoob / http://mrdoob.com/
 */var Stats=function(){var mode=0;var container=document.createElement('div');container.style.cssText='position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000';container.addEventListener('click',function(event){event.preventDefault();showPanel(++mode%container.children.length);},false);//
function addPanel(panel){container.appendChild(panel.dom);return panel;}function showPanel(id){for(var i=0;i<container.children.length;i++){container.children[i].style.display=i===id?'block':'none';}mode=id;}//
var beginTime=(performance||Date).now(),prevTime=beginTime,frames=0;var fpsPanel=addPanel(new Stats.Panel('FPS','#0ff','#002'));var msPanel=addPanel(new Stats.Panel('MS','#0f0','#020'));if(self.performance&&self.performance.memory){var memPanel=addPanel(new Stats.Panel('MB','#f08','#201'));}showPanel(0);return{REVISION:16,dom:container,addPanel:addPanel,showPanel:showPanel,begin:function(){beginTime=(performance||Date).now();},end:function(){frames++;var time=(performance||Date).now();msPanel.update(time-beginTime,200);if(time>prevTime+1000){fpsPanel.update(frames*1000/(time-prevTime),100);prevTime=time;frames=0;if(memPanel){var memory=performance.memory;memPanel.update(memory.usedJSHeapSize/1048576,memory.jsHeapSizeLimit/1048576);}}return time;},update:function(){beginTime=this.end();},// Backwards Compatibility
domElement:container,setMode:showPanel};};Stats.Panel=function(name,fg,bg){var min=Infinity,max=0,round=Math.round;var PR=round(window.devicePixelRatio||1);var WIDTH=80*PR,HEIGHT=48*PR,TEXT_X=3*PR,TEXT_Y=2*PR,GRAPH_X=3*PR,GRAPH_Y=15*PR,GRAPH_WIDTH=74*PR,GRAPH_HEIGHT=30*PR;var canvas=document.createElement('canvas');canvas.width=WIDTH;canvas.height=HEIGHT;canvas.style.cssText='width:80px;height:48px';var context=canvas.getContext('2d');context.font='bold '+9*PR+'px Helvetica,Arial,sans-serif';context.textBaseline='top';context.fillStyle=bg;context.fillRect(0,0,WIDTH,HEIGHT);context.fillStyle=fg;context.fillText(name,TEXT_X,TEXT_Y);context.fillRect(GRAPH_X,GRAPH_Y,GRAPH_WIDTH,GRAPH_HEIGHT);context.fillStyle=bg;context.globalAlpha=0.9;context.fillRect(GRAPH_X,GRAPH_Y,GRAPH_WIDTH,GRAPH_HEIGHT);return{dom:canvas,update:function(value,maxValue){min=Math.min(min,value);max=Math.max(max,value);context.fillStyle=bg;context.globalAlpha=1;context.fillRect(0,0,WIDTH,GRAPH_Y);context.fillStyle=fg;context.fillText(round(value)+' '+name+' ('+round(min)+'-'+round(max)+')',TEXT_X,TEXT_Y);context.drawImage(canvas,GRAPH_X+PR,GRAPH_Y,GRAPH_WIDTH-PR,GRAPH_HEIGHT,GRAPH_X,GRAPH_Y,GRAPH_WIDTH-PR,GRAPH_HEIGHT);context.fillRect(GRAPH_X+GRAPH_WIDTH-PR,GRAPH_Y,PR,GRAPH_HEIGHT);context.fillStyle=bg;context.globalAlpha=0.9;context.fillRect(GRAPH_X+GRAPH_WIDTH-PR,GRAPH_Y,PR,round((1-value/maxValue)*GRAPH_HEIGHT));}};};return Stats;});;/**
 * dat-gui JavaScript Controller Library
 * http://code.google.com/p/dat-gui
 *
 * Copyright 2011 Data Arts Team, Google Creative Lab
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.dat=t();}(this,function(){"use strict";function e(e,t){var n=e.__state.conversionName.toString(),o=Math.round(e.r),i=Math.round(e.g),r=Math.round(e.b),s=e.a,a=Math.round(e.h),l=e.s.toFixed(1),d=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c;}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+s+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+s+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+l+",v:"+d+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+l+",v:"+d+",a:"+s+"}":"unknown format";}function t(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(V.recalculateRGB(this,t,n),this.__state[t]);},set:function(e){"RGB"!==this.__state.space&&(V.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e;}});}function n(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(V.recalculateHSV(this),this.__state[t]);},set:function(e){"HSV"!==this.__state.space&&(V.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e;}});}function o(e){if("0"===e||k.isUndefined(e))return 0;var t=e.match(G);return k.isNull(t)?0:parseFloat(t[1]);}function i(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0;}function r(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n;}function s(e,t,n,o,i){return o+(e-t)/(n-t)*(i-o);}function a(e,t,n,o){e.style.background="",k.each($,function(i){e.style.cssText+="background: "+i+"linear-gradient("+t+", "+n+" 0%, "+o+" 100%); ";});}function l(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);";}function d(e,t,n){var o=document.createElement("li");return t&&o.appendChild(t),n?e.__ul.insertBefore(o,n):e.__ul.appendChild(o),e.onResize(),o;}function c(e){U.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&U.unbind(window,"unload",e.saveToLocalStorageIfPossible);}function u(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value;}function _(e,t,n){if(n.__li=t,n.__gui=e,k.extend(n,{options:function(t){if(arguments.length>1){var o=n.__li.nextElementSibling;return n.remove(),p(e,n.object,n.property,{before:o,factoryArgs:[k.toArray(arguments)]});}if(k.isArray(t)||k.isObject(t)){var i=n.__li.nextElementSibling;return n.remove(),p(e,n.object,n.property,{before:i,factoryArgs:[t]});}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n;},listen:function(){return n.__gui.listen(n),n;},remove:function(){return n.__gui.remove(n),n;}}),n instanceof Q){var o=new W(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});k.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],i=o[e];n[e]=o[e]=function(){var e=Array.prototype.slice.call(arguments);return i.apply(o,e),t.apply(n,e);};}),U.addClass(t,"has-slider"),n.domElement.insertBefore(o.domElement,n.domElement.firstElementChild);}else if(n instanceof W){var i=function(t){if(k.isNumber(n.__min)&&k.isNumber(n.__max)){var o=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=p(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(o),i&&r.listen(),r;}return t;};n.min=k.compose(i,n.min),n.max=k.compose(i,n.max);}else n instanceof X?(U.bind(t,"click",function(){U.fakeEvent(n.__checkbox,"click");}),U.bind(n.__checkbox,"click",function(e){e.stopPropagation();})):n instanceof q?(U.bind(t,"click",function(){U.fakeEvent(n.__button,"click");}),U.bind(t,"mouseover",function(){U.addClass(n.__button,"hover");}),U.bind(t,"mouseout",function(){U.removeClass(n.__button,"hover");})):n instanceof Z&&(U.addClass(t,"color"),n.updateDisplay=k.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e;},n.updateDisplay),n.updateDisplay());n.setValue=k.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&u(e.getRoot(),!0),t;},n.setValue);}function h(e,t){var n=e.getRoot(),o=n.__rememberedObjects.indexOf(t.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[e.preset])s=r[e.preset];else{if(!r[re])return;s=r[re];}if(s[o]&&void 0!==s[o][t.property]){var a=s[o][t.property];t.initialValue=a,t.setValue(a);}}}}function p(e,t,n,o){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var i=void 0;if(o.color)i=new Z(t,n);else{var r=[t,n].concat(o.factoryArgs);i=te.apply(e,r);}o.before instanceof I&&(o.before=o.before.__li),h(e,i),U.addClass(i.domElement,"c");var s=document.createElement("span");U.addClass(s,"property-name"),s.innerHTML=i.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(i.domElement);var l=d(e,a,o.before);return U.addClass(l,_e.CLASS_CONTROLLER_ROW),i instanceof Z?U.addClass(l,"color"):U.addClass(l,N(i.getValue())),_(e,l,i),e.__controllers.push(i),i;}function f(e,t){return document.location.href+"."+t;}function m(e,t,n){var o=document.createElement("option");o.innerHTML=t,o.value=t,e.__preset_select.appendChild(o),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1);}function g(e,t){t.style.display=e.useLocalStorage?"block":"none";}function b(e){var t=e.__save_row=document.createElement("li");U.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),U.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",U.addClass(n,"button gears");var o=document.createElement("span");o.innerHTML="Save",U.addClass(o,"button"),U.addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",U.addClass(i,"button"),U.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",U.addClass(r,"button"),U.addClass(r,"revert");var s=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?k.each(e.load.remembered,function(t,n){m(e,n,n===e.preset);}):m(e,re,!1),U.bind(s,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value;}),t.appendChild(s),t.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(r),se){var a=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(f(e,"isLocal"))&&l.setAttribute("checked","checked"),g(e,a),U.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,g(e,a);});}var d=document.getElementById("dg-new-constructor");U.bind(d,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||ae.hide();}),U.bind(n,"click",function(){d.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),ae.show(),d.focus(),d.select();}),U.bind(o,"click",function(){e.save();}),U.bind(i,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t);}),U.bind(r,"click",function(){e.revert();});}function v(e){function t(t){return t.preventDefault(),e.width+=i-t.clientX,e.onResize(),i=t.clientX,!1;}function n(){U.removeClass(e.__closeButton,_e.CLASS_DRAG),U.unbind(window,"mousemove",t),U.unbind(window,"mouseup",n);}function o(o){return o.preventDefault(),i=o.clientX,U.addClass(e.__closeButton,_e.CLASS_DRAG),U.bind(window,"mousemove",t),U.bind(window,"mouseup",n),!1;}var i=void 0;e.__resize_handle=document.createElement("div"),k.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),U.bind(e.__resize_handle,"mousedown",o),U.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild);}function y(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px");}function w(e,t){var n={};return k.each(e.__rememberedObjects,function(o,i){var r={},s=e.__rememberedObjectIndecesToControllers[i];k.each(s,function(e,n){r[n]=t?e.initialValue:e.getValue();}),n[i]=r;}),n;}function x(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t);}function E(e){0!==e.length&&ne.call(window,function(){E(e);}),k.each(e,function(e){e.updateDisplay();});}var C=Array.prototype.forEach,A=Array.prototype.slice,k={BREAK:{},extend:function(e){return this.each(A.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n]);}.bind(this));},this),e;},defaults:function(e){return this.each(A.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n]);}.bind(this));},this),e;},compose:function(){var e=A.call(arguments);return function(){for(var t=A.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0];};},each:function(e,t,n){if(e)if(C&&e.forEach&&e.forEach===C)e.forEach(t,n);else if(e.length===e.length+0){var o=void 0,i=void 0;for(o=0,i=e.length;o<i;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return;}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return;},defer:function(e){setTimeout(e,0);},debounce:function(e,t,n){var o=void 0;return function(){var i=this,r=arguments,s=n||!o;clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(i,r);},t),s&&e.apply(i,r);};},toArray:function(e){return e.toArray?e.toArray():A.call(e);},isUndefined:function(e){return void 0===e;},isNull:function(e){return null===e;},isNaN:function(e){function t(t){return e.apply(this,arguments);}return t.toString=function(){return e.toString();},t;}(function(e){return isNaN(e);}),isArray:Array.isArray||function(e){return e.constructor===Array;},isObject:function(e){return e===Object(e);},isNumber:function(e){return e===e+0;},isString:function(e){return e===e+"";},isBoolean:function(e){return!1===e||!0===e;},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e);}},S=[{litmus:k.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)};},write:e},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)};},write:e},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])};},write:e},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])};},write:e}}},{litmus:k.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"};},write:function(e){return e.hex;}}}},{litmus:k.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]};},write:function(e){return[e.r,e.g,e.b];}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]};},write:function(e){return[e.r,e.g,e.b,e.a];}}}},{litmus:k.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(k.isNumber(e.r)&&k.isNumber(e.g)&&k.isNumber(e.b)&&k.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a};},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a};}},RGB_OBJ:{read:function(e){return!!(k.isNumber(e.r)&&k.isNumber(e.g)&&k.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b};},write:function(e){return{r:e.r,g:e.g,b:e.b};}},HSVA_OBJ:{read:function(e){return!!(k.isNumber(e.h)&&k.isNumber(e.s)&&k.isNumber(e.v)&&k.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a};},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a};}},HSV_OBJ:{read:function(e){return!!(k.isNumber(e.h)&&k.isNumber(e.s)&&k.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v};},write:function(e){return{h:e.h,s:e.s,v:e.v};}}}}],O=void 0,T=void 0,R=function(){T=!1;var e=arguments.length>1?k.toArray(arguments):arguments[0];return k.each(S,function(t){if(t.litmus(e))return k.each(t.conversions,function(t,n){if(O=t.read(e),!1===T&&!1!==O)return T=O,O.conversionName=n,O.conversion=t,k.BREAK;}),k.BREAK;}),T;},L=void 0,B={hsv_to_rgb:function(e,t,n){var o=Math.floor(e/60)%6,i=e/60-Math.floor(e/60),r=n*(1-t),s=n*(1-i*t),a=n*(1-(1-i)*t),l=[[n,a,r],[s,n,r],[r,n,a],[r,s,n],[a,r,n],[n,r,s]][o];return{r:255*l[0],g:255*l[1],b:255*l[2]};},rgb_to_hsv:function(e,t,n){var o=Math.min(e,t,n),i=Math.max(e,t,n),r=i-o,s=void 0,a=void 0;return 0===i?{h:NaN,s:0,v:0}:(a=r/i,s=e===i?(t-n)/r:t===i?2+(n-e)/r:4+(e-t)/r,(s/=6)<0&&(s+=1),{h:360*s,s:a,v:i/255});},rgb_to_hex:function(e,t,n){var o=this.hex_with_component(0,2,e);return o=this.hex_with_component(o,1,t),o=this.hex_with_component(o,0,n);},component_from_hex:function(e,t){return e>>8*t&255;},hex_with_component:function(e,t,n){return n<<(L=8*t)|e&~(255<<L);}},N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e;}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e;},H=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");},F=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o);}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t;};}(),P=function e(t,n,o){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,o);}if("value"in i)return i.value;var s=i.get;if(void 0!==s)return s.call(o);},j=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t);},D=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t;},V=function(){function t(){if(H(this,t),this.__state=R.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1;}return F(t,[{key:"toString",value:function(){return e(this);}},{key:"toHexString",value:function(){return e(this,!0);}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this);}}]),t;}();V.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=B.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");k.extend(e.__state,B.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v));}},V.recalculateHSV=function(e){var t=B.rgb_to_hsv(e.r,e.g,e.b);k.extend(e.__state,{s:t.s,v:t.v}),k.isNaN(t.h)?k.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h;},V.COMPONENTS=["r","g","b","h","s","v","hex","a"],t(V.prototype,"r",2),t(V.prototype,"g",1),t(V.prototype,"b",0),n(V.prototype,"h"),n(V.prototype,"s"),n(V.prototype,"v"),Object.defineProperty(V.prototype,"a",{get:function(){return this.__state.a;},set:function(e){this.__state.a=e;}}),Object.defineProperty(V.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=B.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex;},set:function(e){this.__state.space="HEX",this.__state.hex=e;}});var I=function(){function e(t,n){H(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0;}return F(e,[{key:"onChange",value:function(e){return this.__onChange=e,this;}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this;}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this;}},{key:"getValue",value:function(){return this.object[this.property];}},{key:"updateDisplay",value:function(){return this;}},{key:"isModified",value:function(){return this.initialValue!==this.getValue();}}]),e;}(),z={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},M={};k.each(z,function(e,t){k.each(e,function(e){M[e]=t;});});var G=/(\d+(\.\d+)?)px/,U={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1;}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off");},makeFullscreen:function(e,t,n){var o=n,i=t;k.isUndefined(i)&&(i=!0),k.isUndefined(o)&&(o=!0),e.style.position="absolute",i&&(e.style.left=0,e.style.right=0),o&&(e.style.top=0,e.style.bottom=0);},fakeEvent:function(e,t,n,o){var i=n||{},r=M[t];if(!r)throw new Error("Event type "+t+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":var a=i.x||i.clientX||0,l=i.y||i.clientY||0;s.initMouseEvent(t,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var d=s.initKeyboardEvent||s.initKeyEvent;k.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(t,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(t,i.bubbles||!1,i.cancelable||!0);}k.defaults(s,o),e.dispatchEvent(s);},bind:function(e,t,n,o){var i=o||!1;return e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on"+t,n),U;},unbind:function(e,t,n,o){var i=o||!1;return e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent&&e.detachEvent("on"+t,n),U;},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""));}return U;},removeClass:function(e,t){if(t){if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),o=n.indexOf(t);-1!==o&&(n.splice(o,1),e.className=n.join(" "));}}else e.className=void 0;return U;},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1;},getWidth:function(e){var t=getComputedStyle(e);return o(t["border-left-width"])+o(t["border-right-width"])+o(t["padding-left"])+o(t["padding-right"])+o(t.width);},getHeight:function(e){var t=getComputedStyle(e);return o(t["border-top-width"])+o(t["border-bottom-width"])+o(t["padding-top"])+o(t["padding-bottom"])+o(t.height);},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;}while(t);return n;},isActive:function(e){return e===document.activeElement&&(e.type||e.href);}},X=function(e){function t(e,n){H(this,t);var o=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=o;return o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox"),U.bind(o.__checkbox,"change",function(){i.setValue(!i.__prev);},!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o;}return j(t,I),F(t,[{key:"setValue",value:function(e){var n=P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n;}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this);}}]),t;}(),K=function(e){function t(e,n,o){H(this,t);var i=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=o,s=i;if(i.__select=document.createElement("select"),k.isArray(r)){var a={};k.each(r,function(e){a[e]=e;}),r=a;}return k.each(r,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),s.__select.appendChild(n);}),i.updateDisplay(),U.bind(i.__select,"change",function(){var e=this.options[this.selectedIndex].value;s.setValue(e);}),i.domElement.appendChild(i.__select),i;}return j(t,I),F(t,[{key:"setValue",value:function(e){var n=P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n;}},{key:"updateDisplay",value:function(){return U.isActive(this.__select)?this:(this.__select.value=this.getValue(),P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this));}}]),t;}(),Y=function(e){function t(e,n){function o(){r.setValue(r.__input.value);}H(this,t);var i=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i;return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),U.bind(i.__input,"keyup",o),U.bind(i.__input,"change",o),U.bind(i.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue());}),U.bind(i.__input,"keydown",function(e){13===e.keyCode&&this.blur();}),i.updateDisplay(),i.domElement.appendChild(i.__input),i;}return j(t,I),F(t,[{key:"updateDisplay",value:function(){return U.isActive(this.__input)||(this.__input.value=this.getValue()),P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this);}}]),t;}(),J=function(e){function t(e,n,o){H(this,t);var r=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),s=o||{};return r.__min=s.min,r.__max=s.max,r.__step=s.step,k.isUndefined(r.__step)?0===r.initialValue?r.__impliedStep=1:r.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(r.initialValue))/Math.LN10))/10:r.__impliedStep=r.__step,r.__precision=i(r.__impliedStep),r;}return j(t,I),F(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n);}},{key:"min",value:function(e){return this.__min=e,this;}},{key:"max",value:function(e){return this.__max=e,this;}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=i(e),this;}}]),t;}(),W=function(e){function t(e,n,o){function i(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue());}function r(e){var t=d-e.clientY;l.setValue(l.getValue()+t*l.__impliedStep),d=e.clientY;}function s(){U.unbind(window,"mousemove",r),U.unbind(window,"mouseup",s),i();}H(this,t);var a=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o));a.__truncationSuspended=!1;var l=a,d=void 0;return a.__input=document.createElement("input"),a.__input.setAttribute("type","text"),U.bind(a.__input,"change",function(){var e=parseFloat(l.__input.value);k.isNaN(e)||l.setValue(e);}),U.bind(a.__input,"blur",function(){i();}),U.bind(a.__input,"mousedown",function(e){U.bind(window,"mousemove",r),U.bind(window,"mouseup",s),d=e.clientY;}),U.bind(a.__input,"keydown",function(e){13===e.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1,i());}),a.updateDisplay(),a.domElement.appendChild(a.__input),a;}return j(t,J),F(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():r(this.getValue(),this.__precision),P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this);}}]),t;}(),Q=function(e){function t(e,n,o,i,r){function a(e){e.preventDefault();var t=_.__background.getBoundingClientRect();return _.setValue(s(e.clientX,t.left,t.right,_.__min,_.__max)),!1;}function l(){U.unbind(window,"mousemove",a),U.unbind(window,"mouseup",l),_.__onFinishChange&&_.__onFinishChange.call(_,_.getValue());}function d(e){var t=e.touches[0].clientX,n=_.__background.getBoundingClientRect();_.setValue(s(t,n.left,n.right,_.__min,_.__max));}function c(){U.unbind(window,"touchmove",d),U.unbind(window,"touchend",c),_.__onFinishChange&&_.__onFinishChange.call(_,_.getValue());}H(this,t);var u=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:o,max:i,step:r})),_=u;return u.__background=document.createElement("div"),u.__foreground=document.createElement("div"),U.bind(u.__background,"mousedown",function(e){document.activeElement.blur(),U.bind(window,"mousemove",a),U.bind(window,"mouseup",l),a(e);}),U.bind(u.__background,"touchstart",function(e){1===e.touches.length&&(U.bind(window,"touchmove",d),U.bind(window,"touchend",c),d(e));}),U.addClass(u.__background,"slider"),U.addClass(u.__foreground,"slider-fg"),u.updateDisplay(),u.__background.appendChild(u.__foreground),u.domElement.appendChild(u.__background),u;}return j(t,J),F(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",P(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this);}}]),t;}(),q=function(e){function t(e,n,o){H(this,t);var i=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===o?"Fire":o,U.bind(i.__button,"click",function(e){return e.preventDefault(),r.fire(),!1;}),U.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i;}return j(t,I),F(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue());}}]),t;}(),Z=function(e){function t(e,n){function o(e){u(e),U.bind(window,"mousemove",u),U.bind(window,"touchmove",u),U.bind(window,"mouseup",r),U.bind(window,"touchend",r);}function i(e){_(e),U.bind(window,"mousemove",_),U.bind(window,"touchmove",_),U.bind(window,"mouseup",s),U.bind(window,"touchend",s);}function r(){U.unbind(window,"mousemove",u),U.unbind(window,"touchmove",u),U.unbind(window,"mouseup",r),U.unbind(window,"touchend",r),c();}function s(){U.unbind(window,"mousemove",_),U.unbind(window,"touchmove",_),U.unbind(window,"mouseup",s),U.unbind(window,"touchend",s),c();}function d(){var e=R(this.value);!1!==e?(p.__color.__state=e,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString();}function c(){p.__onFinishChange&&p.__onFinishChange.call(p,p.__color.toOriginal());}function u(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=p.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,o=n.clientX,i=n.clientY,r=(o-t.left)/(t.right-t.left),s=1-(i-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),r>1?r=1:r<0&&(r=0),p.__color.v=s,p.__color.s=r,p.setValue(p.__color.toOriginal()),!1;}function _(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=p.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),p.__color.h=360*n,p.setValue(p.__color.toOriginal()),!1;}H(this,t);var h=D(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));h.__color=new V(h.getValue()),h.__temp=new V(0);var p=h;h.domElement=document.createElement("div"),U.makeSelectable(h.domElement,!1),h.__selector=document.createElement("div"),h.__selector.className="selector",h.__saturation_field=document.createElement("div"),h.__saturation_field.className="saturation-field",h.__field_knob=document.createElement("div"),h.__field_knob.className="field-knob",h.__field_knob_border="2px solid ",h.__hue_knob=document.createElement("div"),h.__hue_knob.className="hue-knob",h.__hue_field=document.createElement("div"),h.__hue_field.className="hue-field",h.__input=document.createElement("input"),h.__input.type="text",h.__input_textShadow="0 1px 1px ",U.bind(h.__input,"keydown",function(e){13===e.keyCode&&d.call(this);}),U.bind(h.__input,"blur",d),U.bind(h.__selector,"mousedown",function(){U.addClass(this,"drag").bind(window,"mouseup",function(){U.removeClass(p.__selector,"drag");});}),U.bind(h.__selector,"touchstart",function(){U.addClass(this,"drag").bind(window,"touchend",function(){U.removeClass(p.__selector,"drag");});});var f=document.createElement("div");return k.extend(h.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),k.extend(h.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:h.__field_knob_border+(h.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),k.extend(h.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),k.extend(h.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),k.extend(f.style,{width:"100%",height:"100%",background:"none"}),a(f,"top","rgba(0,0,0,0)","#000"),k.extend(h.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),l(h.__hue_field),k.extend(h.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:h.__input_textShadow+"rgba(0,0,0,0.7)"}),U.bind(h.__saturation_field,"mousedown",o),U.bind(h.__saturation_field,"touchstart",o),U.bind(h.__field_knob,"mousedown",o),U.bind(h.__field_knob,"touchstart",o),U.bind(h.__hue_field,"mousedown",i),U.bind(h.__hue_field,"touchstart",i),h.__saturation_field.appendChild(f),h.__selector.appendChild(h.__field_knob),h.__selector.appendChild(h.__saturation_field),h.__selector.appendChild(h.__hue_field),h.__hue_field.appendChild(h.__hue_knob),h.domElement.appendChild(h.__input),h.domElement.appendChild(h.__selector),h.updateDisplay(),h;}return j(t,I),F(t,[{key:"updateDisplay",value:function(){var e=R(this.getValue());if(!1!==e){var t=!1;k.each(V.COMPONENTS,function(n){if(!k.isUndefined(e[n])&&!k.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{};},this),t&&k.extend(this.__color.__state,e);}k.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,o=255-n;k.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,a(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),k.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"});}}]),t;}(),$=["-moz-","-o-","-webkit-","-ms-",""],ee={load:function(e,t){var n=t||document,o=n.createElement("link");o.type="text/css",o.rel="stylesheet",o.href=e,n.getElementsByTagName("head")[0].appendChild(o);},inject:function(e,t){var n=t||document,o=document.createElement("style");o.type="text/css",o.innerHTML=e;var i=n.getElementsByTagName("head")[0];try{i.appendChild(o);}catch(e){}}},te=function(e,t){var n=e[t];return k.isArray(arguments[2])||k.isObject(arguments[2])?new K(e,t,arguments[2]):k.isNumber(n)?k.isNumber(arguments[2])&&k.isNumber(arguments[3])?k.isNumber(arguments[4])?new Q(e,t,arguments[2],arguments[3],arguments[4]):new Q(e,t,arguments[2],arguments[3]):k.isNumber(arguments[4])?new W(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new W(e,t,{min:arguments[2],max:arguments[3]}):k.isString(n)?new Y(e,t):k.isFunction(n)?new q(e,t,""):k.isBoolean(n)?new X(e,t):null;},ne=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60);},oe=function(){function e(){H(this,e),this.backgroundElement=document.createElement("div"),k.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),U.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),k.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;U.bind(this.backgroundElement,"click",function(){t.hide();});}return F(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),k.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)";});}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",U.unbind(e.domElement,"webkitTransitionEnd",t),U.unbind(e.domElement,"transitionend",t),U.unbind(e.domElement,"oTransitionEnd",t);};U.bind(this.domElement,"webkitTransitionEnd",t),U.bind(this.domElement,"transitionend",t),U.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)";}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-U.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-U.getHeight(this.domElement)/2+"px";}}]),e;}(),ie=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e;}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ee.inject(ie);var re="Default",se=function(){try{return"localStorage"in window&&null!==window.localStorage;}catch(e){return!1;}}(),ae=void 0,le=!0,de=void 0,ce=!1,ue=[],_e=function e(t){var n=this,o=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),U.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=k.defaults(o,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),o=k.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),k.isUndefined(o.load)?o.load={preset:re}:o.preset&&(o.load.preset=o.preset),k.isUndefined(o.parent)&&o.hideable&&ue.push(this),o.resizable=k.isUndefined(o.parent)&&o.resizable,o.autoPlace&&k.isUndefined(o.scrollable)&&(o.scrollable=!0);var i=se&&"true"===localStorage.getItem(f(this,"isLocal")),r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return o.parent;}},scrollable:{get:function(){return o.scrollable;}},autoPlace:{get:function(){return o.autoPlace;}},closeOnTop:{get:function(){return o.closeOnTop;}},preset:{get:function(){return n.parent?n.getRoot().preset:o.load.preset;},set:function(e){n.parent?n.getRoot().preset=e:o.load.preset=e,x(this),n.revert();}},width:{get:function(){return o.width;},set:function(e){o.width=e,y(n,e);}},name:{get:function(){return o.name;},set:function(e){o.name=e,titleRowName&&(titleRowName.innerHTML=o.name);}},closed:{get:function(){return o.closed;},set:function(t){o.closed=t,o.closed?U.addClass(n.__ul,e.CLASS_CLOSED):U.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED);}},load:{get:function(){return o.load;}},useLocalStorage:{get:function(){return i;},set:function(e){se&&(i=e,e?U.bind(window,"unload",r):U.unbind(window,"unload",r),localStorage.setItem(f(n,"isLocal"),e));}}}),k.isUndefined(o.parent)){if(o.closed=!1,U.addClass(this.domElement,e.CLASS_MAIN),U.makeSelectable(this.domElement,!1),se&&i){n.useLocalStorage=!0;var s=localStorage.getItem(f(this,"gui"));s&&(o.load=JSON.parse(s));}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,U.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),o.closeOnTop?(U.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(U.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),U.bind(this.__closeButton,"click",function(){n.closed=!n.closed;});}else{void 0===o.closed&&(o.closed=!0);var a=document.createTextNode(o.name);U.addClass(a,"controller-name");var l=d(n,a);U.addClass(this.__ul,e.CLASS_CLOSED),U.addClass(l,"title"),U.bind(l,"click",function(e){return e.preventDefault(),n.closed=!n.closed,!1;}),o.closed||(this.closed=!1);}o.autoPlace&&(k.isUndefined(o.parent)&&(le&&(de=document.createElement("div"),U.addClass(de,"dg"),U.addClass(de,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(de),le=!1),de.appendChild(this.domElement),U.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||y(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced();},U.bind(window,"resize",this.__resizeHandler),U.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),U.bind(this.__ul,"transitionend",this.__resizeHandler),U.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&v(this),r=function(){se&&"true"===localStorage.getItem(f(n,"isLocal"))&&localStorage.setItem(f(n,"gui"),JSON.stringify(n.getSaveObject()));},this.saveToLocalStorageIfPossible=r,o.parent||function(){var e=n.getRoot();e.width+=1,k.defer(function(){e.width-=1;});}();};return _e.toggleHide=function(){ce=!ce,k.each(ue,function(e){e.domElement.style.display=ce?"none":"";});},_e.CLASS_AUTO_PLACE="a",_e.CLASS_AUTO_PLACE_CONTAINER="ac",_e.CLASS_MAIN="main",_e.CLASS_CONTROLLER_ROW="cr",_e.CLASS_TOO_TALL="taller-than-window",_e.CLASS_CLOSED="closed",_e.CLASS_CLOSE_BUTTON="close-button",_e.CLASS_CLOSE_TOP="close-top",_e.CLASS_CLOSE_BOTTOM="close-bottom",_e.CLASS_DRAG="drag",_e.DEFAULT_WIDTH=245,_e.TEXT_CLOSED="Close Controls",_e.TEXT_OPEN="Open Controls",_e._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||_e.toggleHide();},U.bind(window,"keydown",_e._keydownHandler,!1),k.extend(_e.prototype,{add:function(e,t){return p(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)});},addColor:function(e,t){return p(this,e,t,{color:!0});},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;k.defer(function(){t.onResize();});},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&de.removeChild(this.domElement);var e=this;k.each(this.__folders,function(t){e.removeFolder(t);}),U.unbind(window,"keydown",_e._keydownHandler,!1),c(this);},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new _e(t);this.__folders[e]=n;var o=d(this,n.domElement);return U.addClass(o,"folder"),n;},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],c(e);var t=this;k.each(e.__folders,function(t){e.removeFolder(t);}),k.defer(function(){t.onResize();});},open:function(){this.closed=!1;},close:function(){this.closed=!0;},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=U.getOffset(e.__ul).top,n=0;k.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=U.getHeight(t));}),window.innerHeight-t-20<n?(U.addClass(e.domElement,_e.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(U.removeClass(e.domElement,_e.CLASS_TOO_TALL),e.__ul.style.height="auto");}e.__resize_handle&&k.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px";}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px");},onResizeDebounced:k.debounce(function(){this.onResize();},50),remember:function(){if(k.isUndefined(ae)&&((ae=new oe()).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;k.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&b(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t);}),this.autoPlace&&y(this,this.width);},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e;},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=w(this)),e.folders={},k.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject();}),e;},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=w(this),u(this,!1),this.saveToLocalStorageIfPossible();},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[re]=w(this,!0)),this.load.remembered[e]=w(this),this.preset=e,m(this,e,!0),this.saveToLocalStorageIfPossible();},revert:function(e){k.each(this.__controllers,function(t){this.getRoot().load.remembered?h(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue());},this),k.each(this.__folders,function(e){e.revert(e);}),e||u(this.getRoot(),!1);},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&E(this.__listening);},updateDisplay:function(){k.each(this.__controllers,function(e){e.updateDisplay();}),k.each(this.__folders,function(e){e.updateDisplay();});}}),{color:{Color:V,math:B,interpret:R},controllers:{Controller:I,BooleanController:X,OptionController:K,StringController:Y,NumberController:J,NumberControllerBox:W,NumberControllerSlider:Q,FunctionController:q,ColorController:Z},dom:{dom:U},gui:{GUI:_e},GUI:_e};});;!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r;r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,r.msgpack=t();}}(function(){return function t(r,e,n){function i(f,u){if(!e[f]){if(!r[f]){var a="function"==typeof require&&require;if(!u&&a)return a(f,!0);if(o)return o(f,!0);var s=new Error("Cannot find module '"+f+"'");throw s.code="MODULE_NOT_FOUND",s;}var c=e[f]={exports:{}};r[f][0].call(c.exports,function(t){var e=r[f][1][t];return i(e?e:t);},c,c.exports,t,r,e,n);}return e[f].exports;}for(var o="function"==typeof require&&require,f=0;f<n.length;f++)i(n[f]);return i;}({1:[function(t,r,e){e.encode=t("./encode").encode,e.decode=t("./decode").decode,e.Encoder=t("./encoder").Encoder,e.Decoder=t("./decoder").Decoder,e.createCodec=t("./ext").createCodec,e.codec=t("./codec").codec;},{"./codec":10,"./decode":12,"./decoder":13,"./encode":15,"./encoder":16,"./ext":20}],2:[function(t,r,e){(function(Buffer){function t(t){return t&&t.isBuffer&&t;}r.exports=t("undefined"!=typeof Buffer&&Buffer)||t(this.Buffer)||t("undefined"!=typeof window&&window.Buffer)||this.Buffer;}).call(this,t("buffer").Buffer);},{buffer:29}],3:[function(t,r,e){function n(t,r){for(var e=this,n=r||(r|=0),i=t.length,o=0,f=0;f<i;)o=t.charCodeAt(f++),o<128?e[n++]=o:o<2048?(e[n++]=192|o>>>6,e[n++]=128|63&o):o<55296||o>57343?(e[n++]=224|o>>>12,e[n++]=128|o>>>6&63,e[n++]=128|63&o):(o=(o-55296<<10|t.charCodeAt(f++)-56320)+65536,e[n++]=240|o>>>18,e[n++]=128|o>>>12&63,e[n++]=128|o>>>6&63,e[n++]=128|63&o);return n-r;}function i(t,r,e){var n=this,i=0|r;e||(e=n.length);for(var o="",f=0;i<e;)f=n[i++],f<128?o+=String.fromCharCode(f):(192===(224&f)?f=(31&f)<<6|63&n[i++]:224===(240&f)?f=(15&f)<<12|(63&n[i++])<<6|63&n[i++]:240===(248&f)&&(f=(7&f)<<18|(63&n[i++])<<12|(63&n[i++])<<6|63&n[i++]),f>=65536?(f-=65536,o+=String.fromCharCode((f>>>10)+55296,(1023&f)+56320)):o+=String.fromCharCode(f));return o;}function o(t,r,e,n){var i;e||(e=0),n||0===n||(n=this.length),r||(r=0);var o=n-e;if(t===this&&e<r&&r<n)for(i=o-1;i>=0;i--)t[i+r]=this[i+e];else for(i=0;i<o;i++)t[i+r]=this[i+e];return o;}e.copy=o,e.toString=i,e.write=n;},{}],4:[function(t,r,e){function n(t){return new Array(t);}function i(t){if(!o.isBuffer(t)&&o.isView(t))t=o.Uint8Array.from(t);else if(o.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return o.from.call(e,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number');}return Array.prototype.slice.call(t);}var o=t("./bufferish"),e=r.exports=n(0);e.alloc=n,e.concat=o.concat,e.from=i;},{"./bufferish":8}],5:[function(t,r,e){function n(t){return new Buffer(t);}function i(t){if(!o.isBuffer(t)&&o.isView(t))t=o.Uint8Array.from(t);else if(o.isArrayBuffer(t))t=new Uint8Array(t);else{if("string"==typeof t)return o.from.call(e,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number');}return Buffer.from&&1!==Buffer.from.length?Buffer.from(t):new Buffer(t);}var o=t("./bufferish"),Buffer=o.global,e=r.exports=o.hasBuffer?n(0):[];e.alloc=o.hasBuffer&&Buffer.alloc||n,e.concat=o.concat,e.from=i;},{"./bufferish":8}],6:[function(t,r,e){function n(t,r,e,n){var o=a.isBuffer(this),f=a.isBuffer(t);if(o&&f)return this.copy(t,r,e,n);if(c||o||f||!a.isView(this)||!a.isView(t))return u.copy.call(this,t,r,e,n);var s=e||null!=n?i.call(this,e,n):this;return t.set(s,r),s.length;}function i(t,r){var e=this.slice||!c&&this.subarray;if(e)return e.call(this,t,r);var i=a.alloc.call(this,r-t);return n.call(this,i,0,t,r),i;}function o(t,r,e){var n=!s&&a.isBuffer(this)?this.toString:u.toString;return n.apply(this,arguments);}function f(t){function r(){var r=this[t]||u[t];return r.apply(this,arguments);}return r;}var u=t("./buffer-lite");e.copy=n,e.slice=i,e.toString=o,e.write=f("write");var a=t("./bufferish"),Buffer=a.global,s=a.hasBuffer&&"TYPED_ARRAY_SUPPORT"in Buffer,c=s&&!Buffer.TYPED_ARRAY_SUPPORT;},{"./buffer-lite":3,"./bufferish":8}],7:[function(t,r,e){function n(t){return new Uint8Array(t);}function i(t){if(o.isView(t)){var r=t.byteOffset,n=t.byteLength;t=t.buffer,t.byteLength!==n&&(t.slice?t=t.slice(r,r+n):(t=new Uint8Array(t),t.byteLength!==n&&(t=Array.prototype.slice.call(t,r,r+n))));}else{if("string"==typeof t)return o.from.call(e,t);if("number"==typeof t)throw new TypeError('"value" argument must not be a number');}return new Uint8Array(t);}var o=t("./bufferish"),e=r.exports=o.hasArrayBuffer?n(0):[];e.alloc=n,e.concat=o.concat,e.from=i;},{"./bufferish":8}],8:[function(t,r,e){function n(t){return"string"==typeof t?u.call(this,t):a(this).from(t);}function i(t){return a(this).alloc(t);}function o(t,r){function n(t){r+=t.length;}function o(t){a+=w.copy.call(t,u,a);}r||(r=0,Array.prototype.forEach.call(t,n));var f=this!==e&&this||t[0],u=i.call(f,r),a=0;return Array.prototype.forEach.call(t,o),u;}function f(t){return t instanceof ArrayBuffer||E(t);}function u(t){var r=3*t.length,e=i.call(this,r),n=w.write.call(e,t);return r!==n&&(e=w.slice.call(e,0,n)),e;}function a(t){return d(t)?g:y(t)?b:p(t)?v:h?g:l?b:v;}function s(){return!1;}function c(t,r){return t="[object "+t+"]",function(e){return null!=e&&{}.toString.call(r?e[r]:e)===t;};}var Buffer=e.global=t("./buffer-global"),h=e.hasBuffer=Buffer&&!!Buffer.isBuffer,l=e.hasArrayBuffer="undefined"!=typeof ArrayBuffer,p=e.isArray=t("isarray");e.isArrayBuffer=l?f:s;var d=e.isBuffer=h?Buffer.isBuffer:s,y=e.isView=l?ArrayBuffer.isView||c("ArrayBuffer","buffer"):s;e.alloc=i,e.concat=o,e.from=n;var v=e.Array=t("./bufferish-array"),g=e.Buffer=t("./bufferish-buffer"),b=e.Uint8Array=t("./bufferish-uint8array"),w=e.prototype=t("./bufferish-proto"),E=c("ArrayBuffer");},{"./buffer-global":2,"./bufferish-array":4,"./bufferish-buffer":5,"./bufferish-proto":6,"./bufferish-uint8array":7,isarray:34}],9:[function(t,r,e){function n(t){return this instanceof n?(this.options=t,void this.init()):new n(t);}function i(t){for(var r in t)n.prototype[r]=o(n.prototype[r],t[r]);}function o(t,r){function e(){return t.apply(this,arguments),r.apply(this,arguments);}return t&&r?e:t||r;}function f(t){function r(t,r){return r(t);}return t=t.slice(),function(e){return t.reduce(r,e);};}function u(t){return s(t)?f(t):t;}function a(t){return new n(t);}var s=t("isarray");e.createCodec=a,e.install=i,e.filter=u;var c=t("./bufferish");n.prototype.init=function(){var t=this.options;return t&&t.uint8array&&(this.bufferish=c.Uint8Array),this;},e.preset=a({preset:!0});},{"./bufferish":8,isarray:34}],10:[function(t,r,e){t("./read-core"),t("./write-core"),e.codec={preset:t("./codec-base").preset};},{"./codec-base":9,"./read-core":22,"./write-core":25}],11:[function(t,r,e){function n(t){if(!(this instanceof n))return new n(t);if(t&&(this.options=t,t.codec)){var r=this.codec=t.codec;r.bufferish&&(this.bufferish=r.bufferish);}}e.DecodeBuffer=n;var i=t("./read-core").preset,o=t("./flex-buffer").FlexDecoder;o.mixin(n.prototype),n.prototype.codec=i,n.prototype.fetch=function(){return this.codec.decode(this);};},{"./flex-buffer":21,"./read-core":22}],12:[function(t,r,e){function n(t,r){var e=new i(r);return e.write(t),e.read();}e.decode=n;var i=t("./decode-buffer").DecodeBuffer;},{"./decode-buffer":11}],13:[function(t,r,e){function n(t){return this instanceof n?void o.call(this,t):new n(t);}e.Decoder=n;var i=t("event-lite"),o=t("./decode-buffer").DecodeBuffer;n.prototype=new o(),i.mixin(n.prototype),n.prototype.decode=function(t){arguments.length&&this.write(t),this.flush();},n.prototype.push=function(t){this.emit("data",t);},n.prototype.end=function(t){this.decode(t),this.emit("end");};},{"./decode-buffer":11,"event-lite":31}],14:[function(t,r,e){function n(t){if(!(this instanceof n))return new n(t);if(t&&(this.options=t,t.codec)){var r=this.codec=t.codec;r.bufferish&&(this.bufferish=r.bufferish);}}e.EncodeBuffer=n;var i=t("./write-core").preset,o=t("./flex-buffer").FlexEncoder;o.mixin(n.prototype),n.prototype.codec=i,n.prototype.write=function(t){this.codec.encode(this,t);};},{"./flex-buffer":21,"./write-core":25}],15:[function(t,r,e){function n(t,r){var e=new i(r);return e.write(t),e.read();}e.encode=n;var i=t("./encode-buffer").EncodeBuffer;},{"./encode-buffer":14}],16:[function(t,r,e){function n(t){return this instanceof n?void o.call(this,t):new n(t);}e.Encoder=n;var i=t("event-lite"),o=t("./encode-buffer").EncodeBuffer;n.prototype=new o(),i.mixin(n.prototype),n.prototype.encode=function(t){this.write(t),this.emit("data",this.read());},n.prototype.end=function(t){arguments.length&&this.encode(t),this.flush(),this.emit("end");};},{"./encode-buffer":14,"event-lite":31}],17:[function(t,r,e){function n(t,r){return this instanceof n?(this.buffer=i.from(t),void(this.type=r)):new n(t,r);}e.ExtBuffer=n;var i=t("./bufferish");},{"./bufferish":8}],18:[function(t,r,e){function n(t){t.addExtPacker(14,Error,[u,i]),t.addExtPacker(1,EvalError,[u,i]),t.addExtPacker(2,RangeError,[u,i]),t.addExtPacker(3,ReferenceError,[u,i]),t.addExtPacker(4,SyntaxError,[u,i]),t.addExtPacker(5,TypeError,[u,i]),t.addExtPacker(6,URIError,[u,i]),t.addExtPacker(10,RegExp,[f,i]),t.addExtPacker(11,Boolean,[o,i]),t.addExtPacker(12,String,[o,i]),t.addExtPacker(13,Date,[Number,i]),t.addExtPacker(15,Number,[o,i]),"undefined"!=typeof Uint8Array&&(t.addExtPacker(17,Int8Array,c),t.addExtPacker(18,Uint8Array,c),t.addExtPacker(19,Int16Array,c),t.addExtPacker(20,Uint16Array,c),t.addExtPacker(21,Int32Array,c),t.addExtPacker(22,Uint32Array,c),t.addExtPacker(23,Float32Array,c),"undefined"!=typeof Float64Array&&t.addExtPacker(24,Float64Array,c),"undefined"!=typeof Uint8ClampedArray&&t.addExtPacker(25,Uint8ClampedArray,c),t.addExtPacker(26,ArrayBuffer,c),t.addExtPacker(29,DataView,c)),s.hasBuffer&&t.addExtPacker(27,Buffer,s.from);}function i(r){return a||(a=t("./encode").encode),a(r);}function o(t){return t.valueOf();}function f(t){t=RegExp.prototype.toString.call(t).split("/"),t.shift();var r=[t.pop()];return r.unshift(t.join("/")),r;}function u(t){var r={};for(var e in h)r[e]=t[e];return r;}e.setExtPackers=n;var a,s=t("./bufferish"),Buffer=s.global,c=s.Uint8Array.from,h={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};},{"./bufferish":8,"./encode":15}],19:[function(t,r,e){function n(t){t.addExtUnpacker(14,[i,f(Error)]),t.addExtUnpacker(1,[i,f(EvalError)]),t.addExtUnpacker(2,[i,f(RangeError)]),t.addExtUnpacker(3,[i,f(ReferenceError)]),t.addExtUnpacker(4,[i,f(SyntaxError)]),t.addExtUnpacker(5,[i,f(TypeError)]),t.addExtUnpacker(6,[i,f(URIError)]),t.addExtUnpacker(10,[i,o]),t.addExtUnpacker(11,[i,u(Boolean)]),t.addExtUnpacker(12,[i,u(String)]),t.addExtUnpacker(13,[i,u(Date)]),t.addExtUnpacker(15,[i,u(Number)]),"undefined"!=typeof Uint8Array&&(t.addExtUnpacker(17,u(Int8Array)),t.addExtUnpacker(18,u(Uint8Array)),t.addExtUnpacker(19,[a,u(Int16Array)]),t.addExtUnpacker(20,[a,u(Uint16Array)]),t.addExtUnpacker(21,[a,u(Int32Array)]),t.addExtUnpacker(22,[a,u(Uint32Array)]),t.addExtUnpacker(23,[a,u(Float32Array)]),"undefined"!=typeof Float64Array&&t.addExtUnpacker(24,[a,u(Float64Array)]),"undefined"!=typeof Uint8ClampedArray&&t.addExtUnpacker(25,u(Uint8ClampedArray)),t.addExtUnpacker(26,a),t.addExtUnpacker(29,[a,u(DataView)])),c.hasBuffer&&t.addExtUnpacker(27,u(Buffer));}function i(r){return s||(s=t("./decode").decode),s(r);}function o(t){return RegExp.apply(null,t);}function f(t){return function(r){var e=new t();for(var n in h)e[n]=r[n];return e;};}function u(t){return function(r){return new t(r);};}function a(t){return new Uint8Array(t).buffer;}e.setExtUnpackers=n;var s,c=t("./bufferish"),Buffer=c.global,h={name:1,message:1,stack:1,columnNumber:1,fileName:1,lineNumber:1};},{"./bufferish":8,"./decode":12}],20:[function(t,r,e){t("./read-core"),t("./write-core"),e.createCodec=t("./codec-base").createCodec;},{"./codec-base":9,"./read-core":22,"./write-core":25}],21:[function(t,r,e){function n(){if(!(this instanceof n))return new n();}function i(){if(!(this instanceof i))return new i();}function o(){function t(t){var r=this.offset?p.prototype.slice.call(this.buffer,this.offset):this.buffer;this.buffer=r?t?this.bufferish.concat([r,t]):r:t,this.offset=0;}function r(){for(;this.offset<this.buffer.length;){var t,r=this.offset;try{t=this.fetch();}catch(t){if(t&&t.message!=v)throw t;this.offset=r;break;}this.push(t);}}function e(t){var r=this.offset,e=r+t;if(e>this.buffer.length)throw new Error(v);return this.offset=e,r;}return{bufferish:p,write:t,fetch:a,flush:r,push:c,pull:h,read:s,reserve:e,offset:0};}function f(){function t(){var t=this.start;if(t<this.offset){var r=this.start=this.offset;return p.prototype.slice.call(this.buffer,t,r);}}function r(){for(;this.start<this.offset;){var t=this.fetch();t&&this.push(t);}}function e(){var t=this.buffers||(this.buffers=[]),r=t.length>1?this.bufferish.concat(t):t[0];return t.length=0,r;}function n(t){var r=0|t;if(this.buffer){var e=this.buffer.length,n=0|this.offset,i=n+r;if(i<e)return this.offset=i,n;this.flush(),t=Math.max(t,Math.min(2*e,this.maxBufferSize));}return t=Math.max(t,this.minBufferSize),this.buffer=this.bufferish.alloc(t),this.start=0,this.offset=r,0;}function i(t){var r=t.length;if(r>this.minBufferSize)this.flush(),this.push(t);else{var e=this.reserve(r);p.prototype.copy.call(t,this.buffer,e);}}return{bufferish:p,write:u,fetch:t,flush:r,push:c,pull:e,read:s,reserve:n,send:i,maxBufferSize:y,minBufferSize:d,offset:0,start:0};}function u(){throw new Error("method not implemented: write()");}function a(){throw new Error("method not implemented: fetch()");}function s(){var t=this.buffers&&this.buffers.length;return t?(this.flush(),this.pull()):this.fetch();}function c(t){var r=this.buffers||(this.buffers=[]);r.push(t);}function h(){var t=this.buffers||(this.buffers=[]);return t.shift();}function l(t){function r(r){for(var e in t)r[e]=t[e];return r;}return r;}e.FlexDecoder=n,e.FlexEncoder=i;var p=t("./bufferish"),d=2048,y=65536,v="BUFFER_SHORTAGE";n.mixin=l(o()),n.mixin(n.prototype),i.mixin=l(f()),i.mixin(i.prototype);},{"./bufferish":8}],22:[function(t,r,e){function n(t){function r(t){var r=s(t),n=e[r];if(!n)throw new Error("Invalid type: "+(r?"0x"+r.toString(16):r));return n(t);}var e=c.getReadToken(t);return r;}function i(){var t=this.options;return this.decode=n(t),t&&t.preset&&a.setExtUnpackers(this),this;}function o(t,r){var e=this.extUnpackers||(this.extUnpackers=[]);e[t]=h.filter(r);}function f(t){function r(r){return new u(r,t);}var e=this.extUnpackers||(this.extUnpackers=[]);return e[t]||r;}var u=t("./ext-buffer").ExtBuffer,a=t("./ext-unpacker"),s=t("./read-format").readUint8,c=t("./read-token"),h=t("./codec-base");h.install({addExtUnpacker:o,getExtUnpacker:f,init:i}),e.preset=i.call(h.preset);},{"./codec-base":9,"./ext-buffer":17,"./ext-unpacker":19,"./read-format":23,"./read-token":24}],23:[function(t,r,e){function n(t){var r=k.hasArrayBuffer&&t&&t.binarraybuffer,e=t&&t.int64,n=T&&t&&t.usemap,B={map:n?o:i,array:f,str:u,bin:r?s:a,ext:c,uint8:h,uint16:p,uint32:y,uint64:g(8,e?E:b),int8:l,int16:d,int32:v,int64:g(8,e?A:w),float32:g(4,m),float64:g(8,x)};return B;}function i(t,r){var e,n={},i=new Array(r),o=new Array(r),f=t.codec.decode;for(e=0;e<r;e++)i[e]=f(t),o[e]=f(t);for(e=0;e<r;e++)n[i[e]]=o[e];return n;}function o(t,r){var e,n=new Map(),i=new Array(r),o=new Array(r),f=t.codec.decode;for(e=0;e<r;e++)i[e]=f(t),o[e]=f(t);for(e=0;e<r;e++)n.set(i[e],o[e]);return n;}function f(t,r){for(var e=new Array(r),n=t.codec.decode,i=0;i<r;i++)e[i]=n(t);return e;}function u(t,r){var e=t.reserve(r),n=e+r;return _.toString.call(t.buffer,"utf-8",e,n);}function a(t,r){var e=t.reserve(r),n=e+r,i=_.slice.call(t.buffer,e,n);return k.from(i);}function s(t,r){var e=t.reserve(r),n=e+r,i=_.slice.call(t.buffer,e,n);return k.Uint8Array.from(i).buffer;}function c(t,r){var e=t.reserve(r+1),n=t.buffer[e++],i=e+r,o=t.codec.getExtUnpacker(n);if(!o)throw new Error("Invalid ext type: "+(n?"0x"+n.toString(16):n));var f=_.slice.call(t.buffer,e,i);return o(f);}function h(t){var r=t.reserve(1);return t.buffer[r];}function l(t){var r=t.reserve(1),e=t.buffer[r];return 128&e?e-256:e;}function p(t){var r=t.reserve(2),e=t.buffer;return e[r++]<<8|e[r];}function d(t){var r=t.reserve(2),e=t.buffer,n=e[r++]<<8|e[r];return 32768&n?n-65536:n;}function y(t){var r=t.reserve(4),e=t.buffer;return 16777216*e[r++]+(e[r++]<<16)+(e[r++]<<8)+e[r];}function v(t){var r=t.reserve(4),e=t.buffer;return e[r++]<<24|e[r++]<<16|e[r++]<<8|e[r];}function g(t,r){return function(e){var n=e.reserve(t);return r.call(e.buffer,n,S);};}function b(t){return new P(this,t).toNumber();}function w(t){return new R(this,t).toNumber();}function E(t){return new P(this,t);}function A(t){return new R(this,t);}function m(t){return B.read(this,t,!1,23,4);}function x(t){return B.read(this,t,!1,52,8);}var B=t("ieee754"),U=t("int64-buffer"),P=U.Uint64BE,R=U.Int64BE;e.getReadFormat=n,e.readUint8=h;var k=t("./bufferish"),_=t("./bufferish-proto"),T="undefined"!=typeof Map,S=!0;},{"./bufferish":8,"./bufferish-proto":6,ieee754:32,"int64-buffer":33}],24:[function(t,r,e){function n(t){var r=s.getReadFormat(t);return t&&t.useraw?o(r):i(r);}function i(t){var r,e=new Array(256);for(r=0;r<=127;r++)e[r]=f(r);for(r=128;r<=143;r++)e[r]=a(r-128,t.map);for(r=144;r<=159;r++)e[r]=a(r-144,t.array);for(r=160;r<=191;r++)e[r]=a(r-160,t.str);for(e[192]=f(null),e[193]=null,e[194]=f(!1),e[195]=f(!0),e[196]=u(t.uint8,t.bin),e[197]=u(t.uint16,t.bin),e[198]=u(t.uint32,t.bin),e[199]=u(t.uint8,t.ext),e[200]=u(t.uint16,t.ext),e[201]=u(t.uint32,t.ext),e[202]=t.float32,e[203]=t.float64,e[204]=t.uint8,e[205]=t.uint16,e[206]=t.uint32,e[207]=t.uint64,e[208]=t.int8,e[209]=t.int16,e[210]=t.int32,e[211]=t.int64,e[212]=a(1,t.ext),e[213]=a(2,t.ext),e[214]=a(4,t.ext),e[215]=a(8,t.ext),e[216]=a(16,t.ext),e[217]=u(t.uint8,t.str),e[218]=u(t.uint16,t.str),e[219]=u(t.uint32,t.str),e[220]=u(t.uint16,t.array),e[221]=u(t.uint32,t.array),e[222]=u(t.uint16,t.map),e[223]=u(t.uint32,t.map),r=224;r<=255;r++)e[r]=f(r-256);return e;}function o(t){var r,e=i(t).slice();for(e[217]=e[196],e[218]=e[197],e[219]=e[198],r=160;r<=191;r++)e[r]=a(r-160,t.bin);return e;}function f(t){return function(){return t;};}function u(t,r){return function(e){var n=t(e);return r(e,n);};}function a(t,r){return function(e){return r(e,t);};}var s=t("./read-format");e.getReadToken=n;},{"./read-format":23}],25:[function(t,r,e){function n(t){function r(t,r){var n=e[typeof r];if(!n)throw new Error('Unsupported type "'+typeof r+'": '+r);n(t,r);}var e=s.getWriteType(t);return r;}function i(){var t=this.options;return this.encode=n(t),t&&t.preset&&a.setExtPackers(this),this;}function o(t,r,e){function n(r){return e&&(r=e(r)),new u(r,t);}e=c.filter(e);var i=r.name;if(i&&"Object"!==i){var o=this.extPackers||(this.extPackers={});o[i]=n;}else{var f=this.extEncoderList||(this.extEncoderList=[]);f.unshift([r,n]);}}function f(t){var r=this.extPackers||(this.extPackers={}),e=t.constructor,n=e&&e.name&&r[e.name];if(n)return n;for(var i=this.extEncoderList||(this.extEncoderList=[]),o=i.length,f=0;f<o;f++){var u=i[f];if(e===u[0])return u[1];}}var u=t("./ext-buffer").ExtBuffer,a=t("./ext-packer"),s=t("./write-type"),c=t("./codec-base");c.install({addExtPacker:o,getExtPacker:f,init:i}),e.preset=i.call(c.preset);},{"./codec-base":9,"./ext-buffer":17,"./ext-packer":18,"./write-type":27}],26:[function(t,r,e){function n(t){return t&&t.uint8array?i():m||E.hasBuffer&&t&&t.safe?f():o();}function i(){var t=o();return t[202]=c(202,4,p),t[203]=c(203,8,d),t;}function o(){var t=w.slice();return t[196]=u(196),t[197]=a(197),t[198]=s(198),t[199]=u(199),t[200]=a(200),t[201]=s(201),t[202]=c(202,4,x.writeFloatBE||p,!0),t[203]=c(203,8,x.writeDoubleBE||d,!0),t[204]=u(204),t[205]=a(205),t[206]=s(206),t[207]=c(207,8,h),t[208]=u(208),t[209]=a(209),t[210]=s(210),t[211]=c(211,8,l),t[217]=u(217),t[218]=a(218),t[219]=s(219),t[220]=a(220),t[221]=s(221),t[222]=a(222),t[223]=s(223),t;}function f(){var t=w.slice();return t[196]=c(196,1,Buffer.prototype.writeUInt8),t[197]=c(197,2,Buffer.prototype.writeUInt16BE),t[198]=c(198,4,Buffer.prototype.writeUInt32BE),t[199]=c(199,1,Buffer.prototype.writeUInt8),t[200]=c(200,2,Buffer.prototype.writeUInt16BE),t[201]=c(201,4,Buffer.prototype.writeUInt32BE),t[202]=c(202,4,Buffer.prototype.writeFloatBE),t[203]=c(203,8,Buffer.prototype.writeDoubleBE),t[204]=c(204,1,Buffer.prototype.writeUInt8),t[205]=c(205,2,Buffer.prototype.writeUInt16BE),t[206]=c(206,4,Buffer.prototype.writeUInt32BE),t[207]=c(207,8,h),t[208]=c(208,1,Buffer.prototype.writeInt8),t[209]=c(209,2,Buffer.prototype.writeInt16BE),t[210]=c(210,4,Buffer.prototype.writeInt32BE),t[211]=c(211,8,l),t[217]=c(217,1,Buffer.prototype.writeUInt8),t[218]=c(218,2,Buffer.prototype.writeUInt16BE),t[219]=c(219,4,Buffer.prototype.writeUInt32BE),t[220]=c(220,2,Buffer.prototype.writeUInt16BE),t[221]=c(221,4,Buffer.prototype.writeUInt32BE),t[222]=c(222,2,Buffer.prototype.writeUInt16BE),t[223]=c(223,4,Buffer.prototype.writeUInt32BE),t;}function u(t){return function(r,e){var n=r.reserve(2),i=r.buffer;i[n++]=t,i[n]=e;};}function a(t){return function(r,e){var n=r.reserve(3),i=r.buffer;i[n++]=t,i[n++]=e>>>8,i[n]=e;};}function s(t){return function(r,e){var n=r.reserve(5),i=r.buffer;i[n++]=t,i[n++]=e>>>24,i[n++]=e>>>16,i[n++]=e>>>8,i[n]=e;};}function c(t,r,e,n){return function(i,o){var f=i.reserve(r+1);i.buffer[f++]=t,e.call(i.buffer,o,f,n);};}function h(t,r){new g(this,r,t);}function l(t,r){new b(this,r,t);}function p(t,r){y.write(this,t,r,!1,23,4);}function d(t,r){y.write(this,t,r,!1,52,8);}var y=t("ieee754"),v=t("int64-buffer"),g=v.Uint64BE,b=v.Int64BE,w=t("./write-uint8").uint8,E=t("./bufferish"),Buffer=E.global,A=E.hasBuffer&&"TYPED_ARRAY_SUPPORT"in Buffer,m=A&&!Buffer.TYPED_ARRAY_SUPPORT,x=E.hasBuffer&&Buffer.prototype||{};e.getWriteToken=n;},{"./bufferish":8,"./write-uint8":28,ieee754:32,"int64-buffer":33}],27:[function(t,r,e){function n(t){function r(t,r){var e=r?195:194;_[e](t,r);}function e(t,r){var e,n=0|r;return r!==n?(e=203,void _[e](t,r)):(e=-32<=n&&n<=127?255&n:0<=n?n<=255?204:n<=65535?205:206:-128<=n?208:-32768<=n?209:210,void _[e](t,n));}function n(t,r){var e=207;_[e](t,r.toArray());}function o(t,r){var e=211;_[e](t,r.toArray());}function v(t){return t<32?1:t<=255?2:t<=65535?3:5;}function g(t){return t<32?1:t<=65535?3:5;}function b(t){function r(r,e){var n=e.length,i=5+3*n;r.offset=r.reserve(i);var o=r.buffer,f=t(n),u=r.offset+f;n=s.write.call(o,e,u);var a=t(n);if(f!==a){var c=u+a-f,h=u+n;s.copy.call(o,o,c,u,h);}var l=1===a?160+n:a<=3?215+a:219;_[l](r,n),r.offset+=n;}return r;}function w(t,r){if(null===r)return A(t,r);if(I(r))return Y(t,r);if(i(r))return m(t,r);if(f.isUint64BE(r))return n(t,r);if(u.isInt64BE(r))return o(t,r);var e=t.codec.getExtPacker(r);return e&&(r=e(r)),r instanceof l?U(t,r):void D(t,r);}function E(t,r){return I(r)?k(t,r):void w(t,r);}function A(t,r){var e=192;_[e](t,r);}function m(t,r){var e=r.length,n=e<16?144+e:e<=65535?220:221;_[n](t,e);for(var i=t.codec.encode,o=0;o<e;o++)i(t,r[o]);}function x(t,r){var e=r.length,n=e<255?196:e<=65535?197:198;_[n](t,e),t.send(r);}function B(t,r){x(t,new Uint8Array(r));}function U(t,r){var e=r.buffer,n=e.length,i=y[n]||(n<255?199:n<=65535?200:201);_[i](t,n),h[r.type](t),t.send(e);}function P(t,r){var e=Object.keys(r),n=e.length,i=n<16?128+n:n<=65535?222:223;_[i](t,n);var o=t.codec.encode;e.forEach(function(e){o(t,e),o(t,r[e]);});}function R(t,r){if(!(r instanceof Map))return P(t,r);var e=r.size,n=e<16?128+e:e<=65535?222:223;_[n](t,e);var i=t.codec.encode;r.forEach(function(r,e,n){i(t,e),i(t,r);});}function k(t,r){var e=r.length,n=e<32?160+e:e<=65535?218:219;_[n](t,e),t.send(r);}var _=c.getWriteToken(t),T=t&&t.useraw,S=p&&t&&t.binarraybuffer,I=S?a.isArrayBuffer:a.isBuffer,Y=S?B:x,C=d&&t&&t.usemap,D=C?R:P,O={boolean:r,function:A,number:e,object:T?E:w,string:b(T?g:v),symbol:A,undefined:A};return O;}var i=t("isarray"),o=t("int64-buffer"),f=o.Uint64BE,u=o.Int64BE,a=t("./bufferish"),s=t("./bufferish-proto"),c=t("./write-token"),h=t("./write-uint8").uint8,l=t("./ext-buffer").ExtBuffer,p="undefined"!=typeof Uint8Array,d="undefined"!=typeof Map,y=[];y[1]=212,y[2]=213,y[4]=214,y[8]=215,y[16]=216,e.getWriteType=n;},{"./bufferish":8,"./bufferish-proto":6,"./ext-buffer":17,"./write-token":26,"./write-uint8":28,"int64-buffer":33,isarray:34}],28:[function(t,r,e){function n(t){return function(r){var e=r.reserve(1);r.buffer[e]=t;};}for(var i=e.uint8=new Array(256),o=0;o<=255;o++)i[o]=n(o);},{}],29:[function(t,r,e){(function(r){"use strict";function n(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42;}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength;}catch(t){return!1;}}function i(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823;}function o(t,r){if(i()<r)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(r),t.__proto__=Buffer.prototype):(null===t&&(t=new Buffer(r)),t.length=r),t;}function Buffer(t,r,e){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,r,e);if("number"==typeof t){if("string"==typeof r)throw new Error("If encoding is specified then the first argument must be a string");return s(this,t);}return f(this,t,r,e);}function f(t,r,e,n){if("number"==typeof r)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer?l(t,r,e,n):"string"==typeof r?c(t,r,e):p(t,r);}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative');}function a(t,r,e,n){return u(r),r<=0?o(t,r):void 0!==e?"string"==typeof n?o(t,r).fill(e,n):o(t,r).fill(e):o(t,r);}function s(t,r){if(u(r),t=o(t,r<0?0:0|d(r)),!Buffer.TYPED_ARRAY_SUPPORT)for(var e=0;e<r;++e)t[e]=0;return t;}function c(t,r,e){if("string"==typeof e&&""!==e||(e="utf8"),!Buffer.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(r,e);t=o(t,n);var i=t.write(r,e);return i!==n&&(t=t.slice(0,i)),t;}function h(t,r){var e=r.length<0?0:0|d(r.length);t=o(t,e);for(var n=0;n<e;n+=1)t[n]=255&r[n];return t;}function l(t,r,e,n){if(r.byteLength,e<0||r.byteLength<e)throw new RangeError("'offset' is out of bounds");if(r.byteLength<e+(n||0))throw new RangeError("'length' is out of bounds");return r=void 0===e&&void 0===n?new Uint8Array(r):void 0===n?new Uint8Array(r,e):new Uint8Array(r,e,n),Buffer.TYPED_ARRAY_SUPPORT?(t=r,t.__proto__=Buffer.prototype):t=h(t,r),t;}function p(t,r){if(Buffer.isBuffer(r)){var e=0|d(r.length);return t=o(t,e),0===t.length?t:(r.copy(t,0,0,e),t);}if(r){if("undefined"!=typeof ArrayBuffer&&r.buffer instanceof ArrayBuffer||"length"in r)return"number"!=typeof r.length||H(r.length)?o(t,0):h(t,r);if("Buffer"===r.type&&Q(r.data))return h(t,r.data);}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");}function d(t){if(t>=i())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i().toString(16)+" bytes");return 0|t;}function y(t){return+t!=t&&(t=0),Buffer.alloc(+t);}function v(t,r){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var e=t.length;if(0===e)return 0;for(var n=!1;;)switch(r){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return q(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return X(t).length;default:if(n)return q(t).length;r=(""+r).toLowerCase(),n=!0;}}function g(t,r,e){var n=!1;if((void 0===r||r<0)&&(r=0),r>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if(e>>>=0,r>>>=0,e<=r)return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,r,e);case"utf8":case"utf-8":return k(this,r,e);case"ascii":return T(this,r,e);case"latin1":case"binary":return S(this,r,e);case"base64":return R(this,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Y(this,r,e);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0;}}function b(t,r,e){var n=t[r];t[r]=t[e],t[e]=n;}function w(t,r,e,n,i){if(0===t.length)return-1;if("string"==typeof e?(n=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=i?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(i)return-1;e=t.length-1;}else if(e<0){if(!i)return-1;e=0;}if("string"==typeof r&&(r=Buffer.from(r,n)),Buffer.isBuffer(r))return 0===r.length?-1:E(t,r,e,n,i);if("number"==typeof r)return r=255&r,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,r,e):Uint8Array.prototype.lastIndexOf.call(t,r,e):E(t,[r],e,n,i);throw new TypeError("val must be string, number or Buffer");}function E(t,r,e,n,i){function o(t,r){return 1===f?t[r]:t.readUInt16BE(r*f);}var f=1,u=t.length,a=r.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||r.length<2)return-1;f=2,u/=2,a/=2,e/=2;}var s;if(i){var c=-1;for(s=e;s<u;s++)if(o(t,s)===o(r,c===-1?0:s-c)){if(c===-1&&(c=s),s-c+1===a)return c*f;}else c!==-1&&(s-=s-c),c=-1;}else for(e+a>u&&(e=u-a),s=e;s>=0;s--){for(var h=!0,l=0;l<a;l++)if(o(t,s+l)!==o(r,l)){h=!1;break;}if(h)return s;}return-1;}function A(t,r,e,n){e=Number(e)||0;var i=t.length-e;n?(n=Number(n),n>i&&(n=i)):n=i;var o=r.length;if(o%2!==0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var f=0;f<n;++f){var u=parseInt(r.substr(2*f,2),16);if(isNaN(u))return f;t[e+f]=u;}return f;}function m(t,r,e,n){return G(q(r,t.length-e),t,e,n);}function x(t,r,e,n){return G(W(r),t,e,n);}function B(t,r,e,n){return x(t,r,e,n);}function U(t,r,e,n){return G(X(r),t,e,n);}function P(t,r,e,n){return G(J(r,t.length-e),t,e,n);}function R(t,r,e){return 0===r&&e===t.length?Z.fromByteArray(t):Z.fromByteArray(t.slice(r,e));}function k(t,r,e){e=Math.min(t.length,e);for(var n=[],i=r;i<e;){var o=t[i],f=null,u=o>239?4:o>223?3:o>191?2:1;if(i+u<=e){var a,s,c,h;switch(u){case 1:o<128&&(f=o);break;case 2:a=t[i+1],128===(192&a)&&(h=(31&o)<<6|63&a,h>127&&(f=h));break;case 3:a=t[i+1],s=t[i+2],128===(192&a)&&128===(192&s)&&(h=(15&o)<<12|(63&a)<<6|63&s,h>2047&&(h<55296||h>57343)&&(f=h));break;case 4:a=t[i+1],s=t[i+2],c=t[i+3],128===(192&a)&&128===(192&s)&&128===(192&c)&&(h=(15&o)<<18|(63&a)<<12|(63&s)<<6|63&c,h>65535&&h<1114112&&(f=h));}}null===f?(f=65533,u=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),i+=u;}return _(n);}function _(t){var r=t.length;if(r<=$)return String.fromCharCode.apply(String,t);for(var e="",n=0;n<r;)e+=String.fromCharCode.apply(String,t.slice(n,n+=$));return e;}function T(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(127&t[i]);return n;}function S(t,r,e){var n="";e=Math.min(t.length,e);for(var i=r;i<e;++i)n+=String.fromCharCode(t[i]);return n;}function I(t,r,e){var n=t.length;(!r||r<0)&&(r=0),(!e||e<0||e>n)&&(e=n);for(var i="",o=r;o<e;++o)i+=V(t[o]);return i;}function Y(t,r,e){for(var n=t.slice(r,e),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i;}function C(t,r,e){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+r>e)throw new RangeError("Trying to access beyond buffer length");}function D(t,r,e,n,i,o){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>i||r<o)throw new RangeError('"value" argument is out of bounds');if(e+n>t.length)throw new RangeError("Index out of range");}function O(t,r,e,n){r<0&&(r=65535+r+1);for(var i=0,o=Math.min(t.length-e,2);i<o;++i)t[e+i]=(r&255<<8*(n?i:1-i))>>>8*(n?i:1-i);}function L(t,r,e,n){r<0&&(r=4294967295+r+1);for(var i=0,o=Math.min(t.length-e,4);i<o;++i)t[e+i]=r>>>8*(n?i:3-i)&255;}function M(t,r,e,n,i,o){if(e+n>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range");}function N(t,r,e,n,i){return i||M(t,r,e,4,3.4028234663852886e38,-3.4028234663852886e38),K.write(t,r,e,n,23,4),e+4;}function F(t,r,e,n,i){return i||M(t,r,e,8,1.7976931348623157e308,-1.7976931348623157e308),K.write(t,r,e,n,52,8),e+8;}function j(t){if(t=z(t).replace(tt,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t;}function z(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"");}function V(t){return t<16?"0"+t.toString(16):t.toString(16);}function q(t,r){r=r||1/0;for(var e,n=t.length,i=null,o=[],f=0;f<n;++f){if(e=t.charCodeAt(f),e>55295&&e<57344){if(!i){if(e>56319){(r-=3)>-1&&o.push(239,191,189);continue;}if(f+1===n){(r-=3)>-1&&o.push(239,191,189);continue;}i=e;continue;}if(e<56320){(r-=3)>-1&&o.push(239,191,189),i=e;continue;}e=(i-55296<<10|e-56320)+65536;}else i&&(r-=3)>-1&&o.push(239,191,189);if(i=null,e<128){if((r-=1)<0)break;o.push(e);}else if(e<2048){if((r-=2)<0)break;o.push(e>>6|192,63&e|128);}else if(e<65536){if((r-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128);}else{if(!(e<1114112))throw new Error("Invalid code point");if((r-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128);}}return o;}function W(t){for(var r=[],e=0;e<t.length;++e)r.push(255&t.charCodeAt(e));return r;}function J(t,r){for(var e,n,i,o=[],f=0;f<t.length&&!((r-=2)<0);++f)e=t.charCodeAt(f),n=e>>8,i=e%256,o.push(i),o.push(n);return o;}function X(t){return Z.toByteArray(j(t));}function G(t,r,e,n){for(var i=0;i<n&&!(i+e>=r.length||i>=t.length);++i)r[i+e]=t[i];return i;}function H(t){return t!==t;}var Z=t("base64-js"),K=t("ieee754"),Q=t("isarray");e.Buffer=Buffer,e.SlowBuffer=y,e.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==r.TYPED_ARRAY_SUPPORT?r.TYPED_ARRAY_SUPPORT:n(),e.kMaxLength=i(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t;},Buffer.from=function(t,r,e){return f(null,t,r,e);},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,r,e){return a(null,t,r,e);},Buffer.allocUnsafe=function(t){return s(null,t);},Buffer.allocUnsafeSlow=function(t){return s(null,t);},Buffer.isBuffer=function(t){return!(null==t||!t._isBuffer);},Buffer.compare=function(t,r){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(r))throw new TypeError("Arguments must be Buffers");if(t===r)return 0;for(var e=t.length,n=r.length,i=0,o=Math.min(e,n);i<o;++i)if(t[i]!==r[i]){e=t[i],n=r[i];break;}return e<n?-1:n<e?1:0;},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1;}},Buffer.concat=function(t,r){if(!Q(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var e;if(void 0===r)for(r=0,e=0;e<t.length;++e)r+=t[e].length;var n=Buffer.allocUnsafe(r),i=0;for(e=0;e<t.length;++e){var o=t[e];if(!Buffer.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length;}return n;},Buffer.byteLength=v,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<t;r+=2)b(this,r,r+1);return this;},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<t;r+=4)b(this,r,r+3),b(this,r+1,r+2);return this;},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<t;r+=8)b(this,r,r+7),b(this,r+1,r+6),b(this,r+2,r+5),b(this,r+3,r+4);return this;},Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?k(this,0,t):g.apply(this,arguments);},Buffer.prototype.equals=function(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t);},Buffer.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">";},Buffer.prototype.compare=function(t,r,e,n,i){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===r&&(r=0),void 0===e&&(e=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),r<0||e>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&r>=e)return 0;if(n>=i)return-1;if(r>=e)return 1;if(r>>>=0,e>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,f=e-r,u=Math.min(o,f),a=this.slice(n,i),s=t.slice(r,e),c=0;c<u;++c)if(a[c]!==s[c]){o=a[c],f=s[c];break;}return o<f?-1:f<o?1:0;},Buffer.prototype.includes=function(t,r,e){return this.indexOf(t,r,e)!==-1;},Buffer.prototype.indexOf=function(t,r,e){return w(this,t,r,e,!0);},Buffer.prototype.lastIndexOf=function(t,r,e){return w(this,t,r,e,!1);},Buffer.prototype.write=function(t,r,e,n){if(void 0===r)n="utf8",e=this.length,r=0;else if(void 0===e&&"string"==typeof r)n=r,e=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r=0|r,isFinite(e)?(e=0|e,void 0===n&&(n="utf8")):(n=e,e=void 0);}var i=this.length-r;if((void 0===e||e>i)&&(e=i),t.length>0&&(e<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return A(this,t,r,e);case"utf8":case"utf-8":return m(this,t,r,e);case"ascii":return x(this,t,r,e);case"latin1":case"binary":return B(this,t,r,e);case"base64":return U(this,t,r,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,r,e);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0;}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)};};var $=4096;Buffer.prototype.slice=function(t,r){var e=this.length;t=~~t,r=void 0===r?e:~~r,t<0?(t+=e,t<0&&(t=0)):t>e&&(t=e),r<0?(r+=e,r<0&&(r=0)):r>e&&(r=e),r<t&&(r=t);var n;if(Buffer.TYPED_ARRAY_SUPPORT)n=this.subarray(t,r),n.__proto__=Buffer.prototype;else{var i=r-t;n=new Buffer(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t];}return n;},Buffer.prototype.readUIntLE=function(t,r,e){t=0|t,r=0|r,e||C(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return n;},Buffer.prototype.readUIntBE=function(t,r,e){t=0|t,r=0|r,e||C(t,r,this.length);for(var n=this[t+--r],i=1;r>0&&(i*=256);)n+=this[t+--r]*i;return n;},Buffer.prototype.readUInt8=function(t,r){return r||C(t,1,this.length),this[t];},Buffer.prototype.readUInt16LE=function(t,r){return r||C(t,2,this.length),this[t]|this[t+1]<<8;},Buffer.prototype.readUInt16BE=function(t,r){return r||C(t,2,this.length),this[t]<<8|this[t+1];},Buffer.prototype.readUInt32LE=function(t,r){return r||C(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3];},Buffer.prototype.readUInt32BE=function(t,r){return r||C(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3]);},Buffer.prototype.readIntLE=function(t,r,e){t=0|t,r=0|r,e||C(t,r,this.length);for(var n=this[t],i=1,o=0;++o<r&&(i*=256);)n+=this[t+o]*i;return i*=128,n>=i&&(n-=Math.pow(2,8*r)),n;},Buffer.prototype.readIntBE=function(t,r,e){t=0|t,r=0|r,e||C(t,r,this.length);for(var n=r,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*r)),o;},Buffer.prototype.readInt8=function(t,r){return r||C(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t];},Buffer.prototype.readInt16LE=function(t,r){r||C(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e;},Buffer.prototype.readInt16BE=function(t,r){r||C(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e;},Buffer.prototype.readInt32LE=function(t,r){return r||C(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24;},Buffer.prototype.readInt32BE=function(t,r){return r||C(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3];},Buffer.prototype.readFloatLE=function(t,r){return r||C(t,4,this.length),K.read(this,t,!0,23,4);},Buffer.prototype.readFloatBE=function(t,r){return r||C(t,4,this.length),K.read(this,t,!1,23,4);},Buffer.prototype.readDoubleLE=function(t,r){return r||C(t,8,this.length),K.read(this,t,!0,52,8);},Buffer.prototype.readDoubleBE=function(t,r){return r||C(t,8,this.length),K.read(this,t,!1,52,8);},Buffer.prototype.writeUIntLE=function(t,r,e,n){if(t=+t,r=0|r,e=0|e,!n){var i=Math.pow(2,8*e)-1;D(this,t,r,e,i,0);}var o=1,f=0;for(this[r]=255&t;++f<e&&(o*=256);)this[r+f]=t/o&255;return r+e;},Buffer.prototype.writeUIntBE=function(t,r,e,n){if(t=+t,r=0|r,e=0|e,!n){var i=Math.pow(2,8*e)-1;D(this,t,r,e,i,0);}var o=e-1,f=1;for(this[r+o]=255&t;--o>=0&&(f*=256);)this[r+o]=t/f&255;return r+e;},Buffer.prototype.writeUInt8=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[r]=255&t,r+1;},Buffer.prototype.writeUInt16LE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):O(this,t,r,!0),r+2;},Buffer.prototype.writeUInt16BE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):O(this,t,r,!1),r+2;},Buffer.prototype.writeUInt32LE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r+3]=t>>>24,this[r+2]=t>>>16,this[r+1]=t>>>8,this[r]=255&t):L(this,t,r,!0),r+4;},Buffer.prototype.writeUInt32BE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):L(this,t,r,!1),r+4;},Buffer.prototype.writeIntLE=function(t,r,e,n){if(t=+t,r=0|r,!n){var i=Math.pow(2,8*e-1);D(this,t,r,e,i-1,-i);}var o=0,f=1,u=0;for(this[r]=255&t;++o<e&&(f*=256);)t<0&&0===u&&0!==this[r+o-1]&&(u=1),this[r+o]=(t/f>>0)-u&255;return r+e;},Buffer.prototype.writeIntBE=function(t,r,e,n){if(t=+t,r=0|r,!n){var i=Math.pow(2,8*e-1);D(this,t,r,e,i-1,-i);}var o=e-1,f=1,u=0;for(this[r+o]=255&t;--o>=0&&(f*=256);)t<0&&0===u&&0!==this[r+o+1]&&(u=1),this[r+o]=(t/f>>0)-u&255;return r+e;},Buffer.prototype.writeInt8=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[r]=255&t,r+1;},Buffer.prototype.writeInt16LE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8):O(this,t,r,!0),r+2;},Buffer.prototype.writeInt16BE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>8,this[r+1]=255&t):O(this,t,r,!1),r+2;},Buffer.prototype.writeInt32LE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=255&t,this[r+1]=t>>>8,this[r+2]=t>>>16,this[r+3]=t>>>24):L(this,t,r,!0),r+4;},Buffer.prototype.writeInt32BE=function(t,r,e){return t=+t,r=0|r,e||D(this,t,r,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[r]=t>>>24,this[r+1]=t>>>16,this[r+2]=t>>>8,this[r+3]=255&t):L(this,t,r,!1),r+4;},Buffer.prototype.writeFloatLE=function(t,r,e){return N(this,t,r,!0,e);},Buffer.prototype.writeFloatBE=function(t,r,e){return N(this,t,r,!1,e);},Buffer.prototype.writeDoubleLE=function(t,r,e){return F(this,t,r,!0,e);},Buffer.prototype.writeDoubleBE=function(t,r,e){return F(this,t,r,!1,e);},Buffer.prototype.copy=function(t,r,e,n){if(e||(e=0),n||0===n||(n=this.length),r>=t.length&&(r=t.length),r||(r=0),n>0&&n<e&&(n=e),n===e)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-r<n-e&&(n=t.length-r+e);var i,o=n-e;if(this===t&&e<r&&r<n)for(i=o-1;i>=0;--i)t[i+r]=this[i+e];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+r]=this[i+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+o),r);return o;},Buffer.prototype.fill=function(t,r,e,n){if("string"==typeof t){if("string"==typeof r?(n=r,r=0,e=this.length):"string"==typeof e&&(n=e,e=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i);}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n);}else"number"==typeof t&&(t=255&t);if(r<0||this.length<r||this.length<e)throw new RangeError("Out of range index");if(e<=r)return this;r>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0);var o;if("number"==typeof t)for(o=r;o<e;++o)this[o]=t;else{var f=Buffer.isBuffer(t)?t:q(new Buffer(t,n).toString()),u=f.length;for(o=0;o<e-r;++o)this[o+r]=f[o%u];}return this;};var tt=/[^+\/0-9A-Za-z-_]/g;}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});},{"base64-js":30,ieee754:32,isarray:34}],30:[function(t,r,e){"use strict";function n(t){var r=t.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[r-2]?2:"="===t[r-1]?1:0;}function i(t){return 3*t.length/4-n(t);}function o(t){var r,e,i,o,f,u,a=t.length;f=n(t),u=new h(3*a/4-f),i=f>0?a-4:a;var s=0;for(r=0,e=0;r<i;r+=4,e+=3)o=c[t.charCodeAt(r)]<<18|c[t.charCodeAt(r+1)]<<12|c[t.charCodeAt(r+2)]<<6|c[t.charCodeAt(r+3)],u[s++]=o>>16&255,u[s++]=o>>8&255,u[s++]=255&o;return 2===f?(o=c[t.charCodeAt(r)]<<2|c[t.charCodeAt(r+1)]>>4,u[s++]=255&o):1===f&&(o=c[t.charCodeAt(r)]<<10|c[t.charCodeAt(r+1)]<<4|c[t.charCodeAt(r+2)]>>2,u[s++]=o>>8&255,u[s++]=255&o),u;}function f(t){return s[t>>18&63]+s[t>>12&63]+s[t>>6&63]+s[63&t];}function u(t,r,e){for(var n,i=[],o=r;o<e;o+=3)n=(t[o]<<16)+(t[o+1]<<8)+t[o+2],i.push(f(n));return i.join("");}function a(t){for(var r,e=t.length,n=e%3,i="",o=[],f=16383,a=0,c=e-n;a<c;a+=f)o.push(u(t,a,a+f>c?c:a+f));return 1===n?(r=t[e-1],i+=s[r>>2],i+=s[r<<4&63],i+="=="):2===n&&(r=(t[e-2]<<8)+t[e-1],i+=s[r>>10],i+=s[r>>4&63],i+=s[r<<2&63],i+="="),o.push(i),o.join("");}e.byteLength=i,e.toByteArray=o,e.fromByteArray=a;for(var s=[],c=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p=0,d=l.length;p<d;++p)s[p]=l[p],c[l.charCodeAt(p)]=p;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63;},{}],31:[function(t,r,e){function n(){if(!(this instanceof n))return new n();}!function(t){function e(t){for(var r in s)t[r]=s[r];return t;}function n(t,r){return u(this,t).push(r),this;}function i(t,r){function e(){o.call(n,t,e),r.apply(this,arguments);}var n=this;return e.originalListener=r,u(n,t).push(e),n;}function o(t,r){function e(t){return t!==r&&t.originalListener!==r;}var n,i=this;if(arguments.length){if(r){if(n=u(i,t,!0)){if(n=n.filter(e),!n.length)return o.call(i,t);i[a][t]=n;}}else if(n=i[a],n&&(delete n[t],!Object.keys(n).length))return o.call(i);}else delete i[a];return i;}function f(t,r){function e(t){t.call(o);}function n(t){t.call(o,r);}function i(t){t.apply(o,s);}var o=this,f=u(o,t,!0);if(!f)return!1;var a=arguments.length;if(1===a)f.forEach(e);else if(2===a)f.forEach(n);else{var s=Array.prototype.slice.call(arguments,1);f.forEach(i);}return!!f.length;}function u(t,r,e){if(!e||t[a]){var n=t[a]||(t[a]={});return n[r]||(n[r]=[]);}}"undefined"!=typeof r&&(r.exports=t);var a="listeners",s={on:n,once:i,off:o,emit:f};e(t.prototype),t.mixin=e;}(n);},{}],32:[function(t,r,e){e.read=function(t,r,e,n,i){var o,f,u=8*i-n-1,a=(1<<u)-1,s=a>>1,c=-7,h=e?i-1:0,l=e?-1:1,p=t[r+h];for(h+=l,o=p&(1<<-c)-1,p>>=-c,c+=u;c>0;o=256*o+t[r+h],h+=l,c-=8);for(f=o&(1<<-c)-1,o>>=-c,c+=n;c>0;f=256*f+t[r+h],h+=l,c-=8);if(0===o)o=1-s;else{if(o===a)return f?NaN:(p?-1:1)*(1/0);f+=Math.pow(2,n),o-=s;}return(p?-1:1)*f*Math.pow(2,o-n);},e.write=function(t,r,e,n,i,o){var f,u,a,s=8*o-i-1,c=(1<<s)-1,h=c>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,d=n?1:-1,y=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(u=isNaN(r)?1:0,f=c):(f=Math.floor(Math.log(r)/Math.LN2),r*(a=Math.pow(2,-f))<1&&(f--,a*=2),r+=f+h>=1?l/a:l*Math.pow(2,1-h),r*a>=2&&(f++,a/=2),f+h>=c?(u=0,f=c):f+h>=1?(u=(r*a-1)*Math.pow(2,i),f+=h):(u=r*Math.pow(2,h-1)*Math.pow(2,i),f=0));i>=8;t[e+p]=255&u,p+=d,u/=256,i-=8);for(f=f<<i|u,s+=i;s>0;t[e+p]=255&f,p+=d,f/=256,s-=8);t[e+p-d]|=128*y;};},{}],33:[function(t,r,e){(function(Buffer){var t,r,n,i;!function(e){function o(t,r,n){function i(t,r,e,n){return this instanceof i?v(this,t,r,e,n):new i(t,r,e,n);}function o(t){return!(!t||!t[F]);}function v(t,r,e,n,i){if(E&&A&&(r instanceof A&&(r=new E(r)),n instanceof A&&(n=new E(n))),!(r||e||n||g))return void(t.buffer=h(m,0));if(!s(r,e)){var o=g||Array;i=e,n=r,e=0,r=new o(8);}t.buffer=r,t.offset=e|=0,b!==typeof n&&("string"==typeof n?x(r,e,n,i||10):s(n,i)?c(r,e,n,i):"number"==typeof i?(k(r,e+T,n),k(r,e+S,i)):n>0?O(r,e,n):n<0?L(r,e,n):c(r,e,m,0));}function x(t,r,e,n){var i=0,o=e.length,f=0,u=0;"-"===e[0]&&i++;for(var a=i;i<o;){var s=parseInt(e[i++],n);if(!(s>=0))break;u=u*n+s,f=f*n+Math.floor(u/B),u%=B;}a&&(f=~f,u?u=B-u:f++),k(t,r+T,f),k(t,r+S,u);}function P(){var t=this.buffer,r=this.offset,e=_(t,r+T),i=_(t,r+S);return n||(e|=0),e?e*B+i:i;}function R(t){var r=this.buffer,e=this.offset,i=_(r,e+T),o=_(r,e+S),f="",u=!n&&2147483648&i;for(u&&(i=~i,o=B-o),t=t||10;;){var a=i%t*B+o;if(i=Math.floor(i/t),o=Math.floor(a/t),f=(a%t).toString(t)+f,!i&&!o)break;}return u&&(f="-"+f),f;}function k(t,r,e){t[r+D]=255&e,e>>=8,t[r+C]=255&e,e>>=8,t[r+Y]=255&e,e>>=8,t[r+I]=255&e;}function _(t,r){return t[r+I]*U+(t[r+Y]<<16)+(t[r+C]<<8)+t[r+D];}var T=r?0:4,S=r?4:0,I=r?0:3,Y=r?1:2,C=r?2:1,D=r?3:0,O=r?l:d,L=r?p:y,M=i.prototype,N="is"+t,F="_"+N;return M.buffer=void 0,M.offset=0,M[F]=!0,M.toNumber=P,M.toString=R,M.toJSON=P,M.toArray=f,w&&(M.toBuffer=u),E&&(M.toArrayBuffer=a),i[N]=o,e[t]=i,i;}function f(t){var r=this.buffer,e=this.offset;return g=null,t!==!1&&0===e&&8===r.length&&x(r)?r:h(r,e);}function u(t){var r=this.buffer,e=this.offset;if(g=w,t!==!1&&0===e&&8===r.length&&Buffer.isBuffer(r))return r;var n=new w(8);return c(n,0,r,e),n;}function a(t){var r=this.buffer,e=this.offset,n=r.buffer;if(g=E,t!==!1&&0===e&&n instanceof A&&8===n.byteLength)return n;var i=new E(8);return c(i,0,r,e),i.buffer;}function s(t,r){var e=t&&t.length;return r|=0,e&&r+8<=e&&"string"!=typeof t[r];}function c(t,r,e,n){r|=0,n|=0;for(var i=0;i<8;i++)t[r++]=255&e[n++];}function h(t,r){return Array.prototype.slice.call(t,r,r+8);}function l(t,r,e){for(var n=r+8;n>r;)t[--n]=255&e,e/=256;}function p(t,r,e){var n=r+8;for(e++;n>r;)t[--n]=255&-e^255,e/=256;}function d(t,r,e){for(var n=r+8;r<n;)t[r++]=255&e,e/=256;}function y(t,r,e){var n=r+8;for(e++;r<n;)t[r++]=255&-e^255,e/=256;}function v(t){return!!t&&"[object Array]"==Object.prototype.toString.call(t);}var g,b="undefined",w=b!==typeof Buffer&&Buffer,E=b!==typeof Uint8Array&&Uint8Array,A=b!==typeof ArrayBuffer&&ArrayBuffer,m=[0,0,0,0,0,0,0,0],x=Array.isArray||v,B=4294967296,U=16777216;t=o("Uint64BE",!0,!0),r=o("Int64BE",!0,!1),n=o("Uint64LE",!1,!0),i=o("Int64LE",!1,!1);}("object"==typeof e&&"string"!=typeof e.nodeName?e:this||{});}).call(this,t("buffer").Buffer);},{buffer:29}],34:[function(t,r,e){var n={}.toString;r.exports=Array.isArray||function(t){return"[object Array]"==n.call(t);};},{}]},{},[1])(1);});;var Player=$i_56.extend({classId:'Player',componentId:'player',init:function(data,entityIdFromServer){$i_56.prototype.init.call(this);this.id(entityIdFromServer);var self=this;this._stats=data;// dont save variables in _stats as _stats is stringified and synced
// and some variables of type unit, item, projectile may contain circular json objects
if(self._stats.variables){self.variables=self._stats.variables;delete self._stats.variables;}self.previousAttributes={};self.lastCustomInput='';Player.prototype.log(`player created ${this.id()}`);this.category('player');this.mount(ige.$('baseScene'));self.addComponent(AttributeComponent);if(ige.isServer){this.streamMode(2);// self._stats.unitId = self.getCurrentUnit().id()
self.addComponent(ControlComponent);ige.server.totalPlayersCreated++;}else if(ige.isClient){// if this player is "me"
if(self._stats.clientId==ige.network.id()){self.addComponent(ControlComponent);// mouse move listener
ige.client.vp1.mouseMove(function(event,control){self.control.mouseMove();});this.setChatMute(this._stats.banChat);}// redraw name labels and textures of all units owned by this player
self.redrawUnits(function(unit){return unit&&unit.getOwner()&&unit.getOwner().id()===self.id();},['texture','nameLabel']);}if(ige.isClient){ige.pixi.trackEntityById[entityIdFromServer]=this;}},// move to UI
joinGame:function(){var self=this;if(self._stats.userId){ige.clusterClient.userJoined(self._stats.userId);}if(self._stats.playerJoined!=true){if(self._stats.controlledBy=='human'&&ige.script)// do not send trigger for neutral player
{ige.trigger.fire('playerJoinsGame',{playerId:self.id()});}var clientId=self._stats.clientId;var client=ige.server.clients[clientId];var receivedJoinGame=client.receivedJoinGame;var processedJoinGame=Date.now()-receivedJoinGame;var dataLoadTime=self._stats.totalTime;client.lastEventAt=Date.now();var playerJoinStreamData=[{streamedOn:Date.now()},{playerJoined:true},{dataLoadTime:dataLoadTime},{processedJoinGame:processedJoinGame},{receivedJoinGame:receivedJoinGame}];console.log(`Player.joinGame(): sending ACK to client ${self._stats.clientId} ${self._stats.name} (time elapsed: ${Date.now()-client.lastEventAt})`,playerJoinStreamData);self.streamUpdateData(playerJoinStreamData);ige.clusterClient&&ige.clusterClient.playerJoined(self._stats.userId);}else{console.log(`player joined again (menu closed?) ${self._stats.clientId} (${self._stats.name})`);self.streamUpdateData([{playerJoinedAgain:true}]);}},createUnit:function(data){var self=this;if(ige.isServer){var data=Object.assign(data,{clientId:self._stats.clientId,name:self._stats.name});// console.log("player.createUnit", data)
var unit=new Unit(data);unit.setOwnerPlayer(self.id());// setOwner will add unitId to unitIds
// self._stats.unitIds.push(unit.id())
Player.prototype.log(`created unit ${unit.id()} for ${self._stats.name} (${self._stats.clientId})`);return unit;}},ownUnit:function(unit){if(this._stats.unitIds.indexOf(unit.id())==-1&&unit.id()!='ige'){this._stats.unitIds.push(unit.id());}// if player has only 1 unit, then select that unit
if(this._stats.unitIds.length===1){this.selectFirstAvailableUnit();}},// remove unit from the array of units owned by this player
disownUnit:function(unit){var index=this._stats.unitIds.indexOf(unit.id());if(index!==-1){this._stats.unitIds.splice(index,1);}},// make player select a unit and do the following:
// 1. camera track (if this is the only unit)
// 2. update inventory
// 3. update attribute bars
selectUnit:function(unitId){var self=this;self._stats.selectedUnitId=unitId;if(ige.isServer&&self._stats.clientId){ige.network.send('makePlayerSelectUnit',{unitId:unitId},self._stats.clientId);var unit=ige.$(unitId);}if(ige.isClient){var unit=ige.$(unitId);// console.log(self._stats.name, "is selecting unit", unit._stats.type)
if(self._stats.clientId==ige.network.id()&&unit&&unit._category=='unit'){// unit._pixiTexture.interactive = true;
// unit._pixiTexture.mousemove = function (e) {
// 	ige.client.newMousePosition = e.data.getLocalPosition(ige.client.mouseMove)
// }
if(unit.inventory){unit.inventory.createInventorySlots();}if(unit.unitUi){unit.unitUi.updateAllAttributeBars();}if(unit&&unit.inventory){unit.inventory.updateBackpackButton();}unit.renderMobileControl();ige.client.selectedUnit=unit;ige.client.eventLog.push([ige._currentTime,`my unit selected ${unitId}`]);if(ige.env=='local'){var graphics=new PIXI.Graphics();graphics.lineStyle(2,0x0000FF,0.5);graphics.beginFill(0xFF700B,0.3);graphics.drawRect(0,0,unit.width(),unit.height());graphics=ige.pixi.app.renderer.generateTexture(graphics);graphics=new PIXI.Sprite(graphics);graphics.rotation=unit._rotate.z;graphics.pivot.set(unit.width/2,unit.height/2);var container=new PIXI.Container();container.addChild(graphics);container.position.set(unit._translate.x,unit._translate.y);container.pivot.set(unit.width/2,unit.height/2);container.zIndex=10;unit._debugEntity=container;ige.pixi.box2dDebug.addChild(container);}}}},cameraTrackUnit:function(unit){var self=this;if(unit){// self._stats.selectedUnitId = unit.id()
if(ige.isServer&&self._stats.clientId){ige.network.send('makePlayerCameraTrackUnit',{unitId:unit.id()},self._stats.clientId);}else if(ige.isClient&&self._stats.clientId==ige.network.id()&&unit&&unit._category=='unit'&&ige.pixi.trackEntityById[unit._id]){ige.client.myPlayer.currentFollowUnit=unit._id;ige.pixi.viewport.follow(ige.pixi.trackEntityById[unit._id]);// ige.client.removeOutsideEntities = true;
unit.emit('follow');}}},changeCameraPanSpeed:function(panSpeed){var self=this;if(ige.isServer&&self._stats.clientId){ige.network.send('changePlayerCameraPanSpeed',{panSpeed:panSpeed},self._stats.clientId);}else if(ige.isClient&&self._stats.clientId==ige.network.id()&&panSpeed!==undefined){ige.client.vp1.camera.trackTranslateSmoothing(panSpeed);}},// get selectedUnits' 0th index unit
selectFirstAvailableUnit:function(){if(this._stats.unitIds){var unit=ige.$(this._stats.unitIds[0]);if(unit){this.selectUnit(unit.id());}}},getSelectedUnit:function(){// console.log(ige.$(this._stats.selectedUnitId).id())
return ige.$(this._stats.selectedUnitId);},castAbility:function(command){var self=this;var units=ige.game.getUnitsByClientId(this._stats.clientId);for(i in units){var unit=units[i];if(unit){var unitType=ige.game.getAsset('unitTypes',unit._stats.type);if(unitType&&unitType.abilities){var ability=unitType.abilities[command];if(ability){unit.ability.cast(ability);}}}}},updatePlayerType:function(data){var self=this;// pass old attributes' values to new attributes (given that attributes have same ID)
if(self._stats.attributes!=undefined){var oldAttributes=JSON.parse(JSON.stringify(self._stats.attributes));for(attrId in data.attributes){if(oldAttributes[attrId]!=undefined){data.attributes[attrId].value=oldAttributes[attrId].value;data.attributes[attrId].max=oldAttributes[attrId].max;}}}self._stats.attributes=data.attributes;if(data.variables){var variables={};for(var key in data.variables){if(self.variables&&self.variables[key]){variables[key]=self.variables[key]==undefined?data.variables[key]:self.variables[key];}else{variables[key]=data.variables[key];}}self.variables=variables;}if(self._stats.variables){delete self._stats.variables;}if(ige.isClient){var isMyPlayerUpdated=self._stats.clientId==ige.network.id();// show name label can be false for assignedPlyerType so updateNameLabel accordingly
self.redrawUnits(function(unit){var owner=unit.getOwner();return owner&&owner.id()===self.id();},['nameLabel','texture']);// update attr bars of all units
self.redrawUnits(function(unit){var ownerPlayer=unit.getOwner();return isMyPlayerUpdated||ownerPlayer&&ownerPlayer.id()===self.id();},['attributeBars']);if(isMyPlayerUpdated){// update UI
ige.playerUi.updatePlayerAttributesDiv(self._stats.attributes);}if(ige.scoreboard){ige.scoreboard.update();}}},getUnitCount:function(){var units=this._stats.unitIds;if(units)return Object.keys(units).length;return 0;},// if any player feels hostile towards another, then it's a hostile relationship
isHostileTo:function(player){if(player==undefined){return false;}var myPlayerType=ige.game.getAsset('playerTypes',this._stats.playerTypeId);if(myPlayerType&&myPlayerType.relationships){if(myPlayerType.relationships[player._stats.playerTypeId]=='hostile')return true;}return false;},// if both players are friendly to each other, then it's a friendly relationship
isFriendlyTo:function(player){if(player==undefined){return false;}var myPlayerType=ige.game.getAsset('playerTypes',this._stats.playerTypeId);if(myPlayerType&&myPlayerType.relationships){if(myPlayerType.relationships[player._stats.playerTypeId]=='friendly'){return true;}}return false;},// if both players are non-hostile but not friendly, then it's a neutral relationship
isNeutralTo:function(player){return this.isHostileTo(player)==false&&this.isFriendlyTo(player)==false;},remove:function(){if(this._stats.controlledBy=='human'&&ige.script)// do not send trigger for neutral player
{ige.trigger.fire('playerLeavesGame',{playerId:this.id()});}// session is in second
ige.clusterClient&&ige.clusterClient.emit('log-session-duration',(Date.now()-this._stats.jointsOn)/1000);if(this.variables&&this.variables.progression!=undefined&&this.variables.progression.value!=undefined){ige.clusterClient&&ige.clusterClient.emit('log-progression',this.variables.progression.value);}this.streamDestroy();this.destroy();},updateVisibility:function(playerId){var player=ige.$(playerId);if(!player){return;}// make hostile-invisible units invisible and friendly & neutral units visible (and its item)
this.redrawUnits(function(unit){var owner=unit.getOwner();return owner!=undefined&&owner.id()==playerId;},['texture','nameLabel']);// make the items visible/invisible that belongs to any unit of this player
ige.$$('item').forEach(function(item){var ownerUnit=item.getOwnerUnit();var ownerPlayer=ownerUnit&&ownerUnit.getOwner();var belongsToCurrentPlayer=ownerPlayer&&ownerPlayer.id()===playerId;if(belongsToCurrentPlayer){item.updateTexture();}});},// update player's stats in the server side first, then update client side as well.
streamUpdateData:function(queuedData){var self=this;var oldStats=JSON.parse(JSON.stringify(self._stats));$i_56.prototype.streamUpdateData.call(this,queuedData);for(var i=0;i<queuedData.length;i++){var data=queuedData[i];for(attrName in data){var newValue=data[attrName];// if player's type changed, then update all of its base stats (speed, stamina, etc..)
if(attrName==='playerTypeId'){var playerTypeData=ige.game.getAsset('playerTypes',newValue);if(playerTypeData){playerTypeData.playerTypeId=newValue;if(ige.isClient){// change color of label of all units that belongs to updating player
self.redrawUnits(function(unit){// dont update color if unitType of my unit is changed on my screen as it will be always Lime
var isMyPlayerUpdated=self._stats.clientId===ige.network.id();// update color of all units that belongs to player whose playerType just changed
var ownerPlayer=unit.getOwner();var unitBelongsToUpdatingPlayer=ownerPlayer&&ownerPlayer.id()===self.id();return!isMyPlayerUpdated&&unitBelongsToUpdatingPlayer;},['nameLabel']);}self.updatePlayerType(playerTypeData);}}if(ige.isServer){if(attrName==='name'&&oldStats.name!==newValue){// update all units
self._stats.unitIds.forEach(function(unitId){var unit=ige.$(unitId);unit.streamUpdateData([{name:newValue}]);});}else if(attrName==='playerJoined'&&newValue==false){// player's been kicked/removed
self.remove();}}if(ige.isClient){if(attrName==='name'){// update here
if(typeof refreshUserName=='function'){refreshUserName(newValue);}}if(attrName==='equiped'){var unit=self.getSelectedUnit();if(unit){unit.equipSkin();}}else if(attrName==='unEquiped'){var unit=self.getSelectedUnit();if(unit){unit.unEquipSkin(null,false,newValue);}}if(self._stats.clientId==ige.network.id()){if(attrName==='attributes'){ige.playerUi.updatePlayerAttributesDiv(self._stats.attributes);}if(attrName==='coins'){ige.playerUi.updatePlayerCoin(newValue);}if(attrName==='playerJoinedAgain'){self.hideMenu();}if(attrName==='banChat'){self.setChatMute(newValue);}if(attrName==='playerJoined'){console.log('received player.playerJoined');ige.client.eventLog.push([ige._currentTime,'playerJoined received']);// render name labels of all other units
self.redrawUnits(['nameLabel']);self._stats.receivedJoinGame=data.receivedJoinGame;ige.client.eventLog.push([ige._currentTime-ige.client.eventLogStartTime,'\'playerJoined\' received from server']);self._stats.processedJoinGame=data.processedJoinGame;var streamingDiff=`${Date.now()-data.streamedOn}ms`;window.joinGameSent.end=Date.now();window.joinGameSent.completed=window.joinGameSent.end-window.joinGameSent.start;console.log(`JoinGame took ${window.joinGameSent.completed}ms to join player`+`, client to gs: ${self._stats.receivedJoinGame-window.joinGameSent.start}ms`+`, gs loading player data: ${self._stats.totalTime}ms`+`, gs processed request for: ${self._stats.processedJoinGame}ms`+`, gs to client: ${streamingDiff}, client sent on: ${window.joinGameSent.start}, server sent back on: ${data.streamedOn}`);if(window.joinGameSent.completed>7000){$.post('/api/log',{event:'rollbar',text:`${Date.now()}:- JoinGame took ${window.joinGameSent.completed}ms to join player`+`, client to gs: ${self._stats.receivedJoinGame-window.joinGameSent.start}ms`+`, gs loading player data: ${self._stats.totalTime}ms`+`, gs processed request for: ${self._stats.processedJoinGame}ms`+`, gs to client: ${streamingDiff}, client sent on: ${window.joinGameSent.start}, server sent back on: ${data.streamedOn}`});}if(self._stats.processedJoinGame>7000){$.post('/api/log',{event:'rollbar',text:`${Date.now()}JoinGame took ${window.joinGameSent.completed}ms to create player`+`, client to gs: ${self._stats.receivedJoinGame-window.joinGameSent.start}ms`+`, gs loading player data: ${self._stats.totalTime}ms`+`, gs processed request for: ${self._stats.processedJoinGame}ms`+`, gs to client: ${streamingDiff}, client sent on: ${window.joinGameSent.start}, server sent back on: ${data.streamedOn}`});}self.hideMenu();clearTimeout(window.errorLogTimer);}}if(attrName==='banChat'&&(ige.game.data.isDeveloper||ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod)){ige.menuUi.kickPlayerFromGame();}}}}},setChatMute:function(value){if(ige.env=='local')// don't mute users in dev env
return;if(value){$('#message').attr('disabled',true);$('#message').attr('placeholder','you are muted');}else{$('#message').attr('disabled',false);$('#message').attr('placeholder','message');}},redrawUnits:function(filterFn,properties){if(filterFn instanceof Array){properties=filterFn;filterFn=null;}ige.$$('unit').filter(function(unit){return filterFn?filterFn(unit):true;}).forEach(function(unit){properties.forEach(function(property){switch(property){case'nameLabel':{unit.updateNameLabel();break;}case'texture':{unit.updateTexture();break;}case'attributeBars':{unit.redrawAttributeBars();break;}}});});},updatePlayerHighscore:function(){var self=this;var scoreId=ige.game.data.settings.scoreAttributeId;try{// comparing player highscore with current highscore. if current highscore is greter then request it to update server
if(scoreId&&self._stats&&self._stats.attributes&&self._stats.attributes[scoreId]&&(self._stats.highscore<self._stats.newHighscore||self._stats.highscore<self._stats.attributes[scoreId].value)){var score=Math.max(self._stats.newHighscore||0,self._stats.attributes[ige.game.data.settings.scoreAttributeId].value||0);if(score>self._stats.highscore){// highscore updated
request({method:'POST',url:`${global.beUrl}/api/user/updatehighscore`,body:{userId:self._stats.userId,highscore:score,gameId:ige.game.data.defaultData._id,source:'gs'},json:true},err=>{if(err){console.log(err);}});}}}catch(e){Player.prototype.log(e);}},tick:function(ctx){// if entity (unit/item/player/projectile) has attribute, run regenerate
if(ige.isServer){if(this.attribute){this.attribute.regenerate();}}$i_56.prototype.tick.call(this,ctx);},loadPersistentData:function(){var self=this;var persistData=_.cloneDeep(self.persistedData);if(persistData&&persistData.data&&persistData.data.player){$i_56.prototype.loadPersistentData.call(this,persistData.data.player);}console.log('load persisted data is now true');self.persistentDataLoaded=true;},loadDataFromString:function(data){var self=this;var persistData=data;if(persistData){$i_56.prototype.loadPersistentData.call(this,persistData);}self.persistentDataLoaded=true;},hideMenu:function(){if(ige.isClient){// UI related changes like hiding menu, etc...
$('#play-game-button').removeAttr('disabled');var html='<i class="fa fa-gamepad pr-2 py-3" aria-hidden="true"></i>Continue';$('#play-game-button .content').html(html);$('#modd-shop-div').addClass('d-flex');ige.client.eventLog.push([ige._currentTime-ige.client.eventLogStartTime,'hide menu called']);ige.menuUi.hideMenu();// if player's already joined the game, then just hide menu when "play game" button is clicked
if(!ige.client.guestmode){$('.open-menu-button').show();}if(typeof userId!=='undefined'&&typeof sessionId!=='undefined'){if(ige.game.data.isDeveloper){// dont show dev menu by default
// if (ige.mobileControls && !ige.mobileControls.isMobile) {
// 	$("#dev-console").show() // if user has access of this game, show dev console
// }
// $('#game-suggestions-card').removeClass('d-xl-block');
// $("#invite-players-card").show();
$('#toggle-dev-panels').show();$('#kick-player').show();}if(ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod){$('#kick-player').show();}}}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=Player;};var ClientScore=$i_59.extend({classId:'ClientScore',init:function(score){$i_59.prototype.init.call(this);this.depth(1).layer(20000).width(400).height(80).texture(ige.client.fontTexture).textLineSpacing(0).text(score).hide();},start:function(inMs){var self=this;if(inMs){setTimeout(function(){self.start();},inMs);return;}this.show();this._translate.tween().duration(1000).properties({y:this._translate.y-25}).afterTween(function(){self.tween().duration(300).properties({_opacity:0}).afterTween(function(){self.destroy();}).start();}).start();}});;var MiniMapUnit=$i_56.extend({classId:'MiniMapUnit',componentId:'miniMapUnit',init:function(color='0x00FF00'){// $i_57.prototype.init.call(this);
this.category('minimapUnit');if(!ige.miniMap.miniMap)return this;var graphics=new PIXI.Graphics();graphics.beginFill(color);// set the line style to have a width of 5 and set the color to red
graphics.lineStyle(5,color);if(ige.miniMap.mapScale){graphics.drawRect(0,0,5/ige.miniMap.mapScale.y,5/ige.miniMap.mapScale.x);}else{graphics.drawRect(0,0,70,70);// this.height(70);
// this.width(70);
}graphics.zIndex=10;graphics.depth=1;this._pixiTexture=graphics;if(ige.miniMap.miniMap)ige.miniMap.miniMap.addChild(this._pixiTexture);return this;},destroy:function(){if(ige.miniMap.miniMap){ige.miniMap.miniMap.removeChild(this._pixiTexture);this._pixiTexture.destroy(true);}$i_56.prototype.destroy.call(this);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=MiniMapUnit;};var ClientNetworkEvents={_onClientDisconnect:function(data){var clientId=data.clientId;// console.log("diskonnekt", clientId, ige.network.id())
// if it's me that got disconnected!
if(clientId==ige.network.id()){$('#disconnect-reason').html(data.reason);ige.menuUi.onDisconnectFromServer('clientNetworkEvents #10',data.reason);}},_onUpdateAllEntities:function(data){// console.log("_onUpdateAllEntities", data)
for(entityId in data){var entity=ige.$(entityId);if(ige.client.entityUpdateQueue[entityId]==undefined){ige.client.entityUpdateQueue[entityId]=[];}if(ige.client.isActiveTab){var stats=data[entityId];for(key in stats){if(stats[key]!=undefined){// use for mounting offscreen entitys when it starts firing
if(entity&&entity._category==='item'&&stats[key].isBeingUsed!=undefined){entity.isBeingUsed=stats[key].isBeingUsed;}// console.log(entityId, stats[key])
ige.client.entityUpdateQueue[entityId].push(stats[key]);}}}else{// if user's current browser tab isn't this game.
// merging data
if(ige.client.inactiveTabEntityStream[entityId]===undefined){ige.client.inactiveTabEntityStream[entityId]=[];}ige.client.inactiveTabEntityStream[entityId]=_.merge(ige.client.inactiveTabEntityStream[entityId],data[entityId]);}}},_onTeleport:function(data){var entity=ige.$(data.entityId);if(entity&&data.position){// console.log("teleporting",data.entityId , " to", data.position)
entity.teleportTo(data.position[0],data.position[1]);}},_onMakePlayerSelectUnit:function(data){if(data.unitId){if(ige.client.entityUpdateQueue[data.unitId]==undefined){ige.client.entityUpdateQueue[data.unitId]=[];}// in case the unit doesn't exist when player tries to select it, we're pushing the command into entityUpdateQueue
ige.client.entityUpdateQueue[data.unitId].push({makePlayerSelectUnit:true});}},_onMakePlayerCameraTrackUnit:function(data){if(data.unitId){if(ige.client.entityUpdateQueue[data.unitId]==undefined){ige.client.entityUpdateQueue[data.unitId]=[];}// in case the unit doesn't exist when player camera tries to track it, we're pushing the command into entityUpdateQueue
ige.client.entityUpdateQueue[data.unitId].push({makePlayerCameraTrackUnit:true});}},_onChangePlayerCameraPanSpeed:function(data){if(data.panSpeed!==undefined){ige.client.myPlayer.changeCameraPanSpeed(data.panSpeed);}},_onHideUnitFromPlayer:function(data){if(data.unitId){if(ige.client.entityUpdateQueue[data.unitId]==undefined){ige.client.entityUpdateQueue[data.unitId]=[];}// in case the unit doesn't exist when player camera tries to track it, we're pushing the command into entityUpdateQueue
ige.client.entityUpdateQueue[data.unitId].push({hideUnit:true});}},_onShowUnitFromPlayer:function(data){if(data.unitId){if(ige.client.entityUpdateQueue[data.unitId]==undefined){ige.client.entityUpdateQueue[data.unitId]=[];}// in case the unit doesn't exist when player camera tries to track it, we're pushing the command into entityUpdateQueue
ige.client.entityUpdateQueue[data.unitId].push({showUnit:true});}},_onHideUnitNameLabelFromPlayer:function(data){if(data.unitId){if(ige.client.entityUpdateQueue[data.unitId]==undefined){ige.client.entityUpdateQueue[data.unitId]=[];}// in case the unit doesn't exist when player camera tries to track it, we're pushing the command into entityUpdateQueue
ige.client.entityUpdateQueue[data.unitId].push({hideNameLabel:true});}},_onShowUnitNameLabelFromPlayer:function(data){if(data.unitId){if(ige.client.entityUpdateQueue[data.unitId]==undefined){ige.client.entityUpdateQueue[data.unitId]=[];}// in case the unit doesn't exist when player camera tries to track it, we're pushing the command into entityUpdateQueue
ige.client.entityUpdateQueue[data.unitId].push({showNameLabel:true});}},_onOpenShop:function(data){if(data.type){var shopName=ige.game.data.shops[data.type]?ige.game.data.shops[data.type].name:'Item shop';$('#modd-item-shop-header').text(shopName);ige.shop.openItemShop(data.type);$('#modd-item-shop-modal').modal('show');var player=ige.client.myPlayer;if(typeof countAdImpression==='function'&&player&&!player._stats.isAdBlockEnabled){countAdImpression(gameId,'shop');}}},_onCreateFloatingText:function(data){new IgePixiFloatingText(data.text,{shouldBeBold:false,isFadeUp:true,parent:ige.pixi.world,translate:{x:data.position.x,y:data.position.y}}).layer(3).depth(3).colorOverlay(data.color||'white').transformPixiEntity(data.position.x,data.position.y).mount(ige.pixi.world).fadeUp();},_onOpenDialogue:function(data){if(data.type){ige.playerUi.openDialogueModal(data.type,data.extraData);}},_onCloseDialogue:function(data){ige.playerUi.closeDialogueModal();},_onUpdateEntityAttribute:function(data){var entityId=data.e;var attrId=data.a;var value=data.x;var property=data.p;var entity=ige.$(entityId);if(entity&&entity._stats&&entity._stats.attributes&&entity._stats.attributes[attrId]){entity._stats.attributes[attrId][property]=value;}},_onUpdateUiTextForTime:function(data){$(`.ui-text-${data.target}`).show();$(`.ui-text-${data.target}`).html(data.value);if(data.time&&data.time>0){if(this.textTimer){clearTimeout(this.textTimer);}var that=this;this.textTimerData={target:data.target};this.textTimer=setTimeout(function(){$(`.ui-text-${that.textTimerData.target}`).hide();},data.time);}},_onUpdateUiText:function(data){// console.log("updating UI text", data)
if(data.action=='show'){$(`.ui-text-${data.target}`).show();}else if(data.action=='hide'){$(`.ui-text-${data.target}`).hide();}else{$(`.ui-text-${data.target}`).html(data.value);}},_onAlertHighscore:function(data){// $('.highscore-text').html('You set a new personal highscore!').show();
// setTimeout(function () {
// 	$('.highscore-text').hide()
// }, 5000);
},// _onStartParticle: function(data)
_onItem:function(data){var item=ige.$(data.id);if(item){if(item._category=='item'){var ownerUnit=item.getOwnerUnit();if(data.type=='use'&&ownerUnit&&ownerUnit!=ige.client.selectedUnit){item.use();}else if(data.type=='stop'){item.stopUsing();}else if(data.type=='reload'){item.reload();}}else{if(data.type=='hit'){item.effect.start('bulletHit');}}}},_onUi:function(data){switch(data.command){case'openItemShop':ige.shop.openModdShop('item');break;case'openUnitShop':ige.shop.openModdShop('unit');break;case'closeShop':ige.shop.closeShop();break;case'showMenuAndSelectCurrentServer':case'showMenu':ige.menuUi.showMenu();break;case'showMenuAndSelectBestServer':ige.menuUi.showMenu(true);break;case'showInputModal':ige.playerUi.showInputModal(data);break;case'showCustomModal':ige.playerUi.showCustomModal(data);break;case'openWebsite':ige.playerUi.openWebsite(data);break;case'showWebsiteModal':ige.playerUi.showWebsiteModal(data);break;case'showSocialShareModal':ige.playerUi.showSocialShareModal(data);break;case'showFriendsModal':ige.playerUi.showFriendsModal(data);break;case'shopResponse':ige.shop.purchaseWarning(data.type);break;}},_onPlayAd:function(data){var player=ige.client.myPlayer;if(typeof countAdImpression==='function'&&player&&!player._stats.isAdBlockEnabled){countAdImpression(gameId,'video');}ige.ad.play(data);},_onVideoChat:function(data){if(data.command){switch(data.command){case'joinGroup':switchRoom(data.groupId);break;case'leaveGroup':switchRoom(myID);break;}}console.log('videoChat',data);},_onUserJoinedGame:function(data){var user=data.user;var server=data.server;var game=data.game;var gameName=data.gameName;var gameSlug=data.gameSlug;var friend=null;if(typeof allFriends!='undefined'){for(var i in allFriends){var friendObj=allFriends[i];if(friendObj._id===user){friend=friendObj;break;}}if(friend&&friend.local){var gameLink=$(`.${friend._id}-game-list`);var url=`/play/${gameSlug}?server=${server}&joinGame=true`;if(server){var friendName=friend.local.username;// causing error player disconnect
// ige.chat.xssFilters.inHTMLData(friend.local.username);
var message=`${friendName} is now playing ${gameName}<a class="text-light ml-2 text-decoration" href="${url}" style="text-decoration: underline;">Join</a>`;// add message in chat
ige.chat.postMessage({text:message,isHtml:true});// update game link in friend list
if(gameLink){friend.currentServers=[{id:server,gameSlug:gameSlug,gameName:gameName}];}}else{// user left the server so all we have is userId so clear the game-list text
friend.currentServers=[];}// sort the friend array
allFriends.sort(function(a,b){return b.currentServers.length-a.currentServers.length;});renderAllFriendsPanel();renderFriendTabInGame();}}},_onBuySkin:function(skinHandle){$(`.btn-buy-skin[name='${skinHandle}']`).html('Purchased');},// _onTradeRequest: function (data) {
// 	$("#trader-name").html(data.name)
// 	if (data.initatedByMe) {
// 		$("#trade-request-message").html("requesting " + data.name + " to trade")
// 		$("#accept-trade-request-button").hide()
// 	}
// 	else {
// 		$("#trade-request-message").html(data.name + " wants to trade")
// 		$("#accept-trade-request-button").show()
// 	}
// 	$("#trade-request-div").show();
// },
// _onTrade: function (data) {
// 	$("#trade-message").html("");
// 	if (data.cmd == 'start') {
// 		$("#trade-request-div").hide();
// 		$("#trade-div").show();
// 	}
// 	else if (data.cmd == 'offer') {
// 		if (parseInt(data.originSlotNumber) > 12) {
// 			ige.client.tradeOffers[parseInt(data.originSlotNumber) - 12] = data.originSlotItem
// 		}
// 		if (parseInt(data.destinationSlotNumber) > 12) {
// 			ige.client.tradeOffers[parseInt(data.destinationSlotNumber) - 12] = data.destinationSlotItem
// 		}
// 		$("#trade-message").html($("#trader-name").html() + " changed item")
// 		ige.client.updateTradeOffer()
// 	}
// 	else if (data.cmd == 'noRoom') {
// 		$("#trade-message").html("No room in inventory")
// 	}
// 	else if (data.cmd == 'accept') {
// 		$("#trade-message").html($("#trader-name").html() + " accepted")
// 	}
// 	else if (data.cmd == 'close') // cancels both trade & trade-request
// 	{
// 		ige.game.closeTrade()
// 	}
// },
_onDevLogs:function(data){ige.variable.updateDevConsole(data);},_onTrade:function(msg,clientId){switch(msg.type){case'init':{var player=ige.$(msg.from);if(player&&player._category==='player'){ige.tradeUi.initiateTradeRequest(player);}break;}case'start':{var playerA=ige.$(msg.between.playerA);var playerB=ige.$(msg.between.playerB);if(playerA&&playerA._category==='player'&&playerB&&playerB._category==='player'){ige.tradeUi.startTrading(playerA,playerB);}break;}case'offer':{var from=ige.$(msg.from);var to=ige.$(msg.to);if(from&&to&&from.tradingWith===to.id()){ige.tradeUi.receiveOfferingItems(msg.tradeItems);}break;}case'success':{var playerA=ige.$(msg.between.playerA);var playerB=ige.$(msg.between.playerB);delete playerA.tradingWith;delete playerB.tradingWith;delete playerA.isTrading;delete playerB.isTrading;$('#trade-div').hide();break;}case'cancel':{var playerA=ige.$(msg.between.playerA);var playerB=ige.$(msg.between.playerB);delete playerA.tradingWith;delete playerB.tradingWith;delete playerA.isTrading;delete playerB.isTrading;$('#trade-div').hide();break;}}},_onErrorLogs:function(logs){var element=document.getElementById('error-log-content');for(actionName in logs){var log=logs[actionName];element.innerHTML+=`<li style='font-size:12px;'>${log}</li>`;ige.client.errorLogs.push(log);$('#dev-error-button').text(`Errors (${ige.client.errorLogs.length})`);}},_onSound:function(data){switch(data.cmd){case'playMusic':var music=ige.game.data.music[data.id];if(music){ige.sound.playMusic(music,undefined,undefined,data.id);}break;case'stopMusicForPlayer':case'stopMusic':ige.sound.stopMusic();break;case'playMusicForPlayer':var music=ige.game.data.music[data.music];if(music){ige.sound.playMusic(music,undefined,undefined,data.music);}break;case'playMusicForPlayerRepeatedly':var music=ige.game.data.music[data.music];if(music){ige.sound.playMusic(music,undefined,true,data.music);}break;case'playSoundForPlayer':var sound=ige.game.data.sound[data.sound];if(sound){var unit=ige.client.myPlayer&&ige.client.myPlayer.getSelectedUnit();ige.sound.playSound(sound,unit&&unit._translate||null,data.sound);}break;case'stopSoundForPlayer':ige.sound.stopSound(sound,data.sound);break;default:var soundData=ige.game.data.sound[data.id];ige.sound.playSound(soundData,data.position,data.id);}},_onParticle:function(data){if(data.eid&&data.pid){var entity=ige.$(data.eid);// the particle emitter must be within myPlayer's camera viewing range
if(entity&&entity.particleEmitters[data.pid]&&entity._translate.x>ige.client.vp1.camera._translate.x-1000&&entity._translate.x<ige.client.vp1.camera._translate.x+1000&&entity._translate.y>ige.client.vp1.camera._translate.y-1000&&entity._translate.y<ige.client.vp1.camera._translate.y+1000){var particleEmitter=entity.effect.particleEmitters[data.pid];if(data.action=='start'){particleEmitter.start();}else if(data.action=='stop'){particleEmitter.stop();}else if(data.action=='emitOnce'){particleEmitter.emitOnce();}}}else if(data.pid&&data.position){// my unit
var entity=ige.client.vp1.camera._trackTranslateTarget;var particle=ige.game.data.particleTypes[data.pid];if(entity&&particle&&entity._translate.x>ige.client.vp1.camera._translate.x-1000&&entity._translate.x<ige.client.vp1.camera._translate.x+1000&&entity._translate.y>ige.client.vp1.camera._translate.y-1000&&entity._translate.y<ige.client.vp1.camera._translate.y+1000){if(particle.dimensions==undefined){particle.dimensions={width:5,height:5};}if(particle['z-index']===undefined){particle['z-index']={layer:3,depth:5};}new $i_60()// Set the particle entity to generate for each particle
.layer(particle['z-index'].layer).depth(particle['z-index'].depth).color(particle.color).size(particle.dimensions.height,particle.dimensions.width).particle(Particle).lifeBase(parseFloat(particle.lifeBase))// Set particle life to 300ms
.quantityBase(parseFloat(particle.quantityBase))// Set output to 60 particles a second (1000ms)
.quantityTimespan(parseFloat(particle.quantityTimespan)).deathOpacityBase(parseFloat(particle.deathOpacityBase))// Set the particle's death opacity to zero so it fades out as it's lifespan runs out
.velocityVector(new $i_5(parseFloat(particle.velocityVector.baseVector.x),parseFloat(particle.velocityVector.baseVector.y),0),new $i_5(parseFloat(particle.velocityVector.minVector.x),parseFloat(particle.velocityVector.minVector.y),0),new $i_5(parseFloat(particle.velocityVector.maxVector.x),parseFloat(particle.velocityVector.maxVector.y),0)).particleMountTarget(ige.client.mainScene)// Mount new particles to the object scene
.translateTo(parseFloat(data.position.x),parseFloat(data.position.y),0)// Move the particle emitter to the bottom of the ship
.mount(ige.client.mainScene).emitOnce();}}},_onCamera:function(data){// camera zoom change
if(data.cmd=='zoom'){ige.client.setZoom(data.zoom);}// track unit
if(data.cmd=='track'){var unit=ige.$(data.unitId);if(unit){ige.client.vp1.camera.trackTranslate(unit,ige.client._trackTranslateSmoothing);}}if(data.cmd==='positionCamera'){ige.client.positionCamera(data.position.x,data.position.y);}},_onGameSuggestion:function(data){if(data&&data.type=='show'){$('#more-games').removeClass('slidedown-menu-animation').addClass('slideup-menu-animation');}else if(data&&data.type=='hide'){$('#more-games').removeClass('slideup-menu-animation').addClass('slidedown-menu-animation');}},_onMinimapEvent:function(data){if(data){switch(data.type){case'showUnit':var unit=ige.$(data.unitId);if(unit){unit.showMinimapUnit(data.color);}break;case'hideUnit':var unit=ige.$(data.unitId);if(unit){unit.hideMinimapUnit();}break;}}}};if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ClientNetworkEvents;};var GameComponent=$i_56.extend({classId:'GameComponent',componentId:'game',init:function(){var self=this;this.units={};this.players={};this.items={};this.food={};this.joints={};this.highlights={};this.debris={};this.createdEntities=[];this.gameOverModalIsShowing=false;this.isGameStarted=false;},start:function(){var self=this;GameComponent.prototype.log('Game component started');if(ige.isServer){ige.chat.createRoom('lobby',{},'1');// by default, create 5 computer players
var aiCount=10;// if (global.isDev) {
// 	var aiCount = 50 // create 50 ai players if dev env
// }
for(var i=1;i<=aiCount;i++){this[`computer${i}`]=this.createPlayer({name:`AI ${i}`,controlledBy:'computer',unitIds:[]// all units owned by player
});// GameComponent.prototype.log("computerPlayer created " + this['computer' + i].id())
// if (global.isDev) {
// 	ige.trigger.fire("playerJoinsGame", { playerId: this['computer'+i].id() })
// }
}ige.trigger.fire('gameStart');}else if(ige.isClient){// determine which attribute will be used for scoreboard
var attr='points';if(ige.game.data.settings&&ige.game.data.settings.constants&&ige.game.data.settings.constants.currency!=undefined){attr=ige.game.data.settings.constants.currency;}$('.game-currency').html(attr);}self.isGameStarted=true;ige.timer.startGameClock();},createPlayer:function(data,persistedData){var self=this;/* removing unnecessary purchases keys */var purchases=[];if(data.purchasables){for(var i=0;i<data.purchasables.length;i++){var purchasable=data.purchasables[i];purchasable=_.pick(purchasable,['_id','image','owner','target']);purchases.push(purchasable);}}var playerData={controlledBy:data.controlledBy,name:data.name,coins:data.coins,points:data.points||0,clientId:data.clientId,purchasables:purchases,attributes:data.attributes,highscore:data.highscore,lastPlayed:data.lastPlayed,userId:data._id,isAdBlockEnabled:data.isAdBlockEnabled,unitIds:[],// all units owned by player,
jointsOn:Date.now(),// use for calculating session,
totalTime:data.totalTime,// ipAddress: data.ipAddress,
email:data.email,isEmailVerified:data.isEmailVerified,banChat:data.banChat,mutedUsers:data.mutedUsers,isUserVerified:data.isUserVerified};var player=new Player(playerData);if(ige.isServer){var logInfo={name:playerData.name,clientId:playerData.clientId};if(playerData.userId){logInfo.userId=playerData.userId;}// console.log(playerData.clientId + ': creating player for ', logInfo)
}if(persistedData){player.persistedData=persistedData;}if(ige.isServer){ige.gameText.sendLatestText(data.clientId);// send latest ui information to the client
// ige.shopkeeper.updateShopInventory(ige.shopkeeper.inventory, data.clientId) // send latest ui information to the client
var isOwner=ige.server.owner==data._id;var isInvitedUser=false;if(ige.game.data.defaultData&&ige.game.data.defaultData.invitedUsers){isInvitedUser=ige.game.data.defaultData.invitedUsers.includes(data._id);}var isUserAdmin=false;var isUserMod=false;if(data.permissions){isUserAdmin=data.permissions.includes('admin');isUserMod=data.permissions.includes('mod');}player._stats.isUserAdmin=isUserAdmin;player._stats.isUserMod=isUserMod;// if User/Admin has access to game then show developer logs
if(isOwner||isInvitedUser||isUserAdmin){GameComponent.prototype.log(`owner connected. _id: ${data._id}`);ige.server.developerClientId=data.clientId;}}return player;},// get client with ip
getPlayerByIp:function(ip,currentUserId,all=false){var clientIds=[];for(let clientId in ige.server.clients){const clientObj=ige.server.clients[clientId];if(clientObj.ip===ip){clientIds.push(clientId);if(!all){break;}}}if(clientIds.length>0){var method=all?'filter':'find';return ige.$$('player')[method](player=>{// var clientId = player && player._stats && player._stats.clientId;
// added currentUserId check to confirm it is logged in user and not add-instance bot.
return player._stats&&clientIds.includes(player._stats.clientId)&&(all||currentUserId&&player._stats.userId!=currentUserId);});}},// not in use;
getUnitsByClientId:function(clientId){return ige.$$('unit').filter(function(unit){return unit._stats&&unit._stats.clientId==clientId;}).reduce(function(partialUnits,unit){partialUnits[unit._id]=unit;return partialUnits;},{});},getPlayerByUserId:function(userId){return ige.$$('player').find(function(player){return player._stats&&player._stats.userId==userId;});},getPlayerByClientId:function(clientId){return ige.$$('player').find(function(player){return player._stats&&player._stats.clientId==clientId;});},getAsset:function(assetType,assetId){try{var asset=this.data[assetType][assetId];return JSON.parse(JSON.stringify(asset));}catch(e){GameComponent.prototype.log(`getAsset ${assetType} ${assetId} ${e}`);}},secondsToHms:function(seconds){seconds=Number(seconds);var h=Math.floor(seconds/3600);var m=Math.floor(seconds%3600/60);var s=Math.floor(seconds%3600%60);var hDisplay=h>0?`${h}h `:'';var mDisplay=m>0?`${m}m `:'';var sDisplay=s>0?`${s}s`:'';return hDisplay+mDisplay+sDisplay;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=GameComponent;};var InventoryComponent=$i_56.extend({classId:'InventoryComponent',componentId:'inventory',init:function(entity,options){var self=this;// Store the entity that this component has been added to
this._entity=entity;// Store any options that were passed to us
this._options=options;},createInventorySlots:function(){// update inventory size and inventoy ids on client and server side
// render inventory slots on client end
var entity=this._entity;var ownerPlayer=entity.getOwner();var mobileClass=ige.mobileControls&&ige.mobileControls.isMobile?'inventory-slot-mobile ':'inventory-slot ';if(ownerPlayer&&ige.isClient&&entity._stats.clientId===ige.network.id()&&ownerPlayer._stats.selectedUnitId==entity.id()){$('#inventory-slots').html('');$('#inventory-slots-key-stroke').html('');for(var i=0;i<this._entity._stats.inventorySize;i++){$('#inventory-slots').append($('<div/>',{id:`item-${i}`,name:i,class:`btn inventory-item-button p-0 ${mobileClass}`,role:'button'}).on('click',function(){var slotIndex=parseInt($(this).attr('name'))+1;if(ige.client.myPlayer){ige.client.myPlayer.control.keyDown('key',slotIndex);}}));$('#inventory-slots-key-stroke').append($('<div/>',{id:`item-key-stroke-${i}`,name:`key-${i}`,class:'item-key-stroke'}));var item=this.getItemBySlotNumber(i+1);if(item){this.insertItem(item,i);}}this.createBackpack();this.createTradingSlots();}this.update();},createBackpack(){var entity=this._entity;var backpackSize=entity._stats.backpackSize;var mobileClass=ige.mobileControls&&ige.mobileControls.isMobile?'inventory-slot-mobile ':'inventory-slot ';if(backpackSize>0){this.updateBackpackButton(true);$('#backpack-items-div').html('');var inventorySize=this._entity._stats.inventorySize;for(var i=inventorySize;i<backpackSize+inventorySize;i++){$('#backpack-items-div').append($('<div/>',{class:'col-sm-4 margin-top-4'}).append($('<div/>',{id:`item-${i}`,name:i,class:`btn inventory-item-button p-0 ${mobileClass}`,role:'button'})));var item=this.getItemBySlotNumber(i+1);if(item){this.insertItem(item,i);}}}else{this.updateBackpackButton(false);}},createTradingSlots:function(){var mobileClass=ige.mobileControls&&ige.mobileControls.isMobile?'inventory-slot-mobile ':'inventory-slot ';if(this._entity._stats.inventorySize){var totalInventorySize=this.getTotalInventorySize();// total 5 trading slots
var tradingSlots=$('#user-trading-slots');tradingSlots.html('');var html='';for(var i=totalInventorySize;i<totalInventorySize+5;i++){this._entity._stats.itemIds[i]=undefined;tradingSlots.append($('<div/>',{id:`item-${i}`,name:i,class:`btn btn-light inventory-item-button ${mobileClass}`,role:'button'}));ige.itemUi.updateItemSlot(undefined,i);}}},updateBackpackButton:function(show){var inventoryBtn=$('#open-inventory-button');if(show){inventoryBtn.show();setTimeout(function(){$('#backpack-wrapper').css({bottom:$('#my-score-div').height()+40});},1000);}else{inventoryBtn.hide();}},getSameItemsFromInventory:function(itemTypeId){var items=this._entity._stats.itemIds;return items&&items.filter(id=>{var item=ige.$(id);if(item&&item._stats&&item._stats.itemTypeId===itemTypeId){return true;}})||[];},hasItem:function(itemTypeId){var sameItemTypesInInventory=this._entity.inventory.getSameItemsFromInventory(itemTypeId);return sameItemTypesInInventory.length>0;},/*
		get total quantity of all items combines of matching item type
		return undefined if item has infinite quantity
	*/getQuantity:function(itemTypeId){var quantity=0;var sameItemTypesInInventory=this._entity.inventory.getSameItemsFromInventory(itemTypeId);if(sameItemTypesInInventory.length>0){if(sameItemTypesInInventory.length){for(var i=0;i<sameItemTypesInInventory.length;i++){var id=sameItemTypesInInventory[i];var item=ige.$(id);if(!isNaN(parseFloat(item._stats.quantity))){quantity+=item._stats.quantity;}else{quantity=undefined;}}}}return quantity;},hasRequiredQuantity:function(itemTypeId,requiredQty){var self=this;var actualQuantity=self.getQuantity(itemTypeId);// undefined quantity means infinite quantity
return actualQuantity==undefined||actualQuantity>=requiredQty;},/**
	 * Return the inventory's first available slot considering the given item's type. If inventory has matching items already, then it'll consider how new item's quantity will be distributed, and eventually be added
	 * @param {*} itemData
	 * @return {int} returns first available slot number (starting from 1). undefined if there's no slot available
	 */getFirstAvailableSlotForItem:function(itemData){var self=this;var itemTypeId=itemData.itemTypeId;// check if we can assign itemData to its assigned designatedSlot.
var mappedSlots=itemData.controls&&Array.isArray(itemData.controls.permittedInventorySlots)?itemData.controls.permittedInventorySlots:undefined;var mappedSlot=undefined;if(mappedSlots!=undefined&&mappedSlots.length>0){for(var i=0;i<mappedSlots.length;i++){mappedSlot=mappedSlots[i];var existingItem=this.getItemBySlotNumber(mappedSlot);if(existingItem==undefined){return mappedSlot;}// even if there's an existing item in the designated slot, if we're in a middle of purchasing an item and the item uses the existing item as a recipe, then allow buying the item
var ownerPlayer=this._entity.getOwner();if(ownerPlayer){var lastOpenedShop=ownerPlayer._stats.lastOpenedShop;if(lastOpenedShop){var shopItems=ige.game.data.shops[lastOpenedShop]?ige.game.data.shops[lastOpenedShop].itemTypes:[];var itemData=ige.shop.getItemById(itemTypeId);var shopData=shopItems[itemTypeId];if(shopData){if(existingItem&&existingItem._stats.removeWhenEmpty&&existingItem._stats.quantity==shopData.price.requiredItemTypes[existingItem._stats.itemTypeId]){return mappedSlot;}}}}}}// check if this item can be merged with an existing item in the inventory
var totalInventorySize=this.getTotalInventorySize();if(itemData.controls==undefined||itemData.controls.canMerge||itemData.controls.canMerge==undefined||itemData.controls.canMerge){// Check if the item can merge
var quantity=itemData.quantity;for(var i=0;i<totalInventorySize;i++){var itemId=self._entity._stats.itemIds[i];if(itemId){var item=ige.$(itemId);// matching item found in inventory
if(item&&item._stats.itemTypeId==itemTypeId){// matching item has infinite quantity. merge items unless item also has infinite quantity
if(item._stats.quantity==undefined&&quantity!=undefined){return i+1;}// matching item isn't full, and new item can fit in.
if(item._stats.maxQuantity-item._stats.quantity>quantity){return i+1;}else{if(item._stats.quantity!=undefined){// new item's quantity isn't enough to fill the existing item's. Deduct new item's quantity. and move on. This isn't done for undefined items
quantity-=item._stats.maxQuantity-item._stats.quantity;}}}}}}// get first available empty slot including from backpack
for(var i=0;i<totalInventorySize;i++){// if item was mapped to a specific slot, then check if there's available slot in the backpack
// if item didn't have mapping, then return the first available slot including both inventory + backpack
if(mappedSlot==undefined||i>=this._entity._stats.inventorySize&&(itemData.controls==undefined||itemData.controls.backpackAllowed==true||itemData.controls.backpackAllowed==undefined)){var itemId=self._entity._stats.itemIds[i];if(!(itemId&&ige.$(itemId))){return i+1;// empty slot found
}}}if(mappedSlot&&mappedSlots.length==1){// give slot-specific message when item had ONE mapped slot. (e.g. glock in slot 2. Not slot 2 AND 3)
self._entity.reasonForFailingToPickUpItem=`slot ${mappedSlot} is occupied`;}return undefined;},// insert item into first available slot
insertItem:function(item,slotIndex){var self=this;var unit=this._entity;if(slotIndex==undefined)slotIndex=self.getFirstAvailableSlotForItem();if(slotIndex!=undefined&&item&&unit.canCarryItem(item._stats)){if(ige.isServer){// console.log("inserting item at slot", slotIndex)
self._entity._stats.itemIds[slotIndex]=item.id();if(slotIndex!=self._entity.currentItemIndex){item._stats.slotIndex=slotIndex;item.hide();}}else if(ige.isClient&&self._entity._stats.clientId===ige.network.id()){var ownerPlayer=self._entity.getOwner();if(ownerPlayer){if(ownerPlayer._stats.selectedUnitId==self._entity.id()){item._stats.slotIndex=slotIndex;ige.itemUi.updateItemSlot(item,slotIndex);}}}ige.trigger&&ige.trigger.fire('unitPickedAnItem',{unitId:unit.id(),itemId:item.id()});}return slotIndex;},getItemFromInventory:function(itemTypeId){var self=this;for(var k=0;k<self._entity._stats.itemIds.length;k++){var id=self._entity._stats.itemIds[k];var item=ige.$(id);if(item&&item._stats&&item._stats.itemTypeId===itemTypeId){return item;}}return null;},getItemFromInventoryWhichCanBeAccumulated:function(itemTypeId){var self=this;for(var k=0;k<self._entity._stats.itemIds.length;k++){var id=self._entity._stats.itemIds[k];var item=ige.$(id);if(item&&item._stats&&item._stats.itemTypeId===itemTypeId&&(item._stats.quantity<item._stats.maxQuantity||item._stats.maxQuantity===undefined)){return item;}}return null;},removeItem:function(slotIndex,id){// first remove itemid on server and send itemids to client for removing.
let itemExistInItemIds=false;let unit=this._entity;if(unit._stats.itemIds[slotIndex]==id){unit._stats.itemIds[slotIndex]=null;itemExistInItemIds=true;}if(ige.isServer){unit.streamUpdateData([{itemIds:unit._stats.itemIds}]);}else if(ige.isClient){if(ige.client.myPlayer&&ige.client.myPlayer._stats.selectedUnitId==unit.id()&&itemExistInItemIds){$(`#item-${slotIndex}`).html('');ige.itemUi.updateItemSlot(item,slotIndex);}}},removeItemByItemId:function(itemId){var totalInventorySize=this.getTotalInventorySize();for(var slotIndex=0;slotIndex<totalInventorySize;slotIndex++){if(this._entity._stats.itemIds[slotIndex]==itemId){this._entity._stats.itemIds[slotIndex]=null;this.removeItem(slotIndex,itemId);}}},// get item from inventory slot using slot number (starting from 1)
getItemBySlotNumber:function(slotNumber){if(slotNumber==undefined)return null;if(this._entity._stats.itemIds){var itemId=this._entity._stats.itemIds[slotNumber-1];if(itemId){var item=ige.$(itemId);// make sure item is owned by the unit calling this function
return item;}}},// update my unit's inventory by:
// 1. highlight currently selected inventory item (using currentItemIndex)
// 2. if inventory slot is occupied by item, then show item in the inventory slot. otherwise, empty inventory slot
update:function(){if(ige.isClient&&this._entity._stats.clientId===ige.network.id()){var ownerPlayer=this._entity.getOwner();if(ownerPlayer&&ownerPlayer._stats.selectedUnitId==this._entity.id()){$('.popover').popover('hide');// highlight currently selected item slots
// 5 for trading items
var totalInventorySize=this.getTotalInventorySize();for(var slotIndex=0;slotIndex<totalInventorySize+5;slotIndex++){var itemId=this._entity._stats.itemIds[slotIndex];var item=ige.$(itemId);// if (item) {
// 	item._stats.slotIndex = slotIndex;
// 	if (slotIndex == this._entity._stats.currentItemIndex) {
// 		item.setState('selected');
// 	} else {
// 		item.setState('unselected');
// 	}
// }
if(item&&item._stats&&item._stats.inventorySlotColor){$(`#item-${slotIndex}`).css('background-image','radial-gradient(rgba(0, 0, 0, 0),'+item._stats.inventorySlotColor+')');}else{$(`#item-${slotIndex}`).css('background-image','none');}ige.itemUi.updateItemSlot(item,slotIndex);// highlight currently selected inventory item (using currentItemIndex)
if(this._entity._stats.currentItemIndex!=undefined&&this._entity._stats.currentItemIndex==slotIndex){$(`#item-${slotIndex}`).addClass('active');}else{$(`#item-${slotIndex}`).removeClass('active');}}// this.updateBackpackButton()
}}},// highlight slot. (slots start from 1)
highlightSlot:function(slotIndex){for(var i=0;i<this._entity._stats.inventorySize;i++){// highlight currently selected inventory item (using currentItemIndex)
if(slotIndex>0&&slotIndex-1==i){$(`#item-${i}`).addClass('active');}else{$(`#item-${i}`).removeClass('active');}}},getTotalInventorySize:function(){this._entity._stats.backpackSize=this._entity._stats.backpackSize>0?this._entity._stats.backpackSize:0;// backward compatibility incase backpackSize == undefined
return this._entity._stats.inventorySize+this._entity._stats.backpackSize;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=InventoryComponent;};var SoundComponent=$i_56.extend({classId:'SoundComponent',componentId:'sound',init:function(){var self=this;self.musicFiles=[];self.preLoadedSounds={};self.preLoadedMusic={};if(ige.isClient){var soundSetting=localStorage.getItem('sound');var musicSetting=localStorage.getItem('music');if(soundSetting==undefined||soundSetting=='on'){localStorage.setItem('sound','on');self.toggleButton('sound','on');}else if(soundSetting=='off'){self.toggleButton('sound','off');}if(musicSetting==undefined||musicSetting=='on'){localStorage.setItem('music','on');self.toggleButton('music','on');}else if(musicSetting=='off'){self.toggleButton('music','off');if(self.musicCurrentlyPlaying){self.stopMusic();}}$('#sound-on').on('click',function(){self.toggleButton('sound','on');localStorage.setItem('sound','on');});$('#sound-off').on('click',function(){self.toggleButton('sound','off');localStorage.setItem('sound','off');});$('#music-on').on('click',function(){self.toggleButton('music','on');localStorage.setItem('music','on');if(self.musicCurrentlyPlaying){self.startMusic();}});$('#music-off').on('click',function(){self.toggleButton('music','off');localStorage.setItem('music','off');if(self.musicCurrentlyPlaying){self.stopMusic();}});}},toggleButton:function(type,mode){if(mode=='on'){$(`#${type}-on`).removeClass('btn-light').addClass('btn-success');$(`#${type}-off`).removeClass('btn-success').addClass('btn-light');}else{$(`#${type}-off`).removeClass('btn-light').addClass('btn-success');$(`#${type}-on`).removeClass('btn-success').addClass('btn-light');}},preLoadSound:function(){var self=this;for(var soundKey in ige.game.data.sound){var sound=ige.game.data.sound[soundKey];self.preLoadedSounds[soundKey]=document.createElement('audio');self.preLoadedSounds[soundKey].src=sound.file;if(sound.volume){self.preLoadedSounds[soundKey].volume=sound.volume/100;}self.preLoadedSounds[soundKey].load();}},preLoadMusic:function(){var self=this;for(var musicKey in ige.game.data.music){var music=ige.game.data.music[musicKey];self.preLoadedMusic[musicKey]=document.createElement('audio');self.preLoadedMusic[musicKey].src=music.file;if(music.volume){self.preLoadedMusic[musicKey].volume=music.volume/100;}self.preLoadedMusic[musicKey].load();}},getVolume:function(position,volume=0){var settingsVolume=parseFloat(localStorage.getItem('sound-volume'));settingsVolume=isNaN(settingsVolume)?1:settingsVolume/100;var distanceSoundShouldHeard=500;if(ige.game.data.settings&&ige.game.data.settings.camera&&ige.game.data.settings.camera.zoom&&ige.game.data.settings.camera.zoom.default){distanceSoundShouldHeard=ige.game.data.settings.camera.zoom.default*1.5;}var vpBound=ige.pixi.viewport.getVisibleBounds();var myPosition={x:vpBound.x+vpBound.width/2,y:vpBound.y+vpBound.height/2};var xDistance=position.x-myPosition.x;var yDistance=position.y-myPosition.y;var distance=Math.sqrt(xDistance*xDistance+yDistance*yDistance);if(distance<distanceSoundShouldHeard){if(!volume)volume=55;volume=Math.max(0,distanceSoundShouldHeard-distance)/distanceSoundShouldHeard*(volume/100);// 55% of actual volume
return Math.min(volume*settingsVolume,1);}else{// we don't want to hear sounds that are outside distanceSoundShouldHeard
return 0;}},playSound:function(sound,position,key,shouldRepeat=false){var self=this;if(ige.isClient){var soundSetting=localStorage.getItem('sound');if(soundSetting=='on'){// adjust volume based on distance between my unit and sound source
var volume=position===null?sound.volume/100:0;if(position){volume=this.getVolume(position,sound.volume);}else{var settingsVolume=parseFloat(localStorage.getItem('sound-volume'));settingsVolume=isNaN(settingsVolume)?1:settingsVolume/100;volume=settingsVolume*volume;}if(sound&&sound.file){if(self.preLoadedSounds[key]&&self.preLoadedSounds[key].src==sound.file){// if audio is currently playing then stop it first and replay audio
if(!self.preLoadedSounds[key].paused){self.preLoadedSounds[key].pause();self.preLoadedSounds[key].currentTime=0;}self.preLoadedSounds[key].volume=volume;self.preLoadedSounds[key].loop=shouldRepeat;self.preLoadedSounds[key].play().catch(function(e){console.log(e);});if(shouldRepeat){return self.preLoadedSounds[key];}}else{var element=document.createElement('audio');element.src=sound.file;// pick random item from array
element.volume=volume;element.loop=shouldRepeat;element.play().catch(function(e){console.log(e);});element.addEventListener('ended',function(){this.remove();},false);if(shouldRepeat){return element;}}}}}},playMusic:function(music,startAt,shouldRepeat,key){var self=this;var playMusic;if(ige.isClient){var musicSetting=localStorage.getItem('music');var settingsVolume=parseFloat(localStorage.getItem('music-volume'));settingsVolume=isNaN(settingsVolume)?1:settingsVolume/100;var volume=music.volume===undefined?1:Math.min(music.volume/100,1);var originalVolume=volume;volume=settingsVolume*volume;if(music&&music.file){if(self.preLoadedMusic[key]&&self.preLoadedMusic[key].src===music.file){if(!self.preLoadedMusic[key].pause){self.preLoadedMusic[key].pause();self.preLoadedMusic[key].currentTime=0;}self.preLoadedMusic[key].loop=shouldRepeat;self.preLoadedMusic[key].volume=volume;playMusic=self.preLoadedMusic[key];}else{var element=document.createElement('audio');element.src=music.file;// pick random item from array
element.volume=volume;element.loop=shouldRepeat;playMusic=element;}self.preLoadedMusic[key].originalVolume=originalVolume;if(self.musicCurrentlyPlaying){self.stopMusic();}self.musicCurrentlyPlaying=playMusic;// start at
if(playMusic&&startAt!=undefined){playMusic.currentTime=startAt;}if(musicSetting=='on'){playMusic.play().catch(function(e){console.log(e);});}if(element){element.addEventListener('ended',function(){this.remove();},false);}}}},startMusic:function(){if(ige.isClient){if(this.musicCurrentlyPlaying){this.musicCurrentlyPlaying.play().catch(function(e){console.log(e);});this.musicCurrentlyPlaying.currentTime=0;}}},updateMusicVolume:function(volume){if(ige.isClient){if(this.musicCurrentlyPlaying){var originalVolume=this.musicCurrentlyPlaying.originalVolume;this.musicCurrentlyPlaying.volume=Math.min(originalVolume*(volume/100),1);}}},stopMusic:function(){if(ige.isClient){if(this.musicCurrentlyPlaying){this.musicCurrentlyPlaying.pause();this.musicCurrentlyPlaying.currentTime=0;}}},stopSound:function(sound,key){if(this.preLoadedSounds[key]){this.preLoadedSounds[key].pause();this.preLoadedSounds[key].currentTime=0;}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=SoundComponent;};var ControlComponent=$i_56.extend({classId:'ControlComponent',componentId:'control',init:function(entity,options){// Store the entity that this component has been added to
this._entity=entity;this.lastInputSent=0;// Store any options that were passed to us
this._options=options;this.lastActionAt=undefined;this.lastMousePosition=[undefined,undefined];this.mouseLocked=false;// this.lastCommandSentAt = undefined;
this.isChatOpen=false;this.input={mouse:{button1:false,button3:false,x:undefined,y:undefined},key:{left:false,right:false,up:false,down:false,'`':false,1:false,2:false,3:false,4:false,5:false,6:false,7:false,8:false,9:false,a:false,b:false,c:false,d:false,e:false,f:false,g:false,h:false,i:false,j:false,k:false,l:false,m:false,n:false,o:false,p:false,q:false,r:false,s:false,t:false,u:false,v:false,w:false,x:false,y:false,z:false,enter:false,space:false,escape:false}};for(device in this.input){for(key in this.input[device]){ige.input.mapAction(key,ige.input[device][key]);}}},keyDown:function(device,key){// check for input modal is open
if(ige.isClient){this.isChatOpen=$('#message').is(':focus')&&!$('#player-input-field').is(':focus')||$('#modd-dialogue-modal').hasClass('show')||$('#player-input-modal').hasClass('show')||$('#modd-item-shop-modal').hasClass('show')||$('#custom-modal').hasClass('show');}this.lastActionAt=Date.now();if(this.input[device]){if(ige.isClient&&!this.isChatOpen||ige.isServer){this.input[device][key]=true;}}var player=ige.game.getPlayerByClientId(this._entity._stats.clientId);if(!player){return;}var unit=player.getSelectedUnit();if(unit&&unit._category=='unit'){if(ige.isServer||ige.isClient&&!this.isChatOpen){var unitAbility=null;if(unit._stats.isStunned==undefined||unit._stats.isStunned!=true){if(unit._stats.controls){if(unit._stats.controls.movementControlScheme=='ad'){switch(key){case'a':case'left':unit.ability.moveLeft();break;case'd':case'right':unit.ability.moveRight();break;}}else if(unit._stats.controls.movementControlScheme!='followCursor'){// WASD movement is default
switch(key){case'w':case'up':unit.ability.moveUp();// ige.inputReceived = Date.now();
break;case'a':case'left':unit.ability.moveLeft();break;case's':case'down':unit.ability.moveDown();break;case'd':case'right':unit.ability.moveRight();break;}}}switch(key){case'e':unit.ability.pickupItem();break;case'g':unit.ability.dropItem();break;case'i':if(ige.isClient&&$('#open-inventory-button').css('display')!=='none'){$('#open-inventory-button').click();}break;case'button1':unit.ability.startUsingItem();break;}}if(!unitAbility&&unit._stats.controls&&unit._stats.controls.abilities){unitAbility=unit._stats.controls.abilities[key];}if(unitAbility&&unitAbility.keyDown&&unit.ability){if(ige.client&&ige.client.inputDelay&&ige.client.inputDelay>0){setTimeout(function(){unit.ability.cast(unitAbility.keyDown);},ige.client.inputDelay);}else{// console.log(key, Date.now());
unit.ability.cast(unitAbility.keyDown);}}else if(key=='1'||key=='2'||key=='3'||key=='4'||key=='5'||key=='6'||key=='7'||key=='8'||key=='9'){var index=parseInt(key)-1;if(index<unit._stats.inventorySize){unit.changeItem(index);}}}}// }
if(ige.isClient){if(!this.isChatOpen){ige.network.send('playerKeyDown',{device:device,key:key});// this.lastCommandSentAt = Date.now();
if(key=='1'||key=='2'||key=='3'||key=='4'||key=='5'||key=='6'||key=='7'||key=='8'||key=='9'){var index=parseInt(key)-1;if(unit&&index<unit._stats.inventorySize){unit._stats.currentItemIndex=index;unit.inventory.highlightSlot(index+1);}}}}},keyUp:function(device,key){this.lastActionAt=Date.now();var player=ige.game.getPlayerByClientId(this._entity._stats.clientId);if(!player)return;var unit=player.getSelectedUnit();// for (i in units) {
// 	var unit = units[i]
if(unit){// traverse through abilities, and see if any of them is being casted by the owner
switch(key){case'w':case'up':if(unit.direction.y==-1)unit.ability.stopMovingY();break;case'a':case'left':if(unit.direction.x==-1)unit.ability.stopMovingX();break;case's':case'down':if(unit.direction.y==1)unit.ability.stopMovingY();break;case'd':case'right':if(unit.direction.x==1)unit.ability.stopMovingX();break;case'button1':if(unit.ability!=undefined){unit.ability.stopUsingItem();}break;}// traverse through abilities, and see if any of them is being casted by the owner
if(ige.isServer||ige.isClient){var unitAbility=null;// if (unit._stats.abilities) {
// 	unitAbility = unit._stats.abilities[key]
// }
if(!unitAbility&&unit._stats.controls&&unit._stats.controls.abilities){unitAbility=unit._stats.controls.abilities[key];}if(unitAbility&&unitAbility.keyUp&&unit.ability){if(ige.client&&ige.client.inputDelay&&ige.client.inputDelay>0){setTimeout(function(){unit.ability.cast(unitAbility.keyUp);},ige.client.inputDelay);}else{unit.ability.cast(unitAbility.keyUp);}}}}if(ige.isClient){if(this.input[device][key]){ige.network.send('playerKeyUp',{device:device,key:key});}}if(this.input[device])this.input[device][key]=false;},mouseMove:function(){var player=ige.client.myPlayer;if(player){//we can remove it. If we need to enable PIXI mouse input we should uncomment this
/*if (ige.pixi && ige.pixi.viewport) {
				var vpTransform = [
					-ige.pixi.viewport.x / ige.pixi.viewport.scale.x,
					-ige.pixi.viewport.y / ige.pixi.viewport.scale.y
				];
				var mouseX = ige.client.mouseMove && ige.client.mouseMove.clientX || 0;
				var mouseY = ige.client.mouseMove && ige.client.mouseMove.clientY || 0;

				var currentMouseTransform = [
					vpTransform[0] + mouseX / ige.pixi.viewport.scale.x,
					vpTransform[1] + mouseY / ige.pixi.viewport.scale.y
				];
				this.newMousePosition = currentMouseTransform;
			} else {
				this.newMousePosition = [0, 0];
			}*/ige.client.emit('fetch-mouse-position',this);}},/**
	 * Called every frame by the engine when this entity is mounted to the
	 * scenegraph.
	 * @param ctx The canvas context to render to.
	 */_behaviour:function(ctx){var self=this;if(ige.isClient){for(device in self.input){for(key in self.input[device]){if(ige.input.actionState(key)){if(self.input[device][key]==false){if(ige.mobileControls.isMobile&&device=='mouse'){// block
}else{self.keyDown(device,key);}}}else{if(self.input[device][key]==true){if(ige.mobileControls.isMobile&&device=='mouse'){// block
}else{self.keyUp(device,key);}}}}}// mouse move
self.mouseMove();// check if sending player input is due (every 100ms)
if(ige._currentTime-self.lastInputSent>100){self.sendPlayerInput=true;self.lastInputSent=ige._currentTime;}if(self.newMousePosition&&(self.newMousePosition[0]!=self.lastMousePosition[0]||self.newMousePosition[1]!=self.lastMousePosition[1])){// if we are using mobile controls don't send mouse moves to server here as we will do so from a look touch stick
if(!ige.mobileControls.isMobile){// absolute mouse position wrt window
if(ige._mouseAbsoluteTranslation&&ige._mouseAbsoluteTranslation[0]&&ige._mouseAbsoluteTranslation[1]){var centerOfScreen={};centerOfScreen.innerWidth=window.innerWidth/2;centerOfScreen.innerHeight=window.innerHeight/2;var angle=0;if(centerOfScreen&&ige._mouseAbsoluteTranslation[0]!=centerOfScreen.innerWidth&&centerOfScreen.innerHeight!=ige._mouseAbsoluteTranslation[1]){angle=Math.atan2(ige._mouseAbsoluteTranslation[0]-centerOfScreen.innerWidth,centerOfScreen.innerHeight-ige._mouseAbsoluteTranslation[1]);}// angle = angle % Math.PI;
angle=parseFloat(angle.toPrecision(5));if(self.sendPlayerInput)ige.network.send('playerAbsoluteAngle',angle);if(ige.client.myPlayer){ige.client.myPlayer.absoluteAngle=angle;}self.absoluteAngle=angle;}if(ige.client&&ige.client.myPlayer){ige.client.myPlayer.control.input.mouse.x=self.newMousePosition[0];ige.client.myPlayer.control.input.mouse.y=self.newMousePosition[1];}if(self.sendPlayerInput)ige.network.send('playerMouseMoved',self.newMousePosition);}self.lastMousePosition=self.newMousePosition;}// unit move
var unit=ige.client.selectedUnit;if(ige.physics&&ige.game.cspEnabled&&unit){var x=unit._translate.x.toFixed(0);var y=unit._translate.y.toFixed(0);if(self.sendPlayerInput||self.lastPositionSent==undefined||self.lastPositionSent[0]!=x||self.lastPositionSent[1]!=y){var pos=[x,y];ige.network.send('playerUnitMoved',pos);// console.log(x, y)
self.lastPositionSent=pos;}}self.sendPlayerInput=false;}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ControlComponent;};/**
 * MobileControlsComponent
 * Virtual game controls for use on mobile devices
 */var MobileControlsComponent=$i_56.extend({classId:'MobileControlsComponent',componentId:'mobileControls',init:function(entity){$i_56.prototype.init.call(this);var self=this;this.isMobile=ige.isMobileDevice();// cache
this.isSingleGame=this.isSingleGameMode();// Store the entity that this component has been added to
this._entity=entity;this.debug=false;this.controls=[];var canvas=document.getElementById('igeFrontBuffer');this.canvas={height:canvas.style.height&&parseInt(canvas.style.height.replace('px',''))||canvas.height,width:canvas.style.width&&parseInt(canvas.style.width.replace('px',''))||canvas.width};$(window).on('orientationchange load resize',function(){// Adam 4-Jan-2021 .... don't think we need this... not for mobile controls anyway - so I'm commenting it out
/*
            var canvas = document.getElementById('igeFrontBuffer');
            this.canvas = {
                height: (canvas.style.height && parseInt(canvas.style.height.replace('px', ''))) || canvas.height,
                width: (canvas.style.width && parseInt(canvas.style.width.replace('px', ''))) || canvas.width
            };
            */if(ige.mobileControls){// and this unit is our player
if(ige.client&&ige.client.myPlayer&&ige.network.id()==ige.client.myPlayer._stats.clientId){var unit=ige.$(ige.client.myPlayer._stats.selectedUnitId);if(unit&&unit._stats.controls){var unitAbilities=unit._stats.controls.abilities;if(unitAbilities){// update mobile controls
ige.mobileControls.configure(unitAbilities);}}}}});this.id();ige.pixi.trackEntityById[this.id()]=this;self.addBehaviour('mobileControl',self._behaviour);},getParameterByName:function(name,url){// https://stackoverflow.com/questions/901115/how-can-i-get-query-string-values-in-javascript
if(!url)url=window.location.href;name=name.replace(/[\[\]]/g,'\\$&');var regex=new RegExp(`[?&]${name}(=([^&#]*)|&|#|$)`);var results=regex.exec(url);if(!results)return null;if(!results[2])return'';return decodeURIComponent(results[2].replace(/\+/g,' '));},isSingleGameMode:function(){var s=this.getParameterByName('s');if(parseInt(s)==1)return true;return false;},// called from client after textures loaded
attach:function(mountScene){// don't add if not on mobile
if(!this.isMobile)return;// DOM UI Modifications for mobile
noAds=true;// moved plain jquery based UI changes to template.js adjustUIForMobile function as
// this component gets added very late causing a flash of ugly ui on smaller screens
if(this.isSingleGame){$('#back-to-game-selection-button').hide();}else{$('#back-to-game-selection-button').show();}if(this.isPortrait()){$('#chat-input-field-div').css({width:'80%'});}else{$('#chat-input-field-div').css({width:'60%'});}var self=this;// guide is a "960x540" panel scaled to fit
// buttons are mounted / laid out within this space
this.guide=new $i_56().depth(100).width(960).height(540).mount(this.mobileControls);return this;},clearControls:function(newAbilities){var self=this;for(ix in this.controls){var uppercaseKey=ix;if(newAbilities&&!newAbilities[uppercaseKey]){var button=self.controls[uppercaseKey];if(typeof button==='object'&&button){button.destroy();}delete this.controls[uppercaseKey];}}// this.controls = [];
},configure:function(abilities){if(!this.isMobile||!abilities)return;// $("#show-chat").show();
$('#show-chat').hide();// completely disable chat on mobile (app review)
$('#chat-box').hide();$('#chat-box').css({top:'10vh',fontSize:'x-small'});$('#chat-box').css('min-width','200px');$('#chat-history').css('width','200px');$('#dev-console').hide();// this gets in the way of testing too
$('#modd-item-shop-modal').css({zIndex:9050});ige.scoreboard.hideScores();// default to collapsed state on mobile
var self=this;this.clearControls(abilities);Object.keys(abilities).forEach(function(key,index){var ability=abilities[key];if(ability.mobilePosition&&!self.controls[key]){// mobile control layout editor is 480x270
// rescale to 960x540
var x=ability.mobilePosition.x*2;var y=ability.mobilePosition.y*2;self.addControl(key,x,y,75,64,ability);}});},upPressed:function(){if(this.debug)console.log('UP PRESSED');var unit=ige.client.myPlayer.getSelectedUnit();unit.ability.moveUp();if(ige.isClient){ige.network.send('playerKeyDown',{device:'key',key:'w'});}},downPressed:function(){if(this.debug)console.log('DOWN PRESSED');var unit=ige.client.myPlayer.getSelectedUnit();unit.ability.moveDown();if(ige.isClient){ige.network.send('playerKeyDown',{device:'key',key:'s'});}},leftPressed:function(){if(this.debug)console.log('LEFT PRESSED');var unit=ige.client.myPlayer.getSelectedUnit();unit.ability.moveLeft();if(ige.isClient){ige.network.send('playerKeyDown',{device:'key',key:'a'});}},rightPressed:function(){if(self.debug)console.log('RIGHT PRESSED');var unit=ige.client.myPlayer.getSelectedUnit();unit.ability.moveRight();if(ige.isClient){ige.network.send('playerKeyDown',{device:'key',key:'d'});}},upReleased:function(){if(this.debug)console.log('UP RELEASED');var unit=ige.client.myPlayer.getSelectedUnit();if(unit.direction.y==-1)unit.ability.stopMovingY();if(ige.isClient){ige.network.send('playerKeyUp',{device:'key',key:'w'});}},downReleased:function(){if(this.debug)console.log('DOWN RELEASED');var unit=ige.client.myPlayer.getSelectedUnit();if(unit.direction.y==1)unit.ability.stopMovingY();if(ige.isClient){ige.network.send('playerKeyUp',{device:'key',key:'s'});}},leftReleased:function(){if(this.debug)console.log('LEFT RELEASED');var unit=ige.client.myPlayer.getSelectedUnit();if(unit.direction.x==-1)unit.ability.stopMovingX();if(ige.isClient){ige.network.send('playerKeyUp',{device:'key',key:'a'});}},rightReleased:function(){if(this.debug)console.log('RIGHT RELEASED');var unit=ige.client.myPlayer.getSelectedUnit();if(unit.direction.x==1)unit.ability.stopMovingX();if(ige.isClient){ige.network.send('playerKeyUp',{device:'key',key:'d'});}},// add a button or stick to the virtual controller
addControl:function(key,x,y,w,h,ability){w=w||128;h=h||128;var self=this;var isStick=key=='movementWheel'||key=='lookWheel'||key=='lookAndFireWheel';if(isStick){if(key=='movementWheel'){let moveStick=new Joystick({outerScale:{x:1.2,y:1.2},innerScale:{x:0.5,y:0.5},onChange:data=>{if(ige.client.myPlayer){// Endel's joystick angles are in "Maths style" (zero degrees is EAST and positive anticlockwise)
// Convert into compass style angle (zero degrees NORTH and positive clockwise)
var compassAngle=(360-(data.angle-90))%360;var tolerance=12;var isUp=compassAngle<=90-tolerance||compassAngle>=270+tolerance;var isDown=compassAngle>=90+tolerance&&compassAngle<=270-tolerance;var isLeft=compassAngle<=360-tolerance&&compassAngle>=180+tolerance;var isRight=compassAngle>=tolerance&&compassAngle<=180-tolerance;if(data.power>0.5){if(isUp&&moveStick._isUp==false){self.upPressed();}if(!isUp&&moveStick._isUp==true){self.upReleased();}if(isDown&&moveStick._isDown==false){self.downPressed();}if(!isDown&&moveStick._isDown==true){self.downReleased();}if(isLeft&&moveStick._isLeft==false){self.leftPressed();}if(!isLeft&&moveStick._isLeft==true){self.leftReleased();}if(isRight&&moveStick._isRight==false){self.rightPressed();}if(!isRight&&moveStick._isRight==true){self.rightReleased();}moveStick._isUp=isUp;moveStick._isDown=isDown;moveStick._isLeft=isLeft;moveStick._isRight=isRight;}else{if(moveStick._isUp){self.upReleased();}if(moveStick._isLeft){self.leftPressed();}if(moveStick._isDown){self.downReleased();}if(moveStick._isRight){self.rightReleased();}moveStick._isUp=false;moveStick._isDown=false;moveStick._isLeft=false;moveStick._isRight=false;}}},onEnd:()=>{var unit=ige.client.myPlayer.getSelectedUnit();if(moveStick._isUp){self.upReleased();}if(moveStick._isLeft){self.leftReleased();}if(moveStick._isDown){self.downReleased();}if(moveStick._isRight){self.rightReleased();}moveStick._isUp=false;moveStick._isDown=false;moveStick._isLeft=false;moveStick._isRight=false;}});ige.pixi.mobileControls.addChild(moveStick);moveStick.position.set(x+32,y+12);moveStick._isUp=false;moveStick._isDown=false;moveStick._isLeft=false;moveStick._isRight=false;}if(key=='lookWheel'){let lookStick=new Joystick({outerScale:{x:1.2,y:1.2},innerScale:{x:0.5,y:0.5},onChange:data=>{if(ige.client.myPlayer){// Endel's joystick angles are in "Maths style" (zero degrees is EAST and positive anticlockwise)
// Convert into compass style angle (zero degrees NORTH and positive clockwise)
var compassAngle=-(data.angle-90);// simulate mouse movement 10 units away from player (scaled by joystick "power") character but at the angle
var unitTranslate=ige.client.myPlayer.getSelectedUnit()._translate;var mx=unitTranslate.x+Math.sin(compassAngle/360*2*Math.PI)*10*data.power;var my=unitTranslate.y-Math.cos(compassAngle/360*2*Math.PI)*10*data.power;ige.client.myPlayer.control.input.mouse.x=mx;ige.client.myPlayer.control.input.mouse.y=my;ige.client.myPlayer.absoluteAngle=compassAngle;ige.network.send('playerMouseMoved',[mx,my]);ige.network.send('playerAbsoluteAngle',compassAngle);}}});ige.pixi.mobileControls.addChild(lookStick);lookStick.position.set(x+32,y+12);}if(key=='lookAndFireWheel'){let fireStick=new Joystick({redFireZone:true,outerScale:{x:1.2,y:1.2},innerScale:{x:0.5,y:0.5},onChange:data=>{if(ige.client.myPlayer){// Endel's joystick angles are in "Maths style" (zero degrees is EAST and positive anticlockwise)
// Convert into compass style angle (zero degrees NORTH and positive clockwise)
var compassAngle=-(data.angle-90);// simulate mouse movement 10 units away from player (scaled by joystick "power") character but at the angle
var unitTranslate=ige.client.myPlayer.getSelectedUnit()._translate;var mx=unitTranslate.x+Math.sin(compassAngle/360*2*Math.PI)*10*data.power;var my=unitTranslate.y-Math.cos(compassAngle/360*2*Math.PI)*10*data.power;ige.client.myPlayer.control.input.mouse.x=mx;ige.client.myPlayer.control.input.mouse.y=my;ige.client.myPlayer.absoluteAngle=compassAngle;ige.network.send('playerMouseMoved',[mx,my]);ige.network.send('playerAbsoluteAngle',compassAngle);// when fire stick is moved to the red ring...
if(data.power>0.75){// start firing
ige.client.myPlayer.control.keyDown('mouse','button1');}else{// otherwise stop firing
ige.client.myPlayer.control.keyUp('mouse','button1');}}},onEnd:()=>{// if the player lets go of the fire stick perform a keyup on mouse button1 to stop firing
if(ige.client.myPlayer){ige.client.myPlayer.control.keyUp('mouse','button1');}}});ige.pixi.mobileControls.addChild(fireStick);fireStick.position.set(x+32,y+12);}}else{var text=key.toUpperCase();var newButton=new PIXI.Sprite.from('https://cache.modd.io/asset/spriteImage/1549614640644_button1.png?version=123',{crossOrigin:true});ige.pixi.mobileControls.addChild(newButton);newButton.width=w;newButton.height=h;newButton.x=x;newButton.y=y;newButton._key=key.toLowerCase();var iconUrl=null;if(text=='BUTTON1')iconUrl='https://cache.modd.io/asset/spriteImage/1610494864771_fightFist_circle.png';if(iconUrl){var icon=new PIXI.Sprite.from(iconUrl,{crossOrigin:true});ige.pixi.mobileControls.addChild(icon);icon.scale.set(0.5);icon.anchor.set(0.5);icon.position.set(x+w/2,y+h/2);}else{var label=new PIXI.Text(text,{fontFamily:'Arial',fontSize:24,fill:0xffffff,align:'center'});ige.pixi.mobileControls.addChild(label);label.anchor.set(0.5);label.position.set(x+w/2,y+h/2);}newButton.isButton=true;newButton.interactive=true;newButton.alpha=0.6;newButton.on('touchstart',function(event){if(newButton._isClicked)return;// block repetition
newButton._isClicked=true;event.stopPropagation();let texture=PIXI.Texture.from('https://cache.modd.io/asset/spriteImage/1549614658007_button2.png?version=123',{crossOrigin:true});newButton.texture=texture;if(newButton._key){// console.log("Key down:"+newButton._key);
ige.network.send('playerKeyDown',{device:'key',key:newButton._key});}});newButton.on('touchend',function(event){if(!newButton._isClicked)return;// block repetition
newButton._isClicked=false;event.stopPropagation();let texture=PIXI.Texture.from('https://cache.modd.io/asset/spriteImage/1549614640644_button1.png?version=123',{crossOrigin:true});newButton.texture=texture;if(newButton._key){// console.log("Key up:"+newButton._key);
ige.network.send('playerKeyUp',{device:'key',key:newButton._key});}});}},isIframe(){try{return window.self!==window.top;}catch(e){return true;}},isPortrait:function(){// return ige._bounds2d.x < ige._bounds2d.y;
// return window.orientation === 0 || window.orientation == undefined;
return this.canvas.width<this.canvas.height;}});// client side only
// if (typeof(module) !== 'undefined' && typeof(module.exports) !== 'undefined') { module.exports = MobileControlsComponent; }
// Endel Virtual Joystick:
var Direction={LEFT:'left',TOP:'top',BOTTOM:'bottom',RIGHT:'right',TOP_LEFT:'top_left',TOP_RIGHT:'top_right',BOTTOM_LEFT:'bottom_left',BOTTOM_RIGHT:'bottom_right'};class JoystickSettings{constructor(){this.outer=null;this.inner=null;this.redFireZone=false;this.outerScale={x:1,y:1};this.innerScale={x:1,y:1};this.onChange=null;this.onStart=null;this.onEnd=null;}}class Joystick extends PIXI.Container{constructor(opts){super();this.innerAlphaStandby=0.5;this.settings=new JoystickSettings();this.settings=Object.assign({outerScale:{x:1,y:1},innerScale:{x:1,y:1}},opts);if(!this.settings.outer){const outer=new PIXI.Graphics();if(this.settings.redFireZone){outer.lineStyle(10,0xff0000);outer.beginFill(0x000000,0.5);outer.drawCircle(0,0,60);}else{outer.beginFill(0x000000);outer.drawCircle(0,0,60);outer.alpha=0.5;}this.settings.outer=outer;}if(!this.settings.inner){const inner=new PIXI.Graphics();inner.beginFill(0x000000);inner.drawCircle(0,0,35);inner.alpha=this.innerAlphaStandby;this.settings.inner=inner;}this.initialize();}initialize(){this.outer=this.settings.outer;this.inner=this.settings.inner;this.outer.scale.set(this.settings.outerScale.x,this.settings.outerScale.y);this.inner.scale.set(this.settings.innerScale.x,this.settings.innerScale.y);if('anchor'in this.outer){this.outer.anchor.set(0.5);}if('anchor'in this.inner){this.inner.anchor.set(0.5);}this.addChild(this.outer);this.addChild(this.inner);// this.outerRadius = this.containerJoystick.width / 2;
this.outerRadius=55;// this.width / 2.5;
this.innerRadius=52;// this.inner.width / 2;
this.bindEvents();}bindEvents(){let that=this;this.interactive=true;let dragging=false;let eventData;let power;let startPosition;function onDragStart(event){eventData=event.data;startPosition=eventData.getLocalPosition(that);dragging=true;that.inner.alpha=1;if(that.settings.onStart){that.settings.onStart();}}function onDragEnd(event){if(dragging==false){return;}that.inner.position.set(0,0);dragging=false;that.inner.alpha=that.innerAlphaStandby;if(that.settings.onEnd){that.settings.onEnd();}}function onDragMove(event){if(dragging==false){return;}let newPosition=eventData.getLocalPosition(that);let sideX=newPosition.x-startPosition.x;let sideY=newPosition.y-startPosition.y;let centerPoint=new PIXI.Point(0,0);let angle=0;if(sideX==0&&sideY==0){return;}let calRadius=0;if(sideX*sideX+sideY*sideY>=that.outerRadius*that.outerRadius){calRadius=that.outerRadius;}else{calRadius=that.outerRadius-that.innerRadius;}/**
         * x:   -1 <-> 1
         * y:   -1 <-> 1
         *          Y
         *          ^
         *          |
         *     180  |  90
         *    ------------> X
         *     270  |  360
         *          |
         *          |
         */let direction=Direction.LEFT;if(sideX==0){if(sideY>0){centerPoint.set(0,sideY>that.outerRadius?that.outerRadius:sideY);angle=270;direction=Direction.BOTTOM;}else{centerPoint.set(0,-(Math.abs(sideY)>that.outerRadius?that.outerRadius:Math.abs(sideY)));angle=90;direction=Direction.TOP;}that.inner.position=centerPoint;power=that.getPower(centerPoint);if(that.settings.onChange){that.settings.onChange({angle,direction,power});}return;}if(sideY==0){if(sideX>0){centerPoint.set(Math.abs(sideX)>that.outerRadius?that.outerRadius:Math.abs(sideX),0);angle=0;direction=Direction.LEFT;}else{centerPoint.set(-(Math.abs(sideX)>that.outerRadius?that.outerRadius:Math.abs(sideX)),0);angle=180;direction=Direction.RIGHT;}that.inner.position=centerPoint;power=that.getPower(centerPoint);if(that.settings.onChange){that.settings.onChange({angle,direction,power});}return;}let tanVal=Math.abs(sideY/sideX);let radian=Math.atan(tanVal);angle=radian*180/Math.PI;let centerX=0;let centerY=0;if(sideX*sideX+sideY*sideY>=that.outerRadius*that.outerRadius){centerX=that.outerRadius*Math.cos(radian);centerY=that.outerRadius*Math.sin(radian);}else{centerX=Math.abs(sideX)>that.outerRadius?that.outerRadius:Math.abs(sideX);centerY=Math.abs(sideY)>that.outerRadius?that.outerRadius:Math.abs(sideY);}if(sideY<0){centerY=-Math.abs(centerY);}if(sideX<0){centerX=-Math.abs(centerX);}if(sideX>0&&sideY<0){// < 90
}else if(sideX<0&&sideY<0){// 90 ~ 180
angle=180-angle;}else if(sideX<0&&sideY>0){// 180 ~ 270
angle=angle+180;}else if(sideX>0&&sideY>0){// 270 ~ 369
angle=360-angle;}centerPoint.set(centerX,centerY);power=that.getPower(centerPoint);direction=that.getDirection(centerPoint);that.inner.position=centerPoint;if(that.settings.onChange){that.settings.onChange({angle,direction,power});}}this.on('pointerdown',onDragStart).on('pointerup',onDragEnd).on('pointerupoutside',onDragEnd).on('pointermove',onDragMove);}getPower(centerPoint){const a=centerPoint.x-0;const b=centerPoint.y-0;return Math.min(1,Math.sqrt(a*a+b*b)/this.outerRadius);}getDirection(center){let rad=Math.atan2(center.y,center.x);// [-PI, PI]
if(rad>=-Math.PI/8&&rad<0||rad>=0&&rad<Math.PI/8){return Direction.RIGHT;}else if(rad>=Math.PI/8&&rad<3*Math.PI/8){return Direction.BOTTOM_RIGHT;}else if(rad>=3*Math.PI/8&&rad<5*Math.PI/8){return Direction.BOTTOM;}else if(rad>=5*Math.PI/8&&rad<7*Math.PI/8){return Direction.BOTTOM_LEFT;}else if(rad>=7*Math.PI/8&&rad<Math.PI||rad>=-Math.PI&&rad<-7*Math.PI/8){return Direction.LEFT;}else if(rad>=-7*Math.PI/8&&rad<-5*Math.PI/8){return Direction.TOP_LEFT;}else if(rad>=-5*Math.PI/8&&rad<-3*Math.PI/8){return Direction.TOP;}else{return Direction.TOP_RIGHT;}}};var shutdownMessages=[{checkpoint:1,message:'2 hours',timeMS:120*60000},{checkpoint:2,message:'1 hour',timeMS:60*60000},{checkpoint:3,message:'30 minutes',timeMS:30*60000},{checkpoint:4,message:'15 minutes',timeMS:15*60000},{checkpoint:5,message:'5 minutes',timeMS:5*60000},{checkpoint:6,message:'1 minute',timeMS:1*60000}];var TimerComponent=$i_56.extend({classId:'TimerComponent',componentId:'timer',init:function(){var self=this;if(ige.isServer){self.emptyTimeLimit=self.getTimeLimit();self.startedAt=new Date(ige.server.startedOn);console.log('initialized timer component',self.startedAt);self.now=self.serverEmptySince=self.startedAt;}},getTimeLimit:function(){let timeLimitMin=5;// const totalPlayCount = ige.server.totalPlayCount || 0;
// // add 1 minute for every 2000 total play count
// let extraMinutes = totalPlayCount / 2000;
// extraMinutes = +extraMinutes.toFixed(0);
// timeLimitMin += extraMinutes;
return timeLimitMin*60000;},getLifeSpan:function(){var maxLifeSpan=6*60*60*1000;var lifeSpan=ige.server.lifeSpan;if(lifeSpan>maxLifeSpan){lifeSpan=maxLifeSpan;}return lifeSpan;},startGameClock:function(){var self=this;console.log(new Date(),'gameClock started');self.shutdownMessageCheckpoint=-1;var everySecond=setInterval(function(){self.now=Date.now();if(ige.isServer){self.lastTick=self.now;// var shouldLog = ige.server.logTriggers && ige.server.logTriggers.timerLogs;
ige.trigger.fire('secondTick');// kill tier 1 servers that has been empty for over 15 minutes
// var playerCount = ige.$$('player').filter(function (player) { return player._stats.controlledBy == 'human' }).length;
// if (playerCount <= 0) {
// 	if (self.now - self.serverEmptySince > self.emptyTimeLimit) {
// 		ige.server.kill("game's been empty for too long (15 min)");
// 	}
// }
// else {
// 	self.serverEmptySince = self.now;
// }
var lifeSpan=self.getLifeSpan();// if server's lifeSpan is over, kill it (e.g. kill server after 5 hours)
var age=self.now-self.startedAt;var messageToBroadcast=shutdownMessages.find(function(messageDetails){return age>lifeSpan-messageDetails.timeMS&&self.shutdownMessageCheckpoint<messageDetails.checkpoint;});if(messageToBroadcast){var message=`shutting down server in ${messageToBroadcast.message}`;self.shutdownMessageCheckpoint=messageToBroadcast.checkpoint;ige.chat.sendToRoom('1',message,undefined,undefined);}// if (shouldLog) {
// 	console.log(self.now, self.startedAt, age, lifeSpan, age > lifeSpan);
// }
// if (age > lifeSpan) {
// 	ige.server.kill("server lifespan expired");
// }
}else if(ige.isClient){ige.scoreboard.update();}},1000);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=TimerComponent;};var ShopComponent=$i_56.extend({classId:'ShopComponent',componentId:'shop',init:function(entity,options){var self=this;if(ige.isClient){// $("#confirm-purchase-button").on("click", function() {
// 	self.purchase(self.itemToBePurchased.id)
// })
if(isLoggedIn){self.loadUserPurchases();}self.unitSkinCount={};self.itemSkinCount={};self.skinItems={};self.currentPagination=1;self.perPageItems=20;self.currentType='';self.oldModalHTMLBody='';// if (!ige.mobileControls.isMobile) {
$('.open-modd-shop-button').on('click',function(){var player=ige.client.myPlayer;if(player&&!player._stats.isAdBlockEnabled){countAdImpression(gameId,'shop');}self.openModdShop();});// }
$('.open-coin-shop-button').show().on('click',function(){self.openCoinShop();});$('.shop-navbar .nav-item').on('click',function(){$('.shop-navbar .nav-link').each(function(){$(this).removeClass('active');});self.shopType=$(this).find('.nav-link').attr('name');self.shopKey='';$('#modd-shop-modal .shop-items').html('');$(this).find('.nav-link').addClass('active');self.updateModdShop();});$('.item-shop-navbar .nav-item').on('click',function(){if(!$(this.firstElementChild).hasClass('active')){$('.shop-navbar .nav-link').each(function(){$(this).removeClass('active');});var selected=$(this).find('.nav-link').attr('name');$('#modd-item-shop-modal .items-shop').html('');$(this).find('.nav-link').addClass('active');self.openItemShop(self.currentType,selected);}});$('#mod-shop-pagination').on('click','.skin-pagination',function(){var itemDom=$(this);var buttonPressed=itemDom[0].dataset.text;var totalPages=Math.ceil(self.skinItems.length/self.perPageItems);if(buttonPressed==='next'){if(self.currentPagination<totalPages){self.currentPagination++;}}else if(buttonPressed==='previous'){if(self.currentPagination>1){self.currentPagination--;}}else{self.currentPagination=parseInt(buttonPressed);}self.paginationForSkins();});// purchase items
$(document).on('click','.btn-purchase-item',function(){// if ($(this).attr("isadblockenabled") === "true") {
// 	Swal({
// 		html: "<div class='swal2-title text-warning'><i class='fas fa-sad-tear fa-2x'></i></div><div class='swal2-title'>First, please disable your Adblock</div><div class='swal2-text'>Please support us. Our servers cost money.</div>",
// 		button: "close",
// 	});
// }
// else {
var isItemRequirementSetisfied=$(this).attr('requirementsSatisfied')=='true';var isItemAffordable=$(this).attr('isItemAffordable')=='true';var name=$(this).attr('name');if(!isItemRequirementSetisfied){self.purchaseWarning('requirement',name);return;}if(!isItemAffordable){self.purchaseWarning('price',name);return;}self.purchase($(this).attr('id'));// }
// self.confirmPurchase($(this).attr("id"))
});$(document).on('click','.btn-purchase-unit',function(){$('#modd-item-shop-modal').modal('hide');self.purchaseUnit($(this).attr('id'));// self.confirmPurchase($(this).attr("id"))
});// listen for item modal close
$('#modd-item-shop-modal').on('hidden.bs.modal',function(){$('.popover').remove();});// purchase purchasable
$(document).on('click','.btn-purchase-purchasable',function(){if($(this).hasClass('disabled'))return;var itemDom=$(this);var name=itemDom[0].dataset.purchasable;var price=isNaN(parseFloat(itemDom[0].dataset.price))?itemDom[0].dataset.price:parseFloat(itemDom[0].dataset.price);var isUnauthenticated=itemDom[0].dataset.unauthenticated;if(isUnauthenticated==='true'&&!(price==='facebook'||price==='twitter')){// alert('You should be logged in to purchase the item.');
$('#login-modal').modal('show');return;}var hasSharedDefer=$.Deferred();if(price<=0){promise=$.ajax({url:`/api/user/has-shared/${ige.game.data.defaultData.parentGame||ige.client.server.gameId}`,dataType:'html',type:'GET',success:function(data){var response=JSON.parse(data);if(response.status==='success'){hasSharedDefer.resolve(response.message);}else{hasSharedDefer.reject(response.message);}},error:function(req,status,err){hasSharedDefer.reject(err);}});}else{hasSharedDefer.resolve(true);}hasSharedDefer.promise().then(function(hasShared){if(hasShared){var itemId=itemDom.attr('id');var gameData=ige.game.data.defaultData;if(price==='facebook'||price==='twitter'){var item={value:gameData._id,type:'game'};var from='shopModal';if(price==='facebook'){var config={url:location.href,caption:`Join me at ${gameData.title}`,// fb does not allow whitespaces in image url
image:gameData.cover?gameData.cover.replace(' ','%20'):undefined};shareOnFacebook(item,from,config,function(response){if(response){$(`[id=${itemId}][data-price=facebook]`).addClass('disabled');// if (isUnauthenticated === "true") {
// 	$('#login-modal').modal('show');
// } else {
self.buySkin(itemId,'facebook');// }
}});}else if(price==='twitter'){// this event is handled by template.js twitter.bind('tweet') listener
}}else{$('#purchasable-purchase-modal').data('purchasable',itemId);$('#purchasable-purchase-modal').modal('show');// if (confirm("Are you sure you want to purchase " + name + " ?")) {
// 	self.buySkin(itemId);
// }
}}else{$('.share-modal').modal('show');}}).catch(function(err){console.error(err);});});// equip purchasable
$(document).on('click','button.btn-equip',function(){var button=$(this);$.ajax({url:`/api/user/equip/${ige.game.data.defaultData.parentGame||ige.client.server.gameId}/${button.attr('id')}`,dataType:'html',type:'POST',success:function(data){var response=JSON.parse(data);if(response.status=='success'){self.updateModdShop();if(!ige.client.myPlayer._stats.purchasables||!(ige.client.myPlayer._stats.purchasables instanceof Array))ige.client.myPlayer._stats.purchasables=[];var equipedPurchasable=response.message;// ige.client.myPlayer._stats.purchasables.push(equipedPurchasable);
var myUnit=ige.$(ige.client.myPlayer._stats.selectedUnitId);ige.network.send('equipSkin',equipedPurchasable);// myUnit.equipSkin();
}else if(response.status=='error'){if(!response.message.includes('No matching document found')){alert(response.message);}}}});});// unequip purchasable
$(document).on('click','button.btn-unequip',function(){var button=$(this);var unEquipedId=button.attr('id');$.ajax({url:`/api/user/unequip/${ige.game.data.defaultData.parentGame||ige.client.server.gameId}/${unEquipedId}`,dataType:'html',type:'POST',success:function(data){var response=JSON.parse(data);if(response.status=='success'){var myUnit=ige.$(ige.client.myPlayer._stats.selectedUnitId);// myUnit.unEquipSkin(unEquipedId);
ige.network.send('unEquipSkin',unEquipedId);self.updateModdShop();}else if(response.status=='error'){alert(response.message);}}});});}},loadUserPurchases:function(){let self=this;$.ajax({url:`/api/user/${gameId}/purchases`,type:'GET',success:function(response){if(response.status=='success'){userPurchases=response.message||[];var userPurchasedItemIds=userPurchases.reduce(function(partial,purchase){partial[purchase._id]=true;return partial;},{});var purchasableItems=typeof purchasables.filter==='function'&&purchasables.filter(function(purchasable){return!userPurchasedItemIds[purchasable._id];})||[];// limit number of skins shown on menu
purchasableItems=purchasableItems.slice(0,4);purchasableItems.forEach(function(purchasable,index){let html=`<div id="skin-list-${purchasable._id}" class="border rounded bg-light p-2 mx-2 ${index<2?'mb-3':''} col-5 d-flex flex-column justify-content-between">`+'  <div class="my-2 text-center">'+`	<img src=" ${purchasable.image} " style="height: 45px; width: 45px;" />`+'	 </div>'+'	 <div class="d-flex justify-content-center action-button-container">';if(purchasable.soldForSocialShare){html+=self.getTwitterBtnHtml(purchasable);}else{html+=`		 <button class="btn btn-sm btn-outline-success btn-purchase-purchasable" id="${purchasable._id}"`+`			 data-purchasabled="${purchasable.name}" data-price="${purchasable.price}">`+'			 <div class="d-flex">'+'				 <div>'+'					 <img src="/assets/images/coin.png" style="width:15px; height: 15px" />'+'				 </div>'+`				 <div>${purchasable.price}				 </div>`+'			 </div>'+'		 </button>';}html+='	 </div>'+'</div>';var skin=$(html);// var itemDetails = null;
$('#skins-list').append(skin);// if (purchasable.target && purchasable.target.entityType == 'unit') {
// 	itemDetails = ige.game.getAsset('unitTypes', purchasable.target.key);
// }
// self.renderShopImage(itemDetails, purchasable, 'menu_image');
});$('#loading-skins').addClass('d-none');$('#skins-list').removeClass('d-none').addClass('row');}else if(response.status=='error'){$('#loading-skins').addClass('d-none');console.log(response.message);}}});},purchaseWarning:function(type,itemName){var text='';switch(type){case'requirement':text=`<strong>${itemName} requirements not met.</strong>`;break;case'price':text=`<strong>Cannot afford ${itemName}.</strong>`;break;case'inventory_full':text='<strong>No room in inventory.</strong>';break;case'purchase':text='<strong>Item purchased.</strong>';break;}if($('#modd-item-shop-modal').hasClass('show')){$('#item-purchase-warning').html(text);$('#item-purchase-warning').show();setTimeout(function(){$('#item-purchase-warning').fadeOut();},800);}},buySkin:function(itemId,sharedOn=''){var self=this;$.ajax({url:`/api/user/purchase/${ige.game.data.defaultData.parentGame||ige.client.server.gameId}/${itemId}?sharedOn=${sharedOn}`,dataType:'html',type:'POST',success:function(data){var response=JSON.parse(data);if(response.status=='success'){$('.player-coins').html(parseInt(response.remaining_coins));if(ige.client.myPlayer){ige.client.myPlayer._stats.coins=parseInt(response.remaining_coins);}$('#purchasable-purchase-modal').modal('hide');self.updateModdShop();self.updateSkinList(itemId);// update skin menu on game page
var details=$(`.btn-purchase-purchasable#${itemId}`);var purchasableInfo=details.find('.purchasable-details');if(purchasableInfo&&purchasableInfo.html){details.removeClass('btn-purchase-purchasable');purchasableInfo.html('<span class=\'fas fa-check text-success\'></span>');}}else if(response.status=='error'){if(!response.message.includes('No matching document found')){var error=`<div class="alert alert-danger text-center">${response.message}</div>`;$('#purchasable-purchase-modal .purchasable-info-container').html(error);}}}});},// tabSelected = unit/item
openModdShop:function(tabSelected,elementIdToFocus){if(ige.isClient){var self=this;this.hideEmptyTabs();if(tabSelected&&tabSelected=='item'&&$('[id=item]').css('display')=='none'){tabSelected='unit';}if(tabSelected&&tabSelected=='unit'&&$('[id=unit]').css('display')=='none'){tabSelected='item';}this.updateModdShop(tabSelected);if(elementIdToFocus){$('#modd-shop-modal').one('shown.bs.modal',function(){$(this).animate({scrollTop:$(elementIdToFocus).offset().top-100},1000,function(){$(elementIdToFocus).effect('highlight',{},3000);});});}$('#modd-shop-modal').modal({show:true,keyboard:true});}},hideEmptyTabs:function(){var self=this;var unitArr=[];var itemArr=[];if(!ige.game.data.unitTypes){$('[id=unit]').hide();$('[id=unitSkins]').hide();}else{for(unitId in ige.game.data.unitTypes){var unit=ige.game.data.unitTypes[unitId];if(unit.isPurchasable){unitArr.push(unit);}}if(unitArr.length===0){$('[id=unit]').hide();}}if(!ige.game.data.itemTypes){$('[id=item]').hide();$('[id=itemSkins]').hide();}else{for(itemId in ige.game.data.itemTypes){var item=ige.game.data.itemTypes[itemId];if(item.isPurchasable){itemArr.push(item);}}if(itemArr.length===0){$('[id=item]').hide();}else if(unitArr.length===0){if(self.shopType===undefined){self.shopType='item';$('[id=item]').addClass('active');}}}$.ajax({url:`/api/game/${ige.game.data.defaultData.parentGame||ige.client.server.gameId}/shopCount`,type:'GET',success:function(data){if(data.status==='success'){if(data.message){if(!data.message.unitCount||data.message.unitCount.length===0){$('[id=unitSkins]').hide();}else if(data.message.unitCount){for(var i in ige.game.data.unitTypes){var total=data.message.unitCount.filter(function(unit,key){if(unit&&unit.target&&unit.target.key===i)return true;});if(total){total=total.length;}else{total=0;}self.unitSkinCount[i]=total;}}if(!data.message.itemCount||data.message.itemCount.length===0){$('[id=itemSkins]').hide();}else if(data.message.itemCount){for(var i in ige.game.data.itemTypes){var total=data.message.itemCount.filter(function(item,key){if(item&&item.target&&item.target.key===i)return true;});if(total){total=total.length;}else{total=0;}self.itemSkinCount[i]=total;}}self.checkIfAnyTabSelected();}}}});},getTwitterBtnHtml:function(item){var sharedOn=item.sharedOn||{};var title=item.title||item.name;var sharedOnTwitter=sharedOn.twitter?'disabled':'';var gameId=ige.game.data.defaultData._id;var textToTweet=`Join me in ${ige.game.data.defaultData.title} (${location.href})`;var hashTags=['games','moddio'];var mentions=['moddio'];var twitterUrl=`https://twitter.com/intent/tweet?text=${textToTweet}&hashtags=${hashTags.join(',')}&via=${mentions.join(',')}`;return`<a id="${item._id}" data-unauthenticated="true" href="${twitterUrl}" data-from="marketplace-item" data-item-data='{"type": "game", "value": "${gameId}", "itemId": "${item._id}"}' data-price="twitter" data-purchasable="${title}" class="btn btn-outline-info btn-purchase-purchasable ${sharedOnTwitter}"><i class="fab fa-twitter-square fa-lg"></i></a>`;},buttonForSocialShare:function(item,unauthenticated){var btnHtml='';var sharedOn=item.sharedOn||{};var sharedOnFacebook=sharedOn.facebook?'disabled':'';var gameId=ige.game.data.defaultData._id;if(item){var title=item.title||item.name;btnHtml+='<div class="btn-group align-middle" role="group" aria-label="Basic example">';// remove facebook button from shop
// btnHtml += `<button data-unauthenticated="true" id="${item._id}" type="button" data-price="facebook" data-purchasable="${title}" class="btn btn-outline-primary btn-purchase-purchasable ${sharedOnFacebook}" style="padding-right:14px;padding-left:15px;"><i class="fab fa-facebook-square fa-lg"></i></button>`;
btnHtml+=this.getTwitterBtnHtml(item);btnHtml+='</div>';}return btnHtml;},updateModdShop:function(tabSelected){var self=this;if(ige.mobileControls){if(ige.mobileControls.isMobile){$('.open-coin-shop-button').hide();}}// populate shop sidebar keys
var keyList=$('<ul/>',{class:'list-group'});var isFirstKey=true;if(self.shopType===undefined){self.shopType='unit';}if(tabSelected){self.shopType=tabSelected;}if(self.shopType=='unitSkins'){$('.shop-navbar .nav-link').each(function(){$(this).removeClass('active');});$('#unitSkins').addClass('active');var unitKeys=Object.keys(ige.game.data.unitTypes);unitKeys=unitKeys.sort();// generating li column for unit type selection
for(var p=0;p<unitKeys.length;p++){var key=unitKeys[p];$('#modd-shop-modal .shop-items').html('');if(self.unitSkinCount[key]>0){// select first key by default
if(!self.shopKey&&isFirstKey){self.shopKey=key;}keyDiv=$('<li/>',{class:`list-group-item list-group-item-action cursor-pointer ${key==self.shopKey?'active':''}`,text:`${ige.game.data.unitTypes[key].name} (${self.unitSkinCount[key]})`,name:key}).on('click',function(){self.shopKey=$(this).attr('name');$('#modd-shop-modal .shop-items').html('');$('.list-group.item').each(function(){$(this).removeClass('active');});$(this).addClass('active');self.updateModdShop();});keyList.append(keyDiv);var isFirstKey=false;}}$('.shop-sidebar').html(keyList).show();}else if(self.shopType=='itemSkins'){$('.shop-navbar .nav-link').each(function(){$(this).removeClass('active');});$('#itemSkins').addClass('active');for(key in ige.game.data.itemTypes){$('#modd-shop-modal .shop-items').html('');if(self.itemSkinCount[key]>0){// by default, choose the first key
if(!self.shopKey&&isFirstKey){self.shopKey=key;}keyDiv=$('<li/>',{class:`list-group-item ${key==self.shopKey?'active':''}`,text:`${ige.game.data.itemTypes[key].name} (${self.itemSkinCount[key]})`,name:key}).on('click',function(){self.shopKey=$(this).attr('name');$('#modd-shop-modal .shop-items').html('');$('.list-group.item').each(function(){$(this).removeClass('active');});$(this).addClass('active');self.updateModdShop();});keyList.append(keyDiv);var isFirstKey=false;}}$('.shop-sidebar').html(keyList).show();}else if(self.shopType=='item')// general items right now they're just items, but we need to fix this
{$('.shop-sidebar').hide();}else if(self.shopType=='unit')// non existent :()
{$('.shop-sidebar').hide();}if(self.shopType=='unitSkins'||self.shopType=='itemSkins')// skins
{$.ajax({url:`/api/game/${ige.game.data.defaultData.parentGame||ige.client.server.gameId}/shop`,data:{type:self.shopType==='unitSkins'?'unit':'item',key:self.shopKey,page:self.shopPage},dataType:'html',type:'GET',success:function(data){var items=JSON.parse(data).message;var groupedItems={purchased:[],notPurchased:[]};items.forEach(function(item){if(item.status=='not_purchased'){groupedItems.notPurchased.push(item);}else{groupedItems.purchased.push(item);}});self.skinItems=groupedItems.purchased.concat(groupedItems.notPurchased);self.currentPagination=1;self.paginationForSkins();}});}},updateSkinList:function(itemId){debugger;var skinItemActionButton=$(`#skin-list-${itemId} .action-button-container`);skinItemActionButton.html('<button class="btn btn-sm btn-primary disabled">'+'Purchased'+'</button>');},checkIfAnyTabSelected:function(){var anyTabSelected=false;$('.shop-navbar .nav-link').each(function(){if($(this).hasClass('active')&&$(this).css('display')!='none'){anyTabSelected=true;return false;}});// if no tab is selected
if(!anyTabSelected){var self=this;$('.shop-navbar .nav-link').each(function(){// console.log($(this).css('display'));
if($(this).css('display')!='none'){self.shopType=$(this)[0].id;self.updateModdShop(self.shopType);return false;}});}},isItemRequirementSetisfied:function(req,priceAttr){var ownerPlayer=ige.client.myPlayer;var playerTypeAttribute=ownerPlayer._stats.attributes;if(playerTypeAttribute[priceAttr]){switch(req.type){case'atmost':if(playerTypeAttribute[priceAttr].value>req.value){return false;}break;case'exactly':if(playerTypeAttribute[priceAttr].value!=req.value){return false;}break;case'atleast':default:if(playerTypeAttribute[priceAttr].value<req.value){return false;}break;}return true;}return true;},getItemPopoverHtml:function(item,shopItem){var self=this;var html='';var ownerPlayer=ige.client.myPlayer;var ownerUnit=ige.$(ownerPlayer._stats.selectedUnitId);if(item.description){html+=`<p>${item.description}</P>`;}if(shopItem&&typeof shopItem.requirement==='object'){var requirements='';for(var priceAttr in shopItem.requirement.playerAttributes){var req=shopItem.requirement.playerAttributes[priceAttr];var requirementsSatisfied=self.isItemRequirementSetisfied(req,priceAttr)&&'text-success'||'text-danger';requirements+=`<p class='mb-2 ml-2 no-selection ${requirementsSatisfied}'>`;requirements+=req.value;requirements+=' ';requirements+=ige.game.data.attributeTypes[priceAttr]&&ige.game.data.attributeTypes[priceAttr].name||ownerPlayer._stats.attributes[priceAttr]&&ownerPlayer._stats.attributes[priceAttr].name;requirements+='</p>';}var requiredItemTypesKeys=Object.keys(shopItem.requirement.requiredItemTypes||{});for(var i=0;i<requiredItemTypesKeys.length;i++){var itemKey=requiredItemTypesKeys[i];var requiredQty=shopItem.requirement.requiredItemTypes[itemKey];var item=ige.game.getAsset('itemTypes',itemKey);var requirementsSatisfied=ownerUnit.inventory.hasRequiredQuantity(itemKey,requiredQty)&&'text-success'||'text-danger';requirements+=`<p  class="mb-2 ml-2 no-selection ${requirementsSatisfied}">${requiredQty||''} ${item.name}</p>`;}if(requirements){html+='<div class=\'mb-2\'>';html+='<p class=\'font-weight-bold mb-2\'>Requirements:</p>';html+=requirements;html+='</div>';}}if(shopItem&&typeof shopItem.price==='object'){var prices='';for(var priceAttr in shopItem.price.playerAttributes){var playerAttrValue=ownerPlayer._stats.attributes[priceAttr]&&ownerPlayer._stats.attributes[priceAttr].value||0;var requirementsSatisfied=parseFloat(shopItem.price.playerAttributes[priceAttr])<=parseFloat(playerAttrValue)&&'text-success'||'text-danger';prices+=`<p class='mb-2 ml-2 ${requirementsSatisfied}'>`;prices+=shopItem.price.playerAttributes[priceAttr];prices+=' ';prices+=ige.game.data.attributeTypes[priceAttr]&&ige.game.data.attributeTypes[priceAttr].name||ownerPlayer._stats.attributes[priceAttr]&&ownerPlayer._stats.attributes[priceAttr].name;prices+='</p>';}html+='<div>';var requiredItemTypesKeys=Object.keys(shopItem.price.requiredItemTypes||{});for(var i=0;i<requiredItemTypesKeys.length;i++){var itemKey=requiredItemTypesKeys[i];var requiredQty=shopItem.price.requiredItemTypes[itemKey];var item=ige.game.getAsset('itemTypes',itemKey);var requirementsSatisfied=ownerUnit.inventory.hasRequiredQuantity(itemKey,requiredQty)&&'text-success'||'text-danger';prices+=`<p  class="mb-2 ml-2 no-selection ${requirementsSatisfied}">${requiredQty||''} ${item.name}</p>`;}if(shopItem.price.coins){prices+=`<p><span><img src="${assetsProvider}/assets/images/coin.png" style="height:20px"/></span>${shopItem.price.coins}</p>`;}html+='<p class=\'font-weight-bold mb-2\'>Price:</p>';if(prices){html+=prices;}else{html+='<p class="mb-2 ml-2">free</p>';}html+='</div>';}return html;},openItemShop:function(type,selectedTab){var self=this;if(!ige.game.data.shops)return;self.currentType=type||self.currentType;if(!self.currentType)return;var shopItemsKeys=ige.game.data.shops[self.currentType]?Object.keys(ige.game.data.shops[self.currentType].itemTypes||{}):[];shopItemsKeys=shopItemsKeys.sort();var shopUnitsKeys=ige.game.data.shops[self.currentType]?Object.keys(ige.game.data.shops[self.currentType].unitTypes||{}):[];shopUnitsKeys=shopUnitsKeys.sort();var shopItems=ige.game.data.shops[self.currentType]?_.cloneDeep(ige.game.data.shops[self.currentType].itemTypes):[];var shopUnits=ige.game.data.shops[self.currentType]?ige.game.data.shops[self.currentType].unitTypes:[];var isDismissible=ige.game.data.shops[self.currentType]&&ige.game.data.shops[self.currentType].dismissible!=undefined?ige.game.data.shops[self.currentType].dismissible:true;var shopItemsKeysUsingCoins=[];for(var key in shopItems){if(typeof shopItems[key].price=='object'&&shopItems[key].price.coins!=undefined&&shopItems[key].price.coins>0){shopItemsKeysUsingCoins.push(key);}}shopItemsKeysUsingCoins.forEach(key=>{delete shopItems[key];});// display items tab iff there's item to be sold
if(shopItemsKeys.length>0){$('[id=item]').show();if(!selectedTab)// if default selectedTab wasn't assigned, assign it as items
{selectedTab='items';}}else{$('[id=item]').hide();}// display units tab iff there's item to be sold
if(shopUnitsKeys.length>0){$('[id=unit]').show();if(!selectedTab)// if default selectedTab wasn't assigned, assign it as items
{selectedTab='units';}}else{$('[id=unit]').hide();}var modalBody=$('<div/>',{class:'row text-center'});var ownerPlayer=ige.client.myPlayer;if(!ownerPlayer)return;var isAdBlockEnabled=ownerPlayer._stats.isAdBlockEnabled;var ownerUnit=ige.$(ownerPlayer._stats.selectedUnitId);var playerTypeAttribute=ownerPlayer._stats.attributes;var imgArray=[];if(selectedTab==='items'){$('.item-shop-navbar .nav-link').each(function(){$(this).removeClass('active');});$('[id=item]').addClass('active');for(var i=0;i<shopItemsKeys.length;i++){var item=ige.game.getAsset('itemTypes',shopItemsKeys[i]);var shopItem=shopItems[shopItemsKeys[i]];if(item&&shopItem&&shopItem.isPurchasable){// set flag for player type so it can be purchased by only that player
var isPurchasableByCurrentPlayerType=true;if(item.canBePurchasedBy&&item.canBePurchasedBy.length>0&&ownerPlayer._stats&&ownerPlayer._stats.playerTypeId){isPurchasableByCurrentPlayerType=item.canBePurchasedBy.includes(ownerPlayer._stats.playerTypeId);}var isItemAffordable=true;var requirementsSatisfied=true;if(typeof shopItem.requirement==='object'){for(var priceAttr in shopItem.requirement.playerAttributes){if(playerTypeAttribute&&playerTypeAttribute[priceAttr]){var req=shopItem.requirement.playerAttributes[priceAttr];var requirementsSatisfied=self.isItemRequirementSetisfied(req,priceAttr);if(!requirementsSatisfied){break;}}}// checking items to be removed present in selected unit inventory
if(requirementsSatisfied){var requiredItemTypesKeys=Object.keys(shopItem.requirement.requiredItemTypes||{});for(var j=0;j<requiredItemTypesKeys.length;j++){var itemKey=requiredItemTypesKeys[j];var requiredQuantity=shopItem.requirement.requiredItemTypes[itemKey];requirementsSatisfied=ownerUnit.inventory.hasRequiredQuantity(itemKey,requiredQuantity);if(!requiredItemTypesKeys){break;}}}}if(typeof shopItem.price==='object'){if(shopItem.price.coins&&ownerPlayer._stats.coins<shopItem.price.coins){isItemAffordable=false;}for(var priceAttr in shopItem.price.playerAttributes){if(playerTypeAttribute&&playerTypeAttribute[priceAttr]&&parseFloat(playerTypeAttribute[priceAttr].value)<parseFloat(shopItem.price.playerAttributes[priceAttr])){isItemAffordable=false;break;}}// checking items to be removed present in selected unit inventory
if(isItemAffordable){var requiredItemTypesKeys=Object.keys(shopItem.price.requiredItemTypes||{});for(var j=0;j<requiredItemTypesKeys.length;j++){var itemKey=requiredItemTypesKeys[j];var requiredQuantity=shopItem.price.requiredItemTypes[itemKey];isItemAffordable=ownerUnit.inventory.hasRequiredQuantity(itemKey,requiredQuantity);if(!isItemAffordable){break;}}}}var itemDetail=$('<div/>',{style:'font-size: 16px; width: 250px;',html:self.getItemPopoverHtml(item,shopItem)});var bgColor=requirementsSatisfied&&isItemAffordable?'bg-light-green':'bg-light-red';var itemImage=$('<div/>',{id:shopItemsKeys[i],isadblockenabled:isAdBlockEnabled,class:'col-sm-2-5 rounded align-bottom btn-purchase-item item-shop-button',name:item.name,requirementsSatisfied:!!requirementsSatisfied,isItemAffordable:!!isItemAffordable});if((!isItemAffordable||!isPurchasableByCurrentPlayerType)&&shopItem.hideIfUnaffordable||!requirementsSatisfied&&shopItem.hideIfRequirementNotMet){// if unaffordable and hideIfUnaffordable then dont show item in shop
}else{var img=$('<div/>').html(`img_index_${imgArray.length}`);imgArray.push({wrapper:img,value:`<img src='${item.inventoryImage||item.cellSheet.url}' style='width: auto; height: auto; max-width: 55px; max-height: 55px'>`});var itemName='<div class=\'mx-2 mt-2 mb-0 no-selection\' style=\'line-height:0.7  !important; overflow-wrap: break-word;\'><small>';itemName+=item.name;itemName+='</small></div>';var combine=$('<div/>',{class:`mx-2 p-3 mb-3 rounded item-shop-button-div d-flex flex-column justify-content-end align-items-center ${bgColor}`,style:'min-height:110px;max-height:110px;position:relative;','data-toggle':'popover','data-placement':'top','data-content':itemDetail.prop('outerHTML')}).append(img).append(itemName);combine.popover({html:true,trigger:'hover'});modalBody.append(itemImage.append(combine));}}}}else if(selectedTab==='units'){$('.item-shop-navbar .nav-link').each(function(){$(this).removeClass('active');});$('[id=unit]').addClass('active');for(var i=0;i<shopUnitsKeys.length;i++){var unit=ige.game.getAsset('unitTypes',shopUnitsKeys[i]);var shopUnit=shopUnits[shopUnitsKeys[i]];if(shopUnit&&shopUnit.isPurchasable){var isPurchasableByCurrentPlayerType=true;if(unit.canBePurchasedBy&&unit.canBePurchasedBy.length>0&&ownerPlayer._stats&&ownerPlayer._stats.playerTypeId){isPurchasableByCurrentPlayerType=unit.canBePurchasedBy.includes(ownerPlayer._stats.playerTypeId);}var isUnitAffordable=true;var requirementsSatisfied=true;if(typeof shopUnit.requirement==='object'){for(var priceAttr in shopUnit.requirement.playerAttributes){if(playerTypeAttribute&&playerTypeAttribute[priceAttr]){var req=shopUnit.requirement.playerAttributes[priceAttr];var requirementsSatisfied=self.isItemRequirementSetisfied(req,priceAttr);if(!requirementsSatisfied){break;}}}}if(requirementsSatisfied){if(typeof shopUnit.price==='object'){for(var priceAttr in shopUnit.price.playerAttributes){if(playerTypeAttribute&&playerTypeAttribute[priceAttr]&&playerTypeAttribute[priceAttr].value<shopUnit.price.playerAttributes[priceAttr]){isUnitAffordable=false;break;}}}}var button=$('<button/>',{type:'button',class:`btn ${requirementsSatisfied&&isUnitAffordable&&isPurchasableByCurrentPlayerType?'btn-success btn-purchase-unit':'btn-danger'}`,style:'',id:shopUnitsKeys[i],name:unit.name});var btnLabel=self.shopBtnLabel(shopUnit,playerTypeAttribute);button.append(btnLabel);if(shopUnit.hideIfUnaffordable&&!isUnitAffordable||shopUnit.hideIfRequirementNotMet&&!requirementsSatisfied){}else{modalBody.append($('<div/>',{class:'col-sm-3 align-bottom',style:'margin-bottom: 30px;'}).append($('<img/>',{src:unit.inventoryImage||unit.cellSheet.url,style:'width: auto; height: auto; max-width: 64px; max-height: 64px'})).append(`<div class='row text-center'><div class='col no-selection'>${unit.name}</div></div>`).append(button));}}}}if(modalBody.html()==''){modalBody.append('<div class=\'col text-center\'>There\'s nothing to be displayed here</div>');}var modalUpdated=false;if(self.oldModalHTMLBody!=modalBody.html()){modalUpdated=true;self.oldModalHTMLBody=_.cloneDeep(modalBody.html());$('#modd-item-shop-modal .items-shop').html(modalBody);imgArray.forEach(function(data){data.wrapper.html(data.value);});}// console.log({
// 	backdrop: isDismissible ? true : 'static',
// 	keyboard: isDismissible,
// 	show: false
// })
$('#modd-item-shop-modal').modal({backdrop:isDismissible?true:'static',keyboard:isDismissible,show:false});// reload shop ad as per adinplay request.
// aiptag.cmd.display.push(function () { aipDisplayTag.display('modd-io_728x90_shop'); });
if(isDismissible){$('#modd-item-shop-dismiss-button').show();}else{$('#modd-item-shop-dismiss-button').hide();}},shopBtnLabel:function(type,playerTypeAttribute){var firstLoop=true;var btnLabel='';var priceKey=[];var coins=0;var itemsRequired=[];var attributeTypes=ige.game.data.attributeTypes;if(typeof type.price==='object'){coins=type.price.coins;priceKey=Object.keys(type.price.playerAttributes||{});itemsRequired=type.price.requiredItemTypes;}if(!priceKey||priceKey.length===0){btnLabel='free';}priceKey.forEach(function(key){var price=type.price.playerAttributes[key];var selectedAttribute={};selectedAttribute=ige.game.data.attributeTypes[key]||playerTypeAttribute[key];if(typeof selectedAttribute==='object'){if(Object.keys(selectedAttribute||[]).length===0){selectedAttribute=attributeTypes[key];}var label=Object.keys(selectedAttribute||[]).length?selectedAttribute.name:null;}if(!firstLoop&&label){btnLabel+='<br/>';}if(firstLoop&&label===null){btnLabel='free';}else{btnLabel+=`${label} ${price}`;}firstLoop=false;});var requiredItemTypesKeys=Object.keys(itemsRequired||{});for(var i=0;i<requiredItemTypesKeys.length;i++){var itemKey=requiredItemTypesKeys[i];var requiredQty=itemsRequired[itemKey];var item=ige.game.getAsset('itemTypes',itemKey);if(btnLabel=='free'){btnLabel='';}if(btnLabel){btnLabel+='<br/>';}btnLabel+=item.name;if(requiredQty){btnLabel+=` - ${requiredQty}`;}}if(coins){if(btnLabel=='free'){btnLabel='';}if(btnLabel){btnLabel+='<br/>';}btnLabel+=`<span><img src="${assetsProvider}/assets/images/coin.png" style="height:20px"/></span>${coins}`;}return btnLabel;},openCoinShop:function(){if(ige.isClient){$('#coin-shop-modal').modal({show:true,keybfoard:true});}},// for in-game shop keeper shop
enableShop:function(){$('#shop-modal').modal({show:false,keyboard:true}).on('hidden.bs.modal',function(){shoppingModalManuallyHidden=true;$('#footer').hide();});},renderSkinsButtons:function(items){var self=this;var modalBody=$('<div/>',{class:'row text-center'});for(var i in items){var item=items[i];// console.log(item)
if(item.status=='not_purchased'){if(item.soldForSocialShare){var button=self.buttonForSocialShare(item);}else{var button=$('<button/>',{type:'button',class:'btn btn-outline-secondary align-middle btn-purchase-purchasable',id:item._id,'data-purchasable':item.title||item.name,'data-price':item.price}).append($('<img/>',{src:`${assetsProvider}/assets/images/coin.png`,style:'width:18; height: 18px'})).append(item.price);}}else if(item.status=='purchased'){var button=$('<button/>',{type:'button',class:'btn btn-outline-success align-middle btn-equip',id:item._id,name:item.title||item.name}).append('Equip');}else if(item.status=='equipped'){var button=$('<button/>',{type:'button',class:'btn btn-success align-middle btn-unequip',id:item._id,name:item.name||item.title}).append('Equiped');}else if(item.status==undefined){if(item.soldForSocialShare){var button=self.buttonForSocialShare(item,true);}else{var button=$('<button/>',{type:'button',class:'btn btn-danger align-middle btn-purchase-purchasable',id:item._id,'data-purchasable':item.name||item.title,'data-price':item.price,'data-unauthenticated':'true'}).append($('<img/>',{src:`${assetsProvider}/assets/images/coin.png`,style:'width:18; height: 18px'})).append(item.price);}}let clipping=`background:url('${item.image}')`;// let originalImage = {};
let itemDetails=null;modalBody.append($('<div/>',{class:'col-sm-3 py-3 d-flex flex-column justify-content-end align-items-center'}).append($('<div/>').append($('<div/>',{id:`${item._id}_image`,style:clipping,class:'is-mobile'}))).append('<br/>').append(button));if(item.target&&item.target.entityType=='unit'){itemDetails=ige.game.getAsset('unitTypes',item.target.key);}this.renderShopImage(itemDetails,item,'image');}$('#modd-shop-modal .shop-items').html(modalBody);},renderShopImage:function(itemDetails,item,selector){if(itemDetails&&itemDetails.cellSheet){if(itemDetails.cellSheet.columnCount<=0){itemDetails.cellSheet.columnCount=1;}if(itemDetails.cellSheet.rowCount<=0){itemDetails.cellSheet.rowCount=1;}let image=new Image();let itemId=item._id;image.src=item.image;image.onload=function(){let img=document.getElementById(`${itemId}_${selector}`);let originalHeight=`${image.height/itemDetails.cellSheet.rowCount}px`;let originalWidth=`${image.width/itemDetails.cellSheet.columnCount}px`;// clipping = "height:" + originalHeight + "px;width:" + originalWidth + "px;background:url('" + item.image + "') 0px 0px no-repeat;";
img.style.height=originalHeight;img.style.width=originalWidth;img.style.background=`url('${image.src}')`;img.src='';if(itemDetails.cellSheet.rowCount<=1&&itemDetails.cellSheet.columnCount<=1){img.style.backgroundRepeat='no-repeat';img.style.backgroundPosition='center center';img.style.backgroundSize='contain';img.style.maxHeight='64px';img.style.maxWidth='64px';}};}},paginationForSkins:function(){var self=this;var totalPages=Math.ceil(self.skinItems.length/self.perPageItems);var maxPageNumber=Math.min(11,totalPages);if(ige.mobileControls&&ige.mobileControls.isMobile){maxPageNumber=Math.min(3,totalPages);}var currentPage=self.currentPagination-1;var skip=currentPage*self.perPageItems;var items=_.slice(self.skinItems,skip,skip+self.perPageItems);self.renderSkinsButtons(items);var html='<nav aria-label="Page navigation">';html+='<ul class="pagination m-0">';html+='<li class="page-item skin-pagination" data-text="previous"><span class="page-link">Previous</span></li>';for(var i=Math.max(1,currentPage);i<Math.min(totalPages+1,currentPage+maxPageNumber+1);i++){html+=`<li class="page-item  skin-pagination ${self.currentPagination==i?'active':''}" data-text="${i}"><span class="page-link">${i}</span></li>`;}html+='<li class="page-item  skin-pagination" data-text="next"><span class="page-link">Next</span></li>';html+='</ul>';html+='</nav>';$('#mod-shop-pagination').html(html);},toggleShop:function(){if($('#modd-shop-modal').is(':visible')){$('#modd-shop-modal').modal('hide');}else{this.openModdShop();}},closeShop:function(clientId){if(ige.isClient){// console.log("hide!")
$('#shop-modal').modal('hide');this.closeModals();}else if(ige.isServer){ige.network.send('ui',{command:'closeShop'},clientId);}},purchase:function(id){ige.network.send('buyItem',id);// using attr name instead of skinName, otherwise, it'll send the last itemName in constants.itemTypes only
},purchaseUnit:function(id){ige.network.send('buyUnit',id);},enableStockCycle:function(){var self=this;var stockClock=setInterval(function(){self.removeOldestItem();while(self.inventory.length<self.maxInventorySize){self.addItem(ige.item.getRandomItemData({isPurchasable:true}));// only get items that have isPurchasable set as true
}},process.env.ENV=='dev'?3000:30000);},addItem:function(data){var self=this;self.inventory.push(data);if(ige.isServer){if(data){data.id=ige.newIdHex();ige.network.send('addShopItem',data);}}else if(ige.isClient){var self=this;var modalBody=$('#shop-modal .modal-body');$('.popover').remove();// console.log("adding item", data)
var itemDiv=ige.itemUi.getItemSlotDiv(data,{popover:'bottom',isDraggable:false,isPurchasable:true});modalBody.append(itemDiv);}},removeOldestItem:function(){var self=this;var item=self.inventory.shift();// remove the oldest item
if(item){self.removeItem(item.id);}},removeItem:function(id){if(ige.isServer){delete this.inventory[id];ige.network.send('removeShopItem',{id:id});}else if(ige.isClient){$(`.inventory-slot[id='${id}']`).remove();}},getItems:function(){return this.inventory;},updateShopInventory:function(items,clientId){var self=this;if(ige.isServer){if(items.length>0){ige.network.send('updateShopInventory',items,clientId);}}else if(ige.isClient){for(i in items){self.addItem(items[i]);}}},closeModals:function(){$('#modd-shop-modal').modal('hide');$('#modd-item-shop-modal').modal('hide');$('#confirm-purchase-modal').modal('hide');},getItemById:function(itemTypeId){var itemData=ige.game.getAsset('itemTypes',itemTypeId);if(itemData){itemData.itemTypeId=itemTypeId;return itemData;}},getUnitById:function(unitId){var unitData=ige.game.getAsset('unitTypes',unitId);if(unitData){unitData.unitTypeId=unitId;return unitData;}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ShopComponent;};var RegionManager=$i_2.extend({classId:'RegionManager',componentId:'regionManager',init:function(){var self=this;self.isAddNewRegion=false;self.entitiesInRegion={};if(ige.isClient){$('#region-modal-client').on('submit','#region-form',function(e){e.preventDefault();var defaultKey=$('#region-modal-key').val();self.submitRegion();});$('#region-modal-client').on('keypress',function(e){if(e.charCode===13){e.preventDefault();self.submitRegion();}});$('#region-modal-client').on('click','#region-delete-btn',function(e){e.preventDefault();var defaultKey=$('#region-modal-defaultKey').val();x;var updatedRegion={deleteKey:defaultKey};self.updateRegionToDatabase(updatedRegion);});}},getRegionById(regionName){return ige.$$('region').find(function(region){if(region&&region._stats&&region._stats.id===regionName){return true;}});},submitRegion:function(){var self=this;var updatedRegion={dataType:$('#region-modal-datatype').val(),key:$('#region-modal-key').val(),default:{x:parseFloat($('#region-modal-x').val()),y:parseFloat($('#region-modal-y').val()),width:parseFloat($('#region-modal-width').val()),height:parseFloat($('#region-modal-height').val())}};if($('#region-modal-key').val()!=$('#region-modal-defaultKey').val()){updatedRegion.deleteKey=$('#region-modal-defaultKey').val();}if(updatedRegion.key.includes('.')){swal('Alert!!!','cannot create region having \'.\' in the key','error');return;}self.updateRegionToDatabase(updatedRegion);},updateRegionToDatabase:function(updatedRegion){var self=this;var isRegionDeleted=false;var region=ige.regionManager.getRegionById(updatedRegion.key);var deleteRegion=ige.regionManager.getRegionById(updatedRegion.deleteKey);var isRegionSameAsDeleted=region===deleteRegion;if(deleteRegion&&updatedRegion.deleteKey){delete ige.game.data.variables[updatedRegion.deleteKey];deleteRegion.deleteRegion();isRegionDeleted=true;}if(updatedRegion.key){if(region&&region._stats){for(var i in region._stats){if(updatedRegion[i]){if(typeof region._stats[i]==='object'){for(var j in region._stats[i]){if(updatedRegion[i][j]!=undefined){region._stats[i][j]=updatedRegion[i][j];}else{updatedRegion[i][j]=region._stats[i][j];}}}else{region._stats[i]=updatedRegion[i];}}}region.updateDimension();}else{var updatedRegionKey=updatedRegion.key;var copiedRegion=JSON.parse(JSON.stringify(updatedRegion));delete copiedRegion.key;ige.game.data.variables[updatedRegionKey]=copiedRegion;ige.map.createRegions();}}window.updateReactGameState(JSON.parse(JSON.stringify(updatedRegion)));if(isRegionDeleted){var newRegion=JSON.parse(JSON.stringify(updatedRegion));var regionKey=newRegion.key;delete newRegion.key;ige.game.data.variables[regionKey]=newRegion;ige.map.createRegions();}$('#region-modal-client').modal('hide');},openRegionModal:function(region,key,isAddNewRegion){if(isAddNewRegion){ige.regionManager.isAddNewRegion=isAddNewRegion;}if(region&&!$('#region-modal-client').hasClass('show')){$('#region-modal-datatype').val(region.dataType);$('#region-modal-x').val(region.default.x);$('#region-modal-y').val(region.default.y);$('#region-modal-width').val(region.default.width);$('#region-modal-height').val(region.default.height);$('#region-modal-defaultKey').val(key);$('#region-modal-key').val(key);if(isAddNewRegion){$('#region-update-btn').html('<i class=\'fa fa-plus\'></i> Create</button>');$('#region-delete-btn').prop('disabled',true);}else{ige.regionManager.isAddNewRegion=false;$('#region-update-btn').html('<i class=\'fa fa-floppy-o\'></i> Save</button>');$('#region-delete-btn').prop('disabled',false);// $('#region-modal-key').prop("disabled", true);
}$('button').focus(function(){this.blur();});$('#region-modal-client').modal({show:true});}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=RegionManager;};var TweenComponent=$i_56.extend({classId:'TweenComponent',componentId:'tween',init:function(parentEntity){var self=this;self._entity=parentEntity;self.queue=[];self.keyFrames=[];self.offset={x:0,y:0,rotate:0};// x, y, angle
self.tweens={idle:{// idle
type:'translate',loopCount:-1,// loop infinitely
keyFrames:[[0,[0,0,0]],[400,[0,-2,0]],[800,[0,0,0]]]},wobble:{type:'swing',loopCount:-1,keyFrames:[[0,[0,0,0]],[50,[0,0,0.1]],[100,[0,0,-0.1]],[50,[0,0,0]]]},poke:{type:'translate',loopCount:1,keyFrames:[[0,[0,0,0]],[60,[0,50,0]],[180,[0,0,0]]]},recoil:{type:'translate',loopCount:1,keyFrames:[[0,[0,0,0]],[20,[0,-10,0]],[150,[0,0,0]]]},swingCW:{type:'swing',loopCount:1,keyFrames:[[0,[0,0,0]],[100,[0,0,3.14]],[250,[0,0,0]]]},swingCCW:{type:'swing',loopCount:1,keyFrames:[[0,[0,0,0]],[100,[0,0,-3.14]],[250,[0,0,0]]]}};},/* queue a new tween. if a matching tweenId exists among the previously queued tweens, remove that matching tween.
    * @param {angle} the reference angle to apply tweening to.
    * for example, if it's an item poking, then reference angle should be item's facing angle.
    * If it's a tree that's being hit, then reference angle should be angle between tree and the item
    */ // queueTween: function(tweenId, angle) {
//     console.log("tweenQueuing", tweenId)
//     for (var i=0; i < this.queue.length; i++) {
//         var tween = this.queue[i]
//         if (tween[1] == tweenId) { // remove duplicate tween
//             this.queue.splice(i, 1);
//         }
//     }
//     this.queue.push([ige._currentTime, tweenId, this.tweens[tweenId], angle])
//     this.isTweening = true;
// },
start:function(tweenId,angle,customTween){// use customTween (e.g. change item)
if(customTween){var tween=customTween;}else{// pre-defined tween
if(!this.tweens[tweenId]){this.stop();return;}var tween=JSON.parse(JSON.stringify(this.tweens[tweenId]));}// if (tweenId == 'swingCW' || tweenId == 'swingCCW') {
//     this.keyFrames[1] = [100, [this._entity.height(), this._entity.height()/2, 3.14]]
// }
this.tweenId=tweenId;this.keyFrames=tween.keyFrames;this.type=tween.type;this.loopCount=tween.loopCount;this.angle=angle;this.startTime=ige._currentTime;this.offset={x:0,y:0,rotate:0};this.lastFrame=this.keyFrames.shift();this.nextFrame=this.keyFrames[0];this.isTweening=true;},stop:function(){this.tweenId=undefined;this.isTweening=false;},// traverse through all queued tweens, and compute combined offset values (x, y, angle)
update:function(){var angle=this.angle;if(angle==undefined){angle=this._entity._rotate.z;}if(this.keyFrames.length>0){var nextFrameEndsAt=this.startTime+this.nextFrame[0];if(ige._currentTime<nextFrameEndsAt){var x=this.lastFrame[1][0];var y=this.lastFrame[1][1];var rotate=this.lastFrame[1][2];var targetX=this.nextFrame[1][0];var targetY=this.nextFrame[1][1];var targetRotate=this.nextFrame[1][2];// if entity is flipped, then flip the keyFrames as well
if(this._entity._stats.flip==1){x=-this.lastFrame[1][0];targetX=-this.nextFrame[1][0];rotate=-this.lastFrame[1][2];targetRotate=-this.nextFrame[1][2];}var interpolatedX=this._entity.interpolateValue(x,targetX,this.startTime,ige._currentTime,nextFrameEndsAt);var interpolatedY=this._entity.interpolateValue(y,targetY,this.startTime,ige._currentTime,nextFrameEndsAt);var interpolatedRotate=this.interpolateValue(rotate,targetRotate,this.startTime,ige._currentTime,nextFrameEndsAt);// for smooth transitioning from 3.14 to -3.14
if(Math.abs(targetRotate-rotate)>Math.PI){if(targetRotate>rotate)rotate+=Math.PI*2;else rotate-=Math.PI*2;}this.offset.rotate=interpolatedRotate;if(this._entity._category=='item'&&this._entity._stats.currentBody){if(this._entity._stats.currentBody.jointType=='weldJoint'){var ownerUnit=this._entity.getOwnerUnit();if(ownerUnit){rotate=ownerUnit._rotate.z;}}// if item is rotating, and is carried by a unit, then compute its new rotation axis using its itemAnchor and unit anchor.
if(this.offset.rotate!=0){rotate=this._entity._rotate.z;var before=this._entity.getAnchoredOffset(rotate);var after=this._entity.getAnchoredOffset(rotate+interpolatedRotate);this.offset.x=after.x-before.x;this.offset.y=after.y-before.y;return;}}interpolatedRotate+=angle;this.offset.x=interpolatedX*Math.cos(interpolatedRotate)+interpolatedY*Math.sin(interpolatedRotate);this.offset.y=interpolatedX*Math.sin(interpolatedRotate)-interpolatedY*Math.cos(interpolatedRotate);}else{this.lastFrame=this.keyFrames.shift();this.nextFrame=this.keyFrames[0];this.startTime=ige._currentTime;}}else{// repeat infinite tween
if(this.loopCount==-1){this.start(this.tweenId);return;}this.offset={x:0,y:0,rotate:0};this.isTweening=false;}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=TweenComponent;};var MenuUiComponent=$i_56.extend({classId:'MenuUiComponent',componentId:'menuUi',init:function(){var self=this;// adding event for taro engine button
var playButtonClick=document.querySelector("#play-game-button");if(ige.isClient){console.log('initializing UI elements...');self.shopType='';self.shopKey='';self.shopPage=1;$('#reconnect-button').on('click',function(){location.reload();});$('#kick-player').on('click',function(){$('#kick-players-outofgame-modal').modal('show');});// $(".inventory-item-button").on("click", function () {
// 	if (ige.client.selectedUnit) {
// 		var index = $(this).attr('name');
// 		ige.client.selectedUnit._stats.currentItemIndex = index;
// 		ige.client.selectedUnit.changeItem(index);
// 	}
// });
$('#resolution-high').on('click',function(){localStorage.setItem('resolution','high');self.setResolution();});$('#resolution-low').on('click',function(){// setting 640x480 resolution as low resolution
if($('#igeFrontBuffer').attr('width')!=640&&$('#igeFrontBuffer').attr('height')!=480){localStorage.setItem('resolution','low');self.setResolution();if(typeof incrLowResolution==='function'){incrLowResolution();}}});// register error log modal btn;
$('#dev-error-button').on('click',function(){$('#error-log-modal').modal('show');});$('#bandwidth-usage').on('click',function(){$('#dev-status-modal').modal('show');});$('#leaderboard-link').on('click',function(e){e.preventDefault();$('#leaderboard-modal').modal('show');});$('#refresh-server-list-button').on('click',function(){ige.client.refreshServerList();});$('#max-players').on('change',function(){ige.client.refreshServerList();});$('#map-list').on('change',function(){ige.client.refreshServerList();});$('#kick-player-body').on('click','.kick-player-btn',function(){var clientId=$(this).attr('data-clientid');if((ige.game.data.isDeveloper||ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod)&&clientId){ige.network.send('kick',clientId);}});$('#kick-player-body').on('click','.ban-player-btn',function(){var userId=$(this).attr('data-userId');var gameId=$(this).attr('data-gameId');var clientId=$(this).attr('data-clientid');if((ige.game.data.isDeveloper||ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod)&&userId){ige.network.send('ban-user',{kickuserId:clientId,userId:userId});}});$('#kick-player-body').on('click','.ban-ip-btn',function(){var gameId=$(this).attr('data-gameId');var clientId=$(this).attr('data-clientid');if((ige.game.data.isDeveloper||ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod)&&gameId){ige.network.send('ban-ip',{gameId:gameId,kickuserId:clientId});}});$('#kick-player-body').on('click','.ban-chat-btn',function(){var gameId=$(this).attr('data-gameId');var clientId=$(this).attr('data-clientid');if((ige.game.data.isDeveloper||ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod)&&gameId){ige.network.send('ban-chat',{gameId:gameId,kickuserId:clientId});}});$('#open-inventory-button').on('click',function(){if($('#backpack').is(':visible')){$('#backpack').hide();}else{$('#backpack').show();}});$('.open-menu-button').on('click',function(){self.toggleMenu();$('.open-menu-button').hide();});$('#change-server').on('click',function(){window.location.replace(`/play/${gameSlug}?serverId=${ige.client.changedServer}&joinGame=true`);});$('#add-player-instance').on('click',function(){var url=`${window.location.host}/play/${gameSlug}?add-instance=true`;Swal({html:`<div class='swal2-title'>Want to add player instance?</div><div class='swal2-text' style='user-select: text;'>Copy the link given below and open it in incognito mode.<br/><input type='text' class='form-control mt-2' value='${url}' /></div>`,button:'close'});});// once modal is hidden, then it's no longer shown when the game starts
$('#help-modal').on('hidden.bs.modal',function(e){localStorage.setItem('tutorial','off');});$('#server-list').on('change',function(){var gameSlug=$(this).attr('game-slug');ige.client.gameSlug=gameSlug;if(ige.client.servers){for(var i=0;i<ige.client.servers.length;i++){var serverObj=ige.client.servers[i];if(serverObj.id===this.value){ige.client.server=serverObj;}}}});if(typeof isLoggedIn!=='undefined'&&isLoggedIn){$('#logged-in-as-a-guest').hide();// $("#menu-buttons").hide();
}else{$('#logged-in-as-a-guest').show();}$('#menu-form').keyup(function(e){if(e.keyCode==13){ige.client.login();}});$('#login-button').on('click',function(){ige.client.login();});$('#close-game-suggestion').on('click',function(){$('#more-games').removeClass('slideup-menu-animation').addClass('slidedown-menu-animation');});$('#play-as-guest-button').on('click',function(){// console.log("Play !");
// ige.client.joinGame()
self.playGame();});$('#server-list').on('blur',function(){$('#server-list').attr('size',1);});$('#server-list').on('click',function(){$('#server-list').attr('size',1);});// this should only be a temporary solution
// we need to find a better way to implement the callbacks
// all related to clicking the Play Game button
playButtonClick.addEventListener('connectPlayer',function(){if(this.innerText.includes('Connection Failed')){var serverLength=$('#server-list')&&$('#server-list')[0]&&$('#server-list')[0].children.length;$('#server-list').attr('size',serverLength);$('#server-list').focus();}else{// did user tried to change server
var isServerChanged=window.connectedServer&&ige.client.server.id!==window.connectedServer.id;if(isServerChanged){window.location=`${window.location.pathname}?serverId=${ige.client.server.id}&joinGame=true`;return;}if(ige.game&&ige.game.isGameStarted){var wasGamePaused=this.innerText.includes('Continue');self.playGame(wasGamePaused);self.setResolution();}else{$('#play-game-button').attr('disabled',true);self.startLoading();ige.client.connectToServer();}}$('#play-game-button-wrapper').addClass('d-none-important');});if(window.location.hostname=='localhost'){$('#play-game-button').on('click',function(){if(this.innerText.includes('Connection Failed')){var serverLength=$('#server-list')&&$('#server-list')[0]&&$('#server-list')[0].children.length;$('#server-list').attr('size',serverLength);$('#server-list').focus();}else{// did user tried to change server
var isServerChanged=window.connectedServer&&ige.client.server.id!==window.connectedServer.id;if(isServerChanged){window.location=`${window.location.pathname}?serverId=${ige.client.server.id}&joinGame=true`;return;}if(ige.game&&ige.game.isGameStarted){var wasGamePaused=this.innerText.includes('Continue');self.playGame(wasGamePaused);self.setResolution();}else{$('#play-game-button').attr('disabled',true);self.startLoading();ige.client.connectToServer();}}$('#play-game-button-wrapper').addClass('d-none-important');});}$('#help-button').on('click',function(){$('#help-modal').modal('show');});}},toggleScoreBoard:function(show){if(ige.game.data&&ige.game.data.settings&&!ige.game.data.settings.displayScoreboard){$('#scoreboard-header').hide();$('#scoreboard').hide();}else{if(show){$('#scoreboard-header').show();$('#scoreboard').show();$('#leaderboard').show();}else{$('#scoreboard-header').hide();$('#scoreboard').hide();$('#leaderboard').hide();}}},toggleLeaderBoard:function(show){if(show){$('#leaderboard').show();}else{$('#leaderboard').hide();}},toggleGameSuggestionCard:function(show){if(show){// $('#game-suggestions-card').removeClass('d-xl-none');
// $('#game-suggestions-card').addClass('d-xl-block');
}else{// $('#game-suggestions-card').removeClass('d-xl-block');
// $('#game-suggestions-card').addClass('d-xl-none');
}},startLoading:function(){var html=$('#play-game-button .content').html();if(/connecting/i.test(html)){// loader is already shown
return;}var html='<i class="fa fa-sync mr-2 py-3 fa-spin" aria-hidden="true"></i>Connecting.....';$('#play-game-button .content').html(html);},playGame:function(wasGamePaused){var self=this;self.startLoading();$('#featured-youtuber').hide();setTimeout(function(){var html=$('#play-game-button .content').html();if(/connecting/i.test(html)){$.post(`${analyticsUrl}api/game-report/game-access/${gameId}/infinite-connecting`);}},10000);var gameId=ige.game.data.defaultData._id;if(gameId&&!wasGamePaused&&!window.isStandalone){if(window.innerWidth<1000){setTimeout(()=>{// $('#invite-players-card').addClass('d-none');
$('#show-chat').removeClass('d-none');$('#chat-box').addClass('d-none');},1500);}$.post(`${analyticsUrl}api/game-report/game-access/${gameId}/play-button`).then(function(){},function(xhr,status,error){$.post('/api/log',{event:'play-button',game:gameId,status:xhr.status,text:xhr.statusText});});}ige.client.joinGame();if(!window.isStandalone){ige.ad.showAnchorTag();}},kickPlayerFromGame:function(excludeEntity){var self=this;var players=ige.$$('player').filter(function(player){if(player&&player._stats&&player._stats.controlledBy==='human'&&player._alive&&player.id()!==excludeEntity)return true;});var html='<table class="table table-hover">';html+='<tr class="border-bottom">';html+='<th class="border-top-0">Name</th>';html+='<th class="border-top-0 text-center">Action</th>';html+='</tr>';players.forEach(function(player){html+='<tr class="border-bottom">';html+=`<td class="border-top-0">${player._stats.name}`;if(ige.client.myPlayer&&player.id()===ige.client.myPlayer.id()){html+=' (you)';}html+='</td>';html+='<td class="border-top-0 text-center">';html+='<div class="btn-group" role="group" aria-label="Basic example">';html+=`<button class="btn btn-danger kick-player-btn" data-clientid="${player._stats.clientId}" > Kick</button>`;// html += '<button class="btn btn-warning ban-player-btn" data-clientid="' + player._stats.clientId + '" data-gameId="' + ige.game.data.defaultData._id + '" data-userId="' + player._stats.userId + '">Ban user</button>'
html+=`<button class="btn btn-success ban-ip-btn" data-clientid="${player._stats.clientId}" data-gameId="${ige.game.data.defaultData._id}">Ban Ip</button>`;html+=`<button class="btn btn-primary ban-chat-btn" data-clientid="${player._stats.clientId}" data-gameId="${ige.game.data.defaultData._id}">${player._stats.banChat?'unmute':'mute'}</button>`;html+='</div>';html+='</td>';html+='</tr>';});html+='</table>';$('#kick-player-body').html(html);},showMenu:function(selectBestServer){var self=this;if(ige.isClient){var selectedServer=undefined;var gameSlug=window.location.pathname.split('/').pop();if(window.isStandalone){return $('#menu-wrapper').removeClass('d-none').addClass('d-flex');}if(!ige.mobileControls||!ige.mobileControls.isMobile){$('#friends-panel').removeClass('d-none');}this.changesForMobile(true);this.toggleScoreBoard(false);this.toggleLeaderBoard(false);this.toggleGameSuggestionCard(false);$.ajax({type:'GET',url:`/api/game-server/${gameId}`,success:function(res){if(res.status=='success'){var servers=res.message;var serversList='';var index=0;function separate(str){var alphabets='';var numbers='';var chars=str.split('');var numberRegex=/[0-9]/;// get number segment from end
while(chars.length){var char=chars[chars.length-1];if(numberRegex.test(char)){numbers=char+numbers;chars.pop();}else{break;}}return{alphabets:chars.join(''),numbers:numbers};}// generate server list
servers.forEach(function(server){var protocol=location.protocol.indexOf('https')>-1?'wss':'ws';var dataUrl=`${protocol}://${server.ip}${server.port?`:${server.port}`:''}`;if(server){var serverIP=server.ip.slice(0,server.ip.indexOf('.'));var separated=separate(serverIP);var optionText=`${separated.alphabets} ${separated.numbers}`;var acceptingPlayers=server.acceptingPlayers?'':' not accepting players';serversList+=`${'<option '+' class="game-server"'+' id="server-option-'}${index++}"`+` owner="${server.owner}"`+` player-count="${server.playerCount}"`+` max-players="${server.maxPlayers}"`+` data-server-id="${server.id}"`+` data-url="${dataUrl}"`+` value="${server.id}"`+`>${optionText} (${server.playerCount} / ${server.maxPlayers})${acceptingPlayers}</option>`;}// select best server in avail servers
if(selectBestServer&&!selectedServer&&server.acceptingPlayers){selectedServer=server;}});if(serversList){$('#server-list').html(serversList);// update servers array in case some new servers were added/removed to list
ige.client.servers=ige.client.getServersArray();if(selectBestServer&&selectedServer){ige.client.server=selectedServer.id;$('#server-list').val(selectedServer.id);$('#play-game-button').hide();$('#change-server').show();}else{$('#server-list').val(ige.client.server.id);}self.getServerPing();}else{$('#server-list').hide();}}$('#menu-wrapper').removeClass('d-none').addClass('d-flex');}});}},getServerPing:function(shouldPickOneWithLeast){var serverOptions=$('option.game-server:enabled');var promises=[];var self=this;// if (typeof user === 'undefined' || !user || !user.local || (user.local.username !== "nishant" && user.local.username !== "m0dE")) {
// 	return;
// }
// if (!serverOptions || serverOptions.length <= 1) {
// 	return;
// }
// var index = 0;
// for (var serverOption of serverOptions) {
// 	(function socketPing(serverOption, index) {
// 		var promise = self.getPing(serverOption);
// 		promises.push(promise);
// 	})(serverOption, index++);
// }
// if (shouldPickOneWithLeast) {
// 	Promise.all(promises)
// 		.then(function serversPingResolve(data) {
// 			var sortedData = data.sort(function (a, b) {
// 				return a.ping - b.ping;
// 			})
// 			var serverWithLeastPing = sortedData[0];
// 			$("#server-list").val(serverWithLeastPing.server.value);
// 		})
// 		.catch(function serversPingReject(err) {
// 			console.log(err);
// 		});
// }
},getPing:function(serverOption,duration){return new Promise(function promiseFunction(resolve,reject){var data=$(serverOption).data();var socket=new WebSocket(`${data.url}/?token=`);var ping=Number.MAX_VALUE;socket.onopen=function(event){socket.send(JSON.stringify({type:'ping',sentAt:Date.now()}));setTimeout(function(){if(socket.readyState!==WebSocket.CLOSED&&socket.readyState!==WebSocket.CLOSING){socket.close();var existingText=$(serverOption).text();$(serverOption).text(`${existingText} (${Number.POSITIVE_INFINITY} ms)`);resolve({server:serverOption,ping:ping});}},5000);};socket.onmessage=function(event){var jsonString=LZString.decompressFromUTF16(event.data);var json=JSON.parse(jsonString);if(json.type==='pong'){ping=Date.now()-json.clientSentAt;var existingText=$(serverOption).text();socket.close();console.log(json);$(serverOption).text(`${existingText} (${ping} ms)`);resolve({server:serverOption,ping:ping});}};socket.onerror=function(err){console.log('Error while testing ping',err);reject(err);};});},changesForMobile:function(isMenuVisible){if(ige.mobileControls&&ige.mobileControls.isMobile){var loginDiv=$('#login-div');var myScoreDiv=$('#my-score-div');var leaderBoard=$('#leaderboard');var topText=$('.ui-text-top');var topMenuButtons=$('#top-menu-buttons');var friendsPanel=$('#friends-panel');var mobileChatBox=$('#mobile-chat-box');var shopButton=$('#mobile-shop-button');var shopButton=$('#mobile-shop-button');var homeButton=$('#home-button');if(isMenuVisible){topMenuButtons.addClass('d-none');leaderBoard.addClass('d-none');topText.addClass('d-none');homeButton.removeClass('d-none');myScoreDiv.removeClass('d-block');loginDiv.removeClass('hide-on-mobile');friendsPanel.addClass('d-none');mobileChatBox.addClass('d-none');shopButton.removeClass('d-inline');homeButton.removeClass('d-none');}else{topMenuButtons.removeClass('d-none');leaderBoard.removeClass('d-none');topText.removeClass('d-none');homeButton.addClass('d-none');myScoreDiv.addClass('d-block');loginDiv.addClass('hide-on-mobile');mobileChatBox.removeClass('d-none invisible');shopButton.addClass('d-inline');}$('#modd-shop-modal').css({fontSize:11});// hide mobile controls
var allControls=ige.mobileControls.controls;if(allControls){for(var k in allControls){var control=allControls[k];control&&control.opacity&&control.opacity(isMenuVisible?0:0.5);}}// hide minimap here by setting width to 0
if(ige.miniMap&&ige.miniMap.miniMap){var newWidth=isMenuVisible?0:ige.miniMap.maxMapDimension.width;ige.miniMap.miniMap.width(newWidth);}}},hideMenu:function(){$('#menu-wrapper').removeClass('d-flex').addClass('d-none');if(!ige.mobileControls||!ige.mobileControls.isMobile){$('#friends-panel').addClass('d-none');}this.changesForMobile(false);this.toggleScoreBoard(true);this.toggleLeaderBoard(true);this.toggleGameSuggestionCard(true);},toggleMenu:function(){if($('#menu-wrapper').is(':visible')){this.hideMenu();}else{this.showMenu();}},clipImageForShop:function(){var skins=$('#menu-purchasables')[0]?$('#menu-purchasables')[0].children:[];for(var i=0;i<skins.length;i++){let data=skins[i];let image=new Image();let dataSets=data.dataset;dataSets.id=data.id;image.src=data.dataset.src;image.onload=function(){let replacingImage=data.children[0];if(replacingImage){let url=data.dataset.src;let itemDetails=ige.game.data.unitTypes[dataSets.key];let originalHeight=itemDetails&&`${image.height/itemDetails.cellSheet.rowCount}px`;let originalWidth=itemDetails&&`${image.width/itemDetails.cellSheet.columnCount}px`;// clipping = "height:" + originalHeight + "px;width:" + originalWidth + "px;background:url('" + item.image + "') 0px 0px no-repeat;";
replacingImage.style.height=originalHeight;replacingImage.style.width=originalWidth;replacingImage.style.backgroundImage=`url('${url}')`;replacingImage.style.maxHeight='64px';replacingImage.style.maxWidth='64px';if(itemDetails&&itemDetails.cellSheet.rowCount<=1&&itemDetails.cellSheet.columnCount<=1){replacingImage.style.backgroundRepeat='no-repeat';replacingImage.style.backgroundPosition='center center';replacingImage.style.backgroundSize='contain';}}};}},getUrlVars:function(){// edited for play/:gameId
var gameId=window.location.pathname.split('/')[2];var vars={gameId:gameId};// if serverId is present then add it to vars
window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value;});return vars;},onDisconnectFromServer:function(src,message){console.log('modal shown from',src,message);if(ige.mobileControls.isMobile)return;var defaultContent='Lost connection to the game server. Please refresh this page or visit our homepage.';ige.client.disconnected=true;$('#server-disconnect-modal .modal-body').html(message||defaultContent);$('#server-disconnect-modal').modal('show');// refreshIn("connection-lost-refresh", 5);
$('#more-games').removeClass('slidedown-menu-animation').addClass('slideup-menu-animation');},setResolution:function(){if(ige.mobileControls.isMobile)return;var resolution=localStorage.getItem('resolution')||'high';if(resolution=='high'){ige.client.resolutionQuality='high';ige._resizeEvent();ige.miniMap.updateMiniMap();$('#resolution-high').addClass('btn-success').removeClass('btn-light');$('#resolution-low').removeClass('btn-success').addClass('btn-light');}else{ige.client.resolutionQuality='low';ige._resizeEvent();ige.miniMap.updateMiniMap();$('#resolution-low').addClass('btn-success').removeClass('btn-light');$('#resolution-high').removeClass('btn-success').addClass('btn-light');}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=MenuUiComponent;};var RegionUi=$i_56.extend({classId:'RegionUi',init:function(region,regionName,entity){$i_57.prototype.init.call(this);var self=this;self._stats=region;self._stats.id=regionName;self.category('regionUi');if(mode==='play'&&(region.default.inside||region.default.outside)||mode==='sandbox'){var graphic=new PIXI.Graphics();// graphic.lineStyle(3, 0x000000, 0.7);
graphic.beginFill(0xFF0000,0.4);graphic.drawRect(0,0,50,50);graphic.endFill();graphic.isSprite=true;this._pixiContainer=graphic;this._pixiContainer.x=region.default.x;this._pixiContainer.y=region.default.y;this._pixiContainer.height=region.default.height;this._pixiContainer.width=region.default.width;this._pixiContainer.zIndex=10;this._pixiContainer._category='region';this._pixiContainer.name=regionName;this.mount(ige.pixi.world);ige.pixi.trackEntityById[entity._id]=entity;}},translateTo:function(x,y,z){this._pixiContainer.position.set(x,y);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=RegionUi;};var ThemeComponent=$i_56.extend({classId:'ThemeComponent',componentId:'theme',init:function(){var self=this;self.applyTheme(ige.client.server);},applyTheme:function(server){if(ige.game.data.settings.images&&ige.game.data.settings.images.logo){$('.game-title').html($('<img/>',{src:ige.game.data.settings.images.logo,height:'75px'}));}else{$('.game-title').html(server?server.gameName:"");}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ThemeComponent;};var PlayerUiComponent=$i_56.extend({classId:'PlayerUiComponent',componentId:'playerUi',init:function(entity,options){var self=this;self._entity=entity;self.setupListeners();self.pressedButton=false;self.lastInputValue='';self.dialogue={message:null,messagePrinter:null};},setupListeners:function(){// listeners for player input modal
var self=this;$('#player-input-modal').on('hidden.bs.modal',function(){if(self.pressedButton){ige.network.send('playerCustomInput',{status:'submitted',inputText:self.lastInputValue});self.lastInputValue='';}else{ige.network.send('playerCustomInput',{status:'dismissed'});}$('#player-input-modal').removeClass('d-flex');});$('#custom-modal').on('hidden.bs.modal',function(){$('#custom-modal').removeClass('d-flex');});$('#custom-modal').on('shown.bs.modal',function(){$('#custom-modal-cancel').focus();});$('#player-input-modal').on('shown.bs.modal',function(){if(self.isDismissibleInputModalShown){$('#player-input-cancel').focus();}else{$('#player-input-field').focus();}});$('button#player-input-submit').on('click',function(){self.lastInputValue=$('#player-input-field').val();self.pressedButton=true;$('#player-input-modal').modal('hide');});$('button#player-input-cancel').on('click',function(){self.pressedButton=false;ige.network.send('playerCustomInput',{status:'cancelled'});$('#player-input-modal').modal('hide');});},updatePlayerAttributesDiv:function(attributes){var self=this;$('#players-attribute-div').html('');var attributeTypes=ige.game.data.attributeTypes;if(attributeTypes==undefined)return;for(var attrKey in attributes){var attr=attributes[attrKey];if(attr){if(!attr.isVisible)continue;var attributeType=attributeTypes[attrKey];var name=attributeType?attributeType.name:attr.name;var attrName=$('<span/>',{class:`pt-attribute-${attrKey}`});var attrValue=$('<span/>',{class:`pt-attribute-value-${attrKey}`});$('#players-attribute-div').append(attrName).append(attrValue).append($('<br/>'));attrName.text(`${name}: `);// if attr value is int, then do not show decimal points. otherwise, show up to 2 decimal points
if(attr.value%1===0){attr.value=parseInt(attr.value);}else{if(attr.decimalPlaces!=undefined&&attr.decimalPlaces!=null){var decimalPlace=parseInt(attr.decimalPlaces);if(decimalPlace!=NaN){attr.value=parseFloat(attr.value).toFixed(decimalPlace);}else{attr.value=parseFloat(attr.value).toFixed(2);}}else{attr.value=parseFloat(attr.value).toFixed(2);}}var value=attr.value&&attr.value.toLocaleString('en-US')||0;attrValue.text(value);}}// update shop as player points are changed and when shop modal is open
if($('#modd-item-shop-modal').hasClass('show')){ige.shop.openItemShop();}},updatePlayerCoin:function(newValue){var coin=parseInt($('.player-coins').html());if(coin!=NaN){$('.player-coins').html(parseInt(newValue));}},showFriendsModal:function(config){$('#invite-friends-modal').modal('show');},// open a modal to ask for input
showInputModal:function(config){var self=this;config.isDismissible=config.isDismissible===undefined?true:!!config.isDismissible;self.isDismissibleInputModalShown=config.isDismissible;$('#player-input-field-label').html(config.fieldLabel||'Field');$('#player-input-field').val('');$('#player-input-modal').addClass('d-flex');$('#player-input-modal').modal({backdrop:config.isDismissible?true:'static',keyboard:config.isDismissible});if(config.isDismissible){$('#player-input-cancel-container').show();$('#player-input-modal-dismiss-button').show();}else{$('#player-input-cancel-container').hide();$('#player-input-modal-dismiss-button').hide();}$('#player-input-modal').modal('show');self.pressedButton=false;},// open a modal with custom content rendered in it
showCustomModal:function(config){var self=this;config.isDismissible=config.isDismissible===undefined?true:!!config.isDismissible;$('#custom-modal .content').html(config.content||'');if(config.title){$('#custom-modal .modal-title').html(config.title);$('#custom-modal .modal-header').show();}else{$('#custom-modal .modal-header').hide();}$('#custom-modal').addClass('d-flex');$('#custom-modal').modal({backdrop:config.isDismissible?true:'static',keyboard:config.isDismissible});if(config.isDismissible){$('#custom-modal-cancel-container').show();$('#custom-modal-dismiss-button').show();}else{$('#custom-modal-cancel-container').hide();$('#custom-modal-dismiss-button').hide();}$('#custom-modal').modal('show');self.pressedButton=false;},// open a modal with custom content rendered in it
openWebsite:function(config){var self=this;config.isDismissible=config.isDismissible===undefined?true:!!config.isDismissible;var newWin=window.open(config.url);if(!newWin||newWin.closed||typeof newWin.closed=='undefined'){swal({title:'Please allow Popups',text:'Your browser is blocking the content modd.io is trying to display',imageWidth:300,imageUrl:'/assets/images/enable-popup.gif',imageClass:'rounded border'});}},showWebsiteModal:function(config){var self=this;config.isDismissible=config.isDismissible===undefined?true:!!config.isDismissible;$('#website-modal').find('iframe').attr('src',config.url);$('#website-modal').modal({backdrop:config.isDismissible?true:'static',keyboard:config.isDismissible});},showSocialShareModal:function(config){var self=this;config.isDismissible=config.isDismissible===undefined?true:!!config.isDismissible;$('#social-share-modal').modal({backdrop:config.isDismissible?true:'static',keyboard:config.isDismissible});},openDialogueModal:function(dialogueId,extraData){var self=this;function getDialogueInstance(dialogue){var playerName=extraData&&extraData.playerName;dialogue=JSON.parse(JSON.stringify(dialogue));if(dialogue.message.indexOf('%PLAYER_NAME%')>-1&&playerName){dialogue.message=dialogue.message.replace(/%PLAYER_NAME%/g,playerName);}var variables=dialogue.message.match(new RegExp('\\$.+?\\$','g'));if(variables&&variables.length){variables.forEach(function(variable){// variable are in format $xxx$ so splitting it by $ will give ['', 'xxx', '']
var variableName=variable.split('$')[1];if(extraData.variables.hasOwnProperty(variableName)){var variableValue=extraData.variables[variableName];// replace all occurrences of variableName
dialogue.message=dialogue.message.replace(new RegExp(`\\$${variableName}\\$`,'g'),variableValue);}});}dialogue.messageFragments=dialogue.message.split('%br%');dialogue.currentFragmentIndex=0;dialogue.areAllMessagesPrinted=function(){return this.currentFragmentIndex>=this.messageFragments.length;};dialogue.getNextMessage=function(){return dialogue.messageFragments[dialogue.currentFragmentIndex++];};dialogue.hasOptions=function(){return Object.keys(dialogue.options).length>0;};dialogue.areOptionsRendered=false;return dialogue;}function initModal(){$('#modd-dialogue-message').html('');$('#modd-dialogue-image').attr('src','');$('#modd-dialogue-options-container').addClass('d-none');$('#modd-dialogue-skip-hint').addClass('d-none');if(self.dialogue.messagePrinter){clearInterval(self.dialogue.messagePrinter);}if(dialogue.image){$('#modd-dialogue-image-container').removeClass('d-none');$('#modd-dialogue-message-container').addClass('col-8');$('#modd-dialogue-message-container').addClass('pl-md-0');$('#modd-dialogue-message-container').removeClass('col-12');$('#modd-dialogue-image').attr('src',dialogue.image);}else{$('#modd-dialogue-image-container').addClass('d-none');$('#modd-dialogue-message-container').removeClass('col-8');$('#modd-dialogue-message-container').addClass('col-12');$('#modd-dialogue-image').attr('src','');}$(document).on('keydown.modd-dialogue',keyboardListener);$(document).on('click.modd-dialogue',skipText);}function printingCompleted(){window.isPrintingDialogue=false;if(dialogue.areAllMessagesPrinted()){if(dialogue.hasOptions()){if(!dialogue.areOptionsRendered){showOptions();}}else{$('#modd-dialogue-skip-hint').removeClass('d-none');}}else{$('#modd-dialogue-skip-hint').removeClass('d-none');}}function showOptions(){$('#modd-dialogue-options').html('');for(var key in dialogue.options){var optionObject=dialogue.options[key];var button=$('<button/>',{id:key,class:'btn btn-light border btn-block text-left dialogue-option-button',click:function(){var optionId=this.id;$('.dialogue-option-button').addClass('disabled');$(this).find('.fa-check').removeClass('d-none');ige.playerUi.submitDialogueModal(dialogueId,optionId);}});button.append($('<i/>',{class:'d-none fa fa-check mr-2'}));button.append($('<span/>',{text:optionObject.name}));$('#modd-dialogue-options').append(button);}$('#modd-dialogue-skip-hint').addClass('d-none');$('#modd-dialogue-options-container').removeClass('d-none');dialogue.areOptionsRendered=true;}function showNextMessage(){if(dialogue.areAllMessagesPrinted()){if(dialogue.hasOptions()){if(!dialogue.areOptionsRendered){showOptions();}}else{self.closeDialogueModal();}}else{self.dialogue.message=dialogue.getNextMessage();self.dialogue.message=self.dialogue.message.replace(/%nl%/g,'<br/>');window.isPrintingDialogue=true;$('#modd-dialogue-message').html('');$('#modd-dialogue-skip-hint').addClass('d-none');self.dialogue.messagePrinter=$('#modd-dialogue-message').length&&$('#modd-dialogue-message').writeText(self.dialogue.message,dialogue.letterPrintSpeed,printingCompleted);}}function skipText(){if(window.isPrintingDialogue){clearInterval(self.dialogue.messagePrinter);$('#modd-dialogue-message').html(self.dialogue.message);$('#modd-dialogue-skip-hint').removeClass('d-none');window.isPrintingDialogue=false;// if
// 1. user skips text in last fragment and
// 2. dialogue has options and
// 3. those options are still hidden
// then direct render the options dont ask user for one more action
if(dialogue.areAllMessagesPrinted()&&dialogue.hasOptions()&&!dialogue.areOptionsRendered){showOptions();}}else{showNextMessage();}}function keyboardListener(e){if(e.keyCode===13||e.keyCode===32){e.stopPropagation();skipText();}}var dialogue=ige.game.data.dialogues[dialogueId];if(dialogue){dialogue=getDialogueInstance(dialogue);initModal();showNextMessage();$('#modd-dialogue-modal').modal('show');}else{console.error('dialogue',dialogueId,'not found');}},closeDialogueModal:function(){$('#modd-dialogue-message').html('');$('#modd-dialogue-options-container').addClass('d-none');$('#modd-dialogue-image').attr('src','');$('#modd-dialogue-modal').modal('hide');this.clearListeners();},clearListeners:function(){console.log('clearing all keydown listeners on document');$(document).off('click.modd-dialogue keydown.modd-dialogue');},submitDialogueModal:function(dialogueId,optionId){var self=this;var willOpenNewDialogue=false;var dialogue=ige.game.data.dialogues[dialogueId];for(var key in dialogue.options){if(key===optionId){willOpenNewDialogue=!!dialogue.options[key].followUpDialogue;break;}}if(willOpenNewDialogue){this.clearListeners();}else{self.closeDialogueModal();}if(dialogueId&&optionId){ige.network.send('playerDialogueSubmit',{status:'submitted',dialogue:dialogueId,option:optionId});}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=PlayerUiComponent;};var GameTextComponent=$i_56.extend({classId:'GameTextComponent',componentId:'gameText',init:function(){var self=this;if(ige.isServer){self.latestText={};// stores last sent text, so newly joined users can see it
}},updateText:function(data,clientId){this.latestText[data.target]=data.value;if(ige.isServer){data.value=ige.sanitizer(data.value);ige.network.send('updateUiText',data,clientId);// update text for all clients
}},updateTextForTime:function(data,clientId){this.latestText[data.target]=data.value;if(ige.isServer){data.value=ige.sanitizer(data.value);ige.network.send('updateUiTextForTime',data,clientId);// update text for all clients
}},sendLatestText:function(clientId){if(ige.isServer){for(i in this.latestText){var data={target:i,value:this.latestText[i]};// ige.log("sendLatestText: " + JSON.stringify(data) + " to "+clientId)
data.value=ige.sanitizer(data.value);ige.network.send('updateUiText',data,clientId);}}},alertHighscore:function(clientId){if(ige.isServer){ige.network.send('alertHighscore',{},clientId);}}// showKillStreakMessage: function(playerName, killStreakCount) {
// 	var message = "";
// 	var fontSize = 30;
// 	$('#kill-streak-message').show();
// 	switch(killStreakCount)
// 	{
// 		case 2:
// 			message = playerName + "'s got a DOUBLE KILL";
// 			fontSize = 30;
// 			break;
// 		case 3:
// 			message = playerName + "'s got a TRIPLE KILL";
// 			fontSize = 35;
// 			break;
// 		case 4:
// 			message = playerName + " is a PLAGUE";
// 			fontSize = 40;
// 			break;
// 		case 5:
// 		default:
// 			message = playerName + " is the RAPTURE!!!";
// 			fontSize = 60;
// 			break;
// 	}
// 	$("#kill-streak-message").css({ fontSize: fontSize }).text(message).delay(5000).fadeOut("slow");;
// },
});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=GameTextComponent;};var ScoreboardComponent=$i_56.extend({classId:'ScoreboardComponent',componentId:'scoreboard',init:function(){var self=this;// self.scoreAttributeId = ige.game.data.settings.scoreBoard
// console.log("ige.game.data.settings", ige.game.data.settings)
self.scoreAttributeId=ige.game.data.settings.scoreAttributeId;self._hidden=false;self.setUI();},setUI:function(){if(ige.mobileControls.isMobile){$('#scoreboard-header').addClass('small');$('#scoreboard').addClass('small');}else{$('#scoreboard-header').addClass('h5');$('#scoreboard').addClass('h6');$('#leaderboard').addClass('h3').removeClass('d-none');}$(function(){$.contextMenu({selector:'.scoreboard-user-entry',build:function($trigger){var userData=$trigger.data();var myPlayer=ige.client.myPlayer;if(!myPlayer||!myPlayer._stats){return;}var userId=myPlayer._stats.userId;var mutedUsers=myPlayer._stats.mutedUsers;if(userId===userData.userId){// user cannot perform action on his/her own player
return;}ige.scoreboard.selectedUser=userData;var index=mutedUsers.indexOf(ige.scoreboard.selectedUser.userId);return{callback:function(key){switch(key){case'unmute':{mutedUsers.splice(index,1);$.ajax({url:`/api/user/toggle-mute/${ige.scoreboard.selectedUser.userId}`,type:'POST',success:function(data){console.log(data);// alert('request sent');
}});break;}case'mute':{mutedUsers.push(ige.scoreboard.selectedUser.userId);$.ajax({url:`/api/user/toggle-mute/${ige.scoreboard.selectedUser.userId}`,type:'POST',success:function(data){console.log(data);// alert('request sent');
}});break;}case'addFriend':{$.ajax({url:`/api/user/request/${ige.scoreboard.selectedUser.userId}`,type:'POST',success:function(data){alert('request sent');}});break;}}},items:{addFriend:{name:'Add Friend'},separator:{type:'cm_separator'},unmute:{name:`Unmute ${ige.scoreboard.selectedUser.userName}`,visible:index>-1},mute:{name:`Mute ${ige.scoreboard.selectedUser.userName}`,visible:index===-1,className:'context-menu-item context-menu-hover context-menu-danger'}}};}});});},convertNumbersToKMB:function(labelValue){if(ige.game.data.settings.prettifyingScoreboard){// Nine Zeroes for Billions
return Math.abs(Number(labelValue))>=1.0e+9?`${(Math.abs(Number(labelValue))/1.0e+9).toFixed(2)}B`// Six Zeroes for Millions
:Math.abs(Number(labelValue))>=1.0e+6?`${(Math.abs(Number(labelValue))/1.0e+6).toFixed(2)}M`// Three Zeroes for Thousands
:Math.abs(Number(labelValue))>=1.0e+3?`${(Math.abs(Number(labelValue))/1.0e+3).toFixed(2)}K`:Math.abs(Number(labelValue));}else{return labelValue;}},update:function(){var self=this;var DEFAULT_COLOR='white';if(ige.isClient){var scoreboard='';var sortedScores=[];var players=ige.$$('player');var topPlayersToShow=ige.mobileControls.isMobile?3:10;players.forEach(function(player){if(player._stats&&player._stats.clientId)// only display human players on scoreboard
{var clientId=player._stats.clientId;var score=0;if(self.scoreAttributeId&&player._stats.attributes&&player._stats.attributes[self.scoreAttributeId]){var playerAttribute=player._stats.attributes[self.scoreAttributeId];score=playerAttribute.value;var decimalPlace=parseInt(playerAttribute.decimalPlaces)||0;var score=parseFloat(playerAttribute.value).toFixed(decimalPlace);}sortedScores.push({key:clientId,value:score});}});sortedScores.sort(function(a,b){return a.value-b.value;});for(var i=sortedScores.length-1;i>=0;i--){var clientId=sortedScores[i].key;var player=ige.game.getPlayerByClientId(clientId);var defaultFontWeight=500;if(player){var color=null;// color to indicate human, animal, or my player on scoreboard
var playerType=ige.game.getAsset('playerTypes',player._stats.playerTypeId);if(playerType&&playerType.color){color=playerType.color;}if(player._stats.clientId==ige.network.id()){defaultFontWeight=800;color='#99FF00';}var readableName=player._stats.name||'';readableName=readableName.replace(/</g,'&lt;');readableName=readableName.replace(/>/g,'&gt;');color=color||DEFAULT_COLOR;scoreboard+=`<div data-user-name='${player._stats.name}' data-user-id='${player._stats.userId}' class='cursor-pointer scoreboard-user-entry' style='color: ${color};font-weight:${defaultFontWeight}'>${readableName} <small><span>${self.convertNumbersToKMB(sortedScores[i].value)}</span></small></div>`;}}ige.client.clientCount=sortedScores.length;$('#player-count').html(players.length);if(self._hidden){$('#scoreboard').html('');$('#leaderboard-toggle').html('&nbsp;<i class="far fa-caret-square-down" aria-hidden="true" onclick="ige.scoreboard.toggleScores()" style="cursor:pointer;"></i>');}else{$('#scoreboard').html(scoreboard);$('#leaderboard-toggle').html('&nbsp;<i class="far fa-caret-square-up" aria-hidden="true" onclick="ige.scoreboard.toggleScores()" style="cursor:pointer;"></i>');}}},hideScores:function(){this._hidden=true;},showScores:function(){this._hidden=false;},toggleScores:function(){this._hidden=!this._hidden;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ScoreboardComponent;};var ItemUiComponent=$i_56.extend({classId:'ItemUiComponent',componentId:'itemUi',init:function(){$('#backpack-items-div').on('mouseenter','.inventory-item-button.inventory-slot>.item-div.draggable-item',function(){$('.popover').popover('hide');$(this).popover('show');});$('#trade-div').on('mouseenter','.inventory-item-button.inventory-slot>.item-div.draggable-item',function(){$('.popover').popover('hide');$(this).popover('show');});$('#trade-div').on('mouseenter','.trade-offer-slot>.item-div.draggable-item',function(){$('.popover').popover('hide');$(this).popover('show');});$('#inventory-slots').on('mouseenter','.inventory-item-button.inventory-slot>.item-div.draggable-item',function(){$('.popover').popover('hide');$(this).popover('show');});$('canvas').on('mouseenter',function(){$('.popover').popover('hide');});jQuery.fn.swap=function(b){// method from: http://blog.pengoworks.com/index.cfm/2008/9/24/A-quick-and-dirty-swap-method-for-jQuery
b=jQuery(b)[0];var tempId=b.parentElement.id.replace('item-','');var a=this[0];b.id=`slotindex-${a.parentElement.id.replace('item-','').id}`;a.id=`slotindex-${tempId}`;var t=a.parentNode.insertBefore(document.createTextNode(''),a);b.parentNode.insertBefore(a,b);t.parentNode.insertBefore(b,t);t.parentNode.removeChild(t);return this;};},showReloadingText:function(){$('#reloading-message').show();},hideReloadingText:function(){$('#reloading-message').hide();},updateItemInfo:function(item){if(item&&item._stats){$('#item-name').html(item._stats.name);var ammoStr='';if(item._stats.ammo!=undefined)ammoStr=`${item._stats.ammo} / ${item._stats.ammoTotal}`;// $("#item-ammo").html(ammoStr)
}else{$('#item-name').html('');$('#item-ammo').html('');}},updateItemSlot:function(item,slotIndex){var self=this;var owner=item&&item.getOwnerUnit();var equipmentAllowed=owner&&owner._stats.equipmentAllowed;// update item info on bottom-right corner if it's currently selected item
$(`#item-${slotIndex}`).html(self.getItemDiv(item,{popover:'top',isDraggable:true,isPurchasable:false},slotIndex));// if (equipmentAllowed && slotIndex != undefined && slotIndex <= equipmentAllowed) {
$(`#item-key-stroke-${slotIndex}`).html(`<p class='m-0'><small style='font-weight:900;color: white;padding: 0px 5px;'>${slotIndex+1}</small></p>`);// }
},updateItemQuantity:function(item){var itemSlot=$(`#slotindex-${item._stats.slotIndex}`);quantitySpan=itemSlot.find('small');if(quantitySpan){var qty=item._stats.quantity;if(!isNaN(parseFloat(qty))){quantitySpan.text(parseFloat(qty));}}var owner=item.getOwnerUnit();if(owner&&parseFloat(item._stats.quantity)<=0&&item._stats.removeWhenEmpty==true){item.remove();var indexOfItem=owner._stats.itemIds.indexOf(item.id());if(indexOfItem>-1){owner._stats.itemIds.splice(indexOfItem,1);}owner.inventory.update();}},getItemSlotDiv:function(itemStats,options){var mobileClass=ige.mobileControls&&ige.mobileControls.isMobile?'inventory-slot-mobile ':'inventory-slot ';if(itemStats){var itemSlot=$('<div/>',{id:itemStats.id,class:`btn btn-secondary ${mobileClass}`}).append(this.getItemDiv(itemStats,options));if(options.isPurchasable){itemSlot.on('click',function(){// ige.shopkeeper.confirmPurchase($(this).attr("id"))
});}return itemSlot;}},getItemDiv:function(item,options,slotIndex){var self=this;if(item){var itemStats=item._stats;if(itemStats){var itemDetail=$('<div/>',{style:'font-size: 16px; width: 250px;',html:this.getItemHtml(itemStats)});var itemQuantity=item._stats.quantity!==undefined?item._stats.quantity:'';// || item._stats.maxQuantity === null
if(item._stats.quantity==1&&item._stats.maxQuantity==1||item._stats.quantity===null){itemQuantity='';}var img=itemStats.inventoryImage||(itemStats.cellSheet?itemStats.cellSheet.url:'');var mobileClass=ige.mobileControls&&ige.mobileControls.isMobile?'height:17px;max-width:20px;object-fit:contain':'height:30px;max-width:27px;object-fit:contain';var isTrading=options.isTrading;if(img){var itemDiv=$('<div/>',{id:`slotindex-${slotIndex}`,class:'item-div draggable-item',style:'height:100%',role:'button',html:`<div class='${!isTrading?'absolute-center':''}'><img src='${img}' style='${mobileClass}'/></div><small class='quantity'>${!isNaN(parseFloat(itemQuantity))&&parseFloat(itemQuantity)||itemQuantity}</small>`,'data-container':'body','data-toggle':'popover','data-placement':options.popover||'left','data-content':itemDetail.prop('outerHTML')}).popover({html:true,animation:false,trigger:'manual'});}}}else{var itemDiv=$('<div/>',{id:`slotindex-${slotIndex}`,class:'item-div draggable-item',style:'height:100%',role:'button'});}if(options.isDraggable&&itemDiv){itemDiv.draggable({revert:'invalid',cursor:'move',// helper: "clone",
zIndex:10000,containment:'window',appendTo:'body',start:function(event,ui){// when being dragged, disable popover. it doesn't need to be enabled later, because updateInventory overwrites popover div
$('.popover').popover('disable');}}).droppable({drop:function(event,ui){var draggable=ui.draggable;var droppable=$(this);var dragPos=draggable.position();var dropPos=droppable.position();var fromIndex=parseFloat(ui.draggable[0].parentElement.id.replace('item-',''));// var isTradingItemDragged = ui.draggable[0].parentElement.name.include('trade');
var toIndex=parseFloat(droppable[0].parentElement.id.replace('item-',''));// var isItemDroppedOnTradeSlot = droppable[0].parentElement.name.include('trade');
draggable.css({// left: dropPos.left + 'px',
// top: dropPos.top + 'px'
left:0,top:0});droppable.css({// left: dragPos.left + 'px',
// top: dragPos.top + 'px'
left:0,top:0});var selectedUnit=ige.client.myPlayer.getSelectedUnit();var items=selectedUnit._stats.itemIds;var fromItem=ige.$(items[fromIndex]);var toItem=ige.$(items[toIndex]);if(fromItem){fromItem.stopUsing();}if(toItem){toItem.stopUsing();}ige.network.send('swapInventory',{from:fromIndex,to:toIndex});var tempItem=items[fromIndex];items[fromIndex]=items[toIndex];items[toIndex]=tempItem;var totalInventorySlot=selectedUnit._stats.inventorySize;if(ige.client.myPlayer.isTrading&&(fromIndex>=totalInventorySlot||toIndex>=totalInventorySlot)){ige.tradeUi.sendOfferingItems();}}});}return itemDiv;return $('<div/>',{style:'font-size: 16px; width: 250px;',html:''});},getItemHtml:function(itemStats){var self=this;// var buffs = self.getBuffList(itemStats);
var itemTitle=$('<h4/>',{html:itemStats.name});var itemDiv=$('<div/>',{class:'caption '});// console.log(itemStats)
var itemHtml=self.getItemPopOverContent(itemStats);// for (attr in itemStats)
// {
// 	var itemValue = itemStats[attr];
// 	itemHtml.append($("<p/>", {
// 		html: self.getAttrStr(attr, itemValue)
// 	}))
// }
itemDiv// .append(
// 	$("<span/>", {
// 		class: 'pull-right ' + buffs.css,
// 		text: buffs.name
// 	})
// )
.append(itemTitle).append($('<hr/>')).append(itemHtml).append($('<hr/>'));// .append($("<h6/>", {html: "Buffs"}))
// .append(buffs.html)
return itemDiv;},updateItemDescription:function(item){var inventorySlotIfPresent=item._stats.slotIndex;if(item&&item._stats&&(inventorySlotIfPresent===0||inventorySlotIfPresent)){var popoverContent=$('<div/>',{style:'font-size: 16px; width: 250px;',html:this.getItemHtml(item._stats)});$(`#slotindex-${inventorySlotIfPresent}`).attr('data-content',popoverContent[0].outerHTML);}},getItemPopOverContent:function(stats){var info='<div>';if(stats.description){info+=`<p class="mb-1"><b>Description: </b><span class="item-description">${stats.description} </span></p>`;}if(stats&&stats.bonus){if(stats.bonus.consume&&Object.keys(stats.bonus.consume).length>0){var consumeBonus='';for(var i in stats.bonus.consume.playerAttribute){var attrName=ige.game.data.attributeTypes[i]?ige.game.data.attributeTypes[i].name:i;consumeBonus+=`<p class="mb-2 ml-2">${attrName}: ${stats.bonus.consume.playerAttribute[i]}</p>`;}for(var i in stats.bonus.consume.unitAttribute){var attrName=ige.game.data.attributeTypes[i]?ige.game.data.attributeTypes[i].name:i;consumeBonus+=`<p class="mb-2 ml-2">${attrName}: ${stats.bonus.consume.unitAttribute[i]}</p>`;}if(consumeBonus){info+='<p class="mb-1"><b>Consume bonuses: </b></p>';info+=consumeBonus;}}if(stats.bonus.passive&&Object.keys(stats.bonus.passive).length>0){var passiveBonus='';for(var i in stats.bonus.passive.playerAttribute){var attrName=ige.game.data.attributeTypes[i]?ige.game.data.attributeTypes[i].name:i;var value=stats.bonus.passive.playerAttribute[i]&&stats.bonus.passive.playerAttribute[i].value||0;var type=stats.bonus.passive.playerAttribute[i]&&stats.bonus.passive.playerAttribute[i].type||'';if(type=='percentage'){type='%';}else{type='';}passiveBonus+=`<p class="mb-2 ml-2">${attrName}: ${value}${type}</p>`;}for(var i in stats.bonus.passive.unitAttribute){var attrName=ige.game.data.attributeTypes[i]?ige.game.data.attributeTypes[i].name:i;var value=stats.bonus.passive.unitAttribute[i]&&stats.bonus.passive.unitAttribute[i].value||0;var type=stats.bonus.passive.unitAttribute[i]&&stats.bonus.passive.unitAttribute[i].type||'';if(type=='percentage'){type='%';}else{type='';}passiveBonus+=`<p class="mb-2 ml-2">${attrName}: ${value}${type}</p>`;}if(passiveBonus){info+='<p class="mb-1"><b>Passive bonuses: </b></p>';info+=passiveBonus;}}}for(var atributeId in stats.attributes){var attribute=stats.attributes[atributeId];if(attribute&&attribute.isVisible&&attribute.isVisible.includes('itemDescription')){info+='<p class="mb-1">';var value=null;if(attribute.dataType==='time'){value=ige.game.secondsToHms(attribute.value);}else{var decimalPlace=parseInt(attribute.decimalPlaces)||0;value=parseFloat(attribute.value).toFixed(decimalPlace);}info+=`<b>${attribute.name}: </b>${value||0}`;info+='</p>';}}if(stats&&stats.cost){var costHtml='';for(var key in stats.cost.unitAttributes){var attrName=ige.game.data.attributeTypes[key]?ige.game.data.attributeTypes[key].name:key;costHtml+=`<span>${attrName}: ${stats.cost.unitAttributes[key]}</span>,`;}for(var key in stats.cost.playerAttributes){var attrName=ige.game.data.attributeTypes[key]?ige.game.data.attributeTypes[key].name:key;costHtml+=`<span>${attrName}: ${stats.cost.playerAttributes[key]}</span>,`;}if(costHtml){info+='<p class="mb-1"><b>Cost: </b>';info+=costHtml;info+='</p>';}}// if (stats.type === 'weapon')
// {
// 	info += '<p><b>Damage: </b>' + stats.damage + '</p>';
// }
info+='</div>';return info;},getAttrStr:function(attrName,itemValue){if(itemValue!=0&&itemValue!=undefined){var attrStr;switch(attrName){// case 'isGun': attrStr = "<strong>Weapon type:</strong> "+((value == true)? "Range":"Melee"); break;
case'price':if(typeof itemValue!=='object'||itemValue==={}){attrStr='<strong>Price:</strong> free';}else{attrStr='';for(var attrKey in itemValue){attrStr+=`<strong>Price:</strong> ${itemValue[attrKey]}`;}}break;case'ammoSize':attrStr=`<strong>Magazine size:</strong> ${itemValue}`;break;case'ammoTotal':attrStr=`<strong>Ammo total:</strong> ${itemValue}`;break;case'fireRate':attrStr=`<strong>Fire rate:</strong> ${parseFloat(1000/itemValue).toFixed(2)} round/s`;break;case'reloadRate':attrStr=`<strong>Reload time:</strong> ${parseFloat(itemValue/1000).toFixed(2)} s`;break;case'bulletForce':attrStr=`<strong>Knock-back Force:</strong> ${parseFloat(itemValue).toFixed(0)}`;break;case'bulletDistance':attrStr=`<strong>Range:</strong> ${parseFloat(itemValue).toFixed(0)}`;break;case'recoilForce':attrStr=`<strong>Recoil:</strong> ${parseFloat(itemValue).toFixed(0)}`;break;case'movementSpeed':attrStr=`<strong>Speed bonus:</strong> ${parseFloat(itemValue.toFixed(1))}`;break;case'immunity':attrStr=`<strong>Immunity bonus:</strong> ${parseFloat(itemValue*100).toFixed(0)}%`;break;case'maxStamina':attrStr=`<strong>Stamina bonus:</strong> ${parseFloat(itemValue.toFixed(0))}`;break;case'stunChance':attrStr=`<strong>Slow target chance:</strong> ${parseFloat(itemValue*100).toFixed(0)}%`;break;case'slowChance':attrStr=`<strong>Stun target chance:</strong> ${parseFloat(itemValue*100).toFixed(0)}%`;break;}return attrStr;}},// get buff list
getBuffList:function(itemStats){// console.log("getBuffList", itemStats)
var buffCount=0;var buffListHtml=$('<ul/>',{class:'list-group'});if(itemStats&&itemStats.buffTypes){for(var i=0;i<itemStats.buffTypes.length;i++){var buffTypeName=itemStats.buffTypes[i];var itemValue=itemStats[buffTypeName];var itemType=ige.game.getAsset('itemTypes',itemStats.itemTypeId);var defaultValue=0;if(itemType){var defaultValue=itemType[buffTypeName]||0;}var buffType=ige.game.getAsset('buffTypes',buffTypeName);if(buffType){var isPercentageBased=buffType.unit=='percentage';}if(itemValue!=defaultValue&&itemValue!=0&&itemValue!=undefined&&defaultValue!=undefined){switch(buffTypeName){case'height':buffTypeName='<strong>Height bonus:</strong> ';break;case'ammoSize':buffTypeName='<strong>Magazine size:</strong> ';break;case'ammoTotal':buffTypeName='<strong>Ammo total:</strong> ';break;case'fireRate':buffTypeName='<strong>Fire rate:</strong> ';break;case'reloadRate':buffTypeName='<strong>Reload time:</strong> ';break;case'bulletForce':buffTypeName='<strong>Knock-back force:</strong> ';break;case'bulletDistance':buffTypeName='<strong>Range:</strong> ';break;case'recoilForce':buffTypeName='<strong>Recoil:</strong> ';break;case'movementSpeed':buffTypeName='<strong>Speed bonus:</strong> ';break;case'immunity':buffTypeName='<strong>Immunity bonus:</strong> ';break;case'maxStamina':buffTypeName='<strong>Stamina bonus:</strong> ';break;case'stunChance':buffTypeName='<strong>Slow target chance:</strong> ';break;case'slowChance':buffTypeName='<strong>Stun target chance:</strong> ';break;}if(isPercentageBased){if(defaultValue==0){var itemValueHtml=`${(itemValue*100).toFixed(0)}%`;}else{var itemValueHtml=`${((itemValue-defaultValue)/defaultValue*100).toFixed(0)}%`;}}else{var itemValueHtml=(itemValue-defaultValue).toFixed(1);}buffListHtml.append($('<li/>',{class:'list-group-item',html:`${buffTypeName} <span class='badge badge-default' style='margin-left:4px'>${itemValueHtml}</span>`}));// console.log("itemStats",itemStats)
buffCount++;}}}var data={name:'Normal',css:'badge badge-pill badge-default'};if(buffCount>4){data={name:'Legendary',css:'badge badge-pill badge-danger'};}else if(buffCount>2){data={name:'Rare',css:'badge badge-pill badge-warning'};}else if(buffCount>0){data={name:'Special',css:'badge badge-pill badge-primary'};}// data.html = buffListHtml
return'';}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ItemUiComponent;};var AdComponent=$i_56.extend({classId:'AdComponent',componentId:'ad',init:function(){var self=this;if(ige.isClient&&$('#user-permission-tracker').length){$('body').append($('<div/>',{id:'preroll',style:'z-index:40000; display: none',class:'absolute-center'}));}this.lastPlayedAd=null;},play:function(data,clientId){if(ige.isServer){ige.network.send('playAd',data,clientId);// update text for all clients
}else if(ige.isClient){// are we running on mobile
if(ige.mobileControls.isMobile){// on mobile
var eventData={msg:'showad'};if(window.msgQueue){// running inside modd cordova wrapper
window.msgQueue.push(eventData);}else{// on mobile web AIP ads not working well
console.log('adplay req mobile web');}sendMessageToReactNative(eventData);}else{// on desktop
if(isInIFrame){ID.gameBreak(function(){// Ad skipped or finished
});return;}$('#disable-ads-be-our-patron').show();if(typeof aipPlayer!='undefined'){adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:540,AD_FULLSCREEN:false,AD_CENTERPLAYER:false,LOADING_TEXT:'loading advertisement',PREROLL_ELEM:document.getElementById('preroll'),AIP_COMPLETE:function(){// this.prerollComplete();
$('#preroll').hide();$('#disable-ads-be-our-patron').hide();},AIP_REMOVE:function(){}});adplayer.startPreRoll();/* show the preroll */$('#preroll').show();}else{setTimeout(()=>{$('#disable-ads-be-our-patron').hide();},7000);}}}},showRewardAd:function(){if(window.cpmStarRAd){if(window.cpmStarRAd.isLoaded()){window.cpmStarRAd.show();}else{window.cpmStarRAd.load();}}else{console.log('window.cpmStarRAd is not defined',window.cpmStarRAd);}},showAnchorTag:function(){if(noAds){}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=AdComponent;};var DevConsoleComponent=$i_56.extend({classId:'DevConsole',componentId:'ad',init:function(){var devDiv=$('#dev-console-table');// graphs div accordion handle
devDiv.append('<div class="col-sm-12 my-2"><div id="graphs-div-accordion" class="px-2 py-1">Graphs</div></div>');var graphsDiv=$('<div id="graphs-div"></div>');if(mode!='sandbox'){var canvasDiv=$('<div class="col-sm-12 mb-2"></div>');canvasDiv.append('<h6>Canvas:</h6>');statsPanels.fps=new Stats();statsPanels.fps.showPanel(0);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.fps.domElement.style.cssText='position:relative;display:inline-block;';canvasDiv.append(statsPanels.fps.dom);statsPanels.ms=new Stats();statsPanels.ms.showPanel(1);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.ms.domElement.style.cssText='position:relative;display:inline-block;';canvasDiv.append(statsPanels.ms.dom);graphsDiv.append(canvasDiv);var engineDiv=$('<div class="col-sm-12 mb-2"></div>');engineDiv.append('<h6>Engine:</h6>');statsPanels.igefps=new Stats();statsPanels.igefps.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.igefps.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.igefps._igefpsPanel=statsPanels.igefps.addPanel(new Stats.Panel('fps','#ff8','#221'));engineDiv.append(statsPanels.igefps.dom);statsPanels.igedpf=new Stats();statsPanels.igedpf.showPanel(3);// 0: dpf, 1: ms, 2: mb, 3+: custom
statsPanels.igedpf.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.igedpf._igedpfPanel=statsPanels.igedpf.addPanel(new Stats.Panel('dpf','#ff8','#221'));engineDiv.append(statsPanels.igedpf.dom);igeConfig.debug._timing=true;statsPanels.igeut=new Stats();statsPanels.igeut.showPanel(3);// 0: ut, 1: ms, 2: mb, 3+: custom
statsPanels.igeut.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.igeut._igeutPanel=statsPanels.igeut.addPanel(new Stats.Panel('ut','#ff8','#221'));engineDiv.append(statsPanels.igeut.dom);statsPanels.igert=new Stats();statsPanels.igert.showPanel(3);// 0: rt, 1: ms, 2: mb, 3+: custom
statsPanels.igert.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.igert._igertPanel=statsPanels.igert.addPanel(new Stats.Panel('rt','#ff8','#221'));engineDiv.append(statsPanels.igert.dom);statsPanels.igett=new Stats();statsPanels.igett.showPanel(3);// 0: tt, 1: ms, 2: mb, 3+: custom
statsPanels.igett.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.igett._igettPanel=statsPanels.igett.addPanel(new Stats.Panel('tt','#ff8','#221'));engineDiv.append(statsPanels.igett.dom);// GS Div
var GSDiv=$('<div class="col-sm-12 mb-2"></div>');GSDiv.append('<h6>GS:</h6>');statsPanels.serverCpuUser=new Stats();statsPanels.serverCpuUser.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.serverCpuUser.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.serverCpuUser._serverCpuUserPanel=statsPanels.serverCpuUser.addPanel(new Stats.Panel('CpuUser','#ff8','#221'));GSDiv.append(statsPanels.serverCpuUser.dom);statsPanels.serverCpuSystem=new Stats();statsPanels.serverCpuSystem.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.serverCpuSystem.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.serverCpuSystem._serverCpuSystemPanel=statsPanels.serverCpuSystem.addPanel(new Stats.Panel('CpuSys','#ff8','#221'));GSDiv.append(statsPanels.serverCpuSystem.dom);graphsDiv.append(GSDiv);// Connection div
var connectionDiv=$('<div class="col-sm-12 mb-2"></div>');connectionDiv.append('<h6>Connection:</h6>');statsPanels.received=new Stats();statsPanels.received.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.received.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.received._receivedPanel=statsPanels.received.addPanel(new Stats.Panel('B/s↓','#ff8','#221'));connectionDiv.append(statsPanels.received.dom);statsPanels.sent=new Stats();statsPanels.sent.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.sent.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.sent._sentPanel=statsPanels.sent.addPanel(new Stats.Panel('B/s↑','#f8f','#212'));connectionDiv.append(statsPanels.sent.dom);statsPanels.bandwidth=new Stats();statsPanels.bandwidth.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.bandwidth.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.bandwidth._bandwidthPanel=statsPanels.bandwidth.addPanel(new Stats.Panel('kB','#f88','#221'));connectionDiv.append(statsPanels.bandwidth.dom);statsPanels.latency=new Stats();statsPanels.latency.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.latency.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.latency._latencyPanel=statsPanels.latency.addPanel(new Stats.Panel('L(ms)','#88f','#221'));connectionDiv.append(statsPanels.latency.dom);statsPanels.clock=new Stats();statsPanels.clock.showPanel(3);// 0: fps, 1: ms, 2: mb, 3+: custom
statsPanels.clock.domElement.style.cssText='position:relative;display:inline-block;';statsPanels.clock._clockPanel=statsPanels.clock.addPanel(new Stats.Panel('s','#eee','#221'));statsPanels.clock._started=new Date();connectionDiv.append(statsPanels.clock.dom);setInterval(function(){var now=new Date();var elapsed=(now-statsPanels.clock._started)*0.001;statsPanels.clock._clockPanel.update(elapsed,120);statsPanels.igefps._igefpsPanel.update(ige._renderFPS,60);statsPanels.igedpf._igedpfPanel.update(ige._dpf,1000);statsPanels.igeut._igeutPanel.update(ige._updateTime,100);statsPanels.igert._igertPanel.update(ige._renderTime,100);statsPanels.igett._igettPanel.update(ige._tickTime,100);ige.physicsTickCount=0;ige.unitBehaviourCount=0;},1000);graphsDiv.append(connectionDiv);devDiv.append(graphsDiv);// tuning div accordion handle
devDiv.append('<div class="col-sm-12 my-2"><div id="tuning-div-accordion" class="px-2 py-1">Tuning</div></div>');// Tuning Div
var tuningDiv=$('<div id="tuning-div" class="col-sm-12 mb-4"></div>');ige.client.renderLatencyMs=ige.game.data.settings.renderlatency||50;ige.client.inputDelay=0;// ige.client.streamSendInterval = 15;
var gui=new dat.GUI({autoPlace:false,width:400});// var controllerLatency = gui.add(ige.client, 'streamSendInterval', 15, 1000);
// controllerLatency.onChange(function (value) {
//     // Fires on every change, drag, keypress, etc.
//     value = parseInt(value);
//     //console.log(value, ' ms');
//     ige.network.send("setStreamSendInterval", { "interval": value });
// });
ige.client.controllerRenderLatency=gui.add(ige.client,'renderLatencyMs',0,1000);ige.client.controllerRenderLatency.onChange(function(value){// Fires on every change, drag, keypress, etc.
value=parseInt(value);// console.log(value, ' ms');
ige.network.stream.renderLatency(value);ige.client.renderLatencyMs=value;});var controllerExtrapolation=gui.add(ige.client,'extrapolation');var controllerResolution=gui.add(ige.client,'resolution',{Auto:0,'320x240':320,'640x480':640,'800x600':800,'1024x768':1024,'1280x720':1280,'1920x1080':1920});controllerResolution.onChange(function(value){if(value==0){ige._autoSize=true;}else{ige._autoSize=false;}if(value>0){$('#igeFrontBuffer').attr('width',value);var height=value/4*3;if(value==1280||value==1920)height=value/16*9;$('#igeFrontBuffer').attr('height',height);}ige._resizeEvent();});var controllerScaleMode=gui.add(ige.client,'scaleMode',{None:0,Fit:1,Stretch:3});controllerScaleMode.onChange(function(value){ige._resizeEvent();});var controllerClientSideInputDelay=gui.add(ige.client,'inputDelay',0,1000);controllerClientSideInputDelay.onChange(function(value){});var f1=gui.addFolder('Render control');var controllerMapRenderEnabled=f1.add(ige.client,'mapRenderEnabled');controllerMapRenderEnabled.onChange(function(value){// console.log('mapRenderEnabled:',value);
});var controllerUnitRenderEnabled=f1.add(ige.client,'unitRenderEnabled');controllerUnitRenderEnabled.onChange(function(value){// console.log('unitRenderEnabled:',value);
});var controllerItemRenderEnabled=f1.add(ige.client,'itemRenderEnabled');controllerItemRenderEnabled.onChange(function(value){// console.log('itemRenderEnabled:',value);
});var controllerUiEntityRenderEnabled=f1.add(ige.client,'uiEntityRenderEnabled');var controllerMiniMapEnabled=f1.add(ige.client,'miniMapEnabled');controllerMiniMapEnabled.onChange(function(value){// console.log('miniMapEnabled:',value);
});var controllerClearEveryFrame=f1.add(ige.client,'clearEveryFrame');var controllerViewportClippingEnabled=f1.add(ige.client,'viewportClippingEnabled');var controllerCtxAlphaEnabled=f1.add(ige.client,'ctxAlphaEnabled');controllerCtxAlphaEnabled.onChange(function(value){// console.log('ctxAlphaEnabled:',value);
ige.getCtx();});tuningDiv.append(gui.domElement);devDiv.append(tuningDiv);devDiv.append('<div class="col-sm-12 my-2"><div id="variables-div-accordion" class="px-2 py-1">Variables</div></div>');devDiv.append('<div id="variables-div"></div>');}$('#graphs-div-accordion').click(function(){$('#graphs-div').slideToggle('slow');});$('#tuning-div-accordion').click(function(){$('#tuning-div').slideToggle('slow');});$('#variables-div-accordion').click(function(){$('#variables-div').slideToggle('slow');});}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=DevConsoleComponent;};var MapEditorComponent=$i_56.extend({classId:'MapEditorComponent',componentId:'mapEditor',init:function(){// map editor global variables
var self=this;lastCurSelectedTileIndex=1;curSelectedTileIndex=0;showAllLayers=false;curLayerPainting='floor';addNewRegion=false;mouseIsDown=false;this.mouseDownOnMiniMap=false;addRegionCordinates={};rightMouseKey=3;this.lastXPosition=0;this.lastYPosition=0;this.counter=0;this.isAddEntitiesEnabled=false;this.isMapChangeAndNotSaved=false;self.selectEntities=true;this.entity={height:100,width:100,type:'unitTypes',entity:'',rotation:0,x:0,y:0};this.undo=[];this.redo=[];// scale percentage in proportion to the world
var miniMapScale=0.05;$(document).on('click',function(e){var sandboxKeys=['map-settings',',map-save'];if(sandboxKeys.includes(e.target.id)){self.removeSelectedClass();e.preventDefault();}});$(document).on('keydown',function(e){var isModalOpened=$('.modal').hasClass('show');var isAnyInputFocused=$('input').is(':focus');// only change shortcuts when map tab is selected and no modal is in open state
if($('#mapEditor').hasClass('active')&&!isModalOpened&&!isAnyInputFocused){var enterChar=String.fromCharCode(e.keyCode).toString();enterChar=enterChar.toLowerCase();self.mapShortcuts(e,enterChar);}});$('#entity-delete').on('click',function(e){e.preventDefault();var index=$('[name=entity-index').val();self.upsertMapEntities({},parseInt(index),'delete');});$('#entities-form').on('submit',function(e){e.preventDefault();var formValue=$(this).serializeArray();var entity={};formValue.forEach(function(input){var name=input.name.replace('entity-','');entity[name]=input.value;});if(entity.isEdit==='true'){self.upsertMapEntities(entity,parseInt(entity.index));}else{self.entity=entity;}$('#entities-modal').modal('hide');});this.listeners={eraser:function(e,entity){entity=entity||this;addNewRegion=false;self.isAddEntitiesEnabled=false;self.selectEntities=false;if(curSelectedTileIndex!=0){lastCurSelectedTileIndex=curSelectedTileIndex;}curSelectedTileIndex=0;self.addSelectedClass(entity,true);self.removeSelectedClass('eraser');},brush:function(e,entity){entity=entity||this;addNewRegion=false;self.isAddEntitiesEnabled=false;self.selectEntities=false;curSelectedTileIndex=lastCurSelectedTileIndex;self.addSelectedClass(entity,true);self.removeSelectedClass('brush');},'clear-layer':function(e,entity){entity=entity||this;addNewRegion=false;self.isAddEntitiesEnabled=false;self.selectEntities=false;var promise=swal({text:'Are you sure you want to clear current selected layer?',type:'warning',showCancelButton:true,confirmButtonText:'Yes'});promise.then(result=>{if(result.value){var lIndex=undefined;var currentLayer=ige.game.data.map.layers.find(function(layer,key){lIndex=key;return layer.name==curLayerPainting;});for(let i=0;i<ige.map.data.layers[lIndex].data.length;i++){ige.map.data.layers[lIndex].data[i]=0;}ige.layersById[curLayerPainting].clearMap();ige.layersById[curLayerPainting].cacheForceFrame();if(autoSave){ige.mapEditor.isMapChangeAndNotSaved=true;}else{window.updateSandboxMapLayers(lIndex,ige.map.data.layers[lIndex].data);}}});},mapsave:function(e,entity){entity=entity||this;ige.isMapUpdated=false;self.isAddEntitiesEnabled=false;self.selectEntities=false;ige.mapEditor.isMapChangeAndNotSaved=false;var map=_.cloneDeep(ige.map.data);map.tilewidth=ige.scaleMapDetails.originalTileWidth;map.tileheight=ige.scaleMapDetails.originalTileHeight;window.saveMap(map);},add_region:function(e,entity){entity=entity||this;addNewRegion=!addNewRegion;self.isAddEntitiesEnabled=false;self.selectEntities=false;self.addSelectedClass(entity);self.removeSelectedClass('add_region');},fill:function(e,entity){entity=entity||this;addNewRegion=false;self.isAddEntitiesEnabled=false;self.selectEntities=false;curSelectedTileIndex=lastCurSelectedTileIndex;if(!curSelectedTileIndex){curSelectedTileIndex=1;}self.addSelectedClass(entity,true);self.removeSelectedClass('fill');},add_entities:function(e,entity){entity=entity||this;self.isAddEntitiesEnabled=true;addNewRegion=false;self.selectEntities=false;self.addSelectedClass(entity,true);self.removeSelectedClass('add_entities');self.openEntitiesModal(self.entity);},select_entity:function(e,entity){entity=entity||this;self.selectEntities=true;addNewRegion=false;self.isAddEntitiesEnabled=false;self.addSelectedClass(entity,true);self.removeSelectedClass('select_entity');}};window.addEventListener('beforeunload',function(event){if(autoSave&&ige.mapEditor.isMapChangeAndNotSaved){event.returnValue='You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?';return true;}});},undoMap(e){var mapData=this.undo.pop();if(!mapData)return;ige.mapEditor.redo.push(JSON.parse(JSON.stringify(ige.map.data)));mapData=JSON.parse(JSON.stringify(mapData));ige.map.data=JSON.parse(JSON.stringify(mapData));this.applyDataToMap(ige.map.data);if(autoSave){ige.mapEditor.isMapChangeAndNotSaved=true;}else{window.updateSandboxMapLayers(lIndex,ige.map.data.layers[lIndex].data);}},redoMap(){var mapData=ige.mapEditor.redo.pop();if(!mapData)return;ige.mapEditor.undo.push(JSON.parse(JSON.stringify(ige.map.data)));mapData=JSON.parse(JSON.stringify(mapData));ige.map.data=JSON.parse(JSON.stringify(mapData));this.applyDataToMap(ige.map.data);if(autoSave){ige.mapEditor.isMapChangeAndNotSaved=true;}else{window.updateSandboxMapLayers(lIndex,ige.map.data.layers[lIndex].data);}},applyDataToMap(mapData){var mapHeight=mapData.height;var mapWidth=mapData.width;var z;for(var layer in ige.layersById){var layerIndex=this.getLayerIndexFromName(layer);layerData=mapData.layers[layerIndex];layerData=layerData.data;if(ige.layersById[layer].type==='tilelayer'){for(y=0;y<mapHeight;y++){for(x=0;x<mapWidth;x++){z=x+y*mapWidth;if(layerData[z]>0&&layerData[z]!==2147483712){if(ige.isClient){// Paint the tile
currentTexture=layerData[z];if(currentTexture){ige.layersById[layer].paintTile(x,y,this.getTilesheetData().tindex,currentTexture);var tileIndex=x+y*ige.map.data.width;ige.map.data.layers[layerIndex].data[tileIndex]=currentTexture;}}}}}ige.layersById[layer].cacheForceFrame();}}},drawTile(){// main canvas tile
ige.mapEditor.tileMap=new $i_63().id('Tile_Map').tileWidth(ige.scaleMapDetails.originalTileWidth).tileHeight(ige.scaleMapDetails.originalTileHeight).gridSize(ige.game.data.map.width,ige.game.data.map.height).hoverColor('#6000ff70'||'#6000ff').layer(5).depth(5).drawGrid(1).drawBounds(false).mount(ige.client.objectScene);this.generateTilesheet();},generateTilesheet:function(){ige.mapEditor.tilesheet=new $i_63().id('Tilesheet_Map').layer(10).drawGrid(true).drawMouse(true).hoverColor('#6000ff70'||'#6000ff').highlightOccupied(true).drawMouse(true).mouseUp(function(){if(ige.game.data.isDeveloper){var tilePosition=ige.mapEditor.tilesheet.pointToTile(ige.client.vp2.mousePos());var gridX=ige.mapEditor.tilesheet._gridSize.x;tileIndex=tilePosition.x+tilePosition.y*gridX+1;curSelectedTileIndex=tileIndex;lastCurSelectedTileIndex=curSelectedTileIndex;}}).mount(ige.client.tilesheetScene);var callbackForTexture=function(){// console.log(ige.client.tilesheetTexture._sizeX, ige.client.tilesheetTexture._sizeY)
var width=ige.client.tilesheetTexture._sizeX/4;var height=ige.client.tilesheetTexture._sizeY/4;if(ige.client.tilesheetTexture._sizeX<400&&ige.client.tilesheetTexture._sizeX<400){width=ige.client.tilesheetTexture._sizeX;height=ige.client.tilesheetTexture._sizeY;}ige.mapEditor.texture=new $i_56().texture(ige.client.tilesheetTexture).drawMouse(true).mount(ige.client.tilesheetScene);ige.mapEditor.texture.width(ige.client.tilesheetTexture._sizeX).height(ige.client.tilesheetTexture._sizeY).scaleTo(width/ige.client.tilesheetTexture._sizeX,height/ige.client.tilesheetTexture._sizeY,0);ige.mapEditor.tilesheet.tileWidth(ige.game.data.map.tilewidth*ige.mapEditor.texture._scale.x).tileHeight(ige.game.data.map.tileheight*ige.mapEditor.texture._scale.y).gridSize(ige.client.tilesheetTexture._sizeX/ige.game.data.map.tilewidth,ige.client.tilesheetTexture._sizeY/ige.game.data.map.tileheight);ige.client.vp2.width(width).height(height).camera.translateTo(width/2,height/2,0);ige.mapEditor.texture.translateTo(width/2,height/2,0);};ige.client.tilesheetTexture=new $i_50(ige.game.data.map.tilesets[0].image,callbackForTexture);},mapShortcuts:function(e,char){if(!ige.game.data.isDeveloper)return;switch(char){case'a':this.listeners.add_entities(e,$('#add_entities'));break;case'b':this.listeners.brush(e,$('#brush'));break;case'c':this.listeners['clear-layer'](e,$('#clear-layer'));break;case'e':this.listeners.eraser(e,$('#eraser'));break;case'f':this.listeners.fill(e,$('#fill'));break;case'r':this.listeners.add_region(e,$('#add_region'));break;case's':this.listeners.select_entity(e,$('#select_entity'));break;case'z':if(e.ctrlKey){this.undoMap(e);}break;case'y':if(e.ctrlKey){this.redoMap(e);}break;}},createMiniMap:function(){// scale percentage in proportion to the world
var miniMapScale=0.05;var self=this;self.divExcludedFromPaintingTileIds=['eraser','brush','add_region','fill','gameEditor_buttons','gameEditor_menu','editor-div','layer_menu'];self.layersIds=['li_trees_list','li_debris_list','li_walls_list','li_floor2_list','li_floor_list','layer_menu','li_floor','li_trees','li_debris','li_walls','li_floor2'];ige.client.minimapVp=new $i_68().id('minimapVp').layer(7).width(200).height(200).autoSize(false).scene(ige.client.mainScene).drawBounds(true).mouseDown(function(event,evc){// console.log(self.checkIfClickedMiniMap(event.pageX, event.pageY))
if(self.checkIfClickedMiniMap(event.pageX,event.pageY)){self.mouseDownOnMiniMap=true;self.positionViewPortRect();}}).mouseMove(function(event,evc){if(self.mouseDownOnMiniMap&&event.which===1){self.positionCameraOnMiniClick(event.pageX,event.pageY);}}).mouseUp(function(){self.mouseDownOnMiniMap=false;}).borderColor('#0bcc38').borderWidth('4px').mount(ige);ige.client.minimapVp.camera._scale.x=miniMapScale;ige.client.minimapVp.camera._scale.y=miniMapScale;// position when the window resizes
$(window).resize(function(){self.positionMiniMap(miniMapScale);self.positionViewPortRect();});$(document).on('mousemove',function(event){self.updateWorldXYCoords(event.pageX,event.pageY);var drawMouse=false;if(self.selectEntities||self.divExcludedFromPaintingTileIds.includes(event.target.id)||self.layersIds.includes(event.target.id)){// do nothing
}else{if($('#mapEditor').hasClass('active')&&(self.checkBrushToolSelected()||$('#add_region').hasClass('editordiv-hover'))){if(ige.game.data.isDeveloper&&!addNewRegion){self.positionCurTextureBox(event);drawMouse=true;}else{if(event.which===1&&!self.mouseDownOnMiniMap&&event.target.id=='igeFrontBuffer'){self.drawingRegion=true;self.drawNewRegion(event);}drawMouse=false;}}else{drawMouse=false;}}if(ige.mapEditor.tileMap&&drawMouse!=ige.mapEditor.tileMap._drawMouse){ige.mapEditor.tileMap.drawMouse(drawMouse);}});$(document).on('mouseup',function(event){if(self.selectEntities){return;}this.lastXPosition=event.pageX;this.lastYPosition=event.pageY;mouseIsDown=false;if(addNewRegion){self.drawingRegion=false;self.saveNewRegion(event);}});$('canvas').on('mousedown',function(event){if($('#mapEditor').hasClass('active')&&self.checkBrushToolSelected()&&!self.layersIds.includes(event.target.id)){if(ige._selectedViewport.id()==='vp1'&&event.which===1&&!ige.mapEditor.checkIfClickedMiniMap(event.pageX,event.pageY)){ige.mapEditor.undo.push(JSON.parse(JSON.stringify(ige.map.data)));}}});$('canvas').on('click',function(event){if(self.selectEntities){return;}if(self.isAddEntitiesEnabled){self.entity.x=self.mouseCoordinatesWRTVp.x;self.entity.y=self.mouseCoordinatesWRTVp.y;let bodies=ige.game.data[self.entity.type]&&ige.game.data[self.entity.type][self.entity.entity].bodies;if(bodies){let defaultBody=_.find(bodies,function(value,key){if(key.toLowerCase()==='default'||value.name.toLowerCase()==='default')return true;return false;})||{};self.entity.width=defaultBody.width||100;self.entity.height=defaultBody.height||100;}self.upsertMapEntities(self.entity);return;}mouseIsDown=true;if($('#mapEditor').hasClass('active')&&mouseIsDown){if(addNewRegion){if(!self.checkIfClickedMiniMap(event.pageX,event.pageY)&&event.target.id=='igeFrontBuffer'){self.drawNewRegion(event);}}else{// && !$('#tile-selection-modal').hasClass('show')
if($('#mapEditor').hasClass('active')&&self.checkBrushToolSelected()&&!self.layersIds.includes(event.target.id)){ige.mapEditor.mouseDown=true;self.mouseDownEditor(event);}}}});},checkBrushToolSelected:function(){return $('#brush').hasClass('editordiv-hover')||$('#open-pallet').hasClass('editordiv-hover')||$('#eraser').hasClass('editordiv-hover')||$('#fill').hasClass('editordiv-hover');},updateSaveButtonForMap:function(isAutoSave){autoSave=isAutoSave;var html='';if(ige.game.data.isDeveloper){if($('#map-edit-buttons').length===0){html+='<div id="editor-div" class="z-index11 p-2"><table id="map-edit-buttons">';}html+='<tr><td><i id="select_entity" class="fas fa-mouse-pointer text-muted" title="Select Entity(S)" aria-hidden="true"></i></td><td><i id="add_entities" class="fas fa-cube text-muted" title="Add Entities(A)" aria-hidden="true"></i></td></tr>';if(isAutoSave){html+='<tr><td><i id="mapsave" class="fa fa-floppy-o text-muted" title="save map" aria-hidden="true"></i></td><td><i id="add_region" class="far fa-object-ungroup text-muted" title="Add Region(R)" aria-hidden="true"></i></td></tr>';}else{html+='<tr><td><i id="add_region" class="far fa-object-ungroup text-muted" title="Add Region(R)" aria-hidden="true"></i></td><td></td></tr>';}html+='<tr><td><i id="brush" class="fa fa-paint-brush text-muted" title="Brush(B)" aria-hidden="true"></i></td><td><i id="fill" class="fas fa-fill-drip text-muted" title="fill(F)"></i></td></tr>'+'<tr><td><i id="eraser" class="fa fa-eraser text-muted" title="Eraser(E)" aria-hidden="true"></i></td><td><i id="clear-layer" class="fas fa-window-close  text-muted" class="text-muted" title="clear selected layer(C)"></i></td></tr>';if($('#map-edit-buttons').length===0){html+='</table></div>';$('body').append(html);}else{$('#map-edit-buttons').html(html);}this.addMapEditorlisteners();if(this.selectEntities){this.addSelectedClass($('#select_entity'));}}},addMapEditorlisteners:function(){var self=this;for(var key in self.listeners){$(`#${key}`).off();$(`#${key}`).on('click',self.listeners[key]);}},customEditor:function(){var self=this;this.positionMiniMap(0.05);var moveCameraInc=50;cameraPos=new $i_5();// need to match where the camera will move after map is loaded
ige.client.vp1.camera.translateTo(ige.map.data.width*ige.map.data.tilewidth/2,ige.map.data.height*ige.map.data.tileheight/2,0);cameraPos.x=ige.client.vp1.camera._translate.x;cameraPos.y=ige.client.vp1.camera._translate.y;$(window).keydown(function(event){// don't process arrow key input if in a modal window and typing stuff in
if($('input,textarea').is(':focus')){return true;}var key=event.which;var allowedKeys=[38,39,37,40];if(!allowedKeys.includes(key))return;$('input:radio').blur();var hitArrow=false;if(key==38){// up
cameraPos.y-=moveCameraInc;hitArrow=true;}if(key==39){cameraPos.x+=moveCameraInc;hitArrow=true;}if(key==37){cameraPos.x-=moveCameraInc;hitArrow=true;}if(key==40){cameraPos.y+=moveCameraInc;hitArrow=true;}ige.client.vp1.camera._translate.x=cameraPos.x;ige.client.vp1.camera._translate.y=cameraPos.y;self.positionViewPortRect();if(hitArrow){return false;}});},showHideMapEditorUI:function(show){// toggle show map editor current tile hovered over
if(show){$('#texture_pal_cont').show();$('#layer_menu').show();}else{$('#texture_pal_cont').hide();$('#layer_menu').hide();}},scanMapLayers:function(){var defaultLayers=['floor','floor2','trees','walls','debris'];for(var i in ige.layersById){if(!defaultLayers.includes(i)){alert(`invalid layer name ${i} detected`);return;}}},getTilesheetData:function(){//  gets the texture used for the tile layer. if not named appropriately, gets the last texture in the list
if(ige.layersById.floor){for(var i=0;i<ige.layersById.floor._textureList.length;i++){var string=ige.layersById.floor._textureList[i]._id;var substring='tilesheet';if(string.indexOf(substring)!==-1){ige.layersById.floor._textureList[i].tindex=i;return ige.layersById.floor._textureList[i];}}ige.layersById.floor._textureList[ige.layersById.floor._textureList.length-1].tindex=ige.layersById.floor._textureList.length-1;return ige.layersById.floor._textureList[ige.layersById.floor._textureList.length-1];}},positionCameraOnMiniClick:function(relX,relY){// translates coordinates from screen to world relative to the position clicked on the mini map
if(!this.checkIfClickedMiniMap(relX,relY)){return;}var miniWinRelY=ige.client.minimapVp._translate.y*2;// position of mini map relative to window y
var worldX=relX/0.05;var worldY=(relY-miniWinRelY)/0.05;ige.client.vp1.camera._translate.x=worldX;ige.client.vp1.camera._translate.y=worldY;cameraPos.x=ige.client.vp1.camera._translate.x;cameraPos.y=ige.client.vp1.camera._translate.y;this.positionViewPortRect();},positionCameraOnRightClick:function(relX,relY){var miniWinRelY=ige.client.minimapVp._translate.y*2;// position of mini map relative to window y
var worldX=relX;var worldY=relY;var height=ige.client.vp1.camera._translate.y-this.lastYPosition;var width=ige.client.vp1.camera._translate.x-this.lastXPosition;ige.client.vp1.camera._translate.x=ige.client.vp1.camera._translate.x+width;ige.client.vp1.camera._translate.y=-(ige.client.vp1.camera._translate.y+height);cameraPos.x=ige.client.vp1.camera._translate.x;cameraPos.y=ige.client.vp1.camera._translate.y;this.positionViewPortRect();},createLayerMenu:function(){// create the HTML for the layer toggle visibility and toggle draw to layer box.
if($('#layer_menu').length>1){return;}var layerMenuHTML='<div id="layer_menu" class="z-index11"><div>Layers</div><ul class="list-group">';var layersByOrder={trees:'',debris:'',walls:'',floor2:'',floor:''};for(var key in layersByOrder){if(key==='debris')continue;var id=`li_${key}`;layerMenuHTML+=`<li id="${id}_list" data-layer="${key}" class="not_current list-group-item"><i id="${id}" data-layer="${key}" data-vis="0" class="fa fa-eye" aria-hidden="true"></i>${key}</li>`;}layerMenuHTML+='</ul></div>';$('body').append(layerMenuHTML);$('#li_floor_list').addClass('active');$('#all_layers_checkbox').on('change',function(){showAllLayers=!showAllLayers;for(var key in ige.layersById){if(key==curLayerPainting){var val=1;}else{var val=0;}if(showAllLayers){val=1;}if(typeof ige.layersById[key].opacity==='function'){ige.layersById[key].opacity(val);}else{ige.layersById[key].opacity=val;}}});for(var key in ige.layersById){var id=`li_${key}`;$(`#${id}_list`).on('click',function(){$(this).siblings().removeClass('active');$(this).addClass('active');var layer=$(this).data('layer');if(layer==='debris'){$('#eraser').addClass('hidden');$('#brush').addClass('hidden');$('#fill').addClass('hidden');}else{$('#eraser').removeClass('hidden');$('#brush').removeClass('hidden');$('#fill').removeClass('hidden');}curLayerPainting=layer;});$(`#${id}`).on('click',function(){var val=$(this).data('vis');if(val==0){$(this).data('vis',1);$(this).removeClass('fa-eye');$(this).addClass('fa-eye-slash');}else{$(this).data('vis',0);$(this).removeClass('fa-eye-slash');$(this).addClass('fa-eye');}var layer=$(this).data('layer');if(layer==='debris'){var allDebris=ige.$$('debris');allDebris.forEach(function(debris){if(val){debris.show();}else{debris.hide();}});}else{if(typeof ige.layersById[layer].opacity==='function'){ige.layersById[layer].opacity(val);}else{ige.layersById[layer].opacity=val;}}});}},updateWorldXYCoords:function(screenX,screenY){// translates screen coordinates to world coordinates
var vp=ige.client.vp1;var mp=vp.mousePos();ige.mapEditor.mouseCoordinatesWRTVp={x:mp.x,y:mp.y};$('#mouse_coords #x').text(ige.mapEditor.mouseCoordinatesWRTVp.x);$('#mouse_coords #y').text(ige.mapEditor.mouseCoordinatesWRTVp.y);},checkIfClickedMiniMap:function(relX,relY){// determines if the user clicks the mini map based on relative position of the mouse
var self=this;var miniHeight=ige.client.minimapVp.height();var miniWidth=ige.client.minimapVp.width();var miniWinRelY=ige.client.minimapVp._translate.y*2;// position of mini map relative to window y
if(relX>miniWidth||relY>miniWinRelY+miniHeight||relY<miniWinRelY||self.drawingRegion){// exclude clicks outside the mini map area
return false;}else{return true;}},makeMap:function(layer){for(var i=0;i<ige.map.data.width*ige.map.data.height;i++){if(layer[i]===undefined){layer[i]=0;}}},floodFil:function(layer,x,y,previousTile,NewTile){// console.log(this.counter++,' ',x,' ',y)
var self=this;if(x<0||y<0||x>=ige.map.data.width||y>=ige.map.data.height)return;var tileIndex=x+y*ige.map.data.width;if(layer[tileIndex]===undefined){this.makeMap(layer);}if(layer[tileIndex]!=previousTile||NewTile==previousTile)return;if(this.counter>ige.map.data.width*ige.map.data.height){return;}layer[tileIndex]=NewTile;ige.layersById[curLayerPainting].paintTile(x,y,this.getTilesheetData().tindex,NewTile);// setTimeout(function () {
//     self.floodFil(layer, x + 1, y, previousTile, NewTile)
// }, 0);
// setTimeout(function () {
//     self.floodFil(layer, x - 1, y, previousTile, NewTile);
// }, 0);
// setTimeout(function () {
//     self.floodFil(layer, x, y + 1, previousTile, NewTile);
// }, 0);
// setTimeout(function () {
//     self.floodFil(layer, x, y - 1, previousTile, NewTile);
// }, 0);
this.floodFil(layer,x+1,y,previousTile,NewTile);this.floodFil(layer,x-1,y,previousTile,NewTile);this.floodFil(layer,x,y+1,previousTile,NewTile);this.floodFil(layer,x,y-1,previousTile,NewTile);},mouseDownEditor:function(e){// input handler for placing a tile
// console.log('mouse down called');
if(e.which!==1)return;if(this.checkIfClickedMiniMap(e.pageX,e.pageY)){$('#world_cur_tile').hide();return;}if(ige._selectedViewport&&ige._selectedViewport.id()!=='vp1')return;// $('#world_cur_tile').show();
var winWidth=$(window).width();var winHeight=$(window).height();var cellWidth=this.getTilesheetData()._cellWidth;var cellHeight=this.getTilesheetData()._cellHeight;var camX=ige.client.vp1.camera._translate.x;var camY=ige.client.vp1.camera._translate.y;var worldX=ige.mapEditor.mouseCoordinatesWRTVp.x;var worldY=ige.mapEditor.mouseCoordinatesWRTVp.y;var tileX=Math.floor(worldX/cellWidth);var tileY=Math.floor(worldY/cellHeight);console.log(tileX,tileY,cellWidth,cellHeight,worldX,worldY);if(tileX<0||tileY<0||tileX>=ige.map.data.width||tileY>=ige.map.data.height){return;}if(curSelectedTileIndex!=undefined){if(ige.layersById[curLayerPainting].paintTile==undefined){return;}var lIndex=this.getLayerIndexFromName(curLayerPainting);ige.isMapUpdated=true;var tileIndex=tileX+tileY*ige.map.data.width;var forceRendering=false;if($('#fill').hasClass('editordiv-hover')){var currentTile=ige.map.data.layers[lIndex].data[tileIndex];this.counter=0;this.floodFil(ige.map.data.layers[lIndex].data,tileX,tileY,currentTile||0,curSelectedTileIndex);forceRendering=true;}else{if($('#eraser').hasClass('editordiv-hover')){ige.layersById[curLayerPainting].clearTile(tileX,tileY);forceRendering=true;}else if($('#brush').hasClass('editordiv-hover')){ige.layersById[curLayerPainting].paintTile(tileX,tileY,this.getTilesheetData().tindex,curSelectedTileIndex);forceRendering=true;}}console.log(lIndex);ige.map.data.layers[lIndex].data[tileIndex]=curSelectedTileIndex;ige.layersById[curLayerPainting].cacheForceFrame();if(autoSave){ige.mapEditor.isMapChangeAndNotSaved=true;}else{window.updateSandboxMapLayers(lIndex,ige.map.data.layers[lIndex].data);}}},drawNewRegion:function(e){var vpWidth=ige.client.vp1.width();var vpHeight=ige.client.vp1.height();if(mouseIsDown){var mx=ige.mapEditor.mouseCoordinatesWRTVp.x;var my=ige.mapEditor.mouseCoordinatesWRTVp.y;if(!addRegionCordinates.startX&&!addRegionCordinates.startY){addRegionCordinates.startX=mx;addRegionCordinates.startY=my;addRegionCordinates.mouseStartX=e.pageX;addRegionCordinates.mouseStartY=e.pageY;$('#draw-new-region').css({position:'absolute',left:e.pageX,top:e.pageY,border:'1px solid blue'});}else{addRegionCordinates.endX=mx;addRegionCordinates.endY=my;addRegionCordinates.mouseEndX=e.pageX;addRegionCordinates.mouseEndY=e.pageY;$('#draw-new-region').css({position:'absolute',left:e.pageX-addRegionCordinates.mouseStartX<0?`${e.pageX}px`:`${addRegionCordinates.mouseStartX}px`,top:e.pageY-addRegionCordinates.mouseStartY<0?`${e.pageY}px`:`${addRegionCordinates.mouseStartY}px`,height:`${Math.abs(e.pageY-addRegionCordinates.mouseStartY)}px`,width:`${Math.abs(e.pageX-addRegionCordinates.mouseStartX)}px`,border:'1px solid blue'});}}},saveNewRegion:function(event){if(addNewRegion&&addRegionCordinates.startX){var regionKey=`Region${parseInt(Math.random()*10000)}`;var x=addRegionCordinates.endX-addRegionCordinates.startX<0?addRegionCordinates.endX:addRegionCordinates.startX;var y=addRegionCordinates.endY-addRegionCordinates.startY<0?addRegionCordinates.endY:addRegionCordinates.startY;var height=Math.abs(addRegionCordinates.endY-addRegionCordinates.startY);var width=Math.abs(addRegionCordinates.endX-addRegionCordinates.startX);var newRegion={dataType:'region',default:{x:x+Math.abs(width)/2,y:y+Math.abs(height)/2,height:height,width:width}};ige.regionManager.openRegionModal(newRegion,regionKey,true);addRegionCordinates={};$('#draw-new-region').css({border:'',height:'',left:'',top:'',width:''});addNewRegion=false;// this.removeSelectedClass('add_region');
$('#add_region').removeClass('editordiv-hover').addClass('text-muted');}},snapToGrid:function(val,gridSize){var snap=gridSize*Math.floor(val/gridSize);return snap;},positionViewPortRect:function(){// adds the viewport rect
if($('#view_rect').length<1){$('body').append('<div id="view_rect"></div>');}var vpWidth=ige.client.vp1.width()*0.05;var vpHeight=ige.client.vp1.height()*0.05;$('#view_rect').width(vpWidth);$('#view_rect').height(vpHeight);var relY=ige.client.minimapVp._translate.y*2+ige.client.vp1.camera._translate.y*0.05-vpHeight/2;var relX=ige.client.vp1.camera._translate.x*0.05-vpWidth/2;$('#view_rect').css({top:relY,left:relX,zIndex:0});},positionMiniMap:function(miniMapScale){// positions mini map so it is flush to the bottom left of the screen
var worldWidth=ige.map.data.width*ige.map.data.tileheight;var worldHeight=ige.map.data.height*ige.map.data.tileheight;var padding=0;ige.client.minimapVp.width(worldWidth*0.05+padding);ige.client.minimapVp.height(worldHeight*0.05+padding);ige.client.minimapVp.camera._translate.x=worldWidth/2;ige.client.minimapVp.camera._translate.y=worldHeight/2;ige.client.minimapVp._translate.x=ige.client.vp1.width()/2*-1+worldWidth*miniMapScale/2;ige.client.minimapVp._translate.y=ige.client.vp1.height()/2*1-worldHeight*miniMapScale/2;},getLayerIndexFromName:function(name){var i=0;for(var key in ige.layersById){if(key==name){return i;}i++;}},positionCurTextureBox:function(e){// positions the white current selected tile box relative to the screen
if(ige.layersById==undefined||ige.layersById.floor==undefined){return;}var imgWidth=$('#texture_pal').width();var imgHeight=$('#texture_pal').height();var winWidth=$(window).width();var winHeight=$(window).height();var cellWidth=this.getTilesheetData()._cellWidth;var cellHeight=this.getTilesheetData()._cellHeight;// var isHover = e.target.id === 'texture_pal';
var isHover=e.pageX>winWidth-imgWidth&&e.pageY>winHeight-imgHeight;var isAnimating=$('#texture_pal_cont').is(':animated');if(!isHover){$('#cur_texture_box').css({display:'none'});}else{$('#cur_texture_box').css({display:'block'});}if(isHover){if(!isAnimating){// $('#texture_pal_cont').animate({
//     'width': '30%'
// }, 200);
//     $('#layer_menu').hide();
}}else{if(!isAnimating){// $('#texture_pal_cont').animate({
//     'width': '20%'
// }, 200);
//      $('#layer_menu').show();
}// var camX = ige.client.vp1.camera._translate.x;
// var camY = ige.client.vp1.camera._translate.y;
// var worldX = ige.mapEditor.mouseCoordinatesWRTVp.x;
// var worldY = ige.mapEditor.mouseCoordinatesWRTVp.y;
// var tileX = Math.floor(worldX / cellWidth);
// var tileY = Math.floor(worldY / cellHeight);
// cellWidth = cellWidth * ige.client.vp1.camera._scale.x;
// cellHeight = cellHeight * ige.client.vp1.camera._scale.y;
// // console.log(cellWidth, cellHeight)
// tileX = tileX * cellWidth;
// tileY = tileY * cellHeight;
// $('#world_cur_tile').css({
//     'left': tileX,
//     'top': tileY,
//     'width': cellWidth,
//     'height': cellHeight,
// });
if(mouseIsDown){this.mouseDownEditor(e);}return;}var boxWidth=imgWidth/this.getTilesheetData()._cellColumns;var boxHeight=imgHeight/this.getTilesheetData()._cellRows;$('#cur_texture_box').width(boxWidth);$('#cur_texture_box').height(boxHeight);var parentOffset=$('#texture_pal_cont').offset();var relX=this.snapToGrid(e.pageX-parentOffset.left-boxWidth/2,boxWidth);var relY=this.snapToGrid(e.pageY-parentOffset.top-boxHeight/2,boxHeight);$('#cur_texture_box').css({left:relX,// + $('#texture_pal_cont')[0].scrollLeft
top:relY// + $('#texture_pal_cont')[0].scrollTop
});// curSelectedTileIndex = Math.round(((relX / boxWidth) + 1) + (((relY / boxHeight))) * this.getTilesheetData()._cellColumns);
// console.log(curSelectedTileIndex);
},animateOpacity:function(element,num){// causes the current selected tile box to animate in opacity
element.animate({opacity:num},3000,undefined,function(){if(num==0.4){num=0.8;}else{num=0.4;}this.animateOpacity(element,num);});},addSelectedClass:function(self,value){if($(self).hasClass('editordiv-hover')&&!value){$(self).removeClass('editordiv-hover');$(self).addClass('text-muted');}else{$('.fa.editordiv-hover').removeClass('editordiv-hover').addClass('text-muted');$('.material-icons.editordiv-hover').removeClass('editordiv-hover').addClass('text-muted');$(self).removeClass('text-muted');$(self).addClass('editordiv-hover');}},addUI:function(){var self=this;var textureURL=this.getTilesheetData()._url;if(ige.game.data.isDeveloper){this.updateSaveButtonForMap(autoSave);}$('body').append('<div id="draw-new-region" class="z-index11"></div>');$('body').append('<div id="mouse_coords">X:<span id="x"></span> Y:<span id="y"></span></div>');// $('body').append('<div id="world_cur_tile" class="z-index11"></div><div id="texture_pal_cont" class="z-index11"><img id="texture_pal" src="' + textureURL + '" /><div id="cur_texture_box"></div></div>');
//     animateOpacity($('#world_cur_tile'), .4);
$('#texture_pal_cont').on('click',function(e){var imgWidth=$('#texture_pal').width();var imgHeight=$('#texture_pal').height();var boxWidth=imgWidth/self.getTilesheetData()._cellColumns;var boxHeight=imgHeight/self.getTilesheetData()._cellRows;var parentOffset=$('#texture_pal_cont').offset();var relX=self.snapToGrid(e.pageX-parentOffset.left-boxWidth/2,boxWidth);var relY=self.snapToGrid(e.pageY-parentOffset.top-boxHeight/2,boxHeight);curSelectedTileIndex=Math.round(relX/boxWidth+1+relY/boxHeight*self.getTilesheetData()._cellColumns);lastCurSelectedTileIndex=curSelectedTileIndex;});this.createLayerMenu();this.showHideMapEditorUI(true);},removeSelectedClass:function(type){if(type!='brush'){$('#brush').removeClass('editordiv-hover').addClass('text-muted');}if(type!='fill'){$('#fill').removeClass('editordiv-hover').addClass('text-muted');}if(type!='eraser'){$('#eraser').removeClass('editordiv-hover').addClass('text-muted');}if(type!='add_region'){addNewRegion=false;$('#add_region').removeClass('editordiv-hover').addClass('text-muted');}// if (type != 'open-pallet') {
//     $('#open-pallet').removeClass('editordiv-hover').addClass('text-muted');
// }
if(type!='add_entities'){$('#add_entities').removeClass('editordiv-hover').addClass('text-muted');}if(type!='select_entity'){$('#select_entity').removeClass('editordiv-hover').addClass('text-muted');}},openEntitiesModal:function(entity,isEdit){var self=this;var generateList=function(type){var html='';// '<option value="">Select entity</option>';
var entityKeys=Object.keys(entity);_.map(ige.game.data[type],function(entity,key){html+=`<option value='${key}'>${entity.name}</option>`;});if(entityKeys.length===0){html='<option value="">This game has no entity</option>';document.getElementById('entities-list').value='';}else{if(!isEdit){document.getElementById('entities-list').value=entityKeys[0];self.entity.entity=entityKeys[0];}}$('#entities-list').html(html);};var generatePlayerTypeList=function(type){if(type==='unitTypes'){$('#player-list-div').removeClass('d-none');document.getElementById('player-list').required=true;}else{$('#player-list-div').hasClass('d-none')?null:$('#player-list-div').addClass('d-none');document.getElementById('player-list').required=false;return;}var html='';// '<option value=""> Select Player </option>';
var availablePlayers=[];_.map(ige.game.data.variables,function(variable,key){if(variable&&variable.dataType==='player'){html+=`<option value="${key}">${key}</option>`;availablePlayers.push(key);}});if(availablePlayers.length===0){html='<option value="">This game has no player global variable in Environment</option>';document.getElementById('player-list').value='';}else{if(!isEdit){document.getElementById('player-list').value=availablePlayers[0];}}$('#player-list').html(html);};$('#entity-type').on('change',function(){generateList(this.value);generatePlayerTypeList(this.value);});generateList(entity.type);generatePlayerTypeList(entity.type);$('#entity-type').val(entity.type);$('[name=entity-x').val(entity.x);$('[name=entity-y').val(entity.y);$('[name=entity-rotation').val(entity.rotation);$('[name=entity-height').val(entity.height);$('[name=entity-width').val(entity.width);if(isEdit){$('[name=entity-player').val(entity.player);$('[name=entity').val(entity.entity);$('[name=entity-index').val(entity.index);$('[name=entity-isEdit').val('true');$('.entity-hidden').removeClass('d-none');$('#entity-modal-title').html('Edit entity');$('#entity-save').html('<i class=\'fa fa-save\'></i> Save');}else{$('[name=entity-index').val('none');$('[name=entity-isEdit').val('false');$('.entity-hidden').addClass('d-none');$('#entity-modal-title').html('Select entity to place on the map');$('#entity-save').html('Select');}$('#entities-modal').modal({show:true,keyboard:true});},upsertMapEntities:function(entity,index=ige.game.data.scripts.initialize&&ige.game.data.scripts.initialize.actions.length||0,action='upsert'){if((!entity.type||!entity.entity)&&action!='delete'){return;}var self=this;document.body.style.cursor='wait';window.modifyMapEntity(index,entity.type,entity.entity,entity.x,entity.y,entity.height,entity.width,entity.rotation,entity.player,action).then(game=>{ige.game.data.scripts=game.data.scripts;if(ige.game.createdEntities.length>0){for(var i=0;i<ige.game.createdEntities.length;i++){ige.game.createdEntities[i].destroy();}ige.game.createdEntities=[];}ige.script.runScript('initialize',{});document.body.style.cursor='default';$('#entities-modal').modal('hide');});}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=MapEditorComponent;};/**
 * When added to a viewport, automatically adds mouse panning
 * capabilities to the viewport's camera.
 */var MapPanComponent=$i_3.extend({classId:'MapPanComponent',componentId:'mapPan',/**
	 * @constructor
	 * @param {$i_55} entity The object that the component is added to.
	 * @param {Object=} options The options object that was passed to the component during
	 * the call to addComponent.
	 */init:function(entity,options){this._entity=entity;this._options=options;// Set the pan component to inactive to start with
this._enabled=false;this._zoomEnabled=false;this._startThreshold=5;// The number of pixels the mouse should move to activate a pan
this.zoomStartThreshold=100;// Default zoom level of viewport from which zooming will be started
},/**
	 * Gets / sets the number of pixels after a mouse down that the mouse
	 * must move in order to activate a pan operation. Defaults to 5.
	 * @param val
	 * @return {*}
	 */startThreshold:function(val){if(val!==undefined){this._startThreshold=val;return this._entity;}return this._startThreshold;},/**
	 * Gets / sets the rectangle that the pan operation will be limited
	 * to using an $i_7 instance.
	 * @param {$i_7=} rect
	 * @return {*}
	 */limit:function(rect){if(rect!==undefined){this._limit=rect;return this._entity;}return this._limit;},/**
	 * Gets / sets the enabled flag. If set to true, pan
	 * operations will be processed. If false, no panning will
	 * occur.
	 * @param {Boolean=} val
	 * @return {*}
	 */enabled:function(val){var self=this;if(val!==undefined){this._enabled=val;this._zoomEnabled=val;// Reset pan values.
// This prevents problems if mouse pan is disabled mid-pan.
this._panPreStart=false;this._panStarted=false;if(this._enabled){// Listen for the mouse events we need to operate a mouse pan
this._entity.mouseDown(function(event){if(event.which===3)self._mouseDown(event);});this._entity.mouseMove(function(event){self._mouseMove(event);});this._entity.mouseUp(function(event){self._mouseUp(event);});this._entity.mouseWheel(function(event){self._mouseWheel(event);});}else{// Remove the pan start data
delete this._panStartMouse;delete this._panStartCamera;}return this._entity;}return this._enabled;},/**
	 * Handles the mouseDown event. Records the starting position of the
	 * camera pan and the current camera translation.
	 * @param event
	 * @private
	 */_mouseDown:function(event){if(!this._panStarted&&this._enabled&&event.igeViewport.id()===this._entity.id()){// Record the mouse down position - pan pre-start
var curMousePos=ige._mousePos;this._panStartMouse=curMousePos.clone();this._panStartCamera={x:this._entity.camera._translate.x,y:this._entity.camera._translate.y};this._panPreStart=true;this._panStarted=false;}},/**
	 * Handles the mouse move event. Translates the camera as the mouse
	 * moves across the screen.
	 * @param event
	 * @private
	 */_mouseMove:function(event){var vpId=event&&event.igeViewport&&event.igeViewport.id();if(vpId==='minimapVp'){vpId='vp1';}if(vpId)ige._selectedViewport=ige.client[vpId];if(this._enabled){// Pan the camera if the mouse is down
if(this._panStartMouse){var curMousePos=ige._mousePos;var panCords={x:this._panStartMouse.x-curMousePos.x,y:this._panStartMouse.y-curMousePos.y};var distX=Math.abs(panCords.x);var distY=Math.abs(panCords.y);var panFinalX=panCords.x/this._entity.camera._scale.x+this._panStartCamera.x;var panFinalY=panCords.y/this._entity.camera._scale.y+this._panStartCamera.y;// Check if we have a limiter on the rectangle area
// that we should allow panning inside.
if(this._limit){// Check the pan co-ordinates against
// the limiter rectangle
if(panFinalX<this._limit.x){panFinalX=this._limit.x;}if(panFinalX>this._limit.x+this._limit.width){panFinalX=this._limit.x+this._limit.width;}if(panFinalY<this._limit.y){panFinalY=this._limit.y;}if(panFinalY>this._limit.y+this._limit.height){panFinalY=this._limit.y+this._limit.height;}}if(this._panPreStart){// Check if we've reached the start threshold
if(distX>this._startThreshold||distY>this._startThreshold){this._entity.camera.translateTo(panFinalX,panFinalY,0);this.emit('panStart');this._panPreStart=false;this._panStarted=true;this.emit('panMove');}}else{// Pan has already started
this._entity.camera.translateTo(panFinalX,panFinalY,0);this.emit('panMove');}// update mini map position
ige.mapEditor.positionViewPortRect();}}},/**
	 * Handles the mouse up event. Finishes the camera translate and
	 * removes the starting pan data.
	 * @param event
	 * @private
	 */_mouseUp:function(event){if(this._enabled){// End the pan
if(this._panStarted){if(this._panStartMouse){var curMousePos=ige._mousePos;var panCords={x:this._panStartMouse.x-curMousePos.x,y:this._panStartMouse.y-curMousePos.y};var panFinalX=panCords.x/this._entity.camera._scale.x+this._panStartCamera.x;var panFinalY=panCords.y/this._entity.camera._scale.y+this._panStartCamera.y;// Check if we have a limiter on the rectangle area
// that we should allow panning inside.
if(this._limit){// Check the pan co-ordinates against
// the limiter rectangle
if(panFinalX<this._limit.x){panFinalX=this._limit.x;}if(panFinalX>this._limit.x+this._limit.width){panFinalX=this._limit.x+this._limit.width;}if(panFinalY<this._limit.y){panFinalY=this._limit.y;}if(panFinalY>this._limit.y+this._limit.height){panFinalY=this._limit.y+this._limit.height;}}this._entity.camera.translateTo(panFinalX,panFinalY,0);// Remove the pan start data to end the pan operation
delete this._panStartMouse;delete this._panStartCamera;this.emit('panEnd');this._panStarted=false;}}else{delete this._panStartMouse;delete this._panStartCamera;this._panStarted=false;}}},_mouseWheel:function(event){if(this._zoomEnabled){var delta=Math.max(-1,Math.min(1,event.wheelDelta||-event.detail));delta*=10;this.zoomStartThreshold+=delta;if(this.zoomStartThreshold<2){this.zoomStartThreshold=2;}var scale=this.zoomStartThreshold/100;ige._selectedViewport.camera.scaleTo(scale,scale,0);}}});;var UnitUiComponent=$i_56.extend({classId:'UnitUiComponent',componentId:'unitUi',init:function(entity,options){var self=this;self._entity=entity;},updateAllAttributeBars:function(){var self=this;var attributes=self._entity._stats.attributes;// get unit's attribute types
// assign "type" variable to attributes
for(var attributeId in attributes){attributes[attributeId].type=attributeId;}if(ige.isClient&&ige.network.id()==self._entity._stats.clientId){// var attributeContainerComponent = self._entity.getAttributeBarContainer()
var ownerPlayer=self._entity.getOwner();var belongsToSelectedUnit=ownerPlayer&&ownerPlayer._stats&&ownerPlayer._stats.selectedUnitId===self._entity.id();if(belongsToSelectedUnit){$('#attribute-bars').html('');}var isAttributeBarPresent=false;for(var attributeTypeId in attributes){// if (attributeContainerComponent) {
// 	attributeContainerComponent.updateBar(attributeTypeId, attributes[attributeTypeId])
// }
if(belongsToSelectedUnit){var attribute=attributes[attributeTypeId];if(attribute.isVisible&&(attribute.isVisible===true||// for old deprecated method of showing attr bar
attribute.isVisible.indexOf&&attribute.isVisible.indexOf('centerBar')>-1)){isAttributeBarPresent=true;var width=attribute.value/attribute.max*100;var bar=$('<div/>',{class:'progress'}).append($('<div/>',{class:`label progress-label player-${attributeTypeId}`,style:'position: absolute; margin-top: 3px; width: 100%; color: black; font-size: 14px'})).append($('<div/>',{class:`player-max-${attributeTypeId} progress-bar progress-bar-info`,role:'progressbar','aria-valuemin':'0','aria-valuemax':'100',style:`width: ${width}%;font-weight:bold;transition:none; background-color:${attribute.color}`}));$('#attribute-bars').append(bar);}}self._entity.attribute.refresh();}if(isAttributeBarPresent){$('#attribute-bars').css({minWidth:'200px'});}}},removeAllAttributeBars:function(){var self=this;if(ige.isClient&&ige.network.id()==self._entity._stats.clientId){$('#attribute-bars').html('');}},// update one attribute bar
updateAttributeBar:function(attr){var self=this;// only update attributes for this unit
if(self._entity&&self._entity._stats.clientId!=ige.network.id()){return;}var attributeTypes=ige.game.data.attributeTypes;if(attributeTypes==undefined||attr==undefined)return;var name=attributeTypes[attr.type]?attributeTypes[attr.type].name:attr.name;self._entity.updateAttributeBar(attr);if(attr.isVisible&&(attr.isVisible===true||// for old deprecated method of showing attr bar
attr.isVisible.indexOf&&attr.isVisible.indexOf('centerBar')>-1)){if(attr.value%1===0){attr.value=parseInt(attr.value);}else{if(attr.decimalPlaces!=undefined&&attr.decimalPlaces!=null){var decimalPlace=parseInt(attr.decimalPlaces);if(decimalPlace!=NaN){attr.value=parseFloat(attr.value).toFixed(decimalPlace);}else{attr.value=parseFloat(attr.value).toFixed(2);}}else{attr.value=parseFloat(attr.value).toFixed(2);}}var value=null;if(attr.dataType==='time'){value=ige.game.secondsToHms(attr.value);}else{value=attr.value;}$(`.player-${attr.type}`).text(attr.displayValue?`${name}: ${value}/${parseFloat(attr.max).toFixed(0)}`:name);var widthInPercent=attr.value/attr.max*100;$(`.player-max-${attr.type}`).stop().animate({width:`${widthInPercent}%`});}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=UnitUiComponent;};var VideoChatComponent=$i_56.extend({classId:'VideoChatComponent',componentId:'videoChat',init:function(entity,options){var self=this;self._entity=entity;self.groups={};// Holds the player info: key = playerID, value = currentGroup
this.groupedPlayers={};self.playerDistances={};if(ige.isServer){self.chatEnterDistance=50000;self.chatLeaveDistance=50000;// update player groups every 1s
setInterval(self.updatePlayerGroups,1000,self);}else if(ige.isClient){self.minRange=300;// myPlayer's video & audio chat radius. when range is at 700, fade value & audio should be at 0.
self.maxRange=700;if(typeof videoChatUpdateSpatialVideo=='function'){setInterval(self.updatePlayerDistanceMatrix,200,self);}}},updatePlayerGroups:function(self){var players=ige.$$('player').filter(function(player){return player._stats.controlledBy=='human';});// var players = ige.$$('player')
// update centoid of the groups
for(groupId in self.groups){var group=self.groups[groupId];var polygons=self.getPolygons(group.playerIds);var centoid=self.getCentoid(polygons);// delete empty group
if(centoid==undefined){delete self.groups[groupId];continue;}self.groups[groupId].centoid=centoid;console.log('group',groupId,' size: ',group.playerIds.length,'centoid',group.centoid);// if (isNaN(group.centoid.x)) {
// 	console.log(self.groups[groupId])
// 	var playerIds = self.groups[groupId].playerIds;
// 	for (var i = 0; i < playerIds.length; i++) {
// 		var playerId = playerIds[i]
// 		console.log("inspecting player", playerId)
// 		var player = ige.$(playerId);
// 		var unit = player.getSelectedUnit();
// 		if (unit != undefined)
// 			console.log(unit._translate)
// 		else
// 			console.log("unit doesn't exist")
// 	}
// }
}for(var i=0;i<players.length;i++){var player=players[i];if(player){var playerId=player.id();var unit=player.getSelectedUnit();if(unit){// if the Player belongs to a group and is out of range from the group's centoid OR if that player's group no longer exists, then kick that player out of the group
if(player.vcGroupId&&self.groups[player.vcGroupId]){var group=self.groups[player.vcGroupId];var centoid=group.centoid;var distance=self.getDistance(centoid,unit._translate);if(distance>self.chatLeaveDistance){self.removePlayerFromGroup(playerId);}}else{// if the Player doesn't belong in any group
// check if the Player is within enter range of any group. If so, make Player enter the group.
// Entering in a ready formed group will have the priority
let chatEntered=false;for(groupId in self.groups){var group=self.groups[groupId];if(group){var centoid=group.centoid;var distance=self.getDistance(centoid,unit._translate);if(distance<self.chatEnterDistance){self.addPlayerToGroup(playerId,groupId);chatEntered=true;break;}}}// check if a player is within chat range. If that player also doesn't belong is a group, then create a new group
if(!chatEntered){for(var j=0;j<players.length;j++){var playerB=players[j];if(playerB){var playerBId=playerB.id();if(playerId!=playerBId){var unitB=playerB.getSelectedUnit();if(unitB&&playerB.vcGroupId==undefined){var distance=self.getDistance(unit._translate,unitB._translate);if(distance<self.chatEnterDistance){self.createGroup([playerId,playerBId]);break;}}}}}}}}}}},getDistance:function(A,B){var xDiff=A.x-B.x;var yDiff=A.y-B.y;return Math.sqrt(xDiff*xDiff+yDiff*yDiff);},createGroup:function(playerIds){var self=this;// group needs ID, and its members' PlayerID and their positions
// console.log("creating a group.. initial members:", playerIds)
var groupId=ige.newIdHex();self.groups[groupId]={playerIds:[]};for(i=0;i<playerIds.length;i++){var playerId=playerIds[i];self.addPlayerToGroup(playerId,groupId);}var polygons=self.getPolygons(self.groups[groupId].playerIds);self.groups[groupId].centoid=self.getCentoid(polygons);},// param: destroy group that contains PlayerId
destroyGroup:function(id){for(groupId in this.groups){if(groupId==id){// unset the existing members' vcGroupIDs
var playerIds=this.groups[id].playerIds;if(playerIds){for(i=0;i<playerIds.length;i++){var playerId=playerIds[i];var player=ige.$(playerId);if(player){this.removePlayerFromGroup(playerId);}}}delete this.groups[id];}}},addPlayerToGroup:function(playerId,groupId){var player=ige.$(playerId);if(player){this.groups[groupId].playerIds.push(playerId);player.vcGroupId=groupId;console.log('Adding player ',player._stats.name,'(',playerId,') from the group',groupId);this.groupedPlayers[playerId]=groupId;ige.network.send('videoChat',{command:'joinGroup',groupId:groupId},player._stats.clientId);}else{console.log('Cannot add player to videoChat group. Player doesn\'t exist!');}},removePlayerFromGroup:function(playerId,sendNetworkEvent=true){var player=ige.$(playerId);if(player){if(player.vcGroupId){var playerIds=this.groups[player.vcGroupId].playerIds;if(playerIds){for(i=0;i<playerIds.length;i++){if(playerIds[i]==playerId){console.log('Removing player ',player._stats.name,'(',playerId,') from the group',player.vcGroupId);this.groups[player.vcGroupId].playerIds.splice(i,1);if(this.groupedPlayers[playerId]&&this.groupedPlayers[playerId]==player.vcGroupId){delete this.groupedPlayers[playerId];}if(sendNetworkEvent){ige.network.send('videoChat',{command:'leaveGroup'},player._stats.clientId);}// if there's only 1 person in a group, destroy the group
if(this.groups[player.vcGroupId].playerIds.length<=1){this.destroyGroup(player.vcGroupId);}break;}}}}player.vcGroupId=undefined;}else{console.log('hello');// Not doing this is raising a race-condition:
// We check if the player is in a group and we remove him even if it doesn't exist.
if(this.groupedPlayers[playerId]){// indexOf is also very fast.
const key=this.groups[this.groupedPlayers[playerId]].playerIds.indexOf(playerId);if(key>-1){this.groups[this.groupedPlayers[playerId]].playerIds.splice(key,1);}delete this.groupedPlayers[playerId];}console.log('Player ',playerId,' remove from videoChat group even if Player doesn\'t exist!');}// this.emit("playerRemovedFromGroup", [playerId])
},getPolygons:function(playerIds){var polygons=[];if(playerIds){for(var i=0;i<playerIds.length;i++){var playerId=playerIds[i];var player=ige.$(playerId);if(player){var unit=player.getSelectedUnit();if(unit){polygons.push([unit._translate.x,unit._translate.y]);}}else{this.removePlayerFromGroup(playerId);}}}return polygons;},getCentoid:function(polygons){// console.log("polygons", polygons)
if(polygons==undefined||polygons.length==0){return undefined;}var centroid={x:0,y:0};for(var i=0;i<polygons.length;i++){var point=polygons[i];centroid.x+=point[0];centroid.y+=point[1];}centroid.x/=polygons.length;centroid.y/=polygons.length;return centroid;},updatePlayerDistanceMatrix:function(self){self.playerDistances={};var players=ige.$$('player').filter(function(player){return player._stats.controlledBy=='human';});for(var i=0;i<players.length;i++){var playerA=players[i];var playerAId=playerA.id();if(playerA){if(self.playerDistances[playerAId]==undefined){self.playerDistances[playerAId]={};}var unitA=playerA.getSelectedUnit();if(unitA){for(var j=0;j<players.length;j++){if(i!=j){// dont compare distance between same unit
var playerB=players[j];if(playerB){var playerBId=playerB.id();var unitB=playerB.getSelectedUnit();if(unitB){self.playerDistances[playerAId][playerBId]=self.getDistance(unitA._translate,unitB._translate);}}}}}}}// console.log(self.playerDistances)
if(ige.client.myPlayer!=undefined){videoChatUpdateSpatialVideo(self.playerDistances[ige.client.myPlayer.id()]);}// console.log("distance to other players", self.playerDistances[ige.client.myPlayer.id()])
}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=VideoChatComponent;};var TradeUiComponent=$i_56.extend({classId:'TradeUiComponent',componentId:'tradeUi',init:function(entity,options){var self=this;$('#accept-trade-request-button').on('click',function(){var requestedBy=$('#requested-by').text();var acceptedBy=ige.client.myPlayer.id();ige.network.send('trade',{type:'start',requestedBy:requestedBy,acceptedBy:acceptedBy});$('#trade-request-div').hide();ige.tradeUi.startTrading(ige.client.myPlayer,ige.$(requestedBy));});$('#accept-trade-button').on('click',function(){ige.network.send('trade',{type:'accept',acceptedBy:ige.client.myPlayer.id(),acceptedFor:ige.client.myPlayer.tradingWith});});$('.cancel-trade-request-button').on('click',function(){// ige.network.send('trade', { type: 'cancel' });
ige.tradeUi.closeTradeRequest();});$('.cancel-trade-button').on('click',function(){// ige.network.send('trade', { type: 'cancel' });
ige.tradeUi.closeTrading();});},initiateTradeRequest:function(player){var message=`${player._stats.name} wants to trade with you. Trade?`;$('#requested-by').text(player.id());$('#trade-request-message').text(message);$('#trade-request-div').show();},clearOfferSlots:function(){var offerSlots=$('#offer-trading-slots');offerSlots.html('');var i=1;while(i<6){offerSlots.append($('<div/>',{id:`offer-${i}`,class:'btn btn-light trade-offer-slot'}));i++;}},startTrading:function(playerA,playerB){if(playerA!==ige.client.myPlayer){$('#trader-name').text(playerA._stats.name);}else if(playerB!==ige.client.myPlayer){$('#trader-name').text(playerB._stats.name);}playerA.tradingWith=playerB.id();playerB.tradingWith=playerA.id();playerA.isTrading=true;playerB.isTrading=true;this.clearOfferSlots();$('#trade-div').show();},sendOfferingItems:function(){var selectedUnit=ige.client.myPlayer.getSelectedUnit();var totalInventorySlot=selectedUnit.inventory.getTotalInventorySize();var tradeItems=[];var id=0;for(var i=totalInventorySlot;i<totalInventorySlot+5;i++){tradeItems[id++]=selectedUnit._stats.itemIds[i];}ige.network.send('trade',{type:'offer',from:ige.client.myPlayer.id(),to:ige.client.myPlayer.tradingWith,tradeItems:tradeItems});},receiveOfferingItems:function(tradeItems){for(var i=0;i<tradeItems.length;i++){var index=i+1;var itemId=tradeItems[i];var item=ige.$(itemId);$(`#offer-${index}`).html('');if(itemId&&item&&item._category==='item'){var itemDiv=ige.itemUi.getItemDiv(item,{isDraggable:false,popover:'top',isTrading:true});$(`#offer-${index}`).html(itemDiv);}}},closeTradeRequest:function(){$('#trade-request-div').hide();},closeTrading:function(){var playerA=ige.client.myPlayer;var playerB=ige.$(ige.client.myPlayer.tradingWith);ige.network.send('trade',{type:'cancel',cancleBy:playerA.id(),cancleTo:playerB.id()});delete playerA.tradingWith;delete playerB.tradingWith;delete playerA.isTrading;delete playerB.isTrading;$('#trade-div').hide();}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=TradeUiComponent;};var MiniMapComponent=$i_56.extend({classId:'MiniMapComponent',componentId:'miniMap',init:function(){var self=this;self.mapScale={x:0.05,y:0.05};self.miniMap=null;self.maxMapDimension={height:200,width:200};self.units={};},createMiniMap:function(){var self=this;// var texture = ige.pixi.app.renderer.generateTexture(ige.pixi.world);
// self.miniMap = new PIXI.Sprite(texture);
let layerZIndex=['floor','floor2','walls','trees'];self.miniMap=new PIXI.Container();self.miniMap.zIndex=5;layerZIndex.forEach(function(layerKey){self.miniMap.addChild(new PIXI.Sprite(ige.pixiMap.layersTexture[layerKey]));});ige.pixi.app.stage.addChild(self.miniMap);},updateMiniMap:function(){var self=this;if(ige.game){var worldWidth=ige.game.data.map.width*ige.map.data.tilewidth;var worldHeight=ige.game.data.map.height*ige.map.data.tileheight;if(ige.mobileControls.isMobile){self.maxMapDimension.width=50;self.maxMapDimension.height=50;}else{if(ige.client.resolutionQuality==='low'){self.maxMapDimension.width=100;self.maxMapDimension.height=100;}else{self.maxMapDimension.width=200;self.maxMapDimension.height=200;}}self.mapScale.x=parseFloat(self.maxMapDimension.width/worldWidth);self.mapScale.y=parseFloat(self.maxMapDimension.height/worldHeight);if(self.miniMap){self.miniMap.scale.set(self.mapScale.x,self.mapScale.y);self.miniMap.width=worldWidth*self.mapScale.x;self.miniMap.height=worldHeight*self.mapScale.y;self.miniMap.pivot.x=self.miniMap.width/2;self.miniMap.pivot.y=self.miniMap.height/2;self.miniMap.x=5;self.miniMap.y=window.innerHeight-self.miniMap.height;}}},createUnit:function(id){var self=this;self.units[id]=new MiniMapUnit();},translateTo:function(id,x,y,z){var self=this;if(self.units[id]){self.units[id].translateTo(x,y,z);}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=MiniMapComponent;};var ScriptComponent=$i_56.extend({classId:'ScriptComponent',componentId:'script',init:function(){var self=this;// self.logStr = "";
self.entryCount=0;self.showLog=false;self.errorLogs={};self.currentScript=undefined;self.currentActionName='';self.scriptCache={};self.scriptTime={};self.scriptRuns={};self.last50Actions=[];ScriptComponent.prototype.log('initializing Script Component');},runScript:function(scriptId,localVariables){// console.log("running script", scriptId)
var timings=false;if(timings)var started=new Date();var self=this;self.currentScriptId=scriptId;if(ige.game.data.scripts[scriptId]){// var actions = JSON.parse(JSON.stringify(ige.game.data.scripts[scriptId].actions));
var actions=self.getScriptActions(scriptId,timings);if(actions){var cmd=ige.action.run(actions,localVariables);if(cmd=='return'){ige.log('script return called');return;}}}if(timings){var now=new Date();var elapsed=now-started;self.scriptRuns[scriptId]=self.scriptRuns[scriptId]||0;self.scriptRuns[scriptId]++;self.scriptTime[scriptId]=self.scriptTime[scriptId]||0;if(self.scriptRuns[scriptId]>1){self.scriptTime[scriptId]+=elapsed;var avg=self.scriptTime[scriptId]/(self.scriptRuns[scriptId]-1);if(self.scriptRuns[scriptId]%100==0){console.log(`runScript: ${scriptId} ${ige.game.data.scripts[scriptId].name} [${avg} ms avg in ${self.scriptRuns[scriptId]}x]`);}}}},getScriptActions:function(scriptId,timings){var self=this;if(self.scriptCache[scriptId]&&(typeof mode==='undefined'||typeof mode==='string'&&mode!='sandbox')){return self.scriptCache[scriptId];}else{var script=ige.game.data.scripts[scriptId];if(!script.actions)return null;if(script){if(timings){var started=new Date();for(var i=0;i<1000;i++){self.scriptCache[scriptId]=JSON.parse(JSON.stringify(script.actions));}var now=new Date();var elapsed=(now-started)/1000;console.log(`parse time: ${elapsed} ms ${script.name}`);console.log('*************************************');console.log(script.actions);}else{self.scriptCache[scriptId]=JSON.parse(JSON.stringify(script.actions));}return self.scriptCache[scriptId];}}return null;},scriptLog:function(str,tabCount){if(this.entryCount>50000)return;this.entryCount++;tabs='';for(i=0;i<tabCount;i++){tabs+='    ';}// if (ige.server.isScriptLogOn)
// console.log(tabs+str)
// this.logStr = this.logStr  + tabs + str
// if (this.entryCount > 50000)
// {
// 	var filename = "logs/"+ige.server.serverId+"script.log"
// 	fs.writeFile(filename, this.logStr, function(err) {
// 	    if(err) {
// 	        return ScriptComponent.prototype.log(err);
// 	    }
// 	});
// 	ScriptComponent.prototype.log("file saved: ", filename)
// 	this.logStr = ""
// 	// this.entryCount = 0
// }
},recordLast50Action:function(action){var self=this;if(self.last50Actions.length>50){self.last50Actions.shift();}var scriptName='[scriptName undefined]';if(ige.game.data.scripts[this.currentScriptId]){scriptName=ige.game.data.scripts[this.currentScriptId].name;}var record=`script '${scriptName}' in Action '${action}'`;self.last50Actions.push(record);},errorLog:function(message){var script=ige.game.data.scripts[this.currentScriptId];var log=`Script error '${script?script.name:''}' in Action '${this.currentActionName}' : ${message}`;this.errorLogs[this.currentActionName]=log;ige.devLog('script errorLog',log,message);ScriptComponent.prototype.log(log);return log;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ScriptComponent;};var VariableComponent=$i_56.extend({classId:'VariableComponent',componentId:'variable',init:function(entity,options){var self=this;self.devLogs={};self.secondCount=0;self.updateStatusSecond=5;self.streamingWarningShown=false;self.prevServerTime=0;self.prevClientTime=0;},roundOff:function(num,precision){return Number(`${Math.round(`${num}e${precision}`)}e-${precision}`);},getRandomPositionInRegion:function(region){if(region&&region._stats&&region._stats.default){region=region._stats.default;}var randomX=Math.floor(Math.random()*(region.x+region.width-region.x)+region.x);var randomY=Math.floor(Math.random()*(region.y+region.height-region.y)+region.y);var position={x:0,y:0};if(!isNaN(randomX)||!isNaN(randomY)){position.x=randomX;position.y=randomY;}return position;},isPositionInWall:function(position){var wallLayer=null;for(var i=0;i<ige.map.data.layers.length;i++){var layer=ige.map.data.layers[i];if(layer.name==='walls'){wallLayer=layer;break;}}if(!wallLayer||!position.x||isNaN(position.x)||!position.y||isNaN(position.y)){return false;}var worldWidth=ige.map.data.width;var tileWidth=ige.scaleMapDetails.tileWidth||ige.game.data.map.tilewidth;var tileHeight=ige.scaleMapDetails.tileHeight||ige.game.data.map.tilewidth;var tile={x:Math.floor(position.x/tileWidth),y:Math.floor(position.y/tileHeight)};var tileIndex=tile.x+tile.y*worldWidth;return!!(wallLayer&&wallLayer.data[tileIndex]);},isPositionInEntity:function(position){var entityCategory=['unit','debris'];var defaultArea={height:100,width:100};var entities=ige.physics.getBodiesInRegion({x:position.x,y:position.y,width:defaultArea.width,height:defaultArea.height});var returnValue=_.some(entities,function(entity){return entityCategory.indexOf(entity._category)>-1;});return returnValue;},getValue:function(text,vars){var self=this;var arr=[];var returnValue=undefined;// just return raw numbers
if(typeof text==='number'){returnValue=parseFloat(text);}// if boolean, string, undefined, etc... return.
if(typeof text!=='object'){returnValue=text;}else if(text&&text.function==undefined&&text.x!=undefined&&text.y!=undefined)// if point! (x, y)
{returnValue={x:self.getValue(text.x,vars),y:self.getValue(text.y,vars)};}else if(text==undefined){returnValue=undefined;}if(typeof text==='object'){var entity=self.getValue(text.entity,vars);switch(text.function){/* boolean */case'playersAreHostile':var playerA=self.getValue(text.playerA,vars);var playerB=self.getValue(text.playerB,vars);if(playerA&&playerB){returnValue=playerA.isHostileTo(playerB);}break;case'playersAreFriendly':var playerA=self.getValue(text.playerA,vars);var playerB=self.getValue(text.playerB,vars);if(playerA&&playerB){returnValue=playerA.isFriendlyTo(playerB);}break;case'playersAreNeutral':var playerA=self.getValue(text.playerA,vars);var playerB=self.getValue(text.playerB,vars);if(playerA&&playerB){returnValue=playerA.isNeutralTo(playerB);}break;case'unitIsInRegion':var region=self.getValue(text.region,vars);var unit=self.getValue(text.unit,vars);returnValue=false;if(region&&unit){// if region is an instance of IgeRegion component
if(region._stats){var entitiesInRegion=ige.regionManager.entitiesInRegion&&ige.regionManager.entitiesInRegion[region._stats.id];if(entitiesInRegion){returnValue=!!entitiesInRegion[unit.id()];}}else{// region is either dynamic or a variable with {x, y, height, width} properties
returnValue=ige.physics.getBodiesInRegion(region).filter(function(entity){return entity.id()===unit.id();}).length;returnValue=!!returnValue;}}break;case'isPositionInWall':var positionX=self.getValue(text.position.x,vars);var positionY=self.getValue(text.position.y,vars);returnValue=self.isPositionInWall({x:positionX,y:positionY});break;case'regionOverlapsWithRegion':var regionA=self.getValue(text.regionA,vars);var regionB=self.getValue(text.regionB,vars);if(!regionA||!regionB){returnValue=false;break;}if(regionA._category=='region'){regionA=regionA.getBounds();}if(regionB._category=='region'){regionB=regionB.getBounds();}if(regionA&&regionB){regionA=new $i_7(regionA.x,regionA.y,regionA.width,regionA.height);regionB=new $i_7(regionB.x,regionB.y,regionB.width,regionB.height);returnValue=regionA.intersects(regionB);}break;case'itemIsInRegion':var region=self.getValue(text.region,vars);var item=self.getValue(text.item,vars);returnValue=false;returnValue=false;if(region&&item){// if region is an instance of IgeRegion component
if(region._stats){var entitiesInRegion=ige.regionManager.entitiesInRegion&&ige.regionManager.entitiesInRegion[region._stats.id];if(entitiesInRegion){returnValue=!!entitiesInRegion[item.id()];}}else{// region is either dynamic or a variable with {x, y, height, width} properties
returnValue=ige.physics.getBodiesInRegion(region).filter(function(entity){return entity.id()===item.id();}).length;returnValue=!!returnValue;}}break;case'playerIsControlledByHuman':var player=self.getValue(text.player,vars);returnValue=player&&player._stats.controlledBy=='human';break;case'isPlayerLoggedIn':var player=self.getValue(text.player,vars);returnValue=!!(player&&player._stats.userId);break;case'playerHasAdblockEnabled':var player=self.getValue(text.player,vars);returnValue=!!(player&&player._stats.isAdBlockEnabled);break;case'areEntitiesTouching':var sourceEntity=self.getValue(text.sourceEntity,vars);var targetEntity=self.getValue(text.targetEntity,vars);var sourceContactEntities=Object.keys(sourceEntity.bodiesInContact||{});returnValue=sourceContactEntities.includes(targetEntity.id());break;case'subString':var sourceString=self.getValue(text.sourceString,vars);var patternString=self.getValue(text.patternString,vars);if(sourceString&&patternString&&typeof sourceString=='string'&&typeof patternString=='string'){returnValue=sourceString.includes(patternString);}break;case'getPlayerAttribute':if(entity&&entity._category=='player'){var attributeTypeId=self.getValue(text.attribute,vars);if(entity._stats.attributes&&entity._stats.attributes[attributeTypeId]){returnValue=entity._stats.attributes[attributeTypeId].value;}}break;case'playerAttributeMax':var attributeTypeId=self.getValue(text.attribute,vars);if(entity&&attributeTypeId){var attributeType=entity._stats.attributes[attributeTypeId];if(attributeType){returnValue=attributeType.max;}}break;case'playerAttributeMin':var attributeTypeId=self.getValue(text.attribute,vars);if(entity&&attributeTypeId){var attributeType=entity._stats.attributes[attributeTypeId];if(attributeType){returnValue=attributeType.min;}}break;case'getPlayerName':if(entity&&entity._category=='player'){returnValue=entity._stats.name;}break;case'getPlayerVariable':// console.log('text.variable', text.variable);
returnValue=text.variable;break;case'getValueOfPlayerVariable':var variableData=self.getValue(text.variable,vars);var player=self.getValue(text.player,vars);if(player&&variableData){var playerVariable=player.variables&&player.variables[variableData.key]&&player.variables[variableData.key];if(playerVariable){returnValue=playerVariable.value;if(returnValue===null||returnValue==undefined){returnValue=playerVariable.default;}}}break;case'playerTypeOfPlayer':var player=self.getValue(text.player,vars);if(player&&player._category=='player'){returnValue=player._stats.playerTypeId;}break;case'playerCustomInput':var player=self.getValue(text.player,vars);if(player&&player._category=='player'){returnValue=player.lastCustomInput;}break;case'lastPlayerMessage':var player=self.getValue(text.player,vars);if(player&&player._category=='player'){returnValue=player.lastMessageSent;}break;case'entityExists':returnValue=!!(entity&&entity._id&&ige.$(entity._id));break;case'getTriggeringPlayer':if(vars&&vars.triggeredBy&&vars.triggeredBy.playerId){var id=vars.triggeredBy.playerId;returnValue=ige.$(id);}break;case'getTriggeringUnit':if(vars&&vars.triggeredBy&&vars.triggeredBy.unitId){var id=vars.triggeredBy.unitId;returnValue=ige.$(id);}break;case'getTriggeringDebris':if(vars&&vars.triggeredBy&&vars.triggeredBy.debrisId){var debris=ige.$(vars.triggeredBy.debrisId);if(debris){returnValue=debris;}}break;case'getTriggeringRegion':if(vars&&vars.triggeredBy&&vars.triggeredBy.region){returnValue=vars.triggeredBy.region;}break;case'getTriggeringProjectile':if(vars&&vars.triggeredBy&&vars.triggeredBy.projectileId){var id=vars.triggeredBy.projectileId;returnValue=ige.$(id);}break;case'getTriggeringItem':if(vars&&vars.triggeredBy&&vars.triggeredBy.itemId){var id=vars.triggeredBy.itemId;returnValue=ige.$(id);}break;case'getTriggeringSensor':if(vars&&vars.triggeredBy&&vars.triggeredBy.sensorId){var id=vars.triggeredBy.sensorId;returnValue=ige.$(id);}break;case'getTriggeringAttribute':if(vars&&vars.triggeredBy&&vars.triggeredBy.attribute){return vars.triggeredBy.attribute;}break;case'getPlayerFromId':var id=self.getValue(text.string,vars);if(id){returnValue=ige.$(id);}break;case'getUnitFromId':var id=self.getValue(text.string,vars);if(id){returnValue=ige.$(id);}break;case'getAttributeTypeOfAttribute':if(entity){returnValue=entity.type;}break;case'getEntityAttribute':var attributeTypeId=self.getValue(text.attribute,vars);if(entity&&ige.action.entityCategories.indexOf(entity._category)!==-1&&attributeTypeId){var attributeType=entity._stats.attributes&&entity._stats.attributes[attributeTypeId];if(attributeType){var value=parseFloat(attributeType.value);returnValue=self.getValue(value,vars);}else{// ige.script.errorLog("attribute "+ attributeTypeId +" doesn't exist in unit "+((unit._stats)?unit._stats.name:''))
}}break;case'entityAttributeMax':var attributeTypeId=self.getValue(text.attribute,vars);if(entity&&entity._stats.attributes&&ige.action.entityCategories.indexOf(entity._category)>-1&&attributeTypeId){var attributeType=entity._stats.attributes[attributeTypeId];if(attributeType){returnValue=attributeType.max;}}break;case'entityAttributeMin':var attributeTypeId=self.getValue(text.attribute,vars);if(entity&&entity._stats.attributes&&ige.action.entityCategories.indexOf(entity._category)>-1&&attributeTypeId){var attributeType=entity._stats.attributes[attributeTypeId];if(attributeType){returnValue=attributeType.min;}}break;case'getItemQuantity':var item=self.getValue(text.item,vars);if(item&&item._category=='item'){// returnValue = item._stats.quantity || 1; // this was causing the bug where item with infinite (null) quantity was only being used once. we shouldn't be overwriting null value with 1 - Jaeyun sept 8, 2018
returnValue=item._stats.quantity;}break;case'getItemMaxQuantity':var item=self.getValue(text.item,vars);if(item&&item._category=='item'){returnValue=item._stats.maxQuantity;}break;case'getQuantityOfItemTypeInItemTypeGroup':if(text.itemTypeGroup&&text.itemType){var variableObj=self.getVariable(text.itemTypeGroup.variableName);var itemType=self.getValue(text.itemType,vars);console.log(text.itemType,itemType,variableObj);if(variableObj&&variableObj[itemType]){returnValue=variableObj[itemType].quantity;}}break;case'getQuantityOfUnitTypeInUnitTypeGroup':if(text.unitTypeGroup&&text.unitType){var variableObj=self.getVariable(text.unitTypeGroup.variableName);var unitType=self.getValue(text.unitType,vars);if(variableObj&&variableObj[unitType]){returnValue=variableObj[unitType].quantity;}}break;case'dynamicRegion':var x=self.getValue(text.x,vars);var y=self.getValue(text.y,vars);var width=self.getValue(text.width,vars);var height=self.getValue(text.height,vars);returnValue={x:x,y:y,width:width,height:height};break;case'entityBounds':if(entity&&ige.action.entityCategories.indexOf(entity._category)>-1){// for sprite-only items that are carried by units
returnValue=entity.getBounds();}break;case'getProjectileAttribute':var attributeTypeId=self.getValue(text.attribute,vars);var projectile=entity;if(projectile&&projectile._category=='projectile'&&attributeTypeId){var attributeType=projectile._stats.attributes[attributeTypeId];if(attributeType){var value=parseFloat(attributeType.value);returnValue=self.getValue(value,vars);}else{// ige.script.errorLog("attribute "+ attributeTypeId +" doesn't exist in unit "+((unit._stats)?unit._stats.name:''))
}}break;case'unitsFacingAngle':var unit=self.getValue(text.unit,vars);if(unit&&unit._category=='unit'){returnValue=unit._rotate&&unit._rotate.z;returnValue=returnValue!=undefined?self.roundOff(returnValue,3):undefined;}break;case'getUnitBody':var unit=self.getValue(text.unit,vars);if(unit&&unit._category=='unit'){returnValue=unit.body;}break;case'toFixed':var num=self.getValue(text.value,vars);var precision=self.getValue(text.precision,vars);// toFixed() returns a string, so we have to parseFloat again
returnValue=parseFloat(parseFloat(num).toFixed(precision));// nishant's code
// num = typeof num === 'number' ? num : undefined;
// precision = typeof precision === 'number' && precision > 0 ? precision : undefined;
// returnValue = num && precision ? self.roundOff(num, precision) : undefined;
break;case'absoluteValueOfNumber':var num=self.getValue(text.number,vars);returnValue=Math.abs(num);break;case'arctan':var angle=self.getValue(text.number,vars);if(angle!==undefined){returnValue=Math.atan(angle);}break;case'sin':var angle=self.getValue(text.angle,vars);if(angle!==undefined){returnValue=Math.sin(angle);}break;case'cos':var angle=self.getValue(text.angle,vars);if(angle!==undefined){returnValue=Math.cos(angle);}break;case'stringToNumber':var value=self.getValue(text.value,vars);var parsedValue=parseFloat(value);if(parsedValue&&!isNaN(parsedValue)){returnValue=parsedValue;}break;case'getEntityVelocityX':if(entity&&entity.body){var velocity=entity.body.m_linearVelocity&&entity.body.m_linearVelocity.x;velocity=velocity&&velocity.toFixed(2)||0;returnValue=parseFloat(velocity);}break;case'getEntityVelocityY':if(entity&&entity.body){var velocity=entity.body.m_linearVelocity&&entity.body.m_linearVelocity.y;velocity=velocity&&velocity.toFixed(2)||0;returnValue=parseFloat(velocity);}break;case'getOwner':if(entity&&entity._category=='unit'){returnValue=entity.getOwner();}break;case'selectedPlayer':case'getSelectedPlayer':if(vars&&vars.selectedPlayer){return vars.selectedPlayer;}break;case'selectedUnit':case'getSelectedUnit':if(vars&&vars.selectedUnit){return vars.selectedUnit;}break;case'selectedItem':case'getSelectedItem':if(vars&&vars.selectedItem){return vars.selectedItem;}break;case'selectedProjectile':case'getSelectedProjectile':if(vars&&vars.selectedProjectile){return vars.selectedProjectile;}break;case'selectedDebris':case'getSelectedDebris':if(vars&&vars.selectedDebris){return vars.selectedDebris;}break;case'selectedEntity':case'getSelectedEntity':if(vars&&vars.selectedEntity){return vars.selectedEntity;}break;case'selectedRegion':if(vars&&vars.selectedRegion){return vars.selectedRegion;}break;case'selectedItemType':if(vars&&vars.selectedItemType){return vars.selectedItemType;}break;case'selectedUnitType':if(vars&&vars.selectedUnitType){return vars.selectedUnitType;}break;case'getLastPurchasedUnit':var id=ige.game.lastPurchasedUnitId;unit=ige.$(id);if(unit&&unit._category=='unit'){return unit;}break;case'getLastTouchingUnit':var id=ige.game.lastTouchingUnitId;unit=ige.$(id);if(unit&&unit._category=='unit'){return unit;}break;case'getLastAttackingUnit':var id=ige.game.lastAttackingUnitId;unit=ige.$(id);if(unit&&unit._category=='unit'){return unit;}break;case'getLastAttackedUnit':var id=ige.game.lastAttackedUnitId;unit=ige.$(id);if(unit&&unit._category=='unit'){return unit;}break;case'getLastTouchedUnit':var id=ige.game.lastTouchedUnitId;unit=ige.$(id);if(unit&&unit._category=='unit'){returnValue=unit;}break;case'getLastTouchedDebris':var id=ige.game.lastTouchedDebrisId;debris=ige.$(id);if(debris&&debris._category=='debris'){returnValue=debris;}break;case'getLastTouchedItem':var id=ige.game.lastTouchedItemId;returnValue=ige.$(id);break;case'getLastAttackingItem':var id=ige.game.lastAttackingItemId;item=ige.$(id);if(item&&item._category=='item'){returnValue=item;}break;case'lastUsedItem':case'getLastUsedItem':// will be deprecated soon
var id=ige.game.lastUsedItemId;item=ige.$(id);if(item&&item._category=='item'){returnValue=item;}break;case'getLastTouchedProjectile':var id=ige.game.lastTouchedProjectileId;projectile=ige.$(id);if(projectile&&projectile._category=='projectile'){returnValue=projectile;}break;case'getSourceItemOfProjectile':if(entity&&entity._category=='projectile'){var item=entity.getSourceItem();if(item){returnValue=item;}}break;case'getSourceUnitOfProjectile':if(entity&&entity._category=='projectile'){var sourceUnitId=entity._stats.sourceUnitId;unit=ige.$(sourceUnitId);if(unit&&unit._category=='unit'){returnValue=unit;}}break;case'getOwnerOfItem':if(entity&&entity._category=='item'){var owner=entity.getOwnerUnit();if(owner){returnValue=owner;}}break;case'getItemAtSlot':var unit=self.getValue(text.unit,vars);var slotIndex=self.getValue(text.slot,vars);if(unit&&unit._category=='unit'){var item=unit.inventory.getItemBySlotNumber(slotIndex);if(item){returnValue=item;}}break;case'getItemBody':var item=self.getValue(text.item,vars);if(item&&item._category=='item'){returnValue=item.body;}break;case'lastCreatedItem':var id=ige.game.lastCreatedItemId;returnValue=ige.$(id);break;case'ownerUnitOfSensor':var sensor=self.getValue(text.sensor,vars);if(sensor&&sensor._category=='sensor'){returnValue=ige.$(sensor.ownerUnitId);}break;case'getLastCreatedProjectile':var id=ige.game.lastCreatedProjectileId;returnValue=ige.$(id);break;case'getProjectileBody':var projectile=self.getValue(text.projectile,vars);if(projectile&&projectile._category=='projectile'){returnValue=projectile.body;}break;case'getLastCreatedUnit':var id=ige.game.lastCreatedUnitId;returnValue=ige.$(id);break;case'getLastPlayerSelectingDialogueOption':var id=ige.game.lastPlayerSelectingDialogueOption;returnValue=ige.$(id);break;case'getLastCastingUnit':var id=ige.game.lastCastingUnitId;var unit=ige.$(id);if(unit&&unit._category=='unit'){returnValue=unit;}break;case'getLastCreatedItem':var id=ige.game.lastCreatedItemId;returnValue=ige.$(id);break;case'getItemCurrentlyHeldByUnit':if(entity&&entity._category=='unit'){returnValue=entity.getCurrentItem();}break;case'getSensorOfUnit':var unit=self.getValue(text.unit,vars);if(unit&&unit._category=='unit'){returnValue=unit.sensor;}break;case'getLastChatMessageSentByPlayer':returnValue=ige.game.lastChatMessageSentByPlayer;break;// doesn't work yet
case'getItemInInventorySlot':var slotIndex=self.getValue(text.slot,vars);if(entity&&entity._category=='unit'){var item=entity.inventory.getItemBySlotNumber(slotIndex);if(item){returnValue=item;}}break;case'allItemsDroppedOnGround':returnValue=ige.$$('item').filter(function(item){return!item.getOwnerUnit();});break;case'allItemsOwnedByUnit':var unit=self.getValue(text.entity,vars);if(unit&&unit._category=='unit'){returnValue=ige.$$('item').filter(function(item){return item._stats.ownerUnitId==unit.id();});}break;// case 'getUnitInFrontOfUnit':
// 	if (entity && entity._category == 'unit') {
// 		var entities = ige.physics.getBodiesInRegion({
// 			x: entity._translate.x - 7 + (35 * Math.cos(entity._rotate.z + Math.radians(-90))),
// 			y: entity._translate.y - 7 + (35 * Math.sin(entity._rotate.z + Math.radians(-90))),
// 			width: 14,
// 			height: 14
// 		},
// 			entity.id()
// 		)
// 		for (i = 0; i < entities.length; i++) {
// 			var entity = entities[i]
// 			if (entity && entity._category == 'unit') {
// 				return entity;
// 			}
// 		}
// 	}
// 	break;
case'calculate':returnValue=self.calculate(text.items,vars);break;case'squareRoot':var numberValue=self.getValue(text.number,vars);if(!isNaN(numberValue)){returnValue=Math.sqrt(numberValue);}break;case'getPlayerCount':returnValue=ige.$$('player').filter(function(player){return player._stats.controlledBy=='human'&&player._stats.playerJoined==true;}).length;break;case'getNumberOfItemsPresent':returnValue=ige.$$('item').length;break;case'getUnitCount':returnValue=ige.$$('unit').length;break;case'getNumberOfUnitsOfUnitType':var unitType=self.getValue(text.unitType,vars);var units=ige.$$('unit').filter(unit=>{return unit._stats.type===unitType;});returnValue=units.length;break;case'getNumberOfPlayersOfPlayerType':var playerType=self.getValue(text.playerType,vars);var players=ige.$$('player').filter(player=>{return player._stats.playerTypeId===playerType;});returnValue=players.length;break;case'getRandomNumberBetween':var min=parseFloat(self.getValue(text.min,vars));var max=parseFloat(self.getValue(text.max,vars));var randomNumber=Math.floor(Math.random()*(max-min+1)+min);returnValue=randomNumber;break;case'getMapHeight':var worldHeight=ige.map.data.height;var tileHeight=ige.game.data.map.tileheight;returnValue=tileHeight*worldHeight;break;case'getMapWidth':var worldWidth=ige.map.data.width;var tileWidth=64||ige.game.data.map.tilewidth;returnValue=tileWidth*worldWidth;break;case'entityWidth':if(entity&&ige.action.entityCategories.indexOf(entity._category)>-1){// returnValue = entity._aabb.width;
returnValue=entity.width();// console.log("entityWidth", returnValue);
}break;case'entityHeight':if(entity&&ige.action.entityCategories.indexOf(entity._category)>-1){// returnValue = entity._aabb.height;
returnValue=entity.height();}break;case'defaultQuantityOfItemType':var itemTypeId=self.getValue(text.itemType,vars);var itemType=ige.game.getAsset('itemTypes',itemTypeId);if(itemType){returnValue=itemType.quantity;}break;case'maxValueOfItemType':var itemTypeId=self.getValue(text.itemType,vars);var itemType=ige.game.getAsset('itemTypes',itemTypeId);if(itemType){returnValue=itemType.maxQuantity;}else{returnValue=0;}break;case'allItemTypesInGame':var itemTypesObject=ige.game.data.itemTypes;if(itemTypesObject){returnValue=itemTypesObject;}break;case'allUnitTypesInGame':var unitTypesObject=ige.game.data.unitTypes;if(unitTypesObject){returnValue=unitTypesObject;}break;case'lastPlayedTimeOfPlayer':var player=self.getValue(text.player,vars);// console.log(player);
returnValue=player&&player._stats.lastPlayed;break;case'currentTimeStamp':returnValue=Date.now();break;case'getRandomPositionInRegion':var region=self.getValue(text.region,vars);if(region){returnValue=self.getRandomPositionInRegion(region);}break;case'nameOfUnit':var unit=self.getValue(text.unit,vars);if(unit){returnValue=unit._stats&&unit._stats.name;}break;case'nameOfRegion':var region=self.getValue(text.region,vars);if(region){returnValue=region._stats?region._stats.id:region.key;}break;case'centerOfRegion':var region=self.getValue(text.region,vars);if(region){returnValue={x:region._stats.default.x+region._stats.default.width/2,y:region._stats.default.y+region._stats.default.height/2};}break;case'getRandomPlayablePositionInRegion':var region=self.getValue(text.region,vars);var attempts=20;if(region){for(var i=0;i<attempts;i++){var position=self.getRandomPositionInRegion(region);var isPlayablePosition=!self.isPositionInEntity(position)&&!self.isPositionInWall(position);if(isPlayablePosition){returnValue={x:position.x,y:position.y};break;}}if(!returnValue){ige.script.errorLog(`could not find valid position even after${attempts} attempts`);}}break;case'mathFloor':var value=self.getValue(text.value,vars);if(!isNaN(value))return Math.floor(value);break;case'getEntireMapRegion':var region={x:ige.map.data.tilewidth*2,y:ige.map.data.tileheight*2,width:ige.map.data.width*ige.map.data.tilewidth-ige.map.data.tilewidth*2,height:ige.map.data.height*ige.map.data.tileheight-ige.map.data.tileheight*2};returnValue={_stats:{default:region}};break;case'stringContains':var str=self.getValue(text.string,vars);var keyword=self.getValue(text.keyword,vars);if(str!=undefined&&str.indexOf(keyword)>-1){returnValue=true;}returnValue=false;break;case'getEntityPosition':entity=self.getValue(text.entity,vars);if(entity){if(entity._category==='item'&&entity._stats&&entity._stats.currentBody&&entity._stats.currentBody.type==='spriteOnly'){var ownerUnit=entity.getOwnerUnit();var unitPosition=_.cloneDeep(ownerUnit._translate);unitPosition.x=ownerUnit._translate.x+entity._stats.currentBody.unitAnchor.y*Math.cos(ownerUnit._rotate.z+Math.radians(-90))+entity._stats.currentBody.unitAnchor.x*Math.cos(ownerUnit._rotate.z);unitPosition.y=ownerUnit._translate.y+entity._stats.currentBody.unitAnchor.y*Math.sin(ownerUnit._rotate.z+Math.radians(-90))+entity._stats.currentBody.unitAnchor.x*Math.sin(ownerUnit._rotate.z);returnValue=JSON.parse(JSON.stringify(unitPosition));}else{if(entity.x!=undefined&&entity.y!=undefined){returnValue=JSON.parse(JSON.stringify(entity));}else if(entity._translate){returnValue=_.cloneDeep(entity._translate);}else{returnValue={x:0,y:0};}}}break;case'getPositionX':var position=self.getValue(text.position,vars);if(position){returnValue=position.x;}break;case'angleBetweenMouseAndWindowCenter':var player=ige.variable.getValue(text.player,vars);if(player){returnValue=player.absoluteAngle||0;}break;case'getPositionY':var position=self.getValue(text.position,vars);if(position){returnValue=position.y;}break;case'entitiesCollidingWithLastRaycast':{returnValue=ige.game.entitiesCollidingWithLastRaycast;break;}case'entityLastRaycastCollisionPosition':var entity=self.getValue(text.entity,vars);if(entity){returnValue=entity.lastRaycastCollisionPosition;}break;case'getMouseCursorPosition':var player=self.getValue(text.player,vars);if(player&&player._category=='player'&&player.control){if(player.control.input.mouse.x!=undefined&&player.control.input.mouse.y!=undefined&&!isNaN(player.control.input.mouse.x)&&!isNaN(player.control.input.mouse.y))returnValue={x:parseInt(player.control.input.mouse.x),y:parseInt(player.control.input.mouse.y)};}break;case'xyCoordinate':var x=self.getValue(text.x,vars);var y=self.getValue(text.y,vars);if(x!=undefined&&y!=undefined){returnValue={x:x,y:y};}break;case'distanceBetweenPositions':var positionA=self.getValue(text.positionA,vars);var positionB=self.getValue(text.positionB,vars);if(positionA&&positionB){var a=positionA.x-positionB.x;var b=positionA.y-positionB.y;returnValue=Math.sqrt(a*a+b*b);}break;case'angleBetweenPositions':var positionA=self.getValue(text.positionA,vars);var positionB=self.getValue(text.positionB,vars);if(positionA!=undefined&&positionB!=undefined&&(positionB.y-positionA.y!=0||positionB.x-positionA.x!=0)// two positions should be different
){returnValue=Math.atan2(positionB.y-positionA.y,positionB.x-positionA.x);returnValue+=Math.radians(90);}break;case'getUnitType':returnValue=self.getValue(text.unitType,vars);break;case'getUnitTypeName':var unitTypeId=self.getValue(text.unitType,vars);var unitType=ige.game.getAsset('unitTypes',unitTypeId);if(unitType){returnValue=unitType.name;}break;case'getItemTypeName':var itemTypeId=self.getValue(text.itemType,vars);var itemType=ige.game.getAsset('itemTypes',itemTypeId);if(itemType){returnValue=itemType.name;}break;case'getItemName':var item=self.getValue(text.item,vars);if(item){returnValue=item._stats.name;}break;case'getItemDescription':var item=self.getValue(text.item,vars);if(item&&item._category=='item'){returnValue=item._stats.description;}break;case'getItemType':returnValue=self.getValue(text.itemType,vars);break;case'getProjectileType':// get projectile type from env
returnValue=self.getValue(text.projectileType,vars);break;case'getProjectileTypeOfProjectile':// get projectile type of projectile
if(entity&&entity._category=='projectile'){returnValue=entity._stats.type;}else{VariableComponent.prototype.log('entity not defined');}break;case'getAttributeType':returnValue=self.getValue(text.attributeType,vars);break;case'getItemTypeOfItem':if(entity&&entity._stats){returnValue=entity._stats.itemTypeId;}else if(typeof entity=='string'){// if itemTypeOfItem is key of unit
returnValue=entity;}break;case'getRandomItemTypeFromItemTypeGroup':if(text.itemTypeGroup){var variableObj=self.getValue(text.itemTypeGroup);if(variableObj){var itemTypes=_.map(variableObj,(itemTypeInfo,itemType)=>{return{itemType,probability:itemTypeInfo.probability};});var totalProbability=itemTypes.reduce((partialSum,item)=>{return partialSum+item.probability;},0);var randomNumber=_.random(0,totalProbability);var currentHead=0;for(var i=0;i<itemTypes.length;i++){var itemType=itemTypes[i];if(_.inRange(randomNumber,currentHead,currentHead+itemType.probability)){returnValue=itemType.itemType;}currentHead+=itemType.probability;}// select last item type if nothings selected
if(!returnValue){returnValue=itemTypes[itemTypes.length-1].itemType;}}}break;case'getRandomUnitTypeFromUnitTypeGroup':if(text.unitTypeGroup){var variableObj=self.getVariable(text.unitTypeGroup.variableName);if(variableObj){var unitTypes=_.map(variableObj,(unitTypeInfo,unitType)=>{return{unitType,probability:unitTypeInfo.probability};});var totalProbability=unitTypes.reduce((partialSum,unit)=>{return partialSum+unit.probability;},0);var randomNumber=_.random(0,totalProbability);var currentHead=0;for(var i=0;i<unitTypes.length;i++){var unitType=unitTypes[i];console.log(randomNumber,currentHead,currentHead+unitType.probability,_.inRange(randomNumber,currentHead,currentHead+unitType.probability));if(_.inRange(randomNumber,currentHead,currentHead+unitType.probability)){returnValue=unitType.unitType;}currentHead+=unitType.probability;}// select last unit type if nothings selected
if(!returnValue){returnValue=unitTypes[unitTypes.length-1].unitType;}}}break;case'getItemTypeDamage':var itemTypeId=self.getValue(text.itemType,vars);var itemType=ige.game.getAsset('itemTypes',itemTypeId);if(itemType){returnValue=parseFloat(itemType.damage);}else{returnValue=0;}break;case'getItemParticle':var particleTypeId=self.getValue(text.particleType,vars);if(entity&&entity._category=='item'&&particleTypeId){if(entity._stats.particles){var particleType=entity._stats.particles[particleTypeId];// only return particleTypeId if particleType exists in the item
if(particleType){returnValue=particleTypeId;break;}}}break;case'getUnitTypeOfUnit':// var unit = (entity && entity._category == 'unit') ? entity : vars.selectedUnit
var unit=entity;if(unit&&unit._category=='unit'){returnValue=unit._stats.type;}else if(typeof unit=='string'){// if unitTypeOfUnit is key of unit
returnValue=unit;}else{VariableComponent.prototype.log('getUnitTypeOfUnit: entity not defined');}break;case'lastPurchasedUnitTypetId':returnValue=ige.game.lastPurchasedUniTypetId;break;case'getXCoordinateOfRegion':var region=self.getValue(text.region,vars);if(region){returnValue=region._stats.default.x;}else{VariableComponent.prototype.log('getXCoordinateOfRegion: region not defined');}break;case'getYCoordinateOfRegion':var region=self.getValue(text.region,vars);if(region&&region._stats&&region._stats.default){returnValue=region._stats.default.y;}else{VariableComponent.prototype.log('getYCoordinateOfRegion: region not defined');}break;case'getWidthOfRegion':var region=self.getValue(text.region,vars);if(region){returnValue=region._stats.default.width;}else{VariableComponent.prototype.log('getWidthOfRegion: region not defined');}break;case'getHeightOfRegion':var region=self.getValue(text.region,vars);if(region){returnValue=region._stats.default.height;}else{VariableComponent.prototype.log('getHeightOfRegion: region not defined');}break;case'getEntityState':entity=self.getValue(text.entity,vars);var entity=entity&&ige.action.entityCategories.indexOf(entity._category)>-1?entity:vars.selectedEntity;if(entity&&ige.action.entityCategories.indexOf(entity._category)>-1){returnValue=entity._stats.stateId;}else{VariableComponent.prototype.log('getEntityState: entity not defined');}break;case'getRotateSpeed':var unitTypeId=self.getValue(text.unitType,vars);var unitType=ige.game.getAsset('unitTypes',unitTypeId);if(unitType&&unitType.body&&unitType.body.rotationSpeed){returnValue=unitType.body.rotationSpeed;}break;case'getVariable':// below is until parth fixes his bug
returnValue=self.getVariable(text.variableName);break;case'getDebrisVariable':var debrisData=ige.map.getDebrisData(text.debrisId);if(debrisData&&debrisData.igeId){var debris=ige.$(debrisData.igeId);if(debris){return debris;}}break;case'getUnitData':var unit=ige.variable.getValue(text.unit,vars);var data=unit.getPersistentData('unit');if(data){returnValue=JSON.stringify(data);}break;case'getPlayerData':var player=ige.variable.getValue(text.player,vars);var data=player.getPersistentData('player');if(data){returnValue=JSON.stringify(data);}break;case'getPlayerId':var player=ige.variable.getValue(text.player,vars);if(player){returnValue=player.id();}break;case'getUnitId':var unit=ige.variable.getValue(text.unit,vars);if(unit){returnValue=unit.id();}break;case'getLengthOfString':var string=self.getValue(text.string,vars);if(string&&!isNaN(string.length)){returnValue=string.length;}break;case'getStringArrayLength':var string=self.getValue(text.string,vars);if(string){try{var array=JSON.parse(string);}catch(err){console.error(err);}returnValue=array.length;}break;case'getStringArrayElement':var string=self.getValue(text.string,vars);var index=self.getValue(text.number,vars);if(string&&index!=undefined){try{var array=JSON.parse(string);}catch(err){console.error(err);}returnValue=array[index];}break;case'insertStringArrayElement':var string=self.getValue(text.string,vars);var value=self.getValue(text.value,vars);if(string&&value){try{var array=JSON.parse(string);}catch(err){console.error(err);}array.push(value);returnValue=JSON.stringify(array);}break;case'updateStringArrayElement':var string=self.getValue(text.string,vars);var index=self.getValue(text.number,vars);var value=self.getValue(text.value,vars);if(string&&value&&index!=undefined){try{var array=JSON.parse(string);}catch(err){console.error(err);}array[index]=value;returnValue=JSON.stringify(array);}break;case'removeStringArrayElement':var string=self.getValue(text.string,vars);var index=self.getValue(text.number,vars);if(string&&index!=undefined){try{var array=JSON.parse(string);}catch(err){console.error(err);}array.splice(index,1);returnValue=JSON.stringify(array);}break;case'toLowerCase':var string=self.getValue(text.string,vars);if(string&&!isNaN(string.length)){returnValue=string.toLowerCase();}break;case'substringOf':var string=self.getValue(text.string,vars);var fromIndex=self.getValue(text.fromIndex,vars);var toIndex=self.getValue(text.toIndex,vars);if(string&&string.length){// index for game devs is from 1 to n as they might not be familiar with
// string starting from index 0
fromIndex-=1;fromIndex=Math.max(Math.min(fromIndex,string.length),0);toIndex=Math.max(Math.min(toIndex,string.length),0);// This looks like trying to force a start index from [0, +inf], but actually puts it in [-1, +inf]. Why is it subtracted two times? (once before, now the second time here)
returnValue=string.substring(fromIndex-1,toIndex);}else{returnValue='';}break;case'stringStartsWith':var sourceString=self.getValue(text.sourceString,vars);var patternString=self.getValue(text.patternString,vars);if(sourceString&&patternString&&typeof sourceString=='string'&&typeof patternString=='string'){returnValue=sourceString.startsWith(patternString);}break;case'stringEndsWith':var sourceString=self.getValue(text.sourceString,vars);var patternString=self.getValue(text.patternString,vars);if(sourceString&&patternString&&typeof sourceString=='string'&&typeof patternString=='string'){returnValue=sourceString.endsWith(patternString);}break;case'replaceValuesInString':var sourceString=self.getValue(text.sourceString,vars);var matchString=self.getValue(text.matchString,vars);var newString=self.getValue(text.newString,vars);if(sourceString&&matchString&&newString&&typeof sourceString=='string'&&typeof matchString=='string'&&typeof newString=='string'){returnValue=sourceString.split(matchString).join(newString);}break;case'concat':var stringA=self.getValue(text.textA,vars);var stringB=self.getValue(text.textB,vars);// isNaN('') is true
if(typeof stringA==='string'&&stringA.length&&!isNaN(stringA)){stringA=parseFloat(stringA).toFixed(0);}if(typeof stringB==='string'&&stringB.length&&!isNaN(stringB)){stringB=parseFloat(stringB).toFixed(0);}returnValue=`${stringA}${stringB}`;break;case'getMin':var num1=self.getValue(text.num1,vars);var num2=self.getValue(text.num2,vars);if(num1!=undefined&&num2!=undefined){returnValue=Math.min(num1,num2);}break;case'getMax':var num1=self.getValue(text.num1,vars);var num2=self.getValue(text.num2,vars);if(num1!=undefined&&num2!=undefined){returnValue=Math.max(num1,num2);}break;case'getExponent':var base=self.getValue(text.base,vars);var power=self.getValue(text.power,vars);if(base!=undefined&&power!=undefined){returnValue=Math.pow(base,power);}break;/* Groups */case'allUnits':returnValue=ige.$$('unit');break;case'allRegions':returnValue=ige.$$('region');break;case'allUnitsOwnedByPlayer':var player=self.getValue(text.player,vars);if(player){var units=[];for(var i=0;i<player._stats.unitIds.length;i++){var unitId=player._stats.unitIds[i];units.push(ige.$(unitId));}returnValue=units;}break;case'allUnitsInRegion':// if we have the properties needed to get the units in a region
var region=self.getValue(text.region,vars);if(region){var regionBounds=region._stats?region._stats.default:region;returnValue=ige.physics.getBodiesInRegion(regionBounds).filter(({_category})=>{return _category==='unit';});}else{// the entire map
returnValue=[];}break;case'allPlayers':returnValue=ige.$$('player');break;case'humanPlayers':returnValue=ige.$$('player').filter(function(player){return player._stats.controlledBy=='human';});break;case'computerPlayers':returnValue=ige.$$('player').filter(function(player){return player._stats.controlledBy!='human';});break;case'allItems':returnValue=ige.$$('item');break;case'allDebris':returnValue=ige.$$('debris');break;case'allProjectiles':returnValue=ige.$$('projectile');break;/* entity */case'getEntityVariable':// console.log('text.variable', text.variable);
returnValue=text.variable;break;case'allEntities':var igeRegister=ige.register();returnValue=_.values(igeRegister).filter(({_category})=>{return ige.action.entityCategories.includes(_category)||!_category;});break;case'entitiesInRegionInFrontOfEntityAtDistance':var entity=self.getValue(text.entity,vars);var distance=self.getValue(text.distance,vars);var width=self.getValue(text.width,vars);var height=self.getValue(text.height,vars);if(entity!=undefined&&ige.action.entityCategories.indexOf(entity._category)>-1&&height!=undefined&&width!=undefined&&distance!=undefined){// console.log(entity._translate.x, distance * Math.cos(entity._rotate.z + Math.radians(-90)));
// console.log(entity._translate.y, distance * Math.sin(entity._rotate.z + Math.radians(-90)));
var region={x:entity._translate.x+distance*Math.cos(entity._rotate.z+Math.radians(-90)),y:entity._translate.y+distance*Math.sin(entity._rotate.z+Math.radians(-90)),width:width,height:height};region.x-=region.width/2;region.y-=region.height/2;if(region.x&&!isNaN(region.x)&&region.y&&!isNaN(region.y)&&region.width&&!isNaN(region.width)&&region.height&&!isNaN(region.height)){returnValue=ige.physics.getBodiesInRegion(region).filter(({_category})=>{return ige.action.entityCategories.includes(_category)||!_category;});}else{ige.script.errorLog(`region ${JSON.stringify(region)} is not a valid region`);returnValue=[];}}break;case'entitiesInRegion':var region=self.getValue(text.region,vars);var id=ige.game.lastCastingUnitId;var unit=ige.$(id);if(region){// region represent some instance of IgeRegion
if(region._stats){returnValue=ige.physics.getBodiesInRegion(region._stats.default).filter(({_category})=>{return ige.action.entityCategories.includes(_category)||!_category;});}else{returnValue=ige.physics.getBodiesInRegion(region).filter(({_category})=>{return ige.action.entityCategories.includes(_category)||!_category;});}}else{ige.script.errorLog('region is not a valid region');returnValue=[];}break;case'getEntityType':var entity=self.getValue(text.entity,vars);if(entity){returnValue=entity._category||'wall';}break;case'getTimeString':var seconds=self.getValue(text.seconds,vars);returnValue=new Date(parseFloat(seconds)*1000).toISOString().substr(11,8);break;case'getValueOfEntityVariable':var variableData=self.getValue(text.variable,vars);var entity=self.getValue(text.entity,vars);if(entity&&variableData){var entityVariable=entity.variables&&entity.variables[variableData.key]&&entity.variables[variableData.key];if(entityVariable){returnValue=entityVariable.value;if(returnValue===null||returnValue==undefined){returnValue=entityVariable.default;}if(variableData.dataType==='region'){returnValue.key=variableData.key;}}}break;case'undefinedValue':returnValue=undefined;break;default:if(text.function){ige.script.errorLog(`warning: function '${text.function}' not found`);}else{returnValue=text;}break;}}// For debugging purpose. if type of returnValue is object, it can sometimes cause TypeError: Converting circular structure to JSON
if(ige.isServer){var output=returnValue;if(typeof returnValue=='object'&&returnValue&&returnValue._category){output=returnValue._category;}}return returnValue;},calculate:function(items,vars){var self=this;if(items==undefined)return;if(items&&items.constructor!=Array||typeof items=='number'){var solution=this.getValue(items,vars);return parseFloat(solution);}var op=items[0];var left=this.getValue(items[1],vars);var right=this.getValue(items[2],vars);// const [op, left, right] = items
var result=undefined;if(op=='+'||op.operator=='+'){result=this.calculate(left,vars)+this.calculate(right,vars);}else if(op=='-'||op.operator=='-'){result=this.calculate(left,vars)-this.calculate(right,vars);}else if(op=='*'||op.operator=='*'){result=this.calculate(left,vars)*this.calculate(right,vars);}else if(op=='/'||op.operator=='/'){result=this.calculate(left,vars)/this.calculate(right,vars);}else if(op=='%'||op.operator=='%'){result=this.calculate(left,vars)%this.calculate(right,vars);}if(isNaN(result)){ige.script.errorLog('\'Calculate\' detected NaN value. Returning undefined');return undefined;}return result;},getAllVariables:function(selectedTypes){var returnObj={};for(var variableName in ige.game.data.variables){var variable=ige.game.data.variables[variableName];if(!selectedTypes||selectedTypes.includes(variable.dataType)){// if variable's current value isn't set, set value as default
if(variable.value==undefined&&variable.default!=undefined){if(variable.dataType=='player'||variable.dataType=='unit'){variable.value=ige.game[variable.default];}else if(variable.dataType=='region'){var region=ige.regionManager.getRegionById(variableName);variable.value=region||variable.default;variable.value.key=variableName;return variable.value;}else{variable.value=variable.default;}// after retrieving variable data, nullify the default value,
// otherwise, if .value is set to null intentionally, default value will be returned instead.
variable.default=null;}returnObj[variableName]=variable.value;}}return returnObj;},getVariable:function(variableName){var variable=ige.game.data.variables[variableName];if(variable){// if variable's current value isn't set, set value as default
if(variable.value==undefined&&variable.default!=undefined){if(variable.dataType=='player'||variable.dataType=='unit'){variable.value=ige.game[variable.default];}else if(variable.dataType=='region'){var region=ige.regionManager.getRegionById(variableName);variable.value=region||variable.default;variable.value.key=variableName;return variable.value;}else{variable.value=variable.default;}// after retrieving variable data, nullify the default value,
// otherwise, if .value is set to null intentionally, default value will be returned instead.
variable.default=null;}return variable.value;}return null;},setGlobalVariable:function(name,newValue){if(ige.isServer){if(ige.game.data.variables.hasOwnProperty(name)){ige.game.data.variables[name].value=newValue;// if variable has default field then it will be returned when variable's value is undefined
if(newValue===undefined&&action.value&&action.value.function==='undefinedValue'&&ige.game.data.variables[name].hasOwnProperty('default')){ige.game.data.variables[name].default=undefined;}}params.newValue=newValue;this.updateDevConsole({type:'setVariable',params:params});}else if(ige.isClient){}},// update dev console table w/ latest setValue data
updateDevConsole:function(data){var self=this;// if a developer is connected, send
if(ige.isServer&&(ige.server.developerClientId||process.env.ENV==='standalone'||process.env.ENV=='standalone-remote')){// only show 'object' string if env variable is object
if(typeof data.params.newValue=='object'){self.devLogs[data.params.variableName]=`object ${data.params.newValue._stats?`(${data.params.newValue._category}): ${data.params.newValue._stats.name}`:''}`;}else// otherwise, show the actual value
{self.devLogs[data.params.variableName]=data.params.newValue;}}else if(ige.isClient){// update GS CPU graphs if data present
if(data.status&&data.status.cpu){// cpu time spent in user code (ms) since last dev console update - may end up being greater than actual elapsed time if multiple CPU cores are performing work for this process
if(data.status.cpu.user){statsPanels.serverCpuUser._serverCpuUserPanel.update(data.status.cpu.user*0.001,1000);}// cpu time spent in system code (ms) since last dev console update
if(data.status.cpu.system){statsPanels.serverCpuSystem._serverCpuSystemPanel.update(data.status.cpu.system*0.001,1000);}}var totalAttrsCount=0;for(variableName in data){if(variableName!=='status'){var div=$(`#variables-div div.col-sm-12[name='${variableName}']`);var newValue=data[variableName];if(div.length){div.find('.setVariable-value').html(newValue);}else{$('#variables-div').append($('<div/>',{name:variableName,class:'col-sm-12',style:'font-size: 12px'}).append($('<td/>',{html:variableName,style:'color:yellow; padding-left: 10px'})).append($('<td/>',{class:'setVariable-value text-left',html:newValue,style:'padding: 0px 10px 0px 10px'})));}totalAttrsCount++;}}if(data.status!={}&&ige.physics&&ige.physics.engine!='CRASH'){// if streaming entity cound > 150 warn user
if(data.status&&data.status.entityCount&&data.status.entityCount.streaming>150&&!self.streamingWarningShown){$('#streaming-entity-warning').show();self.streamingWarningShown=true;}var innerHtml='';innerHtml=`${''+'<table class="table table-hover text-center" style="border:1px solid #eceeef">'+'<tr>'+'<th>Entity Count</th>'+'<th class="text-center">Server</th>'+'<th class="text-center">Client</th>'+'<th class="text-center">Server Bandwidth</th>'+'</tr>'+'<tr>'+'<td>Unit</td>'+'<td>'}${data.status.entityCount.unit}</td>`+`<td>${ige.$$('unit').length}</td>`+`<td>${data.status.bandwidth.unit}</td>`+'</tr>'+'<tr>'+'<td>Item</td>'+`<td>${data.status.entityCount.item}</td>`+`<td>${ige.$$('item').length}</td>`+`<td>${data.status.bandwidth.item}</td>`+'</tr>'+'<tr>'+'<td>Player</td>'+`<td>${data.status.entityCount.player}</td>`+`<td>${ige.$$('player').length}</td>`+`<td>${data.status.bandwidth.player}</td>`+'</tr>'+'<tr>'+'<td>Debris</td>'+`<td>${data.status.entityCount.debris}</td>`+`<td>${ige.$$('debris').length}</td>`+`<td>${data.status.bandwidth.debris}</td>`+'</tr>'+'<tr>'+'<td>Projectile</td>'+`<td>${data.status.entityCount.projectile}</td>`+`<td>${ige.$$('projectile').length}</td>`+`<td>${data.status.bandwidth.projectile}</td>`+'</tr>'+'<tr>'+'<td>Region</td>'+`<td>${data.status.entityCount.region}</td>`+`<td>${ige.$$('region').length}</td>`+`<td>${data.status.bandwidth.region}</td>`+'</tr>'+'<tr>'+'<td>Sensor</td>'+`<td>${data.status.entityCount.sensor}</td>`+`<td>${ige.$$('sensor').length}</td>`+`<td>${data.status.bandwidth.sensor}</td>`+'</tr>'+'<tr>'+'<th colspan= >Physics</th>'+`<th>${data.status.physics.engine}</th>`+`<th>${ige.physics.engine}</th>`+'<td></td>'+'</tr>'+'<tr>'+'<td>Bodies</td>'+`<td>${data.status.physics.bodyCount}</td>`+`<td>${ige.physics._world?ige.physics._world.m_bodyCount:''}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<td>Joints</td>'+`<td>${data.status.physics.jointCount}</td>`+`<td>${ige.physics._world?ige.physics._world.m_jointCount:''}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<td>Contacts</td>'+`<td>${data.status.physics.contactCount}</td>`+`<td>${ige.physics._world?ige.physics._world.m_contactCount:''}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<td>Heap used</td>'+`<td>${data.status.heapUsed.toFixed(2)}</td>`+`<td>${(window.performance.memory.usedJSHeapSize/1000000).toFixed(2)}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<td>Avg Step Duration(ms)</td>'+`<td>${data.status.physics.stepDuration}</td>`+`<td>${ige.physics._world?ige.physics.avgPhysicsTickDuration.toFixed(2):''}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<td>Physics FPS</td>'+`<td>${data.status.physics.stepsPerSecond}</td>`+`<td>${ige._physicsFPS}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<th colspan=3>Etc</th><th>Time Scale</th>'+'</tr>'+'<tr>'+'<td>Current Time</td>'+// + '<td>' + data.status.currentTime + '(' + (data.status.currentTime - this.prevServerTime) + ')' + '</td>'
// + '<td>' + Math.floor(ige._currentTime) + '(' + (Math.floor(ige._currentTime) - this.prevClientTime) + ')' + '</td>'
`<td>${data.status.currentTime}</td>`+`<td>${Math.floor(ige._currentTime)}(${Math.floor(ige._currentTime)-data.status.currentTime})</td>`+`<td>${ige.timeScale()}</td>`+'</tr>'+'<tr>'+'<td>Client Count</td>'+`<td>${data.status.clientCount}</td>`+'<td></td>'+'<td></td>'+'</tr>'+'<tr>'+'<td>entityUpdateQueue size</td>'+'<td></td>'+`<td>${Object.keys(ige.client.entityUpdateQueue).length}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<td>Total players created</td>'+`<td>${data.status.etc.totalPlayersCreated}</td>`+'<td></td>'+'<td></td>'+'</tr>'+'<tr>'+'<td>Total units created</td>'+`<td>${data.status.etc.totalUnitsCreated}</td>`+'<td></td>'+'<td></td>'+'</tr>'+'<tr>'+'<td>Total items created</td>'+`<td>${data.status.etc.totalItemsCreated}</td>`+'<td></td>'+'<td></td>'+'</tr>'+'<tr>'+'<td>Total Bodies Created</td>'+`<td>${data.status.physics.totalBodiesCreated}</td>`+`<td>${ige.physics._world?ige.physics.totalBodiesCreated:''}</td>`+'<td></td>'+'</tr>'+'<tr>'+'<td>CPU Usage</td>'+`<td>${data.status.cpuDelta}</td>`+'<td></td>'+'<td></td>'+'</tr>'+'<tr>'+'<td>Last Snapshot Length</td>'+`<td>${data.status.lastSnapshotLength}</td>`+'<td></td>'+'<td></td>'+'</tr>'+'</table>';this.prevServerTime=data.status.currentTime;this.prevClientTime=Math.floor(ige._currentTime);$('#dev-status-content').html(innerHtml);self.secondCount++;}}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=VariableComponent;};var TriggerComponent=$i_56.extend({classId:'TriggerComponent',componentId:'trigger',init:function(){var self=this;if(ige.isServer||ige.isClient&&ige.physics){self._enableContactListener();}this._registerTriggeredScripts();},// map trigger events, so we don't have to iterate through all scripts to find corresponding scripts
_registerTriggeredScripts:function(){this.triggeredScripts={};for(scriptId in ige.game.data.scripts){var script=ige.game.data.scripts[scriptId];// look for matching trigger within the script's triggers
if(script&&script.triggers){for(j=0;j<script.triggers.length;j++){var trigger=script.triggers[j];if(this.triggeredScripts[trigger.type]==undefined){this.triggeredScripts[trigger.type]=[scriptId];}else{this.triggeredScripts[trigger.type].push(scriptId);}}}}// console.log("registered triggered scripts: ", this.triggeredScripts)
},// Listen for when contact's begin
_beginContactCallback:function(contact){var entityA=contact.m_fixtureA.m_body._entity;var entityB=contact.m_fixtureB.m_body._entity;if(!entityA||!entityB)return;if(entityA._stats&&entityB._stats){// a unit's sensor detected another unit
if(entityB._category=='sensor'){var tempEntity=entityA;entityA=entityB;entityB=tempEntity;}if(entityA._category=='sensor'){var ownerUnit=entityA.getOwnerUnit();if(ownerUnit){if(entityB._category=='unit'){if(ownerUnit&&ownerUnit!=entityB){ownerUnit.ai.registerSensorDetection(entityB);}}else if(entityB._category=='item'){ige.trigger.fire('whenItemEntersSensor',{unitId:ownerUnit.id(),sensorId:entityA.id(),itemId:entityB.id()});}}return;}// ensure entityA is prioritized by this order: region, unit, item, projectile, wall
// this is to ensure that contact event is fired once when two entities touch each other. instead of this event being called twice.
if(entityB._category=='region'||entityA._category!='region'&&(entityB._category=='unit'||entityA._category!='unit'&&(entityB._category=='item'||entityA._category!='item'&&(entityB._category=='projectile'||entityB._category==undefined)))){var entityA=contact.m_fixtureB.m_body._entity;var entityB=contact.m_fixtureA.m_body._entity;}switch(entityA._category){case'region':var region=ige.variable.getValue({function:'getVariable',variableName:entityA._stats.id});switch(entityB._category){case'unit':ige.trigger.fire('unitEntersRegion',{unitId:entityB.id(),region:region});break;case'item':ige.trigger.fire('itemEntersRegion',{itemId:entityB.id(),region:region});break;case'debris':ige.trigger.fire('debrisEntersRegion',{debrisId:entityB.id(),region:region});break;}break;case'unit':var triggeredBy={unitId:entityA.id()};ige.game.lastTouchingUnitId=entityA.id();ige.game.lastTouchedUnitId=entityB.id();switch(entityB._category){case'unit':ige.trigger.fire('unitTouchesUnit',triggeredBy);// handle unitA touching unitB
triggeredBy.unitId=entityB.id();ige.game.lastTouchingUnitId=entityB.id();ige.game.lastTouchedUnitId=entityA.id();ige.trigger.fire('unitTouchesUnit',triggeredBy);// handle unitB touching unitA
break;case'debris':triggeredBy.debrisId=entityB.id();ige.game.lastTouchedDebrisId=entityB.id();ige.trigger.fire('unitTouchesDebris',triggeredBy);break;case'item':triggeredBy.itemId=entityB.id();ige.game.lastTouchedItemId=entityB.id();// don't trigger if item is owned by the unit
if(entityB._stats.ownerUnitId==entityA.id())return;ige.trigger.fire('unitTouchesItem',triggeredBy);break;case'projectile':// console.log(entityA._category, entityA._stats.name, entityA.id())
triggeredBy.projectileId=entityB.id();triggeredBy.collidingEntity=entityA.id();ige.game.lastTouchedProjectileId=entityB.id();triggeredBy.projectileId=entityB.id();ige.game.lastAttackingUnitId=entityB._stats.sourceUnitId;ige.game.lastAttackedUnitId=entityA.id();ige.trigger.fire('unitTouchesProjectile',triggeredBy);break;case undefined:case'wall':ige.game.lastTouchingUnitId=entityA.id();var triggeredBy={unitId:entityA.id()};ige.trigger.fire('unitTouchesWall',triggeredBy);break;}break;case'item':switch(entityB._category){case'projectile':var triggeredBy={projectileId:entityB.id(),itemId:entityA.id(),collidingEntity:entityA.id()};ige.trigger.fire('projectileTouchesItem',triggeredBy);break;}break;case'projectile':switch(entityB._category){case'debris':var triggeredBy={projectileId:entityA.id(),debrisId:entityB.id(),collidingEntity:entityB.id()};ige.trigger.fire('projectileTouchesDebris',triggeredBy);break;case undefined:case'wall':var triggeredBy={projectileId:entityA.id(),collidingEntity:entityB.id()};ige.trigger.fire('projectileTouchesWall',triggeredBy);break;}break;case undefined:// something touched wall
case'wall':switch(entityB._category){case'projectile':var triggeredBy={projectileId:entityB.id(),collidingEntity:entityA.id()};ige.trigger.fire('projectileTouchesWall',triggeredBy);break;case'item':var triggeredBy={itemId:entityB.id()};ige.trigger.fire('itemTouchesWall',triggeredBy);break;}break;}}},_endContactCallback:function(contact){},_enableContactListener:function(){// Set the contact listener methods to detect when
// contacts (collisions) begin and end
ige.physics.contactListener(this._beginContactCallback,this.endContactCallback);},/*
		fire trigger and run all of the corresponding script(s)
	*/fire:function(triggerName,triggeredBy){// if (triggerName === 'projectileTouchesWall') console.log("trigger fire", triggerName, triggeredBy)
if(ige.isServer||ige.isClient&&ige.physics){let scriptIds=this.triggeredScripts[triggerName];for(i in scriptIds){let scriptId=scriptIds[i];ige.script.scriptLog(`\ntrigger: ${triggerName}`);var localVariables={triggeredBy:triggeredBy};ige.script.runScript(scriptId,localVariables);}}if(triggeredBy&&triggeredBy.projectileId){var projectile=ige.$(triggeredBy.projectileId);if(projectile){switch(triggerName){case'unitTouchesProjectile':var attackedUnit=ige.$(ige.game.lastTouchingUnitId);if(attackedUnit){var damageHasBeenInflicted=attackedUnit.inflictDamage(projectile._stats.damageData);if(projectile._stats.destroyOnContactWith&&projectile._stats.destroyOnContactWith.units&&damageHasBeenInflicted){projectile.destroy();}}break;case'projectileTouchesDebris':if(projectile._stats.destroyOnContactWith&&projectile._stats.destroyOnContactWith.debris){projectile.destroy();}break;case'projectileTouchesItem':if(projectile._stats.destroyOnContactWith&&projectile._stats.destroyOnContactWith.items){projectile.destroy();}break;case'projectileTouchesWall':if(projectile._stats.destroyOnContactWith&&projectile._stats.destroyOnContactWith.walls){projectile.destroy();}break;}}}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=TriggerComponent;};var ActionComponent=$i_56.extend({classId:'ActionComponent',componentId:'action',init:function(){this.entityCategories=['unit','item','projectile','debris','region','wall'];},// entity can be either trigger entity, or entity in loop
run:function(actionList,vars){var self=this;if(actionList==undefined||actionList.length<=0)return;for(var i=0;i<actionList.length;i++){var action=actionList[i];// if action is disabled
if(!action||action.disabled==true||ige.isClient&&ige.physics&&!action.runOnClient){continue;}var params={};var entity=ige.variable.getValue(action.entity,vars);ige.script.currentActionName=action.type;var invalidParameters=[];if(action.params==undefined){for(j in action){// add everything else in action object into param
if(j!='type'){params[j]=action[j];}}}ige.script.recordLast50Action(action.type);try{switch(action.type){/* Global */case'setVariable':// store variables with formula processed
var newValue=ige.variable.getValue(action.value,vars);params.newValue=newValue;if(ige.game.data.variables.hasOwnProperty(action.variableName)){ige.game.data.variables[action.variableName].value=newValue;// if variable has default field then it will be returned when variable's value is undefined
if(newValue===undefined&&action.value&&action.value.function==='undefinedValue'&&ige.game.data.variables[action.variableName].hasOwnProperty('default')){ige.game.data.variables[action.variableName].default=undefined;}}// not sure if we want to be doing this on the client
// causing issues so disabled on client for now
if(ige.isServer){ige.variable.updateDevConsole({type:'setVariable',params:params});}else{// console.log('setVariable:', action.variableName, newValue);
}break;case'setTimeOut':// execute actions after timeout
// const use for creating new instance of variable every time.
const setTimeOutActions=JSON.parse(JSON.stringify(action.actions));// const setTimeoutVars = _.cloneDeep(vars);
setTimeout(function(actions){self.run(actions,vars);},action.duration,setTimeOutActions);break;case'repeat':{var count=ige.variable.getValue(action.count,vars);var repeatActions=ige.variable.getValue(action.actions,vars);if(!isNaN(count)&&count>0){for(let i=0;i<count;i++){returnValue=self.run(repeatActions,vars);if(returnValue=='break'||vars.break){// we dont have to return a value in case of break otherwise
// control will exit from for loop of actions as well
// throw BreakException;
vars.break=false;break;}else if(returnValue=='return'){throw new Error('return without executing script');}}}break;}case'runScript':var previousScriptId=ige.script.currentScriptId;ige.script.runScript(action.scriptName,vars);ige.script.currentScriptId=previousScriptId;break;case'condition':if(ige.condition.run(action.conditions,vars)){var brk=self.run(action.then,vars);}else{var brk=self.run(action.else,vars);}if(brk=='break'){return'break';}else if(brk=='return'){return'return';}else if(brk=='continue'){return'continue';}break;case'transformRegionDimensions':var region=ige.variable.getValue(action.region,vars);var regionId=action.region.variableName;if(region){var x=ige.variable.getValue(action.x,vars);var y=ige.variable.getValue(action.y,vars);var width=ige.variable.getValue(action.width,vars);var height=ige.variable.getValue(action.height,vars);region.streamUpdateData([{x:x},{y:y},{width:width},{height:height}]);}break;case'setLastAttackingUnit':var unit=ige.variable.getValue(action.unit,vars);ige.game.lastAttackingUnitId=unit.id();break;case'setLastAttackedUnit':var unit=ige.variable.getValue(action.unit,vars);ige.game.lastAttackedUnitId=unit.id();break;case'setLastAttackingItem':var item=ige.variable.getValue(action.item,vars);ige.game.lastAttackingItemId=item.id();break;case'sendPostRequest':var obj=ige.variable.getValue(action.string,vars);var url=ige.variable.getValue(action.url,vars);var varName=ige.variable.getValue(action.varName,vars);try{obj=JSON.parse(obj);}catch(err){console.error(err);return;}ige.server.request.post({url:url,form:obj},function optionalCallback(err,httpResponse,body){if(err){return console.error('upload failed:',err);}try{var res=JSON.parse(body);var newValue=res.response;params['newValue']=newValue;if(ige.game.data.variables.hasOwnProperty(varName)){ige.game.data.variables[varName].value=newValue;}}catch(err){console.error(err);if(ige.game.data.variables.hasOwnProperty(varName)){ige.game.data.variables[varName].value='error';}}});break;/* Player */case'kickPlayer':var player=ige.variable.getValue(action.entity,vars);if(player&&player._category=='player'){player.streamUpdateData([{playerJoined:false}]);}break;case'playEntityAnimation':var animationId=ige.variable.getValue(action.animation,vars);// console.log('playing unit animation!', animationId);
var entity=ige.variable.getValue(action.entity,vars);if(entity){entity.streamUpdateData([{anim:animationId}]);}break;case'setPlayerAttribute':var attrId=ige.variable.getValue(action.attribute,vars);var player=entity;if(player&&player._category=='player'&&player._stats.attributes){var attribute=player._stats.attributes[attrId];if(attribute!=undefined){var decimalPlace=parseInt(attribute.decimalPlaces)||0;var value=parseFloat(ige.variable.getValue(action.value,vars)).toFixed(decimalPlace);player.attribute.update(attrId,value,true);// update attribute, and check for attribute becoming 0
}}break;case'setPlayerAttributeMax':var attrId=ige.variable.getValue(action.attributeType,vars);var player=ige.variable.getValue(action.player,vars);var maxValue=ige.variable.getValue(action.number,vars);if(player&&player._category=='player'&&player._stats.attributes&&player._stats.attributes[attrId]!=undefined){var max={};max[attrId]=maxValue;player.streamUpdateData([{attributesMax:max}]);}break;case'setPlayerAttributeMin':var attrId=ige.variable.getValue(action.attributeType,vars);var player=ige.variable.getValue(action.player,vars);var minValue=ige.variable.getValue(action.number,vars);if(player&&player._category=='player'&&player._stats.attributes&&player._stats.attributes[attrId]!=undefined){var min={};min[attrId]=minValue;player.streamUpdateData([{attributesMin:min}]);}break;case'setPlayerAttributeRegenerationRate':var attrId=ige.variable.getValue(action.attributeType,vars);var player=ige.variable.getValue(action.player,vars);var regenerateRateValue=ige.variable.getValue(action.number,vars);if(player&&player._category=='player'&&player._stats.attributes&&player._stats.attributes[attrId]!=undefined){var regRate={};regRate[attrId]=regenerateRateValue;player.streamUpdateData([{attributesRegenerateRate:regRate}]);}break;case'setPlayerName':var name=ige.variable.getValue(action.name,vars);var player=ige.variable.getValue(action.player,vars);if(player&&player._category=='player'){player.streamUpdateData([{name:name}]);}break;case'assignPlayerType':var playerTypeId=ige.variable.getValue(action.playerType,vars);if(entity&&entity._category=='player'){var player=entity;player.streamUpdateData([{playerTypeId:playerTypeId}]);}break;case'setPlayerVariable':var player=ige.variable.getValue(action.player,vars);var variable=ige.variable.getValue(action.variable,vars);var value=ige.variable.getValue(action.value,vars);if(variable&&player&&player.variables&&player.variables[variable.key]){var isDataTypeSame=false;var variableObj=player.variables[variable.key];switch(variableObj.dataType){case'string':case'boolean':case'number':{isDataTypeSame=typeof value===variableObj.dataType;break;}case'position':{isDataTypeSame=typeof value==='object'&&value.x&&value.y;break;}case'item':case'player':case'unit':{isDataTypeSame=typeof value==='object'&&value._category===variableObj.dataType;break;}default:{// figure out how to validate for other types like itemType, unitType, ..., etc.
isDataTypeSame=true;break;}}if(isDataTypeSame){variableObj.value=value;}else if(typeof value==='undefined'&&action.value&&action.value.function==='undefinedValue'){// dev intentionally set value as undefined
variableObj.value=undefined;// if variable has default field then it will be returned when variable's value is undefined
if(variableObj.default){variableObj.default=undefined;}}else{ige.devLog('datatype of value does not match datatype of variable');}}break;case'changeDescriptionOfItem':var item=ige.variable.getValue(action.item,vars);var description=ige.variable.getValue(action.string,vars);if(item&&description){item.streamUpdateData([{description:description}]);}break;case'changeItemInventoryImage':var item=ige.variable.getValue(action.item,vars);var url=ige.variable.getValue(action.url,vars);if(item&&url){item.streamUpdateData([{inventoryImage:url}]);}break;case'startAcceptingPlayers':ige.clusterClient.setAcceptingPlayerStatus(true);break;case'stopAcceptingPlayers':ige.clusterClient.setAcceptingPlayerStatus(false);break;case'saveUnitData':var unit=ige.variable.getValue(action.unit,vars);var ownerPlayer=unit.getOwner();var userId=ownerPlayer._stats.userId;if(unit&&ownerPlayer&&userId&&ownerPlayer.persistentDataLoaded){var data=unit.getPersistentData('unit');ige.clusterClient.saveUserData(userId,data,'unit');}else{if(!unit.persistentDataLoaded){ige.devLog('Fail saving unit data bcz persisted data not set correctly');}else{ige.devLog('Fail saving unit data');}}break;case'savePlayerData':var player=ige.variable.getValue(action.player,vars);var userId=player&&player._stats&&player._stats.userId;if(player&&userId&&player.persistentDataLoaded){var data=player.getPersistentData('player');ige.clusterClient.saveUserData(userId,data,'player');var unit=player.getSelectedUnit();var userId=player._stats.userId;if(unit&&player&&userId&&unit.persistentDataLoaded){var data=unit.getPersistentData('unit');ige.clusterClient.saveUserData(userId,data,'unit');}else{if(!unit.persistentDataLoaded){ige.devLog('Fail saving unit data bcz persisted data not set correctly');}else{ige.devLog('Fail saving unit data');}}}else{if(!player.persistentDataLoaded){ige.devLog('Fail saving unit data bcz persisted data not set correctly');}else{ige.devLog('Fail saving player data');}}break;case'makePlayerSelectUnit':var player=ige.variable.getValue(action.player,vars);var unit=ige.variable.getValue(action.unit,vars);if(player&&unit){player.selectUnit(unit.id());}break;/* UI */case'showUiTextForPlayer':if(entity&&entity._stats){var text=ige.variable.getValue(action.value,vars);ige.gameText.updateText({target:action.target,value:text,action:'show'},entity._stats.clientId);}break;case'showUiTextForEveryone':var text=ige.variable.getValue(action.value,vars);ige.gameText.updateText({target:action.target,value:text,action:'show'});break;case'hideUiTextForPlayer':if(entity&&entity._stats){var text=ige.variable.getValue(action.value,vars);ige.gameText.updateText({target:action.target,value:text,action:'hide'},entity._stats.clientId);}break;case'hideUiTextForEveryone':var text=ige.variable.getValue(action.value,vars);ige.gameText.updateText({target:action.target,value:text,action:'hide'});break;case'updateUiTextForTimeForPlayer':var text=ige.variable.getValue(action.value,vars);var player=ige.variable.getValue(action.player,vars);var time=ige.variable.getValue(action.time,vars);// don't send text to AI players. If player is undefined, then send to all players
if(player==undefined||player&&player._stats&&player._stats.controlledBy=='human'){ige.gameText.updateTextForTime({target:action.target,value:text,action:'update',time},player&&player._stats&&player._stats.clientId);}break;case'updateUiTextForPlayer':if(entity&&entity._stats){var text=ige.variable.getValue(action.value,vars);ige.gameText.updateText({target:action.target,value:text,action:'update'},entity._stats.clientId);}break;case'showGameSuggestionsForPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._stats&&player._stats.clientId){ige.network.send('gameSuggestion',{type:'show'},player._stats.clientId);}break;case'hideGameSuggestionsForPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._stats&&player._stats.clientId){ige.network.send('gameSuggestion',{type:'hide'},player._stats.clientId);}break;case'updateUiTextForEveryone':var text=ige.variable.getValue(action.value,vars);ige.gameText.updateText({target:action.target,value:text,action:'update'});break;case'showInputModalToPlayer':var player=ige.variable.getValue(action.player,vars);var inputLabel=ige.variable.getValue(action.inputLabel,vars);if(player&&player._stats&&player._stats.clientId){ige.network.send('ui',{command:'showInputModal',fieldLabel:inputLabel,isDismissible:false},player._stats.clientId);}break;case'showDismissibleInputModalToPlayer':var player=ige.variable.getValue(action.player,vars);var inputLabel=ige.variable.getValue(action.inputLabel,vars);if(player&&player._stats&&player._stats.clientId){ige.network.send('ui',{command:'showInputModal',fieldLabel:inputLabel,isDismissible:true},player._stats.clientId);}break;case'showCustomModalToPlayer':var player=ige.variable.getValue(action.player,vars);var htmlContent=ige.variable.getValue(action.htmlContent,vars)||'';var modalTitle=ige.variable.getValue(action.title,vars)||'';if(player&&player._stats&&player._stats.clientId){ige.network.send('ui',{command:'showCustomModal',title:modalTitle,content:htmlContent,isDismissible:true},player._stats.clientId);}break;case'showWebsiteModalToPlayer':var player=ige.variable.getValue(action.player,vars);var url=ige.variable.getValue(action.string,vars)||'';if(player&&player._stats&&player._stats.clientId){ige.network.send('ui',{command:'showWebsiteModal',url:url,isDismissible:true},player._stats.clientId);}break;case'showSocialShareModalToPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._stats&&player._stats.clientId){ige.network.send('ui',{command:'showSocialShareModal',isDismissible:true},player._stats.clientId);}break;case'openWebsiteForPlayer':var player=ige.variable.getValue(action.player,vars);var url=ige.variable.getValue(action.string,vars)||'';if(player&&player._stats&&player._stats.clientId){ige.network.send('ui',{command:'openWebsite',url:url,isDismissible:true},player._stats.clientId);}break;case'showInviteFriendsModal':var player=ige.variable.getValue(action.player,vars);if(player&&player._stats&&player._stats.clientId){ige.network.send('ui',{command:'showFriendsModal'},player._stats.clientId);}break;case'showMenu':var player=ige.variable.getValue(action.player,vars);if(player&&player._stats){ige.network.send('ui',{command:'showMenu'},player._stats.clientId);}break;case'sendChatMessage':var message=ige.variable.getValue(action.message,vars);ige.chat.sendToRoom('1',message,undefined,undefined);break;case'sendChatMessageToPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._category=='player'&&player._stats.clientId){var clientId=player._stats.clientId;ige.chat.sendToRoom('1',ige.variable.getValue(action.message,vars),clientId,undefined);}break;case'banPlayerFromChat':var player=ige.variable.getValue(action.player,vars);if(player){player.streamUpdateData([{banChat:true}]);}break;case'unbanPlayerFromChat':var player=ige.variable.getValue(action.player,vars);if(player){player.streamUpdateData([{banChat:false}]);}break;case'playerCameraSetZoom':var player=ige.variable.getValue(action.player,vars);var zoom=ige.variable.getValue(action.zoom,vars);if(player&&player._category=='player'&&zoom!=undefined&&player._stats.clientId){ige.network.send('camera',{cmd:'zoom',zoom:zoom},player._stats.clientId);}break;case'showUnitInPlayerMinimap':var player=ige.variable.getValue(action.player,vars);var unit=ige.variable.getValue(action.unit,vars);var color=ige.variable.getValue(action.color,vars);if(player&&unit&&unit._category==='unit'&&player._stats&&player._stats.clientId){var clientId=player._stats.clientId;unit._stats.minimapUnitVisibleToClients[clientId]=color;ige.network.send('minimap',{type:'showUnit',unitId:unit.id(),color:color},player._stats.clientId);}break;case'hideUnitInPlayerMinimap':var player=ige.variable.getValue(action.player,vars);var unit=ige.variable.getValue(action.unit,vars);var color=ige.variable.getValue(action.color,vars);if(player&&unit&&unit._category==='unit'&&player._stats&&player._stats.clientId){var clientId=player._stats.clientId;delete unit._stats.minimapUnitVisibleToClients[clientId];ige.network.send('minimap',{type:'hideUnit',unitId:unit.id()},player._stats.clientId);}break;/* Loops */case'forAllUnits':if(action.unitGroup){if(!vars){vars={};}var units=ige.variable.getValue(action.unitGroup,vars)||[];for(var l=0;l<units.length;l++){var unit=units[l];var brk=self.run(action.actions,Object.assign(vars,{selectedUnit:unit}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}break;case'forAllPlayers':if(action.playerGroup){if(!vars){vars={};}var players=ige.variable.getValue(action.playerGroup,vars)||[];for(var l=0;l<players.length;l++){var player=players[l];var brk=self.run(action.actions,Object.assign(vars,{selectedPlayer:player}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}break;case'forAllItems':if(action.itemGroup){if(!vars){vars={};}var items=ige.variable.getValue(action.itemGroup,vars)||[];for(var l=0;l<items.length;l++){var item=items[l];var brk=self.run(action.actions,Object.assign(vars,{selectedItem:item}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}break;case'forAllProjectiles':if(action.projectileGroup){if(!vars){vars={};}var projectiles=ige.variable.getValue(action.projectileGroup,vars)||[];for(var l=0;l<projectiles.length;l++){var projectile=projectiles[l];var brk=self.run(action.actions,Object.assign(vars,{selectedProjectile:projectile}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}break;case'forAllDebris':if(action.debrisGroup){if(!vars){vars={};}var allDebris=ige.variable.getValue(action.debrisGroup,vars)||[];for(var l=0;l<allDebris.length;l++){var debris=allDebris[l];var brk=self.run(action.actions,Object.assign(vars,{selectedDebris:debris}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}break;case'forAllEntities':if(action.entityGroup){if(!vars){vars={};}var entities=ige.variable.getValue(action.entityGroup,vars)||[];for(var l=0;l<entities.length;l++){var entity=entities[l];// if (['unit', 'item', 'projectile', 'wall'].includes(entity._category)) {
if(self.entityCategories.indexOf(entity._category)>-1){var brk=self.run(action.actions,Object.assign(vars,{selectedEntity:entity}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}}break;case'forAllRegions':if(action.regionGroup){if(!vars){vars={};}var regions=ige.variable.getValue(action.regionGroup,vars)||[];for(var l=0;l<regions.length;l++){var region=regions[l];var brk=self.run(action.actions,Object.assign(vars,{selectedRegion:region}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}break;case'forAllUnitTypes':if(action.unitTypeGroup){if(!vars){vars={};}// unlike other forAll... actions this action expects JSON instead of array
// because unitTypeGroup variable is being stored as a JSON not an array.
var unitTypes=ige.variable.getValue(action.unitTypeGroup,vars)||{};for(var unitTypeKey in unitTypes){var brk=self.run(action.actions,Object.assign(vars,{selectedUnitType:unitTypeKey}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}break;case'forAllItemTypes':if(action.itemTypeGroup){if(!vars){vars={};}// unlike other forAll... actions this action expects JSON instead of array
// because itemTypeGroup variable is being stored as a JSON not an array.
var itemTypes=ige.variable.getValue(action.itemTypeGroup,vars)||{};// sorting items before they are used. which solves issue of getting first item in slot
itemTypes=Object.keys(itemTypes);var itemsArr=_.map(itemTypes,itemId=>{var item=ige.game.getAsset('itemTypes',itemId);if(item){return{name:item.name,itemId:itemId};}return undefined;});sortedItems=_.orderBy(itemsArr,['name'],'asc');for(let i=0;i<sortedItems.length;i++){if(sortedItems[i]){var itemTypeKey=sortedItems[i].itemId;var brk=self.run(action.actions,Object.assign(vars,{selectedItemType:itemTypeKey}));if(brk=='break'||vars.break){vars.break=false;ige.devLog('break called');break;}else if(brk=='continue'){continue;}else if(brk=='return'){ige.devLog('return without executing script');return'return';}}}}break;case'while':var loopCounter=0;while(ige.condition.run(action.conditions,vars)){var brk=self.run(action.actions,vars);if(brk=='break'||vars.break){// we dont have to return a value in case of break otherwise
// control will exit from for loop of actions as well
// return "break";
vars.break=false;break;}else if(brk=='return'){throw new Error('return without executing script');}loopCounter++;if(loopCounter>10000){var errorMsg=ige.script.errorLog('infinite loop detected');console.log(errorMsg);ige.server.unpublish(errorMsg);}}break;case'for':var variables=ige.game.data.variables;var variableName=action.variableName;if(variables[variableName]!==undefined){if(variables[variableName].dataType!=='number'){throw new Error('`for` action only supports numeric variable');}var start=ige.variable.getValue(action.start,vars);var stop=ige.variable.getValue(action.stop,vars);// var incrementBy = stop >= start ? 1 : -1;
// var checkCondition = function (value) {
//     if (incrementBy === 1) {
//         return value <= stop;
//     }
//     else {
//         return value >= stop;
//     }
// }
// checkCondition(variables[variableName].value); // condition
for(variables[variableName].value=start;// initial value
variables[variableName].value<=stop;variables[variableName].value+=1// post iteration operation
){var brk=self.run(action.actions,vars);if(brk=='break'||vars.break){// we dont have to return a value in case of break otherwise
// control will exit from for loop of actions as well
// throw BreakException;
vars.break=false;break;}else if(brk=='return'){throw new Error('return without executing script');}}}break;case'break':if(!vars)vars={};vars.break=true;return'break';break;case'continue':return'continue';break;case'return':return'return';break;case'endGame':ige.server.kill('end game called');break;/* Unit */case'createUnitAtPosition':var player=ige.variable.getValue(action.entity,vars);var unitTypeId=ige.variable.getValue(action.unitType,vars);var unitTypeData=ige.game.getAsset('unitTypes',unitTypeId);var spawnPosition=ige.variable.getValue(action.position,vars);var facingAngle=ige.variable.getValue(action.angle,vars)||0;if(player&&spawnPosition&&unitTypeId&&unitTypeData){var data=Object.assign(unitTypeData,{type:unitTypeId,defaultData:{translate:spawnPosition,rotate:facingAngle}});var unit=player.createUnit(data);ige.game.lastCreatedUnitId=unit.id();}else{ige.script.errorLog('cannot create unit. parameters are spawnPosition:',spawnPosition,' player:',!!player,' unitTypeId:',unitTypeId);if(!player)invalidParameters.push('player');if(!spawnPosition)invalidParameters.push('spawn position');if(!unitTypeId)invalidParameters.push('unit type');throw new Error(`cannot create unit. invalid parameter(s) given: ${invalidParameters.toString()}`);}break;case'changeUnitType':var unitTypeId=ige.variable.getValue(action.unitType,vars);if(entity&&entity._category=='unit'&&unitTypeId!=null){entity.streamUpdateData([{type:unitTypeId}]);}else{ige.script.errorLog('invalid unit / unitTypeId');if(!entity)invalidParameters.push('unit');if(!unitTypeId)invalidParameters.push('unit type');throw new Error(`cannot change unit type. invalid parameter(s) given: ${invalidParameters.toString()}`);}break;case'changeUnitSpeed':var bonusSpeed=ige.variable.getValue(action.unitSpeed,vars);if(entity!=undefined&&entity._stats!=undefined&&entity._category!=undefined&&bonusSpeed!=undefined){entity.streamUpdateData([{bonusSpeed:bonusSpeed}]);}break;case'changeSensorRadius':var sensor=ige.variable.getValue(action.sensor,vars);var radius=ige.variable.getValue(action.radius,vars);// console.log("changeSensorRadius", sensor.id(), radius)
if(sensor&&sensor._category=='sensor'){if(!isNaN(radius)){sensor.updateRadius(radius);}}break;case'stunUnit':var unit=ige.variable.getValue(action.unit,vars);if(unit&&unit._stats){unit.ability.stopUsingItem();unit.streamUpdateData([{isStunned:true}]);var item=unit.getCurrentItem();if(item){item.streamUpdateData([{stopUsing:false}]);}}break;case'removeStunFromUnit':var unit=ige.variable.getValue(action.unit,vars);if(unit&&unit._stats){unit.streamUpdateData([{isStunned:false}]);}break;case'resetDebrisPosition':if(entity&&entity._category=='debris')entity.resetPosition();break;case'setEntityVelocityAtAngle':var entity=ige.variable.getValue(action.entity,vars);var speed=ige.variable.getValue(action.speed,vars)||0;var radians=ige.variable.getValue(action.angle,vars);// entity's facing angle
if(entity&&radians!==undefined&&!isNaN(radians)&&!isNaN(speed)){radians-=Math.radians(90);// console.log("2. setting linear velocity", radians, speed)
// entity.body.setLinearVelocity(new $i_5(Math.cos(radians) * speed, Math.sin(radians) * speed, 0));
// entity.setLinearVelocityLT(Math.cos(radians) * speed, Math.sin(radians) * speed);
entity.setLinearVelocity(Math.cos(radians)*speed,Math.sin(radians)*speed);}break;case'setVelocityOfEntityXY':// action.forceX
var entity=ige.variable.getValue(action.entity,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1){var velocityX=ige.variable.getValue(action.velocity.x,vars);if(velocityX==undefined||isNaN(velocityX)){velocityX=0;}var velocityY=ige.variable.getValue(action.velocity.y,vars);if(velocityY==undefined||isNaN(velocityY)){velocityY=0;}entity.setLinearVelocity(velocityX,velocityY);}else{ige.script.errorLog('invalid entity');}break;case'setUnitOwner':var unit=ige.variable.getValue(action.unit,vars);var player=ige.variable.getValue(action.player,vars);if(unit&&player){unit.setOwnerPlayer(player.id());}break;case'setUnitNameLabel':var unit=ige.variable.getValue(action.unit,vars);var name=ige.variable.getValue(action.name,vars);if(unit){unit.streamUpdateData([{name:name}]);}break;case'setItemName':var item=ige.variable.getValue(action.item,vars);var name=ige.variable.getValue(action.name,vars);if(item){item.streamUpdateData([{name:name}]);}break;case'setFadingTextOfUnit':var unit=ige.variable.getValue(action.unit,vars);var text=ige.variable.getValue(action.text,vars);var color=ige.variable.getValue(action.color,vars);if(unit&&unit._category==='unit'&&text!==undefined){unit.streamUpdateData([{setFadingText:`${text}|-|${color}`}]);}break;case'createFloatingText':var position=ige.variable.getValue(action.position,vars);var text=ige.variable.getValue(action.text,vars);var color=ige.variable.getValue(action.color,vars);ige.network.send('createFloatingText',{position:position,text:text,color:color});break;/* Item */case'startUsingItem':if(entity&&entity._category=='item'){entity.startUsing();entity.streamUpdateData([{isBeingUsedFromScript:true}]);}break;case'useItemOnce':var item=ige.variable.getValue(action.item,vars);if(item&&item._category=='item'){item.use();}break;case'stopUsingItem':if(entity&&entity._category=='item'){entity.stopUsing();entity.streamUpdateData([{isBeingUsedFromScript:false}]);entity.streamUpdateData([{stopUsing:false}]);}break;case'updateItemQuantity':var item=ige.variable.getValue(action.entity,vars);var quantity=ige.variable.getValue(action.quantity,vars);if(item&&item._category=='item'){item.streamUpdateData([{quantity:quantity}]);}break;case'setItemFireRate':var item=ige.variable.getValue(action.item,vars);var value=ige.variable.getValue(action.number,vars);if(item&&item._category=='item'){item.streamUpdateData([{fireRate:value}]);}break;case'changeInventorySlotColor':var item=ige.variable.getValue(action.item,vars);var color=ige.variable.getValue(action.string,vars);if(item&&color){item.streamUpdateData([{inventorySlotColor:color}]);}break;case'setItemAmmo':var item=ige.variable.getValue(action.item,vars);var newAmmo=ige.variable.getValue(action.ammo,vars);// because in item stream update quantity value is decremented by 1
newAmmo++;if(item&&item._category==='item'&&item._stats.type==='weapon'&&!isNaN(newAmmo)){item.streamUpdateData([{quantity:newAmmo}]);}case'dropItem':var entity=ige.variable.getValue(action.entity,vars);if(entity&&entity._category==='unit'){var item=entity.getCurrentItem();if(entity&&item&&entity._stats&&entity._stats.itemIds){var itemIndex=-1;for(itemIndex=0;itemIndex<entity._stats.itemIds.length;itemIndex++){if(item.id()===entity._stats.itemIds[itemIndex]){break;}}if(itemIndex<=entity._stats.itemIds.length){entity.dropItem(itemIndex);}}}break;case'dropItemAtPosition':var item=ige.variable.getValue(action.item,vars);var position=ige.variable.getValue(action.position,vars);if(item){if(item._stats&&item._stats.controls&&!item._stats.controls.undroppable){var ownerUnit=item.getOwnerUnit();var itemIndex=item._stats.slotIndex;if(ownerUnit){ownerUnit.dropItem(itemIndex,position);}}else{throw new Error(`unit cannot drop an undroppable item ${item._stats.name}`);}}else{throw new Error('invalid item');}break;case'castAbility':if(entity&&entity._category=='unit'&&entity.ability&&action.abilityName){entity.ability.cast(action.abilityName);}// else
// entity.ability.cast()
break;case'dropAllItems':if(entity&&entity._category=='unit'){for(let i=0;i<entity._stats.itemIds.length;i++){if(entity._stats.itemIds[i]){var item=entity.dropItem(i);// slightly push item away from the unit at random angles
if(item){randomForceX=Math.floor(Math.random()*101)-50;randomForceY=Math.floor(Math.random()*101)-50;item.applyForce(randomForceX,randomForceY);}}}}break;case'openShopForPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._category==='player'&&player._stats.clientId){player._stats.lastOpenedShop=action.shop;ige.network.send('openShop',{type:action.shop},player._stats.clientId);}break;case'closeShopForPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._category==='player'&&player._stats.clientId){ige.network.send('ui',{command:'closeShop'},player._stats.clientId);}break;case'openDialogueForPlayer':var player=ige.variable.getValue(action.player,vars);var primitiveVariables=ige.variable.getAllVariables(['string','number','boolean']);if(player&&player._category==='player'&&player._stats.clientId){player._stats.lastOpenedDialogue=action.dialogue;ige.network.send('openDialogue',{type:action.dialogue,extraData:{playerName:player._stats&&player._stats.name,variables:primitiveVariables}},player._stats.clientId);}break;case'closeDialogueForPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._category==='player'&&player._stats.clientId){ige.network.send('closeDialogue',player._stats.clientId);}break;case'refillAmmo':var item=entity;if(item&&item._category=='item'){item.refillAmmo();}break;case'dropItemInInventorySlot':var slotIndex=ige.variable.getValue(action.slotIndex,vars);var unit=ige.variable.getValue(action.unit,vars);if(unit&&unit._category=='unit'&&slotIndex!=undefined){unit.dropItem(slotIndex-1);}break;/* particles */case'startItemParticle':var item=ige.variable.getValue(action.item,vars);var particleTypeId=ige.variable.getValue(action.particleType,vars);if(item&&item._category=='item'&&item._stats.particles&&item._stats.particles[particleTypeId]){ige.network.send('particle',{eid:item.id(),pid:particleTypeId,action:'start'});}break;case'stopItemParticle':var item=ige.variable.getValue(action.item,vars);var particleTypeId=ige.variable.getValue(action.particleType,vars);if(item&&item._category=='item'&&item._stats.particles&&item._stats.particles[particleTypeId]){ige.network.send('particle',{eid:item.id(),pid:particleTypeId,action:'stop'});}break;case'emitItemParticle':var item=ige.variable.getValue(action.item,vars);var particleTypeId=ige.variable.getValue(action.particleType,vars);if(item&&item._category=='item'&&item._stats.particles&&item._stats.particles[particleTypeId]){ige.network.send('particle',{eid:item.id(),pid:particleTypeId,action:'emitOnce'});}break;case'startUnitParticle':var unit=ige.variable.getValue(action.unit,vars);var particleTypeId=ige.variable.getValue(action.particleType,vars);if(unit&&unit._category=='unit'&&unit._stats.particles&&unit._stats.particles[particleTypeId]){ige.network.send('particle',{eid:unit.id(),pid:particleTypeId,action:'start'});}break;case'stopUnitParticle':var unit=ige.variable.getValue(action.unit,vars);var particleTypeId=ige.variable.getValue(action.particleType,vars);if(unit&&unit._category=='unit'&&unit._stats.particles&&unit._stats.particles[particleTypeId]){ige.network.send('particle',{eid:unit.id(),pid:particleTypeId,action:'stop'});}break;case'emitUnitParticle':var unit=ige.variable.getValue(action.unit,vars);var particleTypeId=ige.variable.getValue(action.particleType,vars);if(unit&&unit._category=='unit'&&unit._stats.particles&&unit._stats.particles[particleTypeId]){ige.network.send('particle',{eid:unit.id(),pid:particleTypeId,action:'emitOnce'});}break;case'emitParticleOnceAtPosition':var position=ige.variable.getValue(action.position,vars);var particleTypeId=ige.variable.getValue(action.particleType,vars);if(particleTypeId&&position){ige.network.send('particle',{pid:particleTypeId,action:'emitOnce',position:position});}break;case'rotateUnitClockwise':var torque=ige.variable.getValue(action.torque,vars);if(entity&&entity._category=='unit'&&entity.body&&!isNaN(torque)){// entity.body.m_torque = entity._stats.body.rotationSpeed
entity.body.m_torque=torque;}else{// ige.script.errorLog( action.type + " - invalid unit")
}break;// is deprecated ?
case'rotateUnitCounterClockwise':var torque=ige.variable.getValue(action.torque,vars);if(entity&&entity._category=='unit'&&entity.body&&!isNaN(torque)){// entity.body.m_torque = -1 * entity._stats.body.rotationSpeed
entity.body.m_torque=-1*torque;}else{// ige.script.errorLog( action.type + " - invalid unit")
}break;case'makeUnitToAlwaysFacePosition':if(entity&&entity._category=='unit'){var position=ige.variable.getValue(action.position,vars);if(!isNaN(position.x)&&!isNaN(position.y)){entity.isLookingAt=position;}}break;case'makeUnitToAlwaysFaceMouseCursor':if(entity&&entity._category=='unit'){entity.isLookingAt='mouse';}break;case'makeUnitInvisible':if(entity&&entity._category=='unit'){entity.streamUpdateData([{isInvisible:true},{isNameLabelHidden:true}]);}break;case'makeUnitVisible':if(entity&&entity._category=='unit'){entity.streamUpdateData([{isInvisible:false},{isNameLabelHidden:false}]);}break;case'makeUnitInvisibleToFriendlyPlayers':if(entity&&entity._category=='unit'){entity.streamUpdateData([{isInvisibleToFriendly:true},{isNameLabelHiddenToFriendly:true}]);}break;'';case'makeUnitVisibleToFriendlyPlayers':if(entity&&entity._category=='unit'){entity.streamUpdateData([{isInvisibleToFriendly:false},{isNameLabelHiddenToFriendly:false}]);}break;case'hideUnitNameLabelFromPlayer':var unit=ige.variable.getValue(action.entity,vars);var player=ige.variable.getValue(action.player,vars);if(unit&&player&&player._stats&&unit._stats){ige.network.send('hideUnitNameLabelFromPlayer',{unitId:unit.id()},player._stats.clientId);}break;case'showUnitNameLabelToPlayer':var unit=ige.variable.getValue(action.entity,vars);var player=ige.variable.getValue(action.player,vars);if(unit&&player&&player._stats&&unit._stats){ige.network.send('showUnitNameLabelFromPlayer',{unitId:unit.id()},player._stats.clientId);}break;case'hideUnitFromPlayer':var unit=ige.variable.getValue(action.entity,vars);var player=ige.variable.getValue(action.player,vars);if(unit&&player&&player._stats&&unit._stats){ige.network.send('hideUnitFromPlayer',{unitId:unit.id()},player._stats.clientId);}break;case'showUnitToPlayer':var unit=ige.variable.getValue(action.entity,vars);var player=ige.variable.getValue(action.player,vars);if(unit&&player&&player._stats&&unit._stats){ige.network.send('showUnitFromPlayer',{unitId:unit.id()},player._stats.clientId);}break;case'makeUnitInvisibleToNeutralPlayers':if(entity&&entity._category=='unit'){entity.streamUpdateData([{isInvisibleToNeutral:true},{isNameLabelHiddenToNeutral:true}]);}break;case'makeUnitVisibleToNeutralPlayers':if(entity&&entity._category=='unit'){entity.streamUpdateData([{isInvisibleToNeutral:false},{isNameLabelHiddenToNeutral:false}]);}break;case'hideUnitNameLabel':var playerTypeId=ige.variable.getValue(action.playerType,vars);if(entity&&entity._category=='unit'){entity.streamUpdateData([{isNameLabelHidden:true}]);}break;case'showUnitNameLabel':var playerTypeId=ige.variable.getValue(action.playerType,vars);if(entity&&entity._category=='unit'){entity.streamUpdateData([{isNameLabelHidden:false}]);}break;/* projectile */case'createProjectileAtPosition':var projectileTypeId=ige.variable.getValue(action.projectileType,vars);var position=ige.variable.getValue(action.position,vars);var force=ige.variable.getValue(action.force,vars);var unit=ige.variable.getValue(action.unit,vars);var angle=ige.variable.getValue(action.angle,vars);var error='';var delta=Math.radians(90);// unitsFacingAngle delta
var facingAngleDelta=0;if(action.angle&&action.angle.function=='angleBetweenPositions'){delta=0;facingAngleDelta=Math.radians(90);}if(projectileTypeId){var projectileData=ige.game.getAsset('projectileTypes',projectileTypeId);if(projectileData!=undefined&&position!=undefined&&position.x!=undefined&&position.y!=undefined&&force!=undefined&&angle!=undefined){var facingAngleInRadians=angle+facingAngleDelta;angle=angle-delta;var streamMode=1;var unitId=unit?unit.id():undefined;var data=Object.assign(projectileData,{type:projectileTypeId,bulletForce:force,sourceItemId:undefined,sourceUnitId:unitId,defaultData:{rotate:facingAngleInRadians,translate:position,velocity:{x:Math.cos(angle)*force,y:Math.sin(angle)*force}},streamMode:streamMode});var projectile=new Projectile(data);ige.game.lastCreatedProjectileId=projectile._id;}else{if(!projectileData){ige.script.errorLog('invalid projectile data');}if(!position||position.x==undefined||position.y==undefined){ige.script.errorLog('invalid position data');}if(force==undefined){ige.script.errorLog('invalid force value');}if(angle==undefined){ige.script.errorLog('invalid angle value');}}}break;/* debris */ /* Camera */case'playerCameraTrackUnit':var unit=ige.variable.getValue(action.unit,vars);var player=ige.variable.getValue(action.player,vars);if(unit&&player&&player._stats.clientId){player.cameraTrackUnit(unit);}break;case'changePlayerCameraPanSpeed':var panSpeed=ige.variable.getValue(action.panSpeed,vars);var player=ige.variable.getValue(action.player,vars);if(player&&player._stats.clientId){player.changeCameraPanSpeed(panSpeed);}break;case'positionCamera':var position=ige.variable.getValue(action.position,vars);var player=ige.variable.getValue(action.player,vars);if(position&&player&&player._stats.clientId){ige.network.send('camera',{cmd:'positionCamera',position:position},player._stats.clientId);}break;case'createItemAtPositionWithQuantity':var itemTypeId=ige.variable.getValue(action.itemType,vars);var position=ige.variable.getValue(action.position,vars);var quantity=ige.variable.getValue(action.quantity,vars);var itemData=ige.game.getAsset('itemTypes',itemTypeId);if(quantity==-1||!quantity){quantity=null;}if(itemData){itemData.itemTypeId=itemTypeId;itemData.isHidden=false;itemData.stateId='dropped';itemData.quantity=quantity;itemData.initialTransform={position:position,facingAngle:Math.random(0,700)/100};var item=new Item(itemData);}else{ige.script.errorLog('invalid item type data');}break;/* depreciated and can be removed */case'createItemWithMaxQuantityAtPosition':var itemTypeId=ige.variable.getValue(action.itemType,vars);var itemData=ige.game.getAsset('itemTypes',itemTypeId);var position=ige.variable.getValue(action.position,vars);var quantity=itemData.maxQuantity;if(quantity==-1){quantity=null;}if(itemData){itemData.itemTypeId=itemTypeId;itemData.isHidden=false;itemData.stateId='dropped';itemData.spawnPosition=position;itemData.quantity=quantity;itemData.defaultData={translate:position,rotate:Math.random(0,700)/100};var item=new Item(itemData);}else{ige.script.errorLog('invalid item type data');}break;case'spawnItem':var itemTypeId=ige.variable.getValue(action.itemType,vars);var itemData=ige.game.getAsset('itemTypes',itemTypeId);var position=ige.variable.getValue(action.position,vars);if(itemData){itemData.itemTypeId=itemTypeId;itemData.isHidden=false;itemData.stateId='dropped';itemData.defaultData={translate:position,rotate:Math.random(0,700)/100};var item=new Item(itemData);}else{ige.script.errorLog('invalid item type data');}break;case'giveNewItemToUnit':var itemTypeId=ige.variable.getValue(action.itemType,vars);var itemData=ige.game.getAsset('itemTypes',itemTypeId);var unit=ige.variable.getValue(action.unit,vars);if(itemData&&unit&&unit._category=='unit'){itemData.itemTypeId=itemTypeId;itemData.defaultData={translate:unit._translate,rotate:unit._rotate.z};unit.pickUpItem(itemData);}break;case'giveNewItemWithQuantityToUnit':var itemTypeId=ige.variable.getValue(action.itemType,vars);var itemData=ige.game.getAsset('itemTypes',itemTypeId);var unit=null;if(itemData){if(action.hasOwnProperty('number')){// this is new version of action
unit=ige.variable.getValue(action.unit,vars);quantity=ige.variable.getValue(action.number,vars);}else{// this is old version of action
unit=ige.variable.getValue(action.entity,vars);quantity=ige.variable.getValue(action.quantity,vars);}// -1 means infinite quantity
if(quantity==-1){quantity=null;}if(action.type==='giveNewItemToUnit'){quantity=itemData.quantity;}if(unit&&unit._category=='unit'){itemData.itemTypeId=itemTypeId;itemData.quantity=quantity;itemData.defaultData={translate:unit._translate,rotate:unit._rotate.z};unit.pickUpItem(itemData);}else// error log
{if(unit==undefined||unit._category!='unit')ige.script.errorLog('unit doesn\'t exist');// else
//  ige.script.errorLog("giveNewItemToUnit: cannot add item to unit's inventory")
}}break;case'makeUnitSelectItemAtSlot':var unit=ige.variable.getValue(action.unit,vars);var slotIndex=ige.variable.getValue(action.slotIndex,vars);slotIndex=slotIndex-1;if(unit){unit.changeItem(slotIndex);}else// error log
{if(unit==undefined||unit._category!='unit')ige.script.errorLog('unit doesn\'t exist');}break;/* Ads */case'playAdForEveryone':if(!ige.ad.lastPlayedAd||Date.now()-ige.ad.lastPlayedAd>=60000){ige.ad.play({type:'preroll'});ige.ad.lastPlayedAd=Date.now();}break;case'playAdForPlayer':if(action.entity){var unit=ige.variable.getValue(action.entity,vars);if(unit&&unit._stats&&unit._stats.clientId){if(!ige.ad.lastPlayedAd||Date.now()-ige.ad.lastPlayedAd>=60000){ige.ad.play({type:'preroll'},unit._stats.clientId);}}}break;case'makeUnitPickupItem':var item=ige.variable.getValue(action.item,vars);var unit=ige.variable.getValue(action.unit,vars);// pickup ownerLess items
if(unit&&unit._category=='unit'&&item&&item._category==='item'&&!item.getOwnerUnit()){unit.pickUpItem(item);}else// error log
{if(unit==undefined||unit._category!='unit')ige.script.errorLog('unit doesn\'t exist');}break;/* Sound */case'playSoundAtPosition':var position=ige.variable.getValue(action.position,vars);var sound=ige.game.data.sound[action.sound];// if csp enable dont stream sound
if(sound&&position){ige.network.send('sound',{id:action.sound,position:position});}break;/* Music */case'playMusic':var music=ige.game.data.music[action.music];// if csp enable dont stream music
if(music){ige.network.send('sound',{cmd:'playMusic',id:action.music});}break;case'stopMusic':ige.network.send('sound',{cmd:'stopMusic'});break;case'playSoundForPlayer':var sound=ige.game.data.sound[action.sound];var player=ige.variable.getValue(action.player,vars);if(sound&&player&&player._stats.clientId){ige.network.send('sound',{cmd:'playSoundForPlayer',sound:action.sound},player._stats.clientId);}break;case'stopSoundForPlayer':var sound=ige.game.data.sound[action.sound];var player=ige.variable.getValue(action.player,vars);if(sound&&player&&player._stats.clientId){ige.network.send('sound',{cmd:'stopSoundForPlayer',sound:action.sound},player._stats.clientId);}break;case'playMusicForPlayer':var music=ige.game.data.music[action.music];var player=ige.variable.getValue(action.player,vars);if(music&&player&&player._stats.clientId){ige.network.send('sound',{cmd:'playMusicForPlayer',music:action.music},player._stats.clientId);}break;case'playMusicForPlayerRepeatedly':var music=ige.game.data.music[action.music];var player=ige.variable.getValue(action.player,vars);if(music&&player&&player._category=='player'&&player._stats.clientId){ige.network.send('sound',{cmd:'playMusicForPlayerRepeatedly',music:action.music},player._stats.clientId);}break;case'showMenuAndSelectCurrentServer':var player=ige.variable.getValue(action.player,vars);if(player&&player._stats&&player._category=='player'&&player._stats.clientId){ige.network.send('ui',{command:'showMenuAndSelectCurrentServer'},player._stats.clientId);}break;case'showMenuAndSelectBestServer':var player=ige.variable.getValue(action.player,vars);if(player&&player._stats&&player._category=='player'&&player._stats.clientId){ige.network.send('ui',{command:'showMenuAndSelectBestServer'},player._stats.clientId);}break;case'stopMusicForPlayer':var player=ige.variable.getValue(action.player,vars);if(player&&player._category==='player'&&player._stats.clientId){ige.network.send('sound',{cmd:'stopMusicForPlayer'},player._stats.clientId);}break;/* Entity */case'flipEntitySprite':// console.log('flipUnitSprite:',action);
var entity=ige.variable.getValue(action.entity,vars);var flipCode=0;if(action.flip=='horizontal')flipCode=1;if(action.flip=='vertical')flipCode=2;if(action.flip=='both')flipCode=3;if(entity&&self.entityCategories.indexOf(entity._category)>-1){entity.streamUpdateData([{flip:flipCode}]);}break;case'applyForceOnEntityXY':case'applyForceOnEntityXYLT':// action.forceX
var entity=ige.variable.getValue(action.entity,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1){var forceX=ige.variable.getValue(action.force.x,vars);if(forceX==undefined||isNaN(forceX)){forceX=0;}var forceY=ige.variable.getValue(action.force.y,vars);if(forceY==undefined||isNaN(forceY)){forceY=0;}entity.applyForce(forceX,forceY);}else{ige.script.errorLog('invalid entity');}break;/* Entity */case'applyImpulseOnEntityXY':var entity=ige.variable.getValue(action.entity,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1){var impulseX=ige.variable.getValue(action.impulse.x,vars);if(impulseX==undefined||isNaN(impulseX)){impulseX=0;}var impulseY=ige.variable.getValue(action.impulse.y,vars);if(impulseY==undefined||isNaN(impulseY)){impulseY=0;}entity.applyImpulse(impulseX,impulseY);}else{ige.script.errorLog('invalid entity');}break;case'applyForceOnEntityXYRelative':var entity=ige.variable.getValue(action.entity,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1){var radians=entity._rotate.z+Math.radians(-90);// entity's facing angle
var forceX=ige.variable.getValue(action.force.x,vars);if(forceX==undefined||isNaN(forceX)){forceX=0;}var forceY=ige.variable.getValue(action.force.y,vars);if(forceY==undefined||isNaN(forceY)){forceY=0;}var force={x:Math.cos(radians)*forceY+Math.cos(radians)*forceX,y:Math.sin(radians)*forceY+Math.sin(radians)*forceX};// console.log('force angle is', force);
entity.applyForce(force.x,force.y);}break;case'applyForceOnEntityAngle':var entity=ige.variable.getValue(action.entity,vars);var angle=ige.variable.getValue(action.angle,vars);var force=ige.variable.getValue(action.force,vars);var radians=angle-Math.radians(90);// entity's facing angle
if(!isNaN(radians)&&!isNaN(force)&&entity&&self.entityCategories.indexOf(entity._category)>-1){force={x:Math.cos(radians)*force,y:Math.sin(radians)*force};entity.applyForce(force.x,force.y);}break;case'applyForceOnEntityAngleLT':var entity=ige.variable.getValue(action.entity,vars);var angle=ige.variable.getValue(action.angle,vars);var force=ige.variable.getValue(action.force,vars);var radians=angle-Math.radians(90);// entity's facing angle
if(!isNaN(radians)&&!isNaN(force)&&entity&&self.entityCategories.indexOf(entity._category)>-1){force={x:Math.cos(radians)*force,y:Math.sin(radians)*force};// entity.applyForceLT(force.x, force.y);
entity.applyForce(force.x,force.y);}break;case'createEntityForPlayerAtPositionWithDimensions':case'createEntityAtPositionWithDimensions':let isSandbox=typeof mode==='string'&&mode==='sandbox';let entityType=ige.variable.getValue(action.entityType,vars);let entityToCreate=ige.variable.getValue(action.entity,vars);var position=ige.variable.getValue(action.position,vars);var height=ige.variable.getValue(action.height,vars)||100;var width=ige.variable.getValue(action.width,vars)||100;var angle=ige.variable.getValue(action.angle,vars)||0;const entityTypeData=ige.game.data[entityType]&&ige.game.data[entityType][entityToCreate];if(entityType&&entityToCreate&&position&&height&&width){let data=Object.assign({},entityTypeData);position.x=parseFloat(position.x);position.y=parseFloat(position.y);angle=parseFloat(angle);var angleInRadians=Math.radians(angle);height=parseFloat(height);width=parseFloat(width);let createdEntity=null;if(entityType==='itemTypes'){data.itemTypeId=entityToCreate;data.isHidden=false;data.stateId='dropped';data.defaultData={translate:position,rotate:angleInRadians};data.height=height;data.width=width;data.scaleDimensions=true;createdEntity=new Item(_.cloneDeep(data));ige.game.lastCreatedItemId=createdEntity._id;}else if(entityType==='projectileTypes'){data=Object.assign(data,{type:entityToCreate,bulletForce:force,sourceItemId:undefined,sourceUnitId:unitId,defaultData:{translate:position,rotate:angleInRadians},height:height,width:width,scaleDimensions:true,streamMode:1});createdEntity=new Projectile(_.cloneDeep(data));ige.game.lastCreatedProjectileId=createdEntity._id;}else if(entityType==='unitTypes'){data=Object.assign(data,{type:entityToCreate,defaultData:{translate:position,rotate:angleInRadians},height:height,width:width,scaleDimensions:true});if(isSandbox){createdEntity=new Unit(data);}else{var player=ige.variable.getValue(action.player,vars);if(player){createdEntity=player.createUnit(_.cloneDeep(data));}}ige.game.lastCreatedUnitId=createdEntity._id;}createdEntity.scriptValues={index:i,x:position.x,y:position.y,type:entityType,player:action.player&&action.player.variableName,entity:entityToCreate,rotation:angle,height:height,width:width};if(isSandbox){if(!ige.game.createdEntities)ige.game.createdEntities=[];ige.game.createdEntities.push(createdEntity);}}break;case'setEntityDepth':var entity=ige.variable.getValue(action.entity,vars);var depth=ige.variable.getValue(action.depth,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&typeof depth==='number'){entity.streamUpdateData([{depth:depth}]);}break;case'setEntityLifeSpan':var entity=ige.variable.getValue(action.entity,vars);var lifespan=ige.variable.getValue(action.lifeSpan,vars);if(entity&&lifespan!=undefined&&!isNaN(parseFloat(lifespan))){entity.lifeSpan(lifespan);}break;case'setEntityAttribute':var attrId=ige.variable.getValue(action.attribute,vars);var value=ige.variable.getValue(action.value,vars);var entity=ige.variable.getValue(action.entity,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&entity._stats.attributes&&entity._stats.attributes[attrId]!=undefined&&value!=undefined){var isAttributeVisible=false;var attribute=entity._stats.attributes[attrId];if(entity._category==='player'){isAttributeVisible=!!attribute.isVisible;}else{isAttributeVisible=attribute.isVisible instanceof Array&&attribute.isVisible.length>0;}entity.attribute.update(attrId,value,isAttributeVisible);// update attribute, and check for attribute becoming 0
}break;case'setEntityAttributeMin':var attrId=ige.variable.getValue(action.attribute,vars);var entity=ige.variable.getValue(action.entity,vars);var minValue=ige.variable.getValue(action.value,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&entity._stats.attributes[attrId]!=undefined&&!isNaN(minValue)){// entity.attribute.setMin(attrId, minValue);
var min={};min[attrId]=minValue;entity.streamUpdateData([{attributesMin:min}]);}break;case'setEntityAttributeMax':var attrId=ige.variable.getValue(action.attribute,vars);var entity=ige.variable.getValue(action.entity,vars);var maxValue=ige.variable.getValue(action.value,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&entity._stats.attributes[attrId]!=undefined&&!isNaN(maxValue)){// entity.attribute.setMax(attrId, maxValue);
var max={};max[attrId]=maxValue;entity.streamUpdateData([{attributesMax:max}]);}break;case'setEntityAttributeRegenerationRate':var attrId=ige.variable.getValue(action.attribute,vars);var entity=ige.variable.getValue(action.entity,vars);var regenerationValue=ige.variable.getValue(action.value,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&entity._stats.attributes[attrId]!=undefined&&!isNaN(regenerationValue)){// entity.attribute.setRegenerationSpeed(attrId, regenerationValue);
var regenerationSpeed={};regenerationSpeed[attrId]=regenerationValue;entity.streamUpdateData([{attributesRegenerateRate:regenerationSpeed}]);}break;case'addAttributeBuffToUnit':var attrId=ige.variable.getValue(action.attribute,vars);var value=ige.variable.getValue(action.value,vars);var entity=ige.variable.getValue(action.entity,vars);var time=ige.variable.getValue(action.time,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&entity._stats.attributes&&entity._stats.attributes[attrId]!=undefined&&value!=undefined&&entity._stats.buffs){var isAttributeVisible=false;/* if (entity._category === 'player') {
                                isAttributeVisible = !!attribute.isVisible;
                            }
                            else {
                                isAttributeVisible = attribute.isVisible instanceof Array && attribute.isVisible.length > 0;
                            } */entity.addAttributeBuff(attrId,value,time,false);// update attribute, and check for attribute becoming 0
}break;case'addPercentageAttributeBuffToUnit':var attrId=ige.variable.getValue(action.attribute,vars);var value=ige.variable.getValue(action.value,vars);var entity=ige.variable.getValue(action.entity,vars);var time=ige.variable.getValue(action.time,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&entity._stats.attributes&&entity._stats.attributes[attrId]!=undefined&&value!=undefined&&entity._stats.buffs){var isAttributeVisible=false;/* if (entity._category === 'player') {
                                isAttributeVisible = !!attribute.isVisible;
                            }
                            else {
                                isAttributeVisible = attribute.isVisible instanceof Array && attribute.isVisible.length > 0;
                            } */entity.addAttributeBuff(attrId,value,time,true);// update attribute, and check for attribute becoming 0
}break;case'removeAllAttributeBuffs':var unit=ige.variable.getValue(action.unit,vars);if(unit&&unit._stats&&unit._stats.buffs){for(var i=0;i<unit._stats.buffs.length;i++){unit._stats.buffs[i].timeLimit=0;}}break;case'moveEntity':var position=ige.variable.getValue(action.position,vars);var entity=ige.variable.getValue(action.entity,vars);if(position&&entity&&['unit','item','projectile'].includes(entity._category)){entity.teleportTo(position.x,position.y,entity._rotate.z);}break;case'destroyEntity':var entity=ige.variable.getValue(action.entity,vars);if(this._category=='item'&&this._stats.name=='Floaty'){console.trace();}if(entity&&self.entityCategories.indexOf(entity._category)>-1){entity.remove();}else{ige.script.errorLog('invalid unit');}break;case'setEntityVariable':var entity=ige.variable.getValue(action.entity,vars);var variable=ige.variable.getValue(action.variable,vars);var value=ige.variable.getValue(action.value,vars);if(variable&&entity&&entity.variables&&entity.variables[variable.key]){var isDataTypeSame=false;var variableObj=entity.variables[variable.key];// variables can not set to undefined via action
switch(variableObj.dataType){case'string':case'boolean':case'number':{isDataTypeSame=typeof value===variableObj.dataType;break;}case'position':{isDataTypeSame=typeof value==='object'&&value.x&&value.y;break;}case'item':case'player':case'unit':{isDataTypeSame=typeof value==='object'&&value._category===variableObj.dataType;break;}default:{// figure out how to validate for other types like itemType, unitType, ..., etc.
isDataTypeSame=true;break;}}if(isDataTypeSame){variableObj.value=value;}else if(typeof value==='undefined'&&action.value&&action.value.function==='undefinedValue'){// dev intentionally set value as undefined
variableObj.value=undefined;// if variable has default field then it will be returned when variable's value is undefined
if(variableObj.default){variableObj.default=undefined;}}else{ige.devLog('datatype of value does not match datatype of variable');}}break;case'rotateEntityToRadians':case'rotateEntityToRadiansLT':// No more LT.
var entity=ige.variable.getValue(action.entity,vars);var radians=ige.variable.getValue(action.radians,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&radians!==undefined&&!isNaN(radians)){// hack to rotate entity properly
entity.rotateTo(0,0,radians);}break;case'rotateEntityToFacePosition':var entity=ige.variable.getValue(action.entity,vars);var position=ige.variable.getValue(action.position,vars);if(!position||!entity)break;if(entity._category==='item'&&entity._stats.currentBody&&entity._stats.currentBody.jointType==='weldJoint'){break;}var pos={// displacement between entity and given position (e.g. mouse cursor)
x:entity._translate.x-position.x,y:entity._translate.y-position.y};var offset=Math.PI*3/2;var newFacingAngle=Math.atan2(pos.y,pos.x)+offset;if(self.entityCategories.indexOf(entity._category)>-1&&position.x!=undefined&&position.y!=undefined){if(ige.isServer){var oldFacingAngle=entity._rotate.z;// var rotateDiff = (newFacingAngle - (oldFacingAngle % (Math.PI * 2))) % (Math.PI * 2)
// if (rotateDiff > Math.PI) {
//     rotateDiff = - (2 * Math.PI) % rotateDiff
// }
// else if (rotateDiff < -Math.PI) {
//     rotateDiff = (2 * Math.PI) % rotateDiff
// }
// if (!isNaN(rotateDiff)) {
//     entity.rotateBy(0, 0, -rotateDiff);
// }
entity.rotateTo(0,0,newFacingAngle);// console.log('rotating')
}// &&
else if(ige.isClient&&ige.client.myPlayer&&(entity==ige.client.selectedUnit||entity.getOwner()==ige.client.selectedUnit)){if(entity._category==='item'){console.log(newFacingAngle);}entity.rotateTo(0,0,newFacingAngle);// force timeStream to process rotation right away
// entity._keyFrames.push([ige.network.stream._streamDataTime, [entity._translate.x, entity._translate.y, newFacingAngle]]);
}}break;case'rotateEntityToFacePositionUsingRotationSpeed':var entity=ige.variable.getValue(action.entity,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1){var position=ige.variable.getValue(action.position,vars);if(position&&position.x!=undefined&&position.y!=undefined){pos={x:entity._translate.x-position.x,y:entity._translate.y-position.y};var rotationSpeed=entity._stats.currentBody.rotationSpeed;var ninetyDegreesInRadians=90*Math.PI/180;var newFacingAngle=Math.atan2(pos.y,pos.x)-ninetyDegreesInRadians;var oldFacingAngle=entity._rotate.z;// Prevents the rotation bug that caused units to counter rotate it looked to left
rotateDiff=(newFacingAngle-oldFacingAngle%(Math.PI*2))%(Math.PI*2);if(rotateDiff>Math.PI){rotateDiff=-(2*Math.PI)%rotateDiff;}else if(rotateDiff<-Math.PI){rotateDiff=2*Math.PI%rotateDiff;}var degDiff=rotateDiff/0.05;// 0.0174533 is degree to radian conversion
var torque=degDiff>0?Math.min(degDiff,rotationSpeed):Math.max(degDiff,rotationSpeed*-1);entity.applyTorque(torque);// entity.body.applyTorque(torque);
}else{// ige.script.errorLog( action.type + " - invalid position")
}}else{// ige.script.errorLog( action.type + " - invalid unit")
}break;/* AI */case'setUnitTargetPosition':// deprecated
var unit=ige.variable.getValue(action.unit,vars);var position=ige.variable.getValue(action.position,vars);if(unit&&unit.ai&&position){unit.ai.moveToTargetPosition(position.x,position.y);}break;case'setUnitTargetUnit':// deprecated
var unit=ige.variable.getValue(action.unit,vars);var targetUnit=ige.variable.getValue(action.targetUnit,vars);if(unit&&unit.ai&&targetUnit){unit.ai.attackUnit(targetUnit);}break;case'aiMoveToPosition':var unit=ige.variable.getValue(action.unit,vars);var position=ige.variable.getValue(action.position,vars);if(unit&&unit.ai&&position){unit.ai.moveToTargetPosition(position.x,position.y);}break;case'aiAttackUnit':var unit=ige.variable.getValue(action.unit,vars);var targetUnit=ige.variable.getValue(action.targetUnit,vars);if(unit&&unit.ai&&targetUnit){unit.ai.attackUnit(targetUnit);}break;case'makePlayerTradeWithPlayer':var playerA=ige.variable.getValue(action.playerA,vars);var playerB=ige.variable.getValue(action.playerB,vars);if(playerA&&playerB&&playerA._category==='player'&&playerB._category==='player'){if(!playerB.isTrading){ige.network.send('trade',{type:'init',from:playerA.id()},playerB._stats.clientId);}else{var message=`${playerB._stats.name}is busy`;ige.chat.sendToRoom('1',message,playerA._stats.clientId,undefined);}}break;case'applyTorqueOnEntity':var entity=ige.variable.getValue(action.entity,vars);var torque=ige.variable.getValue(action.torque,vars);if(entity&&torque){entity.applyTorque(torque);}// apply torque on entity here
break;case'attachEntityToEntity':var entity=ige.variable.getValue(action.entity,vars);var targetEntity=ige.variable.getValue(action.targetingEntity,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&targetEntity&&self.entityCategories.indexOf(targetEntity._category)>-1){entity.attachTo(targetEntity);}break;case'changeScaleOfEntitySprite':var entity=ige.variable.getValue(action.entity,vars);var scale=ige.variable.getValue(action.scale,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&!isNaN(scale)){entity.streamUpdateData([{scale:parseFloat(scale).toFixed(2)}]);}break;case'changeScaleOfEntityBody':var entity=ige.variable.getValue(action.entity,vars);var scale=ige.variable.getValue(action.scale,vars);if(entity&&self.entityCategories.indexOf(entity._category)>-1&&!isNaN(scale)){entity.streamUpdateData([{scaleBody:parseFloat(scale).toFixed(2)}]);}break;case'setEntityState':var entity=ige.variable.getValue(action.entity,vars);var stateId=action.state;if(entity&&self.entityCategories.indexOf(entity._category)>-1){entity.setState(stateId);}break;case'increaseVariableByNumber':var newValue=ige.variable.getValue(action.number,vars);if(ige.game.data.variables.hasOwnProperty(action.variable)&&!_.isNaN(newValue)&&!_.isNil(newValue)){var variable=ige.game.data.variables[action.variable];if(variable.value===undefined||isNaN(variable.value)){variable=variable.default||0;}variable.value+=newValue;}break;case'decreaseVariableByNumber':var newValue=ige.variable.getValue(action.number,vars);if(ige.game.data.variables.hasOwnProperty(action.variable)&&!_.isNaN(newValue)&&!_.isNil(newValue)){var variable=ige.game.data.variables[action.variable];if(variable.value===undefined||isNaN(variable.value)){variable=variable.default||0;}variable.value-=newValue;}break;case'loadPlayerDataAndApplyIt':var player=ige.variable.getValue(action.player,vars);if(player){if(player.persistedData){player.loadPersistentData();console.log('player data loaded');if(action.unit){var unit=ige.variable.getValue(action.unit,vars);if(unit){unit.loadPersistentData();console.log('unit data loaded');}}}}break;case'loadUnitData':var unit=ige.variable.getValue(action.unit,vars);var owner=unit.getOwner();if(unit&&owner&&owner.persistedData){unit.loadPersistentData();}break;case'loadUnitDataFromString':var unit=ige.variable.getValue(action.unit,vars);try{var data=JSON.parse(ige.variable.getValue(action.string,vars));}catch(err){console.error(err);return;}if(unit&&data){unit.loadDataFromString(data);}break;case'loadPlayerDataFromString':var player=ige.variable.getValue(action.player,vars);try{var data=JSON.parse(ige.variable.getValue(action.string,vars));}catch(err){console.error(err);return;}if(player&&data){player.loadDataFromString(data);}break;case'loadPlayerData':var player=ige.variable.getValue(action.player,vars);if(player&&player.persistedData){player.loadPersistentData();}break;case'comment':break;default:// console.log('trying to run', action);
break;}}catch(e){console.log(e);ige.script.errorLog(e);// send error msg to client
}}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ActionComponent;};var ConditionComponent=$i_56.extend({classId:'ConditionComponent',componentId:'condition',init:function(entity,options){var self=this;},run:function(items,vars){if(items==undefined||items.length<=0){return true;}const[opObj,left,right]=items;var op=opObj.operator;var leftVar=ige.variable.getValue(left,vars);var rightVar=ige.variable.getValue(right,vars);// if the operands are igeEntities, then compare their id's
if(leftVar&&leftVar._id!=undefined&&rightVar&&rightVar._id!=undefined){leftVar=leftVar._id;rightVar=rightVar._id;}// ige.script.scriptLog("condition comparing two variables: "+JSON.stringify(left)+op+JSON.stringify(right)+"\n")
// ige.script.scriptLog("condition comparing: "+ leftVar+" "+ op +" " + rightVar+'\n')
if(op=='AND'){return this.run(left,vars)&&this.run(right,vars);}else if(op=='OR'){return this.run(left,vars)||this.run(right,vars);}else if(op=='=='){if(rightVar==undefined){rightVar=!!rightVar;}if(leftVar==undefined){leftVar=!!leftVar;}if(typeof leftVar!='object'){var leftVar=JSON.stringify(leftVar);}if(typeof rightVar!='object'){var rightVar=JSON.stringify(rightVar);}return leftVar==rightVar;// stringify is important for comparisons like region comparison
}else if(op=='!='){return leftVar!=rightVar;}else if(op=='<'){return leftVar<rightVar;}else if(op=='>'){return leftVar>rightVar;}else if(op=='<='){return leftVar<=rightVar;}else if(op=='>='){return leftVar>=rightVar;}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=ConditionComponent;};var AbilityComponent=$i_56.extend({classId:'AbilityComponent',componentId:'ability',init:function(entity,options){var self=this;self._entity=entity;},moveUp:function(){if(this._entity.direction){this._entity.direction.y=-1;// entity.body.setLinearVelocity(new $i_5(velocityX, velocityY, 0));
}},moveLeft:function(){if(this._entity.direction){this._entity.direction.x=-1;// this._entity.body.setLinearVelocity(new $i_5(velocityX, velocityY, 0));
}},moveDown:function(){if(this._entity.direction){this._entity.direction.y=1;// this._entity.body.setLinearVelocity(new $i_5(velocityX, velocityY, 0));
}},moveRight:function(){if(this._entity.direction){this._entity.direction.x=1;// this._entity.body.setLinearVelocity(new $i_5(velocityX, velocityY, 0));
}},stopMovingY:function(){if(this._entity.direction){this._entity.direction.y=0;// only velocity-based units will stop immediately
// if (this._entity._stats.controls.movementMethod == 'velocity') {
// 	this._entity.body.setLinearVelocity(new $i_5(this._entity.body.getLinearVelocity().x, 0, 0));
// }
}},stopMovingX:function(){if(this._entity.direction){this._entity.direction.x=0;// only velocity-based units will stop immediately
// if (this._entity._stats.controls.movementMethod == 'velocity') {
// 	this._entity.body.setLinearVelocity(new $i_5(0, this._entity.body.getLinearVelocity().y, 0));
// }
}},startUsingItem:function(){var item=this._entity.getCurrentItem();if(item){item.startUsing();}},stopUsingItem:function(){var item=this._entity.getCurrentItem();if(item){item.stopUsing();}},pickupItem:function(){var self=this;if(ige.isServer){var region={x:self._entity._translate.x-self._entity._bounds2d.x/2,y:self._entity._translate.y-self._entity._bounds2d.y/2,width:self._entity._bounds2d.x,height:self._entity._bounds2d.y};var entities=ige.physics.getBodiesInRegion(region).filter(({_category})=>_category==='item');// pickup ownerLess items
var unit=self._entity;unit.reasonForFailingToPickUpItem=undefined;if(unit&&unit._category=='unit'){for(var i=0;i<entities.length;i++){var item=entities[i];if(item&&item._category==='item'&&!item.getOwnerUnit()){// only pick 1 item up at a time
if(unit.pickUpItem(item)){return;}}}if(unit.reasonForFailingToPickUpItem){unit.streamUpdateData([{setFadingText:unit.reasonForFailingToPickUpItem,color:'red'}]);}}}},dropItem:function(){var self=this;if(self._entity&&!isNaN(self._entity._stats.currentItemIndex)){var item=self._entity.dropItem(self._entity._stats.currentItemIndex);if(item){// slightly push item in front of the unit
var rotate=self._entity.angleToTarget;var vector={x:20*Math.sin(rotate),y:-(20*Math.cos(rotate))};item.applyForce(vector.x,vector.y);}}},cast:function(handle){var self=this;if(handle==undefined)return;var ability=null;if(handle.cost&&handle.scriptName){ability=handle;}else{ability=ige.game.data.abilities[handle];}var player=self._entity.getOwner();if(ability!=undefined){var canAffordCost=true;if(ability.cost&&ability.cost.unitAttributes){// AbilityComponent.prototype.log("ability cost", ability.cost.cast)
for(attrName in ability.cost.unitAttributes){var cost=ability.cost.unitAttributes[attrName];if(cost&&(self._entity._stats.attributes[attrName]==undefined||self._entity._stats.attributes[attrName].value<cost)){canAffordCost=false;break;}}}if(ability.cost&&ability.cost.playerAttributes&&canAffordCost&&player&&player._stats){// AbilityComponent.prototype.log("ability cost", ability.cost.cast)
for(attrName in ability.cost.playerAttributes){var cost=ability.cost.playerAttributes[attrName];// AbilityComponent.prototype.log("attribute value", attrName, self._entity._stats.attributes[attrName])
if(cost&&(player._stats.attributes[attrName]==undefined||player._stats.attributes[attrName].value<cost)){canAffordCost=false;break;}}}if(canAffordCost){// process cost
var unitAttr={attributes:{}};if(ability.cost&&ability.cost.unitAttributes){for(attrName in ability.cost.unitAttributes){if(self._entity._stats.attributes[attrName]){self._entity._stats.attributes[attrName].value-=ability.cost.unitAttributes[attrName];unitAttr.attributes[attrName]=self._entity._stats.attributes[attrName].value;}}}var playerAttr={attributes:{}};if(ability.cost&&ability.cost.playerAttributes&&player&&player._stats){for(attrName in ability.cost.playerAttributes){if(player._stats.attributes[attrName]){player._stats.attributes[attrName].value-=ability.cost.playerAttributes[attrName];playerAttr.attributes[attrName]=player._stats.attributes[attrName].value;}}}if(ige.isServer||ige.isClient&&ige.physics){if(ability.scriptName&&ability.scriptName!=''){if(ige.game.data.scripts[ability.scriptName]){AbilityComponent.prototype.log(`ability cast: running script ${ige.game.data.scripts[ability.scriptName].name} ${ability.scriptName}`);}if(ige.isServer){// calling stream for unit because there is delay in transferring attributes data
if(Object.keys(unitAttr.attributes||[]).length>0){self._entity.streamUpdateData(unitAttr);}if(Object.keys(playerAttr.attributes||[]).length>0){player.streamUpdateData(playerAttr);}}ige.game.lastCastingUnitId=self._entity.id();ige.script.runScript(ability.scriptName,{triggeredBy:{unitId:self._entity.id()}});}}}else{AbilityComponent.prototype.log('can\'t afford cost');}}else{AbilityComponent.prototype.log(`undefined ability ${handle}`);}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=AbilityComponent;};var AttributeComponent=$i_56.extend({classId:'AttributeComponent',componentId:'attribute',init:function(entity,options){var self=this;self._entity=entity;self.now=Date.now();self.lastRegenerated=self.now;self.lastSynced=self.now;},// decay / regenerate
regenerate:function(){var self=this;self.now=Date.now();// reneration happens every 200ms
if(self.now-self.lastRegenerated>200){self.lastRegenerated=self.now+(self.now-self.lastRegenerated-200);var attributes=self._entity._stats.attributes;for(attributeTypeId in attributes){var attr=attributes[attributeTypeId];if(attr&&attr.regenerateSpeed){var oldValue=parseFloat(attr.value);var newValue=oldValue+parseFloat(attr.regenerateSpeed);newValue=Math.max(attr.min,Math.min(attr.max,parseFloat(newValue)));if(oldValue!=newValue){self.update(attributeTypeId,newValue,newValue===attr.max);}}}}},// update UI
refresh:function(){var self=this;var attributes=self._entity._stats.attributes;for(var attributeTypeId in attributes){var attr=attributes[attributeTypeId];// if unit is my unit, update UI
if(ige.isClient&&ige.network.id()==self._entity._stats.clientId){if(attr.isVisible){self._entity.unitUi.updateAttributeBar(attr);}}}},updatePassiveAttributes:function(removeAttribute,currentItemId,unitTypeChange,persistedData){// reset unit attribute
var self=this;var unit=self._entity;// update stats of only selectedItem
var itemIds=unit._stats.itemIds.filter(function(itemId){if(currentItemId){return itemId==currentItemId;}return itemId;});var unitType=ige.game.getAsset('unitTypes',unit._stats.type);var defaultUnitAttributes=unitType?unitType.attributes:undefined;var player=unit.getOwner();if(player){var playerType=ige.game.getAsset('playerTypes',player._stats.playerTypeId);var defaultPlayerAttributes=playerType?playerType.attributes:undefined;}var unitAttr={attributes:{},attributesMax:{}};var playerAttr={attributes:{},attributesMax:{}};for(var i=0;i<itemIds.length;i++){var item=ige.$(itemIds[i]);if(item){if(item&&item._stats.bonus&&item._stats.bonus.passive&&unit){// passive unit attribute bonus
var unitAttributePassiveBonuses=item._stats.bonus.passive.unitAttribute;if(unitAttributePassiveBonuses){for(var attrId in unitAttributePassiveBonuses){var selectedAttribute=unit._stats.attributes[attrId];var bonus=unitAttributePassiveBonuses[attrId];if(selectedAttribute&&bonus){var currentAttributeValue=parseFloat(self.getValue(attrId))||1;var maxValue=parseFloat(selectedAttribute.max);if(currentAttributeValue!=undefined&&bonus&&unit._stats.attributes[attrId]){if(removeAttribute){if(bonus.type==='percentage'){var newValue=currentAttributeValue/(1+parseFloat(bonus.value)/100);var newMax=maxValue/(1+parseFloat(bonus.value)/100);}else{var newMax=maxValue-parseFloat(bonus.value);var newValue=Math.min(newMax,Math.max(selectedAttribute.min,currentAttributeValue));}}else{if(bonus.type==='percentage'){var newValue=currentAttributeValue*(1+parseFloat(bonus.value)/100);var newMax=maxValue*(1+parseFloat(bonus.value)/100);}else{var newMax=maxValue+parseFloat(bonus.value);var newValue=Math.min(newMax,Math.max(selectedAttribute.min,currentAttributeValue));}}unit._stats.attributes[attrId].value=newValue;unitAttr.attributes[attrId]=newValue;unit._stats.attributes[attrId].max=newMax;unitAttr.attributesMax[attrId]=unit._stats.attributes[attrId].max;}}}}var playerAttributePassiveBonuses=item._stats.bonus.passive.playerAttribute;if(playerAttributePassiveBonuses&&player&&player._stats.attributes&&!unitTypeChange){for(attrId in playerAttributePassiveBonuses){var selectedAttribute=player._stats.attributes[attrId];if(selectedAttribute){var currentAttributeValue=parseFloat(player.attribute.getValue(attrId))||1;var bonus=playerAttributePassiveBonuses[attrId];var maxValue=parseFloat(selectedAttribute.max);if(currentAttributeValue!=undefined&&bonus&&player._stats.attributes[attrId]){// this condition check if attribute value is directly applyed from server side then not update on client side
if(removeAttribute){if(bonus.type==='percentage'){var newValue=currentAttributeValue/(1+parseFloat(bonus.value)/100);var newMax=maxValue/(1+parseFloat(bonus.value)/100);}else{var newMax=maxValue-parseFloat(bonus.value);var newValue=Math.min(newMax,Math.max(selectedAttribute.min,currentAttributeValue));}}else{if(bonus.type==='percentage'){var newValue=currentAttributeValue*(1+parseFloat(bonus.value)/100);var newMax=maxValue*(1+parseFloat(bonus.value)/100);}else{var newMax=maxValue+parseFloat(bonus.value);var newValue=Math.min(newMax,Math.max(selectedAttribute.min,currentAttributeValue));}}player._stats.attributes[attrId].value=newValue;playerAttr.attributes[attrId]=newValue;player._stats.attributes[attrId].max=newMax;playerAttr.attributesMax[attrId]=player._stats.attributes[attrId].max;}}}}}}}if(!unitTypeChange&&!persistedData){if(unit){// obj to array conversion
data=[];for(key in unitAttr){data.push(unitAttr[key]);}unit.streamUpdateData(data);}if(player){// obj to array conversion
data=[];for(key in playerAttr){data.push(playerAttr[key]);}player.streamUpdateData(data);}}},// change attribute's value manually
update:function(attributeTypeId,newValue,forceUpdate){var self=this;if(!self._entity._stats||!self._entity._stats.attributes){return;}var attributes=JSON.parse(JSON.stringify(self._entity._stats.attributes));// clone units existing attribute values
if(attributes){var attribute=attributes[attributeTypeId];if(attribute){attribute.type=attributeTypeId;// tracking what "triggering attributeType" is in variableComponent.
var min=parseFloat(attribute.min);var max=parseFloat(attribute.max);var oldValue=parseFloat(attribute.value);var newValue=Math.max(min,Math.min(max,parseFloat(newValue)));self._entity._stats.attributes[attributeTypeId].value=newValue;if(ige.isServer){if(newValue!=oldValue){// force sync with client every 5 seconds
if(self._entity&&self._entity._stats&&self._entity._stats.attributes&&self._entity._stats.attributes[attributeTypeId]&&self._entity._stats.attributes[attributeTypeId].lastSyncedValue!=newValue&&(// value is different from last sync'ed value and...
forceUpdate||// forceUpdate triggered
self._entity._stats.attributes[attributeTypeId].lastSynced==undefined||// it's never been sync'ed with client's attributes before or..
self.now-self._entity._stats.attributes[attributeTypeId].lastSynced>5000// it's been over 5 seconds since we last sync'ed
)){self._entity._stats.attributes[attributeTypeId].lastSynced=self.now;self._entity._stats.attributes[attributeTypeId].lastSyncedValue=newValue;attrData={attributes:{}};attrData.attributes[attributeTypeId]=newValue;self._entity.streamUpdateData([attrData]);}var triggeredBy={attribute:attribute};triggeredBy[`${this._entity._category}Id`]=this._entity.id();if(newValue<=0&&oldValue>0)// when attribute becomes zero, trigger attributeBecomesZero event
{// unit's health became 0. announce death
if(self._entity._category=='unit'&&attributeTypeId=='health'){self._entity.ai.announceDeath();}ige.trigger.fire(`${this._entity._category}AttributeBecomesZero`,triggeredBy);}else if(newValue>=attribute.max)// when attribute becomes full, trigger attributeBecomesFull event
{// console.log("update attr fire!")
ige.trigger.fire(`${this._entity._category}AttributeBecomesFull`,triggeredBy);}// check if user breaks his highscore then assign it to new highscore
if(attributeTypeId==ige.game.data.settings.scoreAttributeId&&self._entity._stats.highscore<newValue){if(!self._entity._stats.newHighscore){ige.gameText.alertHighscore(self._entity._stats.clientId);}self._entity._stats.newHighscore=newValue;}}}else if(ige.isClient){if(ige.client.myPlayer){var unit=null;attribute.hasChanged=newValue!==oldValue;switch(self._entity._category){case'unit':{unit=self._entity;attribute.value=newValue;if(ige.client.myPlayer._stats.selectedUnitId==unit.id()){self._entity.unitUi.updateAttributeBar(attribute);}self._entity.updateAttributeBar(attribute);break;}case'item':{var item=self._entity;unit=item.getOwnerUnit();// if (unit && ige.client.myPlayer._stats.selectedUnitId == unit.id()) {
// 	item.updateAttributeBar(attribute);
// 	if (attribute && attribute.isVisible && attribute.isVisible.includes('itemDescription')) {
// 		ige.itemUi.updateItemSlot(item, item._stats.slotIndex);
// 	}
// }
break;}case'projectile':{var projectile=self._entity;var item=projectile.getSourceItem();unit=item&&item.getOwnerUnit();if(unit&&ige.client.myPlayer._stats.selectedUnitId==unit.id()){projectile.updateAttributeBar(attribute);}break;}}}}return newValue;}}},// get attribute value
getValue:function(attrId){var attributes=this._entity._stats.attributes;if(attributes&&attributes[attrId]){return attributes[attrId].value;}else{// var stats = this._entity._stats
return undefined;}},setMax:function(attrId,value){var attributes=this._entity._stats.attributes;if(attributes){var attribute=attributes[attrId];if(attribute){attribute.max=value;if(ige.isServer){var attribute={attributesMax:{}};attribute.attributesMax[attrId]=value;this._entity.streamUpdateData([attribute]);// ige.network.send('updateEntityAttribute', {
// 	"e": this._entity._id,
// 	"a": attrId,
// 	"x": value,
// 	'p': 'max'
// });
}}}},setMin:function(attrId,value){var self=this;var attributes=this._entity._stats.attributes;if(attributes){var attribute=attributes[attrId];if(attribute){// attribute.min = value
if(ige.isServer){var attribute={attributesMin:{}};attribute.attributesMin[attrId]=value;this._entity.streamUpdateData([attribute]);// ige.network.send('updateEntityAttribute', {
// 	"e": this._entity._id,
// 	"a": attrId,
// 	"x": value,
// 	'p': 'min'
// });
}}}},setRegenerationSpeed:function(attrId,value){var self=this;var attributes=this._entity._stats.attributes;if(attributes){var attribute=attributes[attrId];if(attribute){attribute.regenerateSpeed=value;if(ige.isServer){ige.network.send('updateEntityAttribute',{e:this._entity._id,a:attrId,x:value,p:'regenerateSpeed'});}}}},destroy:function(){clearInterval(this.regenTick);$i_56.prototype.destroy.call(this);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=AttributeComponent;};var Cursor=$i_56.extend({classId:'Cursor',init:function(){$i_56.prototype.init.call(this);var self=this;if(ige.isClient){var tex=new $i_50(`${ige.map.mapUrl}/spritesheet/baseball_bat.png`);self.depth(10).layer(20).width(50).height(50).texture(tex);}},/**
	 * Called every frame by the engine when this entity is mounted to the scenegraph.
	 * @param ctx The canvas context to render to.
	 */tick:function(ctx){// Call the $i_56 (super-class) tick() method
$i_56.prototype.tick.call(this,ctx);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=Cursor;};(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=typeof require=='function'&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(`Cannot find module '${i}'`);throw a.code='MODULE_NOT_FOUND',a;}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r);},p,p.exports,r,e,n,t);}return n[i].exports;}for(var u=typeof require=='function'&&require,i=0;i<t.length;i++)o(t[i]);return o;}return r;})()({1:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var utils=require('./utils');var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(Bounce,_Plugin);/**
             * @private
             * @param {Viewport} parent
             * @param {object} [options]
             * @param {string} [options.sides=all] all, horizontal, vertical, or combination of top, bottom, right, left (e.g., 'top-bottom-right')
             * @param {number} [options.friction=0.5] friction to apply to decelerate if active
             * @param {number} [options.time=150] time in ms to finish bounce
             * @param {string|function} [ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)
             * @param {string} [options.underflow=center] (top/bottom/center and left/right/center, or center) where to place world if too small for screen
             * @fires bounce-start-x
             * @fires bounce.end-x
             * @fires bounce-start-y
             * @fires bounce-end-y
             */function Bounce(parent,options){_classCallCheck(this,Bounce);var _this=_possibleConstructorReturn(this,(Bounce.__proto__||Object.getPrototypeOf(Bounce)).call(this,parent));options=options||{};_this.time=options.time||150;_this.ease=utils.ease(options.ease,'easeInOutSine');_this.friction=options.friction||0.5;options.sides=options.sides||'all';if(options.sides){if(options.sides==='all'){_this.top=_this.bottom=_this.left=_this.right=true;}else if(options.sides==='horizontal'){_this.right=_this.left=true;}else if(options.sides==='vertical'){_this.top=_this.bottom=true;}else{_this.top=options.sides.indexOf('top')!==-1;_this.bottom=options.sides.indexOf('bottom')!==-1;_this.left=options.sides.indexOf('left')!==-1;_this.right=options.sides.indexOf('right')!==-1;}}_this.parseUnderflow(options.underflow||'center');_this.last={};_this.reset();return _this;}_createClass(Bounce,[{key:'parseUnderflow',value:function parseUnderflow(clamp){clamp=clamp.toLowerCase();if(clamp==='center'){this.underflowX=0;this.underflowY=0;}else{this.underflowX=clamp.indexOf('left')!==-1?-1:clamp.indexOf('right')!==-1?1:0;this.underflowY=clamp.indexOf('top')!==-1?-1:clamp.indexOf('bottom')!==-1?1:0;}}},{key:'isActive',value:function isActive(){return this.toX!==null||this.toY!==null;}},{key:'down',value:function down(){this.toX=this.toY=null;}},{key:'up',value:function up(){this.bounce();}},{key:'update',value:function update(elapsed){if(this.paused){return;}this.bounce();if(this.toX){var toX=this.toX;toX.time+=elapsed;this.parent.emit('moved',{viewport:this.parent,type:'bounce-x'});if(toX.time>=this.time){this.parent.x=toX.end;this.toX=null;this.parent.emit('bounce-x-end',this.parent);}else{this.parent.x=this.ease(toX.time,toX.start,toX.delta,this.time);}}if(this.toY){var toY=this.toY;toY.time+=elapsed;this.parent.emit('moved',{viewport:this.parent,type:'bounce-y'});if(toY.time>=this.time){this.parent.y=toY.end;this.toY=null;this.parent.emit('bounce-y-end',this.parent);}else{this.parent.y=this.ease(toY.time,toY.start,toY.delta,this.time);}}}},{key:'calcUnderflowX',value:function calcUnderflowX(){var x=void 0;switch(this.underflowX){case-1:x=0;break;case 1:x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2;}return x;}},{key:'calcUnderflowY',value:function calcUnderflowY(){var y=void 0;switch(this.underflowY){case-1:y=0;break;case 1:y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2;}return y;}},{key:'bounce',value:function bounce(){if(this.paused){return;}var oob=void 0;var decelerate=this.parent.plugins.decelerate;if(decelerate&&(decelerate.x||decelerate.y)){if(decelerate.x&&decelerate.percentChangeX===decelerate.friction||decelerate.y&&decelerate.percentChangeY===decelerate.friction){oob=this.parent.OOB();if(oob.left&&this.left||oob.right&&this.right){decelerate.percentChangeX=this.friction;}if(oob.top&&this.top||oob.bottom&&this.bottom){decelerate.percentChangeY=this.friction;}}}var drag=this.parent.plugins.drag||{};var pinch=this.parent.plugins.pinch||{};decelerate=decelerate||{};if(!drag.active&&!pinch.active&&(!this.toX||!this.toY)&&(!decelerate.x||!decelerate.y)){oob=oob||this.parent.OOB();var point=oob.cornerPoint;if(!this.toX&&!decelerate.x){var x=null;if(oob.left&&this.left){x=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():0;}else if(oob.right&&this.right){x=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-point.x;}if(x!==null&&this.parent.x!==x){this.toX={time:0,start:this.parent.x,delta:x-this.parent.x,end:x};this.parent.emit('bounce-x-start',this.parent);}}if(!this.toY&&!decelerate.y){var y=null;if(oob.top&&this.top){y=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():0;}else if(oob.bottom&&this.bottom){y=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-point.y;}if(y!==null&&this.parent.y!==y){this.toY={time:0,start:this.parent.y,delta:y-this.parent.y,end:y};this.parent.emit('bounce-y-start',this.parent);}}}}},{key:'reset',value:function reset(){this.toX=this.toY=null;}}]);return Bounce;}(Plugin);},{'./plugin':9,'./utils':12}],2:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(ClampZoom,_Plugin);/**
             * @private
             * @param {object} [options]
             * @param {number} [options.minWidth] minimum width
             * @param {number} [options.minHeight] minimum height
             * @param {number} [options.maxWidth] maximum width
             * @param {number} [options.maxHeight] maximum height
             */function ClampZoom(parent,options){_classCallCheck(this,ClampZoom);var _this=_possibleConstructorReturn(this,(ClampZoom.__proto__||Object.getPrototypeOf(ClampZoom)).call(this,parent));_this.minWidth=options.minWidth;_this.minHeight=options.minHeight;_this.maxWidth=options.maxWidth;_this.maxHeight=options.maxHeight;_this.clamp();return _this;}_createClass(ClampZoom,[{key:'resize',value:function resize(){this.clamp();}},{key:'clamp',value:function clamp(){if(this.paused){return;}var width=this.parent.worldScreenWidth;var height=this.parent.worldScreenHeight;if(this.minWidth&&width<this.minWidth){var original=this.parent.scale.x;this.parent.fitWidth(this.minWidth,false,false,true);this.parent.scale.y*=this.parent.scale.x/original;width=this.parent.worldScreenWidth;height=this.parent.worldScreenHeight;this.parent.emit('zoomed',{viewport:this.parent,type:'clamp-zoom'});}if(this.maxWidth&&width>this.maxWidth){var _original=this.parent.scale.x;this.parent.fitWidth(this.maxWidth,false,false,true);this.parent.scale.y*=this.parent.scale.x/_original;width=this.parent.worldScreenWidth;height=this.parent.worldScreenHeight;this.parent.emit('zoomed',{viewport:this.parent,type:'clamp-zoom'});}if(this.minHeight&&height<this.minHeight){var _original2=this.parent.scale.y;this.parent.fitHeight(this.minHeight,false,false,true);this.parent.scale.x*=this.parent.scale.y/_original2;width=this.parent.worldScreenWidth;height=this.parent.worldScreenHeight;this.parent.emit('zoomed',{viewport:this.parent,type:'clamp-zoom'});}if(this.maxHeight&&height>this.maxHeight){var _original3=this.parent.scale.y;this.parent.fitHeight(this.maxHeight,false,false,true);this.parent.scale.x*=this.parent.scale.y/_original3;this.parent.emit('zoomed',{viewport:this.parent,type:'clamp-zoom'});}}}]);return ClampZoom;}(Plugin);},{'./plugin':9}],3:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');var utils=require('./utils');module.exports=function(_Plugin){_inherits(clamp,_Plugin);/**
             * @private
             * @param {object} options
             * @param {(number|boolean)} [options.left] clamp left; true=0
             * @param {(number|boolean)} [options.right] clamp right; true=viewport.worldWidth
             * @param {(number|boolean)} [options.top] clamp top; true=0
             * @param {(number|boolean)} [options.bottom] clamp bottom; true=viewport.worldHeight
             * @param {string} [options.direction] (all, x, or y) using clamps of [0, viewport.worldWidth/viewport.worldHeight]; replaces left/right/top/bottom if set
             * @param {string} [options.underflow=center] (none OR (top/bottom/center and left/right/center) OR center) where to place world if too small for screen (e.g., top-right, center, none, bottomleft)
             */function clamp(parent,options){_classCallCheck(this,clamp);options=options||{};var _this=_possibleConstructorReturn(this,(clamp.__proto__||Object.getPrototypeOf(clamp)).call(this,parent));if(typeof options.direction==='undefined'){_this.left=utils.defaults(options.left,null);_this.right=utils.defaults(options.right,null);_this.top=utils.defaults(options.top,null);_this.bottom=utils.defaults(options.bottom,null);}else{_this.left=options.direction==='x'||options.direction==='all'?true:null;_this.right=options.direction==='x'||options.direction==='all'?true:null;_this.top=options.direction==='y'||options.direction==='all'?true:null;_this.bottom=options.direction==='y'||options.direction==='all'?true:null;}_this.parseUnderflow(options.underflow||'center');_this.move();return _this;}_createClass(clamp,[{key:'parseUnderflow',value:function parseUnderflow(clamp){clamp=clamp.toLowerCase();if(clamp==='none'){this.noUnderflow=true;}else if(clamp==='center'){this.underflowX=this.underflowY=0;this.noUnderflow=false;}else{this.underflowX=clamp.indexOf('left')!==-1?-1:clamp.indexOf('right')!==-1?1:0;this.underflowY=clamp.indexOf('top')!==-1?-1:clamp.indexOf('bottom')!==-1?1:0;this.noUnderflow=false;}}},{key:'move',value:function move(){this.update();}},{key:'update',value:function update(){if(this.paused){return;}var original={x:this.parent.x,y:this.parent.y};var decelerate=this.parent.plugins.decelerate||{};if(this.left!==null||this.right!==null){var moved=void 0;if(this.parent.screenWorldWidth<this.parent.screenWidth){if(!this.noUnderflow){switch(this.underflowX){case-1:if(this.parent.x!==0){this.parent.x=0;moved=true;}break;case 1:if(this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth){this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;moved=true;}break;default:if(this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2){this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2;moved=true;}}}}else{if(this.left!==null){if(this.parent.left<(this.left===true?0:this.left)){this.parent.x=-(this.left===true?0:this.left)*this.parent.scale.x;decelerate.x=0;moved=true;}}if(this.right!==null){if(this.parent.right>(this.right===true?this.parent.worldWidth:this.right)){this.parent.x=-(this.right===true?this.parent.worldWidth:this.right)*this.parent.scale.x+this.parent.screenWidth;decelerate.x=0;moved=true;}}}if(moved){this.parent.emit('moved',{viewport:this.parent,original:original,type:'clamp-x'});}}if(this.top!==null||this.bottom!==null){var _moved=void 0;if(this.parent.screenWorldHeight<this.parent.screenHeight){if(!this.noUnderflow){switch(this.underflowY){case-1:if(this.parent.y!==0){this.parent.y=0;_moved=true;}break;case 1:if(this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight){this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;_moved=true;}break;default:if(this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2){this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2;_moved=true;}}}}else{if(this.top!==null){if(this.parent.top<(this.top===true?0:this.top)){this.parent.y=-(this.top===true?0:this.top)*this.parent.scale.y;decelerate.y=0;_moved=true;}}if(this.bottom!==null){if(this.parent.bottom>(this.bottom===true?this.parent.worldHeight:this.bottom)){this.parent.y=-(this.bottom===true?this.parent.worldHeight:this.bottom)*this.parent.scale.y+this.parent.screenHeight;decelerate.y=0;_moved=true;}}}if(_moved){this.parent.emit('moved',{viewport:this.parent,original:original,type:'clamp-y'});}}}}]);return clamp;}(Plugin);},{'./plugin':9,'./utils':12}],4:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(Decelerate,_Plugin);/**
             * @private
             * @param {Viewport} parent
             * @param {object} [options]
             * @param {number} [options.friction=0.95] percent to decelerate after movement
             * @param {number} [options.bounce=0.8] percent to decelerate when past boundaries (only applicable when viewport.bounce() is active)
             * @param {number} [options.minSpeed=0.01] minimum velocity before stopping/reversing acceleration
             */function Decelerate(parent,options){_classCallCheck(this,Decelerate);var _this=_possibleConstructorReturn(this,(Decelerate.__proto__||Object.getPrototypeOf(Decelerate)).call(this,parent));options=options||{};_this.friction=options.friction||0.95;_this.bounce=options.bounce||0.5;_this.minSpeed=typeof options.minSpeed!=='undefined'?options.minSpeed:0.01;_this.saved=[];_this.reset();_this.parent.on('moved',function(data){return _this.moved(data);});return _this;}_createClass(Decelerate,[{key:'down',value:function down(){this.saved=[];this.x=this.y=false;}},{key:'isActive',value:function isActive(){return this.x||this.y;}},{key:'move',value:function move(){if(this.paused){return;}var count=this.parent.countDownPointers();if(count===1||count>1&&!this.parent.plugins.pinch){this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()});if(this.saved.length>60){this.saved.splice(0,30);}}}},{key:'moved',value:function moved(data){if(this.saved.length){var last=this.saved[this.saved.length-1];if(data.type==='clamp-x'){if(last.x===data.original.x){last.x=this.parent.x;}}else if(data.type==='clamp-y'){if(last.y===data.original.y){last.y=this.parent.y;}}}}},{key:'up',value:function up(){if(this.parent.countDownPointers()===0&&this.saved.length){var now=performance.now();var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.saved[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var save=_step.value;if(save.time>=now-100){var time=now-save.time;this.x=(this.parent.x-save.x)/time;this.y=(this.parent.y-save.y)/time;this.percentChangeX=this.percentChangeY=this.friction;break;}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}}}/**
                 * manually activate plugin
                 * @param {object} options
                 * @param {number} [options.x]
                 * @param {number} [options.y]
                 */},{key:'activate',value:function activate(options){options=options||{};if(typeof options.x!=='undefined'){this.x=options.x;this.percentChangeX=this.friction;}if(typeof options.y!=='undefined'){this.y=options.y;this.percentChangeY=this.friction;}}},{key:'update',value:function update(elapsed){if(this.paused){return;}var moved=void 0;if(this.x){this.parent.x+=this.x*elapsed;this.x*=this.percentChangeX;if(Math.abs(this.x)<this.minSpeed){this.x=0;}moved=true;}if(this.y){this.parent.y+=this.y*elapsed;this.y*=this.percentChangeY;if(Math.abs(this.y)<this.minSpeed){this.y=0;}moved=true;}if(moved){this.parent.emit('moved',{viewport:this.parent,type:'decelerate'});}}},{key:'reset',value:function reset(){this.x=this.y=null;}}]);return Decelerate;}(Plugin);},{'./plugin':9}],5:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}// var PIXI = require('pixi.js');
var utils=require('./utils');var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(Drag,_Plugin);/**
             * enable one-finger touch to drag
             * @private
             * @param {Viewport} parent
             * @param {object} [options]
             * @param {string} [options.direction=all] direction to drag (all, x, or y)
             * @param {boolean} [options.wheel=true] use wheel to scroll in y direction (unless wheel plugin is active)
             * @param {number} [options.wheelScroll=1] number of pixels to scroll with each wheel spin
             * @param {boolean} [options.reverse] reverse the direction of the wheel scroll
             * @param {boolean|string} [options.clampWheel] (true, x, or y) clamp wheel (to avoid weird bounce with mouse wheel)
             * @param {string} [options.underflow=center] (top/bottom/center and left/right/center, or center) where to place world if too small for screen
             * @param {number} [options.factor=1] factor to multiply drag to increase the speed of movement
             * @param {string} [options.mouseButtons=all] changes which mouse buttons trigger drag, use: 'all', 'left', right' 'middle', or some combination, like, 'middle-right'
             */function Drag(parent,options){_classCallCheck(this,Drag);options=options||{};var _this=_possibleConstructorReturn(this,(Drag.__proto__||Object.getPrototypeOf(Drag)).call(this,parent));_this.moved=false;_this.wheelActive=utils.defaults(options.wheel,true);_this.wheelScroll=options.wheelScroll||1;_this.reverse=options.reverse?1:-1;_this.clampWheel=options.clampWheel;_this.factor=options.factor||1;_this.xDirection=!options.direction||options.direction==='all'||options.direction==='x';_this.yDirection=!options.direction||options.direction==='all'||options.direction==='y';_this.parseUnderflow(options.underflow||'center');_this.mouseButtons(options.mouseButtons);return _this;}_createClass(Drag,[{key:'mouseButtons',value:function mouseButtons(buttons){if(!buttons||buttons==='all'){this.mouse=[1,1,1];}else{this.mouse=[buttons.indexOf('left')!==-1,buttons.indexOf('middle')!==-1,buttons.indexOf('right')!==-1];}}},{key:'parseUnderflow',value:function parseUnderflow(clamp){clamp=clamp.toLowerCase();if(clamp==='center'){this.underflowX=0;this.underflowY=0;}else{this.underflowX=clamp.indexOf('left')!==-1?-1:clamp.indexOf('right')!==-1?1:0;this.underflowY=clamp.indexOf('top')!==-1?-1:clamp.indexOf('bottom')!==-1?1:0;}}},{key:'checkButtons',value:function checkButtons(e){var isMouse=e.data.pointerType==='mouse';var count=this.parent.countDownPointers();if(this.parent.parent){if(count===1||count>1&&!this.parent.plugins.pinch){if(!isMouse||this.mouse[e.data.button]){return true;}}}return false;}},{key:'down',value:function down(e){if(this.paused){return;}if(this.checkButtons(e)){var parent=this.parent.parent.toLocal(e.data.global);this.last={x:e.data.global.x,y:e.data.global.y,parent:parent};this.current=e.data.pointerId;return true;}else{this.last=null;}}},{key:'move',value:function move(e){if(this.paused){return;}if(this.last&&this.current===e.data.pointerId){var x=e.data.global.x;var y=e.data.global.y;var count=this.parent.countDownPointers();if(count===1||count>1&&!this.parent.plugins.pinch){var distX=x-this.last.x;var distY=y-this.last.y;if(this.moved||this.xDirection&&this.parent.checkThreshold(distX)||this.yDirection&&this.parent.checkThreshold(distY)){var newParent=this.parent.parent.toLocal(e.data.global);if(this.xDirection){this.parent.x+=(newParent.x-this.last.parent.x)*this.factor;}if(this.yDirection){this.parent.y+=(newParent.y-this.last.parent.y)*this.factor;}this.last={x:x,y:y,parent:newParent};if(!this.moved){this.parent.emit('drag-start',{screen:new PIXI.Point(this.last.x,this.last.y),world:this.parent.toWorld(this.last),viewport:this.parent});}this.moved=true;this.parent.emit('moved',{viewport:this.parent,type:'drag'});return true;}}else{this.moved=false;}}}},{key:'up',value:function up(){var touches=this.parent.getTouchPointers();if(touches.length===1){var pointer=touches[0];if(pointer.last){var parent=this.parent.parent.toLocal(pointer.last);this.last={x:pointer.last.x,y:pointer.last.y,parent:parent};this.current=pointer.last.data.pointerId;}this.moved=false;return true;}else if(this.last){if(this.moved){this.parent.emit('drag-end',{screen:new PIXI.Point(this.last.x,this.last.y),world:this.parent.toWorld(this.last),viewport:this.parent});this.last=this.moved=false;return true;}}}},{key:'wheel',value:function wheel(e){if(this.paused){return;}if(this.wheelActive){var wheel=this.parent.plugins.wheel;if(!wheel){if(this.xDirection){this.parent.x+=e.deltaX*this.wheelScroll*this.reverse;}if(this.yDirection){this.parent.y+=e.deltaY*this.wheelScroll*this.reverse;}if(this.clampWheel){this.clamp();}this.parent.emit('wheel-scroll',this.parent);this.parent.emit('moved',this.parent);if(!this.parent.passiveWheel){e.preventDefault();}return true;}}}},{key:'resume',value:function resume(){this.last=null;this.paused=false;}},{key:'clamp',value:function clamp(){var decelerate=this.parent.plugins.decelerate||{};if(this.clampWheel!=='y'){if(this.parent.screenWorldWidth<this.parent.screenWidth){switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2;}}else{if(this.parent.left<0){this.parent.x=0;decelerate.x=0;}else if(this.parent.right>this.parent.worldWidth){this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth;decelerate.x=0;}}}if(this.clampWheel!=='x'){if(this.parent.screenWorldHeight<this.parent.screenHeight){switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2;}}else{if(this.parent.top<0){this.parent.y=0;decelerate.y=0;}if(this.parent.bottom>this.parent.worldHeight){this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight;decelerate.y=0;}}}}},{key:'active',get:function get(){return this.moved;}}]);return Drag;}(Plugin);},{'./plugin':9,'./utils':12}],6:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(Follow,_Plugin);/**
             * @private
             * @param {Viewport} parent
             * @param {PIXI.DisplayObject} target to follow (object must include {x: x-coordinate, y: y-coordinate})
             * @param {object} [options]
             * @param {number} [options.speed=0] to follow in pixels/frame (0=teleport to location)
             * @param {number} [options.radius] radius (in world coordinates) of center circle where movement is allowed without moving the viewport
             */function Follow(parent,target,options){_classCallCheck(this,Follow);var _this=_possibleConstructorReturn(this,(Follow.__proto__||Object.getPrototypeOf(Follow)).call(this,parent));options=options||{};_this.speed=options.speed||0;_this.target=target;_this.radius=options.radius;return _this;}_createClass(Follow,[{key:'update',value:function update(){if(this.paused){return;}var center=this.parent.center;var targetX=this.target.x;var targetY=this.target.y;// if (this.radius) {
//     var distance = Math.sqrt(Math.pow(this.target.y - center.y, 2) + Math.pow(this.target.x - center.x, 2));
//     if (distance > this.radius) {
//         var angle = Math.atan2(this.target.y - center.y, this.target.x - center.x);
//         targetX = this.target.x - Math.cos(angle) * this.radius;
//         targetY = this.target.y - Math.sin(angle) * this.radius;
//     } else {
//         return;
//     }
// }
// modified by jaeyun
var deltaX=targetX-center.x;var deltaY=targetY-center.y;var x=Math.round(center.x+deltaX/15);var y=Math.round(center.y+deltaY/15);this.parent.moveCenter(x,y);this.parent.emit('moved',{viewport:this.parent,type:'follow'});// var center = this.parent.center;
// var toX = this.target.x,
//     toY = this.target.y;
// if (this.radius) {
//     var distance = Math.sqrt(Math.pow(this.target.y - center.y, 2) + Math.pow(this.target.x - center.x, 2));
//     if (distance > this.radius) {
//         var angle = Math.atan2(this.target.y - center.y, this.target.x - center.x);
//         toX = this.target.x - Math.cos(angle) * this.radius;
//         toY = this.target.y - Math.sin(angle) * this.radius;
//     } else {
//         return;
//     }
// }
// var deltaX = toX - center.x;
// var deltaY = toY - center.y;
// if (deltaX || deltaY) {
//     if (this.speed) {
//         var _angle = Math.atan2(toY - center.y, toX - center.x);
//         var changeX = Math.cos(_angle) * this.speed;
//         var changeY = Math.sin(_angle) * this.speed;
//         var x = Math.abs(changeX) > Math.abs(deltaX) ? toX : center.x + changeX;
//         var y = Math.abs(changeY) > Math.abs(deltaY) ? toY : center.y + changeY;
//         this.parent.moveCenter(x, y);
//         this.parent.emit('moved', { viewport: this.parent, type: 'follow' });
//     } else {
//         this.parent.moveCenter(toX, toY);
//         this.parent.emit('moved', { viewport: this.parent, type: 'follow' });
//     }
// }
}}]);return Follow;}(Plugin);},{'./plugin':9}],7:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var utils=require('./utils');var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(MouseEdges,_Plugin);/**
             * Scroll viewport when mouse hovers near one of the edges.
             * @private
             * @param {Viewport} parent
             * @param {object} [options]
             * @param {number} [options.radius] distance from center of screen in screen pixels
             * @param {number} [options.distance] distance from all sides in screen pixels
             * @param {number} [options.top] alternatively, set top distance (leave unset for no top scroll)
             * @param {number} [options.bottom] alternatively, set bottom distance (leave unset for no top scroll)
             * @param {number} [options.left] alternatively, set left distance (leave unset for no top scroll)
             * @param {number} [options.right] alternatively, set right distance (leave unset for no top scroll)
             * @param {number} [options.speed=8] speed in pixels/frame to scroll viewport
             * @param {boolean} [options.reverse] reverse direction of scroll
             * @param {boolean} [options.noDecelerate] don't use decelerate plugin even if it's installed
             * @param {boolean} [options.linear] if using radius, use linear movement (+/- 1, +/- 1) instead of angled movement (Math.cos(angle from center), Math.sin(angle from center))
             * @param {boolean} [options.allowButtons] allows plugin to continue working even when there's a mousedown event
             *
             * @event mouse-edge-start(Viewport) emitted when mouse-edge starts
             * @event mouse-edge-end(Viewport) emitted when mouse-edge ends
             */function MouseEdges(parent,options){_classCallCheck(this,MouseEdges);var _this=_possibleConstructorReturn(this,(MouseEdges.__proto__||Object.getPrototypeOf(MouseEdges)).call(this,parent));options=options||{};_this.options=options;_this.reverse=options.reverse?1:-1;_this.noDecelerate=options.noDecelerate;_this.linear=options.linear;_this.radiusSquared=Math.pow(options.radius,2);_this.resize();_this.speed=options.speed||8;return _this;}_createClass(MouseEdges,[{key:'resize',value:function resize(){var options=this.options;var distance=options.distance;if(utils.exists(distance)){this.left=distance;this.top=distance;this.right=window.innerWidth-distance;this.bottom=window.innerHeight-distance;}else if(!this.radius){this.left=utils.exists(options.left)?options.left:null;this.top=utils.exists(options.top)?options.top:null;this.right=utils.exists(options.right)?window.innerWidth-options.right:null;this.bottom=utils.exists(options.bottom)?window.innerHeight-options.bottom:null;}}},{key:'down',value:function down(){if(!this.options.allowButtons){this.horizontal=this.vertical=null;}}},{key:'move',value:function move(e){if(e.data.identifier!=='MOUSE'&&e.data.identifier!==1||!this.options.allowButtons&&e.data.buttons!==0){return;}var x=e.data.global.x;var y=e.data.global.y;if(this.radiusSquared){var center=this.parent.toScreen(this.parent.center);var distance=Math.pow(center.x-x,2)+Math.pow(center.y-y,2);if(distance>=this.radiusSquared){var angle=Math.atan2(center.y-y,center.x-x);if(this.linear){this.horizontal=Math.round(Math.cos(angle))*this.speed*this.reverse*(60/1000);this.vertical=Math.round(Math.sin(angle))*this.speed*this.reverse*(60/1000);}else{this.horizontal=Math.cos(angle)*this.speed*this.reverse*(60/1000);this.vertical=Math.sin(angle)*this.speed*this.reverse*(60/1000);}}else{if(this.horizontal){this.decelerateHorizontal();}if(this.vertical){this.decelerateVertical();}this.horizontal=this.vertical=0;}}else{if(utils.exists(this.left)&&x<this.left){this.horizontal=1*this.reverse*this.speed*(60/1000);}else if(utils.exists(this.right)&&x>this.right){this.horizontal=-1*this.reverse*this.speed*(60/1000);}else{this.decelerateHorizontal();this.horizontal=0;}if(utils.exists(this.top)&&y<this.top){this.vertical=1*this.reverse*this.speed*(60/1000);}else if(utils.exists(this.bottom)&&y>this.bottom){this.vertical=-1*this.reverse*this.speed*(60/1000);}else{this.decelerateVertical();this.vertical=0;}}}},{key:'decelerateHorizontal',value:function decelerateHorizontal(){var decelerate=this.parent.plugins.decelerate;if(this.horizontal&&decelerate&&!this.noDecelerate){decelerate.activate({x:this.horizontal*this.speed*this.reverse/(1000/60)});}}},{key:'decelerateVertical',value:function decelerateVertical(){var decelerate=this.parent.plugins.decelerate;if(this.vertical&&decelerate&&!this.noDecelerate){decelerate.activate({y:this.vertical*this.speed*this.reverse/(1000/60)});}}},{key:'up',value:function up(){if(this.horizontal){this.decelerateHorizontal();}if(this.vertical){this.decelerateVertical();}this.horizontal=this.vertical=null;}},{key:'update',value:function update(){if(this.paused){return;}if(this.horizontal||this.vertical){var center=this.parent.center;if(this.horizontal){center.x+=this.horizontal*this.speed;}if(this.vertical){center.y+=this.vertical*this.speed;}this.parent.moveCenter(center);this.parent.emit('moved',{viewport:this.parent,type:'mouse-edges'});}}}]);return MouseEdges;}(Plugin);},{'./plugin':9,'./utils':12}],8:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(Pinch,_Plugin);/**
             * @private
             * @param {Viewport} parent
             * @param {object} [options]
             * @param {boolean} [options.noDrag] disable two-finger dragging
             * @param {number} [options.percent=1.0] percent to modify pinch speed
             * @param {PIXI.Point} [options.center] place this point at center during zoom instead of center of two fingers
             */function Pinch(parent,options){_classCallCheck(this,Pinch);var _this=_possibleConstructorReturn(this,(Pinch.__proto__||Object.getPrototypeOf(Pinch)).call(this,parent));options=options||{};_this.percent=options.percent||1.0;_this.noDrag=options.noDrag;_this.center=options.center;return _this;}_createClass(Pinch,[{key:'down',value:function down(){if(this.parent.countDownPointers()>=2){this.active=true;return true;}}},{key:'move',value:function move(e){if(this.paused||!this.active){return;}var x=e.data.global.x;var y=e.data.global.y;var pointers=this.parent.getTouchPointers();if(pointers.length>=2){var first=pointers[0];var second=pointers[1];var last=first.last&&second.last?Math.sqrt(Math.pow(second.last.x-first.last.x,2)+Math.pow(second.last.y-first.last.y,2)):null;if(first.pointerId===e.data.pointerId){first.last={x:x,y:y,data:e.data};}else if(second.pointerId===e.data.pointerId){second.last={x:x,y:y,data:e.data};}if(last){var oldPoint=void 0;var point={x:first.last.x+(second.last.x-first.last.x)/2,y:first.last.y+(second.last.y-first.last.y)/2};if(!this.center){oldPoint=this.parent.toLocal(point);}var dist=Math.sqrt(Math.pow(second.last.x-first.last.x,2)+Math.pow(second.last.y-first.last.y,2));var change=(dist-last)/this.parent.screenWidth*this.parent.scale.x*this.percent;this.parent.scale.x+=change;this.parent.scale.y+=change;this.parent.emit('zoomed',{viewport:this.parent,type:'pinch'});var clamp=this.parent.plugins['clamp-zoom'];if(clamp){clamp.clamp();}if(this.center){this.parent.moveCenter(this.center);}else{var newPoint=this.parent.toGlobal(oldPoint);this.parent.x+=point.x-newPoint.x;this.parent.y+=point.y-newPoint.y;this.parent.emit('moved',{viewport:this.parent,type:'pinch'});}if(!this.noDrag&&this.lastCenter){this.parent.x+=point.x-this.lastCenter.x;this.parent.y+=point.y-this.lastCenter.y;this.parent.emit('moved',{viewport:this.parent,type:'pinch'});}this.lastCenter=point;this.moved=true;}else{if(!this.pinching){this.parent.emit('pinch-start',this.parent);this.pinching=true;}}return true;}}},{key:'up',value:function up(){if(this.pinching){if(this.parent.touches.length<=1){this.active=false;this.lastCenter=null;this.pinching=false;this.moved=false;this.parent.emit('pinch-end',this.parent);return true;}}}}]);return Pinch;}(Plugin);},{'./plugin':9}],9:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}module.exports=function(){function Plugin(parent){_classCallCheck(this,Plugin);this.parent=parent;this.paused=false;}/**
             * handler for pointerdown PIXI event
             * @param {PIXI.interaction.InteractionEvent} event
             */_createClass(Plugin,[{key:'down',value:function down(event){}/**
                 * handler for pointermove PIXI event
                 * @param {PIXI.interaction.InteractionEvent} event
                 */},{key:'move',value:function move(event){}/**
                 * handler for pointerup PIXI event
                 * @param {PIXI.interaction.InteractionEvent} event
                 */},{key:'up',value:function up(event){}/**
                 * handler for wheel event on div
                 * @param {WheelEvent} event
                 */},{key:'wheel',value:function wheel(event){}/**
                 * called on each tick
                 */},{key:'update',value:function update(){}/**
                 * called when the viewport is resized
                 */},{key:'resize',value:function resize(){}/**
                 * called when the viewport is manually moved
                 */},{key:'reset',value:function reset(){}/**
                 * called when viewport is paused
                 */},{key:'pause',value:function pause(){this.paused=true;}/**
                 * called when viewport is resumed
                 */},{key:'resume',value:function resume(){this.paused=false;}}]);return Plugin;}();},{}],10:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');var utils=require('./utils');module.exports=function(_Plugin){_inherits(SnapZoom,_Plugin);/**
             * @private
             * @param {Viewport} parent
             * @param {object} [options]
             * @param {number} [options.width] the desired width to snap (to maintain aspect ratio, choose only width or height)
             * @param {number} [options.height] the desired height to snap (to maintain aspect ratio, choose only width or height)
             * @param {number} [options.time=1000]
             * @param {string|function} [options.ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)
             * @param {PIXI.Point} [options.center] place this point at center during zoom instead of center of the viewport
             * @param {boolean} [options.interrupt=true] pause snapping with any user input on the viewport
             * @param {boolean} [options.removeOnComplete] removes this plugin after snapping is complete
             * @param {boolean} [options.removeOnInterrupt] removes this plugin if interrupted by any user input
             * @param {boolean} [options.forceStart] starts the snap immediately regardless of whether the viewport is at the desired zoom
             * @param {boolean} [options.noMove] zoom but do not move
             *
             * @event snap-zoom-start(Viewport) emitted each time a fit animation starts
             * @event snap-zoom-end(Viewport) emitted each time fit reaches its target
             * @event snap-zoom-end(Viewport) emitted each time fit reaches its target
             */function SnapZoom(parent,options){_classCallCheck(this,SnapZoom);var _this=_possibleConstructorReturn(this,(SnapZoom.__proto__||Object.getPrototypeOf(SnapZoom)).call(this,parent));options=options||{};_this.width=options.width;_this.height=options.height;if(_this.width>0){_this.x_scale=parent._screenWidth/_this.width;}if(_this.height>0){_this.y_scale=parent._screenHeight/_this.height;}_this.xIndependent=utils.exists(_this.x_scale);_this.yIndependent=utils.exists(_this.y_scale);_this.x_scale=_this.xIndependent?_this.x_scale:_this.y_scale;_this.y_scale=_this.yIndependent?_this.y_scale:_this.x_scale;_this.time=utils.defaults(options.time,1000);_this.ease=utils.ease(options.ease,'easeInOutSine');_this.center=options.center;_this.noMove=options.noMove;_this.stopOnResize=options.stopOnResize;_this.removeOnInterrupt=options.removeOnInterrupt;_this.removeOnComplete=utils.defaults(options.removeOnComplete,true);_this.interrupt=utils.defaults(options.interrupt,true);if(_this.time===0){parent.container.scale.x=_this.x_scale;parent.container.scale.y=_this.y_scale;if(_this.removeOnComplete){_this.parent.removePlugin('snap-zoom');}}else if(options.forceStart){_this.createSnapping();}return _this;}_createClass(SnapZoom,[{key:'createSnapping',value:function createSnapping(){var scale=this.parent.scale;this.snapping={time:0,startX:scale.x,startY:scale.y,deltaX:this.x_scale-scale.x,deltaY:this.y_scale-scale.y};this.parent.emit('snap-zoom-start',this.parent);}},{key:'resize',value:function resize(){this.snapping=null;if(this.width>0){this.x_scale=this.parent._screenWidth/this.width;}if(this.height>0){this.y_scale=this.parent._screenHeight/this.height;}this.x_scale=this.xIndependent?this.x_scale:this.y_scale;this.y_scale=this.yIndependent?this.y_scale:this.x_scale;}},{key:'reset',value:function reset(){this.snapping=null;}},{key:'wheel',value:function wheel(){if(this.removeOnInterrupt){this.parent.removePlugin('snap-zoom');}}},{key:'down',value:function down(){if(this.removeOnInterrupt){this.parent.removePlugin('snap-zoom');}else if(this.interrupt){this.snapping=null;}}},{key:'update',value:function update(elapsed){if(this.paused){return;}if(this.interrupt&&this.parent.countDownPointers()!==0){return;}var oldCenter=void 0;if(!this.center&&!this.noMove){oldCenter=this.parent.center;}if(!this.snapping){if(this.parent.scale.x!==this.x_scale||this.parent.scale.y!==this.y_scale){this.createSnapping();}}else if(this.snapping){var snapping=this.snapping;snapping.time+=elapsed;if(snapping.time>=this.time){this.parent.scale.set(this.x_scale,this.y_scale);if(this.removeOnComplete){this.parent.removePlugin('snap-zoom');}this.parent.emit('snap-zoom-end',this.parent);this.snapping=null;}else{var _snapping=this.snapping;this.parent.scale.x=this.ease(_snapping.time,_snapping.startX,_snapping.deltaX,this.time);this.parent.scale.y=this.ease(_snapping.time,_snapping.startY,_snapping.deltaY,this.time);}var clamp=this.parent.plugins['clamp-zoom'];if(clamp){clamp.clamp();}if(!this.noMove){if(!this.center){this.parent.moveCenter(oldCenter);}else{this.parent.moveCenter(this.center);}}}}},{key:'resume',value:function resume(){this.snapping=null;_get(SnapZoom.prototype.__proto__||Object.getPrototypeOf(SnapZoom.prototype),'resume',this).call(this);}}]);return SnapZoom;}(Plugin);},{'./plugin':9,'./utils':12}],11:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');var utils=require('./utils');module.exports=function(_Plugin){_inherits(Snap,_Plugin);/**
             * @private
             * @param {Viewport} parent
             * @param {number} x
             * @param {number} y
             * @param {object} [options]
             * @param {boolean} [options.topLeft] snap to the top-left of viewport instead of center
             * @param {number} [options.friction=0.8] friction/frame to apply if decelerate is active
             * @param {number} [options.time=1000]
             * @param {string|function} [options.ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)
             * @param {boolean} [options.interrupt=true] pause snapping with any user input on the viewport
             * @param {boolean} [options.removeOnComplete] removes this plugin after snapping is complete
             * @param {boolean} [options.removeOnInterrupt] removes this plugin if interrupted by any user input
             * @param {boolean} [options.forceStart] starts the snap immediately regardless of whether the viewport is at the desired location
             *
             * @event snap-start(Viewport) emitted each time a snap animation starts
             * @event snap-restart(Viewport) emitted each time a snap resets because of a change in viewport size
             * @event snap-end(Viewport) emitted each time snap reaches its target
             * @event snap-remove(Viewport) emitted if snap plugin is removed
             */function Snap(parent,x,y,options){_classCallCheck(this,Snap);var _this=_possibleConstructorReturn(this,(Snap.__proto__||Object.getPrototypeOf(Snap)).call(this,parent));options=options||{};_this.friction=options.friction||0.8;_this.time=options.time||1000;_this.ease=utils.ease(options.ease,'easeInOutSine');_this.x=x;_this.y=y;_this.topLeft=options.topLeft;_this.interrupt=utils.defaults(options.interrupt,true);_this.removeOnComplete=options.removeOnComplete;_this.removeOnInterrupt=options.removeOnInterrupt;if(options.forceStart){_this.startEase();}return _this;}_createClass(Snap,[{key:'snapStart',value:function snapStart(){this.percent=0;this.snapping={time:0};var current=this.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-current.x;this.deltaY=this.y-current.y;this.startX=current.x;this.startY=current.y;this.parent.emit('snap-start',this.parent);}},{key:'wheel',value:function wheel(){if(this.removeOnInterrupt){this.parent.removePlugin('snap');}}},{key:'down',value:function down(){if(this.removeOnInterrupt){this.parent.removePlugin('snap');}else if(this.interrupt){this.snapping=null;}}},{key:'up',value:function up(){if(this.parent.countDownPointers()===0){var decelerate=this.parent.plugins.decelerate;if(decelerate&&(decelerate.x||decelerate.y)){decelerate.percentChangeX=decelerate.percentChangeY=this.friction;}}}},{key:'update',value:function update(elapsed){if(this.paused){return;}if(this.interrupt&&this.parent.countDownPointers()!==0){return;}if(!this.snapping){var current=this.topLeft?this.parent.corner:this.parent.center;if(current.x!==this.x||current.y!==this.y){this.snapStart();}}else{var snapping=this.snapping;snapping.time+=elapsed;var finished=void 0;var x=void 0;var y=void 0;if(snapping.time>this.time){finished=true;x=this.startX+this.deltaX;y=this.startY+this.deltaY;}else{var percent=this.ease(snapping.time,0,1,this.time);x=this.startX+this.deltaX*percent;y=this.startY+this.deltaY*percent;}if(this.topLeft){this.parent.moveCorner(x,y);}else{this.parent.moveCenter(x,y);}this.parent.emit('moved',{viewport:this.parent,type:'snap'});if(finished){if(this.removeOnComplete){this.parent.removePlugin('snap');}this.parent.emit('snap-end',this.parent);this.snapping=null;}}}}]);return Snap;}(Plugin);},{'./plugin':9,'./utils':12}],12:[function(require,module,exports){'use strict';var Penner=require('penner');function exists(a){return a!==undefined&&a!==null;}function defaults(a,defaults){return a!==undefined&&a!==null?a:defaults;}/**
         * @param {(function|string)} [ease]
         * @param {string} defaults for pennr equation
         * @private
         * @returns {function} correct penner equation
         */function ease(ease,defaults){if(!exists(ease)){return Penner[defaults];}else if(typeof ease==='function'){return ease;}else if(typeof ease==='string'){return Penner[ease];}}module.exports={exists:exists,defaults:defaults,ease:ease};},{penner:15}],13:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}// var PIXI = require('pixi.js');
var utils=require('./utils');var Drag=require('./drag');var Pinch=require('./pinch');var Clamp=require('./clamp');var ClampZoom=require('./clamp-zoom');var Decelerate=require('./decelerate');var Bounce=require('./bounce');var Snap=require('./snap');var SnapZoom=require('./snap-zoom');var Follow=require('./follow');var Wheel=require('./wheel');var MouseEdges=require('./mouse-edges');var PLUGIN_ORDER=['drag','pinch','wheel','follow','mouse-edges','decelerate','bounce','snap-zoom','clamp-zoom','snap','clamp'];var Viewport=function(_PIXI$Container){_inherits(Viewport,_PIXI$Container);/**
             * @extends PIXI.Container
             * @extends EventEmitter
             * @param {object} [options]
             * @param {number} [options.screenWidth=window.innerWidth]
             * @param {number} [options.screenHeight=window.innerHeight]
             * @param {number} [options.worldWidth=this.width]
             * @param {number} [options.worldHeight=this.height]
             * @param {number} [options.threshold=5] number of pixels to move to trigger an input event (e.g., drag, pinch) or disable a clicked event
             * @param {boolean} [options.passiveWheel=true] whether the 'wheel' event is set to passive
             * @param {boolean} [options.stopPropagation=false] whether to stopPropagation of events that impact the viewport
             * @param {(PIXI.Rectangle|PIXI.Circle|PIXI.Ellipse|PIXI.Polygon|PIXI.RoundedRectangle)} [options.forceHitArea] change the default hitArea from world size to a new value
             * @param {boolean} [options.noTicker] set this if you want to manually call update() function on each frame
             * @param {PIXI.ticker.Ticker} [options.ticker=PIXI.Ticker.shared||PIXI.ticker.shared] use this PIXI.ticker for updates
             * @param {PIXI.InteractionManager} [options.interaction=null] InteractionManager, available from instantiated WebGLRenderer/CanvasRenderer.plugins.interaction - used to calculate pointer postion relative to canvas location on screen
             * @param {HTMLElement} [options.divWheel=document.body] div to attach the wheel event
             * @fires clicked
             * @fires drag-start
             * @fires drag-end
             * @fires drag-remove
             * @fires pinch-start
             * @fires pinch-end
             * @fires pinch-remove
             * @fires snap-start
             * @fires snap-end
             * @fires snap-remove
             * @fires snap-zoom-start
             * @fires snap-zoom-end
             * @fires snap-zoom-remove
             * @fires bounce-x-start
             * @fires bounce-x-end
             * @fires bounce-y-start
             * @fires bounce-y-end
             * @fires bounce-remove
             * @fires wheel
             * @fires wheel-remove
             * @fires wheel-scroll
             * @fires wheel-scroll-remove
             * @fires mouse-edge-start
             * @fires mouse-edge-end
             * @fires mouse-edge-remove
             * @fires moved
             * @fires moved-end
             * @fires zoomed
             * @fires zoomed-end
             */function Viewport(options){_classCallCheck(this,Viewport);options=options||{};var _this=_possibleConstructorReturn(this,(Viewport.__proto__||Object.getPrototypeOf(Viewport)).call(this));_this.plugins={};_this.pluginsList=[];_this._screenWidth=options.screenWidth||window.innerWidth;_this._screenHeight=options.screenHeight||window.innerHeight;_this._worldWidth=options.worldWidth;_this._worldHeight=options.worldHeight;_this.hitAreaFullScreen=utils.defaults(options.hitAreaFullScreen,true);_this.forceHitArea=options.forceHitArea;_this.passiveWheel=utils.defaults(options.passiveWheel,true);_this.stopEvent=options.stopPropagation;_this.threshold=utils.defaults(options.threshold,5);_this.interaction=options.interaction||null;_this.div=options.divWheel||document.body;_this.listeners(_this.div);_this.div.oncontextmenu=function(e){return e.preventDefault();};/**
                 * active touch point ids on the viewport
                 * @type {number[]}
                 * @readonly
                 */_this.touches=[];if(!options.noTicker){_this.ticker=options.ticker||(PIXI.Ticker?PIXI.Ticker.shared:PIXI.ticker.shared);_this.tickerFunction=function(){return _this.update(_this.ticker.elapsedMS);};_this.ticker.add(_this.tickerFunction);}return _this;}/**
             * removes all event listeners from viewport
             * (useful for cleanup of wheel and ticker events when removing viewport)
             */_createClass(Viewport,[{key:'removeListeners',value:function removeListeners(){this.ticker.remove(this.tickerFunction);this.div.removeEventListener('wheel',this.wheelFunction);}/**
                 * overrides PIXI.Container's destroy to also remove the 'wheel' and PIXI.Ticker listeners
                 */},{key:'destroy',value:function destroy(options){_get(Viewport.prototype.__proto__||Object.getPrototypeOf(Viewport.prototype),'destroy',this).call(this,options);this.removeListeners();}/**
                 * update viewport on each frame
                 * by default, you do not need to call this unless you set options.noTicker=true
                 */},{key:'update',value:function update(elapsed){if(!this.pause){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=this.pluginsList[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var plugin=_step.value;plugin.update(elapsed);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}if(this.lastViewport){// check for moved-end event
if(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y){this.moving=true;}else{if(this.moving){this.emit('moved-end',this);this.moving=false;}}// check for zoomed-end event
if(this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y){this.zooming=true;}else{if(this.zooming){this.emit('zoomed-end',this);this.zooming=false;}}}if(!this.forceHitArea){this.hitArea.x=this.left;this.hitArea.y=this.top;this.hitArea.width=this.worldScreenWidth;this.hitArea.height=this.worldScreenHeight;}this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y;this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y};}}/**
                 * use this to set screen and world sizes--needed for pinch/wheel/clamp/bounce
                 * @param {number} [screenWidth=window.innerWidth]
                 * @param {number} [screenHeight=window.innerHeight]
                 * @param {number} [worldWidth]
                 * @param {number} [worldHeight]
                 */},{key:'resize',value:function resize(screenWidth,screenHeight,worldWidth,worldHeight){this._screenWidth=screenWidth||window.innerWidth;this._screenHeight=screenHeight||window.innerHeight;if(worldWidth){this._worldWidth=worldWidth;}if(worldHeight){this._worldHeight=worldHeight;}this.resizePlugins();}/**
                 * called after a worldWidth/Height change
                 * @private
                 */},{key:'resizePlugins',value:function resizePlugins(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.pluginsList[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var plugin=_step2.value;plugin.resize();}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}}/**
                 * screen width in screen pixels
                 * @type {number}
                 */},{key:'getVisibleBounds',/**
                 * get visible bounds of viewport
                 * @return {object} bounds { x, y, width, height }
                 */value:function getVisibleBounds(){return{x:this.left,y:this.top,width:this.worldScreenWidth,height:this.worldScreenHeight};}/**
                 * add input listeners
                 * @private
                 */},{key:'listeners',value:function listeners(div){var _this2=this;this.interactive=true;if(!this.forceHitArea){this.hitArea=new PIXI.Rectangle(0,0,this.worldWidth,this.worldHeight);}this.on('pointerdown',this.down);this.on('pointermove',this.move);this.on('pointerup',this.up);this.on('pointerupoutside',this.up);this.on('pointercancel',this.up);this.on('pointerout',this.up);this.wheelFunction=function(e){return _this2.handleWheel(e);};div.addEventListener('wheel',this.wheelFunction,{passive:this.passiveWheel});this.isMouseDown=false;}/**
                 * handle down events
                 * @private
                 */},{key:'down',value:function down(e){if(this.pause||!this.worldVisible){return;}if(e.data.pointerType==='mouse'){this.isMouseDown=true;}else{this.touches.push(e.data.pointerId);}this.last=e.data.global.clone();if(this.countDownPointers()===1){// clicked event does not fire if viewport is decelerating or bouncing
var decelerate=this.plugins.decelerate;var bounce=this.plugins.bounce;if((!decelerate||!decelerate.isActive())&&(!bounce||!bounce.isActive())){this.clickedAvailable=true;}else{this.clickedAvailable=false;}}else{this.clickedAvailable=false;}var stop=void 0;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.pluginsList[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var plugin=_step3.value;if(plugin.down(e)){stop=true;}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}if(stop&&this.stopEvent){e.stopPropagation();}}/**
                 * whether change exceeds threshold
                 * @private
                 * @param {number} change
                 */},{key:'checkThreshold',value:function checkThreshold(change){if(Math.abs(change)>=this.threshold){return true;}return false;}/**
                 * handle move events
                 * @private
                 */},{key:'move',value:function move(e){if(this.pause||!this.worldVisible){return;}var stop=void 0;var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.pluginsList[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var plugin=_step4.value;if(plugin.move(e)){stop=true;}}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}if(this.clickedAvailable){var distX=e.data.global.x-this.last.x;var distY=e.data.global.y-this.last.y;if(this.checkThreshold(distX)||this.checkThreshold(distY)){this.clickedAvailable=false;}}if(stop&&this.stopEvent){e.stopPropagation();}}/**
                 * handle up events
                 * @private
                 */},{key:'up',value:function up(e){if(this.pause||!this.worldVisible){return;}if(e.data.pointerType==='mouse'){this.isMouseDown=false;}if(e.data.pointerType!=='mouse'){for(var i=0;i<this.touches.length;i++){if(this.touches[i]===e.data.pointerId){this.touches.splice(i,1);break;}}}var stop=void 0;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=this.pluginsList[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var plugin=_step5.value;if(plugin.up(e)){stop=true;}}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}if(this.clickedAvailable&&this.countDownPointers()===0){this.emit('clicked',{screen:this.last,world:this.toWorld(this.last),viewport:this});this.clickedAvailable=false;}if(stop&&this.stopEvent){e.stopPropagation();}}/**
                 * gets pointer position if this.interaction is set
                 * @param {UIEvent} evt
                 * @private
                 */},{key:'getPointerPosition',value:function getPointerPosition(evt){var point=new PIXI.Point();if(this.interaction){this.interaction.mapPositionToPoint(point,evt.clientX,evt.clientY);}else{point.x=evt.clientX;point.y=evt.clientY;}return point;}/**
                 * handle wheel events
                 * @private
                 */},{key:'handleWheel',value:function handleWheel(e){if(this.pause||!this.worldVisible){return;}// only handle wheel events where the mouse is over the viewport
var point=this.toLocal(this.getPointerPosition(e));if(this.left<=point.x&&point.x<=this.right&&this.top<=point.y&&point.y<=this.bottom){var result=void 0;var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.pluginsList[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var plugin=_step6.value;if(plugin.wheel(e)){result=true;}}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}return result;}}/**
                 * change coordinates from screen to world
                 * @param {number|PIXI.Point} x
                 * @param {number} [y]
                 * @returns {PIXI.Point}
                 */},{key:'toWorld',value:function toWorld(){if(arguments.length===2){var x=arguments[0];var y=arguments[1];return this.toLocal({x:x,y:y});}else{return this.toLocal(arguments[0]);}}/**
                 * change coordinates from world to screen
                 * @param {number|PIXI.Point} x
                 * @param {number} [y]
                 * @returns {PIXI.Point}
                 */},{key:'toScreen',value:function toScreen(){if(arguments.length===2){var x=arguments[0];var y=arguments[1];return this.toGlobal({x:x,y:y});}else{var point=arguments[0];return this.toGlobal(point);}}/**
                 * screen width in world coordinates
                 * @type {number}
                 * @readonly
                 */},{key:'moveCenter',/**
                 * move center of viewport to point
                 * @param {(number|PIXI.Point)} x or point
                 * @param {number} [y]
                 * @return {Viewport} this
                 */value:function moveCenter()/* x, y | PIXI.Point */{var x=void 0;var y=void 0;if(!isNaN(arguments[0])){x=arguments[0];y=arguments[1];}else{x=arguments[0].x;y=arguments[0].y;}this.position.set((this.worldScreenWidth/2-x)*this.scale.x,(this.worldScreenHeight/2-y)*this.scale.y);this._reset();return this;}/**
                 * top-left corner
                 * @type {PIXI.Point}
                 */},{key:'moveCorner',/**
                 * move viewport's top-left corner; also clamps and resets decelerate and bounce (as needed)
                 * @param {number|PIXI.Point} x|point
                 * @param {number} y
                 * @return {Viewport} this
                 */value:function moveCorner()/* x, y | point */{if(arguments.length===1){this.position.set(-arguments[0].x*this.scale.x,-arguments[0].y*this.scale.y);}else{this.position.set(-arguments[0]*this.scale.x,-arguments[1]*this.scale.y);}this._reset();return this;}/**
                 * change zoom so the width fits in the viewport
                 * @param {number} [width=this._worldWidth] in world coordinates
                 * @param {boolean} [center] maintain the same center
                 * @param {boolean} [scaleY=true] whether to set scaleY=scaleX
                 * @param {boolean} [noClamp=false] whether to disable clamp-zoom
                 * @return {Viewport} this
                 */},{key:'fitWidth',value:function fitWidth(width,center){var scaleY=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var noClamp=arguments[3];var save=void 0;if(center){save=this.center;}width=width||this.worldWidth;this.scale.x=this.screenWidth/width;if(scaleY){this.scale.y=this.scale.x;}var clampZoom=this.plugins['clamp-zoom'];if(!noClamp&&clampZoom){clampZoom.clamp();}if(center){this.moveCenter(save);}return this;}/**
                 * change zoom so the height fits in the viewport
                 * @param {number} [height=this._worldHeight] in world coordinates
                 * @param {boolean} [center] maintain the same center of the screen after zoom
                 * @param {boolean} [scaleX=true] whether to set scaleX = scaleY
                 * @param {boolean} [noClamp=false] whether to disable clamp-zoom
                 * @return {Viewport} this
                 */},{key:'fitHeight',value:function fitHeight(height,center){var scaleX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var noClamp=arguments[3];var save=void 0;if(center){save=this.center;}height=height||this.worldHeight;this.scale.y=this.screenHeight/height;if(scaleX){this.scale.x=this.scale.y;}var clampZoom=this.plugins['clamp-zoom'];if(!noClamp&&clampZoom){clampZoom.clamp();}if(center){this.moveCenter(save);}return this;}/**
                 * change zoom so it fits the entire world in the viewport
                 * @param {boolean} [center] maintain the same center of the screen after zoom
                 * @return {Viewport} this
                 */},{key:'fitWorld',value:function fitWorld(center){var save=void 0;if(center){save=this.center;}this.scale.x=this.screenWidth/this.worldWidth;this.scale.y=this.screenHeight/this.worldHeight;if(this.scale.x<this.scale.y){this.scale.y=this.scale.x;}else{this.scale.x=this.scale.y;}var clampZoom=this.plugins['clamp-zoom'];if(clampZoom){clampZoom.clamp();}if(center){this.moveCenter(save);}return this;}/**
                 * change zoom so it fits the size or the entire world in the viewport
                 * @param {boolean} [center] maintain the same center of the screen after zoom
                 * @param {number} [width] desired width
                 * @param {number} [height] desired height
                 * @return {Viewport} this
                 */},{key:'fit',value:function fit(center,width,height){var save=void 0;if(center){save=this.center;}width=width||this.worldWidth;height=height||this.worldHeight;this.scale.x=this.screenWidth/width;this.scale.y=this.screenHeight/height;if(this.scale.x<this.scale.y){this.scale.y=this.scale.x;}else{this.scale.x=this.scale.y;}var clampZoom=this.plugins['clamp-zoom'];if(clampZoom){clampZoom.clamp();}if(center){this.moveCenter(save);}return this;}/**
                 * zoom viewport by a certain percent (in both x and y direction)
                 * @param {number} percent change (e.g., 0.25 would increase a starting scale of 1.0 to 1.25)
                 * @param {boolean} [center] maintain the same center of the screen after zoom
                 * @return {Viewport} the viewport
                 */},{key:'zoomPercent',value:function zoomPercent(percent,center){var save=void 0;if(center){save=this.center;}var scale=this.scale.x+this.scale.x*percent;this.scale.set(scale);var clampZoom=this.plugins['clamp-zoom'];if(clampZoom){clampZoom.clamp();}if(center){this.moveCenter(save);}return this;}/**
                 * zoom viewport by increasing/decreasing width by a certain number of pixels
                 * @param {number} change in pixels
                 * @param {boolean} [center] maintain the same center of the screen after zoom
                 * @return {Viewport} the viewport
                 */},{key:'zoom',value:function zoom(change,center){this.fitWidth(change+this.worldScreenWidth,center);return this;}/**
                 * @param {object} [options]
                 * @param {number} [options.width] the desired width to snap (to maintain aspect ratio, choose only width or height)
                 * @param {number} [options.height] the desired height to snap (to maintain aspect ratio, choose only width or height)
                 * @param {number} [options.time=1000]
                 * @param {string|function} [options.ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)
                 * @param {PIXI.Point} [options.center] place this point at center during zoom instead of center of the viewport
                 * @param {boolean} [options.interrupt=true] pause snapping with any user input on the viewport
                 * @param {boolean} [options.removeOnComplete] removes this plugin after snapping is complete
                 * @param {boolean} [options.removeOnInterrupt] removes this plugin if interrupted by any user input
                 * @param {boolean} [options.forceStart] starts the snap immediately regardless of whether the viewport is at the desired zoom
                 * @param {boolean} [options.noMove] zoom but do not move
                 */},{key:'snapZoom',value:function snapZoom(options){this.plugins['snap-zoom']=new SnapZoom(this,options);this.pluginsSort();return this;}/**
                 * @private
                 * @typedef OutOfBounds
                 * @type {object}
                 * @property {boolean} left
                 * @property {boolean} right
                 * @property {boolean} top
                 * @property {boolean} bottom
                 */ /**
                 * is container out of world bounds
                 * @return {OutOfBounds}
                 * @private
                 */},{key:'OOB',value:function OOB(){var result={};result.left=this.left<0;result.right=this.right>this._worldWidth;result.top=this.top<0;result.bottom=this.bottom>this._worldHeight;result.cornerPoint={x:this._worldWidth*this.scale.x-this._screenWidth,y:this._worldHeight*this.scale.y-this._screenHeight};return result;}/**
                 * world coordinates of the right edge of the screen
                 * @type {number}
                 */},{key:'countDownPointers',/**
                 * count of mouse/touch pointers that are down on the viewport
                 * @private
                 * @return {number}
                 */value:function countDownPointers(){return(this.isMouseDown?1:0)+this.touches.length;}/**
                 * array of touch pointers that are down on the viewport
                 * @private
                 * @return {PIXI.InteractionTrackingData[]}
                 */},{key:'getTouchPointers',value:function getTouchPointers(){var results=[];var pointers=this.trackedPointers;for(var key in pointers){var pointer=pointers[key];if(this.touches.indexOf(pointer.pointerId)!==-1){results.push(pointer);}}return results;}/**
                 * array of pointers that are down on the viewport
                 * @private
                 * @return {PIXI.InteractionTrackingData[]}
                 */},{key:'getPointers',value:function getPointers(){var results=[];var pointers=this.trackedPointers;for(var key in pointers){results.push(pointers[key]);}return results;}/**
                 * clamps and resets bounce and decelerate (as needed) after manually moving viewport
                 * @private
                 */},{key:'_reset',value:function _reset(){if(this.plugins.bounce){this.plugins.bounce.reset();this.plugins.bounce.bounce();}if(this.plugins.decelerate){this.plugins.decelerate.reset();}if(this.plugins.snap){this.plugins.snap.reset();}if(this.plugins.clamp){this.plugins.clamp.update();}if(this.plugins['clamp-zoom']){this.plugins['clamp-zoom'].clamp();}}// PLUGINS
/**
                 * Inserts a user plugin into the viewport
                 * @param {string} name of plugin
                 * @param {Plugin} plugin - instantiated Plugin class
                 * @param {number} [index=last element] plugin is called current order: 'drag', 'pinch', 'wheel', 'follow', 'mouse-edges', 'decelerate', 'bounce', 'snap-zoom', 'clamp-zoom', 'snap', 'clamp'
                 */},{key:'userPlugin',value:function userPlugin(name,plugin){var index=arguments.length>2&&arguments[2]!==undefined?arguments[2]:PLUGIN_ORDER.length;this.plugins[name]=plugin;var current=PLUGIN_ORDER.indexOf(name);if(current!==-1){PLUGIN_ORDER.splice(current,1);}PLUGIN_ORDER.splice(index,0,name);this.pluginsSort();}/**
                 * removes installed plugin
                 * @param {string} type of plugin (e.g., 'drag', 'pinch')
                 */},{key:'removePlugin',value:function removePlugin(type){if(this.plugins[type]){this.plugins[type]=null;this.emit(`${type}-remove`);this.pluginsSort();}}/**
                 * pause plugin
                 * @param {string} type of plugin (e.g., 'drag', 'pinch')
                 */},{key:'pausePlugin',value:function pausePlugin(type){if(this.plugins[type]){this.plugins[type].pause();}}/**
                 * resume plugin
                 * @param {string} type of plugin (e.g., 'drag', 'pinch')
                 */},{key:'resumePlugin',value:function resumePlugin(type){if(this.plugins[type]){this.plugins[type].resume();}}/**
                 * sort plugins for updates
                 * @private
                 */},{key:'pluginsSort',value:function pluginsSort(){this.pluginsList=[];var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=PLUGIN_ORDER[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var plugin=_step7.value;if(this.plugins[plugin]){this.pluginsList.push(this.plugins[plugin]);}}}catch(err){_didIteratorError7=true;_iteratorError7=err;}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return();}}finally{if(_didIteratorError7){throw _iteratorError7;}}}}/**
                 * enable one-finger touch to drag
                 * @param {object} [options]
                 * @param {string} [options.direction=all] direction to drag (all, x, or y)
                 * @param {boolean} [options.wheel=true] use wheel to scroll in y direction (unless wheel plugin is active)
                 * @param {number} [options.wheelScroll=1] number of pixels to scroll with each wheel spin
                 * @param {boolean} [options.reverse] reverse the direction of the wheel scroll
                 * @param {boolean|string} [options.clampWheel] (true, x, or y) clamp wheel (to avoid weird bounce with mouse wheel)
                 * @param {string} [options.underflow=center] (top/bottom/center and left/right/center, or center) where to place world if too small for screen
                 * @param {number} [options.factor=1] factor to multiply drag to increase the speed of movement
                 */},{key:'drag',value:function drag(options){this.plugins.drag=new Drag(this,options);this.pluginsSort();return this;}/**
                 * clamp to world boundaries or other provided boundaries
                 * NOTES:
                 *   clamp is disabled if called with no options; use { direction: 'all' } for all edge clamping
                 *   screenWidth, screenHeight, worldWidth, and worldHeight needs to be set for this to work properly
                 * @param {object} [options]
                 * @param {(number|boolean)} [options.left] clamp left; true=0
                 * @param {(number|boolean)} [options.right] clamp right; true=viewport.worldWidth
                 * @param {(number|boolean)} [options.top] clamp top; true=0
                 * @param {(number|boolean)} [options.bottom] clamp bottom; true=viewport.worldHeight
                 * @param {string} [options.direction] (all, x, or y) using clamps of [0, viewport.worldWidth/viewport.worldHeight]; replaces left/right/top/bottom if set
                 * @param {string} [options.underflow=center] (none OR (top/bottom/center and left/right/center) OR center) where to place world if too small for screen (e.g., top-right, center, none, bottomleft)
                 * @return {Viewport} this
                 */},{key:'clamp',value:function clamp(options){this.plugins.clamp=new Clamp(this,options);this.pluginsSort();return this;}/**
                 * decelerate after a move
                 * @param {object} [options]
                 * @param {number} [options.friction=0.95] percent to decelerate after movement
                 * @param {number} [options.bounce=0.8] percent to decelerate when past boundaries (only applicable when viewport.bounce() is active)
                 * @param {number} [options.minSpeed=0.01] minimum velocity before stopping/reversing acceleration
                 * @return {Viewport} this
                 */},{key:'decelerate',value:function decelerate(options){this.plugins.decelerate=new Decelerate(this,options);this.pluginsSort();return this;}/**
                 * bounce on borders
                 * NOTE: screenWidth, screenHeight, worldWidth, and worldHeight needs to be set for this to work properly
                 * @param {object} [options]
                 * @param {string} [options.sides=all] all, horizontal, vertical, or combination of top, bottom, right, left (e.g., 'top-bottom-right')
                 * @param {number} [options.friction=0.5] friction to apply to decelerate if active
                 * @param {number} [options.time=150] time in ms to finish bounce
                 * @param {string|function} [options.ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)
                 * @param {string} [options.underflow=center] (top/bottom/center and left/right/center, or center) where to place world if too small for screen
                 * @return {Viewport} this
                 */},{key:'bounce',value:function bounce(options){this.plugins.bounce=new Bounce(this,options);this.pluginsSort();return this;}/**
                 * enable pinch to zoom and two-finger touch to drag
                 * NOTE: screenWidth, screenHeight, worldWidth, and worldHeight needs to be set for this to work properly
                 * @param {number} [options.percent=1.0] percent to modify pinch speed
                 * @param {boolean} [options.noDrag] disable two-finger dragging
                 * @param {PIXI.Point} [options.center] place this point at center during zoom instead of center of two fingers
                 * @return {Viewport} this
                 */},{key:'pinch',value:function pinch(options){this.plugins.pinch=new Pinch(this,options);this.pluginsSort();return this;}/**
                 * snap to a point
                 * @param {number} x
                 * @param {number} y
                 * @param {object} [options]
                 * @param {boolean} [options.topLeft] snap to the top-left of viewport instead of center
                 * @param {number} [options.friction=0.8] friction/frame to apply if decelerate is active
                 * @param {number} [options.time=1000]
                 * @param {string|function} [options.ease=easeInOutSine] ease function or name (see http://easings.net/ for supported names)
                 * @param {boolean} [options.interrupt=true] pause snapping with any user input on the viewport
                 * @param {boolean} [options.removeOnComplete] removes this plugin after snapping is complete
                 * @param {boolean} [options.removeOnInterrupt] removes this plugin if interrupted by any user input
                 * @param {boolean} [options.forceStart] starts the snap immediately regardless of whether the viewport is at the desired location
                 * @return {Viewport} this
                 */},{key:'snap',value:function snap(x,y,options){this.plugins.snap=new Snap(this,x,y,options);this.pluginsSort();return this;}/**
                 * follow a target
                 * NOTE: uses the (x, y) as the center to follow; for PIXI.Sprite to work properly, use sprite.anchor.set(0.5)
                 * @param {PIXI.DisplayObject} target to follow (object must include {x: x-coordinate, y: y-coordinate})
                 * @param {object} [options]
                 * @param {number} [options.speed=0] to follow in pixels/frame (0=teleport to location)
                 * @param {number} [options.radius] radius (in world coordinates) of center circle where movement is allowed without moving the viewport
                 * @return {Viewport} this
                 */},{key:'follow',value:function follow(target,options){this.plugins.follow=new Follow(this,target,options);this.pluginsSort();return this;}/**
                 * zoom using mouse wheel
                 * @param {object} [options]
                 * @param {number} [options.percent=0.1] percent to scroll with each spin
                 * @param {boolean} [options.reverse] reverse the direction of the scroll
                 * @param {PIXI.Point} [options.center] place this point at center during zoom instead of current mouse position
                 * @return {Viewport} this
                 */},{key:'wheel',value:function wheel(options){this.plugins.wheel=new Wheel(this,options);this.pluginsSort();return this;}/**
                 * enable clamping of zoom to constraints
                 * NOTE: screenWidth, screenHeight, worldWidth, and worldHeight needs to be set for this to work properly
                 * @param {object} [options]
                 * @param {number} [options.minWidth] minimum width
                 * @param {number} [options.minHeight] minimum height
                 * @param {number} [options.maxWidth] maximum width
                 * @param {number} [options.maxHeight] maximum height
                 * @return {Viewport} this
                 */},{key:'clampZoom',value:function clampZoom(options){this.plugins['clamp-zoom']=new ClampZoom(this,options);this.pluginsSort();return this;}/**
                 * Scroll viewport when mouse hovers near one of the edges or radius-distance from center of screen.
                 * @param {object} [options]
                 * @param {number} [options.radius] distance from center of screen in screen pixels
                 * @param {number} [options.distance] distance from all sides in screen pixels
                 * @param {number} [options.top] alternatively, set top distance (leave unset for no top scroll)
                 * @param {number} [options.bottom] alternatively, set bottom distance (leave unset for no bottom scroll)
                 * @param {number} [options.left] alternatively, set left distance (leave unset for no left scroll)
                 * @param {number} [options.right] alternatively, set right distance (leave unset for no right scroll)
                 * @param {number} [options.speed=8] speed in pixels/frame to scroll viewport
                 * @param {boolean} [options.reverse] reverse direction of scroll
                 * @param {boolean} [options.noDecelerate] don't use decelerate plugin even if it's installed
                 * @param {boolean} [options.linear] if using radius, use linear movement (+/- 1, +/- 1) instead of angled movement (Math.cos(angle from center), Math.sin(angle from center))
                 * @param {boolean} [options.allowButtons] allows plugin to continue working even when there's a mousedown event
                 */},{key:'mouseEdges',value:function mouseEdges(options){this.plugins['mouse-edges']=new MouseEdges(this,options);this.pluginsSort();return this;}/**
                 * pause viewport (including animation updates such as decelerate)
                 * NOTE: when setting pause=true, all touches and mouse actions are cleared (i.e., if mousedown was active, it becomes inactive for purposes of the viewport)
                 * @type {boolean}
                 */},{key:'ensureVisible',/**
                 * move the viewport so the bounding box is visible
                 * @param {number} x
                 * @param {number} y
                 * @param {number} width
                 * @param {number} height
                 */value:function ensureVisible(x,y,width,height){if(x<this.left){this.left=x;}else if(x+width>this.right){this.right=x+width;}if(y<this.top){this.top=y;}else if(y+height>this.bottom){this.bottom=y+height;}}},{key:'screenWidth',get:function get(){return this._screenWidth;},set:function set(value){this._screenWidth=value;}/**
                 * screen height in screen pixels
                 * @type {number}
                 */},{key:'screenHeight',get:function get(){return this._screenHeight;},set:function set(value){this._screenHeight=value;}/**
                 * world width in pixels
                 * @type {number}
                 */},{key:'worldWidth',get:function get(){if(this._worldWidth){return this._worldWidth;}else{return this.width;}},set:function set(value){this._worldWidth=value;this.resizePlugins();}/**
                 * world height in pixels
                 * @type {number}
                 */},{key:'worldHeight',get:function get(){if(this._worldHeight){return this._worldHeight;}else{return this.height;}},set:function set(value){this._worldHeight=value;this.resizePlugins();}},{key:'worldScreenWidth',get:function get(){return this.screenWidth/this.scale.x;}/**
                 * screen height in world coordinates
                 * @type {number}
                 * @readonly
                 */},{key:'worldScreenHeight',get:function get(){return this.screenHeight/this.scale.y;}/**
                 * world width in screen coordinates
                 * @type {number}
                 * @readonly
                 */},{key:'screenWorldWidth',get:function get(){return this.worldWidth*this.scale.x;}/**
                 * world height in screen coordinates
                 * @type {number}
                 * @readonly
                 */},{key:'screenWorldHeight',get:function get(){return this.worldHeight*this.scale.y;}/**
                 * get center of screen in world coordinates
                 * @type {PIXI.Point}
                 */},{key:'center',get:function get(){return new PIXI.Point(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y);},set:function set(value){this.moveCenter(value);}},{key:'corner',get:function get(){return new PIXI.Point(-this.x/this.scale.x,-this.y/this.scale.y);},set:function set(value){this.moveCorner(value);}},{key:'right',get:function get(){return-this.x/this.scale.x+this.worldScreenWidth;},set:function set(value){this.x=-value*this.scale.x+this.screenWidth;this._reset();}/**
                 * world coordinates of the left edge of the screen
                 * @type {number}
                 */},{key:'left',get:function get(){return-this.x/this.scale.x;},set:function set(value){this.x=-value*this.scale.x;this._reset();}/**
                 * world coordinates of the top edge of the screen
                 * @type {number}
                 */},{key:'top',get:function get(){return-this.y/this.scale.y;},set:function set(value){this.y=-value*this.scale.y;this._reset();}/**
                 * world coordinates of the bottom edge of the screen
                 * @type {number}
                 */},{key:'bottom',get:function get(){return-this.y/this.scale.y+this.worldScreenHeight;},set:function set(value){this.y=-value*this.scale.y+this.screenHeight;this._reset();}/**
                 * determines whether the viewport is dirty (i.e., needs to be renderered to the screen because of a change)
                 * @type {boolean}
                 */},{key:'dirty',get:function get(){return this._dirty;},set:function set(value){this._dirty=value;}/**
                 * permanently changes the Viewport's hitArea
                 * NOTE: normally the hitArea = PIXI.Rectangle(Viewport.left, Viewport.top, Viewport.worldScreenWidth, Viewport.worldScreenHeight)
                 * @type {(PIXI.Rectangle|PIXI.Circle|PIXI.Ellipse|PIXI.Polygon|PIXI.RoundedRectangle)}
                 */},{key:'forceHitArea',get:function get(){return this._forceHitArea;},set:function set(value){if(value){this._forceHitArea=value;this.hitArea=value;}else{this._forceHitArea=false;this.hitArea=new PIXI.Rectangle(0,0,this.worldWidth,this.worldHeight);}}},{key:'pause',get:function get(){return this._pause;},set:function set(value){this._pause=value;this.lastViewport=null;this.moving=false;this.zooming=false;if(value){this.touches=[];this.isMouseDown=false;}}}]);return Viewport;}(PIXI.Container);/**
         * fires after a mouse or touch click
         * @event Viewport#clicked
         * @type {object}
         * @property {PIXI.Point} screen
         * @property {PIXI.Point} world
         * @property {Viewport} viewport
         */ /**
         * fires when a drag starts
         * @event Viewport#drag-start
         * @type {object}
         * @property {PIXI.Point} screen
         * @property {PIXI.Point} world
         * @property {Viewport} viewport
         */ /**
         * fires when a drag ends
         * @event Viewport#drag-end
         * @type {object}
         * @property {PIXI.Point} screen
         * @property {PIXI.Point} world
         * @property {Viewport} viewport
         */ /**
         * fires when a pinch starts
         * @event Viewport#pinch-start
         * @type {Viewport}
         */ /**
         * fires when a pinch end
         * @event Viewport#pinch-end
         * @type {Viewport}
         */ /**
         * fires when a snap starts
         * @event Viewport#snap-start
         * @type {Viewport}
         */ /**
         * fires when a snap ends
         * @event Viewport#snap-end
         * @type {Viewport}
         */ /**
         * fires when a snap-zoom starts
         * @event Viewport#snap-zoom-start
         * @type {Viewport}
         */ /**
         * fires when a snap-zoom ends
         * @event Viewport#snap-zoom-end
         * @type {Viewport}
         */ /**
         * fires when a bounce starts in the x direction
         * @event Viewport#bounce-x-start
         * @type {Viewport}
         */ /**
         * fires when a bounce ends in the x direction
         * @event Viewport#bounce-x-end
         * @type {Viewport}
         */ /**
         * fires when a bounce starts in the y direction
         * @event Viewport#bounce-y-start
         * @type {Viewport}
         */ /**
         * fires when a bounce ends in the y direction
         * @event Viewport#bounce-y-end
         * @type {Viewport}
         */ /**
         * fires when for a mouse wheel event
         * @event Viewport#wheel
         * @type {object}
         * @property {object} wheel
         * @property {number} wheel.dx
         * @property {number} wheel.dy
         * @property {number} wheel.dz
         * @property {Viewport} viewport
         */ /**
         * fires when a wheel-scroll occurs
         * @event Viewport#wheel-scroll
         * @type {Viewport}
         */ /**
         * fires when a mouse-edge starts to scroll
         * @event Viewport#mouse-edge-start
         * @type {Viewport}
         */ /**
         * fires when the mouse-edge scrolling ends
         * @event Viewport#mouse-edge-end
         * @type {Viewport}
         */ /**
         * fires when viewport moves through UI interaction, deceleration, or follow
         * @event Viewport#moved
         * @type {object}
         * @property {Viewport} viewport
         * @property {string} type (drag, snap, pinch, follow, bounce-x, bounce-y, clamp-x, clamp-y, decelerate, mouse-edges, wheel)
         */ /**
         * fires when viewport moves through UI interaction, deceleration, or follow
         * @event Viewport#zoomed
         * @type {object}
         * @property {Viewport} viewport
         * @property {string} type (drag-zoom, pinch, wheel, clamp-zoom)
         */ /**
         * fires when viewport stops moving for any reason
         * @event Viewport#moved-end
         * @type {Viewport}
         */ /**
         * fires when viewport stops zooming for any rason
         * @event Viewport#zoomed-end
         * @type {Viewport}
         */if(typeof PIXI!=='undefined'){if(PIXI.extras){PIXI.extras.Viewport=Viewport;}else{PIXI.extras={Viewport:Viewport};}}module.exports=Viewport;},{'./bounce':1,'./clamp':3,'./clamp-zoom':2,'./decelerate':4,'./drag':5,'./follow':6,'./mouse-edges':7,'./pinch':8,'./snap':11,'./snap-zoom':10,'./utils':12,'./wheel':14}],14:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');}return call&&(typeof call==='object'||typeof call==='function')?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError(`Super expression must either be null or a function, not ${typeof superClass}`);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var Plugin=require('./plugin');module.exports=function(_Plugin){_inherits(Wheel,_Plugin);/**
             * @private
             * @param {Viewport} parent
             * @param {object} [options]
             * @param {number} [options.percent=0.1] percent to scroll with each spin
             * @param {number} [options.smooth] smooth the zooming by providing the number of frames to zoom between wheel spins
             * @param {boolean} [options.interrupt=true] stop smoothing with any user input on the viewport
             * @param {boolean} [options.reverse] reverse the direction of the scroll
             * @param {PIXI.Point} [options.center] place this point at center during zoom instead of current mouse position
             *
             * @event wheel({wheel: {dx, dy, dz}, event, viewport})
             */function Wheel(parent,options){_classCallCheck(this,Wheel);var _this=_possibleConstructorReturn(this,(Wheel.__proto__||Object.getPrototypeOf(Wheel)).call(this,parent));options=options||{};_this.percent=options.percent||0.1;_this.center=options.center;_this.reverse=options.reverse;_this.smooth=options.smooth;_this.interrupt=typeof options.interrupt==='undefined'?true:options.interrupt;return _this;}_createClass(Wheel,[{key:'down',value:function down(){if(this.interrupt){this.smoothing=null;}}},{key:'update',value:function update(){if(this.smoothing){var point=this.smoothingCenter;var change=this.smoothing;var oldPoint=void 0;if(!this.center){oldPoint=this.parent.toLocal(point);}this.parent.scale.x+=change.x;this.parent.scale.y+=change.y;this.parent.emit('zoomed',{viewport:this.parent,type:'wheel'});var clamp=this.parent.plugins['clamp-zoom'];if(clamp){clamp.clamp();}if(this.center){this.parent.moveCenter(this.center);}else{var newPoint=this.parent.toGlobal(oldPoint);this.parent.x+=point.x-newPoint.x;this.parent.y+=point.y-newPoint.y;}this.smoothingCount++;if(this.smoothingCount>=this.smooth){this.smoothing=null;}}}},{key:'wheel',value:function wheel(e){if(this.paused){return;}var point=this.parent.getPointerPosition(e);var sign=this.reverse?-1:1;var step=sign*-e.deltaY*(e.deltaMode?120:1)/500;var change=Math.pow(2,(1+this.percent)*step);if(this.smooth){var original={x:this.smoothing?this.smoothing.x*(this.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+original.x)*change-this.parent.scale.x)/this.smooth,y:((this.parent.scale.y+original.y)*change-this.parent.scale.y)/this.smooth};this.smoothingCount=0;this.smoothingCenter=point;}else{var oldPoint=void 0;if(!this.center){oldPoint=this.parent.toLocal(point);}this.parent.scale.x*=change;this.parent.scale.y*=change;this.parent.emit('zoomed',{viewport:this.parent,type:'wheel'});var clamp=this.parent.plugins['clamp-zoom'];if(clamp){clamp.clamp();}if(this.center){this.parent.moveCenter(this.center);}else{var newPoint=this.parent.toGlobal(oldPoint);this.parent.x+=point.x-newPoint.x;this.parent.y+=point.y-newPoint.y;}}this.parent.emit('moved',{viewport:this.parent,type:'wheel'});this.parent.emit('wheel',{wheel:{dx:e.deltaX,dy:e.deltaY,dz:e.deltaZ},event:e,viewport:this.parent});if(!this.parent.passiveWheel){e.preventDefault();}}}]);return Wheel;}(Plugin);},{'./plugin':9}],15:[function(require,module,exports){/*
            Copyright © 2001 Robert Penner
            All rights reserved.

            Redistribution and use in source and binary forms, with or without modification,
            are permitted provided that the following conditions are met:

            Redistributions of source code must retain the above copyright notice, this list of
            conditions and the following disclaimer.
            Redistributions in binary form must reproduce the above copyright notice, this list
            of conditions and the following disclaimer in the documentation and/or other materials
            provided with the distribution.

            Neither the name of the author nor the names of contributors may be used to endorse
            or promote products derived from this software without specific prior written permission.

            THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
            EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
            MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
            COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
            EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
            GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
            AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
            NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
            OF THE POSSIBILITY OF SUCH DAMAGE.
         */(function(){var penner,umd;umd=function(factory){if(typeof exports==='object'){return module.exports=factory;}else if(typeof define==='function'&&define.amd){return define([],factory);}else{return this.penner=factory;}};penner={linear:function(t,b,c,d){return c*t/d+b;},easeInQuad:function(t,b,c,d){return c*(t/=d)*t+b;},easeOutQuad:function(t,b,c,d){return-c*(t/=d)*(t-2)+b;},easeInOutQuad:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b;}else{return-c/2*(--t*(t-2)-1)+b;}},easeInCubic:function(t,b,c,d){return c*(t/=d)*t*t+b;},easeOutCubic:function(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;},easeInOutCubic:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t+b;}else{return c/2*((t-=2)*t*t+2)+b;}},easeInQuart:function(t,b,c,d){return c*(t/=d)*t*t*t+b;},easeOutQuart:function(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOutQuart:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t+b;}else{return-c/2*((t-=2)*t*t*t-2)+b;}},easeInQuint:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b;},easeOutQuint:function(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOutQuint:function(t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b;}else{return c/2*((t-=2)*t*t*t*t+2)+b;}},easeInSine:function(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOutSine:function(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOutSine:function(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;},easeInExpo:function(t,b,c,d){if(t===0){return b;}else{return c*Math.pow(2,10*(t/d-1))+b;}},easeOutExpo:function(t,b,c,d){if(t===d){return b+c;}else{return c*(-Math.pow(2,-10*t/d)+1)+b;}},easeInOutExpo:function(t,b,c,d){if(t===0){b;}if(t===d){b+c;}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))+b;}else{return c/2*(-Math.pow(2,-10*--t)+2)+b;}},easeInCirc:function(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOutCirc:function(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOutCirc:function(t,b,c,d){if((t/=d/2)<1){return-c/2*(Math.sqrt(1-t*t)-1)+b;}else{return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;}},easeInElastic:function(t,b,c,d){var a,p,s;s=1.70158;p=0;a=c;if(t===0){b;}else if((t/=d)===1){b+c;}if(!p){p=d*0.3;}if(a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;},easeOutElastic:function(t,b,c,d){var a,p,s;s=1.70158;p=0;a=c;if(t===0){b;}else if((t/=d)===1){b+c;}if(!p){p=d*0.3;}if(a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;},easeInOutElastic:function(t,b,c,d){var a,p,s;s=1.70158;p=0;a=c;if(t===0){b;}else if((t/=d/2)===2){b+c;}if(!p){p=d*(0.3*1.5);}if(a<Math.abs(c)){a=c;s=p/4;}else{s=p/(2*Math.PI)*Math.asin(c/a);}if(t<1){return-0.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;}else{return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*0.5+c+b;}},easeInBack:function(t,b,c,d,s){if(s===void 0){s=1.70158;}return c*(t/=d)*t*((s+1)*t-s)+b;},easeOutBack:function(t,b,c,d,s){if(s===void 0){s=1.70158;}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOutBack:function(t,b,c,d,s){if(s===void 0){s=1.70158;}if((t/=d/2)<1){return c/2*(t*t*(((s*=1.525)+1)*t-s))+b;}else{return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b;}},easeInBounce:function(t,b,c,d){var v;v=penner.easeOutBounce(d-t,0,c,d);return c-v+b;},easeOutBounce:function(t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b;}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+0.75)+b;}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+0.9375)+b;}else{return c*(7.5625*(t-=2.625/2.75)*t+0.984375)+b;}},easeInOutBounce:function(t,b,c,d){var v;if(t<d/2){v=penner.easeInBounce(t*2,0,c,d);return v*0.5+b;}else{v=penner.easeOutBounce(t*2-d,0,c,d);return v*0.5+c*0.5+b;}}};umd(penner);}).call(this);},{}]},{},[13]);;(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=typeof require=='function'&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(`Cannot find module '${i}'`);throw a.code='MODULE_NOT_FOUND',a;}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r);},p,p.exports,r,e,n,t);}return n[i].exports;}for(var u=typeof require=='function'&&require,i=0;i<t.length;i++)o(t[i]);return o;}return r;})()({1:[function(require,module,exports){'use strict';PIXI.extras.cull={Simple:require('./simple'),SpatialHash:require('./spatial-hash')};},{'./simple':2,'./spatial-hash':3}],2:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}// pixi-cull.SpatialHash
// Copyright 2018 YOPEY YOPEY LLC
// David Figatner
// MIT License
var Simple=function(){/**
         * creates a simple cull
         * @param {object} [options]
         * @param {boolean} [options.visible=visible] parameter of the object to set (usually visible or renderable)
         * @param {boolean} [options.calculatePIXI=true] calculate pixi.js bounding box automatically; if this is set to false then it uses object[options.AABB] for bounding box
         * @param {string} [options.dirtyTest=true] only update spatial hash for objects with object[options.dirtyTest]=true; this has a HUGE impact on performance
         * @param {string} [options.AABB=AABB] object property that holds bounding box so that object[type] = { x: number, y: number, width: number, height: number }; not needed if options.calculatePIXI=true
         */function Simple(options){_classCallCheck(this,Simple);options=options||{};this.visible=options.visible||'visible';this.calculatePIXI=typeof options.calculatePIXI!=='undefined'?options.calculatePIXI:true;this.dirtyTest=typeof options.dirtyTest!=='undefined'?options.dirtyTest:true;this.renderable=options.visible||'renderable';this.AABB=options.AABB||'AABB';this.dirty=options.dirty||'dirty';this.lists=[[]];}/**
         * add an array of objects to be culled
         * @param {Array} array
         * @param {boolean} [staticObject] set to true if the object's position/size does not change
         * @return {Array} array
         */_createClass(Simple,[{key:'addList',value:function addList(array,staticObject){this.lists.push(array);if(staticObject){array.staticObject=true;}if(this.calculatePIXI&&this.dirtyTest){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=array[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;this.updateObject(object);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}}return array;}/**
             * remove an array added by addList()
             * @param {Array} array
             * @return {Array} array
             */},{key:'removeList',value:function removeList(array){this.lists.splice(this.lists.indexOf(array),1);return array;}/**
             * add an object to be culled
             * @param {*} object
             * @param {boolean} [staticObject] set to true if the object's position/size does not change
             * @return {*} object
             */},{key:'add',value:function add(object,staticObject){if(staticObject){object.staticObject=true;}if(this.calculatePIXI&&(this.dirtyTest||staticObject)){this.updateObject(object);}this.lists[0].push(object);return object;}/**
             * remove an object added by add()
             * @param {*} object
             * @return {*} object
             */},{key:'remove',value:function remove(object){this.lists[0].splice(this.lists[0].indexOf(object),1);return object;}/**
             * cull the items in the list by setting visible parameter
             * @param {object} bounds
             * @param {number} bounds.x
             * @param {number} bounds.y
             * @param {number} bounds.width
             * @param {number} bounds.height
             * @param {boolean} [skipUpdate] skip updating the AABB bounding box of all objects
             */},{key:'cull',value:function cull(bounds,skipUpdate){if(this.calculatePIXI&&!skipUpdate){this.updateObjects();}var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.lists[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var list=_step2.value;var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=list[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;try{if(!object.tileMap){var box=object[this.AABB];object[this.visible]=box.x+box.width>bounds.x&&box.x<bounds.x+bounds.width&&box.y+box.height>bounds.y&&box.y<bounds.y+bounds.height;object[this.renderable]=object[this.visible];}}catch(e){}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}}/**
             * update the AABB for all objects
             * automatically called from update() when calculatePIXI=true and skipUpdate=false
             */},{key:'updateObjects',value:function updateObjects(){if(this.dirtyTest){var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.lists[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var list=_step4.value;if(!list.staticObject){var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=list[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var object=_step5.value;if(!object.staticObject&&object[this.dirty]){this.updateObject(object);object[this.dirty]=false;}}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}}}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}}else{var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.lists[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _list=_step6.value;if(!_list.staticObject){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=_list[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var _object=_step7.value;if(!_object.staticObject){this.updateObject(_object);}}}catch(err){_didIteratorError7=true;_iteratorError7=err;}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return();}}finally{if(_didIteratorError7){throw _iteratorError7;}}}}}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}}}/**
             * update the has of an object
             * automatically called from updateObjects()
             * @param {*} object
             */},{key:'updateObject',value:function updateObject(object){var box=object.getLocalBounds();object[this.AABB]=object[this.AABB]||{};object[this.AABB].x=object.x+(box.x-object.pivot.x)*object.scale.x;object[this.AABB].y=object.y+(box.y-object.pivot.y)*object.scale.y;object[this.AABB].width=box.width*object.scale.x;object[this.AABB].height=box.height*object.scale.y;}/**
             * returns an array of objects contained within bounding box
             * @param {object} boudns bounding box to search
             * @param {number} bounds.x
             * @param {number} bounds.y
             * @param {number} bounds.width
             * @param {number} bounds.height
             * @return {object[]} search results
             */},{key:'query',value:function query(bounds){var results=[];var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=this.lists[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var list=_step8.value;var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=list[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var object=_step9.value;var box=object[this.AABB];if(box.x+box.width>bounds.x&&box.x-box.width<bounds.x+bounds.width&&box.y+box.height>bounds.y&&box.y-box.height<bounds.y+bounds.height){results.push(object);}}}catch(err){_didIteratorError9=true;_iteratorError9=err;}finally{try{if(!_iteratorNormalCompletion9&&_iterator9.return){_iterator9.return();}}finally{if(_didIteratorError9){throw _iteratorError9;}}}}}catch(err){_didIteratorError8=true;_iteratorError8=err;}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return();}}finally{if(_didIteratorError8){throw _iteratorError8;}}}return results;}/**
             * iterates through objects contained within bounding box
             * stops iterating if the callback returns true
             * @param {object} bounds bounding box to search
             * @param {number} bounds.x
             * @param {number} bounds.y
             * @param {number} bounds.width
             * @param {number} bounds.height
             * @param {function} callback
             * @return {boolean} true if callback returned early
             */},{key:'queryCallback',value:function queryCallback(bounds,callback){var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=this.lists[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var list=_step10.value;var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=list[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var object=_step11.value;var box=object[this.AABB];if(box.x+box.width>bounds.x&&box.x-box.width<bounds.x+bounds.width&&box.y+box.height>bounds.y&&box.y-box.height<bounds.y+bounds.height){if(callback(object)){return true;}}}}catch(err){_didIteratorError11=true;_iteratorError11=err;}finally{try{if(!_iteratorNormalCompletion11&&_iterator11.return){_iterator11.return();}}finally{if(_didIteratorError11){throw _iteratorError11;}}}}}catch(err){_didIteratorError10=true;_iteratorError10=err;}finally{try{if(!_iteratorNormalCompletion10&&_iterator10.return){_iterator10.return();}}finally{if(_didIteratorError10){throw _iteratorError10;}}}return false;}/**
             * get stats (only updated after update() is called)
             * @return {SimpleStats}
             */},{key:'stats',value:function stats(){var visible=0;var count=0;var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=this.lists[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var list=_step12.value;list.forEach(function(object){visible+=object.visible?1:0;count++;});}}catch(err){_didIteratorError12=true;_iteratorError12=err;}finally{try{if(!_iteratorNormalCompletion12&&_iterator12.return){_iterator12.return();}}finally{if(_didIteratorError12){throw _iteratorError12;}}}return{total:count,visible:visible,culled:count-visible};}}]);return Simple;}();/**
     * @typedef {object} SimpleStats
     * @property {number} total
     * @property {number} visible
     * @property {number} culled
     */module.exports=Simple;},{}],3:[function(require,module,exports){'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}// Copyright 2018 YOPEY YOPEY LLC
// David Figatner
// MIT License
var SpatialHash=function(){/**
         * creates a spatial-hash cull
         * @param {object} [options]
         * @param {number} [options.size=1000] cell size used to create hash (xSize = ySize)
         * @param {number} [options.xSize] horizontal cell size
         * @param {number} [options.ySize] vertical cell size
         * @param {boolean} [options.calculatePIXI=true] calculate bounding box automatically; if this is set to false then it uses object[options.AABB] for bounding box
         * @param {boolean} [options.visible=visible] parameter of the object to set (usually visible or renderable)
         * @param {boolean} [options.simpleTest=true] iterate through visible buckets to check for bounds
         * @param {string} [options.dirtyTest=true] only update spatial hash for objects with object[options.dirtyTest]=true; this has a HUGE impact on performance
         * @param {string} [options.AABB=AABB] object property that holds bounding box so that object[type] = { x: number, y: number, width: number, height: number }
         * @param {string} [options.spatial=spatial] object property that holds object's hash list
         * @param {string} [options.dirty=dirty] object property for dirtyTest
         */function SpatialHash(options){_classCallCheck(this,SpatialHash);options=options||{};this.xSize=options.xSize||options.size||1000;this.ySize=options.ySize||options.size||1000;this.AABB=options.type||'AABB';this.spatial=options.spatial||'spatial';this.calculatePIXI=typeof options.calculatePIXI!=='undefined'?options.calculatePIXI:true;this.visibleText=typeof options.visibleTest!=='undefined'?options.visibleTest:true;this.simpleTest=typeof options.simpleTest!=='undefined'?options.simpleTest:true;this.dirtyTest=typeof options.dirtyTest!=='undefined'?options.dirtyTest:true;this.visible=options.visible||'visible';this.renderable=options.visible||'renderable';this.dirty=options.dirty||'dirty';this.width=this.height=0;this.hash={};this.objects=[];this.containers=[];}/**
         * add an object to be culled
         * side effect: adds object.spatialHashes to track existing hashes
         * @param {*} object
         * @param {boolean} [staticObject] set to true if the object's position/size does not change
         * @return {*} object
         */_createClass(SpatialHash,[{key:'add',value:function add(object,staticObject){object[this.spatial]={hashes:[]};if(this.calculatePIXI&&this.dirtyTest){object[this.dirty]=true;}if(staticObject){object.staticObject=true;}this.updateObject(object);this.containers[0].push(object);}/**
             * remove an object added by add()
             * @param {*} object
             * @return {*} object
             */},{key:'remove',value:function remove(object){this.containers[0].splice(this.list[0].indexOf(object),1);this.removeFromHash(object);return object;}/**
             * add an array of objects to be culled
             * @param {PIXI.Container} container
             * @param {boolean} [staticObject] set to true if the objects in the container's position/size do not change
             * note: this only works with pixi v5.0.0rc2+ because it relies on the new container events childAdded and childRemoved
             */},{key:'addContainer',value:function addContainer(container,staticObject){var added=function(object){object[this.spatial]={hashes:[]};this.updateObject(object);}.bind(this);var removed=function(object){this.removeFromHash(object);}.bind(this);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=container.children[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var object=_step.value;object[this.spatial]={hashes:[]};this.updateObject(object);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}container.cull={};this.containers.push(container);container.on('childAdded',added);container.on('childRemoved',removed);container.cull.added=added;container.cull.removed=removed;if(staticObject){container.cull.static=true;}}/**
             * remove an array added by addContainer()
             * @param {PIXI.Container} container
             * @return {PIXI.Container} container
             */},{key:'removeContainer',value:function removeContainer(container){var _this=this;this.containers.splice(this.containers.indexOf(container),1);container.children.forEach(function(object){return _this.removeFromHash(object);});container.off('added',container.cull.added);container.off('removed',container.cull.removed);delete container.cull;return container;}/**
             * update the hashes and cull the items in the list
             * @param {AABB} AABB
             * @param {boolean} [skipUpdate] skip updating the hashes of all objects
             * @return {number} number of buckets in results
             */},{key:'cull',value:function cull(AABB,skipUpdate){var _this2=this;if(!skipUpdate){this.updateObjects();}this.invisible();var objects=this.query(AABB,this.simpleTest);objects.forEach(function(object){return object[_this2.visible]=true;});return this.lastBuckets;}/**
             * set all objects in hash to visible=false
             */},{key:'invisible',value:function invisible(){var _this3=this;var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this.containers[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var container=_step2.value;container.children.forEach(function(object){return object[_this3.visible]=false;});}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}}/**
             * update the hashes for all objects
             * automatically called from update() when skipUpdate=false
             */},{key:'updateObjects',value:function updateObjects(){var _this4=this;if(this.dirtyTest){var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=this.objects[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var object=_step3.value;if(object[this.dirty]){this.updateObject(object);object[this.dirty]=false;}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=this.containers[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var container=_step4.value;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=container.children[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var _object=_step5.value;if(_object[this.dirty]){this.updateObject(_object);_object[this.dirty]=false;}}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5.return){_iterator5.return();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}}else{var _iteratorNormalCompletion6=true;var _didIteratorError6=false;var _iteratorError6=undefined;try{for(var _iterator6=this.containers[Symbol.iterator](),_step6;!(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done);_iteratorNormalCompletion6=true){var _container=_step6.value;if(!_container.cull.static){_container.children.forEach(function(object){return _this4.updateObject(object);});}}}catch(err){_didIteratorError6=true;_iteratorError6=err;}finally{try{if(!_iteratorNormalCompletion6&&_iterator6.return){_iterator6.return();}}finally{if(_didIteratorError6){throw _iteratorError6;}}}}}/**
             * update the has of an object
             * automatically called from updateObjects()
             * @param {*} object
             * @param {boolean} [force] force update for calculatePIXI
             */},{key:'updateObject',value:function updateObject(object){var AABB=void 0;if(this.calculatePIXI){var box=object.getLocalBounds();AABB=object[this.AABB]={x:object.x+(box.x-object.pivot.x)*object.scale.x,y:object.y+(box.y-object.pivot.y)*object.scale.y,width:box.width*object.scale.x,height:box.height*object.scale.y};}else{AABB=object[this.AABB];}var spatial=object[this.spatial];if(!spatial){spatial=object[this.spatial]={hashes:[]};}var _getBounds=this.getBounds(AABB);var xStart=_getBounds.xStart;var yStart=_getBounds.yStart;var xEnd=_getBounds.xEnd;var yEnd=_getBounds.yEnd;// only remove and insert if mapping has changed
if(spatial.xStart!==xStart||spatial.yStart!==yStart||spatial.xEnd!==xEnd||spatial.yEnd!==yEnd){if(spatial.hashes.length){this.removeFromHash(object);}for(var y=yStart;y<=yEnd;y++){for(var x=xStart;x<=xEnd;x++){var key=`${x},${y}`;this.insert(object,key);spatial.hashes.push(key);}}spatial.xStart=xStart;spatial.yStart=yStart;spatial.xEnd=xEnd;spatial.yEnd=yEnd;}}/**
             * returns an array of buckets with >= minimum of objects in each bucket
             * @param {number} [minimum=1]
             * @return {array} array of buckets
             */},{key:'getBuckets',value:function getBuckets(){var minimum=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var hashes=[];for(var key in this.hash){var hash=this.hash[key];if(hash.length>=minimum){hashes.push(hash);}}return hashes;}/**
             * gets hash bounds
             * @param {AABB} AABB
             * @return {Bounds}
             * @private
             */},{key:'getBounds',value:function getBounds(AABB){var xStart=Math.floor(AABB.x/this.xSize);var yStart=Math.floor(AABB.y/this.ySize);var xEnd=Math.floor((AABB.x+AABB.width)/this.xSize);var yEnd=Math.floor((AABB.y+AABB.height)/this.ySize);return{xStart:xStart,yStart:yStart,xEnd:xEnd,yEnd:yEnd};}/**
             * insert object into the spatial hash
             * automatically called from updateObject()
             * @param {*} object
             * @param {string} key
             */},{key:'insert',value:function insert(object,key){if(!this.hash[key]){this.hash[key]=[object];}else{this.hash[key].push(object);}}/**
             * removes object from the hash table
             * should be called when removing an object
             * automatically called from updateObject()
             * @param {object} object
             */},{key:'removeFromHash',value:function removeFromHash(object){var spatial=object[this.spatial];while(spatial.hashes.length){var key=spatial.hashes.pop();var list=this.hash[key];list.splice(list.indexOf(object),1);}}/**
             * get all neighbors that share the same hash as object
             * @param {*} object in the spatial hash
             * @return {Array} of objects that are in the same hash as object
             */},{key:'neighbors',value:function neighbors(object){var _this5=this;var results=[];object[this.spatial].hashes.forEach(function(key){return results=results.concat(_this5.hash[key]);});return results;}/**
             * returns an array of objects contained within bounding box
             * @param {AABB} AABB bounding box to search
             * @param {boolean} [simpleTest=true] perform a simple bounds check of all items in the buckets
             * @return {object[]} search results
             */},{key:'query',value:function query(AABB,simpleTest){simpleTest=typeof simpleTest!=='undefined'?simpleTest:true;var buckets=0;var results=[];var _getBounds2=this.getBounds(AABB);var xStart=_getBounds2.xStart;var yStart=_getBounds2.yStart;var xEnd=_getBounds2.xEnd;var yEnd=_getBounds2.yEnd;for(var y=yStart;y<=yEnd;y++){for(var x=xStart;x<=xEnd;x++){var entry=this.hash[`${x},${y}`];if(entry){if(simpleTest){var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=entry[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var object=_step7.value;var box=object[this.AABB];if(box.x+box.width>AABB.x&&box.x<AABB.x+AABB.width&&box.y+box.height>AABB.y&&box.y<AABB.y+AABB.height){results.push(object);}}}catch(err){_didIteratorError7=true;_iteratorError7=err;}finally{try{if(!_iteratorNormalCompletion7&&_iterator7.return){_iterator7.return();}}finally{if(_didIteratorError7){throw _iteratorError7;}}}}else{results=results.concat(entry);}buckets++;}}}this.lastBuckets=buckets;return results;}/**
             * iterates through objects contained within bounding box
             * stops iterating if the callback returns true
             * @param {AABB} AABB bounding box to search
             * @param {function} callback
             * @param {boolean} [simpleTest=true] perform a simple bounds check of all items in the buckets
             * @return {boolean} true if callback returned early
             */},{key:'queryCallback',value:function queryCallback(AABB,callback,simpleTest){simpleTest=typeof simpleTest!=='undefined'?simpleTest:true;var _getBounds3=this.getBounds(AABB);var xStart=_getBounds3.xStart;var yStart=_getBounds3.yStart;var xEnd=_getBounds3.xEnd;var yEnd=_getBounds3.yEnd;for(var y=yStart;y<=yEnd;y++){for(var x=xStart;x<=xEnd;x++){var entry=this.hash[`${x},${y}`];if(entry){for(var i=0;i<entry.length;i++){var object=entry[i];if(simpleTest){var _AABB=object.AABB;if(_AABB.x+_AABB.width>_AABB.x&&_AABB.x<_AABB.x+_AABB.width&&_AABB.y+_AABB.height>_AABB.y&&_AABB.y<_AABB.y+_AABB.height){if(callback(object)){return true;}}}else{if(callback(object)){return true;}}}}}}return false;}/**
             * get stats
             * @return {Stats}
             */},{key:'stats',value:function stats(){var visible=0;var count=0;var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=this.containers[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var list=_step8.value;for(var i=0;i<list.children.length;i++){var object=list.children[i];visible+=object.visible?1:0;count++;}}}catch(err){_didIteratorError8=true;_iteratorError8=err;}finally{try{if(!_iteratorNormalCompletion8&&_iterator8.return){_iterator8.return();}}finally{if(_didIteratorError8){throw _iteratorError8;}}}return{total:count,visible:visible,culled:count-visible};}/**
             * helper function to evaluate hash table
             * @return {number} the number of buckets in the hash table
             * */},{key:'getNumberOfBuckets',value:function getNumberOfBuckets(){return Object.keys(this.hash).length;}/**
             * helper function to evaluate hash table
             * @return {number} the average number of entries in each bucket
             */},{key:'getAverageSize',value:function getAverageSize(){var total=0;for(var key in this.hash){total+=this.hash[key].length;}return total/this.getBuckets().length;}/**
             * helper function to evaluate the hash table
             * @return {number} the largest sized bucket
             */},{key:'getLargest',value:function getLargest(){var largest=0;for(var key in this.hash){if(this.hash[key].length>largest){largest=this.hash[key].length;}}return largest;}/**
             * gets quadrant bounds
             * @return {Bounds}
             */},{key:'getWorldBounds',value:function getWorldBounds(){var xStart=Infinity;var yStart=Infinity;var xEnd=0;var yEnd=0;for(var key in this.hash){var split=key.split(',');var x=parseInt(split[0]);var y=parseInt(split[1]);xStart=x<xStart?x:xStart;yStart=y<yStart?y:yStart;xEnd=x>xEnd?x:xEnd;yEnd=y>yEnd?y:yEnd;}return{xStart:xStart,yStart:yStart,xEnd:xEnd,yEnd:yEnd};}/**
             * helper function to evalute the hash table
             * @param {AABB} [AABB] bounding box to search or entire world
             * @return {number} sparseness percentage (i.e., buckets with at least 1 element divided by total possible buckets)
             */},{key:'getSparseness',value:function getSparseness(AABB){var count=0;var total=0;var _ref=AABB?this.getBounds(AABB):this.getWorldBounds();var xStart=_ref.xStart;var yStart=_ref.yStart;var xEnd=_ref.xEnd;var yEnd=_ref.yEnd;for(var y=yStart;y<yEnd;y++){for(var x=xStart;x<xEnd;x++){count+=this.hash[`${x},${y}`]?1:0;total++;}}return count/total;}}]);return SpatialHash;}();/**
     * @typedef {object} Stats
     * @property {number} total
     * @property {number} visible
     * @property {number} culled
     */ /**
     * @typedef {object} Bounds
     * @property {number} xStart
     * @property {number} yStart
     * @property {number} xEnd
     * @property {number} xEnd
     */ /**
      * @typedef {object} AABB
      * @property {number} x
      * @property {number} y
      * @property {number} width
      * @property {number} height
      */module.exports=SpatialHash;},{}]},{},[1]);;// var app, viewport, world;
var IgeInitPixi=$i_2.extend({classId:'IgeInitPixi',componentId:'pixi',init:function(){ige.addComponent($i_14);ige.addComponent(IgePixiTexture);var forceCanvas=JSON.parse(localStorage.getItem('forceCanvas'))||{};this.app=new PIXI.Application({width:800,// default: 800
height:600,// default: 600
antialias:true,// default: false
transparent:false,// default: false
resolution:1,// default: 1,
autoResize:true,forceCanvas:forceCanvas[gameId]||false// backgroundColor: 0xff00cc,
});this.app.ticker.maxFPS=60;PIXI.settings.SCALE_MODE=PIXI.SCALE_MODES.NEAREST;PIXI.settings.ROUND_PIXELS=true;this.timeStamp=Date.now();this.app.view.id='igeFrontBuffer';document.getElementById('game-div').appendChild(this.app.view);ige.createFrontBuffer(true);// PIXI.settings.PRECISION_FRAGMENT = 'highp';
this.app.renderer.autoDensity=true;this.initialWindowWidth=800;this.initialWindowHeight=600;this.currentZoomValue=0;this.trackEntityById={};this.world=new PIXI.Container();this.box2dDebug=new PIXI.Container();this.mobileControls=new PIXI.Container();this.mobileControls.zIndex=10;this.box2dDebug.zIndex=10;this.box2dDebug.tileMap=true;this.world.addChild(this.box2dDebug);// this.world.addChild(this.mobileControls);
this.isUpdateLayersOrderQueued=false;this.resizeCount=0;// make the mobileControls container fit to width and anchored to bottom
this.mobileControls.y=window.innerHeight-540;var scaleToFit=window.innerWidth/960;this.mobileControls.scale.set(scaleToFit,scaleToFit);/*
		var test1 = new PIXI.Sprite.from('https://cache.modd.io/asset/spriteImage/1516038135827_guide.png', { crossOrigin: true });
		test1.alpha = 0.2;
		this.mobileControls.addChild(test1);
		*/this.ticker=PIXI.Ticker.shared;this.loader=PIXI.Loader?PIXI.Loader.shared:PIXI.loader;// this.ticker.autoStart = false;
// this.ticker.stop();
this.app.ticker.stop();PIXI.Ticker.system.autoStart=false;PIXI.Ticker.system.stop();var self=this;var frameTick=function(){self.frameTick();};this.ticker.add(frameTick);var sort=function(children){children.sort(function(a,b){a.zIndex=a.zIndex||0;b.zIndex=b.zIndex||0;if(a.children&&a.children.length>0)sort(a.children);if(b.children&&b.children.length>0)sort(b.children);if(a.zIndex==b.zIndex){return a.depth-b.depth;}return a.zIndex-b.zIndex;});};this.app.stage.updateLayersOrder=function(){sort(self.app.stage.children);sort(self.world.children);};// a hack to call resize only when browser 'finishes' resizing.
// calling resize() on window.resize event creates CPU bottleneck
$(window).on('resize',function(e){self.resizeQueuedAt=ige._currentTime;});if(typeof ga!='undefined'&&ige.env!='local'){var renderingEngine='canvas';if(this.app.renderer.context.gl){renderingEngine=`webgl-${this.app.renderer.context.webGLVersion}`;}ga('send',{hitType:'event',eventCategory:'Rendering Engine',eventAction:renderingEngine});}},resize:function(){if(ige.pixi.viewport&&ige.pixi.viewport.scale){var currentWindowHeight=window.innerHeight;var currentWindowWidth=window.innerWidth;var currentScale=ige.pixi.viewport.scale.x;var ratioOfCurrentWindow=currentWindowWidth/ige.pixi.initialWindowWidth;currentScale=currentScale*ratioOfCurrentWindow;// Resize the renderer
ige.pixi.viewport.resize(currentWindowWidth,currentWindowHeight);ige.pixi.viewport.scale.set(currentScale);ige.pixi.app.renderer.resize(currentWindowWidth,currentWindowHeight);ige.pixi.initialWindowWidth=currentWindowWidth;ige.pixi.initialWIndowHeight=currentWindowHeight;// mobile controls anchor
ige.pixi.mobileControls.y=window.innerHeight-540;}},viewport:function(){var self=this;var offset=0;// PIXI.extras.Viewport = Viewport;
var viewport=new PIXI.extras.Viewport({screenWidth:800,screenHeight:600,worldWidth:this.world.worldWidth,worldHeight:this.world.worldHeight,interaction:this.app.renderer.plugins.interaction// the interaction module is important for wheel() to work properly when renderer.view is placed or scaled
}).decelerate().on('drag-start',function(e){console.log(e.world);// ige.pixi._mouseCord = {
//     x: e.world.x,
//     y: e.world.y,
// }
});// .clamp({
//     left: -offset,
//     right: this.world.worldWidth + offset,
//     top: - offset,
//     bottom: this.world.worldHeight + offset
// })
// .drag();
viewport.on('snap-zoom-start',function(){self.viewport.isZooming=true;});viewport.on('snap-zoom-end',function(){self.viewport.isZooming=false;});viewport.addChild(this.world);this.app.stage.addChild(viewport);// mobile controls should not follow the viewport...
this.app.stage.addChild(this.mobileControls);var cull=new PIXI.extras.cull.Simple();cull.addList(this.world.children);cull.cull(viewport.getVisibleBounds());this.cull=cull;this.viewport=viewport;ige.pixi.resize();},zoom:function(value){// value = -value;
// ige.pixi.viewport.zoom(-this.currentZoomValue);
ige.pixi.currentZoomValue=value;ige.pixi.viewport.snapZoom({height:value,ease:'easeOutQuad'},true);},frameTick:function(){ige.engineStep();ige.input.processInputOnEveryFps();this.timeStamp=Date.now();if(this.resizeQueuedAt&&this.resizeQueuedAt<ige._currentTime-250){this.resize();this.resizeQueuedAt=undefined;}if(this&&this.updateAllEntities){this.updateAllEntities();if(this.isUpdateLayersOrderQueued){this.app.stage.updateLayersOrder();this.isUpdateLayersOrderQueued=false;}ige._renderFrames++;}if(ige.pixi.viewport.dirty&&ige._cullCounter%4==0){ige.pixi.cull.cull(ige.pixi.viewport.getVisibleBounds());ige.pixi.viewport.dirty=false;}ige._cullCounter++;ige.pixi.app.render();// this.resizeCount = 0;
},updateAllEntities:function(timeStamp){var self=this;var currentTime=Date.now();if(!ige.lastTickTime)ige.lastTickTime=currentTime;var tickDelta=currentTime-ige.lastTickTime;// var entityCount = {unit: 0, item:0, player:0, wall:0, projectile: 0, undefined: 0, floatingLabel: 0}
for(var entityId in ige.pixi.trackEntityById){if(ige.pixi.trackEntityById[entityId]._destroyed){delete ige.pixi.trackEntityById[entityId];break;}var entity=ige.$(entityId);if(entity){// while zooming in/out, scale both unit name labels, attribute bars, and chatBubble
if(self.viewport.isZooming){if(entity.unitNameLabel){entity.unitNameLabel.updateScale();entity.unitNameLabel.updatePosition();}if(entity.attributeBars){_.forEach(entity.attributeBars,function(attributeBar){var bar=ige.$(attributeBar.id);bar.updateScale();bar.updatePosition();});}if(openChatBubble[entityId]){var chatBubble=ige.$(openChatBubble[entityId]);chatBubble.updateScale();chatBubble.updatePosition();}}// handle entity behaviour and transformation offsets
if(ige.gameLoopTickHasExecuted){if(entity._deathTime!==undefined&&entity._deathTime<=ige._tickStart){// Check if the deathCallBack was set
if(entity._deathCallBack){entity._deathCallBack.apply(entity);delete entity._deathCallBack;}entity.destroy();}if(entity._behaviour&&!entity.isHidden()){entity._behaviour();}// handle streamUpdateData
if(ige.client.myPlayer){var updateQueue=ige.client.entityUpdateQueue[entityId];if(updateQueue&&updateQueue.length>0){var nextUpdate=updateQueue[0];if(// Don't run if we're updating item's state/owner unit, but its owner doesn't exist yet
entity._category=='item'&&(nextUpdate.ownerUnitId&&ige.$(nextUpdate.ownerUnitId)==undefined||// updating item's owner unit, but the owner hasn't been created yet
(nextUpdate.stateId=='selected'||nextUpdate.stateId=='unselected')&&entity.getOwnerUnit()==undefined)// changing item's state to selected/unselected, but owner doesn't exist yet
){// console.log("detected update for item that don't have owner unit yet", entity.id(), nextUpdate)
}else{// console.log("entityUpdateQueue", entityId, nextUpdate)
entity.streamUpdateData([nextUpdate]);ige.client.entityUpdateQueue[entityId].shift();}}}}// return if entity is culled
// if (entity.isCulled) {
//     continue;
// }
// update transformation using incoming network stream
if(ige.network.stream&&ige._renderLatency!=undefined){entity._processTransform();}if(entity._translate&&!entity.isHidden()){var x=entity._translate.x;var y=entity._translate.y;var rotate=entity._rotate.z;if(entity._category=='item'){var ownerUnit=entity.getOwnerUnit();if(ownerUnit){ownerUnit._processTransform();// if ownerUnit's transformation hasn't been processed yet, then it'll cause item to drag behind. so we're running it now
// immediately rotate items for my own unit
if(ownerUnit==ige.client.selectedUnit){if(entity._stats.currentBody&&entity._stats.currentBody.jointType=='weldJoint'){rotate=ownerUnit._rotate.z;}else if(ownerUnit==ige.client.selectedUnit){rotate=ownerUnit.angleToTarget;// angleToTarget is updated at 60fps
}}entity.anchoredOffset=entity.getAnchoredOffset(rotate);if(entity.anchoredOffset){x=ownerUnit._translate.x+entity.anchoredOffset.x;y=ownerUnit._translate.y+entity.anchoredOffset.y;rotate=entity.anchoredOffset.rotate;}}}if(entity.tween&&entity.tween.isTweening){entity.tween.update();x+=entity.tween.offset.x;y+=entity.tween.offset.y;rotate+=entity.tween.offset.rotate;}entity.transformPixiEntity(x,y,rotate);// if (entity._pixiCollider && entity.bodyDef.type != 'static' && entity.bodyDef) {
// 	var w_xf = entity._pixiCollider.transform.worldTransform;
// 	console.log(
// 		`World xy:  (${w_xf.tx}, ${w_xf.ty})` +
// 		`\nLocal x-axis slope: ${w_xf.c / w_xf.a}` +
// 		`\nLocal y-axis slope: ${w_xf.d / w_xf.b}`
// 	);
// }
// handle animation
if(entity.pixianimation){if(entity.pixianimation.animating){if(!entity.pixianimation.fpsCount){entity.pixianimation.fpsCount=0;}if(entity.pixianimation.fpsCount>entity.pixianimation.fpsSecond){entity.pixianimation.animationTick();entity.pixianimation.fpsCount=0;}entity.pixianimation.fpsCount+=tickDelta;}}}}}ige.lastTickTime=currentTime;if(ige.gameLoopTickHasExecuted){ige.gameLoopTickHasExecuted=false;}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=IgeInitPixi;};var IgePixiMap=$i_2.extend({classId:'PixiMap',componentId:'pixiMap',init:function(){this.layersTexture={};this.layersGroup={};},loadJson:function(map,callback){var tileSetArray=map.tilesets;var layersById={};var layersByKey={};var self=this;var applyStats=function(resource,next){resource._stats={};var tileset=tileSetArray.find(function(tileset){if(tileset.image===resource.name)return true;});resource._stats=tileset;next();};ige.pixi.mapLoader=new PIXI.Loader();tileSetArray.forEach(tileset=>{// Loader.shared
var url=`${tileset.image}?version=${1}`;ige.pixi.mapLoader.add(tileset.image,url,{crossOrigin:true});});ige.pixi.mapLoader.use(applyStats);ige.pixi.mapLoader.load(function(loader,resources){map.tilewidth=parseFloat(map.tilewidth);map.tileheight=parseFloat(map.tileheight);map.width=parseFloat(map.width);map.height=parseFloat(map.height);ige.pixi.world.tileWidth=map.tilewidth;ige.pixi.world.tileHeight=map.tileheight;ige.pixi.world.worldWidth=map.width*map.tilewidth;ige.pixi.world.worldHeight=map.height*map.tileheight;// create viewport
ige.pixi.viewport();if(ige.pixi.world.worldWidth%2){ige.pixi.world.worldWidth--;}if(ige.pixi.world.worldHeight%2){ige.pixi.world.worldheight--;}ige.pixi.world.worldScreenHeight=600;ige.pixi.world.worldScreenWidth=400;ige.pixi.world.widthInTiles=map.width;ige.pixi.world.heightInTiles=map.height;ige.pixi.world.objects=[];let layerZIndex=['','floor','floor2','walls','trees'];var isHavingError=false;map.layers.forEach(function(tiledLayer,i){layersById[tiledLayer.name]=tiledLayer;layersByKey[i]=tiledLayer;var layerGroup=new PIXI.Container();if(tiledLayer.type==='tilelayer'){for(var index=0;index<map.width*map.height;index++){var gid=tiledLayer.data[index];var tileSprite=undefined;var texture=undefined;var mapX=undefined;var mapY=undefined;var tilesetX=undefined;var tilesetY=undefined;var mapColumn=undefined;var mapRow=undefined;var tilesetColumn=undefined;var tilesetRow=undefined;var tilesetObj=_.find(map.tilesets,tileset=>{if(gid>=tileset.firstgid&&gid<=tileset.firstgid+tileset.tilecount-1)return true;});if(tilesetObj){gid=gid-tilesetObj.firstgid+1;var spacing=parseFloat(tilesetObj.spacing)||0;var tileset=tilesetObj.image;var numberOfTilesetColumns=Math.floor(tilesetObj.imagewidth/(tilesetObj.tilewidth+spacing));// map x,y position of tile
mapColumn=index%ige.pixi.world.widthInTiles;mapRow=Math.floor(index/ige.pixi.world.widthInTiles);mapX=mapColumn*ige.pixi.world.tileWidth;mapY=mapRow*ige.pixi.world.tileHeight;// tileset x,y position of tile
tilesetColumn=(gid-1)%numberOfTilesetColumns;tilesetRow=Math.floor((gid-1)/numberOfTilesetColumns);tilesetX=tilesetColumn*ige.pixi.world.tileWidth;tilesetY=tilesetRow*ige.pixi.world.tileHeight;if(spacing>0){tilesetX+=spacing+spacing*((gid-1)%numberOfTilesetColumns);tilesetY+=spacing+spacing*Math.floor((gid-1)/numberOfTilesetColumns);}texture=resources[tileset].texture.clone();try{texture.frame=new PIXI.Rectangle(Math.round(tilesetX),Math.round(tilesetY),ige.pixi.world.tileWidth,ige.pixi.world.tileHeight);}catch(e){isHavingError={tileset:tileset,error:e.message,display:true};}tileSprite=new PIXI.Sprite(texture);tileSprite.x=mapX;tileSprite.y=mapY;tileSprite.index=index;tileSprite.gid=gid;layerGroup.addChild(tileSprite);}else{layerGroup.addChild(new PIXI.Sprite());}}var renderTexture=ige.pixi.app.renderer.generateTexture(layerGroup);var error=ige.pixi.app.renderer.gl&&ige.pixi.app.renderer.gl.getError();if(error>0&&ige.lastError!=error&&typeof Rollbar!=='undefined'){var forceCanvas=JSON.parse(localStorage.getItem('forceCanvas'))||{};forceCanvas[gameId]=true;localStorage.setItem('forceCanvas',JSON.stringify(forceCanvas));location.reload();ige.lastError=error;}renderTexture.tileMap=true;layerGroup=new PIXI.Sprite(renderTexture);layerGroup.scale.x=ige.scaleMapDetails.scaleFactor.x;layerGroup.scale.y=ige.scaleMapDetails.scaleFactor.y;Object.keys(tiledLayer).forEach(function(key){if(key!=='width'&&key!=='height'){layerGroup[key]=tiledLayer[key];}});// layerGroup.alpha = tiledLayer.opacity;
layerGroup.zIndex=layerZIndex.indexOf(tiledLayer.name);layerGroup.tileMap=true;self.layersTexture[tiledLayer.name]=renderTexture;self.layersGroup[tiledLayer.name]=layerGroup;ige.pixi.world.addChild(layerGroup);}});if(isHavingError&&isHavingError.display){alert(`Tilesheet '${isHavingError.tileset}' is having error in parsing. Log: ${isHavingError.error}`);}ige.pixi.viewport.moveCenter(ige.pixi.world.width/2,ige.pixi.world.height/2);callback(layersByKey,layersById);});}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=IgePixiMap;};var IgePixiTexture=$i_2.extend({classId:'IgePixiTexture',componentId:'pixitexture',init:function(entity){if(typeof arguments[0]=='string'){this._stats={url:arguments[0],columns:arguments[1],rows:arguments[2]};this._entity=arguments[3];}else{this._entity=entity;}},get:function(source,data){var texture=null;if(ige.pixi.loader.resources[source]&&ige.pixi.loader.resources[source].texture){texture=ige.pixi.loader.resources[source].texture.clone();}else if(PIXI.utils.BaseTextureCache[source]){texture=new PIXI.Texture(PIXI.utils.BaseTextureCache[source]);}else{var version=1;if(data&&data.entity.lastLoadedImage!=source){var resource=new PIXI.Loader();var options={};// if image is not from discord
options={crossOrigin:true};resource.add(source,`${source}?version=${version}`,options).load(function(){data.entity.pixianimation._anims={};data.entity[data.cb](data.animationId);});data.entity.lastLoadedImage=source;}texture=new PIXI.Texture(PIXI.utils.BaseTextureCache.emptyTexture);}return texture;},loadTextures:function(url,column,row){this._stats={};if(typeof url==='string'){var texture;var resource=ige.pixi.loader.resources[url];if(resource){texture=new PIXI.Sprite(resource.texture);this._stats.resourceTexture=resource.texture;}else{texture=new PIXI.Sprite.from(url);}this._stats.columns=parseInt(column);this._stats.rows=parseInt(row);texture.width=this._entity._stats.currentBody&&this._entity._stats.currentBody.width||this._entity._stats.width;texture.height=this._entity._stats.currentBody&&this._entity._stats.currentBody.height||this._entity._stats.height;// texture.pivot.set(texture.width / 2, texture.height / 2);
texture.anchor.set(0.5);texture.zIndex=this._entity._stats.currentBody&&this._entity._stats.currentBody['z-index'].layer||3;// texture.anchor.set(0.5);
texture._category=this._category;this._entity._pixiTexture=texture;this.texture=texture;return texture;}},spriteFromCellSheet:function(gid,log){// var spacing = map.tilesets[0].spacing || 0;
// gid = gid - 1;
var spacing=0;var resource=this.get(this._stats.url,{entity:this._entity,cb:'createPixiTexture',animationId:gid});var tilesetColumn=gid%this._stats.columns;var tilesetRow=Math.floor(gid/this._stats.columns);var spriteWidth=resource.width/this._stats.columns;var spriteHeight=resource.height/this._stats.rows;var tilesetX=tilesetColumn*spriteWidth;var tilesetY=tilesetRow*spriteHeight;resource=this.get(this._stats.url);try{resource.frame=new PIXI.Rectangle(tilesetX,tilesetY,spriteWidth,spriteHeight);}catch(e){console.log(`Error in loading texture from "${this._stats.url}'. Please check`,e);}var sprite=new PIXI.Sprite(resource);sprite.width=this._entity.width();sprite.height=this._entity.height();sprite.zIndex=3;// centering sprite
sprite.anchor.set(0.5);return sprite;},zOrder:function(order){this.zIndex=order;},generateFramesCells:function(cols,rows,texture){return cells;}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=IgePixiTexture;};var IgePixiAnimation=$i_2.extend({classId:'IgePixiAnimation',componentId:'pixianimation',init:function(entity){this._anims={};this._entity=entity;// this.addComponent(IgePixiTexture);
},exists:function(cellSheetAnimId){return!!this._anims[cellSheetAnimId];},define:function(source,col,row,cellSheetAnimId,animationId){var self=this;var sourceTexture=null;if(!this._anims[cellSheetAnimId]){sourceTexture=ige.pixitexture.get(source,{entity:this._entity,cb:'applyAnimationById',animationId:animationId});if(!sourceTexture)return;var spriteWidth=sourceTexture.width/col;var spriteHeight=sourceTexture.height/row;var texturesWithSprites=[];var animationTextures=ige.pixi.loader.resources[source]&&ige.pixi.loader.resources[source].animation&&ige.pixi.loader.resources[source].animation._anims;if(animationTextures){animationTextures.forEach(function(texture){texturesWithSprites.push(self.setSpriteProperty(texture.clone()));});}else{for(var i=0;i<row;i++){for(var j=0;j<col;j++){var tileX=j*spriteWidth;var tileY=i*spriteHeight;// need to get every time clone texture;
var resource=ige.pixitexture.get(source);try{resource.frame=new PIXI.Rectangle(tileX,tileY,spriteWidth,spriteHeight);}catch(e){console.log(e);alert(`animation for ${source} cannot be loaded`);}texturesWithSprites.push(self.setSpriteProperty(resource));}}}this._anims[cellSheetAnimId]=texturesWithSprites;}return this._anims[cellSheetAnimId];},setSpriteProperty:function(texture){var self=this;var sprite=new PIXI.Sprite(texture);sprite.zIndex=self._entity._layer||3;sprite.depth=self._entity._depth||3.33;sprite.anchor.set(0.5);sprite.width=self._entity._stats.currentBody&&self._entity._stats.currentBody.width||self._entity._stats.width;sprite.height=self._entity._stats.currentBody&&self._entity._stats.currentBody.height||self._entity._stats.height;return sprite;},getAnimationSprites:function(source,col,row){var sourceTexture=ige.pixitexture.get(source);if(!sourceTexture)return;var spriteWidth=sourceTexture.width/col;var spriteHeight=sourceTexture.height/row;var texturesWithSprites=[];for(var i=0;i<row;i++){for(var j=0;j<col;j++){var tileX=j*spriteWidth;var tileY=i*spriteHeight;// need to get every time clone texture;
var resource=ige.pixitexture.get(source);try{resource.frame=new PIXI.Rectangle(tileX,tileY,spriteWidth,spriteHeight);}catch(e){console.log(e);alert(`animation for ${source} cannot be loaded`);}texturesWithSprites.push(resource);}}this._anims=texturesWithSprites;return texturesWithSprites;},select:function(frames,fps=15,loopCount,cellSheetAnimId,animName){var self=this;var entity=ige.pixi.trackEntityById[self._entity.entityId];if(!entity)return;var startFrame=frames[0]-1;var lastFrame=frames[frames.length-1]-1;var totalNumberOfFrames=frames.length;self.i=0;self.fpsSecond=1000/fps;self.frames=frames;self.loopCount=loopCount;self.lastFrame=lastFrame;self.startFrame=startFrame;self.totalNumberOfFrames=frames.length;self._entity.currentAnimId=cellSheetAnimId;this.resetAnimation();if(!this.animating){this.animating=true;}},stopAtFrame:function(frameIndex){if(this._entity&&this._entity._pixiContainer&&!this._entity._pixiContainer._destroyed&&this._anims[this._entity.currentAnimId]&&this._anims[this._entity.currentAnimId][frameIndex]){this._entity._pixiTexture.texture=this._anims[this._entity.currentAnimId][frameIndex].texture;}},resetAnimation:function(){this.i=0;this.animating=false;},advanceFrame:function(frameNumber){var i=this.i;frameNumber=frameNumber-1;if(i<this.totalNumberOfFrames-1){this.stopAtFrame(frameNumber);if(i+1<this.totalNumberOfFrames){i++;}}else if(this.loopCount>0){this.stopAtFrame(this.startFrame);loopCount--;i=0;// stopAtFrame(startFrame);
// self._entity.pixianimation.select(frames, fps, loopCount = true, self._entity.currentAnimId);
}else if(this.loopCount===undefined||this.loopCount===-1||this.loopCount===''){i=0;this.stopAtFrame(this.lastFrame);}else{this.stopAtFrame(this.lastFrame);this.resetAnimation();}this.i=i;},animationTick:function(){if(this.animating){var i=this.i;this.advanceFrame(this.frames[i],i);}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=IgePixiAnimation;};var IgePixiFloatingText=$i_56.extend({classId:'IgePixiFloatingText',componentId:'pixiFloatingText',init:function(text,config){if(!config)config={};var defaultFontSize=12;var defaultBoldValue=false;var defaultMinLimit=300;var defaultColor='#fff';config.shouldBeBold=config&&config.shouldBeBold||defaultBoldValue;config.fontSize=config&&config.fontSize||defaultFontSize;config.minLimit=config&&config.minLimit||defaultMinLimit;config.color=config&&config.color||defaultColor;var textStyleConfig={fontFamily:'Verdana',fontSize:16,fontWeight:'bold'||config.shouldBeBold,fill:config.color,align:'center'};if(ige.game.data.settings.addStrokeToNameAndAttributes===undefined||ige.game.data.settings.addStrokeToNameAndAttributes){textStyleConfig.stroke='black';textStyleConfig.strokeThickness=4;}const style=new PIXI.TextStyle(textStyleConfig);// set stats because getOwner uses it
this._stats=config;var parentUnit=this.getOwner();var selectedUnit=ige.client.myPlayer&&ige.client.myPlayer.getSelectedUnit();var addLayer=selectedUnit&&parentUnit&&selectedUnit.id()==parentUnit.id()?2:1;var body=parentUnit&&parentUnit._stats.currentBody;var defaultLayer=4;var defaultDepth=0;var bodyZIndex=body&&body['z-index'];var depth=(bodyZIndex?bodyZIndex.depth:defaultDepth)+addLayer;var layer=bodyZIndex?bodyZIndex.layer:defaultLayer;this._id=this.id();text=typeof text==='string'&&text.toString()||'';var name=new PIXI.Text(text,style);name.zIndex=layer;name.depth=depth;name.anchor.set(0.5);ige.pixi.trackEntityById[this._id]=name;this._pixiText=name;this._pixiText._category='floating_text';this.category('floatingLabel');if(config.isFadeUp){name.x=0;name.y=-30;}else{// ige.pixi.world.addChild(name);
// return name;
}this.updateScale();this.updatePosition();return this;},setText:function(text){this._pixiText.text=text;},getOwner:function(){return this._stats.parentUnit?ige.$(this._stats.parentUnit):undefined;},colorOverlay:function(color){this._pixiText._style.fill=color;return this;},fadeUp:function(){var self=this;var duration=2000;var step=duration/60;var opacityStep=1/(step*5);var displacementPerStep=-20/step;this.interval=setInterval(function(){if(self._pixiText){self._pixiText.y+=displacementPerStep;self._pixiText.alpha-=opacityStep;}},1000/60);setTimeout(function(){clearInterval(self.interval);delete ige.pixi.trackEntityById[self.id];if(self._pixiText){self._pixiText.destroy();}self.destroy();},duration);return this;},updateScale:function(){this.scaleTo(1/ige.pixi.viewport.scale.x,1/ige.pixi.viewport.scale.y,1/ige.pixi.viewport.scale.z);},updatePosition:function(){if(this.getOwner()){this._pixiText.y=-3-this.getOwner().height()/2-17/ige.pixi.viewport.scale.y;}else{this._pixiText.y-=3;}},layer:function(layer){this._pixiText.zIndex=layer;return this;},depth:function(depth){this._pixiText.depth=depth;return this;},mount:function(mount){mount.addChild(this._pixiText);return this;},destroy:function(){var self=this;var parentUnit=self.getOwner();if(parentUnit&&parentUnit.gluedEntities){var index=-1;parentUnit.gluedEntities.forEach(function(gluedEntity,arrayIndex){if(gluedEntity.id===self.id()){index=arrayIndex;}});if(index>-1){var glueEntity=parentUnit.gluedEntities[index];ige.pixi.trackEntityById[glueEntity.id]&&ige.pixi.trackEntityById[glueEntity.id].destroy(true);parentUnit.gluedEntities.splice(index,1);}}$i_56.prototype.destroy.call(self);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=IgePixiFloatingText;};// var app, viewport, world;
var IgePixiChatBubble=$i_56.extend({classId:'IgePixiChatBubble',init:function(chatText,data){var maxWidth=230;var maxHeight=25;var cameraScale=ige.pixi.viewport.scale&&ige.pixi.viewport.scale.x;var camera=ige.pixi.viewport;this._id=this.id();var container=new PIXI.Container();this._stats={owner:data.parentUnit,bottomMargin:15/cameraScale};this.category('chatbubble');var words=chatText;if(words.length>40){words=words.substring(0,40);words+='...';}var style={fill:'#FFFFFF',// fontFamily: "Verdana",
fontWeight:600,fontSize:11,letterSpacing:0.5// stroke: 'black',
// strokeThickness: 4,
// fontWeight: "bold"
};var text=new PIXI.Text(words,style);maxWidth=text.width;maxWidth+=10;// width for rectangle
text.anchor.set(0.5);text.x=maxWidth/2;text.y=maxHeight/2;text.resolution=2;text.dirty=true;// draw rectangle
var graphic=new PIXI.Graphics();// graphic.lineStyle(2, 0x000000, 1);
graphic.beginFill(0x000000,0.5);graphic.drawRoundedRect(0,0,maxWidth,maxHeight,5);graphic.endFill();container.addChild(graphic);// draw triangle
var triangle=this.createTriangle(0,10,10);// triangle.anchor.set(0.5);
triangle.x=maxWidth/2-5;triangle.y=maxHeight;container.addChild(triangle);container.addChild(text);// var texture = ige.pixi.app.renderer.generateTexture(container);
// var sprite = new PIXI.Sprite(texture);
this.parentUnit=data.parentUnit;var owner=this.getOwner();// if (owner) {
container.zIndex=3;container.depth=10;// }
container.pivot.x=maxWidth/2;container.pivot.y=maxHeight/2;var offset=this.getOffset();container.y=offset;this._pixiContainer=container;this.scaleTo(1/camera.scale.x,1/camera.scale.y,1);// ige.pixi.trackEntityById[this._id] = container;
this.mount(owner._pixiContainer);return this;},updateScale:function(){this.scaleTo(1/ige.pixi.viewport.scale.x,1/ige.pixi.viewport.scale.y,1/ige.pixi.viewport.scale.z);},getOwner:function(){return ige.$(this.parentUnit);},updatePosition:function(){if(this._pixiContainer&&!this._pixiContainer._destroyed){this._pixiContainer.y=this.getOffset();}},getOffset:function(){var owner=this.getOwner();var bottomMargin=20;var nameLabel=null;for(var child of owner._pixiContainer.children){if(child._category==='floating_text'){nameLabel=child;break;}}if(nameLabel){return nameLabel.y-nameLabel.height-bottomMargin;}else{return-bottomMargin;}},createTriangle(xPos,yPos,i){var triangle=new PIXI.Graphics();triangle.x=xPos;triangle.y=yPos;var triangleWidth=10;var triangleHeight=5;var triangleHalfway=triangleWidth/2;// draw triangle
triangle.beginFill(0x000000,0.5);// triangle.lineStyle(2, 0x000000, 1);
triangle.moveTo(triangleWidth,0);triangle.lineTo(triangleHalfway,triangleHeight);triangle.lineTo(0,0);// triangle.lineStyle(0, 0x000000, 1);
triangle.lineTo(triangleHalfway,0);triangle.endFill();triangle.interactive=true;triangle.buttonMode=true;return triangle;},fade:function(fadeAfter){var self=this;setTimeout(()=>{var interval=setInterval(function(){if(self._pixiContainer){self._pixiContainer.alpha+=-0.1;if(self._pixiContainer.alpha<=0){clearInterval(interval);delete openChatBubble[this.parentUnit];self.destroy();}}else{clearInterval(interval);}},1000/60);},fadeAfter);return this;},destroy:function(){if(this._pixiContainer&&!this._pixiContainer._destroyed){this._pixiContainer.destroy(true);this._destroyed=true;delete ige.pixi.trackEntityById[this._id];}$i_56.prototype.destroy.call(this);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=IgePixiChatBubble;};var PixiAttributeBar=$i_56.extend({classId:'PixiAttributeBar',init:function(parentEntityId,attributeData,config){var self=this;$i_56.prototype.init.call(self);self.id();self.category('pixiBar');config=config||{};self._stats={parentId:parentEntityId};if(typeof attributeData.index!=='number'){console.log('attribute data',attributeData,'does not have index information');}if(attributeData.index<0){console.log('attribute data',attributeData,'have invalid index information');}var container=new PIXI.Container();var entity=ige.$(self._stats.parentId);self.index=attributeData.index;self.pixiBarBorder=new PIXI.Graphics();self.pixiBarMask=new PIXI.Graphics();self.pixiBar=new PIXI.Graphics();self.renderPixiBar(attributeData);var progressValueInPercent=attributeData.value/attributeData.max*100;progressValueInPercent=Math.max(0,Math.min(100,progressValueInPercent));self.lastValue={value:typeof attributeData.value==='number'?attributeData.value.toFixed(0):0,max:attributeData.max,progressValueInPercent:progressValueInPercent};if(attributeData.displayValue){// create floating label for attribute value
self.pixiBarText=new PIXI.Text('testing',self.getTextStyle());self.renderPixiBarTextValue(attributeData);self.pixiBar.addChild(self.pixiBarText);self.pixiBarText.anchor.set(0.5,0.1);}container.addChild(self.pixiBarBorder);container.addChild(self.pixiBarMask);container.addChild(self.pixiBar);entity._pixiContainer.addChild(container);self._pixiContainer=container;self.updatePosition();self.updateScale();},showValueAndFadeOut:function(fadeOutDuration){var self=this;if(self.showBarTimeout){self._pixiContainer.alpha=1;clearTimeout(self.showBarTimeout);clearTimeout(self.destroyTimeout);clearInterval(self.updateOpacityInterval);}self.showBarTimeout=setTimeout(function(){self.fadeOut(fadeOutDuration||500);},1000);},fadeOut:function(duration){duration=duration||2000;var self=this;var step=duration/60;var opacityStep=1/(step*5);self.updateOpacityInterval=setInterval(function(){self._pixiContainer.alpha-=opacityStep;},1000/60);self.destroyTimeout=setTimeout(function(){clearInterval(self.updateOpacityInterval);var parentEntity=self.getOwner();if(parentEntity){parentEntity.attributeBars=parentEntity.attributeBars.filter(function(bar){return bar.id!==self.id();});}self.destroy();},duration);return this;},/**
	 * @return {number} height of attribute bar
	 *
	 * returns valid height of attribute bar based on current zoom level
	 */barHeight:function(){return 11;},barWidth:function(){return 80;},borderRadius:function(){var self=this;return self.barHeight()/2-1;},getTextStyle:function(){return{fontFamily:'Arial',fill:'#000000',fontSize:11,fontWeight:'bold'};},getOwner:function(){return ige.$(this._stats.parentId);},updateScale:function(){this.scaleTo(1/ige.pixi.viewport.scale.x,1/ige.pixi.viewport.scale.y,1/ige.pixi.viewport.scale.z);},updatePosition:function(){this._pixiContainer.y=3+this.getOwner().height()/2+12*this.index/ige.pixi.viewport.scale.y;},renderPixiBar:function(attributeData){var self=this;var color=PIXI.utils.string2hex(attributeData.color);var progressValueInPercent=attributeData.value/attributeData.max;if(typeof attributeData.index!=='number'){console.error('attribute data does not includes "index" field, index of attribute bar is the number of attribute bar that is being rendered from unit head');}var width=self.barWidth();var height=self.barHeight();var borderRadius=self.borderRadius();self.pixiBarBorder.clear();self.pixiBarBorder.lineStyle(2,0x000000,1);self.pixiBarBorder.drawRoundedRect(-width/2,0,width,height,borderRadius);self.pixiBar.clear();self.pixiBar.beginFill(color);self.pixiBar.drawRoundedRect(-width/2,0,width*progressValueInPercent,height,borderRadius);self.pixiBar.endFill();// console.log('progressValueInPercent', progressValueInPercent);
self.pixiBarMask.clear();self.pixiBarMask.beginFill(0x000000);// this color does not matter
self.pixiBarMask.drawRoundedRect(-width/2,0,width,height,borderRadius);self.pixiBarMask.endFill();self.pixiBar.mask=self.pixiBarMask;},renderPixiBarTextValue:function(attributeData){var self=this;self.pixiBarText.text=self.lastValue.value;},/**
	 * @param {object} attributeData
	 *
	 * sets width of value bar based on provided {attributeData} data and
	 * updates text of value label if it exists
	 */updateBar:function(attributeData){var self=this;var progressValueInPercent=attributeData.value/attributeData.max*100;var newValue=attributeData.value.toFixed?attributeData.value.toFixed(0):0;if(self.lastValue.value&&self.lastValue.value===newValue){return;}progressValueInPercent=Math.max(0,Math.min(100,progressValueInPercent));progressValueInPercent=parseInt(progressValueInPercent);var shouldUpdateBar=self.lastValue.progressValueInPercent!==progressValueInPercent;self.lastValue={value:newValue,max:attributeData.max,progressValueInPercent:progressValueInPercent};// sometimes this apply style does not work so I am updating the canvas in requestAnimationFrame
if(shouldUpdateBar){self.renderPixiBar(attributeData);}if(self.pixiBarText){self.pixiBarText.text=self.lastValue.value;}var showOnlyWhenValueChanged=attributeData.showWhen instanceof Array&&attributeData.showWhen.indexOf('valueChanges')>-1;if(showOnlyWhenValueChanged){self.showValueAndFadeOut();}},destroy:function(){var self=this;if(self.pixiBar&&!self.pixiBar._destroyed){self.pixiBar&&self.pixiBar.destroy();}if(self.pixiBarBorder&&!self.pixiBarBorder._destroyed){self.pixiBarBorder&&self.pixiBarBorder.destroy();}if(self.pixiBarMask&&!self.pixiBarMask._destroyed){self.pixiBarMask&&self.pixiBarMask.destroy();}if(self.pixiBarText&&!self.pixiBarText._destroyed){self.pixiBarText.destroy();}if(self._pixiContainer&&!self._pixiContainer._destroyed){self._pixiContainer.destroy();}$i_56.prototype.destroy.call(self);}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=PixiAttributeBar;};!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Phaser",[],e):"object"==typeof exports?exports.Phaser=e():t.Phaser=e();}(this,function(){return n={},s.m=i=[function(t,e){function r(t,e,i,n){for(var s in e)if(e.hasOwnProperty(s)){var r=(u=e,l=s,f=d=void 0,f=(c=i)?u[l]:Object.getOwnPropertyDescriptor(u,l),!c&&f.value&&"object"==typeof f.value&&(f=f.value),!(!f||!((d=f).get&&"function"==typeof d.get||d.set&&"function"==typeof d.set))&&(void 0===f.enumerable&&(f.enumerable=!0),void 0===f.configurable&&(f.configurable=!0),f));if(!1!==r){if(o=(n||t).prototype,a=s,h=void 0,(h=Object.getOwnPropertyDescriptor(o,a))&&(h.value&&"object"==typeof h.value&&(h=h.value),!1===h.configurable)){if(p.ignoreFinals)continue;throw new Error("cannot override final property '"+s+"', set Class.ignoreFinals = true to skip");}Object.defineProperty(t.prototype,s,r);}else t.prototype[s]=e[s];}var o,a,h,u,l,c,d,f;}function o(t,e){if(e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)r(t,e[i].prototype||e[i]);}}function p(t){var e,i,n;if((t=t||{}).initialize){if("function"!=typeof t.initialize)throw new Error("initialize must be a function");n=t.initialize,delete t.initialize;}else{n=t.Extends?(i=t.Extends,function(){i.apply(this,arguments);}):function(){};}t.Extends?(n.prototype=Object.create(t.Extends.prototype),n.prototype.constructor=n,e=t.Extends,delete t.Extends):n.prototype.constructor=n;var s=null;return t.Mixins&&(s=t.Mixins,delete t.Mixins),o(n,s),r(n,t,!0,e),n;}p.extend=r,p.mixin=o,p.ignoreFinals=!1,t.exports=p;},function(t,e){t.exports=function(){};},function(t,e){t.exports=function(t,e,i){var n=typeof t;return t&&"number"!=n&&"string"!=n&&t.hasOwnProperty(e)&&void 0!==t[e]?t[e]:i;};},function(t,e,i){var n=i(0),s=i(124),r=new n({initialize:function(t,e){this.x=0,this.y=0,"object"==typeof t?(this.x=t.x||0,this.y=t.y||0):(void 0===e&&(e=t),this.x=t||0,this.y=e||0);},clone:function(){return new r(this.x,this.y);},copy:function(t){return this.x=t.x||0,this.y=t.y||0,this;},setFromObject:function(t){return this.x=t.x||0,this.y=t.y||0,this;},set:function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this;},setTo:function(t,e){return this.set(t,e);},setToPolar:function(t,e){return null==e&&(e=1),this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this;},equals:function(t){return this.x===t.x&&this.y===t.y;},fuzzyEquals:function(t,e){return s(this.x,t.x,e)&&s(this.y,t.y,e);},angle:function(){var t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t;},setAngle:function(t){return this.setToPolar(t,this.length());},add:function(t){return this.x+=t.x,this.y+=t.y,this;},subtract:function(t){return this.x-=t.x,this.y-=t.y,this;},multiply:function(t){return this.x*=t.x,this.y*=t.y,this;},scale:function(t){return isFinite(t)?(this.x*=t,this.y*=t):(this.x=0,this.y=0),this;},divide:function(t){return this.x/=t.x,this.y/=t.y,this;},negate:function(){return this.x=-this.x,this.y=-this.y,this;},distance:function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i);},distanceSq:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i;},length:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e);},setLength:function(t){return this.normalize().scale(t);},lengthSq:function(){var t=this.x,e=this.y;return t*t+e*e;},normalize:function(){var t=this.x,e=this.y,i=t*t+e*e;return 0<i&&(i=1/Math.sqrt(i),this.x=t*i,this.y=e*i),this;},normalizeRightHand:function(){var t=this.x;return this.x=-1*this.y,this.y=t,this;},normalizeLeftHand:function(){var t=this.x;return this.x=this.y,this.y=-1*t,this;},dot:function(t){return this.x*t.x+this.y*t.y;},cross:function(t){return this.x*t.y-this.y*t.x;},lerp:function(t,e){void 0===e&&(e=0);var i=this.x,n=this.y;return this.x=i+e*(t.x-i),this.y=n+e*(t.y-n),this;},transformMat3:function(t){var e=this.x,i=this.y,n=t.val;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this;},transformMat4:function(t){var e=this.x,i=this.y,n=t.val;return this.x=n[0]*e+n[4]*i+n[12],this.y=n[1]*e+n[5]*i+n[13],this;},reset:function(){return this.x=0,this.y=0,this;},limit:function(t){var e=this.length();return e&&t<e&&this.scale(t/e),this;},reflect:function(t){return t=t.clone().normalize(),this.subtract(t.scale(2*this.dot(t)));},mirror:function(t){return this.reflect(t).negate();},rotate:function(t){var e=Math.cos(t),i=Math.sin(t);return this.set(e*this.x-i*this.y,i*this.x+e*this.y);}});r.ZERO=new r(),r.RIGHT=new r(1,0),r.LEFT=new r(-1,0),r.UP=new r(0,-1),r.DOWN=new r(0,1),r.ONE=new r(1,1),t.exports=r;},function(t,e,i){var n=i(0),s=i(56),r=new n({initialize:function(t,e){void 0===t&&(t=0),void 0===e&&(e=t),this.type=s.POINT,this.x=t,this.y=e;},setTo:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this;}});t.exports=r;},function(t,e,i){var n=i(0),s=i(24),r=i(20),o=new n({initialize:function(t){this.scene=t,this.systems=t.sys,this.events=t.sys.events,this.displayList,this.updateList,this.events.once(r.BOOT,this.boot,this),this.events.on(r.START,this.start,this);},boot:function(){this.displayList=this.systems.displayList,this.updateList=this.systems.updateList,this.events.once(r.DESTROY,this.destroy,this);},start:function(){this.events.once(r.SHUTDOWN,this.shutdown,this);},existing:function(t){return(t.renderCanvas||t.renderWebGL)&&this.displayList.add(t),t.preUpdate&&this.updateList.add(t),t;},shutdown:function(){this.events.off(r.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.events.off(r.START,this.start,this),this.scene=null,this.systems=null,this.events=null,this.displayList=null,this.updateList=null;}});o.register=function(t,e){o.prototype.hasOwnProperty(t)||(o.prototype[t]=e);},o.remove=function(t){o.prototype.hasOwnProperty(t)&&delete o.prototype[t];},s.register("GameObjectFactory",o,"add"),t.exports=o;},function(t,e){t.exports=function(t,e,i){if(t&&"number"!=typeof t){if(t.hasOwnProperty(e))return t[e];if(-1===e.indexOf("."))return i;for(var n=e.split("."),s=t,r=i,o=0;o<n.length;o++){if(!s.hasOwnProperty(n[o])){r=i;break;}r=s[n[o]],s=s[n[o]];}return r;}return i;};},function(t,e){t.exports=function(t){if("object"!=typeof t||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1;}catch(t){return!1;}return!0;};},function(t,e){var i={},n={install:function(t){for(var e in i)t[e]=i[e];},register:function(t,e){i[t]=e;},destroy:function(){i={};}};t.exports=n;},function(t,e,i){"use strict";var n=Object.prototype.hasOwnProperty,f="~";function s(){}function a(t,e,i){this.fn=t,this.context=e,this.once=i||!1;}function r(t,e,i,n,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");var r=new a(i,n||t,s),o=f?f+e:e;return t._events[o]?t._events[o].fn?t._events[o]=[t._events[o],r]:t._events[o].push(r):(t._events[o]=r,t._eventsCount++),t;}function u(t,e){0==--t._eventsCount?t._events=new s():delete t._events[e];}function o(){this._events=new s(),this._eventsCount=0;}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(f=!1)),o.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)n.call(t,e)&&i.push(f?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i;},o.prototype.listeners=function(t){var e=f?f+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,s=i.length,r=new Array(s);n<s;n++)r[n]=i[n].fn;return r;},o.prototype.listenerCount=function(t){var e=f?f+t:t,i=this._events[e];return i?i.fn?1:i.length:0;},o.prototype.emit=function(t,e,i,n,s,r){var o=f?f+t:t;if(!this._events[o])return!1;var a,h=this._events[o],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,i),!0;case 4:return h.fn.call(h.context,e,i,n),!0;case 5:return h.fn.call(h.context,e,i,n,s),!0;case 6:return h.fn.call(h.context,e,i,n,s,r),!0;}for(d=1,a=new Array(u-1);d<u;d++)a[d-1]=arguments[d];h.fn.apply(h.context,a);}else for(var l,c=h.length,d=0;d<c;d++)switch(h[d].once&&this.removeListener(t,h[d].fn,void 0,!0),u){case 1:h[d].fn.call(h[d].context);break;case 2:h[d].fn.call(h[d].context,e);break;case 3:h[d].fn.call(h[d].context,e,i);break;case 4:h[d].fn.call(h[d].context,e,i,n);break;default:if(!a)for(l=1,a=new Array(u-1);l<u;l++)a[l-1]=arguments[l];h[d].fn.apply(h[d].context,a);}return!0;},o.prototype.on=function(t,e,i){return r(this,t,e,i,!1);},o.prototype.once=function(t,e,i){return r(this,t,e,i,!0);},o.prototype.removeListener=function(t,e,i,n){var s=f?f+t:t;if(!this._events[s])return this;if(!e)return u(this,s),this;var r=this._events[s];if(r.fn)r.fn!==e||n&&!r.once||i&&r.context!==i||u(this,s);else{for(var o=0,a=[],h=r.length;o<h;o++)(r[o].fn!==e||n&&!r[o].once||i&&r[o].context!==i)&&a.push(r[o]);a.length?this._events[s]=1===a.length?a[0]:a:u(this,s);}return this;},o.prototype.removeAllListeners=function(t){var e;return t?(e=f?f+t:t,this._events[e]&&u(this,e)):(this._events=new s(),this._eventsCount=0),this;},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=f,o.EventEmitter=o,t.exports=o;},function(t,e,i){var n=i(0),s=i(57),r=i(171),o=i(306),a=i(56),h=i(47),u=i(174),l=new n({initialize:function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.type=a.RECTANGLE,this.x=t,this.y=e,this.width=i,this.height=n;},contains:function(t,e){return s(this,t,e);},getPoint:function(t,e){return r(this,t,e);},getPoints:function(t,e,i){return o(this,t,e,i);},getRandomPoint:function(t){return u(this,t);},setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this;},setEmpty:function(){return this.setTo(0,0,0,0);},setPosition:function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this;},setSize:function(t,e){return void 0===e&&(e=t),this.width=t,this.height=e,this;},isEmpty:function(){return this.width<=0||this.height<=0;},getLineA:function(t){return void 0===t&&(t=new h()),t.setTo(this.x,this.y,this.right,this.y),t;},getLineB:function(t){return void 0===t&&(t=new h()),t.setTo(this.right,this.y,this.right,this.bottom),t;},getLineC:function(t){return void 0===t&&(t=new h()),t.setTo(this.right,this.bottom,this.x,this.bottom),t;},getLineD:function(t){return void 0===t&&(t=new h()),t.setTo(this.x,this.bottom,this.x,this.y),t;},left:{get:function(){return this.x;},set:function(t){t>=this.right?this.width=0:this.width=this.right-t,this.x=t;}},right:{get:function(){return this.x+this.width;},set:function(t){t<=this.x?this.width=0:this.width=t-this.x;}},top:{get:function(){return this.y;},set:function(t){t>=this.bottom?this.height=0:this.height=this.bottom-t,this.y=t;}},bottom:{get:function(){return this.y+this.height;},set:function(t){t<=this.y?this.height=0:this.height=t-this.y;}},centerX:{get:function(){return this.x+this.width/2;},set:function(t){this.x=t-this.width/2;}},centerY:{get:function(){return this.y+this.height/2;},set:function(t){this.y=t-this.height/2;}}});t.exports=l;},function(t,e,i){t.exports={Alpha:i(607),AlphaSingle:i(303),BlendMode:i(304),ComputedSize:i(608),Crop:i(609),Depth:i(305),Flip:i(610),GetBounds:i(611),Mask:i(309),Origin:i(632),PathFollower:i(633),Pipeline:i(167),ScrollFactor:i(312),Size:i(634),Texture:i(635),TextureCrop:i(636),Tint:i(637),ToJSON:i(176),Transform:i(313),TransformMatrix:i(25),Visible:i(314)};},function(t,e){t.exports={getTintFromFloats:function(t,e,i,n){return((255&(255*n|0))<<24|(255&(255*t|0))<<16|(255&(255*e|0))<<8|255&(255*i|0))>>>0;},getTintAppendFloatAlpha:function(t,e){return((255&(255*e|0))<<24|t)>>>0;},getTintAppendFloatAlphaAndSwap:function(t,e){return((255&(255*e|0))<<24|(255&(0|t))<<16|(255&(t>>8|0))<<8|255&(t>>16|0))>>>0;},getFloatsFromUintRGB:function(t){return[(255&(t>>16|0))/255,(255&(t>>8|0))/255,(255&(0|t))/255];},checkShaderMax:function(t,e){e&&-1!==e||(e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS));for(var i=t.createShader(t.FRAGMENT_SHADER),n=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");;){var s=n.replace(/%forloop%/gi,function(t){for(var e="",i=0;i<t;++i)0<i&&(e+="\nelse "),i<t-1&&(e+="if(test == "+i+".0){}");return e;}(e));if(t.shaderSource(i,s),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))break;e=e/2|0;}return e;},parseFragmentShaderMaxTextures:function(t,e){if(!t)return"";for(var i="",n=0;n<e;n++)0<n&&(i+="\n\telse "),n<e-1&&(i+="if (outTexId < "+n+".5)"),i+="\n\t{",i+="\n\t\ttexture = texture2D(uMainSampler["+n+"], outTexCoord);",i+="\n\t}";return(t=t.replace(/%count%/gi,e.toString())).replace(/%forloop%/gi,i);}};},function(t,e,i){var s=i(193),r=i(6);t.exports=function(t,e,i){var n=r(t,e,null);if(null===n)return i;if(Array.isArray(n))return s.RND.pick(n);if("object"==typeof n){if(n.hasOwnProperty("randInt"))return s.RND.integerInRange(n.randInt[0],n.randInt[1]);if(n.hasOwnProperty("randFloat"))return s.RND.realInRange(n.randFloat[0],n.randFloat[1]);}else if("function"==typeof n)return n(e);return n;};},function(t,e){var i={PI2:2*Math.PI,TAU:.5*Math.PI,EPSILON:1e-6,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,RND:null,MIN_SAFE_INTEGER:Number.MIN_SAFE_INTEGER||-9007199254740991,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991};t.exports=i;},function(t,e,i){var n=i(0),s=i(176),r=i(101),o=i(9),a=i(75),h=i(20),u=new n({Extends:o,initialize:function(t,e){o.call(this),this.scene=t,this.displayList=null,this.type=e,this.state=0,this.parentContainer=null,this.name="",this.active=!0,this.tabIndex=-1,this.data=null,this.renderFlags=15,this.cameraFilter=0,this.input=null,this.body=null,this.ignoreDestroy=!1,this.on(a.ADDED_TO_SCENE,this.addedToScene,this),this.on(a.REMOVED_FROM_SCENE,this.removedFromScene,this),t.sys.queueDepthSort();},setActive:function(t){return this.active=t,this;},setName:function(t){return this.name=t,this;},setState:function(t){return this.state=t,this;},setDataEnabled:function(){return this.data||(this.data=new r(this)),this;},setData:function(t,e){return this.data||(this.data=new r(this)),this.data.set(t,e),this;},incData:function(t,e){return this.data||(this.data=new r(this)),this.data.inc(t,e),this;},toggleData:function(t){return this.data||(this.data=new r(this)),this.data.toggle(t),this;},getData:function(t){return this.data||(this.data=new r(this)),this.data.get(t);},setInteractive:function(t,e,i){return this.scene.sys.input.enable(this,t,e,i),this;},disableInteractive:function(){return this.input&&(this.input.enabled=!1),this;},removeInteractive:function(){return this.scene.sys.input.clear(this),this.input=void 0,this;},addedToScene:function(){},removedFromScene:function(){},update:function(){},toJSON:function(){return s(this);},willRender:function(t){return!(u.RENDER_MASK!==this.renderFlags||0!==this.cameraFilter&&this.cameraFilter&t.id);},getIndexList:function(){for(var t=this,e=this.parentContainer,i=[];e&&(i.unshift(e.getIndex(t)),(t=e).parentContainer);)e=e.parentContainer;return this.displayList?i.unshift(this.displayList.getIndex(t)):i.unshift(this.scene.sys.displayList.getIndex(t)),i;},addToDisplayList:function(t){return void 0===t&&(t=this.scene.sys.displayList),this.displayList&&this.displayList!==t&&this.removeFromDisplayList(),t.exists(this)||((this.displayList=t).add(this,!0),t.queueDepthSort(),this.emit(a.ADDED_TO_SCENE,this,this.scene),t.events.emit(h.ADDED_TO_SCENE,this,this.scene)),this;},addToUpdateList:function(){return this.scene&&this.preUpdate&&this.scene.sys.updateList.add(this),this;},removeFromDisplayList:function(){var t=this.displayList||this.scene.sys.displayList;return t.exists(this)&&(t.remove(this,!0),t.queueDepthSort(),this.displayList=null,this.emit(a.REMOVED_FROM_SCENE,this,this.scene),t.events.emit(h.REMOVED_FROM_SCENE,this,this.scene)),this;},removeFromUpdateList:function(){return this.scene&&this.preUpdate&&this.scene.sys.updateList.remove(this),this;},destroy:function(t){this.scene&&!this.ignoreDestroy&&(void 0===t&&(t=!1),this.preDestroy&&this.preDestroy.call(this),this.emit(a.DESTROY,this,t),this.removeAllListeners(),this.postPipelines&&this.resetPostPipeline(!0),this.removeFromDisplayList(),this.removeFromUpdateList(),this.input&&(this.scene.sys.input.clear(this),this.input=void 0),this.data&&(this.data.destroy(),this.data=void 0),this.body&&(this.body.destroy(),this.body=void 0),this.active=!1,this.visible=!1,this.scene=void 0,this.parentContainer=void 0);}});u.RENDER_MASK=15,t.exports=u;},function(t,e,i){var n=i(0),s=i(24),r=i(20),o=new n({initialize:function(t){this.scene=t,this.systems=t.sys,this.events=t.sys.events,this.displayList,this.updateList,this.events.once(r.BOOT,this.boot,this),this.events.on(r.START,this.start,this);},boot:function(){this.displayList=this.systems.displayList,this.updateList=this.systems.updateList,this.events.once(r.DESTROY,this.destroy,this);},start:function(){this.events.once(r.SHUTDOWN,this.shutdown,this);},shutdown:function(){this.events.off(r.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.events.off(r.START,this.start,this),this.scene=null,this.systems=null,this.events=null,this.displayList=null,this.updateList=null;}});o.register=function(t,e){o.prototype.hasOwnProperty(t)||(o.prototype[t]=e);},o.remove=function(t){o.prototype.hasOwnProperty(t)&&delete o.prototype[t];},s.register("GameObjectCreator",o,"make"),t.exports=o;},function(t,e,i){var l=i(7),c=function(){var t,e,i,n,s,r,o=arguments[0]||{},a=1,h=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[1]||{},a=2),h===a&&(o=this,--a);a<h;a++)if(null!=(t=arguments[a]))for(e in t)i=o[e],o!==(n=t[e])&&(u&&n&&(l(n)||(s=Array.isArray(n)))?(r=s?(s=!1,i&&Array.isArray(i)?i:[]):i&&l(i)?i:{},o[e]=c(u,r,n)):void 0!==n&&(o[e]=n));return o;};t.exports=c;},function(t,e){t.exports=function(t,e,i){return Math.max(e,Math.min(i,t));};},function(t,e,i){var n=i(25),o=new n(),a=new n(),h=new n(),u={camera:o,sprite:a,calc:h};t.exports=function(t,e,i){var n=o,s=a,r=h;return s.applyITRS(t.x,t.y,t.rotation,t.scaleX,t.scaleY),n.copyFrom(e.matrix),i?(n.multiplyWithOffset(i,-e.scrollX*t.scrollFactorX,-e.scrollY*t.scrollFactorY),s.e=t.x,s.f=t.y):(s.e-=e.scrollX*t.scrollFactorX,s.f-=e.scrollY*t.scrollFactorY),n.multiply(s,r),u;};},function(t,e,i){t.exports={ADDED_TO_SCENE:i(656),BOOT:i(657),CREATE:i(658),DESTROY:i(659),PAUSE:i(660),POST_UPDATE:i(661),PRE_RENDER:i(662),PRE_UPDATE:i(663),READY:i(664),REMOVED_FROM_SCENE:i(665),RENDER:i(666),RESUME:i(667),SHUTDOWN:i(668),SLEEP:i(669),START:i(670),TRANSITION_COMPLETE:i(671),TRANSITION_INIT:i(672),TRANSITION_OUT:i(673),TRANSITION_START:i(674),TRANSITION_WAKE:i(675),UPDATE:i(676),WAKE:i(677)};},function(t,e){t.exports={LOADER_IDLE:0,LOADER_LOADING:1,LOADER_PROCESSING:2,LOADER_COMPLETE:3,LOADER_SHUTDOWN:4,LOADER_DESTROYED:5,FILE_PENDING:10,FILE_LOADING:11,FILE_LOADED:12,FILE_FAILED:13,FILE_PROCESSING:14,FILE_ERRORED:16,FILE_COMPLETE:17,FILE_DESTROYED:18,FILE_POPULATED:19};},function(t,e,i){t.exports={BLUR:i(612),BOOT:i(613),CONTEXT_LOST:i(614),CONTEXT_RESTORED:i(615),DESTROY:i(616),FOCUS:i(617),HIDDEN:i(618),PAUSE:i(619),POST_RENDER:i(620),POST_STEP:i(621),PRE_RENDER:i(622),PRE_STEP:i(623),READY:i(624),RESUME:i(625),STEP:i(626),VISIBLE:i(627)};},function(t,e,i){var n=i(0),s=i(21),r=i(95),o=i(2),a=i(155),h=i(240),u=i(517),l=i(156),c=new n({initialize:function(t,e){this.loader=t,this.cache=o(e,"cache",!1),this.type=o(e,"type",!1),this.key=o(e,"key",!1);var i=this.key;if(t.prefix&&""!==t.prefix&&(this.key=t.prefix+i),!this.type||!this.key)throw new Error("Invalid Loader."+this.type+" key");var n=o(e,"url");void 0===n?n=t.path+i+"."+o(e,"extension",""):"string"!=typeof n||n.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)||(n=t.path+n),this.url=n,this.src="",this.xhrSettings=l(o(e,"responseType",void 0)),o(e,"xhrSettings",!1)&&(this.xhrSettings=h(this.xhrSettings,o(e,"xhrSettings",{}))),this.xhrLoader=null,this.state="function"==typeof this.url?s.FILE_POPULATED:s.FILE_PENDING,this.bytesTotal=0,this.bytesLoaded=-1,this.percentComplete=-1,this.crossOrigin=void 0,this.data=void 0,this.config=o(e,"config",{}),this.multiFile,this.linkFile;},setLink:function(t){(this.linkFile=t).linkFile=this;},resetXHR:function(){this.xhrLoader&&(this.xhrLoader.onload=void 0,this.xhrLoader.onerror=void 0,this.xhrLoader.onprogress=void 0);},load:function(){this.state===s.FILE_POPULATED?this.loader.nextFile(this,!0):(this.state=s.FILE_LOADING,this.src=a(this,this.loader.baseURL),0===this.src.indexOf("data:")?console.warn("Local data URIs are not supported: "+this.key):this.xhrLoader=u(this,this.loader.xhr));},onLoad:function(t,e){var i=t.responseURL&&(0===t.responseURL.indexOf("file://")||0===t.responseURL.indexOf("capacitor://"))&&0===e.target.status,n=!(e.target&&200!==e.target.status)||i;4===t.readyState&&400<=t.status&&t.status<=599&&(n=!1),this.state=s.FILE_LOADED,this.resetXHR(),this.loader.nextFile(this,n);},onError:function(){this.resetXHR(),this.loader.nextFile(this,!1);},onProgress:function(t){t.lengthComputable&&(this.bytesLoaded=t.loaded,this.bytesTotal=t.total,this.percentComplete=Math.min(this.bytesLoaded/this.bytesTotal,1),this.loader.emit(r.FILE_PROGRESS,this,this.percentComplete));},onProcess:function(){this.state=s.FILE_PROCESSING,this.onProcessComplete();},onProcessComplete:function(){this.state=s.FILE_COMPLETE,this.multiFile&&this.multiFile.onFileComplete(this),this.loader.fileProcessComplete(this);},onProcessError:function(){this.state=s.FILE_ERRORED,this.multiFile&&this.multiFile.onFileFailed(this),this.loader.fileProcessComplete(this);},hasCacheConflict:function(){return this.cache&&this.cache.exists(this.key);},addToCache:function(){this.cache&&this.cache.add(this.key,this.data),this.pendingDestroy();},pendingDestroy:function(t){void 0===t&&(t=this.data);var e=this.key,i=this.type;this.loader.emit(r.FILE_COMPLETE,e,i,t),this.loader.emit(r.FILE_KEY_COMPLETE+i+"-"+e,e,i,t),this.loader.flagForRemoval(this);},destroy:function(){this.loader=null,this.cache=null,this.xhrSettings=null,this.multiFile=null,this.linkFile=null,this.data=null;}});c.createObjectURL=function(t,e,i){var n;"function"==typeof URL?t.src=URL.createObjectURL(e):((n=new FileReader()).onload=function(){t.removeAttribute("crossOrigin"),t.src="data:"+(e.type||i)+";base64,"+n.result.split(",")[1];},n.onerror=t.onerror,n.readAsDataURL(e));},c.revokeObjectURL=function(t){"function"==typeof URL&&URL.revokeObjectURL(t.src);},t.exports=c;},function(t,e){var s={},r={},i={register:function(t,e,i,n){void 0===n&&(n=!1),s[t]={plugin:e,mapping:i,custom:n};},registerCustom:function(t,e,i,n){r[t]={plugin:e,mapping:i,data:n};},hasCore:function(t){return s.hasOwnProperty(t);},hasCustom:function(t){return r.hasOwnProperty(t);},getCore:function(t){return s[t];},getCustom:function(t){return r[t];},getCustomClass:function(t){return r.hasOwnProperty(t)?r[t].plugin:null;},remove:function(t){s.hasOwnProperty(t)&&delete s[t];},removeCustom:function(t){r.hasOwnProperty(t)&&delete r[t];},destroyCorePlugins:function(){for(var t in s)s.hasOwnProperty(t)&&delete s[t];},destroyCustomPlugins:function(){for(var t in r)r.hasOwnProperty(t)&&delete r[t];}};t.exports=i;},function(t,e,i){var n=i(0),r=i(14),c=i(3),s=new n({initialize:function(t,e,i,n,s,r){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),void 0===s&&(s=0),void 0===r&&(r=0),this.matrix=new Float32Array([t,e,i,n,s,r,0,0,1]),this.decomposedMatrix={translateX:0,translateY:0,scaleX:1,scaleY:1,rotation:0};},a:{get:function(){return this.matrix[0];},set:function(t){this.matrix[0]=t;}},b:{get:function(){return this.matrix[1];},set:function(t){this.matrix[1]=t;}},c:{get:function(){return this.matrix[2];},set:function(t){this.matrix[2]=t;}},d:{get:function(){return this.matrix[3];},set:function(t){this.matrix[3]=t;}},e:{get:function(){return this.matrix[4];},set:function(t){this.matrix[4]=t;}},f:{get:function(){return this.matrix[5];},set:function(t){this.matrix[5]=t;}},tx:{get:function(){return this.matrix[4];},set:function(t){this.matrix[4]=t;}},ty:{get:function(){return this.matrix[5];},set:function(t){this.matrix[5]=t;}},rotation:{get:function(){return Math.acos(this.a/this.scaleX)*(Math.atan(-this.c/this.a)<0?-1:1);}},rotationNormalized:{get:function(){var t=this.matrix,e=t[0],i=t[1],n=t[2],s=t[3];return e||i?0<i?Math.acos(e/this.scaleX):-Math.acos(e/this.scaleX):n||s?r.TAU-(0<s?Math.acos(-n/this.scaleY):-Math.acos(n/this.scaleY)):0;}},scaleX:{get:function(){return Math.sqrt(this.a*this.a+this.b*this.b);}},scaleY:{get:function(){return Math.sqrt(this.c*this.c+this.d*this.d);}},loadIdentity:function(){var t=this.matrix;return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,this;},translate:function(t,e){var i=this.matrix;return i[4]=i[0]*t+i[2]*e+i[4],i[5]=i[1]*t+i[3]*e+i[5],this;},scale:function(t,e){var i=this.matrix;return i[0]*=t,i[1]*=t,i[2]*=e,i[3]*=e,this;},rotate:function(t){var e=Math.sin(t),i=Math.cos(t),n=this.matrix,s=n[0],r=n[1],o=n[2],a=n[3];return n[0]=s*i+o*e,n[1]=r*i+a*e,n[2]=s*-e+o*i,n[3]=r*-e+a*i,this;},multiply:function(t,e){var i=this.matrix,n=t.matrix,s=i[0],r=i[1],o=i[2],a=i[3],h=i[4],u=i[5],l=n[0],c=n[1],d=n[2],f=n[3],p=n[4],g=n[5],v=void 0===e?this:e;return v.a=l*s+c*o,v.b=l*r+c*a,v.c=d*s+f*o,v.d=d*r+f*a,v.e=p*s+g*o+h,v.f=p*r+g*a+u,v;},multiplyWithOffset:function(t,e,i){var n=this.matrix,s=t.matrix,r=n[0],o=n[1],a=n[2],h=n[3],u=e*r+i*a+n[4],l=e*o+i*h+n[5],c=s[0],d=s[1],f=s[2],p=s[3],g=s[4],v=s[5];return n[0]=c*r+d*a,n[1]=c*o+d*h,n[2]=f*r+p*a,n[3]=f*o+p*h,n[4]=g*r+v*a+u,n[5]=g*o+v*h+l,this;},transform:function(t,e,i,n,s,r){var o=this.matrix,a=o[0],h=o[1],u=o[2],l=o[3],c=o[4],d=o[5];return o[0]=t*a+e*u,o[1]=t*h+e*l,o[2]=i*a+n*u,o[3]=i*h+n*l,o[4]=s*a+r*u+c,o[5]=s*h+r*l+d,this;},transformPoint:function(t,e,i){void 0===i&&(i={x:0,y:0});var n=this.matrix,s=n[0],r=n[1],o=n[2],a=n[3],h=n[4],u=n[5];return i.x=t*s+e*o+h,i.y=t*r+e*a+u,i;},invert:function(){var t=this.matrix,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=e*s-i*n;return t[0]=s/a,t[1]=-i/a,t[2]=-n/a,t[3]=e/a,t[4]=(n*o-s*r)/a,t[5]=-(e*o-i*r)/a,this;},copyFrom:function(t){var e=this.matrix;return e[0]=t.a,e[1]=t.b,e[2]=t.c,e[3]=t.d,e[4]=t.e,e[5]=t.f,this;},copyFromArray:function(t){var e=this.matrix;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],this;},copyToContext:function(t){var e=this.matrix;return t.transform(e[0],e[1],e[2],e[3],e[4],e[5]),t;},setToContext:function(t){var e=this.matrix;return t.setTransform(e[0],e[1],e[2],e[3],e[4],e[5]),t;},copyToArray:function(t){var e=this.matrix;return void 0===t?t=[e[0],e[1],e[2],e[3],e[4],e[5]]:(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5]),t;},setTransform:function(t,e,i,n,s,r){var o=this.matrix;return o[0]=t,o[1]=e,o[2]=i,o[3]=n,o[4]=s,o[5]=r,this;},decomposeMatrix:function(){var t,e,i=this.decomposedMatrix,n=this.matrix,s=n[0],r=n[1],o=n[2],a=n[3],h=s*a-r*o;return i.translateX=n[4],i.translateY=n[5],s||r?(t=Math.sqrt(s*s+r*r),i.rotation=0<r?Math.acos(s/t):-Math.acos(s/t),i.scaleX=t,i.scaleY=h/t):o||a?(e=Math.sqrt(o*o+a*a),i.rotation=.5*Math.PI-(0<a?Math.acos(-o/e):-Math.acos(o/e)),i.scaleX=h/e,i.scaleY=e):(i.rotation=0,i.scaleX=0,i.scaleY=0),i;},applyITRS:function(t,e,i,n,s){var r=this.matrix,o=Math.sin(i),a=Math.cos(i);return r[4]=t,r[5]=e,r[0]=a*n,r[1]=o*n,r[2]=-o*s,r[3]=a*s,this;},applyInverse:function(t,e,i){void 0===i&&(i=new c());var n=this.matrix,s=n[0],r=n[1],o=n[2],a=n[3],h=n[4],u=n[5],l=1/(s*a+o*-r);return i.x=a*l*t+-o*l*e+(u*o-h*a)*l,i.y=s*l*e+-r*l*t+(-u*s+h*r)*l,i;},getX:function(t,e){return t*this.a+e*this.c+this.e;},getY:function(t,e){return t*this.b+e*this.d+this.f;},getXRound:function(t,e,i){var n=this.getX(t,e);return i&&(n=Math.round(n)),n;},getYRound:function(t,e,i){var n=this.getY(t,e);return i&&(n=Math.round(n)),n;},getCSSMatrix:function(){var t=this.matrix;return"matrix("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+")";},destroy:function(){this.matrix=null,this.decomposedMatrix=null;}});t.exports=s;},function(t,e,i){var f=i(2);t.exports=function(t,e,i,n,s,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=r.width),void 0===n&&(n=r.height);var o=f(s=s||{},"isNotEmpty",!1),a=f(s,"isColliding",!1),h=f(s,"hasInterestingFace",!1);t<0&&(i+=t,t=0),e<0&&(n+=e,e=0),t+i>r.width&&(i=Math.max(r.width-t,0)),e+n>r.height&&(n=Math.max(r.height-e,0));for(var u=[],l=e;l<e+n;l++)for(var c=t;c<t+i;c++){var d=r.data[l][c];if(null!==d){if(o&&-1===d.index)continue;if(a&&!d.collides)continue;if(h&&!d.hasInterestingFace)continue;u.push(d);}}return u;};},function(t,e){t.exports=function(t,e,i,n,s,r){var o;void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=1);var a=0,h=t.length;if(1===r)for(o=s;o<h;o++)t[o][e]=i+a*n,a++;else for(o=s;0<=o;o--)t[o][e]=i+a*n,a++;return t;};},function(t,e,i){var u=i(35),l=i(13);t.exports=function(t,e,i){e.x=l(i,"x",0),e.y=l(i,"y",0),e.depth=l(i,"depth",0),e.flipX=l(i,"flipX",!1),e.flipY=l(i,"flipY",!1);var n=l(i,"scale",null);"number"==typeof n?e.setScale(n):null!==n&&(e.scaleX=l(n,"x",1),e.scaleY=l(n,"y",1));var s=l(i,"scrollFactor",null);"number"==typeof s?e.setScrollFactor(s):null!==s&&(e.scrollFactorX=l(s,"x",1),e.scrollFactorY=l(s,"y",1)),e.rotation=l(i,"rotation",0);var r=l(i,"angle",null);null!==r&&(e.angle=r),e.alpha=l(i,"alpha",1);var o,a,h=l(i,"origin",null);return"number"==typeof h?e.setOrigin(h):null!==h&&(o=l(h,"x",.5),a=l(h,"y",.5),e.setOrigin(o,a)),e.blendMode=l(i,"blendMode",u.NORMAL),e.visible=l(i,"visible",!0),l(i,"add",!0)&&t.sys.displayList.add(e),e.preUpdate&&t.sys.updateList.add(e),e;};},function(t,e){t.exports={ORTHOGONAL:0,ISOMETRIC:1,STAGGERED:2,HEXAGONAL:3};},function(t,e,i){var a=i(19);t.exports=function(t,e,i,n,s){var r=n.alpha*i.alpha;if(r<=0)return!1;var o=a(i,n,s).calc;return e.globalCompositeOperation=t.blendModes[i.blendMode],e.globalAlpha=r,e.save(),o.setToContext(e),e.imageSmoothingEnabled=!(!t.antialias||i.frame&&i.frame.source.scaleMode),!0;};},function(t,e,i){var a,h=i(33),u=i(192),l=[],c=!1;function n(t,e,i,n,s){void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=h.CANVAS),void 0===s&&(s=!1);var r=a(n),o=(null===r?(r={parent:t,canvas:document.createElement("canvas"),type:n},n===h.CANVAS&&l.push(r)):r.parent=t,r.canvas);return s&&(r.parent=o),o.width=e,o.height=i,c&&n===h.CANVAS&&u.disable(o.getContext("2d")),o;}function s(){var e=0;return l.forEach(function(t){t.parent&&e++;}),e;}t.exports={create2D:function(t,e,i){return n(t,e,i,h.CANVAS);},create:n,createWebGL:function(t,e,i){return n(t,e,i,h.WEBGL);},disableSmoothing:function(){c=!0;},enableSmoothing:function(){c=!1;},first:a=function(t){if(void 0===t&&(t=h.CANVAS),t===h.WEBGL)return null;for(var e=0;e<l.length;e++){var i=l[e];if(!i.parent&&i.type===t)return i;}return null;},free:function(){return l.length-s();},pool:l,remove:function(e){var i=e instanceof HTMLCanvasElement;l.forEach(function(t){(i&&t.canvas===e||!i&&t.parent===e)&&(t.parent=null,t.canvas.width=1,t.canvas.height=1);});},total:s};},,function(t,e,i){var n={VERSION:"3.55.2",BlendModes:i(35),ScaleModes:i(168),AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,FOREVER:-1,NONE:4,UP:5,DOWN:6,LEFT:7,RIGHT:8};t.exports=n;},function(t,e,i){var n=i(0),s=i(11),r=i(15),o=i(47),a=new n({Extends:r,Mixins:[s.AlphaSingle,s.BlendMode,s.Depth,s.GetBounds,s.Mask,s.Origin,s.Pipeline,s.ScrollFactor,s.Transform,s.Visible],initialize:function(t,e,i){void 0===e&&(e="Shape"),r.call(this,t,e),this.geom=i,this.pathData=[],this.pathIndexes=[],this.fillColor=16777215,this.fillAlpha=1,this.strokeColor=16777215,this.strokeAlpha=1,this.lineWidth=1,this.isFilled=!1,this.isStroked=!1,this.closePath=!0,this._tempLine=new o(),this.width=0,this.height=0,this.initPipeline();},setFillStyle:function(t,e){return void 0===e&&(e=1),void 0===t?this.isFilled=!1:(this.fillColor=t,this.fillAlpha=e,this.isFilled=!0),this;},setStrokeStyle:function(t,e,i){return void 0===i&&(i=1),void 0===t?this.isStroked=!1:(this.lineWidth=t,this.strokeColor=e,this.strokeAlpha=i,this.isStroked=!0),this;},setClosePath:function(t){return this.closePath=t,this;},setSize:function(t,e){return this.width=t,this.height=e,this;},setDisplaySize:function(t,e){return this.displayWidth=t,this.displayHeight=e,this;},preDestroy:function(){this.geom=null,this._tempLine=null,this.pathData=[],this.pathIndexes=[];},displayWidth:{get:function(){return this.scaleX*this.width;},set:function(t){this.scaleX=t/this.width;}},displayHeight:{get:function(){return this.scaleY*this.height;},set:function(t){this.scaleY=t/this.height;}}});t.exports=a;},function(t,e){t.exports={SKIP_CHECK:-1,NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,ERASE:17,SOURCE_IN:18,SOURCE_OUT:19,SOURCE_ATOP:20,DESTINATION_OVER:21,DESTINATION_IN:22,DESTINATION_OUT:23,DESTINATION_ATOP:24,LIGHTER:25,COPY:26,XOR:27};},function(t,e,i){var n=i(14);t.exports=function(t){return t*n.DEG_TO_RAD;};},function(t,e,i){t.exports={DESTROY:i(743),FADE_IN_COMPLETE:i(744),FADE_IN_START:i(745),FADE_OUT_COMPLETE:i(746),FADE_OUT_START:i(747),FLASH_COMPLETE:i(748),FLASH_START:i(749),FOLLOW_UPDATE:i(750),PAN_COMPLETE:i(751),PAN_START:i(752),POST_RENDER:i(753),PRE_RENDER:i(754),ROTATE_COMPLETE:i(755),ROTATE_START:i(756),SHAKE_COMPLETE:i(757),SHAKE_START:i(758),ZOOM_COMPLETE:i(759),ZOOM_START:i(760)};},function(t,e,i){var n=i(0),r=i(103),o=i(328),s=i(188),a=i(329),h=new n({initialize:function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=255),this.r=0,this.g=0,this.b=0,this.a=255,this._h=0,this._s=0,this._v=0,this._locked=!1,this.gl=[0,0,0,1],this._color=0,this._color32=0,this._rgba="",this.setTo(t,e,i,n);},transparent:function(){return this._locked=!0,this.red=0,this.green=0,this.blue=0,this.alpha=0,this._locked=!1,this.update(!0);},setTo:function(t,e,i,n,s){return void 0===n&&(n=255),void 0===s&&(s=!0),this._locked=!0,this.red=t,this.green=e,this.blue=i,this.alpha=n,this._locked=!1,this.update(s);},setGLTo:function(t,e,i,n){return void 0===n&&(n=1),this._locked=!0,this.redGL=t,this.greenGL=e,this.blueGL=i,this.alphaGL=n,this._locked=!1,this.update(!0);},setFromRGB:function(t){return this._locked=!0,this.red=t.r,this.green=t.g,this.blue=t.b,t.hasOwnProperty("a")&&(this.alpha=t.a),this._locked=!1,this.update(!0);},setFromHSV:function(t,e,i){return s(t,e,i,this);},update:function(t){if(void 0===t&&(t=!1),this._locked)return this;var e=this.r,i=this.g,n=this.b,s=this.a;return this._color=r(e,i,n),this._color32=o(e,i,n,s),this._rgba="rgba("+e+","+i+","+n+","+s/255+")",t&&a(e,i,n,this),this;},updateHSV:function(){var t=this.r,e=this.g,i=this.b;return a(t,e,i,this),this;},clone:function(){return new h(this.r,this.g,this.b,this.a);},gray:function(t){return this.setTo(t,t,t);},random:function(t,e){void 0===t&&(t=0),void 0===e&&(e=255);var i=Math.floor(t+Math.random()*(e-t)),n=Math.floor(t+Math.random()*(e-t)),s=Math.floor(t+Math.random()*(e-t));return this.setTo(i,n,s);},randomGray:function(t,e){void 0===t&&(t=0),void 0===e&&(e=255);var i=Math.floor(t+Math.random()*(e-t));return this.setTo(i,i,i);},saturate:function(t){return this.s+=t/100,this;},desaturate:function(t){return this.s-=t/100,this;},lighten:function(t){return this.v+=t/100,this;},darken:function(t){return this.v-=t/100,this;},brighten:function(t){var e=this.r,i=this.g,n=this.b,e=Math.max(0,Math.min(255,e-Math.round(-t/100*255))),i=Math.max(0,Math.min(255,i-Math.round(-t/100*255))),n=Math.max(0,Math.min(255,n-Math.round(-t/100*255)));return this.setTo(e,i,n);},color:{get:function(){return this._color;}},color32:{get:function(){return this._color32;}},rgba:{get:function(){return this._rgba;}},redGL:{get:function(){return this.gl[0];},set:function(t){this.gl[0]=Math.min(Math.abs(t),1),this.r=Math.floor(255*this.gl[0]),this.update(!0);}},greenGL:{get:function(){return this.gl[1];},set:function(t){this.gl[1]=Math.min(Math.abs(t),1),this.g=Math.floor(255*this.gl[1]),this.update(!0);}},blueGL:{get:function(){return this.gl[2];},set:function(t){this.gl[2]=Math.min(Math.abs(t),1),this.b=Math.floor(255*this.gl[2]),this.update(!0);}},alphaGL:{get:function(){return this.gl[3];},set:function(t){this.gl[3]=Math.min(Math.abs(t),1),this.a=Math.floor(255*this.gl[3]),this.update();}},red:{get:function(){return this.r;},set:function(t){t=Math.floor(Math.abs(t)),this.r=Math.min(t,255),this.gl[0]=t/255,this.update(!0);}},green:{get:function(){return this.g;},set:function(t){t=Math.floor(Math.abs(t)),this.g=Math.min(t,255),this.gl[1]=t/255,this.update(!0);}},blue:{get:function(){return this.b;},set:function(t){t=Math.floor(Math.abs(t)),this.b=Math.min(t,255),this.gl[2]=t/255,this.update(!0);}},alpha:{get:function(){return this.a;},set:function(t){t=Math.floor(Math.abs(t)),this.a=Math.min(t,255),this.gl[3]=t/255,this.update();}},h:{get:function(){return this._h;},set:function(t){this._h=t,s(t,this._s,this._v,this);}},s:{get:function(){return this._s;},set:function(t){this._s=t,s(this._h,t,this._v,this);}},v:{get:function(){return this._v;},set:function(t){this._v=t,s(this._h,this._s,t,this);}}});t.exports=h;},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i){this.x=0,this.y=0,this.z=0,"object"==typeof t?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0):(this.x=t||0,this.y=e||0,this.z=i||0);},up:function(){return this.x=0,this.y=1,this.z=0,this;},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this;},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this;},clone:function(){return new n(this.x,this.y,this.z);},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this;},crossVectors:function(t,e){var i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this;},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z;},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z||0,this;},set:function(t,e,i){return"object"==typeof t?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0):(this.x=t||0,this.y=e||0,this.z=i||0),this;},setFromMatrixPosition:function(t){return this.fromArray(t.val,12);},setFromMatrixColumn:function(t,e){return this.fromArray(t.val,4*e);},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this;},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z||0,this;},addScalar:function(t){return this.x+=t,this.y+=t,this.z+=t,this;},addScale:function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e||0,this;},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z||0,this;},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z||1,this;},scale:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this;},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z||1,this;},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this;},distance:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z||0;return Math.sqrt(e*e+i*i+n*n);},distanceSq:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z||0;return e*e+i*i+n*n;},length:function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i);},lengthSq:function(){var t=this.x,e=this.y,i=this.z;return t*t+e*e+i*i;},normalize:function(){var t=this.x,e=this.y,i=this.z,n=t*t+e*e+i*i;return 0<n&&(n=1/Math.sqrt(n),this.x=t*n,this.y=e*n,this.z=i*n),this;},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z;},cross:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z;return this.x=i*o-n*r,this.y=n*s-e*o,this.z=e*r-i*s,this;},lerp:function(t,e){void 0===e&&(e=0);var i=this.x,n=this.y,s=this.z;return this.x=i+e*(t.x-i),this.y=n+e*(t.y-n),this.z=s+e*(t.z-s),this;},applyMatrix3:function(t){var e=this.x,i=this.y,n=this.z,s=t.val;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this;},applyMatrix4:function(t){var e=this.x,i=this.y,n=this.z,s=t.val,r=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*r,this;},transformMat3:function(t){var e=this.x,i=this.y,n=this.z,s=t.val;return this.x=e*s[0]+i*s[3]+n*s[6],this.y=e*s[1]+i*s[4]+n*s[7],this.z=e*s[2]+i*s[5]+n*s[8],this;},transformMat4:function(t){var e=this.x,i=this.y,n=this.z,s=t.val;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12],this.y=s[1]*e+s[5]*i+s[9]*n+s[13],this.z=s[2]*e+s[6]*i+s[10]*n+s[14],this;},transformCoordinates:function(t){var e=this.x,i=this.y,n=this.z,s=t.val,r=e*s[0]+i*s[4]+n*s[8]+s[12],o=e*s[1]+i*s[5]+n*s[9]+s[13],a=e*s[2]+i*s[6]+n*s[10]+s[14],h=e*s[3]+i*s[7]+n*s[11]+s[15];return this.x=r/h,this.y=o/h,this.z=a/h,this;},transformQuat:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z,a=t.w,h=a*e+r*n-o*i,u=a*i+o*e-s*n,l=a*n+s*i-r*e,c=-s*e-r*i-o*n;return this.x=h*a+c*-s+u*-o-l*-r,this.y=u*a+c*-r+l*-s-h*-o,this.z=l*a+c*-o+h*-r-u*-s,this;},project:function(t){var e=this.x,i=this.y,n=this.z,s=t.val,r=s[0],o=s[1],a=s[2],h=s[3],u=s[4],l=s[5],c=s[6],d=s[7],f=s[8],p=s[9],g=s[10],v=s[11],m=s[12],y=s[13],x=s[14],T=1/(e*h+i*d+n*v+s[15]);return this.x=(e*r+i*u+n*f+m)*T,this.y=(e*o+i*l+n*p+y)*T,this.z=(e*a+i*c+n*g+x)*T,this;},projectViewMatrix:function(t,e){return this.applyMatrix4(t).applyMatrix4(e);},unprojectViewMatrix:function(t,e){return this.applyMatrix4(t).applyMatrix4(e);},unproject:function(t,e){var i=t.x,n=t.y,s=t.z,r=t.w,o=this.x-i,a=r-this.y-1-n,h=this.z;return this.x=2*o/s-1,this.y=2*a/r-1,this.z=2*h-1,this.project(e);},reset:function(){return this.x=0,this.y=0,this.z=0,this;}});n.ZERO=new n(),n.RIGHT=new n(1,0,0),n.LEFT=new n(-1,0,0),n.UP=new n(0,-1,0),n.DOWN=new n(0,1,0),n.FORWARD=new n(0,0,1),n.BACK=new n(0,0,-1),n.ONE=new n(1,1,1),t.exports=n;},function(t,e){t.exports={CSV:0,TILED_JSON:1,ARRAY_2D:2,WELTMEISTER:3};},,function(t,e){t.exports=function(t){return t.y+t.height-t.height*t.originY;};},function(t,e){t.exports=function(t){return t.x-t.width*t.originX;};},function(t,e){t.exports=function(t){return t.x+t.width-t.width*t.originX;};},function(t,e){t.exports=function(t){return t.y-t.height*t.originY;};},function(t,e){t.exports=function(t,e,i,n,s,r){var o;void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=1);var a=0,h=t.length;if(1===r)for(o=s;o<h;o++)t[o][e]+=i+a*n,a++;else for(o=s;0<=o;o--)t[o][e]+=i+a*n,a++;return t;};},function(t,e,i){var n=i(0),s=i(307),r=i(172),o=i(56),a=i(173),h=i(3),u=new n({initialize:function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.type=o.LINE,this.x1=t,this.y1=e,this.x2=i,this.y2=n;},getPoint:function(t,e){return s(this,t,e);},getPoints:function(t,e,i){return r(this,t,e,i);},getRandomPoint:function(t){return a(this,t);},setTo:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.x1=t,this.y1=e,this.x2=i,this.y2=n,this;},getPointA:function(t){return void 0===t&&(t=new h()),t.set(this.x1,this.y1),t;},getPointB:function(t){return void 0===t&&(t=new h()),t.set(this.x2,this.y2),t;},left:{get:function(){return Math.min(this.x1,this.x2);},set:function(t){this.x1<=this.x2?this.x1=t:this.x2=t;}},right:{get:function(){return Math.max(this.x1,this.x2);},set:function(t){this.x1>this.x2?this.x1=t:this.x2=t;}},top:{get:function(){return Math.min(this.y1,this.y2);},set:function(t){this.y1<=this.y2?this.y1=t:this.y2=t;}},bottom:{get:function(){return Math.max(this.y1,this.y2);},set:function(t){this.y1>this.y2?this.y1=t:this.y2=t;}}});t.exports=u;},function(t,e){t.exports=function(t,e,i,n){var s=i||e.fillColor,r=n||e.fillAlpha,o=(16711680&s)>>>16,a=(65280&s)>>>8,h=255&s;t.fillStyle="rgba("+o+","+a+","+h+","+r+")";};},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n){var s=[];n.forEach(function(t){t&&s.push(t);}),this.loader=t,this.type=e,this.key=i,this.multiKeyIndex=t.multiKeyIndex++,this.files=s,this.complete=!1,this.pending=s.length,this.failed=0,this.config={},this.baseURL=t.baseURL,this.path=t.path,this.prefix=t.prefix;for(var r=0;r<s.length;r++)s[r].multiFile=this;},isReadyToProcess:function(){return 0===this.pending&&0===this.failed&&!this.complete;},addToMultiFile:function(t){return this.files.push(t),(t.multiFile=this).pending++,this.complete=!1,this;},onFileComplete:function(t){-1!==this.files.indexOf(t)&&this.pending--;},onFileFailed:function(t){-1!==this.files.indexOf(t)&&this.failed++;}});t.exports=n;},function(t,e){t.exports=function(t,e,i,n){var s=t-i,r=e-n;return Math.sqrt(s*s+r*r);};},function(t,e,i){t.exports={BOOT:i(922),DESTROY:i(923),DRAG_END:i(924),DRAG_ENTER:i(925),DRAG:i(926),DRAG_LEAVE:i(927),DRAG_OVER:i(928),DRAG_START:i(929),DROP:i(930),GAME_OUT:i(931),GAME_OVER:i(932),GAMEOBJECT_DOWN:i(933),GAMEOBJECT_DRAG_END:i(934),GAMEOBJECT_DRAG_ENTER:i(935),GAMEOBJECT_DRAG:i(936),GAMEOBJECT_DRAG_LEAVE:i(937),GAMEOBJECT_DRAG_OVER:i(938),GAMEOBJECT_DRAG_START:i(939),GAMEOBJECT_DROP:i(940),GAMEOBJECT_MOVE:i(941),GAMEOBJECT_OUT:i(942),GAMEOBJECT_OVER:i(943),GAMEOBJECT_POINTER_DOWN:i(944),GAMEOBJECT_POINTER_MOVE:i(945),GAMEOBJECT_POINTER_OUT:i(946),GAMEOBJECT_POINTER_OVER:i(947),GAMEOBJECT_POINTER_UP:i(948),GAMEOBJECT_POINTER_WHEEL:i(949),GAMEOBJECT_UP:i(950),GAMEOBJECT_WHEEL:i(951),MANAGER_BOOT:i(952),MANAGER_PROCESS:i(953),MANAGER_UPDATE:i(954),POINTER_DOWN:i(955),POINTER_DOWN_OUTSIDE:i(956),POINTER_MOVE:i(957),POINTER_OUT:i(958),POINTER_OVER:i(959),POINTER_UP:i(960),POINTER_UP_OUTSIDE:i(961),POINTER_WHEEL:i(962),POINTERLOCK_CHANGE:i(963),PRE_UPDATE:i(964),SHUTDOWN:i(965),START:i(966),UPDATE:i(967)};},function(t,e){t.exports=function(t,e){return t.y=e+t.height*t.originY,t;};},function(t,e){t.exports=function(t,e){return t.x=e+t.width*t.originX,t;};},function(t,e){t.exports=function(t,e){return t.x=e-t.width+t.width*t.originX,t;};},function(t,e){t.exports=function(t,e){return t.y=e-t.height+t.height*t.originY,t;};},function(t,e){t.exports={CIRCLE:0,ELLIPSE:1,LINE:2,POINT:3,POLYGON:4,RECTANGLE:5,TRIANGLE:6};},function(t,e){t.exports=function(t,e,i){return!(t.width<=0||t.height<=0)&&t.x<=e&&t.x+t.width>=e&&t.y<=i&&t.y+t.height>=i;};},function(t,e,i){var n=i(0),y=i(175),s=i(9),v=i(374),x=i(2),m=i(69),T=i(91),w=i(141),E=i(12),b=i(375),r=new n({Extends:s,initialize:function(t){s.call(this);var e=t.game,i=e.renderer,n=i.gl;this.name=x(t,"name","WebGLPipeline"),this.game=e,this.renderer=i,this.manager,this.gl=n,this.view=e.canvas,this.width=0,this.height=0,this.vertexCount=0,this.vertexCapacity=0,this.vertexData,this.vertexBuffer,this.topology=x(t,"topology",n.TRIANGLES),this.bytes,this.vertexViewF32,this.vertexViewU32,this.active=!0,this.currentUnit=0,this.forceZero=x(t,"forceZero",!1),this.hasBooted=!1,this.isPostFX=!1,this.renderTargets=[],this.currentRenderTarget,this.shaders=[],this.currentShader,this.projectionMatrix,this.projectionWidth=0,this.projectionHeight=0,this.config=t,this.glReset=!1;},boot:function(){var t=this.gl,e=this.config,i=this.renderer;this.isPostFX||(this.projectionMatrix=new m().identity());var n=this.renderTargets,s=x(e,"renderTarget",!1);"boolean"==typeof s&&s&&(s=1);var r=i.width,o=i.height;if("number"==typeof s)for(d=0;d<s;d++)n.push(new w(i,r,o,1,0,!0));else if(Array.isArray(s))for(d=0;d<s.length;d++){var a=x(s[d],"scale",1),h=x(s[d],"minFilter",0),u=x(s[d],"autoClear",1);n.push(new w(i,r,o,a,h,u));}n.length&&(this.currentRenderTarget=n[0]),this.setShadersFromConfig(e);for(var l=this.shaders,c=0,d=0;d<l.length;d++)l[d].vertexSize>c&&(c=l[d].vertexSize);var f=x(e,"batchSize",i.config.batchSize);this.vertexCapacity=6*f;var p=new ArrayBuffer(this.vertexCapacity*c);this.vertexData=p,this.bytes=new Uint8Array(p),this.vertexViewF32=new Float32Array(p),this.vertexViewU32=new Uint32Array(p);var g=x(e,"vertices",null);for(g?(this.vertexViewF32.set(g),this.vertexBuffer=i.createVertexBuffer(p,t.STATIC_DRAW)):this.vertexBuffer=i.createVertexBuffer(p.byteLength,t.DYNAMIC_DRAW),this.setVertexBuffer(),d=l.length-1;0<=d;d--)l[d].rebind();this.hasBooted=!0,i.on(T.RESIZE,this.resize,this),i.on(T.PRE_RENDER,this.onPreRender,this),i.on(T.RENDER,this.onRender,this),i.on(T.POST_RENDER,this.onPostRender,this),this.emit(v.BOOT,this),this.onBoot();},onBoot:function(){},onResize:function(){},setShader:function(t,e){var i=this.renderer;return t===this.currentShader&&i.currentProgram===this.currentShader.program||(this.flush(),i.resetTextures(),this.setVertexBuffer()&&!e&&(e=!0),t.bind(e,!1),this.currentShader=t),this;},getShaderByName:function(t){for(var e=this.shaders,i=0;i<e.length;i++)if(e[i].name===t)return e[i];},setShadersFromConfig:function(t){var e=this.shaders,i=this.renderer;for(d=0;d<e.length;d++)e[d].destroy();var n="vertShader",s="fragShader",r="attributes",o=x(t,n,null),a=E.parseFragmentShaderMaxTextures(x(t,s,null),i.maxTextures),h=x(t,r,null),u=x(t,"shaders",[]),l=u.length;if(0===l)o&&a&&(this.shaders=[new b(this,"default",o,a,y(h))]);else{for(var c=[],d=0;d<l;d++){var f=u[d],p=x(f,"name","default"),g=x(f,n,o),v=E.parseFragmentShaderMaxTextures(x(f,s,a),i.maxTextures),m=x(f,r,h);g&&v&&c.push(new b(this,p,g,v,y(m)));}this.shaders=c;}return 0===this.shaders.length?console.warn("Pipeline: "+this.name+" - Invalid shader config"):this.currentShader=this.shaders[0],this;},setGameObject:function(t,e){return void 0===e&&(e=t.frame),this.currentUnit=this.renderer.setTextureSource(e.source),this.currentUnit;},shouldFlush:function(t){return void 0===t&&(t=0),this.vertexCount+t>this.vertexCapacity;},resize:function(t,e){t===this.width&&e===this.height||this.flush(),this.width=t,this.height=e;for(var i=this.renderTargets,n=0;n<i.length;n++)i[n].resize(t,e);return this.setProjectionMatrix(t,e),this.emit(v.RESIZE,t,e,this),this.onResize(t,e),this;},setProjectionMatrix:function(t,e){var i=this.projectionMatrix;if(!i)return this;this.projectionWidth=t,this.projectionHeight=e,i.ortho(0,t,e,0,-1e3,1e3);for(var n=this.shaders,s="uProjectionMatrix",r=0;r<n.length;r++){var o=n[r];o.hasUniform(s)&&(o.resetUniform(s),o.setMatrix4fv(s,!1,i.val,o));}return this;},updateProjectionMatrix:function(){var t,e;this.projectionMatrix&&(t=this.renderer.projectionWidth,e=this.renderer.projectionHeight,this.projectionWidth===t&&this.projectionHeight===e||this.setProjectionMatrix(t,e));},bind:function(t){if(void 0===t&&(t=this.currentShader),this.glReset)return this.rebind(t);var e=this.setVertexBuffer();return t.bind(e),this.currentShader=t,this.emit(v.BIND,this,t),this.onActive(t),this;},rebind:function(t){this.setVertexBuffer();for(var e=this.shaders,i=e.length-1;0<=i;i--){var n=e[i].rebind();t&&n!==t||(this.currentShader=n);}return this.emit(v.REBIND,this.currentShader),this.onActive(this.currentShader),this.onRebind(),this.glReset=!1,this;},setVertexBuffer:function(){var t=this.gl,e=this.vertexBuffer;return t.getParameter(t.ARRAY_BUFFER_BINDING)!==e&&(t.bindBuffer(t.ARRAY_BUFFER,e),!0);},preBatch:function(t){return this.currentRenderTarget&&this.currentRenderTarget.bind(),this.onPreBatch(t),this;},postBatch:function(t){return this.onDraw(this.currentRenderTarget),this.onPostBatch(t),this;},onDraw:function(){},unbind:function(){this.currentRenderTarget&&this.currentRenderTarget.unbind();},flush:function(t){var e,i,n;return void 0===t&&(t=!1),0<this.vertexCount&&(this.emit(v.BEFORE_FLUSH,this,t),this.onBeforeFlush(t),e=this.gl,i=this.vertexCount,n=this.currentShader.vertexSize,this.active&&(this.setVertexBuffer(),i===this.vertexCapacity?e.bufferData(e.ARRAY_BUFFER,this.vertexData,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.bytes.subarray(0,i*n)),e.drawArrays(this.topology,0,i)),this.vertexCount=0,this.emit(v.AFTER_FLUSH,this,t),this.onAfterFlush(t)),this;},onActive:function(){},onBind:function(){},onRebind:function(){},onBatch:function(){},onPreBatch:function(){},onPostBatch:function(){},onPreRender:function(){},onRender:function(){},onPostRender:function(){},onBeforeFlush:function(){},onAfterFlush:function(){},batchVert:function(t,e,i,n,s,r,o){var a=this.vertexViewF32,h=this.vertexViewU32,u=this.vertexCount*this.currentShader.vertexComponentCount-1;a[++u]=t,a[++u]=e,a[++u]=i,a[++u]=n,a[++u]=s,a[++u]=r,h[++u]=o,this.vertexCount++;},batchQuad:function(t,e,i,n,s,r,o,a,h,u,l,c,d,f,p,g,v,m,y,x){void 0===x&&(x=this.currentUnit);var T=!1;return this.shouldFlush(6)&&(this.flush(),T=!0,x=this.setTexture2D(y)),this.batchVert(e,i,u,l,x,m,f),this.batchVert(n,s,u,d,x,m,g),this.batchVert(r,o,c,d,x,m,v),this.batchVert(e,i,u,l,x,m,f),this.batchVert(r,o,c,d,x,m,v),this.batchVert(a,h,c,l,x,m,p),this.onBatch(t),T;},batchTri:function(t,e,i,n,s,r,o,a,h,u,l,c,d,f,p,g,v){void 0===v&&(v=this.currentUnit);var m=!1;return this.shouldFlush(3)&&(this.flush(),m=!0,v=this.setTexture2D(g)),this.batchVert(e,i,a,h,v,p,c),this.batchVert(n,s,a,l,v,p,d),this.batchVert(r,o,u,l,v,p,f),this.onBatch(t),m;},drawFillRect:function(t,e,i,n,s,r,o,a){void 0===o&&(o=this.renderer.whiteTexture.glTexture),void 0===a&&(a=!0),t=Math.floor(t),e=Math.floor(e);var h=Math.floor(t+i),u=Math.floor(e+n),l=this.setTexture2D(o),c=E.getTintAppendFloatAlphaAndSwap(s,r),d=0,f=1;a&&(d=1,f=0),this.batchQuad(null,t,e,t,u,h,u,h,e,0,d,1,f,c,c,c,c,0,o,l);},setTexture2D:function(t){return void 0===t&&(t=this.renderer.whiteTexture.glTexture),this.currentUnit=this.renderer.setTexture2D(t),this.currentUnit;},bindTexture:function(t,e){void 0===e&&(e=0);var i=this.gl;return i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,t),this;},bindRenderTarget:function(t,e){return this.bindTexture(t.texture,e);},setTime:function(t){return this.set1f(t,this.game.loop.getDuration()),this;},set1f:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1f(t,e),this;},set2f:function(t,e,i,n){return void 0===n&&(n=this.currentShader),n.set2f(t,e,i),this;},set3f:function(t,e,i,n,s){return void 0===s&&(s=this.currentShader),s.set3f(t,e,i,n),this;},set4f:function(t,e,i,n,s,r){return void 0===r&&(r=this.currentShader),r.set4f(t,e,i,n,s),this;},set1fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1fv(t,e),this;},set2fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set2fv(t,e),this;},set3fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set3fv(t,e),this;},set4fv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set4fv(t,e),this;},set1iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1iv(t,e),this;},set2iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set2iv(t,e),this;},set3iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set3iv(t,e),this;},set4iv:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set4iv(t,e),this;},set1i:function(t,e,i){return void 0===i&&(i=this.currentShader),i.set1i(t,e),this;},set2i:function(t,e,i,n){return void 0===n&&(n=this.currentShader),n.set2i(t,e,i),this;},set3i:function(t,e,i,n,s){return void 0===s&&(s=this.currentShader),s.set3i(t,e,i,n),this;},set4i:function(t,e,i,n,s,r){return void 0===r&&(r=this.currentShader),r.set4i(t,e,i,n,s),this;},setMatrix2fv:function(t,e,i,n){return void 0===n&&(n=this.currentShader),n.setMatrix2fv(t,e,i),this;},setMatrix3fv:function(t,e,i,n){return void 0===n&&(n=this.currentShader),n.setMatrix3fv(t,e,i),this;},setMatrix4fv:function(t,e,i,n){return void 0===n&&(n=this.currentShader),n.setMatrix4fv(t,e,i),this;},destroy:function(){this.emit(v.DESTROY,this);for(var t=this.shaders,e=0;e<t.length;e++)t[e].destroy();var i=this.renderTargets;for(e=0;e<i.length;e++)i[e].destroy();this.gl.deleteBuffer(this.vertexBuffer);var n=this.renderer;return n.off(T.RESIZE,this.resize,this),n.off(T.PRE_RENDER,this.onPreRender,this),n.off(T.RENDER,this.onRender,this),n.off(T.POST_RENDER,this.onPostRender,this),this.removeAllListeners(),this.game=null,this.renderer=null,this.manager=null,this.gl=null,this.view=null,this.shaders=null,this.renderTargets=null,this.bytes=null,this.vertexViewF32=null,this.vertexViewU32=null,this.vertexData=null,this.vertexBuffer=null,this.currentShader=null,this.currentRenderTarget=null,this;}});t.exports=r;},function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,s,r,o,a,h,u,l=e&&e.length,c=l?e[0]*i:t.length,d=g(t,0,c,i,!0),f=[];if(!d||d.next===d.prev)return f;if(l&&(d=function(t,e,i,n){var s,r,o,a,h,u=[];for(s=0,r=e.length;s<r;s++)o=e[s]*n,a=s<r-1?e[s+1]*n:t.length,(h=g(t,o,a,n,!1))===h.next&&(h.steiner=!0),u.push(function(t){var e=t,i=t;for(;(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next,e!==t;);return i;}(h));for(u.sort(y),s=0;s<u.length;s++)!function(t,e){{var i;(e=function(t,e){var i,n=e,s=t.x,r=t.y,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){var a=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=s&&o<a){if((o=a)===s){if(r===n.y)return n;if(r===n.next.y)return n.next;}i=n.x<n.next.x?n:n.next;}}n=n.next;}while(n!==e);if(!i)return null;if(s===o)return i;var h,u=i,l=i.x,c=i.y,d=1/0;n=i;for(;s>=n.x&&n.x>=l&&s!==n.x&&T(r<c?s:o,r,l,c,r<c?o:s,r,n.x,n.y)&&(h=Math.abs(r-n.y)/(s-n.x),E(n,t)&&(h<d||h===d&&(n.x>i.x||n.x===i.x&&function(t,e){return w(t.prev,t,e.prev)<0&&w(e.next,t,t.next)<0;}(i,n)))&&(i=n,d=h)),n=n.next,n!==u;);return i;}(t,e))&&(i=b(e,t),v(e,e.next),v(i,i.next));}}(u[s],i),i=v(i,i.next);return i;}(t,e,d,i)),t.length>80*i){n=r=t[0],s=o=t[1];for(var p=i;p<c;p+=i)(a=t[p])<n&&(n=a),(h=t[p+1])<s&&(s=h),r<a&&(r=a),o<h&&(o=h);u=0!==(u=Math.max(r-n,o-s))?1/u:0;}return m(d,f,i,n,s,u),f;}function g(t,e,i,n,s){var r,o;if(s===0<S(t,e,i,n))for(r=e;r<i;r+=n)o=a(r,t[r],t[r+1],o);else for(r=i-n;e<=r;r-=n)o=a(r,t[r],t[r+1],o);return o&&l(o,o.next)&&(d(o),o=o.next),o;}function v(t,e){if(!t)return t;e=e||t;var i,n=t;do{if(i=!1,n.steiner||!l(n,n.next)&&0!==w(n.prev,n,n.next))n=n.next;else{if(d(n),(n=e=n.prev)===n.next)break;i=!0;}}while(i||n!==e);return e;}function m(t,e,i,n,s,r,o){if(t){!o&&r&&function(t,e,i,n){var s=t;for(;null===s.z&&(s.z=x(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next,s!==t;);s.prevZ.nextZ=null,s.prevZ=null,function(t){var e,i,n,s,r,o,a,h,u=1;do{for(i=t,r=t=null,o=0;i;){for(o++,n=i,e=a=0;e<u&&(a++,n=n.nextZ);e++);for(h=u;0<a||0<h&&n;)0!==a&&(0===h||!n||i.z<=n.z)?(i=(s=i).nextZ,a--):(n=(s=n).nextZ,h--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=n;}r.nextZ=null,u*=2;}while(1<o);}(s);}(t,n,s,r);for(var a,h,u=t;t.prev!==t.next;)if(a=t.prev,h=t.next,r?function(t,e,i,n){var s=t.prev,r=t,o=t.next;if(0<=w(s,r,o))return!1;var a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,h=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,u=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,l=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,c=x(a,h,e,i,n),d=x(u,l,e,i,n),f=t.prevZ,p=t.nextZ;for(;f&&f.z>=c&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&T(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&0<=w(f.prev,f,f.next))return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&T(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&0<=w(p.prev,p,p.next))return!1;p=p.nextZ;}for(;f&&f.z>=c;){if(f!==t.prev&&f!==t.next&&T(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&0<=w(f.prev,f,f.next))return!1;f=f.prevZ;}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&T(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&0<=w(p.prev,p,p.next))return!1;p=p.nextZ;}return!0;}(t,n,s,r):function(t){var e=t.prev,i=t,n=t.next;if(0<=w(e,i,n))return!1;var s=t.next.next;for(;s!==t.prev;){if(T(e.x,e.y,i.x,i.y,n.x,n.y,s.x,s.y)&&0<=w(s.prev,s,s.next))return!1;s=s.next;}return!0;}(t))e.push(a.i/i),e.push(t.i/i),e.push(h.i/i),d(t),t=h.next,u=h.next;else if((t=h)===u){o?1===o?m(t=function(t,e,i){var n=t;do{var s=n.prev,r=n.next.next;!l(s,r)&&c(s,n,n.next,r)&&E(s,r)&&E(r,s)&&(e.push(s.i/i),e.push(n.i/i),e.push(r.i/i),d(n),d(n.next),n=t=r),n=n.next;}while(n!==t);return v(n);}(v(t),e,i),e,i,n,s,r,2):2===o&&function(t,e,i,n,s,r){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&c(i,i.next,t,e))return!0;i=i.next;}while(i!==t);return!1;}(t,e)&&(E(t,e)&&E(e,t)&&function(t,e){var i=t,n=!1,s=(t.x+e.x)/2,r=(t.y+e.y)/2;for(;i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next,i!==t;);return n;}(t,e)&&(w(t.prev,t,e.prev)||w(t,e.prev,e))||l(t,e)&&0<w(t.prev,t,t.next)&&0<w(e.prev,e,e.next));}(o,a)){var h=b(o,a);return o=v(o,o.next),h=v(h,h.next),m(o,e,i,n,s,r),m(h,e,i,n,s,r);}a=a.next;}o=o.next;}while(o!==t);}(t,e,i,n,s,r):m(v(t),e,i,n,s,r,1);break;}}}function y(t,e){return t.x-e.x;}function x(t,e,i,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*s)|e<<8))|e<<4))|e<<2))|e<<1))<<1;}function T(t,e,i,n,s,r,o,a){return 0<=(s-o)*(e-a)-(t-o)*(r-a)&&0<=(t-o)*(n-a)-(i-o)*(e-a)&&0<=(i-o)*(r-a)-(s-o)*(n-a);}function w(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y);}function l(t,e){return t.x===e.x&&t.y===e.y;}function c(t,e,i,n){var s=u(w(t,e,i)),r=u(w(t,e,n)),o=u(w(i,n,t)),a=u(w(i,n,e));return s!==r&&o!==a||0===s&&h(t,i,e)||0===r&&h(t,n,e)||0===o&&h(i,t,n)||!(0!==a||!h(i,e,n));}function h(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y);}function u(t){return 0<t?1:t<0?-1:0;}function E(t,e){return w(t.prev,t,t.next)<0?0<=w(t,e,t.next)&&0<=w(t,t.prev,e):w(t,e,t.prev)<0||w(t,t.next,e)<0;}function b(t,e){var i=new o(t.i,t.x,t.y),n=new o(e.i,e.x,e.y),s=t.next,r=e.prev;return(t.next=e).prev=t,(i.next=s).prev=i,(n.next=i).prev=n,(r.next=n).prev=r,n;}function a(t,e,i,n){var s=new o(t,e,i);return n?(s.next=n.next,(s.prev=n).next.prev=s,n.next=s):(s.prev=s).next=s,s;}function d(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function o(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function S(t,e,i,n){for(var s=0,r=e,o=i-n;r<i;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s;}n.deviation=function(t,e,i,n){var s=e&&e.length,r=s?e[0]*i:t.length,o=Math.abs(S(t,0,r,i));if(s)for(var a=0,h=e.length;a<h;a++){var u=e[a]*i,l=a<h-1?e[a+1]*i:t.length;o-=Math.abs(S(t,u,l,i));}for(var c=0,a=0;a<n.length;a+=3){var d=n[a]*i,f=n[a+1]*i,p=n[a+2]*i;c+=Math.abs((t[d]-t[p])*(t[1+f]-t[1+d])-(t[d]-t[f])*(t[1+p]-t[1+d]));}return 0===o&&0===c?0:Math.abs((c-o)/o);},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,s=0;s<t.length;s++){for(var r=0;r<t[s].length;r++)for(var o=0;o<e;o++)i.vertices.push(t[s][r][o]);0<s&&(n+=t[s-1].length,i.holes.push(n));}return i;},t.exports=n;},function(t,e){t.exports=function(t,e,i,n){var s=i||e.strokeColor,r=n||e.strokeAlpha,o=(16711680&s)>>>16,a=(65280&s)>>>8,h=255&s;t.strokeStyle="rgba("+o+","+a+","+h+","+r+")",t.lineWidth=e.lineWidth;};},function(t,e,i){var n=i(0),h=i(21),u=i(23),s=i(8),l=i(2),c=i(6),d=i(7),r=new n({Extends:u,initialize:function(t,e,i,n,s){var r,o="json";d(e)&&(e=l(r=e,"key"),i=l(r,"url"),n=l(r,"xhrSettings"),o=l(r,"extension",o),s=l(r,"dataKey",s));var a={type:"json",cache:t.cacheManager.json,extension:o,responseType:"text",key:e,url:i,xhrSettings:n,config:s};u.call(this,t,a),d(i)&&(this.data=s?c(i,s):i,this.state=h.FILE_POPULATED);},onProcess:function(){if(this.state!==h.FILE_POPULATED){this.state=h.FILE_PROCESSING;try{var t=JSON.parse(this.xhrLoader.responseText);}catch(t){throw console.warn("Invalid JSON: "+this.key),this.onProcessError(),t;}var e=this.config;this.data="string"==typeof e?c(t,e,t):t;}this.onProcessComplete();}});s.register("json",function(t,e,i,n){if(Array.isArray(t))for(var s=0;s<t.length;s++)this.addFile(new r(this,t[s]));else this.addFile(new r(this,t,e,n,i));return this;}),t.exports=r;},function(t,e){t.exports={DYNAMIC_BODY:0,STATIC_BODY:1,GROUP:2,TILEMAPLAYER:3,FACING_NONE:10,FACING_UP:11,FACING_DOWN:12,FACING_LEFT:13,FACING_RIGHT:14};},function(t,e,i){var d=i(158),f=i(26);t.exports=function(t,e,i,n,s){for(var r,o,a,h,u=f(t,e,i,n,null,s),l=0;l<u.length;l++){var c=u[l];c&&(c.collides?(r=d(c.x,c.y-1,!0,s),o=d(c.x,c.y+1,!0,s),a=d(c.x-1,c.y,!0,s),h=d(c.x+1,c.y,!0,s),c.faceTop=!r||!r.collides,c.faceBottom=!o||!o.collides,c.faceLeft=!a||!a.collides,c.faceRight=!h||!h.collides):c.resetFaces());}};},,function(t,e,i){var n=i(0),s=i(66),r=i(300),o=i(301),a=i(56),h=i(170),u=new n({initialize:function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.type=a.CIRCLE,this.x=t,this.y=e,this._radius=i,this._diameter=2*i;},contains:function(t,e){return s(this,t,e);},getPoint:function(t,e){return r(this,t,e);},getPoints:function(t,e,i){return o(this,t,e,i);},getRandomPoint:function(t){return h(this,t);},setTo:function(t,e,i){return this.x=t,this.y=e,this._radius=i,this._diameter=2*i,this;},setEmpty:function(){return this._radius=0,this._diameter=0,this;},setPosition:function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this;},isEmpty:function(){return this._radius<=0;},radius:{get:function(){return this._radius;},set:function(t){this._radius=t,this._diameter=2*t;}},diameter:{get:function(){return this._diameter;},set:function(t){this._diameter=t,this._radius=.5*t;}},left:{get:function(){return this.x-this._radius;},set:function(t){this.x=t+this._radius;}},right:{get:function(){return this.x+this._radius;},set:function(t){this.x=t-this._radius;}},top:{get:function(){return this.y-this._radius;},set:function(t){this.y=t+this._radius;}},bottom:{get:function(){return this.y+this._radius;},set:function(t){this.y=t-this._radius;}}});t.exports=u;},function(t,e){t.exports=function(t,e,i){return 0<t.radius&&e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom&&(t.x-e)*(t.x-e)+(t.y-i)*(t.y-i)<=t.radius*t.radius;};},function(t,e){t.exports=function(t){return Math.sqrt((t.x2-t.x1)*(t.x2-t.x1)+(t.y2-t.y1)*(t.y2-t.y1));};},function(t,e){t.exports=function(t,e,i){var n=i-e;return e+((t-e)%n+n)%n;};},function(t,e,i){var n=i(0),s=i(39),r=new n({initialize:function(t){this.val=new Float32Array(16),t?this.copy(t):this.identity();},clone:function(){return new r(this);},set:function(t){return this.copy(t);},setValues:function(t,e,i,n,s,r,o,a,h,u,l,c,d,f,p,g){var v=this.val;return v[0]=t,v[1]=e,v[2]=i,v[3]=n,v[4]=s,v[5]=r,v[6]=o,v[7]=a,v[8]=h,v[9]=u,v[10]=l,v[11]=c,v[12]=d,v[13]=f,v[14]=p,v[15]=g,this;},copy:function(t){var e=t.val;return this.setValues(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]);},fromArray:function(t){return this.setValues(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]);},zero:function(){return this.setValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);},transform:function(t,e,i){var n=h.fromQuat(i).val,s=e.x,r=e.y,o=e.z;return this.setValues(n[0]*s,n[1]*s,n[2]*s,0,n[4]*r,n[5]*r,n[6]*r,0,n[8]*o,n[9]*o,n[10]*o,0,t.x,t.y,t.z,1);},xyz:function(t,e,i){this.identity();var n=this.val;return n[12]=t,n[13]=e,n[14]=i,this;},scaling:function(t,e,i){this.zero();var n=this.val;return n[0]=t,n[5]=e,n[10]=i,n[15]=1,this;},identity:function(){return this.setValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);},transpose:function(){var t=this.val,e=t[1],i=t[2],n=t[3],s=t[6],r=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=s,t[11]=t[14],t[12]=n,t[13]=r,t[14]=o,this;},getInverse:function(t){return this.copy(t),this.invert();},invert:function(){var t=this.val,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],f=t[12],p=t[13],g=t[14],v=t[15],m=e*o-i*r,y=e*a-n*r,x=e*h-s*r,T=i*a-n*o,w=i*h-s*o,E=n*h-s*a,b=u*p-l*f,S=u*g-c*f,A=u*v-d*f,_=l*g-c*p,C=l*v-d*p,R=c*v-d*g,M=m*R-y*C+x*_+T*A-w*S+E*b;return M?(M=1/M,this.setValues((o*R-a*C+h*_)*M,(n*C-i*R-s*_)*M,(p*E-g*w+v*T)*M,(c*w-l*E-d*T)*M,(a*A-r*R-h*S)*M,(e*R-n*A+s*S)*M,(g*x-f*E-v*y)*M,(u*E-c*x+d*y)*M,(r*C-o*A+h*b)*M,(i*A-e*C-s*b)*M,(f*w-p*x+v*m)*M,(l*x-u*w-d*m)*M,(o*S-r*_-a*b)*M,(e*_-i*S+n*b)*M,(p*y-f*T-g*m)*M,(u*T-l*y+c*m)*M)):this;},adjoint:function(){var t=this.val,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],f=t[12],p=t[13],g=t[14],v=t[15];return this.setValues(o*(c*v-d*g)-l*(a*v-h*g)+p*(a*d-h*c),-(i*(c*v-d*g)-l*(n*v-s*g)+p*(n*d-s*c)),i*(a*v-h*g)-o*(n*v-s*g)+p*(n*h-s*a),-(i*(a*d-h*c)-o*(n*d-s*c)+l*(n*h-s*a)),-(r*(c*v-d*g)-u*(a*v-h*g)+f*(a*d-h*c)),e*(c*v-d*g)-u*(n*v-s*g)+f*(n*d-s*c),-(e*(a*v-h*g)-r*(n*v-s*g)+f*(n*h-s*a)),e*(a*d-h*c)-r*(n*d-s*c)+u*(n*h-s*a),r*(l*v-d*p)-u*(o*v-h*p)+f*(o*d-h*l),-(e*(l*v-d*p)-u*(i*v-s*p)+f*(i*d-s*l)),e*(o*v-h*p)-r*(i*v-s*p)+f*(i*h-s*o),-(e*(o*d-h*l)-r*(i*d-s*l)+u*(i*h-s*o)),-(r*(l*g-c*p)-u*(o*g-a*p)+f*(o*c-a*l)),e*(l*g-c*p)-u*(i*g-n*p)+f*(i*c-n*l),-(e*(o*g-a*p)-r*(i*g-n*p)+f*(i*a-n*o)),e*(o*c-a*l)-r*(i*c-n*l)+u*(i*a-n*o));},determinant:function(){var t=this.val,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=t[9],c=t[10],d=t[11],f=t[12],p=t[13],g=t[14],v=t[15];return(e*o-i*r)*(c*v-d*g)-(e*a-n*r)*(l*v-d*p)+(e*h-s*r)*(l*g-c*p)+(i*a-n*o)*(u*v-d*f)-(i*h-s*o)*(u*g-c*f)+(n*h-s*a)*(u*p-l*f);},multiply:function(t){var e=this.val,i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=e[9],d=e[10],f=e[11],p=e[12],g=e[13],v=e[14],m=e[15],y=t.val,x=y[0],T=y[1],w=y[2],E=y[3];return e[0]=x*i+T*o+w*l+E*p,e[1]=x*n+T*a+w*c+E*g,e[2]=x*s+T*h+w*d+E*v,e[3]=x*r+T*u+w*f+E*m,x=y[4],T=y[5],w=y[6],E=y[7],e[4]=x*i+T*o+w*l+E*p,e[5]=x*n+T*a+w*c+E*g,e[6]=x*s+T*h+w*d+E*v,e[7]=x*r+T*u+w*f+E*m,x=y[8],T=y[9],w=y[10],E=y[11],e[8]=x*i+T*o+w*l+E*p,e[9]=x*n+T*a+w*c+E*g,e[10]=x*s+T*h+w*d+E*v,e[11]=x*r+T*u+w*f+E*m,x=y[12],T=y[13],w=y[14],E=y[15],e[12]=x*i+T*o+w*l+E*p,e[13]=x*n+T*a+w*c+E*g,e[14]=x*s+T*h+w*d+E*v,e[15]=x*r+T*u+w*f+E*m,this;},multiplyLocal:function(t){var e=this.val,i=t.val;return this.setValues(e[0]*i[0]+e[1]*i[4]+e[2]*i[8]+e[3]*i[12],e[0]*i[1]+e[1]*i[5]+e[2]*i[9]+e[3]*i[13],e[0]*i[2]+e[1]*i[6]+e[2]*i[10]+e[3]*i[14],e[0]*i[3]+e[1]*i[7]+e[2]*i[11]+e[3]*i[15],e[4]*i[0]+e[5]*i[4]+e[6]*i[8]+e[7]*i[12],e[4]*i[1]+e[5]*i[5]+e[6]*i[9]+e[7]*i[13],e[4]*i[2]+e[5]*i[6]+e[6]*i[10]+e[7]*i[14],e[4]*i[3]+e[5]*i[7]+e[6]*i[11]+e[7]*i[15],e[8]*i[0]+e[9]*i[4]+e[10]*i[8]+e[11]*i[12],e[8]*i[1]+e[9]*i[5]+e[10]*i[9]+e[11]*i[13],e[8]*i[2]+e[9]*i[6]+e[10]*i[10]+e[11]*i[14],e[8]*i[3]+e[9]*i[7]+e[10]*i[11]+e[11]*i[15],e[12]*i[0]+e[13]*i[4]+e[14]*i[8]+e[15]*i[12],e[12]*i[1]+e[13]*i[5]+e[14]*i[9]+e[15]*i[13],e[12]*i[2]+e[13]*i[6]+e[14]*i[10]+e[15]*i[14],e[12]*i[3]+e[13]*i[7]+e[14]*i[11]+e[15]*i[15]);},premultiply:function(t){return this.multiplyMatrices(t,this);},multiplyMatrices:function(t,e){var i=t.val,n=e.val,s=i[0],r=i[4],o=i[8],a=i[12],h=i[1],u=i[5],l=i[9],c=i[13],d=i[2],f=i[6],p=i[10],g=i[14],v=i[3],m=i[7],y=i[11],x=i[15],T=n[0],w=n[4],E=n[8],b=n[12],S=n[1],A=n[5],_=n[9],C=n[13],R=n[2],M=n[6],P=n[10],O=n[14],L=n[3],D=n[7],F=n[11],k=n[15];return this.setValues(s*T+r*S+o*R+a*L,h*T+u*S+l*R+c*L,d*T+f*S+p*R+g*L,v*T+m*S+y*R+x*L,s*w+r*A+o*M+a*D,h*w+u*A+l*M+c*D,d*w+f*A+p*M+g*D,v*w+m*A+y*M+x*D,s*E+r*_+o*P+a*F,h*E+u*_+l*P+c*F,d*E+f*_+p*P+g*F,v*E+m*_+y*P+x*F,s*b+r*C+o*O+a*k,h*b+u*C+l*O+c*k,d*b+f*C+p*O+g*k,v*b+m*C+y*O+x*k);},translate:function(t){return this.translateXYZ(t.x,t.y,t.z);},translateXYZ:function(t,e,i){var n=this.val;return n[12]=n[0]*t+n[4]*e+n[8]*i+n[12],n[13]=n[1]*t+n[5]*e+n[9]*i+n[13],n[14]=n[2]*t+n[6]*e+n[10]*i+n[14],n[15]=n[3]*t+n[7]*e+n[11]*i+n[15],this;},scale:function(t){return this.scaleXYZ(t.x,t.y,t.z);},scaleXYZ:function(t,e,i){var n=this.val;return n[0]=n[0]*t,n[1]=n[1]*t,n[2]=n[2]*t,n[3]=n[3]*t,n[4]=n[4]*e,n[5]=n[5]*e,n[6]=n[6]*e,n[7]=n[7]*e,n[8]=n[8]*i,n[9]=n[9]*i,n[10]=n[10]*i,n[11]=n[11]*i,this;},makeRotationAxis:function(t,e){var i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,o=t.y,a=t.z,h=s*r,u=s*o;return this.setValues(h*r+i,h*o-n*a,h*a+n*o,0,h*o+n*a,u*o+i,u*a-n*r,0,h*a-n*o,u*a+n*r,s*a*a+i,0,0,0,0,1);},rotate:function(t,e){var i=this.val,n=e.x,s=e.y,r=e.z,o=Math.sqrt(n*n+s*s+r*r);if(Math.abs(o)<1e-6)return this;n*=o=1/o,s*=o,r*=o;var a=Math.sin(t),h=Math.cos(t),u=1-h,l=i[0],c=i[1],d=i[2],f=i[3],p=i[4],g=i[5],v=i[6],m=i[7],y=i[8],x=i[9],T=i[10],w=i[11],E=i[12],b=i[13],S=i[14],A=i[15],_=n*n*u+h,C=s*n*u+r*a,R=r*n*u-s*a,M=n*s*u-r*a,P=s*s*u+h,O=r*s*u+n*a,L=n*r*u+s*a,D=s*r*u-n*a,F=r*r*u+h;return this.setValues(l*_+p*C+y*R,c*_+g*C+x*R,d*_+v*C+T*R,f*_+m*C+w*R,l*M+p*P+y*O,c*M+g*P+x*O,d*M+v*P+T*O,f*M+m*P+w*O,l*L+p*D+y*F,c*L+g*D+x*F,d*L+v*D+T*F,f*L+m*D+w*F,E,b,S,A);},rotateX:function(t){var e=this.val,i=Math.sin(t),n=Math.cos(t),s=e[4],r=e[5],o=e[6],a=e[7],h=e[8],u=e[9],l=e[10],c=e[11];return e[4]=s*n+h*i,e[5]=r*n+u*i,e[6]=o*n+l*i,e[7]=a*n+c*i,e[8]=h*n-s*i,e[9]=u*n-r*i,e[10]=l*n-o*i,e[11]=c*n-a*i,this;},rotateY:function(t){var e=this.val,i=Math.sin(t),n=Math.cos(t),s=e[0],r=e[1],o=e[2],a=e[3],h=e[8],u=e[9],l=e[10],c=e[11];return e[0]=s*n-h*i,e[1]=r*n-u*i,e[2]=o*n-l*i,e[3]=a*n-c*i,e[8]=s*i+h*n,e[9]=r*i+u*n,e[10]=o*i+l*n,e[11]=a*i+c*n,this;},rotateZ:function(t){var e=this.val,i=Math.sin(t),n=Math.cos(t),s=e[0],r=e[1],o=e[2],a=e[3],h=e[4],u=e[5],l=e[6],c=e[7];return e[0]=s*n+h*i,e[1]=r*n+u*i,e[2]=o*n+l*i,e[3]=a*n+c*i,e[4]=h*n-s*i,e[5]=u*n-r*i,e[6]=l*n-o*i,e[7]=c*n-a*i,this;},fromRotationTranslation:function(t,e){var i=t.x,n=t.y,s=t.z,r=t.w,o=i+i,a=n+n,h=s+s,u=i*o,l=i*a,c=i*h,d=n*a,f=n*h,p=s*h,g=r*o,v=r*a,m=r*h;return this.setValues(1-(d+p),l+m,c-v,0,l-m,1-(u+p),f+g,0,c+v,f-g,1-(u+d),0,e.x,e.y,e.z,1);},fromQuat:function(t){var e=t.x,i=t.y,n=t.z,s=t.w,r=e+e,o=i+i,a=n+n,h=e*r,u=e*o,l=e*a,c=i*o,d=i*a,f=n*a,p=s*r,g=s*o,v=s*a;return this.setValues(1-(c+f),u+v,l-g,0,u-v,1-(h+f),d+p,0,l+g,d-p,1-(h+c),0,0,0,0,1);},frustum:function(t,e,i,n,s,r){var o=1/(e-t),a=1/(n-i),h=1/(s-r);return this.setValues(2*s*o,0,0,0,0,2*s*a,0,0,(e+t)*o,(n+i)*a,(r+s)*h,-1,0,0,r*s*2*h,0);},perspective:function(t,e,i,n){var s=1/Math.tan(t/2),r=1/(i-n);return this.setValues(s/e,0,0,0,0,s,0,0,0,0,(n+i)*r,-1,0,0,2*n*i*r,0);},perspectiveLH:function(t,e,i,n){return this.setValues(2*i/t,0,0,0,0,2*i/e,0,0,0,0,-n/(i-n),1,0,0,i*n/(i-n),0);},ortho:function(t,e,i,n,s,r){var o=0===(o=t-e)?o:1/o,a=0===(a=i-n)?a:1/a,h=0===(h=s-r)?h:1/h;return this.setValues(-2*o,0,0,0,0,-2*a,0,0,0,0,2*h,0,(t+e)*o,(n+i)*a,(r+s)*h,1);},lookAtRH:function(t,e,i){var n=this.val;return l.subVectors(t,e),0===l.getLengthSquared()&&(l.z=1),l.normalize(),o.crossVectors(i,l),0===o.getLengthSquared()&&(1===Math.abs(i.z)?l.x+=1e-4:l.z+=1e-4,l.normalize(),o.crossVectors(i,l)),o.normalize(),a.crossVectors(l,o),n[0]=o.x,n[1]=o.y,n[2]=o.z,n[4]=a.x,n[5]=a.y,n[6]=a.z,n[8]=l.x,n[9]=l.y,n[10]=l.z,this;},lookAt:function(t,e,i){var n=t.x,s=t.y,r=t.z,o=i.x,a=i.y,h=i.z,u=e.x,l=e.y,c=e.z;if(Math.abs(n-u)<1e-6&&Math.abs(s-l)<1e-6&&Math.abs(r-c)<1e-6)return this.identity();var d=n-u,f=s-l,p=r-c,g=1/Math.sqrt(d*d+f*f+p*p),v=a*(p*=g)-h*(f*=g),m=h*(d*=g)-o*p,y=o*f-a*d;(g=Math.sqrt(v*v+m*m+y*y))?(v*=g=1/g,m*=g,y*=g):y=m=v=0;var x=f*y-p*m,T=p*v-d*y,w=d*m-f*v;return(g=Math.sqrt(x*x+T*T+w*w))?(x*=g=1/g,T*=g,w*=g):w=T=x=0,this.setValues(v,x,d,0,m,T,f,0,y,w,p,0,-(v*n+m*s+y*r),-(x*n+T*s+w*r),-(d*n+f*s+p*r),1);},yawPitchRoll:function(t,e,i){this.zero(),h.zero(),u.zero();var n=this.val,s=h.val,r=u.val,o=Math.sin(i),a=Math.cos(i);return n[10]=1,n[15]=1,n[0]=a,n[1]=o,n[4]=-o,n[5]=a,o=Math.sin(e),a=Math.cos(e),s[0]=1,s[15]=1,s[5]=a,s[10]=a,s[9]=-o,s[6]=o,o=Math.sin(t),a=Math.cos(t),r[5]=1,r[15]=1,r[0]=a,r[2]=-o,r[8]=o,r[10]=a,this.multiplyLocal(h),this.multiplyLocal(u),this;},setWorldMatrix:function(t,e,i,n,s){return this.yawPitchRoll(t.y,t.x,t.z),h.scaling(i.x,i.y,i.z),u.xyz(e.x,e.y,e.z),this.multiplyLocal(h),this.multiplyLocal(u),n&&this.multiplyLocal(n),s&&this.multiplyLocal(s),this;},multiplyToMat4:function(t,e){var i=this.val,n=t.val,s=i[0],r=i[1],o=i[2],a=i[3],h=i[4],u=i[5],l=i[6],c=i[7],d=i[8],f=i[9],p=i[10],g=i[11],v=i[12],m=i[13],y=i[14],x=i[15],T=n[0],w=n[1],E=n[2],b=n[3],S=n[4],A=n[5],_=n[6],C=n[7],R=n[8],M=n[9],P=n[10],O=n[11],L=n[12],D=n[13],F=n[14],k=n[15];return e.setValues(T*s+w*h+E*d+b*v,w*r+w*u+E*f+b*m,E*o+w*l+E*p+b*y,b*a+w*c+E*g+b*x,S*s+A*h+_*d+C*v,S*r+A*u+_*f+C*m,S*o+A*l+_*p+C*y,S*a+A*c+_*g+C*x,R*s+M*h+P*d+O*v,R*r+M*u+P*f+O*m,R*o+M*l+P*p+O*y,R*a+M*c+P*g+O*x,L*s+D*h+F*d+k*v,L*r+D*u+F*f+k*m,L*o+D*l+F*p+k*y,L*a+D*c+F*g+k*x);},fromRotationXYTranslation:function(t,e,i){var n=e.x,s=e.y,r=e.z,o=Math.sin(t.x),a=Math.cos(t.x),h=Math.sin(t.y),u=Math.cos(t.y),l=n,c=s,d=r,f=-o,p=0-f*h,g=0-a*h,v=f*u,m=a*u;return i||(l=u*n+h*r,c=p*n+a*s+v*r,d=g*n+o*s+m*r),this.setValues(u,p,g,0,0,a,o,0,h,v,m,0,l,c,d,1);},getMaxScaleOnAxis:function(){var t=this.val,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n));}}),h=new r(),u=new r(),o=new s(),a=new s(),l=new s();t.exports=r;},function(t,e,i){t.exports={COMPLETE:i(987),DECODED:i(988),DECODED_ALL:i(989),DESTROY:i(990),DETUNE:i(991),GLOBAL_DETUNE:i(992),GLOBAL_MUTE:i(993),GLOBAL_RATE:i(994),GLOBAL_VOLUME:i(995),LOOP:i(996),LOOPED:i(997),MUTE:i(998),PAN:i(999),PAUSE_ALL:i(1e3),PAUSE:i(1001),PLAY:i(1002),RATE:i(1003),RESUME_ALL:i(1004),RESUME:i(1005),SEEK:i(1006),STOP_ALL:i(1007),STOP:i(1008),UNLOCKED:i(1009),VOLUME:i(1010)};},function(t,e,i){var n=i(0),s=i(21),c=i(23),r=i(8),d=i(2),f=i(7),o=new n({Extends:c,initialize:function t(e,i,n,s,r){var o,a,h="png";f(i)&&(i=d(a=i,"key"),n=d(a,"url"),o=d(a,"normalMap"),s=d(a,"xhrSettings"),h=d(a,"extension",h),r=d(a,"frameConfig")),Array.isArray(n)&&(o=n[1],n=n[0]);var u,l={type:"image",cache:e.textureManager,extension:h,responseType:"blob",key:i,url:n,xhrSettings:s,config:r};c.call(this,e,l),o&&((u=new t(e,this.key,o,s,r)).type="normalMap",this.setLink(u),e.addFile(u));},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=new Image(),this.data.crossOrigin=this.crossOrigin;var t=this;this.data.onload=function(){c.revokeObjectURL(t.data),t.onProcessComplete();},this.data.onerror=function(){c.revokeObjectURL(t.data),t.onProcessError();},c.createObjectURL(this.data,this.xhrLoader.response,"image/png");},addToCache:function(){var t,e=this.linkFile;e&&e.state===s.FILE_COMPLETE?(t="image"===this.type?this.cache.addImage(this.key,this.data,e.data):this.cache.addImage(e.key,e.data,this.data),this.pendingDestroy(t),e.pendingDestroy(t)):e||(t=this.cache.addImage(this.key,this.data),this.pendingDestroy(t));}});r.register("image",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new o(this,t[n]));else this.addFile(new o(this,t,e,i));return this;}),t.exports=o;},function(t,e){t.exports=function(t,e){e?t.setCollision(!0,!0,!0,!0,!1):t.resetCollision(!1);};},function(t,e,i){var r=i(164),n=i(0),s=i(11),o=i(15),a=i(1065),h=new n({Extends:o,Mixins:[s.Alpha,s.BlendMode,s.Depth,s.Flip,s.GetBounds,s.Mask,s.Origin,s.Pipeline,s.ScrollFactor,s.Size,s.TextureCrop,s.Tint,s.Transform,s.Visible,a],initialize:function(t,e,i,n,s){o.call(this,t,"Sprite"),this._crop=this.resetCropObject(),this.anims=new r(this),this.setTexture(n,s),this.setPosition(e,i),this.setSizeToFrame(),this.setOriginFromFrame(),this.initPipeline();},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},preUpdate:function(t,e){this.anims.update(t,e);},play:function(t,e){return this.anims.play(t,e);},playReverse:function(t,e){return this.anims.playReverse(t,e);},playAfterDelay:function(t,e){return this.anims.playAfterDelay(t,e);},playAfterRepeat:function(t,e){return this.anims.playAfterRepeat(t,e);},chain:function(t){return this.anims.chain(t);},stop:function(){return this.anims.stop();},stopAfterDelay:function(t){return this.anims.stopAfterDelay(t);},stopAfterRepeat:function(t){return this.anims.stopAfterRepeat(t);},stopOnFrame:function(t){return this.anims.stopOnFrame(t);},toJSON:function(){return s.ToJSON(this);},preDestroy:function(){this.anims.destroy(),this.anims=void 0;}});t.exports=h;},function(t,e){t.exports=function(t,e){if(!(e>=t.length)){for(var i=t.length-1,n=t[e],s=e;s<i;s++)t[s]=t[s+1];return t.length=i,n;}};},function(t,e,i){t.exports={ADDED_TO_SCENE:i(643),DESTROY:i(644),REMOVED_FROM_SCENE:i(645),VIDEO_COMPLETE:i(646),VIDEO_CREATED:i(647),VIDEO_ERROR:i(648),VIDEO_LOOP:i(649),VIDEO_PLAY:i(650),VIDEO_SEEKED:i(651),VIDEO_SEEKING:i(652),VIDEO_STOP:i(653),VIDEO_TIMEOUT:i(654),VIDEO_UNLOCKED:i(655)};},function(t,e){t.exports=function(t,e,i,n){return void 0===i&&(i=0),0===e?t:(t-=i,t=e*Math.floor(t/e),n?(i+t)/e:i+t);};},function(t,e){t.exports=function(t){var e={};for(var i in t)Array.isArray(t[i])?e[i]=t[i].slice(0):e[i]=t[i];return e;};},function(t,e){t.exports=function(t,e,i,n){var s=t.length;if(e<0||s<e||i<=e||s<i||s<e+i){if(n)throw new Error("Range Error: Values outside acceptable range");return!1;}return!0;};},function(t,e){function n(t,e){return String(t).localeCompare(e);}function o(t,e,i,n){for(var s,r,o,a,h=t.length,u=0,l=2*i,c=0;c<h;c+=l)for(r=(s=c+i)+i,h<s&&(s=h),h<r&&(r=h),o=c,a=s;;)if(o<s&&a<r)e(t[o],t[a])<=0?n[u++]=t[o++]:n[u++]=t[a++];else if(o<s)n[u++]=t[o++];else{if(!(a<r))break;n[u++]=t[a++];}}t.exports=function(t,e){void 0===e&&(e=n);var i=function(t,e){var i=t.length;if(i<=1)return t;for(var n=new Array(i),s=1;s<i;s*=2){o(t,e,s,n);var r=t;t=n,n=r;}return t;}(t,e);return i!==t&&o(i,null,t.length,t),t;};},function(t,e,i){var r=i(134),o=i(205);t.exports=function(t,e){var i,n=r.Power0;if("string"==typeof t?r.hasOwnProperty(t)?n=r[t]:(i="",t.indexOf(".")&&("in"===(i=t.substr(t.indexOf(".")+1)).toLowerCase()?i="easeIn":"out"===i.toLowerCase()?i="easeOut":"inout"===i.toLowerCase()&&(i="easeInOut")),t=o(t.substr(0,t.indexOf(".")+1)+i),r.hasOwnProperty(t)&&(n=r[t])):"function"==typeof t?n=t:Array.isArray(t)&&t.length,!e)return n;var s=e.slice(0);return s.unshift(0),function(t){return s[0]=t,n.apply(this,s);};};},function(t,e,i){var v=i(12);t.exports=function(t,e,i,n,s){var r=t.strokeTint,o=v.getTintAppendFloatAlpha(e.strokeColor,e.strokeAlpha*i);r.TL=o,r.TR=o,r.BL=o,r.BR=o;var a=e.pathData,h=a.length-1,u=e.lineWidth,l=u/2,c=a[0]-n,d=a[1]-s;e.closePath||(h-=2);for(var f=2;f<h;f+=2){var p=a[f]-n,g=a[f+1]-s;t.batchLine(c,d,p,g,l,l,u,f-2,!!e.closePath&&f===h-1),c=p,d=g;}};},function(t,e,i){var n=i(0),s=i(115),r=i(476),o=i(477),a=i(56),h=i(47),u=i(181),l=new n({initialize:function(t,e,i,n,s,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),this.type=a.TRIANGLE,this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.x3=s,this.y3=r;},contains:function(t,e){return s(this,t,e);},getPoint:function(t,e){return r(this,t,e);},getPoints:function(t,e,i){return o(this,t,e,i);},getRandomPoint:function(t){return u(this,t);},setTo:function(t,e,i,n,s,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),this.x1=t,this.y1=e,this.x2=i,this.y2=n,this.x3=s,this.y3=r,this;},getLineA:function(t){return void 0===t&&(t=new h()),t.setTo(this.x1,this.y1,this.x2,this.y2),t;},getLineB:function(t){return void 0===t&&(t=new h()),t.setTo(this.x2,this.y2,this.x3,this.y3),t;},getLineC:function(t){return void 0===t&&(t=new h()),t.setTo(this.x3,this.y3,this.x1,this.y1),t;},left:{get:function(){return Math.min(this.x1,this.x2,this.x3);},set:function(t){var e=0,e=this.x1<=this.x2&&this.x1<=this.x3?this.x1-t:this.x2<=this.x1&&this.x2<=this.x3?this.x2-t:this.x3-t;this.x1-=e,this.x2-=e,this.x3-=e;}},right:{get:function(){return Math.max(this.x1,this.x2,this.x3);},set:function(t){var e=0,e=this.x1>=this.x2&&this.x1>=this.x3?this.x1-t:this.x2>=this.x1&&this.x2>=this.x3?this.x2-t:this.x3-t;this.x1-=e,this.x2-=e,this.x3-=e;}},top:{get:function(){return Math.min(this.y1,this.y2,this.y3);},set:function(t){var e=0,e=this.y1<=this.y2&&this.y1<=this.y3?this.y1-t:this.y2<=this.y1&&this.y2<=this.y3?this.y2-t:this.y3-t;this.y1-=e,this.y2-=e,this.y3-=e;}},bottom:{get:function(){return Math.max(this.y1,this.y2,this.y3);},set:function(t){var e=0,e=this.y1>=this.y2&&this.y1>=this.y3?this.y1-t:this.y2>=this.y1&&this.y2>=this.y3?this.y2-t:this.y3-t;this.y1-=e,this.y2-=e,this.y3-=e;}}});t.exports=l;},,,function(t,e,i){var n=i(29),s=i(0),r=i(11),o=i(502),a=new s({Mixins:[r.Alpha,r.Flip,r.Visible],initialize:function(t,e,i,n,s,r,o,a){this.layer=t,this.index=e,this.x=i,this.y=n,this.width=s,this.height=r,this.right,this.bottom,this.baseWidth=void 0!==o?o:s,this.baseHeight=void 0!==a?a:r,this.pixelX=0,this.pixelY=0,this.updatePixelXY(),this.properties={},this.rotation=0,this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceLeft=!1,this.faceRight=!1,this.faceTop=!1,this.faceBottom=!1,this.collisionCallback=void 0,(this.collisionCallbackContext=this).tint=16777215,this.physics={};},containsPoint:function(t,e){return!(t<this.pixelX||e<this.pixelY||t>this.right||e>this.bottom);},copy:function(t){return this.index=t.index,this.alpha=t.alpha,this.properties=t.properties,this.visible=t.visible,this.setFlip(t.flipX,t.flipY),this.tint=t.tint,this.rotation=t.rotation,this.collideUp=t.collideUp,this.collideDown=t.collideDown,this.collideLeft=t.collideLeft,this.collideRight=t.collideRight,this.collisionCallback=t.collisionCallback,this.collisionCallbackContext=t.collisionCallbackContext,this;},getCollisionGroup:function(){return this.tileset?this.tileset.getTileCollisionGroup(this.index):null;},getTileData:function(){return this.tileset?this.tileset.getTileData(this.index):null;},getLeft:function(t){var e=this.tilemapLayer;return e?e.tileToWorldX(this.x,t):this.x*this.baseWidth;},getRight:function(t){var e=this.tilemapLayer;return e?this.getLeft(t)+this.width*e.scaleX:this.getLeft(t)+this.width;},getTop:function(t){var e=this.tilemapLayer;return e?e.tileToWorldY(this.y,t)-(this.height-this.baseHeight)*e.scaleY:this.y*this.baseHeight-(this.height-this.baseHeight);},getBottom:function(t){var e=this.tilemapLayer;return e?this.getTop(t)+this.height*e.scaleY:this.getTop(t)+this.height;},getBounds:function(t,e){return void 0===e&&(e=new o()),e.x=this.getLeft(),e.y=this.getTop(),e.width=this.getRight()-e.x,e.height=this.getBottom()-e.y,e;},getCenterX:function(t){return(this.getLeft(t)+this.getRight(t))/2;},getCenterY:function(t){return(this.getTop(t)+this.getBottom(t))/2;},intersects:function(t,e,i,n){return!(i<=this.pixelX||n<=this.pixelY||t>=this.right||e>=this.bottom);},isInteresting:function(t,e){return t&&e?this.canCollide||this.hasInterestingFace:t?this.collides:!!e&&this.hasInterestingFace;},resetCollision:function(t){return void 0===t&&(t=!0),this.collideLeft=!1,this.collideRight=!1,this.collideUp=!1,this.collideDown=!1,this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,t&&this.tilemapLayer&&this.tilemapLayer.calculateFacesAt(this.x,this.y),this;},resetFaces:function(){return this.faceTop=!1,this.faceBottom=!1,this.faceLeft=!1,this.faceRight=!1,this;},setCollision:function(t,e,i,n,s){return void 0===e&&(e=t),void 0===i&&(i=t),void 0===n&&(n=t),void 0===s&&(s=!0),this.collideLeft=t,this.collideRight=e,this.collideUp=i,this.collideDown=n,this.faceLeft=t,this.faceRight=e,this.faceTop=i,this.faceBottom=n,s&&this.tilemapLayer&&this.tilemapLayer.calculateFacesAt(this.x,this.y),this;},setCollisionCallback:function(t,e){return null===t?(this.collisionCallback=void 0,this.collisionCallbackContext=void 0):(this.collisionCallback=t,this.collisionCallbackContext=e),this;},setSize:function(t,e,i,n){return void 0!==t&&(this.width=t),void 0!==e&&(this.height=e),void 0!==i&&(this.baseWidth=i),void 0!==n&&(this.baseHeight=n),this.updatePixelXY(),this;},updatePixelXY:function(){var t,e,i=this.layer.orientation;return i===n.ORTHOGONAL?(this.pixelX=this.x*this.baseWidth,this.pixelY=this.y*this.baseHeight):i===n.ISOMETRIC?(this.pixelX=(this.x-this.y)*this.baseWidth*.5,this.pixelY=(this.x+this.y)*this.baseHeight*.5):i===n.STAGGERED?(this.pixelX=this.x*this.baseWidth+this.y%2*(this.baseWidth/2),this.pixelY=this.y*(this.baseHeight/2)):i===n.HEXAGONAL&&(t=this.layer.hexSideLength,e=(this.baseHeight-t)/2+t,this.pixelX=this.x*this.baseWidth+this.y%2*(this.baseWidth/2),this.pixelY=this.y*e),this.right=this.pixelX+this.baseWidth,this.bottom=this.pixelY+this.baseHeight,this;},destroy:function(){this.collisionCallback=void 0,this.collisionCallbackContext=void 0,this.properties=void 0;},canCollide:{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||void 0!==this.collisionCallback;}},collides:{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown;}},hasInterestingFace:{get:function(){return this.faceTop||this.faceBottom||this.faceLeft||this.faceRight;}},tileset:{get:function(){var t=this.layer.tilemapLayer;if(t){var e=t.gidMap[this.index];if(e)return e;}return null;}},tilemapLayer:{get:function(){return this.layer.tilemapLayer;}},tilemap:{get:function(){var t=this.tilemapLayer;return t?t.tilemap:null;}}});t.exports=a;},,function(t,e){t.exports=function(t){return t.x-t.width*t.originX+.5*t.width;};},function(t,e){t.exports=function(t,e){var i=t.width*t.originX;return t.x=e+i-.5*t.width,t;};},function(t,e){t.exports=function(t){return t.y-t.height*t.originY+.5*t.height;};},function(t,e){t.exports=function(t,e){var i=t.height*t.originY;return t.y=e+i-.5*t.height,t;};},function(t,e,i){t.exports={POST_RENDER:i(628),PRE_RENDER:i(629),RENDER:i(630),RESIZE:i(631)};},function(t,e){t.exports={BITMAPMASK_PIPELINE:"BitmapMaskPipeline",LIGHT_PIPELINE:"Light2D",POINTLIGHT_PIPELINE:"PointLightPipeline",SINGLE_PIPELINE:"SinglePipeline",MULTI_PIPELINE:"MultiPipeline",ROPE_PIPELINE:"RopePipeline",GRAPHICS_PIPELINE:"GraphicsPipeline",POSTFX_PIPELINE:"PostFXPipeline",UTILITY_PIPELINE:"UtilityPipeline"};},function(t,e,i){var h=i(74);t.exports=function(t,e,i,n){if(void 0===n&&(n=t),!Array.isArray(e))return-1!==(o=t.indexOf(e))?(h(t,o),i&&i.call(n,e),e):null;for(var s=e.length-1,r=[];0<=s;){var o,a=e[s];-1!==(o=t.indexOf(a))&&(h(t,o),r.push(a),i&&i.call(n,a)),s--;}return r;};},function(t,e,i){var n=i(0),s=i(199),r=i(10),o=i(3),a=new n({initialize:function(t){this.type=t,this.defaultDivisions=5,this.arcLengthDivisions=100,this.cacheArcLengths=[],this.needsUpdate=!0,this.active=!0,this._tmpVec2A=new o(),this._tmpVec2B=new o();},draw:function(t,e){return void 0===e&&(e=32),t.strokePoints(this.getPoints(e));},getBounds:function(t,e){t=t||new r(),void 0===e&&(e=16);var i=this.getLength();i<e&&(e=i/2);var n=Math.max(1,Math.round(i/e));return s(this.getSpacedPoints(n),t);},getDistancePoints:function(t){var e=this.getLength(),i=Math.max(1,e/t);return this.getSpacedPoints(i);},getEndPoint:function(t){return void 0===t&&(t=new o()),this.getPointAt(1,t);},getLength:function(){var t=this.getLengths();return t[t.length-1];},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,i=[],n=this.getPoint(0,this._tmpVec2A),s=0;i.push(0);for(var r=1;r<=t;r++)s+=(e=this.getPoint(r/t,this._tmpVec2B)).distance(n),i.push(s),n.copy(e);return this.cacheArcLengths=i;},getPointAt:function(t,e){var i=this.getUtoTmapping(t);return this.getPoint(i,e);},getPoints:function(t,e,i){void 0===i&&(i=[]),t=t||(e?this.getLength()/e:this.defaultDivisions);for(var n=0;n<=t;n++)i.push(this.getPoint(n/t));return i;},getRandomPoint:function(t){return void 0===t&&(t=new o()),this.getPoint(Math.random(),t);},getSpacedPoints:function(t,e,i){void 0===i&&(i=[]),t=t||(e?this.getLength()/e:this.defaultDivisions);for(var n=0;n<=t;n++){var s=this.getUtoTmapping(n/t,null,t);i.push(this.getPoint(s));}return i;},getStartPoint:function(t){return void 0===t&&(t=new o()),this.getPointAt(0,t);},getTangent:function(t,e){void 0===e&&(e=new o());var i=t-1e-4,n=t+1e-4;return i<0&&(i=0),1<n&&(n=1),this.getPoint(i,this._tmpVec2A),this.getPoint(n,e),e.subtract(this._tmpVec2A).normalize();},getTangentAt:function(t,e){var i=this.getUtoTmapping(t);return this.getTangent(i,e);},getTFromDistance:function(t,e){return t<=0?0:this.getUtoTmapping(0,t,e);},getUtoTmapping:function(t,e,i){for(var n,s=this.getLengths(i),r=0,o=s.length,a=e?Math.min(e,s[o-1]):t*s[o-1],h=0,u=o-1;h<=u;)if((n=s[r=Math.floor(h+(u-h)/2)]-a)<0)h=r+1;else{if(!(0<n)){u=r;break;}u=r-1;}if(s[r=u]===a)return r/(o-1);var l=s[r];return(r+(a-l)/(s[r+1]-l))/(o-1);},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths();}});t.exports=a;},function(t,e,i){t.exports={ADD:i(968),COMPLETE:i(969),FILE_COMPLETE:i(970),FILE_KEY_COMPLETE:i(971),FILE_LOAD_ERROR:i(972),FILE_LOAD:i(973),FILE_PROGRESS:i(974),POST_PROCESS:i(975),PROGRESS:i(976),START:i(977)};},function(t,e,i){var p=i(4);t.exports=function(t,e,i){void 0===i&&(i=new p());var n=t.x1,s=t.y1,r=t.x2,o=t.y2,a=e.x1,h=e.y1,u=e.x2,l=e.y2,c=(l-h)*(r-n)-(u-a)*(o-s);if(0==c)return!1;var d=((u-a)*(s-h)-(l-h)*(n-a))/c,f=((r-n)*(s-h)-(o-s)*(n-a))/c;return 0<=d&&d<=1&&0<=f&&f<=1&&(i.x=n+d*(r-n),i.y=s+d*(o-s),!0);};},function(t,e){t.exports=function(t){return Math.atan2(t.y2-t.y1,t.x2-t.x1);};},function(t,e,i){var n=i(18);t.exports=function(t,e,i){return(i-e)*(t=n(t,0,1))+e;};},function(t,e){t.exports=function(t,e,i){return t&&t.hasOwnProperty(e)?t[e]:i;};},function(t,e){t.exports={CREATED:0,INIT:1,DELAY:2,OFFSET_DELAY:3,PENDING_RENDER:4,PLAYING_FORWARD:5,PLAYING_BACKWARD:6,HOLD_DELAY:7,REPEAT_DELAY:8,COMPLETE:9,PENDING_ADD:20,PAUSED:21,LOOP_DELAY:22,ACTIVE:23,COMPLETE_DELAY:24,PENDING_REMOVE:25,REMOVED:26};},function(t,e,i){var n=i(0),a=i(315),s=new n({initialize:function(t,e){this.parent=t,(this.events=e)||(this.events=t.events?t.events:t),this.list={},this.values={},this._frozen=!1,!t.hasOwnProperty("sys")&&this.events&&this.events.once(a.DESTROY,this.destroy,this);},get:function(t){var e=this.list;if(Array.isArray(t)){for(var i=[],n=0;n<t.length;n++)i.push(e[t[n]]);return i;}return e[t];},getAll:function(){var t={};for(var e in this.list)this.list.hasOwnProperty(e)&&(t[e]=this.list[e]);return t;},query:function(t){var e={};for(var i in this.list)this.list.hasOwnProperty(i)&&i.match(t)&&(e[i]=this.list[i]);return e;},set:function(t,e){if(this._frozen)return this;if("string"==typeof t)return this.setValue(t,e);for(var i in t)this.setValue(i,t[i]);return this;},inc:function(t,e){if(this._frozen)return this;void 0===e&&(e=1);var i=this.get(t);return void 0===i&&(i=0),this.set(t,i+e),this;},toggle:function(t){return this._frozen||this.set(t,!this.get(t)),this;},setValue:function(i,t){return this._frozen||(this.has(i)?this.values[i]=t:(s=(n=this).list,r=this.events,o=this.parent,Object.defineProperty(this.values,i,{enumerable:!0,configurable:!0,get:function(){return s[i];},set:function(t){var e;n._frozen||(e=s[i],s[i]=t,r.emit(a.CHANGE_DATA,o,i,t,e),r.emit(a.CHANGE_DATA_KEY+i,o,t,e));}}),s[i]=t,r.emit(a.SET_DATA,o,i,t))),this;var n,s,r,o;},each:function(t,e){for(var i=[this.parent,null,void 0],n=1;n<arguments.length;n++)i.push(arguments[n]);for(var s in this.list)i[1]=s,i[2]=this.list[s],t.apply(e,i);return this;},merge:function(t,e){for(var i in void 0===e&&(e=!0),t)t.hasOwnProperty(i)&&(e||!e&&!this.has(i))&&this.setValue(i,t[i]);return this;},remove:function(t){if(this._frozen)return this;if(!Array.isArray(t))return this.removeValue(t);for(var e=0;e<t.length;e++)this.removeValue(t[e]);return this;},removeValue:function(t){var e;return this.has(t)&&(e=this.list[t],delete this.list[t],delete this.values[t],this.events.emit(a.REMOVE_DATA,this.parent,t,e)),this;},pop:function(t){var e=void 0;return!this._frozen&&this.has(t)&&(e=this.list[t],delete this.list[t],delete this.values[t],this.events.emit(a.REMOVE_DATA,this.parent,t,e)),e;},has:function(t){return this.list.hasOwnProperty(t);},setFreeze:function(t){return this._frozen=t,this;},reset:function(){for(var t in this.list)delete this.list[t],delete this.values[t];return this._frozen=!1,this;},destroy:function(){this.reset(),this.events.off(a.CHANGE_DATA),this.events.off(a.SET_DATA),this.events.off(a.REMOVE_DATA),this.parent=null;},freeze:{get:function(){return this._frozen;},set:function(t){this._frozen=!!t;}},count:{get:function(){var t=0;for(var e in this.list)void 0!==this.list[e]&&t++;return t;}}});t.exports=s;},function(t,e,i){var n=new(i(0))({initialize:function(t){if(this.entries={},this.size=0,Array.isArray(t))for(var e=0;e<t.length;e++)this.set(t[e][0],t[e][1]);},set:function(t,e){return this.has(t)||this.size++,this.entries[t]=e,this;},get:function(t){if(this.has(t))return this.entries[t];},getArray:function(){var t=[],e=this.entries;for(var i in e)t.push(e[i]);return t;},has:function(t){return this.entries.hasOwnProperty(t);},delete:function(t){return this.has(t)&&(delete this.entries[t],this.size--),this;},clear:function(){return Object.keys(this.entries).forEach(function(t){delete this.entries[t];},this),this.size=0,this;},keys:function(){return Object.keys(this.entries);},values:function(){var t=[],e=this.entries;for(var i in e)t.push(e[i]);return t;},dump:function(){var t=this.entries;for(var e in console.group("Map"),t)console.log(e,t[e]);console.groupEnd();},each:function(t){var e=this.entries;for(var i in e)if(!1===t(i,e[i]))break;return this;},contains:function(t){var e=this.entries;for(var i in e)if(e[i]===t)return!0;return!1;},merge:function(t,e){void 0===e&&(e=!1);var i=this.entries,n=t.entries;for(var s in n)i.hasOwnProperty(s)&&e?i[s]=n[s]:this.set(s,n[s]);return this;}});t.exports=n;},function(t,e){t.exports=function(t,e,i){return t<<16|e<<8|i;};},function(t,e,i){t.exports={ENTER_FULLSCREEN:i(800),FULLSCREEN_FAILED:i(801),FULLSCREEN_UNSUPPORTED:i(802),LEAVE_FULLSCREEN:i(803),ORIENTATION_CHANGE:i(804),RESIZE:i(805)};},function(t,e,i){(function(i){var n={android:!1,chromeOS:!1,cordova:!1,crosswalk:!1,desktop:!1,ejecta:!1,electron:!1,iOS:!1,iOSVersion:0,iPad:!1,iPhone:!1,kindle:!1,linux:!1,macOS:!1,node:!1,nodeWebkit:!1,pixelRatio:1,webApp:!1,windows:!1,windowsPhone:!1};t.exports=function(){if("function"==typeof importScripts)return n;var t=navigator.userAgent;/Windows/.test(t)?n.windows=!0:/Mac OS/.test(t)&&!/like Mac OS/.test(t)?navigator.maxTouchPoints&&2<navigator.maxTouchPoints?(n.iOS=!0,n.iPad=!0,navigator.appVersion.match(/Version\/(\d+)/),n.iOSVersion=parseInt(RegExp.$1,10)):n.macOS=!0:/Android/.test(t)?n.android=!0:/Linux/.test(t)?n.linux=!0:/iP[ao]d|iPhone/i.test(t)?(n.iOS=!0,navigator.appVersion.match(/OS (\d+)/),n.iOSVersion=parseInt(RegExp.$1,10),n.iPhone=-1!==t.toLowerCase().indexOf("iphone"),n.iPad=-1!==t.toLowerCase().indexOf("ipad")):/Kindle/.test(t)||/\bKF[A-Z][A-Z]+/.test(t)||/Silk.*Mobile Safari/.test(t)?n.kindle=!0:/CrOS/.test(t)&&(n.chromeOS=!0),(/Windows Phone/i.test(t)||/IEMobile/i.test(t))&&(n.android=!1,n.iOS=!1,n.macOS=!1,n.windows=!0,n.windowsPhone=!0);var e=/Silk/.test(t);return(n.windows||n.macOS||n.linux&&!e||n.chromeOS)&&(n.desktop=!0),(n.windowsPhone||/Windows NT/i.test(t)&&/Touch/i.test(t))&&(n.desktop=!1),navigator.standalone&&(n.webApp=!0),"function"!=typeof importScripts&&(void 0!==window.cordova&&(n.cordova=!0),void 0!==window.ejecta&&(n.ejecta=!0)),void 0!==i&&i.versions&&i.versions.node&&(n.node=!0),n.node&&"object"==typeof i.versions&&(n.nodeWebkit=!!i.versions["node-webkit"],n.electron=!!i.versions.electron),/Crosswalk/.test(t)&&(n.crosswalk=!0),n.pixelRatio=window.devicePixelRatio||1,n;}();}).call(this,i(807));},function(t,e,i){t.exports={ADD:i(861),ERROR:i(862),LOAD:i(863),READY:i(864),REMOVE:i(865)};},function(t,e){t.exports={BYTE:{enum:5120,size:1},UNSIGNED_BYTE:{enum:5121,size:1},SHORT:{enum:5122,size:2},UNSIGNED_SHORT:{enum:5123,size:2},INT:{enum:5124,size:4},UNSIGNED_INT:{enum:5125,size:4},FLOAT:{enum:5126,size:4}};},function(t,e,i){var n=i(0),R=i(59),s=i(2),r=i(878),o=i(879),a=i(25),z=i(12),h=i(107),u=i(58),l=new n({Extends:u,initialize:function(t){var e=t.game.renderer,i=s(t,"fragShader",r);t.fragShader=z.parseFragmentShaderMaxTextures(i,e.maxTextures),t.vertShader=s(t,"vertShader",o),t.attributes=s(t,"attributes",[{name:"inPosition",size:2},{name:"inTexCoord",size:2},{name:"inTexId"},{name:"inTintEffect"},{name:"inTint",size:4,type:h.UNSIGNED_BYTE,normalized:!0}]),u.call(this,t),this._tempMatrix1=new a(),this._tempMatrix2=new a(),this._tempMatrix3=new a(),this.calcMatrix=new a(),this.tempTriangle=[{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0}],this.strokeTint={TL:0,TR:0,BL:0,BR:0},this.fillTint={TL:0,TR:0,BL:0,BR:0},this.currentFrame={u0:0,v0:0,u1:1,v1:1},this.firstQuad=[0,0,0,0,0],this.prevQuad=[0,0,0,0,0],this.polygonCache=[];},boot:function(){u.prototype.boot.call(this),this.currentShader.set1iv("uMainSampler",this.renderer.textureIndexes);},batchSprite:function(t,e,i){this.manager.set(this,t);var n,s=this._tempMatrix1,r=this._tempMatrix2,o=this._tempMatrix3,a=t.frame,h=a.glTexture,u=a.u0,l=a.v0,c=a.u1,d=a.v1,f=a.x,p=a.y,g=a.cutWidth,v=a.cutHeight,m=a.customPivot,y=t.displayOriginX,x=t.displayOriginY,T=-y+f,w=-x+p;t.isCropped&&((n=t._crop).flipX===t.flipX&&n.flipY===t.flipY||a.updateCropUVs(n,t.flipX,t.flipY),u=n.u0,l=n.v0,c=n.u1,d=n.v1,g=n.width,v=n.height,T=-y+n.x,w=-x+n.y);var E=1,b=1;t.flipX&&(m||(T+=-a.realWidth+2*y),E=-1),(t.flipY||a.source.isGLTexture&&!h.flipY)&&(m||(w+=-a.realHeight+2*x),b=-1),r.applyITRS(t.x,t.y,t.rotation,t.scaleX*E,t.scaleY*b),s.copyFrom(e.matrix),i?(s.multiplyWithOffset(i,-e.scrollX*t.scrollFactorX,-e.scrollY*t.scrollFactorY),r.e=t.x,r.f=t.y):(r.e-=e.scrollX*t.scrollFactorX,r.f-=e.scrollY*t.scrollFactorY),s.multiply(r,o);var S=T+g,A=w+v,_=e.roundPixels,C=o.getXRound(T,w,_),R=o.getYRound(T,w,_),M=o.getXRound(T,A,_),P=o.getYRound(T,A,_),O=o.getXRound(S,A,_),L=o.getYRound(S,A,_),D=o.getXRound(S,w,_),F=o.getYRound(S,w,_),k=z.getTintAppendFloatAlpha,I=e.alpha,B=k(t.tintTopLeft,I*t._alphaTL),N=k(t.tintTopRight,I*t._alphaTR),Y=k(t.tintBottomLeft,I*t._alphaBL),X=k(t.tintBottomRight,I*t._alphaBR);this.shouldFlush(6)&&this.flush();var U=this.setGameObject(t,a);this.manager.preBatch(t),this.batchQuad(t,C,R,M,P,O,L,D,F,u,l,c,d,B,N,Y,X,t.tintFill,h,U),this.manager.postBatch(t);},batchTexture:function(t,e,i,n,s,r,o,a,h,u,l,c,d,f,p,g,v,m,y,x,T,w,E,b,S,A,_,C,R,M,P,O){this.manager.set(this,t);var L,D,F,k,I,B=this._tempMatrix1,N=this._tempMatrix2,Y=this._tempMatrix3,X=m/i+_,U=y/n+C,z=(m+x)/i+_,G=(y+T)/n+C,W=o,V=a,H=-g,j=-v;t.isCropped&&(o=W=D=(L=t._crop).width,a=V=F=L.height,k=m=L.x,I=y=L.y,c&&(k=x-L.x-D),d&&(I=T-L.y-F),X=k/i+_,U=I/n+C,z=(k+D)/i+_,G=(I+F)/n+C,H=-g+m,j=-v+y),c&&(W*=-1,H+=o),(d^=!P&&e.isRenderTexture?1:0)&&(V*=-1,j+=a);var K=H+W,Z=j+V;N.applyITRS(s,r,l,h,u),B.copyFrom(R.matrix),M?(B.multiplyWithOffset(M,-R.scrollX*f,-R.scrollY*p),N.e=s,N.f=r):(N.e-=R.scrollX*f,N.f-=R.scrollY*p),B.multiply(N,Y);var q=R.roundPixels,J=Y.getXRound(H,j,q),Q=Y.getYRound(H,j,q),$=Y.getXRound(H,Z,q),tt=Y.getYRound(H,Z,q),et=Y.getXRound(K,Z,q),it=Y.getYRound(K,Z,q),nt=Y.getXRound(K,j,q),st=Y.getYRound(K,j,q);void 0===O&&(O=this.renderer.setTexture2D(e)),t&&this.manager.preBatch(t),this.batchQuad(t,J,Q,$,tt,et,it,nt,st,X,U,z,G,w,E,b,S,A,e,O),t&&this.manager.postBatch(t);},batchTextureFrame:function(t,e,i,n,s,r,o){this.manager.set(this);var a=this._tempMatrix1.copyFrom(r),h=this._tempMatrix2,u=e+t.width,l=i+t.height;o?a.multiply(o,h):h=a;var c=h.getX(e,i),d=h.getY(e,i),f=h.getX(e,l),p=h.getY(e,l),g=h.getX(u,l),v=h.getY(u,l),m=h.getX(u,i),y=h.getY(u,i),x=this.renderer.setTextureSource(t.source);n=z.getTintAppendFloatAlpha(n,s),this.batchQuad(null,c,d,f,p,g,v,m,y,t.u0,t.v0,t.u1,t.v1,n,n,n,n,0,t.glTexture,x);},batchFillRect:function(t,e,i,n,s,r){this.renderer.pipelines.set(this);var o=this.calcMatrix;r&&r.multiply(s,o);var a=t+i,h=e+n,u=o.getX(t,e),l=o.getY(t,e),c=o.getX(t,h),d=o.getY(t,h),f=o.getX(a,h),p=o.getY(a,h),g=o.getX(a,e),v=o.getY(a,e),m=this.fillTint;this.batchQuad(null,u,l,c,d,f,p,g,v,0,0,1,1,m.TL,m.TR,m.BL,m.BR,2);},batchFillTriangle:function(t,e,i,n,s,r,o,a){this.renderer.pipelines.set(this);var h=this.calcMatrix;a&&a.multiply(o,h);var u=h.getX(t,e),l=h.getY(t,e),c=h.getX(i,n),d=h.getY(i,n),f=h.getX(s,r),p=h.getY(s,r),g=this.fillTint;this.batchTri(null,u,l,c,d,f,p,0,0,1,1,g.TL,g.TR,g.BL,2);},batchStrokeTriangle:function(t,e,i,n,s,r,o,a,h){var u=this.tempTriangle;u[0].x=t,u[0].y=e,u[0].width=o,u[1].x=i,u[1].y=n,u[1].width=o,u[2].x=s,u[2].y=r,u[2].width=o,u[3].x=t,u[3].y=e,u[3].width=o,this.batchStrokePath(u,o,!1,a,h);},batchFillPath:function(t,e,i){this.renderer.pipelines.set(this);var n=this.calcMatrix;i&&i.multiply(e,n);for(var s,r,o=t.length,a=this.polygonCache,h=this.fillTint.TL,u=this.fillTint.TR,l=this.fillTint.BL,c=0;c<o;++c)r=t[c],a.push(r.x,r.y);o=(s=R(a)).length;for(var d=0;d<o;d+=3){var f=2*s[d+0],p=2*s[d+1],g=2*s[d+2],v=a[0+f],m=a[1+f],y=a[0+p],x=a[1+p],T=a[0+g],w=a[1+g],E=n.getX(v,m),b=n.getY(v,m),S=n.getX(y,x),A=n.getY(y,x),_=n.getX(T,w),C=n.getY(T,w);this.batchTri(null,E,b,S,A,_,C,0,0,1,1,h,u,l,2);}a.length=0;},batchStrokePath:function(t,e,i,n,s){this.renderer.pipelines.set(this),this.prevQuad[4]=0,this.firstQuad[4]=0;for(var r=t.length-1,o=0;o<r;o++){var a=t[o],h=t[o+1];this.batchLine(a.x,a.y,h.x,h.y,a.width/2,h.width/2,e,o,!i&&o===r-1,n,s);}},batchLine:function(t,e,i,n,s,r,o,a,h,u,l){this.renderer.pipelines.set(this);var c=this.calcMatrix;l&&l.multiply(u,c);var d,f,p=i-t,g=n-e,v=Math.sqrt(p*p+g*g),m=s*(n-e)/v,y=s*(t-i)/v,x=r*(n-e)/v,T=r*(t-i)/v,w=i-x,E=n-T,b=t-m,S=e-y,A=i+x,_=n+T,C=t+m,R=e+y,M=c.getX(w,E),P=c.getY(w,E),O=c.getX(b,S),L=c.getY(b,S),D=c.getX(A,_),F=c.getY(A,_),k=c.getX(C,R),I=c.getY(C,R),B=this.strokeTint,N=B.TL,Y=B.TR,X=B.BL,U=B.BR;this.batchQuad(null,k,I,O,L,M,P,D,F,0,0,1,1,N,Y,X,U,2),o<=2||(d=this.prevQuad,f=this.firstQuad,0<a&&d[4]?this.batchQuad(null,k,I,O,L,d[0],d[1],d[2],d[3],0,0,1,1,N,Y,X,U,2):(f[0]=k,f[1]=I,f[2]=O,f[3]=L,f[4]=1),h&&f[4]?this.batchQuad(null,M,P,D,F,f[0],f[1],f[2],f[3],0,0,1,1,N,Y,X,U,2):(d[0]=M,d[1]=P,d[2]=D,d[3]=F,d[4]=1));}});t.exports=l;},function(t,e,i){var n=i(0),C=i(18),s=i(17),r=new n({initialize:function(t,e,i,n,s,r,o){this.texture=t,this.name=e,this.source=t.source[i],this.sourceIndex=i,this.glTexture=this.source.glTexture,this.cutX,this.cutY,this.cutWidth,this.cutHeight,this.x=0,this.y=0,this.width,this.height,this.halfWidth,this.halfHeight,this.centerX,this.centerY,this.pivotX=0,this.pivotY=0,this.customPivot=!1,this.rotated=!1,this.autoRound=-1,this.customData={},this.u0=0,this.v0=0,this.u1=0,this.v1=0,this.data={cut:{x:0,y:0,w:0,h:0,r:0,b:0},trim:!1,sourceSize:{w:0,h:0},spriteSourceSize:{x:0,y:0,w:0,h:0,r:0,b:0},radius:0,drawImage:{x:0,y:0,width:0,height:0}},this.setSize(r,o,n,s);},setSize:function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this.cutX=i,this.cutY=n,this.cutWidth=t,this.cutHeight=e,this.width=t,this.height=e,this.halfWidth=Math.floor(.5*t),this.halfHeight=Math.floor(.5*e),this.centerX=Math.floor(t/2),this.centerY=Math.floor(e/2);var s=this.data,r=s.cut;r.x=i,r.y=n,r.w=t,r.h=e,r.r=i+t,r.b=n+e,s.sourceSize.w=t,s.sourceSize.h=e,s.spriteSourceSize.w=t,s.spriteSourceSize.h=e,s.radius=.5*Math.sqrt(t*t+e*e);var o=s.drawImage;return o.x=i,o.y=n,o.width=t,o.height=e,this.updateUVs();},setTrim:function(t,e,i,n,s,r){var o=this.data,a=o.spriteSourceSize;return o.trim=!0,o.sourceSize.w=t,o.sourceSize.h=e,a.x=i,a.y=n,a.w=s,a.h=r,a.r=i+s,a.b=n+r,this.x=i,this.y=n,this.width=s,this.height=r,this.halfWidth=.5*s,this.halfHeight=.5*r,this.centerX=Math.floor(s/2),this.centerY=Math.floor(r/2),this.updateUVs();},setCropUVs:function(t,e,i,n,s,r,o){var a,h,u,l,c,d,f,p=this.cutX,g=this.cutY,v=this.cutWidth,m=this.cutHeight,y=this.realWidth,x=this.realHeight,T=p+(e=C(e,0,y)),w=g+(i=C(i,0,x)),E=n=C(n,0,y-e),b=s=C(s,0,x-i),S=this.data;S.trim?(a=S.spriteSourceSize,h=e+(n=C(n,0,v-e)),u=i+(s=C(s,0,m-i)),!(a.r<e||a.b<i||a.x>h||a.y>u)?(l=Math.max(a.x,e),c=Math.max(a.y,i),E=d=Math.min(a.r,h)-l,b=f=Math.min(a.b,u)-c,T=r?p+(v-(l-a.x)-d):p+(l-a.x),w=o?g+(m-(c-a.y)-f):g+(c-a.y),e=l,i=c,n=d,s=f):b=E=w=T=0):(r&&(T=p+(v-e-n)),o&&(w=g+(m-i-s)));var A=this.source.width,_=this.source.height;return t.u0=Math.max(0,T/A),t.v0=Math.max(0,w/_),t.u1=Math.min(1,(T+E)/A),t.v1=Math.min(1,(w+b)/_),t.x=e,t.y=i,t.cx=T,t.cy=w,t.cw=E,t.ch=b,t.width=n,t.height=s,t.flipX=r,t.flipY=o,t;},updateCropUVs:function(t,e,i){return this.setCropUVs(t,t.x,t.y,t.width,t.height,e,i);},setUVs:function(t,e,i,n,s,r){var o=this.data.drawImage;return o.width=t,o.height=e,this.u0=i,this.v0=n,this.u1=s,this.v1=r,this;},updateUVs:function(){var t=this.cutX,e=this.cutY,i=this.cutWidth,n=this.cutHeight,s=this.data.drawImage;s.width=i,s.height=n;var r=this.source.width,o=this.source.height;return this.u0=t/r,this.v0=e/o,this.u1=(t+i)/r,this.v1=(e+n)/o,this;},updateUVsInverted:function(){var t=this.source.width,e=this.source.height;return this.u0=(this.cutX+this.cutHeight)/t,this.v0=this.cutY/e,this.u1=this.cutX/t,this.v1=(this.cutY+this.cutWidth)/e,this;},clone:function(){var t=new r(this.texture,this.name,this.sourceIndex);return t.cutX=this.cutX,t.cutY=this.cutY,t.cutWidth=this.cutWidth,t.cutHeight=this.cutHeight,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.halfWidth=this.halfWidth,t.halfHeight=this.halfHeight,t.centerX=this.centerX,t.centerY=this.centerY,t.rotated=this.rotated,t.data=s(!0,t.data,this.data),t.updateUVs(),t;},destroy:function(){this.source=null,this.texture=null,this.glTexture=null,this.customData=null,this.data=null;},realWidth:{get:function(){return this.data.sourceSize.w;}},realHeight:{get:function(){return this.data.sourceSize.h;}},radius:{get:function(){return this.data.radius;}},trimmed:{get:function(){return this.data.trim;}},canvasData:{get:function(){return this.data.drawImage;}}});t.exports=r;},function(t,e,i){var s=i(208),n=i(0),r=i(1),o=i(79),a=new n({initialize:function(t){this.parent=t,this.list=[],this.position=0,this.addCallback=r,this.removeCallback=r,this._sortKey="";},add:function(t,e){return e?s.Add(this.list,t):s.Add(this.list,t,0,this.addCallback,this);},addAt:function(t,e,i){return i?s.AddAt(this.list,t,e):s.AddAt(this.list,t,e,0,this.addCallback,this);},getAt:function(t){return this.list[t];},getIndex:function(t){return this.list.indexOf(t);},sort:function(i,t){return i&&(void 0===t&&(t=function(t,e){return t[i]-e[i];}),o(this.list,t)),this;},getByName:function(t){return s.GetFirst(this.list,"name",t);},getRandom:function(t,e){return s.GetRandom(this.list,t,e);},getFirst:function(t,e,i,n){return s.GetFirst(this.list,t,e,i,n);},getAll:function(t,e,i,n){return s.GetAll(this.list,t,e,i,n);},count:function(t,e){return s.CountAllMatching(this.list,t,e);},swap:function(t,e){s.Swap(this.list,t,e);},moveTo:function(t,e){return s.MoveTo(this.list,t,e);},moveAbove:function(t,e){return s.MoveAbove(this.list,t,e);},moveBelow:function(t,e){return s.MoveBelow(this.list,t,e);},remove:function(t,e){return e?s.Remove(this.list,t):s.Remove(this.list,t,this.removeCallback,this);},removeAt:function(t,e){return e?s.RemoveAt(this.list,t):s.RemoveAt(this.list,t,this.removeCallback,this);},removeBetween:function(t,e,i){return i?s.RemoveBetween(this.list,t,e):s.RemoveBetween(this.list,t,e,this.removeCallback,this);},removeAll:function(t){for(var e=this.list.length;e--;)this.remove(this.list[e],t);return this;},bringToTop:function(t){return s.BringToTop(this.list,t);},sendToBack:function(t){return s.SendToBack(this.list,t);},moveUp:function(t){return s.MoveUp(this.list,t),t;},moveDown:function(t){return s.MoveDown(this.list,t),t;},reverse:function(){return this.list.reverse(),this;},shuffle:function(){return s.Shuffle(this.list),this;},replace:function(t,e){return s.Replace(this.list,t,e);},exists:function(t){return-1<this.list.indexOf(t);},setAll:function(t,e,i,n){return s.SetAll(this.list,t,e,i,n),this;},each:function(t,e){for(var i=[null],n=2;n<arguments.length;n++)i.push(arguments[n]);for(n=0;n<this.list.length;n++)i[0]=this.list[n],t.apply(e,i);},shutdown:function(){this.removeAll(),this.list=[];},destroy:function(){this.removeAll(),this.parent=null,this.addCallback=null,this.removeCallback=null;},length:{get:function(){return this.list.length;}},first:{get:function(){return(this.position=0)<this.list.length?this.list[0]:null;}},last:{get:function(){return 0<this.list.length?(this.position=this.list.length-1,this.list[this.position]):null;}},next:{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null;}},previous:{get:function(){return 0<this.position?(this.position--,this.list[this.position]):null;}}});t.exports=a;},function(t,e,i){var n=i(0),s=i(112),r=i(445),o=i(446),a=i(56),h=i(180),u=new n({initialize:function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),this.type=a.ELLIPSE,this.x=t,this.y=e,this.width=i,this.height=n;},contains:function(t,e){return s(this,t,e);},getPoint:function(t,e){return r(this,t,e);},getPoints:function(t,e,i){return o(this,t,e,i);},getRandomPoint:function(t){return h(this,t);},setTo:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this;},setEmpty:function(){return this.width=0,this.height=0,this;},setPosition:function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this;},setSize:function(t,e){return void 0===e&&(e=t),this.width=t,this.height=e,this;},isEmpty:function(){return this.width<=0||this.height<=0;},getMinorRadius:function(){return Math.min(this.width,this.height)/2;},getMajorRadius:function(){return Math.max(this.width,this.height)/2;},left:{get:function(){return this.x-this.width/2;},set:function(t){this.x=t+this.width/2;}},right:{get:function(){return this.x+this.width/2;},set:function(t){this.x=t-this.width/2;}},top:{get:function(){return this.y-this.height/2;},set:function(t){this.y=t+this.height/2;}},bottom:{get:function(){return this.y+this.height/2;},set:function(t){this.y=t-this.height/2;}}});t.exports=u;},function(t,e){t.exports=function(t,e,i){if(t.width<=0||t.height<=0)return!1;var n=(e-t.x)/t.width,s=(i-t.y)/t.height;return(n*=n)+(s*=s)<.25;};},function(t,e,i){var U=i(275),n=i(0),r=i(75),s=i(9),o=i(207),z=i(2),G=i(6),a=i(7),W=i(437),h=i(149),u=i(73),l=new n({Extends:s,initialize:function(t,e,i){s.call(this),i?e&&!Array.isArray(e)&&(e=[e]):Array.isArray(e)?a(e[0])&&(i=e,e=null):a(e)&&(i=e,e=null),this.scene=t,this.children=new h(),this.isParent=!0,this.type="Group",this.classType=z(i,"classType",u),this.name=z(i,"name",""),this.active=z(i,"active",!0),this.maxSize=z(i,"maxSize",-1),this.defaultKey=z(i,"defaultKey",null),this.defaultFrame=z(i,"defaultFrame",null),this.runChildUpdate=z(i,"runChildUpdate",!1),this.createCallback=z(i,"createCallback",null),this.removeCallback=z(i,"removeCallback",null),this.createMultipleCallback=z(i,"createMultipleCallback",null),this.internalCreateCallback=z(i,"internalCreateCallback",null),this.internalRemoveCallback=z(i,"internalRemoveCallback",null),e&&this.addMultiple(e),i&&this.createMultiple(i),this.on(r.ADDED_TO_SCENE,this.addedToScene,this),this.on(r.REMOVED_FROM_SCENE,this.removedFromScene,this);},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},create:function(t,e,i,n,s,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.defaultKey),void 0===n&&(n=this.defaultFrame),void 0===s&&(s=!0),void 0===r&&(r=!0),this.isFull())return null;var o=new this.classType(this.scene,t,e,i,n);return o.addToDisplayList(this.scene.sys.displayList),o.addToUpdateList(),o.visible=s,o.setActive(r),this.add(o),o;},createMultiple:function(t){if(this.isFull())return[];Array.isArray(t)||(t=[t]);var e=[];if(t[0].key)for(var i=0;i<t.length;i++)var n=this.createFromConfig(t[i]),e=e.concat(n);return e;},createFromConfig:function(t){if(this.isFull())return[];this.classType=z(t,"classType",this.classType);var e=z(t,"key",void 0),i=z(t,"frame",null),n=z(t,"visible",!0),s=z(t,"active",!0),r=[];if(void 0===e)return r;Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]);var o=z(t,"repeat",0),a=z(t,"randomKey",!1),h=z(t,"randomFrame",!1),u=z(t,"yoyo",!1),l=z(t,"quantity",!1),c=z(t,"frameQuantity",1),d=z(t,"max",0),f=W(e,i,{max:d,qty:l||c,random:a,randomB:h,repeat:o,yoyo:u});t.createCallback&&(this.createCallback=t.createCallback),t.removeCallback&&(this.removeCallback=t.removeCallback);for(var p=0;p<f.length;p++){var g=this.create(0,0,f[p].a,f[p].b,n,s);if(!g)break;r.push(g);}var v=G(t,"setXY.x",0),m=G(t,"setXY.y",0),y=G(t,"setXY.stepX",0),x=G(t,"setXY.stepY",0);U.SetXY(r,v,m,y,x);var T=G(t,"setRotation.value",0),w=G(t,"setRotation.step",0);U.SetRotation(r,T,w);var E=G(t,"setScale.x",1),b=G(t,"setScale.y",E),S=G(t,"setScale.stepX",0),A=G(t,"setScale.stepY",0);U.SetScale(r,E,b,S,A);var _=G(t,"setOrigin.x",.5),C=G(t,"setOrigin.y",_),R=G(t,"setOrigin.stepX",0),M=G(t,"setOrigin.stepY",0);U.SetOrigin(r,_,C,R,M);var P=G(t,"setAlpha.value",1),O=G(t,"setAlpha.step",0);U.SetAlpha(r,P,O);var L=G(t,"setDepth.value",0),D=G(t,"setDepth.step",0);U.SetDepth(r,L,D);var F=G(t,"setScrollFactor.x",1),k=G(t,"setScrollFactor.y",F),I=G(t,"setScrollFactor.stepX",0),B=G(t,"setScrollFactor.stepY",0);U.SetScrollFactor(r,F,k,I,B);var N=z(t,"hitArea",null),Y=z(t,"hitAreaCallback",null);N&&U.SetHitArea(r,N,Y);var X=z(t,"gridAlign",!1);return X&&U.GridAlign(r,X),this.createMultipleCallback&&this.createMultipleCallback.call(this,r),r;},preUpdate:function(t,e){if(this.runChildUpdate&&0!==this.children.size)for(var i=this.children.entries.slice(),n=0;n<i.length;n++){var s=i[n];s.active&&s.update(t,e);}},add:function(t,e){return void 0===e&&(e=!1),this.isFull()||(this.children.set(t),this.internalCreateCallback&&this.internalCreateCallback.call(this,t),this.createCallback&&this.createCallback.call(this,t),e&&(t.addToDisplayList(this.scene.sys.displayList),t.addToUpdateList()),t.on(r.DESTROY,this.remove,this)),this;},addMultiple:function(t,e){if(void 0===e&&(e=!1),Array.isArray(t))for(var i=0;i<t.length;i++)this.add(t[i],e);return this;},remove:function(t,e,i){return void 0===e&&(e=!1),void 0===i&&(i=!1),this.children.contains(t)&&(this.children.delete(t),this.internalRemoveCallback&&this.internalRemoveCallback.call(this,t),this.removeCallback&&this.removeCallback.call(this,t),t.off(r.DESTROY,this.remove,this),i?t.destroy():e&&(t.removeFromDisplayList(),t.removeFromUpdateList())),this;},clear:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);for(var i=this.children,n=0;n<i.size;n++){var s=i.entries[n];s.off(r.DESTROY,this.remove,this),e?s.destroy():t&&(s.removeFromDisplayList(),s.removeFromUpdateList());}return this.children.clear(),this;},contains:function(t){return this.children.contains(t);},getChildren:function(){return this.children.entries;},getLength:function(){return this.children.size;},getMatching:function(t,e,i,n){return o(this.children.entries,t,e,i,n);},getFirst:function(t,e,i,n,s,r,o){return this.getHandler(!0,1,t,e,i,n,s,r,o);},getFirstNth:function(t,e,i,n,s,r,o,a){return this.getHandler(!0,t,e,i,n,s,r,o,a);},getLast:function(t,e,i,n,s,r,o){return this.getHandler(!1,1,t,e,i,n,s,r,o);},getLastNth:function(t,e,i,n,s,r,o,a){return this.getHandler(!1,t,e,i,n,s,r,o,a);},getHandler:function(t,e,i,n,s,r,o,a,h){var u,l;void 0===i&&(i=!1),void 0===n&&(n=!1);var c=0,d=this.children.entries;if(t){for(l=0;l<d.length;l++)if((u=d[l]).active===i){if(++c===e)break;}else u=null;}else for(l=d.length-1;0<=l;l--)if((u=d[l]).active===i){if(++c===e)break;}else u=null;return u?("number"==typeof s&&(u.x=s),"number"==typeof r&&(u.y=r),u):n?this.create(s,r,o,a,h):null;},get:function(t,e,i,n,s){return this.getFirst(!1,!0,t,e,i,n,s);},getFirstAlive:function(t,e,i,n,s,r){return this.getFirst(!0,t,e,i,n,s,r);},getFirstDead:function(t,e,i,n,s,r){return this.getFirst(!1,t,e,i,n,s,r);},playAnimation:function(t,e){return U.PlayAnimation(this.children.entries,t,e),this;},isFull:function(){return-1!==this.maxSize&&this.children.size>=this.maxSize;},countActive:function(t){void 0===t&&(t=!0);for(var e=0,i=0;i<this.children.size;i++)this.children.entries[i].active===t&&e++;return e;},getTotalUsed:function(){return this.countActive();},getTotalFree:function(){var t=this.getTotalUsed();return(-1===this.maxSize?999999999999:this.maxSize)-t;},setActive:function(t){return this.active=t,this;},setName:function(t){return this.name=t,this;},propertyValueSet:function(t,e,i,n,s){return U.PropertyValueSet(this.children.entries,t,e,i,n,s),this;},propertyValueInc:function(t,e,i,n,s){return U.PropertyValueInc(this.children.entries,t,e,i,n,s),this;},setX:function(t,e){return U.SetX(this.children.entries,t,e),this;},setY:function(t,e){return U.SetY(this.children.entries,t,e),this;},setXY:function(t,e,i,n){return U.SetXY(this.children.entries,t,e,i,n),this;},incX:function(t,e){return U.IncX(this.children.entries,t,e),this;},incY:function(t,e){return U.IncY(this.children.entries,t,e),this;},incXY:function(t,e,i,n){return U.IncXY(this.children.entries,t,e,i,n),this;},shiftPosition:function(t,e,i){return U.ShiftPosition(this.children.entries,t,e,i),this;},angle:function(t,e){return U.Angle(this.children.entries,t,e),this;},rotate:function(t,e){return U.Rotate(this.children.entries,t,e),this;},rotateAround:function(t,e){return U.RotateAround(this.children.entries,t,e),this;},rotateAroundDistance:function(t,e,i){return U.RotateAroundDistance(this.children.entries,t,e,i),this;},setAlpha:function(t,e){return U.SetAlpha(this.children.entries,t,e),this;},setTint:function(t,e,i,n){return U.SetTint(this.children.entries,t,e,i,n),this;},setOrigin:function(t,e,i,n){return U.SetOrigin(this.children.entries,t,e,i,n),this;},scaleX:function(t,e){return U.ScaleX(this.children.entries,t,e),this;},scaleY:function(t,e){return U.ScaleY(this.children.entries,t,e),this;},scaleXY:function(t,e,i,n){return U.ScaleXY(this.children.entries,t,e,i,n),this;},setDepth:function(t,e){return U.SetDepth(this.children.entries,t,e),this;},setBlendMode:function(t){return U.SetBlendMode(this.children.entries,t),this;},setHitArea:function(t,e){return U.SetHitArea(this.children.entries,t,e),this;},shuffle:function(){return U.Shuffle(this.children.entries),this;},kill:function(t){this.children.contains(t)&&t.setActive(!1);},killAndHide:function(t){this.children.contains(t)&&(t.setActive(!1),t.setVisible(!1));},setVisible:function(t,e,i){return U.SetVisible(this.children.entries,t,e,i),this;},toggleVisible:function(){return U.ToggleVisible(this.children.entries),this;},destroy:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1),this.scene&&!this.ignoreDestroy&&(this.emit(r.DESTROY,this),this.removeAllListeners(),this.scene.sys.updateList.remove(this),this.clear(e,t),this.scene=void 0,this.children=void 0);}});t.exports=l;},function(t,e,i){var A=i(12);t.exports=function(t,e,i,n,s,r){for(var o=A.getTintAppendFloatAlpha(i.fillColor,i.fillAlpha*n),a=i.pathData,h=i.pathIndexes,u=0;u<h.length;u+=3){var l=2*h[u],c=2*h[u+1],d=2*h[u+2],f=a[0+l]-s,p=a[1+l]-r,g=a[0+c]-s,v=a[1+c]-r,m=a[0+d]-s,y=a[1+d]-r,x=e.getX(f,p),T=e.getY(f,p),w=e.getX(g,v),E=e.getY(g,v),b=e.getX(m,y),S=e.getY(m,y);t.batchTri(i,x,T,w,E,b,S,0,0,1,1,o,o,o,2);}};},function(t,e){t.exports=function(t,e,i){var n=t.x3-t.x1,s=t.y3-t.y1,r=t.x2-t.x1,o=t.y2-t.y1,a=e-t.x1,h=i-t.y1,u=n*n+s*s,l=n*r+s*o,c=n*a+s*h,d=r*r+o*o,f=r*a+o*h,p=u*d-l*l,g=0==p?0:1/p,v=(d*c-l*f)*g,m=(u*f-l*c)*g;return 0<=v&&0<=m&&v+m<1;};},function(t,e,i){var n=i(0),s=i(10),r=i(3);function p(t,e,i,n){var s=t-i,r=e-n,o=s*s+r*r;return Math.sqrt(o);}var o=new n({initialize:function(t,e,i){this.vertex1=t,this.vertex2=e,this.vertex3=i,this.bounds=new s(),this._inCenter=new r();},getInCenter:function(t){void 0===t&&(t=!0);var e,i,n,s,r,o=this.vertex1,a=this.vertex2,h=this.vertex3,u=t?(e=o.x,i=o.y,n=a.x,s=a.y,r=h.x,h.y):(e=o.vx,i=o.vy,n=a.vx,s=a.vy,r=h.vx,h.vy),l=p(r,u,n,s),c=p(e,i,r,u),d=p(n,s,e,i),f=l+c+d;return this._inCenter.set((e*l+n*c+r*d)/f,(i*l+s*c+u*d)/f);},contains:function(t,e,i){var n,s,r,o,a,h,u=this.vertex1,l=this.vertex2,c=this.vertex3,d=u.vx,f=u.vy,p=l.vx,g=l.vy,v=c.vx,m=c.vy;i&&(n=i.a,s=i.b,r=i.c,o=i.d,a=i.e,h=i.f,d=u.vx*n+u.vy*r+a,f=u.vx*s+u.vy*o+h,p=l.vx*n+l.vy*r+a,g=l.vx*s+l.vy*o+h,v=c.vx*n+c.vy*r+a,m=c.vx*s+c.vy*o+h);var y=v-d,x=m-f,T=p-d,w=g-f,E=t-d,b=e-f,S=y*y+x*x,A=y*T+x*w,_=y*E+x*b,C=T*T+w*w,R=T*E+w*b,M=S*C-A*A,P=0==M?0:1/M,O=(C*_-A*R)*P,L=(S*R-A*_)*P;return 0<=O&&0<=L&&O+L<1;},isCounterClockwise:function(t){var e=this.vertex1,i=this.vertex2,n=this.vertex3,s=(i.vx-e.vx)*(n.vy-e.vy)-(i.vy-e.vy)*(n.vx-e.vx);return t<=0?0<=s:s<0;},load:function(t,e,i,n,s){return i=this.vertex1.load(t,e,i,n,s),i=this.vertex2.load(t,e,i,n,s),i=this.vertex3.load(t,e,i,n,s);},transformCoordinatesLocal:function(t,e,i,n){return this.vertex1.transformCoordinatesLocal(t,e,i,n),this.vertex2.transformCoordinatesLocal(t,e,i,n),this.vertex3.transformCoordinatesLocal(t,e,i,n),this;},updateBounds:function(){var t=this.vertex1,e=this.vertex2,i=this.vertex3,n=this.bounds;return n.x=Math.min(t.vx,e.vx,i.vx),n.y=Math.min(t.vy,e.vy,i.vy),n.width=Math.max(t.vx,e.vx,i.vx)-n.x,n.height=Math.max(t.vy,e.vy,i.vy)-n.y,this;},isInView:function(t,e,i,n,s,r,o,a,h,u,l){var c=this.vertex1.update(s,r,o,a,h,u,l,n),d=this.vertex2.update(s,r,o,a,h,u,l,n),f=this.vertex3.update(s,r,o,a,h,u,l,n);if(c.ta<=0&&d.ta<=0&&f.ta<=0)return!1;if(e&&!this.isCounterClockwise(i))return!1;var p=this.bounds;p.x=Math.min(c.tx,d.tx,f.tx),p.y=Math.min(c.ty,d.ty,f.ty),p.width=Math.max(c.tx,d.tx,f.tx)-p.x,p.height=Math.max(c.ty,d.ty,f.ty)-p.y;var g=t.x+t.width,v=t.y+t.height;return!(p.width<=0||p.height<=0||t.width<=0||t.height<=0)&&!(p.right<t.x||p.bottom<t.y||p.x>g||p.y>v);},translate:function(t,e){void 0===e&&(e=0);var i=this.vertex1,n=this.vertex2,s=this.vertex3;return i.x+=t,i.y+=e,n.x+=t,n.y+=e,s.x+=t,s.y+=e,this;},x:{get:function(){return this.getInCenter().x;},set:function(t){var e=this.getInCenter();this.translate(t-e.x,0);}},y:{get:function(){return this.getInCenter().y;},set:function(t){var e=this.getInCenter();this.translate(0,t-e.y);}},alpha:{get:function(){var t=this.vertex1,e=this.vertex2,i=this.vertex3;return(t.alpha+e.alpha+i.alpha)/3;},set:function(t){this.vertex1.alpha=t,this.vertex2.alpha=t,this.vertex3.alpha=t;}},depth:{get:function(){var t=this.vertex1,e=this.vertex2,i=this.vertex3;return(t.vz+e.vz+i.vz)/3;}},destroy:function(){this.vertex1=null,this.vertex2=null,this.vertex3=null;}});t.exports=o;},function(t,e,i){var n=i(0),r=i(12),l=i(39),s=new n({Extends:l,initialize:function(t,e,i,n,s,r,o,a,h,u){void 0===r&&(r=16777215),void 0===o&&(o=1),void 0===a&&(a=0),void 0===h&&(h=0),void 0===u&&(u=0),l.call(this,t,e,i),this.vx=0,this.vy=0,this.vz=0,this.nx=a,this.ny=h,this.nz=u,this.u=n,this.v=s,this.color=r,this.alpha=o,this.tx=0,this.ty=0,this.ta=0;},setUVs:function(t,e){return this.u=t,this.v=e,this;},transformCoordinatesLocal:function(t,e,i,n){var s=this.x,r=this.y,o=this.z,a=t.val,h=s*a[0]+r*a[4]+o*a[8]+a[12],u=s*a[1]+r*a[5]+o*a[9]+a[13],l=s*a[2]+r*a[6]+o*a[10]+a[14],c=s*a[3]+r*a[7]+o*a[11]+a[15];this.vx=h/c*e,this.vy=-u/c*i,this.vz=n<=0?l/c:-l/c;},update:function(t,e,i,n,s,r,o,a){var h=this.vx*t+this.vy*i+s,u=this.vx*e+this.vy*n+r;return o&&(h=Math.round(h),u=Math.round(u)),this.tx=h,this.ty=u,this.ta=this.alpha*a,this;},load:function(t,e,i,n,s){return t[++i]=this.tx,t[++i]=this.ty,t[++i]=this.u,t[++i]=this.v,t[++i]=n,t[++i]=s,e[++i]=r.getTintAppendFloatAlpha(this.color,this.ta),i;}});t.exports=s;},,function(t,e){t.exports=function(t,e,i){return 0<=t&&t<i.width&&0<=e&&e<i.height;};},function(t,e,i){var n=i(0),s=i(29),r=i(2),o=new n({initialize:function(t){void 0===t&&(t={}),this.name=r(t,"name","layer"),this.x=r(t,"x",0),this.y=r(t,"y",0),this.width=r(t,"width",0),this.height=r(t,"height",0),this.tileWidth=r(t,"tileWidth",0),this.tileHeight=r(t,"tileHeight",0),this.baseTileWidth=r(t,"baseTileWidth",this.tileWidth),this.baseTileHeight=r(t,"baseTileHeight",this.tileHeight),this.orientation=r(t,"orientation",s.ORTHOGONAL),this.widthInPixels=r(t,"widthInPixels",this.width*this.baseTileWidth),this.heightInPixels=r(t,"heightInPixels",this.height*this.baseTileHeight),this.alpha=r(t,"alpha",1),this.visible=r(t,"visible",!0),this.properties=r(t,"properties",[]),this.indexes=r(t,"indexes",[]),this.collideIndexes=r(t,"collideIndexes",[]),this.callbacks=r(t,"callbacks",[]),this.bodies=r(t,"bodies",[]),this.data=r(t,"data",[]),this.tilemapLayer=r(t,"tilemapLayer",null),this.hexSideLength=r(t,"hexSideLength",0);}});t.exports=o;},function(t,e,i){var n=i(0),s=i(29),r=i(2),o=new n({initialize:function(t){void 0===t&&(t={}),this.name=r(t,"name","map"),this.width=r(t,"width",0),this.height=r(t,"height",0),this.infinite=r(t,"infinite",!1),this.tileWidth=r(t,"tileWidth",0),this.tileHeight=r(t,"tileHeight",0),this.widthInPixels=r(t,"widthInPixels",this.width*this.tileWidth),this.heightInPixels=r(t,"heightInPixels",this.height*this.tileHeight),this.format=r(t,"format",null),this.orientation=r(t,"orientation",s.ORTHOGONAL),this.renderOrder=r(t,"renderOrder","right-down"),this.version=r(t,"version","1"),this.properties=r(t,"properties",{}),this.layers=r(t,"layers",[]),this.images=r(t,"images",[]),this.objects=r(t,"objects",{}),this.collision=r(t,"collision",{}),this.tilesets=r(t,"tilesets",[]),this.imageCollections=r(t,"imageCollections",[]),this.tiles=r(t,"tiles",[]),this.hexSideLength=r(t,"hexSideLength",0);}});t.exports=o;},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n,s,r,o,a){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===s&&(s=0),void 0===r&&(r=0),void 0===o&&(o={}),void 0===a&&(a={}),this.name=t,this.firstgid=e,this.tileWidth=i,this.tileHeight=n,this.tileMargin=s,this.tileSpacing=r,this.tileProperties=o,this.tileData=a,this.image=null,this.glTexture=null,this.rows=0,this.columns=0,this.total=0,this.texCoordinates=[];},getTileProperties:function(t){return this.containsTileIndex(t)?this.tileProperties[t-this.firstgid]:null;},getTileData:function(t){return this.containsTileIndex(t)?this.tileData[t-this.firstgid]:null;},getTileCollisionGroup:function(t){var e=this.getTileData(t);return e&&e.objectgroup?e.objectgroup:null;},containsTileIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total;},getTileTextureCoordinates:function(t){return this.containsTileIndex(t)?this.texCoordinates[t-this.firstgid]:null;},setImage:function(t){return this.image=t,this.glTexture=t.get().source.glTexture,this.updateTileData(this.image.source[0].width,this.image.source[0].height),this;},setTileSize:function(t,e){return void 0!==t&&(this.tileWidth=t),void 0!==e&&(this.tileHeight=e),this.image&&this.updateTileData(this.image.source[0].width,this.image.source[0].height),this;},setSpacing:function(t,e){return void 0!==t&&(this.tileMargin=t),void 0!==e&&(this.tileSpacing=e),this.image&&this.updateTileData(this.image.source[0].width,this.image.source[0].height),this;},updateTileData:function(t,e){var i=(e-2*this.tileMargin+this.tileSpacing)/(this.tileHeight+this.tileSpacing),n=(t-2*this.tileMargin+this.tileSpacing)/(this.tileWidth+this.tileSpacing);i%1==0&&n%1==0||console.warn("Image tile area not tile size multiple in: "+this.name),i=Math.floor(i),n=Math.floor(n),this.rows=i,this.columns=n,this.total=i*n,this.texCoordinates.length=0;for(var s=this.tileMargin,r=this.tileMargin,o=0;o<this.rows;o++){for(var a=0;a<this.columns;a++)this.texCoordinates.push({x:s,y:r}),s+=this.tileWidth+this.tileSpacing;s=this.tileMargin,r+=this.tileHeight+this.tileSpacing;}return this;}});t.exports=n;},function(t,e){t.exports={TOP_LEFT:0,TOP_CENTER:1,TOP_RIGHT:2,LEFT_TOP:3,LEFT_CENTER:4,LEFT_BOTTOM:5,CENTER:6,RIGHT_TOP:7,RIGHT_CENTER:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM_CENTER:11,BOTTOM_RIGHT:12};},function(t,e){t.exports=function(t,e,i){return void 0===i&&(i=1e-4),Math.abs(t-e)<i;};},function(t,e,i){var n=i(0),s=i(11),r=i(15),o=i(1068),a=new n({Extends:r,Mixins:[s.Alpha,s.BlendMode,s.Depth,s.Flip,s.GetBounds,s.Mask,s.Origin,s.Pipeline,s.ScrollFactor,s.Size,s.TextureCrop,s.Tint,s.Transform,s.Visible,o],initialize:function(t,e,i,n,s){r.call(this,t,"Image"),this._crop=this.resetCropObject(),this.setTexture(n,s),this.setPosition(e,i),this.setSizeToFrame(),this.setOriginFromFrame(),this.initPipeline();}});t.exports=a;},function(t,e){t.exports=function(t,e){return t.hasOwnProperty(e);};},function(t,e,i){var s=i(77);t.exports=function(t,e){var i=s(t);for(var n in e)i.hasOwnProperty(n)||(i[n]=e[n]);return i;};},,function(t,e,i){var r=i(35),n=i(65),s=i(66),o=i(0),a=i(11),h=i(15),u=i(10),l=i(57),c=new o({Extends:h,Mixins:[a.Depth,a.GetBounds,a.Origin,a.Transform,a.ScrollFactor,a.Visible],initialize:function(t,e,i,n,s){void 0===n&&(n=1),void 0===s&&(s=n),h.call(this,t,"Zone"),this.setPosition(e,i),this.width=n,this.height=s,this.blendMode=r.NORMAL,this.updateDisplayOrigin();},displayWidth:{get:function(){return this.scaleX*this.width;},set:function(t){this.scaleX=t/this.width;}},displayHeight:{get:function(){return this.scaleY*this.height;},set:function(t){this.scaleY=t/this.height;}},setSize:function(t,e,i){void 0===i&&(i=!0),this.width=t,this.height=e,this.updateDisplayOrigin();var n=this.input;return i&&n&&!n.customHitArea&&(n.hitArea.width=t,n.hitArea.height=e),this;},setDisplaySize:function(t,e){return this.displayWidth=t,this.displayHeight=e,this;},setCircleDropZone:function(t){return this.setDropZone(new n(0,0,t),s);},setRectangleDropZone:function(t,e){return this.setDropZone(new u(0,0,t,e),l);},setDropZone:function(t,e){return void 0===t?this.setRectangleDropZone(this.width,this.height):this.input||this.setInteractive(t,e,!0),this;},setAlpha:function(){},setBlendMode:function(){},renderCanvas:function(t,e,i){i.addToRenderList(e);},renderWebGL:function(t,e,i){i.addToRenderList(e);}});t.exports=c;},function(t,e){t.exports=function(t){return 2*(t.width+t.height);};},function(t,e){t.exports=function(t){for(var e=t.length-1;0<e;e--){var i=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[i],t[i]=n;}return t;};},function(t,e,i){t.exports={ADD_ANIMATION:i(724),ANIMATION_COMPLETE:i(725),ANIMATION_COMPLETE_KEY:i(726),ANIMATION_REPEAT:i(727),ANIMATION_RESTART:i(728),ANIMATION_START:i(729),ANIMATION_STOP:i(730),ANIMATION_UPDATE:i(731),PAUSE_ALL:i(732),REMOVE_ANIMATION:i(733),RESUME_ALL:i(734)};},function(t,e,i){var n=i(0),s=i(11),r=i(36),o=i(9),a=i(37),h=i(10),u=i(25),l=i(187),A=i(3),c=new n({Extends:o,Mixins:[s.Alpha,s.Visible],initialize:function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),o.call(this),this.scene,this.sceneManager,this.scaleManager,this.cameraManager,this.id=0,this.name="",this.roundPixels=!1,this.useBounds=!1,this.worldView=new h(),this.dirty=!0,this._x=t,this._y=e,this._width=i,this._height=n,this._bounds=new h(),this._scrollX=0,this._scrollY=0,this._zoomX=1,this._zoomY=1,this._rotation=0,this.matrix=new u(),this.transparent=!0,this.backgroundColor=l("rgba(0,0,0,0)"),this.disableCull=!1,this.culledObjects=[],this.midPoint=new A(i/2,n/2),this.originX=.5,this.originY=.5,this._customViewport=!1,this.mask=null,this._maskCamera=null,this.renderList=[];},addToRenderList:function(t){this.renderList.push(t);},setOrigin:function(t,e){return void 0===t&&(t=.5),void 0===e&&(e=t),this.originX=t,this.originY=e,this;},getScroll:function(t,e,i){void 0===i&&(i=new A());var n=.5*this.width,s=.5*this.height;return i.x=t-n,i.y=e-s,this.useBounds&&(i.x=this.clampX(i.x),i.y=this.clampY(i.y)),i;},centerOnX:function(t){var e=.5*this.width;return this.midPoint.x=t,this.scrollX=t-e,this.useBounds&&(this.scrollX=this.clampX(this.scrollX)),this;},centerOnY:function(t){var e=.5*this.height;return this.midPoint.y=t,this.scrollY=t-e,this.useBounds&&(this.scrollY=this.clampY(this.scrollY)),this;},centerOn:function(t,e){return this.centerOnX(t),this.centerOnY(e),this;},centerToBounds:function(){var t,e,i;return this.useBounds&&(t=this._bounds,e=.5*this.width,i=.5*this.height,this.midPoint.set(t.centerX,t.centerY),this.scrollX=t.centerX-e,this.scrollY=t.centerY-i),this;},centerToSize:function(){return this.scrollX=.5*this.width,this.scrollY=.5*this.height,this;},cull:function(t){if(this.disableCull)return t;var e=this.matrix.matrix,i=e[0],n=e[1],s=e[2],r=e[3];if(!(i*r-n*s))return t;for(var o=e[4],a=e[5],h=this.scrollX,u=this.scrollY,l=this.width,c=this.height,d=this.y,f=d+c,p=this.x,g=p+l,v=this.culledObjects,m=t.length,y=v.length=0;y<m;++y){var x,T,w,E,b=t[y];b.hasOwnProperty("width")&&!b.parentContainer?(x=b.width,T=b.height,p<((w=b.x-h*b.scrollFactorX-x*b.originX)+x)*i+((E=b.y-u*b.scrollFactorY-T*b.originY)+T)*s+o&&w*i+E*s+o<g&&d<(w+x)*n+(E+T)*r+a&&w*n+E*r+a<f&&v.push(b)):v.push(b);}return v;},getWorldPoint:function(t,e,i){void 0===i&&(i=new A());var n=this.matrix.matrix,s=n[0],r=n[1],o=n[2],a=n[3],h=n[4],u=n[5],l=s*a-r*o;if(!l)return i.x=t,i.y=e,i;var c=a*(l=1/l),d=-r*l,f=-o*l,p=s*l,g=(o*u-a*h)*l,v=(r*h-s*u)*l,m=Math.cos(this.rotation),y=Math.sin(this.rotation),x=this.zoomX,T=this.zoomY,w=this.scrollX,E=this.scrollY,b=t+(w*m-E*y)*x,S=e+(w*y+E*m)*T;return i.x=b*c+S*f+g,i.y=b*d+S*p+v,i;},ignore:function(t){var e=this.id;Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var n=t[i];Array.isArray(n)?this.ignore(n):n.isParent?this.ignore(n.getChildren()):n.cameraFilter|=e;}return this;},preRender:function(){this.renderList.length=0;var t=this.width,e=this.height,i=.5*t,n=.5*e,s=this.zoomX,r=this.zoomY,o=this.matrix,a=t*this.originX,h=e*this.originY,u=this.scrollX,l=this.scrollY;this.useBounds&&(u=this.clampX(u),l=this.clampY(l)),this.roundPixels&&(a=Math.round(a),h=Math.round(h));var c=(this.scrollX=u)+i,d=(this.scrollY=l)+n;this.midPoint.set(c,d);var f=t/s,p=e/r;this.worldView.setTo(c-f/2,d-p/2,f,p),o.applyITRS(this.x+a,this.y+h,this.rotation,s,r),o.translate(-a,-h);},clampX:function(t){var e=this._bounds,i=this.displayWidth,n=e.x+(i-this.width)/2,s=Math.max(n,n+e.width-i);return t<n?t=n:s<t&&(t=s),t;},clampY:function(t){var e=this._bounds,i=this.displayHeight,n=e.y+(i-this.height)/2,s=Math.max(n,n+e.height-i);return t<n?t=n:s<t&&(t=s),t;},removeBounds:function(){return this.useBounds=!1,this.dirty=!0,this._bounds.setEmpty(),this;},setAngle:function(t){return void 0===t&&(t=0),this.rotation=r(t),this;},setBackgroundColor:function(t){return void 0===t&&(t="rgba(0,0,0,0)"),this.backgroundColor=l(t),this.transparent=0===this.backgroundColor.alpha,this;},setBounds:function(t,e,i,n,s){return void 0===s&&(s=!1),this._bounds.setTo(t,e,i,n),this.dirty=!0,this.useBounds=!0,s?this.centerToBounds():(this.scrollX=this.clampX(this.scrollX),this.scrollY=this.clampY(this.scrollY)),this;},getBounds:function(t){void 0===t&&(t=new h());var e=this._bounds;return t.setTo(e.x,e.y,e.width,e.height),t;},setName:function(t){return void 0===t&&(t=""),this.name=t,this;},setPosition:function(t,e){return void 0===e&&(e=t),this.x=t,this.y=e,this;},setRotation:function(t){return void 0===t&&(t=0),this.rotation=t,this;},setRoundPixels:function(t){return this.roundPixels=t,this;},setScene:function(t){this.scene&&this._customViewport&&this.sceneManager.customViewports--;var e=(this.scene=t).sys;return this.sceneManager=e.game.scene,this.scaleManager=e.scale,this.cameraManager=e.cameras,this.updateSystem(),this;},setScroll:function(t,e){return void 0===e&&(e=t),this.scrollX=t,this.scrollY=e,this;},setSize:function(t,e){return void 0===e&&(e=t),this.width=t,this.height=e,this;},setViewport:function(t,e,i,n){return this.x=t,this.y=e,this.width=i,this.height=n,this;},setZoom:function(t,e){return void 0===t&&(t=1),void 0===e&&(e=t),0===t&&(t=.001),0===e&&(e=.001),this.zoomX=t,this.zoomY=e,this;},setMask:function(t,e){return void 0===e&&(e=!0),this.mask=t,this._maskCamera=e?this.cameraManager.default:this,this;},clearMask:function(t){return void 0===t&&(t=!1),t&&this.mask&&this.mask.destroy(),this.mask=null,this;},toJSON:function(){var t={name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,zoom:this.zoom,rotation:this.rotation,roundPixels:this.roundPixels,scrollX:this.scrollX,scrollY:this.scrollY,backgroundColor:this.backgroundColor.rgba};return this.useBounds&&(t.bounds={x:this._bounds.x,y:this._bounds.y,width:this._bounds.width,height:this._bounds.height}),t;},update:function(){},updateSystem:function(){var t,e;this.scaleManager&&(t=0!==this._x||0!==this._y||this.scaleManager.width!==this._width||this.scaleManager.height!==this._height,e=this.sceneManager,t&&!this._customViewport?e.customViewports++:!t&&this._customViewport&&e.customViewports--,this.dirty=!0,this._customViewport=t);},destroy:function(){this.emit(a.DESTROY,this),this.removeAllListeners(),this.matrix.destroy(),this.culledObjects=[],this._customViewport&&this.sceneManager.customViewports--,this.renderList=[],this._bounds=null,this.scene=null,this.scaleManager=null,this.sceneManager=null,this.cameraManager=null;},x:{get:function(){return this._x;},set:function(t){this._x=t,this.updateSystem();}},y:{get:function(){return this._y;},set:function(t){this._y=t,this.updateSystem();}},width:{get:function(){return this._width;},set:function(t){this._width=t,this.updateSystem();}},height:{get:function(){return this._height;},set:function(t){this._height=t,this.updateSystem();}},scrollX:{get:function(){return this._scrollX;},set:function(t){this._scrollX=t,this.dirty=!0;}},scrollY:{get:function(){return this._scrollY;},set:function(t){this._scrollY=t,this.dirty=!0;}},zoom:{get:function(){return(this._zoomX+this._zoomY)/2;},set:function(t){this._zoomX=t,this._zoomY=t,this.dirty=!0;}},zoomX:{get:function(){return this._zoomX;},set:function(t){this._zoomX=t,this.dirty=!0;}},zoomY:{get:function(){return this._zoomY;},set:function(t){this._zoomY=t,this.dirty=!0;}},rotation:{get:function(){return this._rotation;},set:function(t){this._rotation=t,this.dirty=!0;}},centerX:{get:function(){return this.x+.5*this.width;}},centerY:{get:function(){return this.y+.5*this.height;}},displayWidth:{get:function(){return this.width/this.zoomX;}},displayHeight:{get:function(){return this.height/this.zoomY;}}});t.exports=c;},function(t,e,i){var n=i(334),s=i(335),r=i(336),o=i(337),a=i(338),h=i(339),u=i(340),l=i(341),c=i(342),d=i(343),f=i(344),p=i(345);t.exports={Power0:u,Power1:l.Out,Power2:o.Out,Power3:c.Out,Power4:d.Out,Linear:u,Quad:l.Out,Cubic:o.Out,Quart:c.Out,Quint:d.Out,Sine:f.Out,Expo:h.Out,Circ:r.Out,Elastic:a.Out,Back:n.Out,Bounce:s.Out,Stepped:p,"Quad.easeIn":l.In,"Cubic.easeIn":o.In,"Quart.easeIn":c.In,"Quint.easeIn":d.In,"Sine.easeIn":f.In,"Expo.easeIn":h.In,"Circ.easeIn":r.In,"Elastic.easeIn":a.In,"Back.easeIn":n.In,"Bounce.easeIn":s.In,"Quad.easeOut":l.Out,"Cubic.easeOut":o.Out,"Quart.easeOut":c.Out,"Quint.easeOut":d.Out,"Sine.easeOut":f.Out,"Expo.easeOut":h.Out,"Circ.easeOut":r.Out,"Elastic.easeOut":a.Out,"Back.easeOut":n.Out,"Bounce.easeOut":s.Out,"Quad.easeInOut":l.InOut,"Cubic.easeInOut":o.InOut,"Quart.easeInOut":c.InOut,"Quint.easeInOut":d.InOut,"Sine.easeInOut":f.InOut,"Expo.easeInOut":h.InOut,"Circ.easeInOut":r.InOut,"Elastic.easeInOut":a.InOut,"Back.easeInOut":n.InOut,"Bounce.easeInOut":s.InOut};},function(t,e){t.exports=function(t,e,i){return(e-t)*i+t;};},function(t,e,i){var n,s=i(105),r={chrome:!1,chromeVersion:0,edge:!1,firefox:!1,firefoxVersion:0,ie:!1,ieVersion:0,mobileSafari:!1,opera:!1,safari:!1,safariVersion:0,silk:!1,trident:!1,tridentVersion:0};t.exports=(n=navigator.userAgent,/Edge\/\d+/.test(n)?r.edge=!0:/Chrome\/(\d+)/.test(n)&&!s.windowsPhone?(r.chrome=!0,r.chromeVersion=parseInt(RegExp.$1,10)):/Firefox\D+(\d+)/.test(n)?(r.firefox=!0,r.firefoxVersion=parseInt(RegExp.$1,10)):/AppleWebKit/.test(n)&&s.iOS?r.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(n)?(r.ie=!0,r.ieVersion=parseInt(RegExp.$1,10)):/Opera/.test(n)?r.opera=!0:/Safari/.test(n)&&!s.windowsPhone?r.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(n)&&(r.ie=!0,r.trident=!0,r.tridentVersion=parseInt(RegExp.$1,10),r.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(n)&&(r.silk=!0),r);},function(t,e){t.exports=function(t,e){return Math.random()*(e-t)+t;};},function(t,e){t.exports=function(t,e){return 0<t&&0==(t&t-1)&&0<e&&0==(e&e-1);};},function(t,e){t.exports=function(t,e,i,n){return void 0===i&&(i=0),0===e?t:(t-=i,t=e*Math.ceil(t/e),n?(i+t)/e:i+t);};},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n){this.x=0,this.y=0,this.z=0,this.w=0,"object"==typeof t?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.w=t.w||0):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0);},clone:function(){return new n(this.x,this.y,this.z,this.w);},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z||0,this.w=t.w||0,this;},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w;},set:function(t,e,i,n){return"object"==typeof t?(this.x=t.x||0,this.y=t.y||0,this.z=t.z||0,this.w=t.w||0):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0),this;},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z||0,this.w+=t.w||0,this;},subtract:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z||0,this.w-=t.w||0,this;},scale:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this;},length:function(){var t=this.x,e=this.y,i=this.z,n=this.w;return Math.sqrt(t*t+e*e+i*i+n*n);},lengthSq:function(){var t=this.x,e=this.y,i=this.z,n=this.w;return t*t+e*e+i*i+n*n;},normalize:function(){var t=this.x,e=this.y,i=this.z,n=this.w,s=t*t+e*e+i*i+n*n;return 0<s&&(s=1/Math.sqrt(s),this.x=t*s,this.y=e*s,this.z=i*s,this.w=n*s),this;},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;},lerp:function(t,e){void 0===e&&(e=0);var i=this.x,n=this.y,s=this.z,r=this.w;return this.x=i+e*(t.x-i),this.y=n+e*(t.y-n),this.z=s+e*(t.z-s),this.w=r+e*(t.w-r),this;},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z||1,this.w*=t.w||1,this;},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z||1,this.w/=t.w||1,this;},distance:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z||0,s=t.w-this.w||0;return Math.sqrt(e*e+i*i+n*n+s*s);},distanceSq:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z||0,s=t.w-this.w||0;return e*e+i*i+n*n+s*s;},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this;},transformMat4:function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.val;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this;},transformQuat:function(t){var e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z,a=t.w,h=a*e+r*n-o*i,u=a*i+o*e-s*n,l=a*n+s*i-r*e,c=-s*e-r*i-o*n;return this.x=h*a+c*-s+u*-o-l*-r,this.y=u*a+c*-r+l*-s-h*-o,this.z=l*a+c*-o+h*-r-u*-s,this;},reset:function(){return this.x=0,this.y=0,this.z=0,this.w=0,this;}});n.prototype.sub=n.prototype.subtract,n.prototype.mul=n.prototype.multiply,n.prototype.div=n.prototype.divide,n.prototype.dist=n.prototype.distance,n.prototype.distSq=n.prototype.distanceSq,n.prototype.len=n.prototype.length,n.prototype.lenSq=n.prototype.lengthSq,t.exports=n;},function(t,e,i){var n=i(0),s=i(91),r=new n({initialize:function(t,e,i,n,s,r,o){void 0===n&&(n=1),void 0===s&&(s=0),void 0===r&&(r=!0),void 0===o&&(o=!1),this.renderer=t,this.framebuffer=null,this.texture=null,this.width=0,this.height=0,this.scale=n,this.minFilter=s,this.autoClear=r,this.autoResize=!1,this.resize(e,i),o&&this.setAutoResize(!0);},setAutoResize:function(t){return t&&!this.autoResize?(this.renderer.on(s.RESIZE,this.resize,this),this.autoResize=!0):!t&&this.autoResize&&(this.renderer.off(s.RESIZE,this.resize,this),this.autoResize=!1),this;},resize:function(t,e){var i,n=t*this.scale,s=e*this.scale;return n===this.width&&s===this.height||((i=this.renderer).deleteFramebuffer(this.framebuffer),i.deleteTexture(this.texture),t*=this.scale,e*=this.scale,(t=Math.round(t))<=0&&(t=1),(e=Math.round(e))<=0&&(e=1),this.texture=i.createTextureFromSource(null,t,e,this.minFilter),this.framebuffer=i.createFramebuffer(t,e,this.texture,!1),this.width=t,this.height=e),this;},bind:function(t,e,i){var n;void 0===t&&(t=!1),t&&this.renderer.flush(),e&&i&&this.resize(e,i),this.renderer.pushFramebuffer(this.framebuffer,!1,!1,!1),t&&this.adjustViewport(),this.autoClear&&((n=this.renderer.gl).clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT));},adjustViewport:function(){var t=this.renderer.gl;t.viewport(0,0,this.width,this.height),t.disable(t.SCISSOR_TEST);},clear:function(){var t=this.renderer,e=t.gl;t.pushFramebuffer(this.framebuffer),e.disable(e.SCISSOR_TEST),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),t.popFramebuffer(),t.resetScissor();},unbind:function(t){void 0===t&&(t=!1);var e=this.renderer;return t&&e.flush(),e.popFramebuffer();},destroy:function(){var t=this.renderer;t.deleteFramebuffer(this.framebuffer),t.deleteTexture(this.texture),t.off(s.RESIZE,this.resize,this),this.renderer=null,this.framebuffer=null,this.texture=null;}});t.exports=r;},function(t,e){t.exports=function(t,e){var i;if(e)"string"==typeof e?i=document.getElementById(e):"object"==typeof e&&1===e.nodeType&&(i=e);else if(t.parentElement||null===e)return t;return(i=i||document.body).appendChild(t),t;};},function(t,e){t.exports={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,NUMPAD_ZERO:96,NUMPAD_ONE:97,NUMPAD_TWO:98,NUMPAD_THREE:99,NUMPAD_FOUR:100,NUMPAD_FIVE:101,NUMPAD_SIX:102,NUMPAD_SEVEN:103,NUMPAD_EIGHT:104,NUMPAD_NINE:105,NUMPAD_ADD:107,NUMPAD_SUBTRACT:109,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWARD_SLASH:191,BACK_SLASH:220,QUOTES:222,BACKTICK:192,OPEN_BRACKET:219,CLOSED_BRACKET:221,SEMICOLON_FIREFOX:59,COLON:58,COMMA_FIREFOX_WINDOWS:60,COMMA_FIREFOX:62,BRACKET_RIGHT_FIREFOX:174,BRACKET_LEFT_FIREFOX:175};},function(t,e){t.exports={PENDING:0,INIT:1,START:2,LOADING:3,CREATING:4,RUNNING:5,PAUSED:6,SLEEPING:7,SHUTDOWN:8,DESTROYED:9};},function(t,e,i){var n=i(0),o=i(77),s=i(9),r=i(70),a=i(22),h=i(1),u=i(207),l=i(428),c=new n({Extends:s,initialize:function(t){s.call(this),this.game=t,this.jsonCache=t.cache.json,this.sounds=[],this.mute=!1,this.volume=1,this.pauseOnBlur=!0,this._rate=1,this._detune=0,this.locked=this.locked||!1,this.unlocked=!1,t.events.on(a.BLUR,this.onGameBlur,this),t.events.on(a.FOCUS,this.onGameFocus,this),t.events.on(a.PRE_STEP,this.update,this),t.events.once(a.DESTROY,this.destroy,this);},add:h,addAudioSprite:function(t,e){void 0===e&&(e={});var i,n,s=this.add(t,e);for(var r in s.spritemap=this.jsonCache.get(t).spritemap,s.spritemap){s.spritemap.hasOwnProperty(r)&&(i=o(e),n=s.spritemap[r],i.loop=!!n.hasOwnProperty("loop")&&n.loop,s.addMarker({name:r,start:n.start,duration:n.end-n.start,config:i}));}return s;},get:function(t){return l(this.sounds,"key",t);},getAll:function(t){return u(this.sounds,"key",t);},play:function(t,e){var i=this.add(t);return i.once(r.COMPLETE,i.destroy,i),e?e.name?(i.addMarker(e),i.play(e.name)):i.play(e):i.play();},playAudioSprite:function(t,e,i){var n=this.addAudioSprite(t);return n.once(r.COMPLETE,n.destroy,n),n.play(e,i);},remove:function(t){var e=this.sounds.indexOf(t);return-1!==e&&(t.destroy(),this.sounds.splice(e,1),!0);},removeAll:function(){this.sounds.forEach(function(t){t.destroy();}),this.sounds.length=0;},removeByKey:function(t){for(var e=0,i=this.sounds.length-1;0<=i;i--){var n=this.sounds[i];n.key===t&&(n.destroy(),this.sounds.splice(i,1),e++);}return e;},pauseAll:function(){this.forEachActiveSound(function(t){t.pause();}),this.emit(r.PAUSE_ALL,this);},resumeAll:function(){this.forEachActiveSound(function(t){t.resume();}),this.emit(r.RESUME_ALL,this);},stopAll:function(){this.forEachActiveSound(function(t){t.stop();}),this.emit(r.STOP_ALL,this);},stopByKey:function(t){var e=0;return this.getAll(t).forEach(function(t){t.stop()&&e++;}),e;},unlock:h,onBlur:h,onFocus:h,onGameBlur:function(){this.pauseOnBlur&&this.onBlur();},onGameFocus:function(){this.pauseOnBlur&&this.onFocus();},update:function(e,i){this.unlocked&&(this.unlocked=!1,this.locked=!1,this.emit(r.UNLOCKED,this));for(var t=this.sounds.length-1;0<=t;t--)this.sounds[t].pendingRemove&&this.sounds.splice(t,1);this.sounds.forEach(function(t){t.update(e,i);});},destroy:function(){this.game.events.off(a.BLUR,this.onGameBlur,this),this.game.events.off(a.FOCUS,this.onGameFocus,this),this.game.events.off(a.PRE_STEP,this.update,this),this.removeAllListeners(),this.removeAll(),this.sounds.length=0,this.sounds=null,this.game=null;},forEachActiveSound:function(i,n){var s=this;this.sounds.forEach(function(t,e){t&&!t.pendingRemove&&i.call(n||s,t,e,s.sounds);});},setRate:function(t){return this.rate=t,this;},rate:{get:function(){return this._rate;},set:function(t){this._rate=t,this.forEachActiveSound(function(t){t.calculateRate();}),this.emit(r.GLOBAL_RATE,this,t);}},setDetune:function(t){return this.detune=t,this;},detune:{get:function(){return this._detune;},set:function(t){this._detune=t,this.forEachActiveSound(function(t){t.calculateRate();}),this.emit(r.GLOBAL_DETUNE,this,t);}}});t.exports=c;},function(t,e,i){var n=i(0),s=i(9),r=i(70),o=i(17),a=i(1),h=new n({Extends:s,initialize:function(t,e,i){s.call(this),this.manager=t,this.key=e,this.isPlaying=!1,this.isPaused=!1,this.totalRate=1,this.duration=this.duration||0,this.totalDuration=this.totalDuration||0,this.config={mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!1,delay:0,pan:0},this.currentConfig=this.config,this.config=o(this.config,i),this.markers={},this.currentMarker=null,this.pendingRemove=!1;},addMarker:function(t){return!(!t||!t.name||"string"!=typeof t.name)&&(this.markers[t.name]?(console.error("addMarker "+t.name+" already exists in Sound"),!1):(t=o(!0,{name:"",start:0,duration:this.totalDuration-(t.start||0),config:{mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!1,delay:0,pan:0}},t),this.markers[t.name]=t,!0));},updateMarker:function(t){return!(!t||!t.name||"string"!=typeof t.name)&&(this.markers[t.name]?(this.markers[t.name]=o(!0,this.markers[t.name],t),!0):(console.warn("Audio Marker: "+t.name+" missing in Sound: "+this.key),!1));},removeMarker:function(t){var e=this.markers[t];return e?(this.markers[t]=null,e):null;},play:function(t,e){if(void 0===t&&(t=""),"object"==typeof t&&(e=t,t=""),"string"!=typeof t)return!1;if(t){if(!this.markers[t])return console.warn("Marker: "+t+" missing in Sound: "+this.key),!1;this.currentMarker=this.markers[t],this.currentConfig=this.currentMarker.config,this.duration=this.currentMarker.duration;}else this.currentMarker=null,this.currentConfig=this.config,this.duration=this.totalDuration;return this.resetConfig(),this.currentConfig=o(this.currentConfig,e),this.isPlaying=!0,!(this.isPaused=!1);},pause:function(){return!(this.isPaused||!this.isPlaying)&&(this.isPlaying=!1,this.isPaused=!0);},resume:function(){return!(!this.isPaused||this.isPlaying)&&(this.isPlaying=!0,!(this.isPaused=!1));},stop:function(){return!(!this.isPaused&&!this.isPlaying)&&(this.isPlaying=!1,this.isPaused=!1,this.resetConfig(),!0);},applyConfig:function(){this.mute=this.currentConfig.mute,this.volume=this.currentConfig.volume,this.rate=this.currentConfig.rate,this.detune=this.currentConfig.detune,this.loop=this.currentConfig.loop,this.pan=this.currentConfig.pan;},resetConfig:function(){this.currentConfig.seek=0,this.currentConfig.delay=0;},update:a,calculateRate:function(){var t=this.currentConfig.detune+this.manager.detune,e=Math.pow(1.0005777895065548,t);this.totalRate=this.currentConfig.rate*this.manager.rate*e;},destroy:function(){this.pendingRemove||(this.emit(r.DESTROY,this),this.pendingRemove=!0,this.manager=null,this.key="",this.removeAllListeners(),this.isPlaying=!1,this.isPaused=!1,this.config=null,this.currentConfig=null,this.markers=null,this.currentMarker=null);}});t.exports=h;},function(t,e,i){var n=i(209),s=i(435);t.exports=function(t,e){if(void 0===e&&(e=90),!n(t))return null;if("string"!=typeof e&&(e=(e%360+360)%360),90===e||-270===e||"rotateLeft"===e)(t=s(t)).reverse();else if(-90===e||270===e||"rotateRight"===e)t.reverse(),t=s(t);else if(180===Math.abs(e)||"rotate180"===e){for(var i=0;i<t.length;i++)t[i].reverse();t.reverse();}return t;};},function(t,e,i){var n=i(0),f=i(18),s=i(11),h=i(15),u=i(1043),r=i(1044),o=i(212),l=i(10),a=i(1045),c=new n({Extends:h,Mixins:[s.Alpha,s.BlendMode,s.Depth,s.Mask,s.Origin,s.Pipeline,s.ScrollFactor,s.Texture,s.Tint,s.Transform,s.Visible,a],initialize:function(t,e,i,n,s,r,o){void 0===s&&(s=""),void 0===o&&(o=0),h.call(this,t,"BitmapText"),this.font=n;var a=this.scene.sys.cache.bitmapFont.get(n);a||console.warn("Invalid BitmapText key: "+n),this.fontData=a.data,this._text="",this._fontSize=r||this.fontData.size,this._letterSpacing=0,this._align=o,this._bounds=u(),this._dirty=!0,this._maxWidth=0,this.wordWrapCharCode=32,this.charColors=[],this.dropShadowX=0,this.dropShadowY=0,this.dropShadowColor=0,this.dropShadowAlpha=.5,this.fromAtlas=a.fromAtlas,this.setTexture(a.texture,a.frame),this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.setText(s);},setLeftAlign:function(){return this._align=c.ALIGN_LEFT,this._dirty=!0,this;},setCenterAlign:function(){return this._align=c.ALIGN_CENTER,this._dirty=!0,this;},setRightAlign:function(){return this._align=c.ALIGN_RIGHT,this._dirty=!0,this;},setFontSize:function(t){return this._fontSize=t,this._dirty=!0,this;},setLetterSpacing:function(t){return void 0===t&&(t=0),this._letterSpacing=t,this._dirty=!0,this;},setText:function(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this.text&&(this._text=t.toString(),this._dirty=!0,this.updateDisplayOrigin()),this;},setDropShadow:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=.5),this.dropShadowX=t,this.dropShadowY=e,this.dropShadowColor=i,this.dropShadowAlpha=n,this;},setCharacterTint:function(t,e,i,n,s,r,o){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=!1),void 0===n&&(n=-1),void 0===s&&(o=r=s=n);var a=this.text.length;-1===e&&(e=a),t<0&&(t=a+t),t=f(t,0,a-1);for(var h=f(t+e,t,a),u=this.charColors,l=t;l<h;l++){var c,d=u[l];-1===n?u[l]=null:(c=i?1:0,d?(d.tintEffect=c,d.tintTL=n,d.tintTR=s,d.tintBL=r,d.tintBR=o):u[l]={tintEffect:c,tintTL:n,tintTR:s,tintBL:r,tintBR:o});}return this;},setWordTint:function(t,e,i,n,s,r,o){void 0===e&&(e=1);for(var a=this.getTextBounds().words,h="number"==typeof t,u=0,l=0;l<a.length;l++){var c=a[l];if((h&&l===t||!h&&c.word===t)&&(this.setCharacterTint(c.i,c.word.length,i,n,s,r,o),++u===e))return this;}return this;},getTextBounds:function(t){var e=this._bounds;return(this._dirty||t||this.scaleX!==e.scaleX||this.scaleY!==e.scaleY)&&(u(this,t,!0,e),this._dirty=!1),e;},getCharacterAt:function(t,e,i){for(var n=this.getLocalPoint(t,e,null,i),s=this.getTextBounds().characters,r=new l(),o=0;o<s.length;o++){var a=s[o];if(r.setTo(a.x,a.t,a.r-a.x,a.b),r.contains(n.x,n.y))return a;}return null;},updateDisplayOrigin:function(){return this._dirty=!0,this.getTextBounds(!1),this;},setFont:function(t,e,i){var n;return void 0===e&&(e=this._fontSize),void 0===i&&(i=this._align),t===this.font||(n=this.scene.sys.cache.bitmapFont.get(t))&&(this.font=t,this.fontData=n.data,this._fontSize=e,this._align=i,this.fromAtlas=!0===n.fromAtlas,this.setTexture(n.texture,n.frame),u(this,!1,!0,this._bounds)),this;},setMaxWidth:function(t,e){return this._maxWidth=t,this._dirty=!0,void 0!==e&&(this.wordWrapCharCode=e),this;},align:{set:function(t){this._align=t,this._dirty=!0;},get:function(){return this._align;}},text:{set:function(t){this.setText(t);},get:function(){return this._text;}},fontSize:{set:function(t){this._fontSize=t,this._dirty=!0;},get:function(){return this._fontSize;}},letterSpacing:{set:function(t){this._letterSpacing=t,this._dirty=!0;},get:function(){return this._letterSpacing;}},maxWidth:{set:function(t){this._maxWidth=t,this._dirty=!0;},get:function(){return this._maxWidth;}},width:{get:function(){return this.getTextBounds(!1),this._bounds.global.width;}},height:{get:function(){return this.getTextBounds(!1),this._bounds.global.height;}},toJSON:function(){var t=s.ToJSON(this),e={font:this.font,text:this.text,fontSize:this.fontSize,letterSpacing:this.letterSpacing,align:this.align};return t.data=e,t;},preDestroy:function(){this.charColors.length=0,this._bounds=null,this.fontData=null;}});c.ALIGN_LEFT=0,c.ALIGN_CENTER=1,c.ALIGN_RIGHT=2,c.ParseFromAtlas=r,c.ParseXMLBitmapFont=o,t.exports=c;},function(t,e,i){var n=new(i(0))({initialize:function(t){if(this.entries=[],Array.isArray(t))for(var e=0;e<t.length;e++)this.set(t[e]);},set:function(t){return-1===this.entries.indexOf(t)&&this.entries.push(t),this;},get:function(t,e){for(var i=0;i<this.entries.length;i++){var n=this.entries[i];if(n[t]===e)return n;}},getArray:function(){return this.entries.slice(0);},delete:function(t){var e=this.entries.indexOf(t);return-1<e&&this.entries.splice(e,1),this;},dump:function(){console.group("Set");for(var t=0;t<this.entries.length;t++){var e=this.entries[t];console.log(e);}console.groupEnd();},each:function(t,e){var i,n=this.entries.slice(),s=n.length;if(e)for(i=0;i<s&&!1!==t.call(e,n[i],i);i++);else for(i=0;i<s&&!1!==t(n[i],i);i++);return this;},iterate:function(t,e){var i,n=this.entries.length;if(e)for(i=0;i<n&&!1!==t.call(e,this.entries[i],i);i++);else for(i=0;i<n&&!1!==t(this.entries[i],i);i++);return this;},iterateLocal:function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n=this.entries.length;for(i=0;i<n;i++){var s=this.entries[i];s[t].apply(s,e);}return this;},clear:function(){return this.entries.length=0,this;},contains:function(t){return-1<this.entries.indexOf(t);},union:function(t){var e=new n();return t.entries.forEach(function(t){e.set(t);}),this.entries.forEach(function(t){e.set(t);}),e;},intersect:function(e){var i=new n();return this.entries.forEach(function(t){e.contains(t)&&i.set(t);}),i;},difference:function(e){var i=new n();return this.entries.forEach(function(t){e.contains(t)||i.set(t);}),i;},size:{get:function(){return this.entries.length;},set:function(t){return t<this.entries.length?this.entries.length=t:this.entries.length;}}});t.exports=n;},function(t,e,i){var n=i(0),s=i(11),a=i(15),h=i(189),u=i(92),r=i(1182),o=new n({Extends:a,Mixins:[s.AlphaSingle,s.BlendMode,s.Depth,s.GetBounds,s.Mask,s.Pipeline,s.ScrollFactor,s.Transform,s.Visible,r],initialize:function(t,e,i,n,s,r,o){void 0===n&&(n=16777215),void 0===s&&(s=128),void 0===r&&(r=1),void 0===o&&(o=.1),a.call(this,t,"PointLight"),this.initPipeline(u.POINTLIGHT_PIPELINE),this.setPosition(e,i),this.color=h(n),this.intensity=r,this.attenuation=o,this.width=2*s,this.height=2*s,this._radius=s;},radius:{get:function(){return this._radius;},set:function(t){this._radius=t,this.width=2*t,this.height=2*t;}},originX:{get:function(){return .5;}},originY:{get:function(){return .5;}},displayOriginX:{get:function(){return this._radius;}},displayOriginY:{get:function(){return this._radius;}}});t.exports=o;},function(t,e){t.exports=function(t,e){var i=e.width/2,n=e.height/2,s=Math.abs(t.x-e.x-i),r=Math.abs(t.y-e.y-n),o=i+t.radius,a=n+t.radius;if(o<s||a<r)return!1;if(s<=i||r<=n)return!0;var h=s-i,u=r-n;return h*h+u*u<=t.radius*t.radius;};},function(t,e){t.exports=function(t,e){return!(t.width<=0||t.height<=0||e.width<=0||e.height<=0)&&!(t.right<e.x||t.bottom<e.y||t.x>e.right||t.y>e.bottom);};},function(t,e,i){var u=i(6),l={},n={register:function(t,e,i,n,s){l[t]={plugin:e,mapping:i,settingsKey:n,configKey:s};},getPlugin:function(t){return l[t];},install:function(t){var e=t.scene.sys,i=e.settings.input,n=e.game.config;for(var s in l){var r=l[s].plugin,o=l[s].mapping,a=l[s].settingsKey,h=l[s].configKey;u(i,a,n[h])&&(t[o]=new r(t));}},remove:function(t){l.hasOwnProperty(t)&&delete l[t];}};t.exports=n;},function(t,e,i){t.exports={ANY_KEY_DOWN:i(1323),ANY_KEY_UP:i(1324),COMBO_MATCH:i(1325),DOWN:i(1326),KEY_DOWN:i(1327),KEY_UP:i(1328),UP:i(1329)};},function(t,e){t.exports=function(t,e){return!!t.url&&(t.url.match(/^(?:blob:|data:|http:\/\/|https:\/\/|\/\/)/)?t.url:e+t.url);};},function(t,e){t.exports=function(t,e,i,n,s,r){return void 0===t&&(t=""),void 0===e&&(e=!0),void 0===i&&(i=""),void 0===n&&(n=""),void 0===s&&(s=0),void 0===r&&(r=!1),{responseType:t,async:e,user:i,password:n,timeout:s,headers:void 0,header:void 0,headerValue:void 0,requestedWith:!1,overrideMimeType:void 0,withCredentials:r};};},function(t,e,i){var n=i(0),s=i(243),r=i(73),o=new n({Extends:r,Mixins:[s.Acceleration,s.Angular,s.Bounce,s.Debug,s.Drag,s.Enable,s.Friction,s.Gravity,s.Immovable,s.Mass,s.Pushable,s.Size,s.Velocity],initialize:function(t,e,i,n,s){r.call(this,t,e,i,n,s),this.body=null;}});t.exports=o;},function(t,e,i){var r=i(119);t.exports=function(t,e,i,n){if(void 0===i&&(i=!1),r(t,e,n)){var s=n.data[e][t]||null;return s&&(-1!==s.index||i)?s:null;}return null;};},function(t,e){t.exports=function(t,e,i,n){var s,r,o,a=t.data,h=t.width,u=t.height,l=t.tilemapLayer,c=Math.max(0,e.left),d=Math.min(h,e.right),f=Math.max(0,e.top),p=Math.min(u,e.bottom);if(0===i)for(r=f;r<p;r++)for(s=c;a[r]&&s<d;s++)(o=a[r][s])&&-1!==o.index&&o.visible&&0!==o.alpha&&n.push(o);else if(1===i)for(r=f;r<p;r++)for(s=d;a[r]&&c<=s;s--)(o=a[r][s])&&-1!==o.index&&o.visible&&0!==o.alpha&&n.push(o);else if(2===i)for(r=p;f<=r;r--)for(s=c;a[r]&&s<d;s++)(o=a[r][s])&&-1!==o.index&&o.visible&&0!==o.alpha&&n.push(o);else if(3===i)for(r=p;f<=r;r--)for(s=d;a[r]&&c<=s;s--)(o=a[r][s])&&-1!==o.index&&o.visible&&0!==o.alpha&&n.push(o);return l.tilesDrawn=n.length,l.tilesTotal=h*u,n;};},function(t,e){t.exports=function(t,e,i){var n=i.collideIndexes.indexOf(t);e&&-1===n?i.collideIndexes.push(t):e||-1===n||i.collideIndexes.splice(n,1);};},function(t,e,i){var r=i(2);t.exports=function(t,e,i){if(!e)return{i:0,layers:t.layers,name:"",opacity:1,visible:!0,x:0,y:0};var n=e.x+r(e,"startx",0)*t.tilewidth+r(e,"offsetx",0),s=e.y+r(e,"starty",0)*t.tileheight+r(e,"offsety",0);return{i:0,layers:e.layers,name:i.name+e.name+"/",opacity:i.opacity*e.opacity,visible:i.visible&&e.visible,x:i.x+n,y:i.y+s};};},function(t,e){t.exports=function(o,a,t){return o.hasOwnProperty(a)?"function"==typeof o[a]?function(t,e,i,n,s,r){return o[a](t,e,i,n,s,r);}:function(){return o[a];}:"function"==typeof t?t:function(){return t;};};},function(t,e,i){var O=i(265),L=i(13),D=i(99),F=i(80),k=i(162),I=i(583),B=i(263),N=i(6),Y=i(264),X=i(266),U=i(268);t.exports=function(t,e,i){void 0===i&&(i=O);for(var n=i.targets?i.targets:B(e),s=I(e),r=k(e,"delay",i.delay),o=k(e,"duration",i.duration),a=N(e,"easeParams",i.easeParams),h=F(N(e,"ease",i.ease),a),u=k(e,"hold",i.hold),l=k(e,"repeat",i.repeat),c=k(e,"repeatDelay",i.repeatDelay),d=D(e,"yoyo",i.yoyo),f=D(e,"flipX",i.flipX),p=D(e,"flipY",i.flipY),g=[],v=0;v<s.length;v++)for(var m=s[v].key,y=s[v].value,x=0;x<n.length;x++){var T=Y(m,y),w=U(n[x],x,m,T.getEnd,T.getStart,T.getActive,F(N(y,"ease",h),N(y,"easeParams",a)),k(y,"delay",r),k(y,"duration",o),D(y,"yoyo",d),k(y,"hold",u),k(y,"repeat",l),k(y,"repeatDelay",c),D(y,"flipX",f),D(y,"flipY",p));g.push(w);}var E=new X(t,g,n);E.offset=L(e,"offset",null),E.completeDelay=L(e,"completeDelay",0),E.loop=Math.round(L(e,"loop",0)),E.loopDelay=Math.round(L(e,"loopDelay",0)),E.paused=D(e,"paused",!1),E.useFrames=D(e,"useFrames",!1);for(var b=N(e,"callbackScope",E),S=[E,null],A=X.TYPES,_=0;_<A.length;_++){var C,R,M=A[_],P=N(e,M,!1);P&&(C=N(e,M+"Scope",b),R=N(e,M+"Params",[]),E.setCallback(M,P,S.concat(R),C));}return E;};},function(t,e,i){var n=i(0),s=i(102),u=i(2),r=i(132),o=i(185),a=new n({initialize:function(t){this.parent=t,this.animationManager=t.scene.sys.anims,this.animationManager.on(r.REMOVE_ANIMATION,this.globalRemove,this),this.textureManager=this.animationManager.textureManager,this.anims=null,this.isPlaying=!1,this.hasStarted=!1,this.currentAnim=null,this.currentFrame=null,this.nextAnim=null,this.nextAnimsQueue=[],this.timeScale=1,this.frameRate=0,this.duration=0,this.msPerFrame=0,this.skipMissedFrames=!0,this.delay=0,this.repeat=0,this.repeatDelay=0,this.yoyo=!1,this.showOnStart=!1,this.hideOnComplete=!1,this.forward=!0,this.inReverse=!1,this.accumulator=0,this.nextTick=0,this.delayCounter=0,this.repeatCounter=0,this.pendingRepeat=!1,this._paused=!1,this._wasPlaying=!1,this._pendingStop=0,this._pendingStopValue;},chain:function(t){var e=this.parent;if(void 0===t)return this.nextAnimsQueue.length=0,this.nextAnim=null,e;Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var n=t[i];null===this.nextAnim?this.nextAnim=n:this.nextAnimsQueue.push(n);}return this.parent;},getName:function(){return this.currentAnim?this.currentAnim.key:"";},getFrameName:function(){return this.currentFrame?this.currentFrame.textureFrame:"";},load:function(t){this.isPlaying&&this.stop();var e,i,n,s,r,o=this.animationManager,a="string"==typeof t?t:u(t,"key",null),h=this.exists(a)?this.get(a):o.get(a);return h?(e=(this.currentAnim=h).getTotalFrames(),i=u(t,"frameRate",h.frameRate),n=u(t,"duration",h.duration),h.calculateDuration(this,e,n,i),this.delay=u(t,"delay",h.delay),this.repeat=u(t,"repeat",h.repeat),this.repeatDelay=u(t,"repeatDelay",h.repeatDelay),this.yoyo=u(t,"yoyo",h.yoyo),this.showOnStart=u(t,"showOnStart",h.showOnStart),this.hideOnComplete=u(t,"hideOnComplete",h.hideOnComplete),this.skipMissedFrames=u(t,"skipMissedFrames",h.skipMissedFrames),this.timeScale=u(t,"timeScale",this.timeScale),(s=u(t,"startFrame",0))>h.getTotalFrames()&&(s=0),r=h.frames[s],0!==s||this.forward||(r=h.getLastFrame()),this.currentFrame=r):console.warn("Missing animation: "+a),this.parent;},pause:function(t){return this._paused||(this._paused=!0,this._wasPlaying=this.isPlaying,this.isPlaying=!1),void 0!==t&&this.setCurrentFrame(t),this.parent;},resume:function(t){return this._paused&&(this._paused=!1,this.isPlaying=this._wasPlaying),void 0!==t&&this.setCurrentFrame(t),this.parent;},playAfterDelay:function(t,e){var i,n;return this.isPlaying?(i=this.nextAnim,n=this.nextAnimsQueue,i&&n.unshift(i),this.nextAnim=t,this._pendingStop=1,this._pendingStopValue=e):(this.delayCounter=e,this.play(t,!0)),this.parent;},playAfterRepeat:function(t,e){var i,n;return void 0===e&&(e=1),this.isPlaying?(i=this.nextAnim,n=this.nextAnimsQueue,i&&n.unshift(i),-1!==this.repeatCounter&&e>this.repeatCounter&&(e=this.repeatCounter),this.nextAnim=t,this._pendingStop=2,this._pendingStopValue=e):this.play(t),this.parent;},play:function(t,e){void 0===e&&(e=!1);var i=this.currentAnim,n=this.parent,s="string"==typeof t?t:t.key;if(e&&this.isPlaying&&i.key===s)return n;if(i&&this.isPlaying){var r=this.animationManager.getMix(i.key,t);if(0<r)return this.playAfterDelay(t,r);}return this.forward=!0,this.inReverse=!1,this._paused=!1,this._wasPlaying=!0,this.startAnimation(t);},playReverse:function(t,e){void 0===e&&(e=!1);var i="string"==typeof t?t:t.key;return e&&this.isPlaying&&this.currentAnim.key===i?this.parent:(this.forward=!1,this.inReverse=!0,this._paused=!1,this._wasPlaying=!0,this.startAnimation(t));},startAnimation:function(t){this.load(t);var e=this.currentAnim,i=this.parent;return e&&(this.repeatCounter=-1===this.repeat?Number.MAX_VALUE:this.repeat,e.getFirstTick(this),this.isPlaying=!0,this.pendingRepeat=!1,this.hasStarted=!1,this._pendingStop=0,this._pendingStopValue=0,this._paused=!1,this.delayCounter+=this.delay,0===this.delayCounter&&this.handleStart()),i;},handleStart:function(){this.showOnStart&&this.parent.setVisible(!0),this.setCurrentFrame(this.currentFrame),this.hasStarted=!0,this.emitEvents(r.ANIMATION_START);},handleRepeat:function(){this.pendingRepeat=!1,this.emitEvents(r.ANIMATION_REPEAT);},handleStop:function(){this._pendingStop=0,this.isPlaying=!1,this.emitEvents(r.ANIMATION_STOP);},handleComplete:function(){this._pendingStop=0,this.isPlaying=!1,this.hideOnComplete&&this.parent.setVisible(!1),this.emitEvents(r.ANIMATION_COMPLETE,r.ANIMATION_COMPLETE_KEY);},emitEvents:function(t,e){var i=this.currentAnim,n=this.currentFrame,s=this.parent,r=n.textureFrame;s.emit(t,i,n,s,r),e&&s.emit(e+i.key,i,n,s,r);},reverse:function(){return this.isPlaying&&(this.inReverse=!this.inReverse,this.forward=!this.forward),this.parent;},getProgress:function(){var t=this.currentFrame;if(!t)return 0;var e=t.progress;return this.inReverse&&(e*=-1),e;},setProgress:function(t){return this.forward||(t=1-t),this.setCurrentFrame(this.currentAnim.getFrameByProgress(t)),this.parent;},setRepeat:function(t){return this.repeatCounter=-1===t?Number.MAX_VALUE:t,this.parent;},globalRemove:function(t,e){void 0===e&&(e=this.currentAnim),this.isPlaying&&e.key===this.currentAnim.key&&(this.stop(),this.setCurrentFrame(this.currentAnim.frames[0]));},restart:function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this.currentAnim,n=this.parent;return i?(e&&(this.repeatCounter=-1===this.repeat?Number.MAX_VALUE:this.repeat),i.getFirstTick(this),this.emitEvents(r.ANIMATION_RESTART),this.isPlaying=!0,this.pendingRepeat=!1,this.hasStarted=!t,this._pendingStop=0,this._pendingStopValue=0,this._paused=!1,this.setCurrentFrame(i.frames[0]),this.parent):n;},complete:function(){var t;return this._pendingStop=0,this.isPlaying=!1,this.currentAnim&&this.handleComplete(),this.nextAnim&&(t=this.nextAnim,this.nextAnim=0<this.nextAnimsQueue.length?this.nextAnimsQueue.shift():null,this.play(t)),this.parent;},stop:function(){var t;return this._pendingStop=0,this.isPlaying=!1,this.currentAnim&&this.handleStop(),this.nextAnim&&(t=this.nextAnim,this.nextAnim=this.nextAnimsQueue.shift(),this.play(t)),this.parent;},stopAfterDelay:function(t){return this._pendingStop=1,this._pendingStopValue=t,this.parent;},stopAfterRepeat:function(t){return void 0===t&&(t=1),-1!==this.repeatCounter&&t>this.repeatCounter&&(t=this.repeatCounter),this._pendingStop=2,this._pendingStopValue=t,this.parent;},stopOnFrame:function(t){return this._pendingStop=3,this._pendingStopValue=t,this.parent;},getTotalFrames:function(){return this.currentAnim?this.currentAnim.getTotalFrames():0;},update:function(t,e){var i=this.currentAnim;if(this.isPlaying&&i&&!i.paused){if(this.accumulator+=e*this.timeScale,1===this._pendingStop&&(this._pendingStopValue-=e,this._pendingStopValue<=0))return this.stop();if(this.hasStarted){if(this.accumulator>=this.nextTick&&(this.forward?i.nextFrame(this):i.previousFrame(this),this.isPlaying&&0===this._pendingStop&&this.skipMissedFrames&&this.accumulator>this.nextTick))for(var n=0;this.forward?i.nextFrame(this):i.previousFrame(this),n++,this.isPlaying&&this.accumulator>this.nextTick&&n<60;);}else this.accumulator>=this.delayCounter&&(this.accumulator-=this.delayCounter,this.handleStart());}},setCurrentFrame:function(t){var e=this.parent;return this.currentFrame=t,e.texture=t.frame.texture,e.frame=t.frame,e.isCropped&&e.frame.updateCropUVs(e._crop,e.flipX,e.flipY),t.setAlpha&&(e.alpha=t.alpha),e.setSizeToFrame(),e._originComponent&&(t.frame.customPivot?e.setOrigin(t.frame.pivotX,t.frame.pivotY):e.updateDisplayOrigin()),this.isPlaying&&this.hasStarted&&(this.emitEvents(r.ANIMATION_UPDATE),3===this._pendingStop&&this._pendingStopValue===t&&this.stop()),e;},nextFrame:function(){return this.currentAnim&&this.currentAnim.nextFrame(this),this.parent;},previousFrame:function(){return this.currentAnim&&this.currentAnim.previousFrame(this),this.parent;},get:function(t){return this.anims?this.anims.get(t):null;},exists:function(t){return!!this.anims&&this.anims.has(t);},create:function(t){var e=t.key,i=!1;return e&&((i=this.get(e))||(i=new o(this,e,t),this.anims||(this.anims=new s()),this.anims.set(e,i))),i;},generateFrameNames:function(t,e){return this.animationManager.generateFrameNames(t,e);},generateFrameNumbers:function(t,e){return this.animationManager.generateFrameNumbers(t,e);},remove:function(t){var e=this.get(t);return e&&(this.currentAnim===e&&this.stop(),this.anims.delete(t)),e;},destroy:function(){this.animationManager.off(r.REMOVE_ANIMATION,this.globalRemove,this),this.anims&&this.anims.clear(),this.animationManager=null,this.parent=null,this.nextAnim=null,this.nextAnimsQueue.length=0,this.currentAnim=null,this.currentFrame=null;},isPaused:{get:function(){return this._paused;}}});t.exports=a;},,,function(t,e,i){var a=i(175),s=i(92),r=i(74),n={defaultPipeline:null,pipeline:null,hasPostPipeline:!1,postPipelines:null,pipelineData:null,initPipeline:function(t){void 0===t&&(t=s.MULTI_PIPELINE);var e=this.scene.sys.renderer;if(!e)return!1;var i=e.pipelines;if(this.postPipelines=[],this.pipelineData={},i){var n=i.get(t);if(n)return this.defaultPipeline=n,this.pipeline=n,!0;}return!1;},setPipeline:function(t,e,i){var n=this.scene.sys.renderer;if(!n)return this;var s,r=n.pipelines;return r&&((s=r.get(t))&&(this.pipeline=s),e&&(this.pipelineData=i?a(e):e)),this;},setPostPipeline:function(t,e,i){var n=this.scene.sys.renderer;if(!n)return this;var s=n.pipelines;if(s){Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++){var o=s.getPostPipeline(t[r],this);o&&this.postPipelines.push(o);}e&&(this.pipelineData=i?a(e):e);}return this.hasPostPipeline=0<this.postPipelines.length,this;},setPipelineData:function(t,e){var i=this.pipelineData;return void 0===e?delete i[t]:i[t]=e,this;},getPostPipeline:function(t){for(var e=this.postPipelines,i=[],n=0;n<e.length;n++){var s=e[n];("string"==typeof t&&s.name===t||s instanceof t)&&i.push(s);}return 1===i.length?i[0]:i;},resetPipeline:function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),this.pipeline=this.defaultPipeline,t&&(this.postPipelines=[],this.hasPostPipeline=!1),e&&(this.pipelineData={}),null!==this.pipeline;},resetPostPipeline:function(t){void 0===t&&(t=!1);for(var e=this.postPipelines,i=0;i<e.length;i++)e[i].destroy();this.postPipelines=[],this.hasPostPipeline=!1,t&&(this.pipelineData={});},removePostPipeline:function(t){for(var e=this.postPipelines,i=e.length-1;0<=i;i--){var n=e[i];("string"==typeof t&&n.name===t||"string"!=typeof t&&n instanceof t)&&(n.destroy(),r(e,i));}return this.hasPostPipeline=0<this.postPipelines.length,this;},getPipelineName:function(){return this.pipeline.name;}};t.exports=n;},function(t,e){t.exports={DEFAULT:0,LINEAR:0,NEAREST:1};},function(t,e,i){var n=i(4);t.exports=function(t,e,i){return void 0===i&&(i=new n()),i.x=t.x+t.radius*Math.cos(e),i.y=t.y+t.radius*Math.sin(e),i;};},function(t,e,i){var a=i(4);t.exports=function(t,e){void 0===e&&(e=new a());var i=2*Math.PI*Math.random(),n=Math.random()+Math.random(),s=1<n?2-n:n,r=s*Math.cos(i),o=s*Math.sin(i);return e.x=t.x+r*t.radius,e.y=t.y+o*t.radius,e;};},function(t,e,i){var s=i(130),r=i(4);t.exports=function(t,e,i){if(void 0===i&&(i=new r()),e<=0||1<=e)return i.x=t.x,i.y=t.y,i;var n=s(t)*e;return .5<e?(n-=t.width+t.height)<=t.width?(i.x=t.right-n,i.y=t.bottom):(i.x=t.x,i.y=t.bottom-(n-t.width)):n<=t.width?(i.x=t.x+n,i.y=t.y):(i.x=t.right,i.y=t.y+(n-t.width)),i;};},function(t,e,i){var d=i(67),f=i(4);t.exports=function(t,e,i,n){void 0===n&&(n=[]),!e&&0<i&&(e=d(t)/i);for(var s=t.x1,r=t.y1,o=t.x2,a=t.y2,h=0;h<e;h++){var u=h/e,l=s+(o-s)*u,c=r+(a-r)*u;n.push(new f(l,c));}return n;};},function(t,e,i){var n=i(4);t.exports=function(t,e){void 0===e&&(e=new n());var i=Math.random();return e.x=t.x1+i*(t.x2-t.x1),e.y=t.y1+i*(t.y2-t.y1),e;};},function(t,e,i){var n=i(4);t.exports=function(t,e){return void 0===e&&(e=new n()),e.x=t.x+Math.random()*t.width,e.y=t.y+Math.random()*t.height,e;};},function(t,e){var s=function(t){var e,i,n;if("object"!=typeof t||null===t)return t;for(n in e=Array.isArray(t)?[]:{},t)i=t[n],e[n]=s(i);return e;};t.exports=s;},function(t,e){t.exports=function(t){var e={name:t.name,type:t.type,x:t.x,y:t.y,depth:t.depth,scale:{x:t.scaleX,y:t.scaleY},origin:{x:t.originX,y:t.originY},flipX:t.flipX,flipY:t.flipY,rotation:t.rotation,alpha:t.alpha,visible:t.visible,blendMode:t.blendMode,textureKey:"",frameKey:"",data:{}};return t.texture&&(e.textureKey=t.texture.key,e.frameKey=t.frame.name),e;};},function(t,e,i){var g=i(3);t.exports=function(t,e,i,n,s,r,o,a){void 0===a&&(a=new g());var h=Math.sin(s),u=Math.cos(s),l=u*r,c=h*r,d=-h*o,f=u*o,p=1/(l*f+d*-c);return a.x=f*p*t+-d*p*e+(n*d-i*f)*p,a.y=l*p*e+-c*p*t+(-n*l+i*c)*p,a;};},function(t,e){t.exports=function(t,e){void 0===e&&(e=1);for(var i=null,n=0;n<e;n++)i=t.shift(),t.push(i);return i;};},function(t,e){t.exports=function(t,e){void 0===e&&(e=1);for(var i=null,n=0;n<e;n++)i=t.pop(),t.unshift(i);return i;};},function(t,e,i){var s=i(4);t.exports=function(t,e){void 0===e&&(e=new s());var i=Math.random()*Math.PI*2,n=Math.sqrt(Math.random());return e.x=t.x+n*Math.cos(i)*t.width/2,e.y=t.y+n*Math.sin(i)*t.height/2,e;};},function(t,e,i){var h=i(4);t.exports=function(t,e){void 0===e&&(e=new h());var i=t.x2-t.x1,n=t.y2-t.y1,s=t.x3-t.x1,r=t.y3-t.y1,o=Math.random(),a=Math.random();return 1<=o+a&&(o=1-o,a=1-a),e.x=t.x1+(i*o+s*a),e.y=t.y1+(n*o+r*a),e;};},function(t,e){t.exports=function(t,e,i,n,s){var r=n+Math.atan2(t.y-i,t.x-e);return t.x=e+s*Math.cos(r),t.y=i+s*Math.sin(r),t;};},function(t,e){t.exports=function(t,e,i){return(t=Math.max(0,Math.min(1,(t-e)/(i-e))))*t*t*(t*(6*t-15)+10);};},function(t,e){t.exports=function(t,e,i){return t<=e?0:i<=t?1:(t=(t-e)/(i-e))*t*(3-2*t);};},function(t,e,i){var n=i(18),s=i(0),r=i(132),o=i(318),v=i(319),m=i(6),y=i(320),a=new s({initialize:function(t,e,i){this.manager=t,this.key=e,this.type="frame",this.frames=this.getFrames(t.textureManager,m(i,"frames",[]),m(i,"defaultTextureKey",null),m(i,"sortFrames",!0)),this.frameRate=m(i,"frameRate",null),this.duration=m(i,"duration",null),this.msPerFrame,this.skipMissedFrames=m(i,"skipMissedFrames",!0),this.delay=m(i,"delay",0),this.repeat=m(i,"repeat",0),this.repeatDelay=m(i,"repeatDelay",0),this.yoyo=m(i,"yoyo",!1),this.showOnStart=m(i,"showOnStart",!1),this.hideOnComplete=m(i,"hideOnComplete",!1),this.paused=!1,this.calculateDuration(this,this.getTotalFrames(),this.duration,this.frameRate),this.manager.on&&(this.manager.on(r.PAUSE_ALL,this.pause,this),this.manager.on(r.RESUME_ALL,this.resume,this));},getTotalFrames:function(){return this.frames.length;},calculateDuration:function(t,e,i,n){null===i&&null===n?(t.frameRate=24,t.duration=24/e*1e3):i&&null===n?(t.duration=i,t.frameRate=e/(i/1e3)):(t.frameRate=n,t.duration=e/n*1e3),t.msPerFrame=1e3/t.frameRate;},addFrame:function(t){return this.addFrameAt(this.frames.length,t);},addFrameAt:function(t,e){var i,n,s=this.getFrames(this.manager.textureManager,e);return 0<s.length&&(0===t?this.frames=s.concat(this.frames):t===this.frames.length?this.frames=this.frames.concat(s):(i=this.frames.slice(0,t),n=this.frames.slice(t),this.frames=i.concat(s,n)),this.updateFrameSequence()),this;},checkFrame:function(t){return 0<=t&&t<this.frames.length;},getFirstTick:function(t){t.accumulator=0,t.nextTick=t.msPerFrame+t.currentFrame.duration;},getFrameAt:function(t){return this.frames[t];},getFrames:function(t,e,i,n){void 0===n&&(n=!0);var s,r,o,a=[],h=1;if("string"==typeof e&&(r=e,o=t.get(r).getFrameNames(),n&&y(o),e=[],o.forEach(function(t){e.push({key:r,frame:t});})),!Array.isArray(e)||0===e.length)return a;for(g=0;g<e.length;g++){var u,l,c,d=e[g],f=m(d,"key",i);f&&(u=m(d,"frame",0),l=t.getFrame(f,u),(c=new v(f,u,h,l)).duration=m(d,"duration",0),c.isFirst=!s,s&&((s.nextFrame=c).prevFrame=s),a.push(c),s=c,h++);}if(0<a.length){c.isLast=!0,c.nextFrame=a[0],a[0].prevFrame=c;for(var p=1/(a.length-1),g=0;g<a.length;g++)a[g].progress=g*p;}return a;},getNextTick:function(t){t.accumulator-=t.nextTick,t.nextTick=t.msPerFrame+t.currentFrame.duration;},getFrameByProgress:function(t){return t=n(t,0,1),o(t,this.frames,"progress");},nextFrame:function(t){var e=t.currentFrame;e.isLast?t.yoyo?this.handleYoyoFrame(t,!1):0<t.repeatCounter?t.inReverse&&t.forward?t.forward=!1:this.repeatAnimation(t):t.complete():this.updateAndGetNextTick(t,e.nextFrame);},handleYoyoFrame:function(t,e){if(e=e||!1,t.inReverse===!e&&0<t.repeatCounter)return 0!==t.repeatDelay&&!t.pendingRepeat||(t.forward=e),void this.repeatAnimation(t);var i;t.inReverse===e||0!==t.repeatCounter?(i=(t.forward=e)?t.currentFrame.nextFrame:t.currentFrame.prevFrame,this.updateAndGetNextTick(t,i)):t.complete();},getLastFrame:function(){return this.frames[this.frames.length-1];},previousFrame:function(t){var e=t.currentFrame;e.isFirst?t.yoyo?this.handleYoyoFrame(t,!0):0<t.repeatCounter?(t.inReverse&&!t.forward||(t.forward=!0),this.repeatAnimation(t)):t.complete():this.updateAndGetNextTick(t,e.prevFrame);},updateAndGetNextTick:function(t,e){t.setCurrentFrame(e),this.getNextTick(t);},removeFrame:function(t){var e=this.frames.indexOf(t);return-1!==e&&this.removeFrameAt(e),this;},removeFrameAt:function(t){return this.frames.splice(t,1),this.updateFrameSequence(),this;},repeatAnimation:function(t){if(2===t._pendingStop){if(0===t._pendingStopValue)return t.stop();t._pendingStopValue--;}0<t.repeatDelay&&!t.pendingRepeat?(t.pendingRepeat=!0,t.accumulator-=t.nextTick,t.nextTick+=t.repeatDelay):(t.repeatCounter--,t.forward?t.setCurrentFrame(t.currentFrame.nextFrame):t.setCurrentFrame(t.currentFrame.prevFrame),t.isPlaying&&(this.getNextTick(t),t.handleRepeat()));},toJSON:function(){var e={key:this.key,type:this.type,frames:[],frameRate:this.frameRate,duration:this.duration,skipMissedFrames:this.skipMissedFrames,delay:this.delay,repeat:this.repeat,repeatDelay:this.repeatDelay,yoyo:this.yoyo,showOnStart:this.showOnStart,hideOnComplete:this.hideOnComplete};return this.frames.forEach(function(t){e.frames.push(t.toJSON());}),e;},updateFrameSequence:function(){for(var t,e=this.frames.length,i=1/(e-1),n=0;n<e;n++)(t=this.frames[n]).index=n+1,t.isFirst=!1,t.isLast=!1,t.progress=n*i,0===n?(t.isFirst=!0,1===e?(t.isLast=!0,(t.nextFrame=t).prevFrame=t):(t.isLast=!1,t.prevFrame=this.frames[e-1],t.nextFrame=this.frames[n+1])):n===e-1&&1<e?(t.isLast=!0,t.prevFrame=this.frames[e-2],t.nextFrame=this.frames[0]):1<e&&(t.prevFrame=this.frames[n-1],t.nextFrame=this.frames[n+1]);return this;},pause:function(){return this.paused=!0,this;},resume:function(){return this.paused=!1,this;},destroy:function(){this.manager.off&&(this.manager.off(r.PAUSE_ALL,this.pause,this),this.manager.off(r.RESUME_ALL,this.resume,this)),this.manager.remove(this.key);for(var t=0;t<this.frames.length;t++)this.frames[t].destroy();this.frames=[],this.manager=null;}});t.exports=a;},function(t,e){t.exports=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=" "),void 0===n&&(n=3);var s;if(e+1>=(t=t.toString()).length)switch(n){case 1:t=new Array(e+1-t.length).join(i)+t;break;case 3:var r=Math.ceil((s=e-t.length)/2);t=new Array(1+(s-r)).join(i)+t+new Array(r+1).join(i);break;default:t+=new Array(e+1-t.length).join(i);}return t;};},function(t,e,i){var n=i(327),s=i(189),r=i(331),o=i(332);t.exports=function(t){switch(typeof t){case"string":return("rgb"===t.substr(0,3).toLowerCase()?o:n)(t);case"number":return s(t);case"object":return r(t);}};},function(t,e,i){var a=i(103);function h(t,e,i,n){var s=(t+6*e)%6,r=Math.min(s,4-s,1);return Math.round(255*(n-n*i*Math.max(0,r)));}t.exports=function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=1);var s=h(5,t,e,i),r=h(3,t,e,i),o=h(1,t,e,i);return n?n.setTo?n.setTo(s,r,o,n.alpha,!1):(n.r=s,n.g=r,n.b=o,n.color=a(s,r,o),n):{r:s,g:r,b:o,color:a(s,r,o)};};},function(t,e,i){var n=i(38),s=i(330);t.exports=function(t){var e=s(t);return new n(e.r,e.g,e.b,e.a);};},function(t,e){t.exports=function(t,e,i){return t.x=e-t.width/2,t.y=i-t.height/2,t;};},function(t,e,i){var n=i(105),r=i(136),o=i(31),a={canvas:!1,canvasBitBltShift:null,file:!1,fileSystem:!1,getUserMedia:!0,littleEndian:!1,localStorage:!1,pointerLock:!1,support32bit:!1,vibration:!1,webGL:!1,worker:!1};t.exports=function(){if("function"==typeof importScripts)return a;a.canvas=!!window.CanvasRenderingContext2D;try{a.localStorage=!!localStorage.getItem;}catch(t){a.localStorage=!1;}a.file=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),a.fileSystem=!!window.requestFileSystem;var t,e,i,s=!1;return a.webGL=function(){if(window.WebGLRenderingContext)try{var t=o.createWebGL(this),e=t.getContext("webgl")||t.getContext("experimental-webgl"),i=o.create2D(this),n=i.getContext("2d").createImageData(1,1);return s=n.data instanceof Uint8ClampedArray,o.remove(t),o.remove(i),!!e;}catch(t){return!1;}return!1;}(),a.worker=!!window.Worker,a.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL,a.getUserMedia=a.getUserMedia&&!!navigator.getUserMedia&&!!window.URL,r.firefox&&r.firefoxVersion<21&&(a.getUserMedia=!1),!n.iOS&&(r.ie||r.firefox||r.chrome)&&(a.canvasBitBltShift=!0),(r.safari||r.mobileSafari)&&(a.canvasBitBltShift=!1),navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,navigator.vibrate&&(a.vibration=!0),"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint32Array&&(a.littleEndian=(t=new ArrayBuffer(4),e=new Uint8Array(t),i=new Uint32Array(t),e[0]=161,e[1]=178,e[2]=195,e[3]=212,3569595041===i[0]||2712847316!==i[0]&&null)),a.support32bit="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof Int32Array&&null!==a.littleEndian&&s,a;}();},function(t,e){var i="";function n(t){for(var e=["i","webkitI","msI","mozI","oI"],i=0;i<e.length;i++){var n=e[i]+"mageSmoothingEnabled";if(n in t)return n;}return null;}t.exports={disable:function(t){return""===i&&(i=n(t)),i&&(t[i]=!1),t;},enable:function(t){return""===i&&(i=n(t)),i&&(t[i]=!0),t;},getPrefix:n,isEnabled:function(t){return null!==i?t[i]:null;}};},function(t,e,i){var n=i(14),s=i(17)(!1,s={Angle:i(812),Distance:i(821),Easing:i(826),Fuzzy:i(827),Interpolation:i(830),Pow2:i(835),Snap:i(837),RandomDataGenerator:i(839),Average:i(840),Bernstein:i(356),Between:i(195),CatmullRom:i(194),CeilTo:i(841),Clamp:i(18),DegToRad:i(36),Difference:i(842),Euler:i(843),Factorial:i(357),FloatBetween:i(137),FloorTo:i(844),FromPercent:i(98),GetSpeed:i(845),IsEven:i(846),IsEvenStrict:i(847),Linear:i(135),MaxAdd:i(848),Median:i(849),MinSub:i(850),Percent:i(851),RadToDeg:i(196),RandomXY:i(852),RandomXYZ:i(853),RandomXYZW:i(854),Rotate:i(362),RotateAround:i(308),RotateAroundDistance:i(182),RotateTo:i(855),RoundAwayFromZero:i(363),RoundTo:i(856),SinCosTableGenerator:i(857),SmootherStep:i(183),SmoothStep:i(184),ToXY:i(858),TransformXY:i(177),Within:i(859),Wrap:i(68),Vector2:i(3),Vector3:i(39),Vector4:i(140),Matrix3:i(364),Matrix4:i(69),Quaternion:i(365),RotateVec3:i(860)},n);t.exports=s;},function(t,e){t.exports=function(t,e,i,n,s){var r=.5*(n-e),o=.5*(s-i),a=t*t;return(2*i-2*n+r+o)*(t*a)+(-3*i+3*n-2*r-o)*a+r*t+i;};},function(t,e){t.exports=function(t,e){return Math.floor(Math.random()*(e-t+1)+t);};},function(t,e,i){var n=i(14);t.exports=function(t){return t*n.RAD_TO_DEG;};},function(t,e,i){t.exports={Global:["game","anims","cache","plugins","registry","scale","sound","textures","renderer"],CoreScene:["EventEmitter","CameraManager","GameObjectCreator","GameObjectFactory","ScenePlugin","DisplayList","UpdateList"],DefaultScene:["Clock","DataManagerPlugin","InputPlugin","Loader","TweenManager","LightsPlugin"]};},function(t,e,i){var n=new(i(0))({initialize:function(){this._matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.alpha=1,this._dirty=!0,this._data;},set:function(t){return this._matrix=t,this._dirty=!0,this;},reset:function(){var t=this._matrix;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=1,t[7]=0,t[8]=0,t[9]=0,t[10]=0,t[11]=0,t[12]=1,t[13]=0,t[14]=0,t[15]=0,t[16]=0,t[17]=0,t[18]=1,t[19]=0,this._dirty=!0,this;},getData:function(){var t;return this._dirty&&((t=new Float32Array(this._matrix))[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,this._data=t,this._dirty=!1),this._data;},brightness:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=!1),this.multiply([t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0],e);},saturate:function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1);var i=2*t/3+1,n=-.5*(i-1);return this.multiply([i,n,n,0,0,n,i,n,0,0,n,n,i,0,0,0,0,0,1,0],e);},desaturate:function(t){return void 0===t&&(t=!1),this.saturate(-1,t);},hue:function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),t=t/180*Math.PI;var i=Math.cos(t),n=Math.sin(t);return this.multiply([.213+.787*i+-.213*n,.715+-.715*i+-.715*n,.072+-.072*i+.928*n,0,0,.213+-.213*i+.143*n,.715+i*(1-.715)+.14*n,.072+-.072*i+-.283*n,0,0,.213+-.213*i+-.787*n,.715+-.715*i+.715*n,.072+.928*i+.072*n,0,0,0,0,0,1,0],e);},grayscale:function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!1),this.saturate(-t,e);},blackWhite:function(t){return void 0===t&&(t=!1),this.multiply([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t);},contrast:function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1);var i=t+1,n=-.5*(i-1);return this.multiply([i,0,0,0,n,0,i,0,0,n,0,0,i,0,n,0,0,0,1,0],e);},negative:function(t){return void 0===t&&(t=!1),this.multiply([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t);},desaturateLuminance:function(t){return void 0===t&&(t=!1),this.multiply([.2764723,.929708,.0938197,0,-37.1,.2764723,.929708,.0938197,0,-37.1,.2764723,.929708,.0938197,0,-37.1,0,0,0,1,0],t);},sepia:function(t){return void 0===t&&(t=!1),this.multiply([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t);},night:function(t,e){return void 0===t&&(t=.1),void 0===e&&(e=!1),this.multiply([-2*t,-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0],e);},lsd:function(t){return void 0===t&&(t=!1),this.multiply([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t);},brown:function(t){return void 0===t&&(t=!1),this.multiply([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t);},vintagePinhole:function(t){return void 0===t&&(t=!1),this.multiply([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t);},kodachrome:function(t){return void 0===t&&(t=!1),this.multiply([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t);},technicolor:function(t){return void 0===t&&(t=!1),this.multiply([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t);},polaroid:function(t){return void 0===t&&(t=!1),this.multiply([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t);},shiftToBGR:function(t){return void 0===t&&(t=!1),this.multiply([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t);},multiply:function(t,e){e||this.reset();for(var i=this._matrix,n=[],s=0;s<20;s++)n[s]=i[s];return i[0]=n[0]*t[0]+n[1]*t[5]+n[2]*t[10]+n[3]*t[15],i[1]=n[0]*t[1]+n[1]*t[6]+n[2]*t[11]+n[3]*t[16],i[2]=n[0]*t[2]+n[1]*t[7]+n[2]*t[12]+n[3]*t[17],i[3]=n[0]*t[3]+n[1]*t[8]+n[2]*t[13]+n[3]*t[18],i[4]=n[0]*t[4]+n[1]*t[9]+n[2]*t[14]+n[3]*t[19]+n[4],i[5]=n[5]*t[0]+n[6]*t[5]+n[7]*t[10]+n[8]*t[15],i[6]=n[5]*t[1]+n[6]*t[6]+n[7]*t[11]+n[8]*t[16],i[7]=n[5]*t[2]+n[6]*t[7]+n[7]*t[12]+n[8]*t[17],i[8]=n[5]*t[3]+n[6]*t[8]+n[7]*t[13]+n[8]*t[18],i[9]=n[5]*t[4]+n[6]*t[9]+n[7]*t[14]+n[8]*t[19]+n[9],i[10]=n[10]*t[0]+n[11]*t[5]+n[12]*t[10]+n[13]*t[15],i[11]=n[10]*t[1]+n[11]*t[6]+n[12]*t[11]+n[13]*t[16],i[12]=n[10]*t[2]+n[11]*t[7]+n[12]*t[12]+n[13]*t[17],i[13]=n[10]*t[3]+n[11]*t[8]+n[12]*t[13]+n[13]*t[18],i[14]=n[10]*t[4]+n[11]*t[9]+n[12]*t[14]+n[13]*t[19]+n[14],i[15]=n[15]*t[0]+n[16]*t[5]+n[17]*t[10]+n[18]*t[15],i[16]=n[15]*t[1]+n[16]*t[6]+n[17]*t[11]+n[18]*t[16],i[17]=n[15]*t[2]+n[16]*t[7]+n[17]*t[12]+n[18]*t[17],i[18]=n[15]*t[3]+n[16]*t[8]+n[17]*t[13]+n[18]*t[18],i[19]=n[15]*t[4]+n[16]*t[9]+n[17]*t[14]+n[18]*t[19]+n[19],this._dirty=!0,this;}});t.exports=n;},function(t,e,i){var l=i(10),c=i(14);t.exports=function(t,e){if(void 0===e&&(e=new l()),0===t.length)return e;for(var i,n,s,r=Number.MAX_VALUE,o=Number.MAX_VALUE,a=c.MIN_SAFE_INTEGER,h=c.MIN_SAFE_INTEGER,u=0;u<t.length;u++)i=t[u],s=Array.isArray(i)?(n=i[0],i[1]):(n=i.x,i.y),r=Math.min(r,n),o=Math.min(o,s),a=Math.max(a,n),h=Math.max(h,s);return e.x=r,e.y=o,e.width=a-r,e.height=h-o,e;};},function(t,e,i){var n=i(0),s=i(1),r=new n({initialize:function(t,e,i){this._rgb=[0,0,0],this.onChangeCallback=s,this.dirty=!1,this.set(t,e,i);},set:function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._rgb=[t,e,i],this.onChange(),this;},equals:function(t,e,i){var n=this._rgb;return n.r===t&&n.g===e&&n.b===i;},onChange:function(){this.dirty=!0;var t=this._rgb;this.onChangeCallback.call(this,t[0],t[1],t[2]);},r:{get:function(){return this._rgb[0];},set:function(t){this._rgb[0]=t,this.onChange();}},g:{get:function(){return this._rgb[1];},set:function(t){this._rgb[1]=t,this.onChange();}},b:{get:function(){return this._rgb[2];},set:function(t){this._rgb[2]=t,this.onChange();}},destroy:function(){this.onChangeCallback=null;}});t.exports=r;},function(t,e,i){var n={CENTER:i(403),ORIENTATION:i(404),SCALE_MODE:i(405),ZOOM:i(406)};t.exports=n;},function(t,e){t.exports=function(t){t.parentNode&&t.parentNode.removeChild(t);};},function(t,e){t.exports={MOUSE_DOWN:0,MOUSE_MOVE:1,MOUSE_UP:2,TOUCH_START:3,TOUCH_MOVE:4,TOUCH_END:5,POINTER_LOCK_CHANGE:6,TOUCH_CANCEL:7,MOUSE_WHEEL:8};},function(t,e,i){var n=i(0),s=i(144),r=i(197),o=i(20),a=i(419),h=i(420),u=i(33),l=i(1),c=i(421),d=new n({initialize:function(t,e){this.scene=t,this.game,this.renderer,this.config=e,this.settings=c.create(e),this.canvas,this.context,this.anims,this.cache,this.plugins,this.registry,this.scale,this.sound,this.textures,this.add,this.cameras,this.displayList,this.events,this.make,this.scenePlugin,this.updateList,this.sceneUpdate=l;},init:function(t){this.settings.status=s.INIT,this.sceneUpdate=l,this.game=t,this.renderer=t.renderer,this.canvas=t.canvas,this.context=t.context;var e=t.plugins;(this.plugins=e).addToScene(this,r.Global,[r.CoreScene,h(this),a(this)]),this.events.emit(o.BOOT,this),this.settings.isBooted=!0;},step:function(t,e){var i=this.events;i.emit(o.PRE_UPDATE,t,e),i.emit(o.UPDATE,t,e),this.sceneUpdate.call(this.scene,t,e),i.emit(o.POST_UPDATE,t,e);},render:function(t){var e=this.displayList;e.depthSort(),this.events.emit(o.PRE_RENDER,t),this.cameras.render(t,e),this.events.emit(o.RENDER,t);},queueDepthSort:function(){this.displayList.queueDepthSort();},depthSort:function(){this.displayList.depthSort();},pause:function(t){var e=this.events,i=this.settings;return this.settings.active&&(i.status=s.PAUSED,i.active=!1,e.emit(o.PAUSE,this,t)),this;},resume:function(t){var e=this.events,i=this.settings;return this.settings.active||(i.status=s.RUNNING,i.active=!0,e.emit(o.RESUME,this,t)),this;},sleep:function(t){var e=this.events,i=this.settings;return i.status=s.SLEEPING,i.active=!1,i.visible=!1,e.emit(o.SLEEP,this,t),this;},wake:function(t){var e=this.events,i=this.settings;return i.status=s.RUNNING,i.active=!0,i.visible=!0,e.emit(o.WAKE,this,t),i.isTransition&&e.emit(o.TRANSITION_WAKE,i.transitionFrom,i.transitionDuration),this;},getData:function(){return this.settings.data;},isSleeping:function(){return this.settings.status===s.SLEEPING;},isActive:function(){return this.settings.status===s.RUNNING;},isPaused:function(){return this.settings.status===s.PAUSED;},isTransitioning:function(){return this.settings.isTransition||null!==this.scenePlugin._target;},isTransitionOut:function(){return null!==this.scenePlugin._target&&0<this.scenePlugin._duration;},isTransitionIn:function(){return this.settings.isTransition;},isVisible:function(){return this.settings.visible;},setVisible:function(t){return this.settings.visible=t,this;},setActive:function(t,e){return t?this.resume(e):this.pause(e);},start:function(t){var e=this.events,i=this.settings;t&&(i.data=t),i.status=s.START,i.active=!0,i.visible=!0,e.emit(o.START,this),e.emit(o.READY,this,t);},shutdown:function(t){var e=this.events,i=this.settings;e.off(o.TRANSITION_INIT),e.off(o.TRANSITION_START),e.off(o.TRANSITION_COMPLETE),e.off(o.TRANSITION_OUT),i.status=s.SHUTDOWN,i.active=!1,i.visible=!1,this.renderer===u.WEBGL&&this.renderer.resetTextures(!0),e.emit(o.SHUTDOWN,this,t);},destroy:function(){var t=this.events,e=this.settings;e.status=s.DESTROYED,e.active=!1,e.visible=!1,t.emit(o.DESTROY,this),t.removeAllListeners();for(var i=["scene","game","anims","cache","plugins","registry","sound","textures","add","camera","displayList","events","make","scenePlugin","updateList"],n=0;n<i.length;n++)this[i[n]]=null;}});t.exports=d;},function(t,e){t.exports=function(t){return t&&t[0].toUpperCase()+t.slice(1);};},function(t,e,i){var n=i(33),s=i(0),a=i(109),o=i(424),r="Texture.frame missing: ",h=new s({initialize:function(t,e,i,n,s){Array.isArray(i)||(i=[i]),this.manager=t,this.key=e,this.source=[],this.dataSource=[],this.frames={},this.customData={},this.firstFrame="__BASE";for(var r=this.frameTotal=0;r<i.length;r++)this.source.push(new o(this,i[r],n,s));},add:function(t,e,i,n,s,r){if(this.has(t))return null;var o=new a(this,t,e,i,n,s,r);return this.frames[t]=o,"__BASE"===this.firstFrame&&(this.firstFrame=t),this.frameTotal++,o;},remove:function(t){return!!this.has(t)&&(this.get(t).destroy(),delete this.frames[t],!0);},has:function(t){return this.frames[t];},get:function(t){t=t||this.firstFrame;var e=this.frames[t];return e||(console.warn(r+t),e=this.frames[this.firstFrame]),e;},getTextureSourceIndex:function(t){for(var e=0;e<this.source.length;e++)if(this.source[e]===t)return e;return-1;},getFramesFromTextureSource:function(t,e){void 0===e&&(e=!1);var i,n=[];for(var s in this.frames){"__BASE"===s&&!e||(i=this.frames[s]).sourceIndex===t&&n.push(i);}return n;},getFrameNames:function(t){void 0===t&&(t=!1);var e,i=Object.keys(this.frames);return t||-1!==(e=i.indexOf("__BASE"))&&i.splice(e,1),i;},getSourceImage:function(t){null!=t&&1!==this.frameTotal||(t="__BASE");var e=this.frames[t];return e?e.source.image:(console.warn(r+t),this.frames.__BASE.source.image);},getDataSourceImage:function(t){null!=t&&1!==this.frameTotal||(t="__BASE");var e=this.frames[t],i=e?e.sourceIndex:(console.warn(r+t),this.frames.__BASE.sourceIndex);return this.dataSource[i].image;},setDataSource:function(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=this.source[e];this.dataSource.push(new o(this,t[e],i.width,i.height));}},setFilter:function(t){for(var e=0;e<this.source.length;e++)this.source[e].setFilter(t);for(e=0;e<this.dataSource.length;e++)this.dataSource[e].setFilter(t);},destroy:function(){for(var t=0;t<this.source.length;t++)this.source[t].destroy();for(t=0;t<this.dataSource.length;t++)this.dataSource[t].destroy();for(var e in this.frames){this.frames[e].destroy();}this.source=[],this.dataSource=[],this.frames={},this.manager.removeKey(this.key);var i=this.manager.game.renderer;i&&i.type===n.WEBGL&&i.resetTextures(!0),this.manager=null;}});t.exports=h;},function(t,e,i){var h=i(78);t.exports=function(t,e,i,n,s){void 0===n&&(n=0),void 0===s&&(s=t.length);var r=[];if(h(t,n,s))for(var o=n;o<s;o++){var a=t[o];(!e||e&&void 0===i&&a.hasOwnProperty(e)||e&&void 0!==i&&a[e]===i)&&r.push(a);}return r;};},function(t,e,i){t.exports={Matrix:i(1013),Add:i(1021),AddAt:i(1022),BringToTop:i(1023),CountAllMatching:i(1024),Each:i(1025),EachInRange:i(1026),FindClosestInSorted:i(318),GetAll:i(207),GetFirst:i(428),GetRandom:i(210),MoveDown:i(1027),MoveTo:i(1028),MoveUp:i(1029),MoveAbove:i(1030),MoveBelow:i(1031),NumberArray:i(322),NumberArrayStep:i(1032),QuickSelect:i(436),Range:i(437),Remove:i(93),RemoveAt:i(1033),RemoveBetween:i(1034),RemoveRandomElement:i(1035),Replace:i(1036),RotateLeft:i(178),RotateRight:i(179),SafeRange:i(78),SendToBack:i(1037),SetAll:i(1038),Shuffle:i(131),SortByDigits:i(320),SpliceOne:i(74),StableSort:i(79),Swap:i(1039)};},function(t,e){t.exports=function(t){if(!Array.isArray(t)||t.length<2||!Array.isArray(t[0]))return!1;for(var e=t[0].length,i=1;i<t.length;i++)if(t[i].length!==e)return!1;return!0;};},function(t,e){t.exports=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length);var n=e+Math.floor(Math.random()*i);return void 0===t[n]?null:t[n];};},function(t,e,i){var n=i(0),s=i(9),r=i(438),o=new n({Extends:s,initialize:function(){s.call(this),this._pending=[],this._active=[],this._destroy=[],this._toProcess=0,this.checkQueue=!1;},add:function(t){return this._pending.push(t),this._toProcess++,t;},remove:function(t){return this._destroy.push(t),this._toProcess++,t;},removeAll:function(){for(var t=this._active,e=this._destroy,i=t.length;i--;)e.push(t[i]),this._toProcess++;return this;},update:function(){if(0===this._toProcess)return this._active;for(var t,e=this._destroy,i=this._active,n=0;n<e.length;n++){t=e[n];var s=i.indexOf(t);-1!==s&&(i.splice(s,1),this.emit(r.PROCESS_QUEUE_REMOVE,t));}for(e.length=0,e=this._pending,n=0;n<e.length;n++)t=e[n],(!this.checkQueue||this.checkQueue&&-1===i.indexOf(t))&&(i.push(t),this.emit(r.PROCESS_QUEUE_ADD,t));return e.length=0,this._toProcess=0,i;},getActive:function(){return this._active;},length:{get:function(){return this._active.length;}},destroy:function(){this._toProcess=0,this._pending=[],this._active=[],this._destroy=[];}});t.exports=o;},function(t,e){function k(t,e){return parseInt(t.getAttribute(e),10);}t.exports=function(t,e,i,n,s){void 0===i&&(i=0),void 0===n&&(n=0);var r=e.cutX,o=e.cutY,a=e.source.width,h=e.source.height,u=e.sourceIndex,l={},c=t.getElementsByTagName("info")[0],d=t.getElementsByTagName("common")[0];l.font=c.getAttribute("face"),l.size=k(c,"size"),l.lineHeight=k(d,"lineHeight")+n,l.chars={};var f,p,g=t.getElementsByTagName("char"),v=void 0!==e&&e.trimmed;v&&(f=e.height,p=e.width);for(var m=0;m<g.length;m++){var y=g[m],x=k(y,"id"),T=String.fromCharCode(x),w=k(y,"x"),E=k(y,"y"),b=k(y,"width"),S=k(y,"height");v&&(w<p&&(p=w),E<f&&(f=E)),v&&0!==f&&0!==p&&(w-=e.x,E-=e.y);var A,_=(r+w)/a,C=(o+E)/h,R=(r+w+b)/a,M=(o+E+S)/h;l.chars[x]={x:w,y:E,width:b,height:S,centerX:Math.floor(b/2),centerY:Math.floor(S/2),xOffset:k(y,"xoffset"),yOffset:k(y,"yoffset"),xAdvance:k(y,"xadvance")+i,data:{},kerning:{},u0:_,v0:C,u1:R,v1:M},!s||0===b||0===S||(A=s.add(T,u,w,E,b,S))&&A.setUVs(b,S,_,C,R,M);}for(var P=t.getElementsByTagName("kerning"),m=0;m<P.length;m++){var O=P[m],L=k(O,"first"),D=k(O,"second"),F=k(O,"amount");l.chars[D].kerning[L]=F;}return l;};},function(t,e,i){var n=i(1049),o=i(440),s=i(0),r=i(11),a=i(109),h=i(15),u=i(110),l=new s({Extends:h,Mixins:[r.Alpha,r.BlendMode,r.Depth,r.Mask,r.Pipeline,r.ScrollFactor,r.Size,r.Texture,r.Transform,r.Visible,n],initialize:function(t,e,i,n,s){h.call(this,t,"Blitter"),this.setTexture(n,s),this.setPosition(e,i),this.initPipeline(),this.children=new u(),this.renderList=[],this.dirty=!1;},create:function(t,e,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=this.children.length),void 0===i?i=this.frame:i instanceof a||(i=this.texture.get(i));var r=new o(this,t,e,i,n);return this.children.addAt(r,s,!1),this.dirty=!0,r;},createFromCallback:function(t,e,i,n){for(var s=this.createMultiple(e,i,n),r=0;r<s.length;r++){var o=s[r];t.call(this,o,r);}return s;},createMultiple:function(i,t,n){void 0===t&&(t=this.frame.name),void 0===n&&(n=!0),Array.isArray(t)||(t=[t]);var s=[],r=this;return t.forEach(function(t){for(var e=0;e<i;e++)s.push(r.create(0,0,t,n));}),s;},childCanRender:function(t){return t.visible&&0<t.alpha;},getRenderList:function(){return this.dirty&&(this.renderList=this.children.list.filter(this.childCanRender,this),this.dirty=!1),this.renderList;},clear:function(){this.children.removeAll(),this.dirty=!0;},preDestroy:function(){this.children.destroy(),this.renderList=[];}});t.exports=l;},function(t,e,i){var r=i(208),s=i(35),n=i(0),o=i(11),a=i(75),h=i(15),u=i(10),l=i(1052),c=i(441),d=i(3),f=new n({Extends:h,Mixins:[o.AlphaSingle,o.BlendMode,o.ComputedSize,o.Depth,o.Mask,o.Pipeline,o.Transform,o.Visible,l],initialize:function(t,e,i,n){h.call(this,t,"Container"),this.list=[],this.exclusive=!0,this.maxSize=-1,this.position=0,this.localTransform=new o.TransformMatrix(),this.tempTransformMatrix=new o.TransformMatrix(),this._sortKey="",this._sysEvents=t.sys.events,this.scrollFactorX=1,this.scrollFactorY=1,this.initPipeline(),this.setPosition(e,i),this.clearAlpha(),this.setBlendMode(s.SKIP_CHECK),n&&this.add(n);},originX:{get:function(){return .5;}},originY:{get:function(){return .5;}},displayOriginX:{get:function(){return .5*this.width;}},displayOriginY:{get:function(){return .5*this.height;}},setExclusive:function(t){return void 0===t&&(t=!0),this.exclusive=t,this;},getBounds:function(t){var e;if(void 0===t&&(t=new u()),t.setTo(this.x,this.y,0,0),this.parentContainer&&(e=this.parentContainer.getBoundsTransformMatrix().transformPoint(this.x,this.y),t.setTo(e.x,e.y,0,0)),0<this.list.length){var i=this.list,n=new u(),s=!1;t.setEmpty();for(var r=0;r<i.length;r++){var o=i[r];o.getBounds&&(o.getBounds(n),s?c(n,t,t):(t.setTo(n.x,n.y,n.width,n.height),s=!0));}}return t;},addHandler:function(t){t.once(a.DESTROY,this.remove,this),this.exclusive&&(t.parentContainer&&t.parentContainer.remove(t),t.removeFromDisplayList(),t.parentContainer=this);},removeHandler:function(t){t.off(a.DESTROY,this.remove),this.exclusive&&(t.parentContainer=null,t.addToDisplayList());},pointToContainer:function(t,e){void 0===e&&(e=new d()),this.parentContainer?this.parentContainer.pointToContainer(t,e):e=new d(t.x,t.y);var i=this.tempTransformMatrix;return i.applyITRS(this.x,this.y,this.rotation,this.scaleX,this.scaleY),i.invert(),i.transformPoint(t.x,t.y,e),e;},getBoundsTransformMatrix:function(){return this.getWorldTransformMatrix(this.tempTransformMatrix,this.localTransform);},add:function(t){return r.Add(this.list,t,this.maxSize,this.addHandler,this),this;},addAt:function(t,e){return r.AddAt(this.list,t,e,this.maxSize,this.addHandler,this),this;},getAt:function(t){return this.list[t];},getIndex:function(t){return this.list.indexOf(t);},sort:function(i,t){return i&&(void 0===t&&(t=function(t,e){return t[i]-e[i];}),r.StableSort(this.list,t)),this;},getByName:function(t){return r.GetFirst(this.list,"name",t);},getRandom:function(t,e){return r.GetRandom(this.list,t,e);},getFirst:function(t,e,i,n){return r.GetFirst(this.list,t,e,i,n);},getAll:function(t,e,i,n){return r.GetAll(this.list,t,e,i,n);},count:function(t,e,i,n){return r.CountAllMatching(this.list,t,e,i,n);},swap:function(t,e){return r.Swap(this.list,t,e),this;},moveTo:function(t,e){return r.MoveTo(this.list,t,e),this;},moveAbove:function(t,e){return r.MoveAbove(this.list,t,e),this;},moveBelow:function(t,e){return r.MoveBelow(this.list,t,e),this;},remove:function(t,e){var i=r.Remove(this.list,t,this.removeHandler,this);if(e&&i){Array.isArray(i)||(i=[i]);for(var n=0;n<i.length;n++)i[n].destroy();}return this;},removeAt:function(t,e){var i=r.RemoveAt(this.list,t,this.removeHandler,this);return e&&i&&i.destroy(),this;},removeBetween:function(t,e,i){var n=r.RemoveBetween(this.list,t,e,this.removeHandler,this);if(i)for(var s=0;s<n.length;s++)n[s].destroy();return this;},removeAll:function(t){var e=r.RemoveBetween(this.list,0,this.list.length,this.removeHandler,this);if(t)for(var i=0;i<e.length;i++)e[i].destroy();return this;},bringToTop:function(t){return r.BringToTop(this.list,t),this;},sendToBack:function(t){return r.SendToBack(this.list,t),this;},moveUp:function(t){return r.MoveUp(this.list,t),this;},moveDown:function(t){return r.MoveDown(this.list,t),this;},reverse:function(){return this.list.reverse(),this;},shuffle:function(){return r.Shuffle(this.list),this;},replace:function(t,e,i){return r.Replace(this.list,t,e)&&(this.addHandler(e),this.removeHandler(t),i&&t.destroy()),this;},exists:function(t){return-1<this.list.indexOf(t);},setAll:function(t,e,i,n){return r.SetAll(this.list,t,e,i,n),this;},each:function(t,e){for(var i=[null],n=this.list.slice(),s=n.length,r=2;r<arguments.length;r++)i.push(arguments[r]);for(r=0;r<s;r++)i[0]=n[r],t.apply(e,i);return this;},iterate:function(t,e){for(var i=[null],n=2;n<arguments.length;n++)i.push(arguments[n]);for(n=0;n<this.list.length;n++)i[0]=this.list[n],t.apply(e,i);return this;},setScrollFactor:function(t,e,i){return void 0===e&&(e=t),void 0===i&&(i=!1),this.scrollFactorX=t,this.scrollFactorY=e,i&&(r.SetAll(this.list,"scrollFactorX",t),r.SetAll(this.list,"scrollFactorY",e)),this;},length:{get:function(){return this.list.length;}},first:{get:function(){return(this.position=0)<this.list.length?this.list[0]:null;}},last:{get:function(){return 0<this.list.length?(this.position=this.list.length-1,this.list[this.position]):null;}},next:{get:function(){return this.position<this.list.length?(this.position++,this.list[this.position]):null;}},previous:{get:function(){return 0<this.position?(this.position--,this.list[this.position]):null;}},preDestroy:function(){this.removeAll(!!this.exclusive),this.localTransform.destroy(),this.tempTransformMatrix.destroy(),this.list=[];}});t.exports=f;},function(t,e,i){var a=i(148),n=i(0),s=i(1057),r=new n({Extends:a,Mixins:[s],initialize:function(t,e,i,n,s,r,o){a.call(this,t,e,i,n,s,r,o),this.type="DynamicBitmapText",this.scrollX=0,this.scrollY=0,this.cropWidth=0,this.cropHeight=0,this.displayCallback,this.callbackData={parent:this,color:0,tint:{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},index:0,charCode:0,x:0,y:0,scale:0,rotation:0,data:0};},setSize:function(t,e){return this.cropWidth=t,this.cropHeight=e,this;},setDisplayCallback:function(t){return this.displayCallback=t,this;},setScrollX:function(t){return this.scrollX=t,this;},setScrollY:function(t){return this.scrollY=t,this;}});t.exports=r;},function(t,e,i){var n=i(133),s=i(0),h=i(217),r=i(303),o=i(304),a=i(305),u=i(309),l=i(167),c=i(312),d=i(313),f=i(314),p=i(111),g=i(15),v=i(2),m=i(6),y=i(14),x=i(1063),T=new s({Extends:g,Mixins:[r,o,a,u,l,d,f,c,x],initialize:function(t,e){var i=m(e,"x",0),n=m(e,"y",0);g.call(this,t,"Graphics"),this.setPosition(i,n),this.initPipeline(),this.displayOriginX=0,this.displayOriginY=0,this.commandBuffer=[],this.defaultFillColor=-1,this.defaultFillAlpha=1,this.defaultStrokeWidth=1,this.defaultStrokeColor=-1,this.defaultStrokeAlpha=1,this._lineWidth=1,this.setDefaultStyles(e);},setDefaultStyles:function(t){return m(t,"lineStyle",null)&&(this.defaultStrokeWidth=m(t,"lineStyle.width",1),this.defaultStrokeColor=m(t,"lineStyle.color",16777215),this.defaultStrokeAlpha=m(t,"lineStyle.alpha",1),this.lineStyle(this.defaultStrokeWidth,this.defaultStrokeColor,this.defaultStrokeAlpha)),m(t,"fillStyle",null)&&(this.defaultFillColor=m(t,"fillStyle.color",16777215),this.defaultFillAlpha=m(t,"fillStyle.alpha",1),this.fillStyle(this.defaultFillColor,this.defaultFillAlpha)),this;},lineStyle:function(t,e,i){return void 0===i&&(i=1),this.commandBuffer.push(h.LINE_STYLE,t,e,i),this._lineWidth=t,this;},fillStyle:function(t,e){return void 0===e&&(e=1),this.commandBuffer.push(h.FILL_STYLE,t,e),this;},fillGradientStyle:function(t,e,i,n,s,r,o,a){return void 0===s&&(s=1),void 0===r&&(r=s),void 0===o&&(o=s),void 0===a&&(a=s),this.commandBuffer.push(h.GRADIENT_FILL_STYLE,s,r,o,a,t,e,i,n),this;},lineGradientStyle:function(t,e,i,n,s,r){return void 0===r&&(r=1),this.commandBuffer.push(h.GRADIENT_LINE_STYLE,t,r,e,i,n,s),this;},beginPath:function(){return this.commandBuffer.push(h.BEGIN_PATH),this;},closePath:function(){return this.commandBuffer.push(h.CLOSE_PATH),this;},fillPath:function(){return this.commandBuffer.push(h.FILL_PATH),this;},fill:function(){return this.commandBuffer.push(h.FILL_PATH),this;},strokePath:function(){return this.commandBuffer.push(h.STROKE_PATH),this;},stroke:function(){return this.commandBuffer.push(h.STROKE_PATH),this;},fillCircleShape:function(t){return this.fillCircle(t.x,t.y,t.radius);},strokeCircleShape:function(t){return this.strokeCircle(t.x,t.y,t.radius);},fillCircle:function(t,e,i){return this.beginPath(),this.arc(t,e,i,0,y.PI2),this.fillPath(),this;},strokeCircle:function(t,e,i){return this.beginPath(),this.arc(t,e,i,0,y.PI2),this.strokePath(),this;},fillRectShape:function(t){return this.fillRect(t.x,t.y,t.width,t.height);},strokeRectShape:function(t){return this.strokeRect(t.x,t.y,t.width,t.height);},fillRect:function(t,e,i,n){return this.commandBuffer.push(h.FILL_RECT,t,e,i,n),this;},strokeRect:function(t,e,i,n){var s=this._lineWidth/2,r=t-s,o=t+s;return this.beginPath(),this.moveTo(t,e),this.lineTo(t,e+n),this.strokePath(),this.beginPath(),this.moveTo(t+i,e),this.lineTo(t+i,e+n),this.strokePath(),this.beginPath(),this.moveTo(r,e),this.lineTo(o+i,e),this.strokePath(),this.beginPath(),this.moveTo(r,e+n),this.lineTo(o+i,e+n),this.strokePath(),this;},fillRoundedRect:function(t,e,i,n,s){void 0===s&&(s=20);var r=s,o=s,a=s,h=s;return"number"!=typeof s&&(r=v(s,"tl",20),o=v(s,"tr",20),a=v(s,"bl",20),h=v(s,"br",20)),this.beginPath(),this.moveTo(t+r,e),this.lineTo(t+i-o,e),this.arc(t+i-o,e+o,o,-y.TAU,0),this.lineTo(t+i,e+n-h),this.arc(t+i-h,e+n-h,h,0,y.TAU),this.lineTo(t+a,e+n),this.arc(t+a,e+n-a,a,y.TAU,Math.PI),this.lineTo(t,e+r),this.arc(t+r,e+r,r,-Math.PI,-y.TAU),this.fillPath(),this;},strokeRoundedRect:function(t,e,i,n,s){void 0===s&&(s=20);var r=s,o=s,a=s,h=s;return"number"!=typeof s&&(r=v(s,"tl",20),o=v(s,"tr",20),a=v(s,"bl",20),h=v(s,"br",20)),this.beginPath(),this.moveTo(t+r,e),this.lineTo(t+i-o,e),this.moveTo(t+i-o,e),this.arc(t+i-o,e+o,o,-y.TAU,0),this.lineTo(t+i,e+n-h),this.moveTo(t+i,e+n-h),this.arc(t+i-h,e+n-h,h,0,y.TAU),this.lineTo(t+a,e+n),this.moveTo(t+a,e+n),this.arc(t+a,e+n-a,a,y.TAU,Math.PI),this.lineTo(t,e+r),this.moveTo(t,e+r),this.arc(t+r,e+r,r,-Math.PI,-y.TAU),this.strokePath(),this;},fillPointShape:function(t,e){return this.fillPoint(t.x,t.y,e);},fillPoint:function(t,e,i){return!i||i<1?i=1:(t-=i/2,e-=i/2),this.commandBuffer.push(h.FILL_RECT,t,e,i,i),this;},fillTriangleShape:function(t){return this.fillTriangle(t.x1,t.y1,t.x2,t.y2,t.x3,t.y3);},strokeTriangleShape:function(t){return this.strokeTriangle(t.x1,t.y1,t.x2,t.y2,t.x3,t.y3);},fillTriangle:function(t,e,i,n,s,r){return this.commandBuffer.push(h.FILL_TRIANGLE,t,e,i,n,s,r),this;},strokeTriangle:function(t,e,i,n,s,r){return this.commandBuffer.push(h.STROKE_TRIANGLE,t,e,i,n,s,r),this;},strokeLineShape:function(t){return this.lineBetween(t.x1,t.y1,t.x2,t.y2);},lineBetween:function(t,e,i,n){return this.beginPath(),this.moveTo(t,e),this.lineTo(i,n),this.strokePath(),this;},lineTo:function(t,e){return this.commandBuffer.push(h.LINE_TO,t,e),this;},moveTo:function(t,e){return this.commandBuffer.push(h.MOVE_TO,t,e),this;},strokePoints:function(t,e,i,n){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=t.length),this.beginPath(),this.moveTo(t[0].x,t[0].y);for(var s=1;s<n;s++)this.lineTo(t[s].x,t[s].y);return e&&this.lineTo(t[0].x,t[0].y),i&&this.closePath(),this.strokePath(),this;},fillPoints:function(t,e,i,n){void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=t.length),this.beginPath(),this.moveTo(t[0].x,t[0].y);for(var s=1;s<n;s++)this.lineTo(t[s].x,t[s].y);return e&&this.lineTo(t[0].x,t[0].y),i&&this.closePath(),this.fillPath(),this;},strokeEllipseShape:function(t,e){void 0===e&&(e=32);var i=t.getPoints(e);return this.strokePoints(i,!0);},strokeEllipse:function(t,e,i,n,s){void 0===s&&(s=32);var r=new p(t,e,i,n).getPoints(s);return this.strokePoints(r,!0);},fillEllipseShape:function(t,e){void 0===e&&(e=32);var i=t.getPoints(e);return this.fillPoints(i,!0);},fillEllipse:function(t,e,i,n,s){void 0===s&&(s=32);var r=new p(t,e,i,n).getPoints(s);return this.fillPoints(r,!0);},arc:function(t,e,i,n,s,r,o){return void 0===r&&(r=!1),void 0===o&&(o=0),this.commandBuffer.push(h.ARC,t,e,i,n,s,r,o),this;},slice:function(t,e,i,n,s,r,o){return void 0===r&&(r=!1),void 0===o&&(o=0),this.commandBuffer.push(h.BEGIN_PATH),this.commandBuffer.push(h.MOVE_TO,t,e),this.commandBuffer.push(h.ARC,t,e,i,n,s,r,o),this.commandBuffer.push(h.CLOSE_PATH),this;},save:function(){return this.commandBuffer.push(h.SAVE),this;},restore:function(){return this.commandBuffer.push(h.RESTORE),this;},translateCanvas:function(t,e){return this.commandBuffer.push(h.TRANSLATE,t,e),this;},scaleCanvas:function(t,e){return this.commandBuffer.push(h.SCALE,t,e),this;},rotateCanvas:function(t){return this.commandBuffer.push(h.ROTATE,t),this;},clear:function(){return this.commandBuffer.length=0,-1<this.defaultFillColor&&this.fillStyle(this.defaultFillColor,this.defaultFillAlpha),-1<this.defaultStrokeColor&&this.lineStyle(this.defaultStrokeWidth,this.defaultStrokeColor,this.defaultStrokeAlpha),this;},generateTexture:function(t,e,i){var n,s,r,o=this.scene.sys,a=o.game.renderer;return void 0===e&&(e=o.scale.width),void 0===i&&(i=o.scale.height),T.TargetCamera.setScene(this.scene),T.TargetCamera.setViewport(0,0,e,i),T.TargetCamera.scrollX=this.x,T.TargetCamera.scrollY=this.y,"string"==typeof t?o.textures.exists(t)?(r=(n=o.textures.get(t)).getSourceImage())instanceof HTMLCanvasElement&&(s=r.getContext("2d")):s=(n=o.textures.createCanvas(t,e,i)).getSourceImage().getContext("2d"):t instanceof HTMLCanvasElement&&(s=t.getContext("2d")),s&&(this.renderCanvas(a,this,T.TargetCamera,null,s,!1),n&&n.refresh()),this;},preDestroy:function(){this.commandBuffer=[];}});T.TargetCamera=new n(),t.exports=T;},function(t,e){t.exports={ARC:0,BEGIN_PATH:1,CLOSE_PATH:2,FILL_RECT:3,LINE_TO:4,MOVE_TO:5,LINE_STYLE:6,FILL_STYLE:7,FILL_PATH:8,STROKE_PATH:9,FILL_TRIANGLE:10,STROKE_TRIANGLE:11,SAVE:14,RESTORE:15,TRANSLATE:16,SCALE:17,ROTATE:18,GRADIENT_FILL_STYLE:21,GRADIENT_LINE_STYLE:22};},function(t,e,i){var r=i(4);t.exports=function(t,e,i){void 0===i&&(i=new r());var n=t.width/2,s=t.height/2;return i.x=t.x+n*Math.cos(e),i.y=t.y+s*Math.sin(e),i;};},function(t,e,i){var n=i(35),s=i(0),r=i(11),o=i(176),a=i(101),h=i(9),u=i(75),l=i(110),c=i(1071),d=i(20),f=i(79),p=new s({Extends:l,Mixins:[r.AlphaSingle,r.BlendMode,r.Depth,r.Mask,r.Pipeline,r.Visible,h,c],initialize:function(t,e){l.call(this,t),h.call(this),this.scene=t,this.displayList=null,this.type="Layer",this.state=0,this.parentContainer=null,this.name="",this.active=!0,this.tabIndex=-1,this.data=null,this.renderFlags=15,this.cameraFilter=0,this.input=null,this.body=null,this.ignoreDestroy=!1,this.systems=t.sys,this.events=t.sys.events,this.sortChildrenFlag=!1,this.addCallback=this.addChildCallback,this.removeCallback=this.removeChildCallback,this.initPipeline(),this.clearAlpha(),this.setBlendMode(n.SKIP_CHECK),e&&this.add(e),t.sys.queueDepthSort();},setActive:function(t){return this.active=t,this;},setName:function(t){return this.name=t,this;},setState:function(t){return this.state=t,this;},setDataEnabled:function(){return this.data||(this.data=new a(this)),this;},setData:function(t,e){return this.data||(this.data=new a(this)),this.data.set(t,e),this;},incData:function(t,e){return this.data||(this.data=new a(this)),this.data.inc(t,e),this;},toggleData:function(t){return this.data||(this.data=new a(this)),this.data.toggle(t),this;},getData:function(t){return this.data||(this.data=new a(this)),this.data.get(t);},setInteractive:function(){return this;},disableInteractive:function(){return this;},removeInteractive:function(){return this;},addedToScene:function(){},removedFromScene:function(){},update:function(){},toJSON:function(){return o(this);},willRender:function(t){return!(15!==this.renderFlags||0===this.list.length||0!==this.cameraFilter&&this.cameraFilter&t.id);},getIndexList:function(){for(var t=this,e=this.parentContainer,i=[];e&&(i.unshift(e.getIndex(t)),(t=e).parentContainer);)e=e.parentContainer;return i.unshift(this.displayList.getIndex(t)),i;},addChildCallback:function(t){t.displayList&&t.displayList!==this&&t.removeFromDisplayList(),t.displayList||(this.queueDepthSort(),t.displayList=this,t.emit(u.ADDED_TO_SCENE,t,this.scene),this.events.emit(d.ADDED_TO_SCENE,t,this.scene));},removeChildCallback:function(t){this.queueDepthSort(),t.displayList=null,t.emit(u.REMOVED_FROM_SCENE,t,this.scene),this.events.emit(d.REMOVED_FROM_SCENE,t,this.scene);},queueDepthSort:function(){this.sortChildrenFlag=!0;},depthSort:function(){this.sortChildrenFlag&&(f(this.list,this.sortByDepth),this.sortChildrenFlag=!1);},sortByDepth:function(t,e){return t._depth-e._depth;},getChildren:function(){return this.list;},destroy:function(){if(this.scene&&!this.ignoreDestroy){this.emit(u.DESTROY,this);for(var t=this.list.length;t--;)this.list[t].destroy();this.removeAllListeners(),this.resetPostPipeline(!0),this.displayList&&(this.displayList.remove(this,!0),this.displayList.queueDepthSort()),this.data&&(this.data.destroy(),this.data=void 0),this.active=!1,this.visible=!1,this.list=void 0,this.scene=void 0,this.displayList=void 0,this.systems=void 0,this.events=void 0;}}});t.exports=p;},function(t,e,i){var n=i(0),s=i(11),r=i(15),o=i(450),a=i(110),h=i(452),u=i(1075),l=new n({Extends:r,Mixins:[s.Depth,s.Mask,s.Pipeline,s.Transform,s.Visible,u],initialize:function(t,e,i,n){if(r.call(this,t,"ParticleEmitterManager"),this.blendMode=-1,this.timeScale=1,this.texture=null,this.frame=null,this.frameNames=[],null===i||"object"!=typeof i&&!Array.isArray(i)||(n=i,i=null),this.setTexture(e,i),this.initPipeline(),this.emitters=new a(this),this.wells=new a(this),n){Array.isArray(n)||(n=[n]);for(var s=0;s<n.length;s++)this.createEmitter(n[s]);}},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},setTexture:function(t,e){return this.texture=this.scene.sys.textures.get(t),this.setFrame(e);},setFrame:function(t){this.frame=this.texture.get(t);var e=this.texture.getFramesFromTextureSource(this.frame.sourceIndex),i=[];return e.forEach(function(t){i.push(t.name);}),this.frameNames=i,this.defaultFrame=this.frame,this;},setEmitterFrames:function(t,e){Array.isArray(t)||(t=[t]);for(var i=e.frames,n=i.length=0;n<t.length;n++){var s=t[n];-1!==this.frameNames.indexOf(s)&&i.push(this.texture.get(s));}return 0<i.length?e.defaultFrame=i[0]:e.defaultFrame=this.defaultFrame,this;},addEmitter:function(t){return this.emitters.add(t);},createEmitter:function(t){return this.addEmitter(new h(this,t));},removeEmitter:function(t){return this.emitters.remove(t,!0);},addGravityWell:function(t){return this.wells.add(t);},createGravityWell:function(t){return this.addGravityWell(new o(t));},emitParticle:function(t,e,i){for(var n=this.emitters.list,s=0;s<n.length;s++){var r=n[s];r.active&&r.emitParticle(t,e,i);}return this;},emitParticleAt:function(t,e,i){return this.emitParticle(i,t,e);},pause:function(){return this.active=!1,this;},resume:function(){return this.active=!0,this;},getProcessors:function(){return this.wells.getAll("active",!0);},preUpdate:function(t,e){e*=this.timeScale;for(var i=this.emitters.list,n=0;n<i.length;n++){var s=i[n];s.active&&s.preUpdate(t,e);}},setAlpha:function(){},setScrollFactor:function(){},setBlendMode:function(){}});t.exports=l;},function(t,e,i){var o=i(35),h=i(133),u=i(31),n=i(0),s=i(11),l=i(33),a=i(109),c=i(15),d=i(1),f=i(92),r=i(1079),p=i(141),x=i(12),g=i(222),v=new n({Extends:c,Mixins:[s.Alpha,s.BlendMode,s.ComputedSize,s.Crop,s.Depth,s.Flip,s.GetBounds,s.Mask,s.Origin,s.Pipeline,s.ScrollFactor,s.Tint,s.Transform,s.Visible,r],initialize:function(t,e,i,n,s,r,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=32),void 0===s&&(s=32),c.call(this,t,"RenderTexture"),this.renderer=t.sys.renderer,this.textureManager=t.sys.textures,this.globalTint=16777215,this.globalAlpha=1,this.canvas=null,this.dirty=!1,this._crop=this.resetCropObject(),this.texture=null,this.frame=null,this._saved=!1,void 0===r?(this.canvas=u.create2D(this,n,s),this.texture=t.sys.textures.addCanvas(g(),this.canvas),this.frame=this.texture.get()):(this.texture=t.sys.textures.get(r),this.frame=this.texture.get(o),this.canvas=this.frame.source.image,this._saved=!0,this.dirty=!0,this.width=this.frame.cutWidth,this.height=this.frame.cutHeight),this.context=this.canvas.getContext("2d"),this._eraseMode=!1,this.camera=new h(0,0,n,s),this.renderTarget=null;var a=this.renderer;a?a.type===l.WEBGL?(this.drawGameObject=this.batchGameObjectWebGL,this.renderTarget=new p(a,n,s,1,0,!1)):a.type===l.CANVAS&&(this.drawGameObject=this.batchGameObjectCanvas):this.drawGameObject=d,this.camera.setScene(t),this.setPosition(e,i),void 0===r&&this.setSize(n,s),this.setOrigin(0,0),this.initPipeline(f.SINGLE_PIPELINE);},setSize:function(t,e){return this.resize(t,e);},resize:function(t,e){void 0===e&&(e=t);var i,n,s=this.frame;t!==this.width||e!==this.height?"__BASE"===s.name&&(this.canvas.width=t,this.canvas.height=e,this.texture.width=t,this.texture.height=e,(i=this.renderTarget)&&(i.resize(t,e),s.glTexture=i.texture,s.source.isRenderTexture=!0,s.source.isGLTexture=!0,s.source.glTexture=i.texture),this.camera.setSize(t,e),s.source.width=t,s.source.height=e,s.setSize(t,e),this.width=t,this.height=e):(n=this.texture.getSourceImage(),s.cutX+t>n.width&&(t=n.width-s.cutX),s.cutY+e>n.height&&(e=n.height-s.cutY),s.setSize(t,e,s.cutX,s.cutY)),this.updateDisplayOrigin();var r=this.input;return r&&!r.customHitArea&&(r.hitArea.width=t,r.hitArea.height=e),this;},setGlobalTint:function(t){return this.globalTint=t,this;},setGlobalAlpha:function(t){return this.globalAlpha=t,this;},saveTexture:function(t){return this.textureManager.renameTexture(this.texture.key,t),this._saved=!0,this.texture;},fill:function(t,e,i,n,s,r){var o=this.frame,a=this.camera,h=this.renderer;void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=o.cutWidth),void 0===r&&(r=o.cutHeight);var u,l,c,d,f,p,g=(t>>16&255)/255,v=(t>>8&255)/255,m=(255&t)/255,y=this.renderTarget;return a.preRender(),y?(y.bind(!0),(u=this.pipeline).manager.set(u),l=y.width,c=y.height,d=h.width/l,f=h.height/c,u.drawFillRect(i*d,n*f,s*d,r*f,x.getTintFromFloats(m,v,g,1),e),y.unbind(!0)):(p=this.context,h.setContext(p),p.fillStyle="rgba("+g+","+v+","+m+","+e+")",p.fillRect(i+o.cutX,n+o.cutY,s,r),h.setContext()),this.dirty=!0,this;},clear:function(){var t,e;return this.dirty&&((t=this.renderTarget)?t.clear():((e=this.context).save(),e.setTransform(1,0,0,1,0,0),e.clearRect(this.frame.cutX,this.frame.cutY,this.frame.cutWidth,this.frame.cutHeight),e.restore()),this.dirty=!1),this;},erase:function(t,e,i){return this._eraseMode=!0,this.draw(t,e,i,1,16777215),this._eraseMode=!1,this;},draw:function(t,e,i,n,s){return this.beginDraw(),this.batchDraw(t,e,i,n,s),this.endDraw(),this;},drawFrame:function(t,e,i,n,s,r){return this.beginDraw(),this.batchDrawFrame(t,e,i,n,s,r),this.endDraw(),this;},beginDraw:function(){var t=this.camera,e=this.renderer,i=this.renderTarget;return t.preRender(),i?e.beginCapture(i.width,i.height):e.setContext(this.context),this;},batchDraw:function(t,e,i,n,s){return void 0===n&&(n=this.globalAlpha),s=void 0===s?(this.globalTint>>16)+(65280&this.globalTint)+((255&this.globalTint)<<16):(s>>16)+(65280&s)+((255&s)<<16),Array.isArray(t)||(t=[t]),this.batchList(t,e,i,n,s),this;},batchDrawFrame:function(t,e,i,n,s,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=this.globalAlpha),r=void 0===r?(this.globalTint>>16)+(65280&this.globalTint)+((255&this.globalTint)<<16):(r>>16)+(65280&r)+((255&r)<<16);var o=this.textureManager.getFrame(t,e);return o&&(this.renderTarget?this.pipeline.batchTextureFrame(o,i,n,r,s,this.camera.matrix,null):this.batchTextureFrame(o,i+this.frame.cutX,n+this.frame.cutY,s,r)),this;},endDraw:function(t){void 0===t&&(t=this._eraseMode);var e,i=this.renderer,n=this.renderTarget;return n?(e=i.endCapture(),i.pipelines.setUtility().blitFrame(e,n,1,!1,!1,t),i.resetScissor(),i.resetViewport()):i.setContext(),this.dirty=!0,this;},batchList:function(t,e,i,n,s){for(var r=0;r<t.length;r++){var o=t[r];o&&o!==this&&(o.renderWebGL||o.renderCanvas?this.drawGameObject(o,e,i):o.isParent||o.list?this.batchGroup(o.getChildren(),e,i):"string"==typeof o?this.batchTextureFrameKey(o,null,e,i,n,s):o instanceof a?this.batchTextureFrame(o,e,i,n,s):Array.isArray(o)&&this.batchList(o,e,i,n,s));}},batchGroup:function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),e+=this.frame.cutX,i+=this.frame.cutY;for(var n=0;n<t.length;n++){var s,r,o=t[n];o.willRender(this.camera)&&(s=o.x+e,r=o.y+i,this.drawGameObject(o,s,r));}},batchGameObjectWebGL:function(t,e,i){void 0===e&&(e=t.x),void 0===i&&(i=t.y);var n=t.x,s=t.y;t.setPosition(e+this.frame.cutX,i+this.frame.cutY),t.renderDirect?t.renderDirect(this.renderer,t,this.camera):t.renderWebGL(this.renderer,t,this.camera),t.setPosition(n,s);},batchGameObjectCanvas:function(t,e,i){void 0===e&&(e=t.x),void 0===i&&(i=t.y);var n,s=t.x,r=t.y;this._eraseMode&&(n=t.blendMode,t.blendMode=o.ERASE),t.setPosition(e+this.frame.cutX,i+this.frame.cutY),t.renderCanvas(this.renderer,t,this.camera,null),t.setPosition(s,r),this._eraseMode&&(t.blendMode=n);},batchTextureFrameKey:function(t,e,i,n,s,r){var o=this.textureManager.getFrame(t,e);o&&this.batchTextureFrame(o,i,n,s,r);},batchTextureFrame:function(t,e,i,n,s){var r,o,a,h;void 0===e&&(e=0),void 0===i&&(i=0),e+=this.frame.cutX,i+=this.frame.cutY,this.renderTarget?this.pipeline.batchTextureFrame(t,e,i,s,n,this.camera.matrix,null):(r=this.context,o=t.canvasData,a=t.source.image,h=this.camera.matrix,r.save(),r.globalCompositeOperation=this._eraseMode?"destination-out":"source-over",r.globalAlpha=n,h.setToContext(r),r.drawImage(a,o.x,o.y,o.width,o.height,e,i,o.width,o.height),r.restore());},snapshotArea:function(t,e,i,n,s,r,o){return this.renderTarget?this.renderer.snapshotFramebuffer(this.renderTarget.framebuffer,this.width,this.height,s,!1,t,e,i,n,r,o):this.renderer.snapshotCanvas(this.canvas,s,!1,t,e,i,n,r,o),this;},snapshot:function(t,e,i){return this.renderTarget?this.renderer.snapshotFramebuffer(this.renderTarget.framebuffer,this.width,this.height,t,!1,0,0,this.width,this.height,e,i):this.renderer.snapshotCanvas(this.canvas,t,!1,0,0,this.width,this.height,e,i),this;},snapshotPixel:function(t,e,i){return this.renderTarget?this.renderer.snapshotFramebuffer(this.renderTarget.framebuffer,this.width,this.height,i,!0,t,e):this.renderer.snapshotCanvas(this.canvas,i,!0,t,e),this;},preDestroy:function(){this._saved||(u.remove(this.canvas),this.renderTarget&&this.renderTarget.destroy(),this.texture.destroy(),this.camera.destroy(),this.canvas=null,this.context=null,this.texture=null);}});t.exports=v;},function(t,e){t.exports=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16);});};},function(t,e,i){var u=i(164),n=i(0),s=i(11),l=i(15),c=i(92),r=i(1085),d=i(3),o=new n({Extends:l,Mixins:[s.AlphaSingle,s.BlendMode,s.Depth,s.Flip,s.Mask,s.Pipeline,s.Size,s.Texture,s.Transform,s.Visible,s.ScrollFactor,r],initialize:function(t,e,i,n,s,r,o,a,h){void 0===n&&(n="__DEFAULT"),void 0===r&&(r=2),void 0===o&&(o=!0),l.call(this,t,"Rope"),this.anims=new u(this),this.points=r,this.vertices,this.uv,this.colors,this.alphas,this.tintFill="__DEFAULT"===n,this.dirty=!1,this.horizontal=o,this._flipX=!1,this._flipY=!1,this._perp=new d(),this.debugCallback=null,this.debugGraphic=null,this.setTexture(n,s),this.setPosition(e,i),this.setSizeToFrame(),this.initPipeline(c.ROPE_PIPELINE),Array.isArray(r)&&this.resizeArrays(r.length),this.setPoints(r,a,h),this.updateVertices();},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},preUpdate:function(t,e){var i=this.anims.currentFrame;this.anims.update(t,e),this.anims.currentFrame!==i&&(this.updateUVs(),this.updateVertices());},play:function(t,e,i){return this.anims.play(t,e,i),this;},setDirty:function(){return this.dirty=!0,this;},setHorizontal:function(t,e,i){return void 0===t&&(t=this.points.length),this.horizontal?this:(this.horizontal=!0,this.setPoints(t,e,i));},setVertical:function(t,e,i){return void 0===t&&(t=this.points.length),this.horizontal?(this.horizontal=!1,this.setPoints(t,e,i)):this;},setTintFill:function(t){return void 0===t&&(t=!1),this.tintFill=t,this;},setAlphas:function(t,e){var i=this.points.length;if(i<1)return this;var n=this.alphas;void 0===t?t=[1]:Array.isArray(t)||void 0!==e||(t=[t]);var s=0;if(void 0!==e)for(o=0;o<i;o++)n[s=2*o]=t,n[s+1]=e;else if(t.length===i)for(o=0;o<i;o++)n[s=2*o]=t[o],n[s+1]=t[o];else for(var r=t[0],o=0;o<i;o++)s=2*o,t.length>s&&(r=t[s]),n[s]=r,t.length>s+1&&(r=t[s+1]),n[s+1]=r;return this;},setColors:function(t){var e=this.points.length;if(e<1)return this;var i=this.colors;void 0===t?t=[16777215]:Array.isArray(t)||(t=[t]);var n=0;if(t.length===e)for(r=0;r<e;r++)i[n=2*r]=t[r],i[n+1]=t[r];else for(var s=t[0],r=0;r<e;r++)n=2*r,t.length>n&&(s=t[n]),i[n]=s,t.length>n+1&&(s=t[n+1]),i[n+1]=s;return this;},setPoints:function(t,e,i){if(void 0===t&&(t=2),"number"==typeof t){var n,s,r,o=t;if(o<2&&(o=2),t=[],this.horizontal)for(r=-this.frame.halfWidth,s=this.frame.width/(o-1),n=0;n<o;n++)t.push({x:r+n*s,y:0});else for(r=-this.frame.halfHeight,s=this.frame.height/(o-1),n=0;n<o;n++)t.push({x:0,y:r+n*s});}var a=t.length,h=this.points.length;return a<1?console.warn("Rope: Not enough points given"):(1===a&&(t.unshift({x:0,y:0}),a++),h!==a&&this.resizeArrays(a),this.points=t,this.updateUVs(),null!=e&&this.setColors(e),null!=i&&this.setAlphas(i)),this;},updateUVs:function(){for(var t=this.uv,e=this.points.length,i=this.frame.u0,n=this.frame.v0,s=this.frame.u1,r=this.frame.v1,o=(s-i)/(e-1),a=(r-n)/(e-1),h=0;h<e;h++){var u,l,c,d=4*h,f=this.horizontal?(c=u=this._flipX?s-h*o:i+h*o,this._flipY?(l=r,n):(l=n,r)):(c=this._flipX?(u=i,s):(u=s,i),l=this._flipY?r-h*a:n+h*a);t[0+d]=u,t[1+d]=l,t[2+d]=c,t[3+d]=f;}return this;},resizeArrays:function(t){var e=this.colors,i=this.alphas;this.vertices=new Float32Array(4*t),this.uv=new Float32Array(4*t),e=new Uint32Array(2*t),i=new Float32Array(2*t);for(var n=0;n<2*t;n++)e[n]=16777215,i[n]=1;return this.colors=e,this.alphas=i,this.dirty=!0,this;},updateVertices:function(){var t=this._perp,e=this.points,i=this.vertices,n=e.length;if(this.dirty=!1,!(n<1)){for(var s=e[0],r=this.horizontal?this.frame.halfHeight:this.frame.halfWidth,o=0;o<n;o++){var a=e[o],h=4*o,u=o<n-1?e[o+1]:a;t.x=u.y-s.y,t.y=-(u.x-s.x);var l=t.length();t.x/=l,t.y/=l,t.x*=r,t.y*=r,i[h]=a.x+t.x,i[1+h]=a.y+t.y,i[2+h]=a.x-t.x,i[3+h]=a.y-t.y,s=a;}return this;}},setDebug:function(t,e){return this.debugGraphic=t,this.debugCallback=t||e?e||this.renderDebugVerts:null,this;},renderDebugVerts:function(t,e,i){var n=t.debugGraphic,s=i[0],r=i[1],o=i[2],a=i[3];n.lineBetween(s,r,o,a);for(var h=4;h<e;h+=4){var u=i[h+0],l=i[h+1],c=i[h+2],d=i[h+3];n.lineBetween(s,r,u,l),n.lineBetween(o,a,c,d),n.lineBetween(o,a,u,l),n.lineBetween(u,l,c,d),s=u,r=l,o=c,a=d;}},preDestroy:function(){this.anims.destroy(),this.anims=void 0,this.points=null,this.vertices=null,this.uv=null,this.colors=null,this.alphas=null,this.debugCallback=null,this.debugGraphic=null;},flipX:{get:function(){return this._flipX;},set:function(t){return this._flipX=t,this.updateUVs();}},flipY:{get:function(){return this._flipY;},set:function(t){return this._flipY=t,this.updateUVs();}}});t.exports=o;},function(t,e,i){var n=i(142),r=i(31),s=i(0),o=i(11),a=i(22),h=i(15),E=i(458),u=i(6),l=i(202),c=i(1088),d=i(459),f=new s({Extends:h,Mixins:[o.Alpha,o.BlendMode,o.ComputedSize,o.Crop,o.Depth,o.Flip,o.GetBounds,o.Mask,o.Origin,o.Pipeline,o.ScrollFactor,o.Tint,o.Transform,o.Visible,c],initialize:function(t,e,i,n,s){void 0===e&&(e=0),void 0===i&&(i=0),h.call(this,t,"Text"),this.renderer=t.sys.renderer,this.setPosition(e,i),this.setOrigin(0,0),this.initPipeline(),this.canvas=r.create(this),this.context=this.canvas.getContext("2d"),this.style=new d(this,s),this.autoRound=!0,this.splitRegExp=/(?:\r\n|\r|\n)/,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.lineSpacing=0,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=1),this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),this.initRTL(),this.setText(n),s&&s.padding&&this.setPadding(s.padding),s&&s.lineSpacing&&this.setLineSpacing(s.lineSpacing),t.sys.game.events.on(a.CONTEXT_RESTORED,function(){this.dirty=!0;},this);},initRTL:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",n(this.canvas,this.scene.sys.canvas),this.originX=1);},runWordWrap:function(t){var e=this.style;if(e.wordWrapCallback){var i=e.wordWrapCallback.call(e.wordWrapCallbackScope,t,this);return Array.isArray(i)&&(i=i.join("\n")),i;}return e.wordWrapWidth?e.wordWrapUseAdvanced?this.advancedWordWrap(t,this.context,this.style.wordWrapWidth):this.basicWordWrap(t,this.context,this.style.wordWrapWidth):t;},advancedWordWrap:function(t,e,i){for(var n="",s=t.replace(/ +/gi," ").split(this.splitRegExp),r=s.length,o=0;o<r;o++){var a="",h=(h=s[o]).replace(/^ *|\s*$/gi,"");if(e.measureText(h).width<i)n+=h+"\n";else{for(var u=i,l=h.split(" "),c=0;c<l.length;c++){var d=l[c],f=d+" ",p=e.measureText(f).width;if(u<p){if(0===c){for(var g=f;g.length&&(g=g.slice(0,-1),!((p=e.measureText(g).width)<=u)););if(!g.length)throw new Error("This text's wordWrapWidth setting is less than a single character!");var v=d.substr(g.length);l[c]=v,a+=g;}var m=l[c].length?c:c+1,y=l.slice(m).join(" ").replace(/[ \n]*$/gi,"");s[o+1]=y+" "+(s[o+1]||""),r=s.length;break;}a+=f,u-=p;}n+=a.replace(/[ \n]*$/gi,"")+"\n";}}return n=n.replace(/[\s|\n]*$/gi,"");},basicWordWrap:function(t,e,i){for(var n="",s=t.split(this.splitRegExp),r=s.length-1,o=e.measureText(" ").width,a=0;a<=r;a++){for(var h=i,u=s[a].split(" "),l=u.length-1,c=0;c<=l;c++){var d=u[c],f=e.measureText(d).width,p=f;c<l&&(p+=o),h<p&&0<c&&(n+="\n",h=i),n+=d,c<l?(n+=" ",h-=p):h-=f;}a<r&&(n+="\n");}return n;},getWrappedText:function(t){return void 0===t&&(t=this._text),this.style.syncFont(this.canvas,this.context),this.runWordWrap(t).split(this.splitRegExp);},setText:function(t){return t||0===t||(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this;},setStyle:function(t){return this.style.setStyle(t);},setFont:function(t){return this.style.setFont(t);},setFontFamily:function(t){return this.style.setFontFamily(t);},setFontSize:function(t){return this.style.setFontSize(t);},setFontStyle:function(t){return this.style.setFontStyle(t);},setFixedSize:function(t,e){return this.style.setFixedSize(t,e);},setBackgroundColor:function(t){return this.style.setBackgroundColor(t);},setFill:function(t){return this.style.setFill(t);},setColor:function(t){return this.style.setColor(t);},setStroke:function(t,e){return this.style.setStroke(t,e);},setShadow:function(t,e,i,n,s,r){return this.style.setShadow(t,e,i,n,s,r);},setShadowOffset:function(t,e){return this.style.setShadowOffset(t,e);},setShadowColor:function(t){return this.style.setShadowColor(t);},setShadowBlur:function(t){return this.style.setShadowBlur(t);},setShadowStroke:function(t){return this.style.setShadowStroke(t);},setShadowFill:function(t){return this.style.setShadowFill(t);},setWordWrapWidth:function(t,e){return this.style.setWordWrapWidth(t,e);},setWordWrapCallback:function(t,e){return this.style.setWordWrapCallback(t,e);},setAlign:function(t){return this.style.setAlign(t);},setResolution:function(t){return this.style.setResolution(t);},setLineSpacing:function(t){return this.lineSpacing=t,this.updateText();},setPadding:function(t,e,i,n){var s,r,o;return"object"==typeof t?(i=null!==(r=u(s=t,"x",null))?t=r:(t=u(s,"left",0),u(s,"right",t)),n=null!==(o=u(s,"y",null))?e=o:(e=u(s,"top",0),u(s,"bottom",e))):(void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=t),void 0===n&&(n=e)),this.padding.left=t,this.padding.top=e,this.padding.right=i,this.padding.bottom=n,this.updateText();},setMaxLines:function(t){return this.style.setMaxLines(t);},updateText:function(){var t=this.canvas,e=this.context,i=this.style,n=i.resolution,s=i.metrics;i.syncFont(t,e);var r=this._text;(i.wordWrapWidth||i.wordWrapCallback)&&(r=this.runWordWrap(this._text));var o,a=r.split(this.splitRegExp),h=E(this,s,a),u=this.padding;0===i.fixedWidth?(this.width=h.width+u.left+u.right,o=h.width):(this.width=i.fixedWidth,(o=this.width-u.left-u.right)<h.width&&(o=h.width)),0===i.fixedHeight?this.height=h.height+u.top+u.bottom:this.height=i.fixedHeight;var l,c,d=this.width,f=this.height;this.updateDisplayOrigin(),d*=n,f*=n,d=Math.max(d,1),f=Math.max(f,1),t.width!==d||t.height!==f?(t.width=d,t.height=f,this.frame.setSize(d,f),i.syncFont(t,e)):e.clearRect(0,0,d,f),e.save(),e.scale(n,n),i.backgroundColor&&(e.fillStyle=i.backgroundColor,e.fillRect(0,0,d,f)),i.syncStyle(t,e),e.textBaseline="alphabetic",e.translate(u.left,u.top);for(var p=0;p<h.lines;p++){if(l=i.strokeThickness/2,c=i.strokeThickness/2+p*h.lineHeight+s.ascent,0<p&&(c+=h.lineSpacing*p),i.rtl)l=d-l;else if("right"===i.align)l+=o-h.lineWidths[p];else if("center"===i.align)l+=(o-h.lineWidths[p])/2;else if("justify"===i.align){if(.85<=h.lineWidths[p]/h.width){var g=h.width-h.lineWidths[p],v=e.measureText(" ").width,m=a[p].trim(),y=m.split(" ");g+=(a[p].length-m.length)*v;for(var x=Math.floor(g/v),T=0;0<x;)y[T]+=" ",T=(T+1)%(y.length-1||1),--x;a[p]=y.join(" ");}}this.autoRound&&(l=Math.round(l),c=Math.round(c)),i.strokeThickness&&(this.style.syncShadow(e,i.shadowStroke),e.strokeText(a[p],l,c)),i.color&&(this.style.syncShadow(e,i.shadowFill),e.fillText(a[p],l,c));}e.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(t,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var w=this.input;return w&&!w.customHitArea&&(w.hitArea.width=this.width,w.hitArea.height=this.height),this;},getTextMetrics:function(){return this.style.getTextMetrics();},text:{get:function(){return this._text;},set:function(t){this.setText(t);}},toJSON:function(){var t=o.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t;},preDestroy:function(){this.style.rtl&&l(this.canvas),r.remove(this.canvas),this.texture.destroy();}});t.exports=f;},function(t,e,i){var l=i(31),n=i(0),s=i(11),c=i(22),d=i(15),f=i(361),o=i(192),r=i(1091),p=i(3),a=new n({Extends:d,Mixins:[s.Alpha,s.BlendMode,s.ComputedSize,s.Crop,s.Depth,s.Flip,s.GetBounds,s.Mask,s.Origin,s.Pipeline,s.ScrollFactor,s.Tint,s.Transform,s.Visible,r],initialize:function(t,e,i,n,s,r,o){var a=t.sys.renderer;d.call(this,t,"TileSprite");var h=t.sys.textures.get(r),u=h.get(o);s=n&&s?(n=Math.floor(n),Math.floor(s)):(n=u.width,u.height),this._tilePosition=new p(),this._tileScale=new p(1,1),this.dirty=!1,this.renderer=a,this.canvas=l.create(this,n,s),this.context=this.canvas.getContext("2d"),this.displayTexture=h,this.displayFrame=u,this._crop=this.resetCropObject(),this.texture=t.sys.textures.addCanvas(null,this.canvas,!0),this.frame=this.texture.get(),this.potWidth=f(u.width),this.potHeight=f(u.height),this.fillCanvas=l.create2D(this,this.potWidth,this.potHeight),this.fillContext=this.fillCanvas.getContext("2d"),this.fillPattern=null,this.setPosition(e,i),this.setSize(n,s),this.setFrame(o),this.setOriginFromFrame(),this.initPipeline(),t.sys.game.events.on(c.CONTEXT_RESTORED,function(t){var e;t&&(e=t.gl,this.dirty=!0,this.fillPattern=null,this.fillPattern=t.createTexture2D(0,e.LINEAR,e.LINEAR,e.REPEAT,e.REPEAT,e.RGBA,this.fillCanvas,this.potWidth,this.potHeight));},this);},setTexture:function(t,e){return this.displayTexture=this.scene.sys.textures.get(t),this.setFrame(e);},setFrame:function(t){var e=this.displayTexture.get(t);return this.potWidth=f(e.width),this.potHeight=f(e.height),this.canvas.width=0,e.cutWidth&&e.cutHeight?this.renderFlags|=8:this.renderFlags&=-9,this.displayFrame=e,this.dirty=!0,this.updateTileTexture(),this;},setTilePosition:function(t,e){return void 0!==t&&(this.tilePositionX=t),void 0!==e&&(this.tilePositionY=e),this;},setTileScale:function(t,e){return void 0===t&&(t=this.tileScaleX),void 0===e&&(e=t),this.tileScaleX=t,this.tileScaleY=e,this;},updateTileTexture:function(){if(this.dirty&&this.renderer){var t=this.displayFrame;if(t.source.isRenderTexture||t.source.isGLTexture)return console.warn("TileSprites can only use Image or Canvas based textures"),void(this.dirty=!1);var e=this.fillContext,i=this.fillCanvas,n=this.potWidth,s=this.potHeight;this.renderer&&this.renderer.gl||(n=t.cutWidth,s=t.cutHeight),e.clearRect(0,0,n,s),i.width=n,i.height=s,e.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,0,0,n,s),this.renderer&&this.renderer.gl?this.fillPattern=this.renderer.canvasToTexture(i,this.fillPattern):this.fillPattern=e.createPattern(i,"repeat"),this.updateCanvas(),this.dirty=!1;}},updateCanvas:function(){var t,e,i,n,s,r=this.canvas;r.width===this.width&&r.height===this.height||(r.width=this.width,r.height=this.height,this.frame.setSize(this.width,this.height),this.updateDisplayOrigin(),this.dirty=!0),!this.dirty||this.renderer&&this.renderer.gl||(t=this.context,this.scene.sys.game.config.antialias||o.disable(t),e=this._tileScale.x,i=this._tileScale.y,n=this._tilePosition.x,s=this._tilePosition.y,t.clearRect(0,0,this.width,this.height),t.save(),t.scale(e,i),t.translate(-n,-s),t.fillStyle=this.fillPattern,t.fillRect(n,s,this.width/e,this.height/i),t.restore()),this.dirty=!1;},preDestroy:function(){this.renderer&&this.renderer.gl&&this.renderer.deleteTexture(this.fillPattern),l.remove(this.canvas),l.remove(this.fillCanvas),this.fillPattern=null,this.fillContext=null,this.fillCanvas=null,this.displayTexture=null,this.displayFrame=null,this.texture.destroy(),this.renderer=null;},tilePositionX:{get:function(){return this._tilePosition.x;},set:function(t){this._tilePosition.x=t,this.dirty=!0;}},tilePositionY:{get:function(){return this._tilePosition.y;},set:function(t){this._tilePosition.y=t,this.dirty=!0;}},tileScaleX:{get:function(){return this._tileScale.x;},set:function(t){this._tileScale.x=t,this.dirty=!0;}},tileScaleY:{get:function(){return this._tileScale.y;},set:function(t){this._tileScale.y=t,this.dirty=!0;}}});t.exports=a;},function(t,e,i){var n=i(0),s=i(18),r=i(11),o=i(75),a=i(22),h=i(51),u=i(15),l=i(70),c=i(222),d=i(1094),f=i(14),p=new n({Extends:u,Mixins:[r.Alpha,r.BlendMode,r.Depth,r.Flip,r.GetBounds,r.Mask,r.Origin,r.Pipeline,r.ScrollFactor,r.Size,r.TextureCrop,r.Tint,r.Transform,r.Visible,d],initialize:function(t,e,i,n){u.call(this,t,"Video"),this.video=null,this.videoTexture=null,this.videoTextureSource=null,this.snapshotTexture=null,this.flipY=!1,this._key=c(),this.touchLocked=!0,this.playWhenUnlocked=!1,this.retryLimit=20,this.retry=0,this.retryInterval=500,this._retryID=null,this._systemMuted=!1,this._codeMuted=!1,this._systemPaused=!1,this._codePaused=!1,this._callbacks={play:this.playHandler.bind(this),error:this.loadErrorHandler.bind(this),end:this.completeHandler.bind(this),time:this.timeUpdateHandler.bind(this),seeking:this.seekingHandler.bind(this),seeked:this.seekedHandler.bind(this)},this._crop=this.resetCropObject(),this.markers={},this._markerIn=-1,this._markerOut=f.MAX_SAFE_INTEGER,this._lastUpdate=0,this._cacheKey="",this._isSeeking=!1,this.removeVideoElementOnDestroy=!1,this.setPosition(e,i),this.initPipeline(),n&&this.changeSource(n,!1);var s=t.sys.game.events;s.on(a.PAUSE,this.globalPause,this),s.on(a.RESUME,this.globalResume,this);var r=t.sys.sound;r&&r.on(l.GLOBAL_MUTE,this.globalMute,this);},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},play:function(t,e,i){if(this.touchLocked&&this.playWhenUnlocked||this.isPlaying())return this;var n=this.video;if(!n)return console.warn("Video not loaded"),this;void 0===t&&(t=n.loop);var s=this.scene.sys.sound;s&&s.mute&&this.setMute(!0),isNaN(e)||(this._markerIn=e),!isNaN(i)&&e<i&&(this._markerOut=i),n.loop=t;var r=this._callbacks,o=n.play();return void 0!==o?o.then(this.playPromiseSuccessHandler.bind(this)).catch(this.playPromiseErrorHandler.bind(this)):(n.addEventListener("playing",r.play,!0),n.readyState<2&&(this.retry=this.retryLimit,this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval))),n.addEventListener("ended",r.end,!0),n.addEventListener("timeupdate",r.time,!0),n.addEventListener("seeking",r.seeking,!0),n.addEventListener("seeked",r.seeked,!0),this;},changeSource:function(t,e,i,n,s){void 0===e&&(e=!0),this.video&&this.stop();var r=this.scene.sys.cache.video.get(t);return r?(this.video=r,this._cacheKey=t,this._codePaused=r.paused,this._codeMuted=r.muted,this.videoTexture?(this.scene.sys.textures.remove(this._key),this.videoTexture=this.scene.sys.textures.create(this._key,r,r.videoWidth,r.videoHeight),this.videoTextureSource=this.videoTexture.source[0],this.videoTexture.add("__BASE",0,0,0,r.videoWidth,r.videoHeight),this.setTexture(this.videoTexture),this.setSizeToFrame(),this.updateDisplayOrigin(),this.emit(o.VIDEO_CREATED,this,r.videoWidth,r.videoHeight)):this.updateTexture(),r.currentTime=0,this._lastUpdate=0,e&&this.play(i,n,s)):this.video=null,this;},addMarker:function(t,e,i){return!isNaN(e)&&0<=e&&!isNaN(i)&&(this.markers[t]=[e,i]),this;},playMarker:function(t,e){var i=this.markers[t];return i&&this.play(e,i[0],i[1]),this;},removeMarker:function(t){return delete this.markers[t],this;},snapshot:function(t,e){return void 0===t&&(t=this.width),void 0===e&&(e=this.height),this.snapshotArea(0,0,this.width,this.height,t,e);},snapshotArea:function(t,e,i,n,s,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.width),void 0===n&&(n=this.height),void 0===s&&(s=i),void 0===r&&(r=n);var o=this.video,a=this.snapshotTexture;return a?a.setSize(s,r):(a=this.scene.sys.textures.createCanvas(c(),s,r),this.snapshotTexture=a),o&&a.context.drawImage(o,t,e,i,n,0,0,s,r),a.update();},saveSnapshotTexture:function(t){return this.snapshotTexture?this.scene.sys.textures.renameTexture(this.snapshotTexture.key,t):this.snapshotTexture=this.scene.sys.textures.createCanvas(t,this.width,this.height),this.snapshotTexture;},loadURL:function(t,e,i){void 0===e&&(e="loadeddata"),void 0===i&&(i=!1),this.video&&this.stop(),this.videoTexture&&this.scene.sys.textures.remove(this._key);var n=document.createElement("video");return n.controls=!1,i&&(n.muted=!0,n.defaultMuted=!0,n.setAttribute("autoplay","autoplay")),n.setAttribute("playsinline","playsinline"),n.setAttribute("preload","auto"),n.addEventListener("error",this._callbacks.error,!0),n.src=t,n.load(),this.video=n,this;},loadMediaStream:function(e,t,i){void 0===t&&(t="loadeddata"),void 0===i&&(i=!1),this.video&&this.stop(),this.videoTexture&&this.scene.sys.textures.remove(this._key);var n=document.createElement("video");n.controls=!1,i&&(n.muted=!0,n.defaultMuted=!0,n.setAttribute("autoplay","autoplay")),n.setAttribute("playsinline","playsinline"),n.setAttribute("preload","auto"),n.addEventListener("error",this._callbacks.error,!0);try{n.srcObject=e;}catch(t){n.src=window.URL.createObjectURL(e);}return n.load(),this.video=n,this;},playPromiseSuccessHandler:function(){this._codePaused=!1,this.touchLocked=!1,this.emit(o.VIDEO_PLAY,this),-1<this._markerIn&&(this.video.currentTime=this._markerIn);},playPromiseErrorHandler:function(t){this.scene.sys.input.once(h.POINTER_DOWN,this.unlockHandler,this),this.touchLocked=!0,this.playWhenUnlocked=!0,this.emit(o.VIDEO_ERROR,this,t);},playHandler:function(){this._codePaused=!1,this.touchLocked=!1,this.emit(o.VIDEO_PLAY,this),this.video.removeEventListener("playing",this._callbacks.play,!0);},loadErrorHandler:function(t){this.stop(),this.emit(o.VIDEO_ERROR,this,t);},unlockHandler:function(){this.touchLocked=!1,this.playWhenUnlocked=!1,this.emit(o.VIDEO_UNLOCKED,this),-1<this._markerIn&&(this.video.currentTime=this._markerIn),this.video.play(),this.emit(o.VIDEO_PLAY,this);},completeHandler:function(){this.emit(o.VIDEO_COMPLETE,this);},timeUpdateHandler:function(){this.video&&this.video.currentTime<this._lastUpdate&&(this.emit(o.VIDEO_LOOP,this),this._lastUpdate=0);},preUpdate:function(){var t,e=this.video;!e||(t=e.currentTime)!==this._lastUpdate&&(this._lastUpdate=t,this.updateTexture(),t>=this._markerOut&&(e.loop?(e.currentTime=this._markerIn,this.updateTexture(),this._lastUpdate=t,this.emit(o.VIDEO_LOOP,this)):(this.emit(o.VIDEO_COMPLETE,this),this.stop())));},checkVideoProgress:function(){2<=this.video.readyState?this.updateTexture():(this.retry--,0<this.retry?this._retryID=window.setTimeout(this.checkVideoProgress.bind(this),this.retryInterval):this.emit(o.VIDEO_TIMEOUT,this));},updateTexture:function(){var t,e=this.video,i=e.videoWidth,n=e.videoHeight;this.videoTexture?((t=this.videoTextureSource).source!==e&&(t.source=e,t.width=i,t.height=n),t.update()):(this.videoTexture=this.scene.sys.textures.create(this._key,e,i,n),this.videoTextureSource=this.videoTexture.source[0],this.videoTexture.add("__BASE",0,0,0,i,n),this.setTexture(this.videoTexture),this.setSizeToFrame(),this.updateDisplayOrigin(),this.emit(o.VIDEO_CREATED,this,i,n));},getVideoKey:function(){return this._cacheKey;},seekTo:function(t){var e,i,n=this.video;return n&&((e=n.duration)===1/0||isNaN(e)||(i=e*t,this.setCurrentTime(i))),this;},getCurrentTime:function(){return this.video?this.video.currentTime:0;},setCurrentTime:function(t){var e,i,n=this.video;return n&&("string"==typeof t&&(e=t[0],i=parseFloat(t.substr(1)),"+"===e?t=n.currentTime+i:"-"===e&&(t=n.currentTime-i)),n.currentTime=t,this._lastUpdate=t),this;},isSeeking:function(){return this._isSeeking;},seekingHandler:function(){this._isSeeking=!0,this.emit(o.VIDEO_SEEKING,this);},seekedHandler:function(){this._isSeeking=!1,this.emit(o.VIDEO_SEEKED,this),this.video&&this.updateTexture();},getProgress:function(){var t=this.video;if(t){var e=t.currentTime,i=t.duration;if(i!==1/0&&!isNaN(i))return e/i;}return 0;},getDuration:function(){return this.video?this.video.duration:0;},setMute:function(t){void 0===t&&(t=!0),this._codeMuted=t;var e=this.video;return e&&(e.muted=!!this._systemMuted||t),this;},isMuted:function(){return this._codeMuted;},globalMute:function(t,e){this._systemMuted=e;var i=this.video;i&&(i.muted=!!this._codeMuted||e);},globalPause:function(){this._systemPaused=!0,this.video&&this.video.pause();},globalResume:function(){this._systemPaused=!1,this.video&&!this._codePaused&&this.video.play();},setPaused:function(t){void 0===t&&(t=!0);var e=this.video;return this._codePaused=t,e&&(t?e.paused||e.pause():t||e.paused&&!this._systemPaused&&e.play()),this;},getVolume:function(){return this.video?this.video.volume:1;},setVolume:function(t){return void 0===t&&(t=1),this.video&&(this.video.volume=s(t,0,1)),this;},getPlaybackRate:function(){return this.video?this.video.playbackRate:1;},setPlaybackRate:function(t){return this.video&&(this.video.playbackRate=t),this;},getLoop:function(){return!!this.video&&this.video.loop;},setLoop:function(t){return void 0===t&&(t=!0),this.video&&(this.video.loop=t),this;},isPlaying:function(){return!!this.video&&!(this.video.paused||this.video.ended);},isPaused:function(){return this.video&&this.video.paused||this._codePaused||this._systemPaused;},saveTexture:function(t,e){return void 0===e&&(e=!1),this.videoTexture&&this.scene.sys.textures.renameTexture(this._key,t),this._key=t,this.flipY=e,this.videoTextureSource&&this.videoTextureSource.setFlipY(e),this.videoTexture;},stop:function(){var t=this.video;if(t){var e=this._callbacks;for(var i in e)t.removeEventListener(i,e[i],!0);t.pause();}return this._retryID&&window.clearTimeout(this._retryID),this.emit(o.VIDEO_STOP,this),this;},removeVideoElement:function(){var t=this.video;if(t){for(t.parentNode&&t.parentNode.removeChild(t);t.hasChildNodes();)t.removeChild(t.firstChild);t.removeAttribute("autoplay"),t.removeAttribute("src"),this.video=null;}},preDestroy:function(){this.stop(),this.removeVideoElementOnDestroy&&this.removeVideoElement();var t=this.scene.sys.game.events;t.off(a.PAUSE,this.globalPause,this),t.off(a.RESUME,this.globalResume,this);var e=this.scene.sys.sound;e&&e.off(l.GLOBAL_MUTE,this.globalMute,this),this._retryID&&window.clearTimeout(this._retryID);}});t.exports=p;},function(t,e,i){var n=i(0),s=i(228),r=i(470),o=i(56),a=new n({initialize:function(t){this.type=o.POLYGON,this.area=0,this.points=[],t&&this.setTo(t);},contains:function(t,e){return s(this,t,e);},setTo:function(t){if(this.area=0,this.points=[],"string"==typeof t&&(t=t.split(" ")),!Array.isArray(t))return this;for(var e,i=Number.MAX_VALUE,n=0;n<t.length;n++)e={x:0,y:0},"number"==typeof t[n]||"string"==typeof t[n]?(e.x=parseFloat(t[n]),e.y=parseFloat(t[n+1]),n++):Array.isArray(t[n])?(e.x=t[n][0],e.y=t[n][1]):(e.x=t[n].x,e.y=t[n].y),this.points.push(e),e.y<i&&(i=e.y);return this.calculateArea(i),this;},calculateArea:function(){if(this.points.length<3)return this.area=0,this.area;for(var t,e,i=0,n=0;n<this.points.length-1;n++)t=this.points[n],i+=((e=this.points[n+1]).x-t.x)*(t.y+e.y);return t=this.points[0],e=this.points[this.points.length-1],i+=(t.x-e.x)*(e.y+t.y),this.area=.5*-i,this.area;},getPoints:function(t,e,i){return r(this,t,e,i);}});t.exports=a;},function(t,e){t.exports=function(t,e,i){for(var n=!1,s=-1,r=t.points.length-1;++s<t.points.length;r=s){var o=t.points[s].x,a=t.points[s].y,h=t.points[r].x,u=t.points[r].y;(a<=i&&i<u||u<=i&&i<a)&&e<(h-o)*(i-a)/(u-a)+o&&(n=!n);}return n;};},function(t,e,i){var n=i(0),s=i(11),u=i(15),c=i(2),l=i(17),r=i(478),o=i(1176),d=i(25),a=new n({Extends:u,Mixins:[s.ComputedSize,s.Depth,s.GetBounds,s.Mask,s.Origin,s.ScrollFactor,s.Transform,s.Visible,o],initialize:function(t,e,i,n,s,r,o,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=128),void 0===r&&(r=128),u.call(this,t,"Shader"),this.blendMode=-1,this.shader;var h=t.sys.renderer;this.renderer=h,this.gl=h.gl,this.vertexData=new ArrayBuffer(2*Float32Array.BYTES_PER_ELEMENT*6),this.vertexBuffer=h.createVertexBuffer(this.vertexData.byteLength,this.gl.STREAM_DRAW),this.program=null,this.bytes=new Uint8Array(this.vertexData),this.vertexViewF32=new Float32Array(this.vertexData),this._tempMatrix1=new d(),this._tempMatrix2=new d(),this._tempMatrix3=new d(),this.viewMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.projectionMatrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.uniforms={},this.pointer=null,this._rendererWidth=h.width,this._rendererHeight=h.height,this._textureCount=0,this.framebuffer=null,this.glTexture=null,this.renderToTexture=!1,this.texture=null,this.setPosition(i,n),this.setSize(s,r),this.setOrigin(.5,.5),this.setShader(e,o,a);},willRender:function(t){return!!this.renderToTexture||!(u.RENDER_MASK!==this.renderFlags||0!==this.cameraFilter&&this.cameraFilter&t.id);},setRenderToTexture:function(t,e){var i,n,s;return void 0===e&&(e=!1),this.renderToTexture||(i=this.width,n=this.height,s=this.renderer,this.glTexture=s.createTextureFromSource(null,i,n,0),this.glTexture.flipY=e,this.framebuffer=s.createFramebuffer(i,n,this.glTexture,!1),this._rendererWidth=i,this._rendererHeight=n,this.renderToTexture=!0,this.projOrtho(0,this.width,this.height,0),t&&(this.texture=this.scene.sys.textures.addGLTexture(t,this.glTexture,i,n))),this.shader&&(s.pipelines.clear(),this.load(),this.flush(),s.pipelines.rebind()),this;},setShader:function(t,e,i){if(void 0===e&&(e=[]),"string"==typeof t){var n=this.scene.sys.cache.shader;if(!n.has(t))return console.warn("Shader missing: "+t),this;this.shader=n.get(t);}else this.shader=t;var s=this.gl,r=this.renderer;this.program&&s.deleteProgram(this.program);var o=r.createProgram(this.shader.vertexSrc,this.shader.fragmentSrc);s.uniformMatrix4fv(s.getUniformLocation(o,"uViewMatrix"),!1,this.viewMatrix),s.uniformMatrix4fv(s.getUniformLocation(o,"uProjectionMatrix"),!1,this.projectionMatrix),s.uniform2f(s.getUniformLocation(o,"uResolution"),this.width,this.height),this.program=o;var a=new Date(),h={resolution:{type:"2f",value:{x:this.width,y:this.height}},time:{type:"1f",value:0},mouse:{type:"2f",value:{x:this.width/2,y:this.height/2}},date:{type:"4fv",value:[a.getFullYear(),a.getMonth(),a.getDate(),60*a.getHours()*60+60*a.getMinutes()+a.getSeconds()]},sampleRate:{type:"1f",value:44100},iChannel0:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel1:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel2:{type:"sampler2D",value:null,textureData:{repeat:!0}},iChannel3:{type:"sampler2D",value:null,textureData:{repeat:!0}}};this.shader.uniforms?this.uniforms=l(!0,{},this.shader.uniforms,h):this.uniforms=h;for(var u=0;u<4;u++)e[u]&&this.setSampler2D("iChannel"+u,e[u],u,i);return this.initUniforms(),this.projOrtho(0,this._rendererWidth,this._rendererHeight,0),this;},setPointer:function(t){return this.pointer=t,this;},projOrtho:function(t,e,i,n){var s=1/(t-e),r=1/(i-n),o=this.projectionMatrix;o[0]=-2*s,o[5]=-2*r,o[10]=-.001,o[12]=(t+e)*s,o[13]=(n+i)*r,o[14]=-0;var a=this.program,h=this.gl;this.renderer.setProgram(a),h.uniformMatrix4fv(h.getUniformLocation(a,"uProjectionMatrix"),!1,this.projectionMatrix),this._rendererWidth=e,this._rendererHeight=i;},initUniforms:function(){var t=this.gl,e=this.renderer.glFuncMap,i=this.program;for(var n in this._textureCount=0,this.uniforms){var s=this.uniforms[n],r=s.type,o=e[r];s.uniformLocation=t.getUniformLocation(i,n),"sampler2D"!==r&&(s.glMatrix=o.matrix,s.glValueLength=o.length,s.glFunc=o.func);}},setSampler2DBuffer:function(t,e,i,n,s,r){void 0===s&&(s=0),void 0===r&&(r={});var o=this.uniforms[t];return o.value=e,r.width=i,r.height=n,o.textureData=r,this._textureCount=s,this.initSampler2D(o),this;},setSampler2D:function(t,e,i,n){void 0===i&&(i=0);var s=this.scene.sys.textures;if(s.exists(e)){var r=s.getFrame(e);if(r.glTexture&&r.glTexture.isRenderTexture)return this.setSampler2DBuffer(t,r.glTexture,r.width,r.height,i,n);var o=this.uniforms[t],a=r.source;o.textureKey=e,o.source=a.image,o.value=r.glTexture,a.isGLTexture&&((n=n||{}).width=a.width,n.height=a.height),n&&(o.textureData=n),this._textureCount=i,this.initSampler2D(o);}return this;},setUniform:function(t,e){return r(this.uniforms,t,e),this;},getUniform:function(t){return c(this.uniforms,t,null);},setChannel0:function(t,e){return this.setSampler2D("iChannel0",t,0,e);},setChannel1:function(t,e){return this.setSampler2D("iChannel1",t,1,e);},setChannel2:function(t,e){return this.setSampler2D("iChannel2",t,2,e);},setChannel3:function(t,e){return this.setSampler2D("iChannel3",t,3,e);},initSampler2D:function(t){var e,i,n,s,r,o,a,h,u,l;t.value&&((e=this.gl).activeTexture(e.TEXTURE0+this._textureCount),e.bindTexture(e.TEXTURE_2D,t.value),(i=t.textureData)&&!t.value.isRenderTexture&&(n=e[c(i,"magFilter","linear").toUpperCase()],s=e[c(i,"minFilter","linear").toUpperCase()],r=e[c(i,"wrapS","repeat").toUpperCase()],o=e[c(i,"wrapT","repeat").toUpperCase()],a=e[c(i,"format","rgba").toUpperCase()],i.repeat&&(r=e.REPEAT,o=e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width?(h=c(i,"width",512),u=c(i,"height",2),l=c(i,"border",0),e.texImage2D(e.TEXTURE_2D,0,a,h,u,l,a,e.UNSIGNED_BYTE,null)):e.texImage2D(e.TEXTURE_2D,0,a,e.RGBA,e.UNSIGNED_BYTE,t.source),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,o)),this.renderer.setProgram(this.program),e.uniform1i(t.uniformLocation,this._textureCount),this._textureCount++);},syncUniforms:function(){var t,e,i,n,s,r=this.gl,o=this.uniforms,a=0;for(var h in o)i=(t=o[h]).glFunc,e=t.glValueLength,n=t.uniformLocation,null!==(s=t.value)&&(1===e?t.glMatrix?i.call(r,n,t.transpose,s):i.call(r,n,s):2===e?i.call(r,n,s.x,s.y):3===e?i.call(r,n,s.x,s.y,s.z):4===e?i.call(r,n,s.x,s.y,s.z,s.w):"sampler2D"===t.type&&(r.activeTexture(r.TEXTURE0+a),r.bindTexture(r.TEXTURE_2D,s),r.uniform1i(n,a),a++));},load:function(t){var e,i,n=this.gl,s=this.width,r=this.height,o=this.renderer,a=this.program,h=this.viewMatrix;this.renderToTexture||(e=-this._displayOriginX,i=-this._displayOriginY,h[0]=t[0],h[1]=t[1],h[4]=t[2],h[5]=t[3],h[8]=t[4],h[9]=t[5],h[12]=h[0]*e+h[4]*i,h[13]=h[1]*e+h[5]*i),n.useProgram(a),n.uniformMatrix4fv(n.getUniformLocation(a,"uViewMatrix"),!1,h),n.uniform2f(n.getUniformLocation(a,"uResolution"),this.width,this.height);var u=this.uniforms,l=u.resolution;l.value.x=s,l.value.y=r,u.time.value=o.game.loop.getDuration();var c,d,f,p=this.pointer;p&&(c=u.mouse,d=p.x/s,f=1-p.y/r,c.value.x=d.toFixed(2),c.value.y=f.toFixed(2)),this.syncUniforms();},flush:function(){var t=this.width,e=this.height,i=this.program,n=this.gl,s=this.vertexBuffer,r=this.renderer,o=2*Float32Array.BYTES_PER_ELEMENT;this.renderToTexture&&(r.setFramebuffer(this.framebuffer),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)),n.bindBuffer(n.ARRAY_BUFFER,s);var a=n.getAttribLocation(i,"inPosition");-1!==a&&(n.enableVertexAttribArray(a),n.vertexAttribPointer(a,2,n.FLOAT,!1,o,0));var h=this.vertexViewF32;h[3]=e,h[4]=t,h[5]=e,h[8]=t,h[9]=e,h[10]=t;n.bufferSubData(n.ARRAY_BUFFER,0,this.bytes.subarray(0,6*o)),n.drawArrays(n.TRIANGLES,0,6),this.renderToTexture&&r.setFramebuffer(null,!1);},setAlpha:function(){},setBlendMode:function(){},preDestroy:function(){var t=this.gl;t.deleteProgram(this.program),t.deleteBuffer(this.vertexBuffer),this.renderToTexture&&(this.renderer.deleteFramebuffer(this.framebuffer),this.texture.destroy(),this.framebuffer=null,this.glTexture=null,this.texture=null);}});t.exports=a;},function(t,e,i){var n=i(0),s=i(11),r=i(36),o=i(116),f=i(15),h=i(479),l=i(480),u=i(19),p=i(69),a=i(1179),c=i(79),g=i(39),d=i(117),v=new n({Extends:f,Mixins:[s.AlphaSingle,s.BlendMode,s.Depth,s.Mask,s.Pipeline,s.Size,s.Texture,s.Transform,s.Visible,s.ScrollFactor,a],initialize:function(t,e,i,n,s,r,o,a,h,u,l,c){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n="__WHITE"),f.call(this,t,"Mesh"),this.faces=[],this.vertices=[],this.tintFill=!1,this.debugCallback=null,this.debugGraphic=null,this.hideCCW=!0,this.modelPosition=new g(),this.modelScale=new g(1,1,1),this.modelRotation=new g(),this.dirtyCache=[0,0,0,0,0,0,0,0,0,0,0,0],this.transformMatrix=new p(),this.viewPosition=new g(),this.viewMatrix=new p(),this.projectionMatrix=new p(),this.totalRendered=0,this.totalFrame=0,this.ignoreDirtyCache=!1;var d=t.sys.renderer;this.setPosition(e,i),this.setTexture(n,s),this.setSize(d.width,d.height),this.initPipeline(),this.setPerspective(d.width,d.height),r&&this.addVertices(r,o,a,h,u,l,c);},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},panX:function(t){return this.viewPosition.addScale(g.LEFT,t),this.dirtyCache[10]=1,this;},panY:function(t){return this.viewPosition.y+=g.DOWN.y*t,this.dirtyCache[10]=1,this;},panZ:function(t){return this.viewPosition.z+=t,this.dirtyCache[10]=1,this;},setPerspective:function(t,e,i,n,s){return void 0===i&&(i=45),void 0===n&&(n=.01),void 0===s&&(s=1e3),this.projectionMatrix.perspective(r(i),t/e,n,s),this.dirtyCache[10]=1,this.dirtyCache[11]=0,this;},setOrtho:function(t,e,i,n){return void 0===t&&(t=this.scene.sys.renderer.getAspectRatio()),void 0===e&&(e=1),void 0===i&&(i=-1e3),void 0===n&&(n=1e3),this.projectionMatrix.ortho(-t,t,-e,e,i,n),this.dirtyCache[10]=1,this.dirtyCache[11]=1,this;},clear:function(){return this.faces.forEach(function(t){t.destroy();}),this.faces=[],this.vertices=[],this;},addVerticesFromObj:function(t,e,i,n,s,r,o,a,h){var u=this.scene.sys.cache.obj.get(t);return u&&l(u,this,e,i,n,s,r,o,a,h),this;},sortByDepth:function(t,e){return t.depth-e.depth;},depthSort:function(){return c(this.faces,this.sortByDepth),this;},addVertex:function(t,e,i,n,s,r,o){var a=new d(t,e,i,n,s,r,o);return this.vertices.push(a),a;},addFace:function(t,e,i){var n=new o(t,e,i);return this.faces.push(n),this.dirtyCache[9]=-1,n;},addVertices:function(t,e,i,n,s,r,o){var a=h(t,e,i,n,s,r,o);return a&&(this.faces=this.faces.concat(a.faces),this.vertices=this.vertices.concat(a.vertices)),this.dirtyCache[9]=-1,this;},getFaceCount:function(){return this.faces.length;},getVertexCount:function(){return this.vertices.length;},getFace:function(t){return this.faces[t];},getFaceAt:function(t,e,i){void 0===i&&(i=this.scene.sys.cameras.main);for(var n=u(this,i).calc,s=this.faces,r=[],o=0;o<s.length;o++){var a=s[o];a.contains(t,e,n)&&r.push(a);}return c(r,this.sortByDepth);},setDebug:function(t,e){return this.debugGraphic=t,this.debugCallback=t||e?e||this.renderDebug:null,this;},isDirty:function(){var t=this.modelPosition,e=this.modelRotation,i=this.modelScale,n=this.dirtyCache,s=t.x,r=t.y,o=t.z,a=e.x,h=e.y,u=e.z,l=i.x,c=i.y,d=i.z,f=this.getFaceCount(),p=n[0],g=n[1],v=n[2],m=n[3],y=n[4],x=n[5],T=n[6],w=n[7],E=n[8],b=n[9];return n[0]=s,n[1]=r,n[2]=o,n[3]=a,n[4]=h,n[5]=u,n[6]=l,n[7]=c,n[8]=d,n[9]=f,p!==s||g!==r||v!==o||m!==a||y!==h||x!==u||T!==l||w!==c||E!==d||b!==f;},preUpdate:function(){this.totalRendered=this.totalFrame,this.totalFrame=0;var t=this.dirtyCache;if(this.ignoreDirtyCache||t[10]||this.isDirty()){var e=this.width,i=this.height,n=this.viewMatrix,s=this.viewPosition;t[10]&&(n.identity(),n.translate(s),n.invert(),t[10]=0);var r=this.transformMatrix;r.setWorldMatrix(this.modelRotation,this.modelPosition,this.modelScale,this.viewMatrix,this.projectionMatrix);for(var o=s.z,a=this.faces,h=0;h<a.length;h++)a[h].transformCoordinatesLocal(r,e,i,o);this.depthSort();}},renderDebug:function(t,e){for(var i=t.debugGraphic,n=0;n<e.length;n++){var s=e[n],r=s.vertex1.tx,o=s.vertex1.ty,a=s.vertex2.tx,h=s.vertex2.ty,u=s.vertex3.tx,l=s.vertex3.ty;i.strokeTriangle(r,o,a,h,u,l);}},preDestroy:function(){this.clear(),this.debugCallback=null,this.debugGraphic=null;}});t.exports=v;},function(t,e,i){var n=i(50);t.exports=function(t,e){return n(t.x,t.y,e.x,e.y)<=t.radius+e.radius;};},function(t,e,i){var T=i(4),w=i(233);t.exports=function(t,e,i){var n,s,r,o,a,h,u,l,c,d,f,p,g,v,m,y,x;return void 0===i&&(i=[]),w(t,e)&&(n=t.x1,s=t.y1,r=t.x2,o=t.y2,0==(p=(f=2*((h=r-n)*(l=n-e.x)+(u=o-s)*(c=s-e.y)))*f-4*(d=h*h+u*u)*(l*l+c*c-(a=e.radius)*a))?(v=n+(g=-f/(2*d))*h,m=s+g*u,0<=g&&g<=1&&i.push(new T(v,m))):0<p&&(v=n+(y=(-f-Math.sqrt(p))/(2*d))*h,m=s+y*u,0<=y&&y<=1&&i.push(new T(v,m)),v=n+(x=(-f+Math.sqrt(p))/(2*d))*h,m=s+x*u,0<=x&&x<=1&&i.push(new T(v,m)))),i;};},function(t,e,i){var c=i(66),d=new(i(4))();t.exports=function(t,e,i){if(void 0===i&&(i=d),c(e,t.x1,t.y1))return i.x=t.x1,i.y=t.y1,!0;if(c(e,t.x2,t.y2))return i.x=t.x2,i.y=t.y2,!0;var n,s=t.x2-t.x1,r=t.y2-t.y1,o=e.x-t.x1,a=e.y-t.y1,h=s*s+r*r,u=s,l=r;return 0<h&&(u*=n=(o*s+a*r)/h,l*=n),i.x=t.x1+u,i.y=t.y1+l,u*u+l*l<=h&&0<=u*s+l*r&&c(e,i.x,i.y);};},function(t,e,i){var l=i(4),c=i(96),d=i(488);t.exports=function(t,e,i){if(void 0===i&&(i=[]),d(t,e))for(var n=e.getLineA(),s=e.getLineB(),r=e.getLineC(),o=e.getLineD(),a=[new l(),new l(),new l(),new l()],h=[c(n,t,a[0]),c(s,t,a[1]),c(r,t,a[2]),c(o,t,a[3])],u=0;u<4;u++)h[u]&&i.push(a[u]);return i;};},function(t,e){t.exports=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=[]);for(var s,r,o,a,h,u,l=t.x3-t.x1,c=t.y3-t.y1,d=t.x2-t.x1,f=t.y2-t.y1,p=l*l+c*c,g=l*d+c*f,v=d*d+f*f,m=p*v-g*g,y=0==m?0:1/m,x=t.x1,T=t.y1,w=0;w<e.length&&(r=(p*(u=d*(o=e[w].x-x)+f*(a=e[w].y-T))-g*(h=l*o+c*a))*y,!(0<=(s=(v*h-g*u)*y)&&0<=r&&s+r<1&&(n.push({x:e[w].x,y:e[w].y}),i)));w++);return n;};},function(t,e){t.exports=function(t,e,i,n){var s=Math.cos(n),r=Math.sin(n),o=t.x1-e,a=t.y1-i;return t.x1=o*s-a*r+e,t.y1=o*r+a*s+i,o=t.x2-e,a=t.y2-i,t.x2=o*s-a*r+e,t.y2=o*r+a*s+i,t;};},function(t,e){t.exports=function(t){return 0===t.height?NaN:t.width/t.height;};},function(t,e){t.exports=function(t,e,i,n){var s=Math.cos(n),r=Math.sin(n),o=t.x1-e,a=t.y1-i;return t.x1=o*s-a*r+e,t.y1=o*r+a*s+i,o=t.x2-e,a=t.y2-i,t.x2=o*s-a*r+e,t.y2=o*r+a*s+i,o=t.x3-e,a=t.y3-i,t.x3=o*s-a*r+e,t.y3=o*r+a*s+i,t;};},function(t,e,i){t.exports={BUTTON_DOWN:i(1310),BUTTON_UP:i(1311),CONNECTED:i(1312),DISCONNECTED:i(1313),GAMEPAD_BUTTON_DOWN:i(1314),GAMEPAD_BUTTON_UP:i(1315)};},function(t,e,i){var s=i(17),r=i(156);t.exports=function(t,e){var i=void 0===t?r():s({},t);if(e)for(var n in e)void 0!==e[n]&&(i[n]=e[n]);return i;};},function(t,e,i){var n=i(0),s=i(21),a=i(23),r=i(8),h=i(2),u=i(7),o=i(408),l=new n({Extends:a,initialize:function(t,e,i,n){var s,r="xml";u(e)&&(e=h(s=e,"key"),i=h(s,"url"),n=h(s,"xhrSettings"),r=h(s,"extension",r));var o={type:"xml",cache:t.cacheManager.xml,extension:r,responseType:"text",key:e,url:i,xhrSettings:n};a.call(this,t,o);},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=o(this.xhrLoader.responseText),this.data?this.onProcessComplete():(console.warn("Invalid XMLFile: "+this.key),this.onProcessError());}});r.register("xml",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new l(this,t[n]));else this.addFile(new l(this,t,e,i));return this;}),t.exports=l;},function(t,e,i){var n=i(0),s=i(21),u=i(23),r=i(8),l=i(2),c=i(7),o=new n({Extends:u,initialize:function(t,e,i,n){var s,r="text",o="txt",a=t.cacheManager.text;c(e)&&(e=l(s=e,"key"),i=l(s,"url"),n=l(s,"xhrSettings"),o=l(s,"extension",o),r=l(s,"type",r),a=l(s,"cache",a));var h={type:r,cache:a,extension:o,responseType:"text",key:e,url:i,xhrSettings:n};u.call(this,t,h);},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=this.xhrLoader.responseText,this.onProcessComplete();}});r.register("text",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new o(this,t[n]));else this.addFile(new o(this,t,e,i));return this;}),t.exports=o;},function(t,e,i){t.exports={Acceleration:i(1368),Angular:i(1369),Bounce:i(1370),Debug:i(1371),Drag:i(1372),Enable:i(1373),Friction:i(1374),Gravity:i(1375),Immovable:i(1376),Mass:i(1377),OverlapCirc:i(523),OverlapRect:i(244),Pushable:i(1378),Size:i(1379),Velocity:i(1380)};},function(t,e){t.exports=function(t,e,i,n,s,r,o){void 0===r&&(r=!0),void 0===o&&(o=!1);var a,h,u,l=[],c=[],d=t.treeMinMax;return d.minX=e,d.minY=i,d.maxX=e+n,d.maxY=i+s,o&&(c=t.staticTree.search(d)),r&&t.useTree?l=t.tree.search(d):r&&(a=t.bodies,h={position:{x:e,y:i},left:e,top:i,right:e+n,bottom:i+s,isCircle:!1},u=t.intersects,a.iterate(function(t){u(t,h)&&l.push(t);})),c.concat(l);};},function(t,e,i){t.exports={COLLIDE:i(1381),OVERLAP:i(1382),PAUSE:i(1383),RESUME:i(1384),TILE_COLLIDE:i(1385),TILE_OVERLAP:i(1386),WORLD_BOUNDS:i(1387),WORLD_STEP:i(1388)};},function(t,e,i){var o=i(62);t.exports=function(t,e,i,n){var s=0,r=t.deltaAbsX()+e.deltaAbsX()+n;return 0===t._dx&&0===e._dx?(t.embedded=!0,e.embedded=!0):t._dx>e._dx?r<(s=t.right-e.x)&&!i||!1===t.checkCollision.right||!1===e.checkCollision.left?s=0:(t.touching.none=!1,t.touching.right=!0,e.touching.none=!1,e.touching.left=!0,e.physicsType!==o.STATIC_BODY||i||(t.blocked.none=!1,t.blocked.right=!0),t.physicsType!==o.STATIC_BODY||i||(e.blocked.none=!1,e.blocked.left=!0)):t._dx<e._dx&&(r<-(s=t.x-e.width-e.x)&&!i||!1===t.checkCollision.left||!1===e.checkCollision.right?s=0:(t.touching.none=!1,t.touching.left=!0,e.touching.none=!1,e.touching.right=!0,e.physicsType!==o.STATIC_BODY||i||(t.blocked.none=!1,t.blocked.left=!0),t.physicsType!==o.STATIC_BODY||i||(e.blocked.none=!1,e.blocked.right=!0))),t.overlapX=s,e.overlapX=s;};},function(t,e,i){var o=i(62);t.exports=function(t,e,i,n){var s=0,r=t.deltaAbsY()+e.deltaAbsY()+n;return 0===t._dy&&0===e._dy?(t.embedded=!0,e.embedded=!0):t._dy>e._dy?r<(s=t.bottom-e.y)&&!i||!1===t.checkCollision.down||!1===e.checkCollision.up?s=0:(t.touching.none=!1,t.touching.down=!0,e.touching.none=!1,e.touching.up=!0,e.physicsType!==o.STATIC_BODY||i||(t.blocked.none=!1,t.blocked.down=!0),t.physicsType!==o.STATIC_BODY||i||(e.blocked.none=!1,e.blocked.up=!0)):t._dy<e._dy&&(r<-(s=t.y-e.bottom)&&!i||!1===t.checkCollision.up||!1===e.checkCollision.down?s=0:(t.touching.none=!1,t.touching.up=!0,e.touching.none=!1,e.touching.down=!0,e.physicsType!==o.STATIC_BODY||i||(t.blocked.none=!1,t.blocked.up=!0),t.physicsType!==o.STATIC_BODY||i||(e.blocked.none=!1,e.blocked.down=!0))),t.overlapY=s,e.overlapY=s;};},function(t,e){t.exports=function(t,e){return!(e.right<=t.left||e.bottom<=t.top||e.position.x>=t.right||e.position.y>=t.bottom);};},,,function(t,e,i){t.exports={CalculateFacesAt:i(252),CalculateFacesWithin:i(63),CheckIsoBounds:i(541),Copy:i(1420),CreateFromTiles:i(1421),CullBounds:i(543),CullTiles:i(544),Fill:i(1422),FilterTiles:i(1423),FindByIndex:i(1424),FindTile:i(1425),ForEachTile:i(1426),GetCullTilesFunction:i(1427),GetTileAt:i(158),GetTileAtWorldXY:i(1428),GetTilesWithin:i(26),GetTilesWithinShape:i(1429),GetTilesWithinWorldXY:i(529),GetTileToWorldXFunction:i(1430),GetTileToWorldXYFunction:i(1431),GetTileToWorldYFunction:i(1432),GetWorldToTileXFunction:i(1433),GetWorldToTileXYFunction:i(1434),GetWorldToTileYFunction:i(1435),HasTileAt:i(562),HasTileAtWorldXY:i(1436),HexagonalCullBounds:i(546),HexagonalCullTiles:i(545),HexagonalTileToWorldXY:i(550),HexagonalTileToWorldY:i(554),HexagonalWorldToTileXY:i(556),HexagonalWorldToTileY:i(560),IsInLayerBounds:i(119),IsometricCullTiles:i(547),IsometricTileToWorldXY:i(551),IsometricWorldToTileXY:i(557),PutTileAt:i(257),PutTileAtWorldXY:i(1437),PutTilesAt:i(1438),Randomize:i(1439),RemoveTileAt:i(563),RemoveTileAtWorldXY:i(1440),RenderDebug:i(1441),ReplaceByIndex:i(542),RunCull:i(159),SetCollision:i(1442),SetCollisionBetween:i(1443),SetCollisionByExclusion:i(1444),SetCollisionByProperty:i(1445),SetCollisionFromCollisionGroup:i(1446),SetLayerCollisionIndex:i(160),SetTileCollision:i(72),SetTileIndexCallback:i(1447),SetTileLocationCallback:i(1448),Shuffle:i(1449),StaggeredCullBounds:i(549),StaggeredCullTiles:i(548),StaggeredTileToWorldXY:i(552),StaggeredTileToWorldY:i(555),StaggeredWorldToTileXY:i(558),StaggeredWorldToTileY:i(561),SwapByIndex:i(1450),TileToWorldX:i(253),TileToWorldXY:i(553),TileToWorldY:i(254),WeightedRandomize:i(1451),WorldToTileX:i(255),WorldToTileXY:i(559),WorldToTileY:i(256)};},function(t,e,i){var u=i(158);t.exports=function(t,e,i){var n=u(t,e,!0,i),s=u(t,e-1,!0,i),r=u(t,e+1,!0,i),o=u(t-1,e,!0,i),a=u(t+1,e,!0,i),h=n&&n.collides;return h&&(n.faceTop=!0,n.faceBottom=!0,n.faceLeft=!0,n.faceRight=!0),s&&s.collides&&(h&&(n.faceTop=!1),s.faceBottom=!h),r&&r.collides&&(h&&(n.faceBottom=!1),r.faceTop=!h),o&&o.collides&&(h&&(n.faceLeft=!1),o.faceRight=!h),a&&a.collides&&(h&&(n.faceRight=!1),a.faceLeft=!h),n&&!n.collides&&n.resetFaces(),n;};},function(t,e){t.exports=function(t,e,i){var n=i.baseTileWidth,s=i.tilemapLayer,r=0;return s&&(e=e||s.scene.cameras.main,r=s.x+e.scrollX*(1-s.scrollFactorX),n*=s.scaleX),r+t*n;};},function(t,e){t.exports=function(t,e,i){var n=i.baseTileHeight,s=i.tilemapLayer,r=0;return s&&(e=e||s.scene.cameras.main,r=s.y+e.scrollY*(1-s.scrollFactorY),n*=s.scaleY),r+t*n;};},function(t,e){t.exports=function(t,e,i,n){void 0===e&&(e=!0);var s=n.baseTileWidth,r=n.tilemapLayer;return r&&(i=i||r.scene.cameras.main,t-=r.x+i.scrollX*(1-r.scrollFactorX),s*=r.scaleX),e?Math.floor(t/s):t/s;};},function(t,e){t.exports=function(t,e,i,n){void 0===e&&(e=!0);var s=n.baseTileHeight,r=n.tilemapLayer;return r&&(i=i||r.scene.cameras.main,t-=r.y+i.scrollY*(1-r.scrollFactorY),s*=r.scaleY),e?Math.floor(t/s):t/s;};},function(t,e,i){var l=i(85),c=i(119),d=i(252),f=i(72);t.exports=function(t,e,i,n,s){if(void 0===n&&(n=!0),!c(e,i,s))return null;var r,o=s.data[i][e],a=o&&o.collides;t instanceof l?(null===s.data[i][e]&&(s.data[i][e]=new l(s,t.index,e,i,s.tileWidth,s.tileHeight)),s.data[i][e].copy(t)):(r=t,null===s.data[i][e]?s.data[i][e]=new l(s,r,e,i,s.tileWidth,s.tileHeight):s.data[i][e].index=r);var h=s.data[i][e],u=-1!==s.collideIndexes.indexOf(h.index);return f(h,u),n&&a!==h.collides&&d(e,i,s),h;};},function(t,e,i){var n=i(29);t.exports=function(t){return"isometric"===(t=t.toLowerCase())?n.ISOMETRIC:"staggered"===t?n.STAGGERED:"hexagonal"===t?n.HEXAGONAL:n.ORTHOGONAL;};},function(t,e,i){var p=i(40),g=i(120),v=i(121),m=i(85);t.exports=function(t,e,i,n,s){for(var r=new g({tileWidth:i,tileHeight:n}),o=new v({name:t,tileWidth:i,tileHeight:n,format:p.ARRAY_2D,layers:[r]}),a=[],h=e.length,u=0,l=0;l<e.length;l++){a[l]=[];for(var c=e[l],d=0;d<c.length;d++){var f=parseInt(c[d],10);isNaN(f)||-1===f?a[l][d]=s?null:new m(r,-1,d,l,i,n):a[l][d]=new m(r,f,d,l,i,n);}0===u&&(u=c.length);}return o.width=r.width=u,o.height=r.height=h,o.widthInPixels=r.widthInPixels=u*i,o.heightInPixels=r.heightInPixels=h*n,r.data=a,o;};},function(t,e,i){function r(t){return{x:t.x,y:t.y};}var o=i(571),a=i(261),h=["id","name","type","rotation","properties","visible","x","y","width","height"];t.exports=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n,s=o(t,h);return s.x+=e,s.y+=i,t.gid?(n=a(t.gid),s.gid=n.gid,s.flippedHorizontal=n.flippedHorizontal,s.flippedVertical=n.flippedVertical,s.flippedAntiDiagonal=n.flippedAntiDiagonal):t.polyline?s.polyline=t.polyline.map(r):t.polygon?s.polygon=t.polygon.map(r):t.ellipse?s.ellipse=t.ellipse:t.text?s.text=t.text:t.point?s.point=!0:s.rectangle=!0,s;};},function(t,e){t.exports=function(t){var e=Boolean(2147483648&t),i=Boolean(1073741824&t),n=Boolean(536870912&t);t&=536870911;var s=0,r=!1;return e&&i&&n?(s=Math.PI/2,r=!0):e&&i&&!n?(s=Math.PI,r=!1):e&&!i&&n?(s=Math.PI/2,r=!1):!e||i||n?!e&&i&&n?(s=3*Math.PI/2,r=!1):e||!i||n?e||i||!n?e||i||n||(s=0,r=!1):(s=3*Math.PI/2,r=!0):(s=Math.PI,r=!0):r=!(s=0),{gid:t,flippedHorizontal:e,flippedVertical:i,flippedAntiDiagonal:n,rotation:s,flipped:r};};},function(t,e,i){var l=i(40),c=i(121),d=i(564),f=i(580);t.exports=function(t,e,i,n,s,r,o,a){void 0===i&&(i=32),void 0===n&&(n=32),void 0===s&&(s=10),void 0===r&&(r=10),void 0===a&&(a=!1);var h,u=null;return Array.isArray(o)?u=d(void 0!==e?e:"map",l.ARRAY_2D,o,i,n,a):void 0!==e&&((h=t.cache.tilemap.get(e))?u=d(e,h.format,h.data,i,n,a):console.warn("No map data found for key "+e)),null===u&&(u=new c({tileWidth:i,tileHeight:n,width:s,height:r})),new f(t,u);};},function(t,e,i){var n=i(6);t.exports=function(t){var e=n(t,"targets",null);return null===e||("function"==typeof e&&(e=e.call()),Array.isArray(e)||(e=[e])),e;};},function(t,e){function g(t){return!!t.getActive&&"function"==typeof t.getActive;}function v(t){return!!t.getStart&&"function"==typeof t.getStart;}function m(t){return!!t.getEnd&&"function"==typeof t.getEnd;}var y=function(t,e){var i,n,s,r,o,a,h,u=function(t,e,i){return i;},l=function(t,e,i){return i;},c=null,d=typeof e;if("number"==d)u=function(){return e;};else if("string"==d){var f=e[0],p=parseFloat(e.substr(2));switch(f){case"+":u=function(t,e,i){return i+p;};break;case"-":u=function(t,e,i){return i-p;};break;case"*":u=function(t,e,i){return i*p;};break;case"/":u=function(t,e,i){return i/p;};break;default:u=function(){return parseFloat(e);};}}else{"function"==d?u=e:"object"==d&&(v(h=e)||m(h)||g(h)?(g(e)&&(c=e.getActive),m(e)&&(u=e.getEnd),v(e)&&(l=e.getStart)):e.hasOwnProperty("value")?a=y(t,e.value):(i=e.hasOwnProperty("to"),n=e.hasOwnProperty("from"),s=e.hasOwnProperty("start"),i&&(n||s)&&(a=y(t,e.to),s&&(r=y(t,e.start),a.getActive=r.getEnd),n&&(o=y(t,e.from),a.getStart=o.getEnd))));}return a=a||{getActive:c,getEnd:u,getStart:l};};t.exports=y;},function(t,e){t.exports={targets:null,delay:0,duration:1e3,ease:"Power0",easeParams:null,hold:0,repeat:0,repeatDelay:0,yoyo:!1,flipX:!1,flipY:!1};},function(t,e,i){var n=i(0),s=i(9),l=i(267),r=i(16),o=i(5),c=i(100),a=i(14),h=new n({Extends:s,initialize:function(t,e,i){s.call(this),this.parent=t,this.parentIsTimeline=t.hasOwnProperty("isTimeline"),this.data=e,this.totalData=e.length,this.targets=i,this.totalTargets=i.length,this.useFrames=!1,this.timeScale=1,this.loop=0,this.loopDelay=0,this.loopCounter=0,this.startDelay=0,this.hasStarted=!1,this.isSeeking=!1,this.completeDelay=0,this.countdown=0,this.offset=0,this.calculatedOffset=0,this.state=c.PENDING_ADD,this._pausedState=c.INIT,this.paused=!1,this.elapsed=0,this.totalElapsed=0,this.duration=0,this.progress=0,this.totalDuration=0,this.totalProgress=0,this.callbacks={onActive:null,onComplete:null,onLoop:null,onRepeat:null,onStart:null,onStop:null,onUpdate:null,onYoyo:null},this.callbackScope;},getValue:function(t){return void 0===t&&(t=0),this.data[t].current;},setTimeScale:function(t){return this.timeScale=t,this;},getTimeScale:function(){return this.timeScale;},isPlaying:function(){return this.state===c.ACTIVE;},isPaused:function(){return this.state===c.PAUSED;},hasTarget:function(t){return-1!==this.targets.indexOf(t);},updateTo:function(t,e,i){void 0===i&&(i=!1);for(var n=0;n<this.totalData;n++){var s=this.data[n];s.key===t&&(s.end=e,i&&(s.start=s.current));}return this;},restart:function(){return this.elapsed=0,this.progress=0,this.totalElapsed=0,this.totalProgress=0,this.state===c.ACTIVE?this.seek(0):this.state===c.REMOVED?(this.seek(0),this.parent.makeActive(this),this):this.state===c.PENDING_ADD?this:this.play();},calcDuration:function(){for(var t=0,e=a.MAX_SAFE_INTEGER,i=this.data,n=0;n<this.totalData;n++){var s=i[n];s.t1=s.duration+s.hold,s.yoyo&&(s.t1+=s.duration),s.t2=s.t1+s.repeatDelay,s.totalDuration=s.delay+s.t1,-1===s.repeat?s.totalDuration+=999999999999*s.t2:0<s.repeat&&(s.totalDuration+=s.t2*s.repeat),s.totalDuration>t&&(t=s.totalDuration),s.delay<e&&(e=s.delay);}this.duration=Math.max(t,.001),this.loopCounter=-1===this.loop?999999999999:this.loop,0<this.loopCounter?this.totalDuration=this.duration+this.completeDelay+(this.duration+this.loopDelay)*this.loopCounter:this.totalDuration=this.duration+this.completeDelay,this.startDelay=e;},init:function(){if(this.paused&&!this.parentIsTimeline)return this.state=c.PENDING_ADD,this._pausedState=c.INIT,!1;for(var t=this.data,e=this.totalTargets,i=0;i<this.totalData;i++){var n=t[i],s=n.target,r=n.gen,o=n.key,a=n.index;n.delay=r.delay(s,o,0,a,e,this),n.duration=Math.max(r.duration(s,o,0,a,e,this),.001),n.hold=r.hold(s,o,0,a,e,this),n.repeat=r.repeat(s,o,0,a,e,this),n.repeatDelay=r.repeatDelay(s,o,0,a,e,this);}return this.calcDuration(),this.progress=0,this.totalProgress=0,this.elapsed=0,this.totalElapsed=0,this.state=c.INIT,!0;},makeActive:function(){this.parent.makeActive(this),this.dispatchTweenEvent(l.TWEEN_ACTIVE,this.callbacks.onActive);},nextState:function(){0<this.loopCounter?(this.elapsed=0,this.progress=0,this.loopCounter--,this.resetTweenData(!0),0<this.loopDelay?(this.countdown=this.loopDelay,this.state=c.LOOP_DELAY):(this.state=c.ACTIVE,this.dispatchTweenEvent(l.TWEEN_LOOP,this.callbacks.onLoop))):0<this.completeDelay?(this.state=c.COMPLETE_DELAY,this.countdown=this.completeDelay):(this.state=c.PENDING_REMOVE,this.dispatchTweenEvent(l.TWEEN_COMPLETE,this.callbacks.onComplete));},pause:function(){return this.state===c.PAUSED||(this.paused=!0,this._pausedState=this.state,this.state=c.PAUSED),this;},play:function(t){void 0===t&&(t=!1);var e=this.state;return e!==c.INIT||this.parentIsTimeline?e===c.ACTIVE||e===c.PENDING_ADD&&this._pausedState===c.PENDING_ADD||(this.parentIsTimeline||e!==c.PENDING_REMOVE&&e!==c.REMOVED?this.parentIsTimeline?(this.resetTweenData(t),0===this.calculatedOffset?this.state=c.ACTIVE:(this.countdown=this.calculatedOffset,this.state=c.OFFSET_DELAY)):(this.paused?this.paused=!1:(this.resetTweenData(t),this.state=c.ACTIVE),this.makeActive()):(this.seek(0),this.parent.makeActive(this))):(this.resetTweenData(!1),this.state=c.ACTIVE),this;},resetTweenData:function(t){for(var e=this.data,i=this.totalData,n=this.totalTargets,s=0;s<i;s++){var r=e[s],o=r.target,a=r.key,h=r.index;r.progress=0,r.elapsed=0,r.repeatCounter=-1===r.repeat?999999999999:r.repeat,t?(r.start=r.getStartValue(o,a,r.start,h,n,this),r.end=r.getEndValue(o,a,r.end,h,n,this),r.current=r.start,r.state=c.PLAYING_FORWARD):r.state=c.PENDING_RENDER,0<r.delay&&(r.elapsed=r.delay,r.state=c.DELAY),r.getActiveValue&&(o[a]=r.getActiveValue(r.target,r.key,r.start));}},resume:function(){return this.state===c.PAUSED?(this.paused=!1,this.state=this._pausedState):this.play(),this;},seek:function(t,e){void 0===e&&(e=16.6),this.state===c.REMOVED&&this.makeActive(),this.elapsed=0,this.progress=0,this.totalElapsed=0,this.totalProgress=0;for(var i=this.data,n=this.totalTargets,s=0;s<this.totalData;s++){var r=i[s],o=r.target,a=r.gen,h=r.key,u=r.index;r.progress=0,r.elapsed=0,r.repeatCounter=-1===r.repeat?999999999999:r.repeat,r.delay=a.delay(o,h,0,u,n,this),r.duration=Math.max(a.duration(o,h,0,u,n,this),.001),r.hold=a.hold(o,h,0,u,n,this),r.repeat=a.repeat(o,h,0,u,n,this),r.repeatDelay=a.repeatDelay(o,h,0,u,n,this),r.current=r.start,r.state=c.PLAYING_FORWARD,this.updateTweenData(this,r,0,u,n),0<r.delay&&(r.elapsed=r.delay,r.state=c.DELAY);}this.calcDuration();var l=!1;for(this.state===c.PAUSED&&(l=!0,this.state=c.ACTIVE),this.isSeeking=!0;this.update(0,e),this.totalProgress<t;);return this.isSeeking=!1,l&&(this.state=c.PAUSED),this;},setCallback:function(t,e,i,n){return this.callbacks[t]={func:e,scope:n,params:i},this;},complete:function(t){return void 0===t&&(t=0),t?(this.state=c.COMPLETE_DELAY,this.countdown=t):(this.state=c.PENDING_REMOVE,this.dispatchTweenEvent(l.TWEEN_COMPLETE,this.callbacks.onComplete)),this;},remove:function(){return this.parent.remove(this),this;},stop:function(t){return this.state===c.ACTIVE&&void 0!==t&&this.seek(t),this.state!==c.REMOVED&&(this.state!==c.PAUSED&&this.state!==c.PENDING_ADD||(this.parentIsTimeline?(this.parent.manager._destroy.push(this),this.parent.manager._toProcess++):(this.parent._destroy.push(this),this.parent._toProcess++)),this.dispatchTweenEvent(l.TWEEN_STOP,this.callbacks.onStop),this.removeAllListeners(),this.state=c.PENDING_REMOVE),this;},update:function(t,e){if(this.state===c.PAUSED)return!1;switch(this.useFrames&&(e=+this.parent.timeScale),e*=this.timeScale,this.elapsed+=e,this.progress=Math.min(this.elapsed/this.duration,1),this.totalElapsed+=e,this.totalProgress=Math.min(this.totalElapsed/this.totalDuration,1),this.state){case c.ACTIVE:this.hasStarted||this.isSeeking||(this.startDelay-=e,this.startDelay<=0&&(this.hasStarted=!0,this.dispatchTweenEvent(l.TWEEN_START,this.callbacks.onStart)));for(var i=!1,n=0;n<this.totalData;n++){var s=this.data[n];this.updateTweenData(this,s,e)&&(i=!0);}i||this.nextState();break;case c.LOOP_DELAY:this.countdown-=e,this.countdown<=0&&(this.state=c.ACTIVE,this.dispatchTweenEvent(l.TWEEN_LOOP,this.callbacks.onLoop));break;case c.OFFSET_DELAY:this.countdown-=e,this.countdown<=0&&(this.state=c.ACTIVE);break;case c.COMPLETE_DELAY:this.countdown-=e,this.countdown<=0&&(this.state=c.PENDING_REMOVE,this.dispatchTweenEvent(l.TWEEN_COMPLETE,this.callbacks.onComplete));}return this.state===c.PENDING_REMOVE;},dispatchTweenDataEvent:function(t,e,i){this.isSeeking||(this.emit(t,this,i.key,i.target,i.current,i.previous),e&&(e.params[1]=i.target,e.func.apply(e.scope,e.params)));},dispatchTweenEvent:function(t,e){this.isSeeking||(this.emit(t,this,this.targets),e&&(e.params[1]=this.targets,e.func.apply(e.scope,e.params)));},setStateFromEnd:function(t,e,i){return e.yoyo?(e.elapsed=i,e.progress=i/e.duration,e.flipX&&e.target.toggleFlipX(),e.flipY&&e.target.toggleFlipY(),this.dispatchTweenDataEvent(l.TWEEN_YOYO,t.callbacks.onYoyo,e),e.start=e.getStartValue(e.target,e.key,e.start,e.index,t.totalTargets,t),c.PLAYING_BACKWARD):0<e.repeatCounter?(e.repeatCounter--,e.elapsed=i,e.progress=i/e.duration,e.flipX&&e.target.toggleFlipX(),e.flipY&&e.target.toggleFlipY(),e.start=e.getStartValue(e.target,e.key,e.start,e.index,t.totalTargets,t),e.end=e.getEndValue(e.target,e.key,e.start,e.index,t.totalTargets,t),0<e.repeatDelay?(e.elapsed=e.repeatDelay-i,e.current=e.start,e.target[e.key]=e.current,c.REPEAT_DELAY):(this.dispatchTweenDataEvent(l.TWEEN_REPEAT,t.callbacks.onRepeat,e),c.PLAYING_FORWARD)):c.COMPLETE;},setStateFromStart:function(t,e,i){return 0<e.repeatCounter?(e.repeatCounter--,e.elapsed=i,e.progress=i/e.duration,e.flipX&&e.target.toggleFlipX(),e.flipY&&e.target.toggleFlipY(),e.end=e.getEndValue(e.target,e.key,e.start,e.index,t.totalTargets,t),0<e.repeatDelay?(e.elapsed=e.repeatDelay-i,e.current=e.start,e.target[e.key]=e.current,c.REPEAT_DELAY):(this.dispatchTweenDataEvent(l.TWEEN_REPEAT,t.callbacks.onRepeat,e),c.PLAYING_FORWARD)):c.COMPLETE;},updateTweenData:function(t,e,i){var n=e.target;switch(e.state){case c.PLAYING_FORWARD:case c.PLAYING_BACKWARD:if(!n){e.state=c.COMPLETE;break;}var s=e.elapsed,r=e.duration,o=0;r<(s+=i)&&(o=s-r,s=r);var a,h=e.state===c.PLAYING_FORWARD,u=s/r;e.elapsed=s,e.progress=u,e.previous=e.current,1==u?h?(e.current=e.end,n[e.key]=e.end,0<e.hold?(e.elapsed=e.hold-o,e.state=c.HOLD_DELAY):e.state=this.setStateFromEnd(t,e,o)):(e.current=e.start,n[e.key]=e.start,e.state=this.setStateFromStart(t,e,o)):(a=h?e.ease(u):e.ease(1-u),e.current=e.start+(e.end-e.start)*a,n[e.key]=e.current),this.dispatchTweenDataEvent(l.TWEEN_UPDATE,t.callbacks.onUpdate,e);break;case c.DELAY:e.elapsed-=i,e.elapsed<=0&&(e.elapsed=Math.abs(e.elapsed),e.state=c.PENDING_RENDER);break;case c.REPEAT_DELAY:e.elapsed-=i,e.elapsed<=0&&(e.elapsed=Math.abs(e.elapsed),e.state=c.PLAYING_FORWARD,this.dispatchTweenDataEvent(l.TWEEN_REPEAT,t.callbacks.onRepeat,e));break;case c.HOLD_DELAY:e.elapsed-=i,e.elapsed<=0&&(e.state=this.setStateFromEnd(t,e,Math.abs(e.elapsed)));break;case c.PENDING_RENDER:n?(e.start=e.getStartValue(n,e.key,n[e.key],e.index,t.totalTargets,t),e.end=e.getEndValue(n,e.key,e.start,e.index,t.totalTargets,t),e.current=e.start,n[e.key]=e.start,e.state=c.PLAYING_FORWARD):e.state=c.COMPLETE;}return e.state!==c.COMPLETE;}});h.TYPES=["onActive","onComplete","onLoop","onRepeat","onStart","onStop","onUpdate","onYoyo"],o.register("tween",function(t){return this.scene.sys.tweens.add(t);}),r.register("tween",function(t){return this.scene.sys.tweens.create(t);}),t.exports=h;},function(t,e,i){t.exports={TIMELINE_COMPLETE:i(1466),TIMELINE_LOOP:i(1467),TIMELINE_PAUSE:i(1468),TIMELINE_RESUME:i(1469),TIMELINE_START:i(1470),TIMELINE_UPDATE:i(1471),TWEEN_ACTIVE:i(1472),TWEEN_COMPLETE:i(1473),TWEEN_LOOP:i(1474),TWEEN_REPEAT:i(1475),TWEEN_START:i(1476),TWEEN_STOP:i(1477),TWEEN_UPDATE:i(1478),TWEEN_YOYO:i(1479)};},function(t,e){t.exports=function(t,e,i,n,s,r,o,a,h,u,l,c,d,f,p){return{target:t,index:e,key:i,getActiveValue:r,getEndValue:n,getStartValue:s,ease:o,duration:0,totalDuration:0,delay:0,yoyo:u,hold:0,repeat:0,repeatDelay:0,flipX:f,flipY:p,progress:0,elapsed:0,repeatCounter:0,start:0,previous:0,current:0,end:0,t1:0,t2:0,gen:{delay:a,duration:h,hold:l,repeat:c,repeatDelay:d},state:0};};},function(t,e,i){var n=i(68);t.exports=function(t){return n(t,-Math.PI,Math.PI);};},function(t,e,i){var n=i(68);t.exports=function(t){return n(t,-180,180);};},,,,,function(t,e,i){t.exports={AlignTo:i(601),Angle:i(602),Call:i(603),GetFirst:i(604),GetLast:i(605),GridAlign:i(606),IncAlpha:i(678),IncX:i(679),IncXY:i(680),IncY:i(681),PlaceOnCircle:i(682),PlaceOnEllipse:i(683),PlaceOnLine:i(684),PlaceOnRectangle:i(685),PlaceOnTriangle:i(686),PlayAnimation:i(687),PropertyValueInc:i(46),PropertyValueSet:i(27),RandomCircle:i(688),RandomEllipse:i(689),RandomLine:i(690),RandomRectangle:i(691),RandomTriangle:i(692),Rotate:i(693),RotateAround:i(694),RotateAroundDistance:i(695),ScaleX:i(696),ScaleXY:i(697),ScaleY:i(698),SetAlpha:i(699),SetBlendMode:i(700),SetDepth:i(701),SetHitArea:i(702),SetOrigin:i(703),SetRotation:i(704),SetScale:i(705),SetScaleX:i(706),SetScaleY:i(707),SetScrollFactor:i(708),SetScrollFactorX:i(709),SetScrollFactorY:i(710),SetTint:i(711),SetVisible:i(712),SetX:i(713),SetXY:i(714),SetY:i(715),ShiftPosition:i(716),Shuffle:i(717),SmootherStep:i(718),SmoothStep:i(719),Spread:i(720),ToggleVisible:i(721),WrapInRectangle:i(722)};},function(t,e,i){var n=i(123),r=[];r[n.BOTTOM_CENTER]=i(277),r[n.BOTTOM_LEFT]=i(278),r[n.BOTTOM_RIGHT]=i(279),r[n.LEFT_BOTTOM]=i(280),r[n.LEFT_CENTER]=i(281),r[n.LEFT_TOP]=i(282),r[n.RIGHT_BOTTOM]=i(283),r[n.RIGHT_CENTER]=i(284),r[n.RIGHT_TOP]=i(285),r[n.TOP_CENTER]=i(286),r[n.TOP_LEFT]=i(287),r[n.TOP_RIGHT]=i(288);t.exports=function(t,e,i,n,s){return r[i](t,e,n,s);};},function(t,e,i){var s=i(42),r=i(87),o=i(88),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,r(e)+i),a(t,s(e)+n),t;};},function(t,e,i){var s=i(42),r=i(43),o=i(53),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,r(e)-i),a(t,s(e)+n),t;};},function(t,e,i){var s=i(42),r=i(44),o=i(54),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,r(e)+i),a(t,s(e)+n),t;};},function(t,e,i){var s=i(42),r=i(43),o=i(55),a=i(54);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)-i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(89),r=i(43),o=i(90),a=i(54);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)-i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(43),r=i(45),o=i(54),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,s(e)-i),a(t,r(e)-n),t;};},function(t,e,i){var s=i(42),r=i(44),o=i(55),a=i(53);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)+i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(89),r=i(44),o=i(90),a=i(53);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)+i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(44),r=i(45),o=i(53),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,s(e)+i),a(t,r(e)-n),t;};},function(t,e,i){var s=i(87),r=i(45),o=i(55),a=i(88);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,s(e)+i),o(t,r(e)-n),t;};},function(t,e,i){var s=i(43),r=i(45),o=i(55),a=i(53);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,s(e)-i),o(t,r(e)-n),t;};},function(t,e,i){var s=i(44),r=i(45),o=i(55),a=i(54);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,s(e)+i),o(t,r(e)-n),t;};},function(t,e,i){var n=i(123),r=[];r[n.BOTTOM_CENTER]=i(290),r[n.BOTTOM_LEFT]=i(291),r[n.BOTTOM_RIGHT]=i(292),r[n.CENTER]=i(293),r[n.LEFT_CENTER]=i(295),r[n.RIGHT_CENTER]=i(296),r[n.TOP_CENTER]=i(297),r[n.TOP_LEFT]=i(298),r[n.TOP_RIGHT]=i(299),r[n.LEFT_BOTTOM]=r[n.BOTTOM_LEFT],r[n.LEFT_TOP]=r[n.TOP_LEFT],r[n.RIGHT_BOTTOM]=r[n.BOTTOM_RIGHT],r[n.RIGHT_TOP]=r[n.TOP_RIGHT];t.exports=function(t,e,i,n,s){return r[i](t,e,n,s);};},function(t,e,i){var s=i(42),r=i(87),o=i(55),a=i(88);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)+i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(42),r=i(43),o=i(55),a=i(53);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)-i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(42),r=i(44),o=i(55),a=i(54);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)+i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(294),r=i(87),o=i(89);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),s(t,r(e)+i,o(e)+n),t;};},function(t,e,i){var n=i(88),s=i(90);t.exports=function(t,e,i){return n(t,e),s(t,i);};},function(t,e,i){var s=i(89),r=i(43),o=i(90),a=i(53);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)-i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(89),r=i(44),o=i(90),a=i(54);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),a(t,r(e)+i),o(t,s(e)+n),t;};},function(t,e,i){var s=i(87),r=i(45),o=i(88),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,s(e)+i),a(t,r(e)-n),t;};},function(t,e,i){var s=i(43),r=i(45),o=i(53),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,s(e)-i),a(t,r(e)-n),t;};},function(t,e,i){var s=i(44),r=i(45),o=i(54),a=i(52);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=0),o(t,s(e)+i),a(t,r(e)-n),t;};},function(t,e,i){var s=i(169),r=i(98),o=i(14),a=i(4);t.exports=function(t,e,i){void 0===i&&(i=new a());var n=r(e,0,o.PI2);return s(t,n,i);};},function(t,e,i){var o=i(302),a=i(169),h=i(98),u=i(14);t.exports=function(t,e,i,n){void 0===n&&(n=[]),!e&&0<i&&(e=o(t)/i);for(var s=0;s<e;s++){var r=h(s/e,0,u.PI2);n.push(a(t,r));}return n;};},function(t,e){t.exports=function(t){return Math.PI*t.radius*2;};},function(t,e,i){var n=i(18),s={_alpha:1,clearAlpha:function(){return this.setAlpha(1);},setAlpha:function(t){return void 0===t&&(t=1),this.alpha=t,this;},alpha:{get:function(){return this._alpha;},set:function(t){var e=n(t,0,1);0===(this._alpha=e)?this.renderFlags&=-3:this.renderFlags|=2;}}};t.exports=s;},function(t,e,i){var n=i(35),s={_blendMode:n.NORMAL,blendMode:{get:function(){return this._blendMode;},set:function(t){"string"==typeof t&&(t=n[t]),-1<=(t|=0)&&(this._blendMode=t);}},setBlendMode:function(t){return this.blendMode=t,this;}};t.exports=s;},function(t,e){var i={_depth:0,depth:{get:function(){return this._depth;},set:function(t){this.displayList&&this.displayList.queueDepthSort(),this._depth=t;}},setDepth:function(t){return void 0===t&&(t=0),this.depth=t,this;}};t.exports=i;},function(t,e,i){var o=i(171),a=i(130);t.exports=function(t,e,i,n){void 0===n&&(n=[]),!e&&0<i&&(e=a(t)/i);for(var s=0;s<e;s++){var r=s/e;n.push(o(t,r));}return n;};},function(t,e,i){var n=i(4);t.exports=function(t,e,i){return void 0===i&&(i=new n()),i.x=t.x1+(t.x2-t.x1)*e,i.y=t.y1+(t.y2-t.y1)*e,i;};},function(t,e){t.exports=function(t,e,i,n){var s=Math.cos(n),r=Math.sin(n),o=t.x-e,a=t.y-i;return t.x=o*s-a*r+e,t.y=o*r+a*s+i,t;};},function(t,e,i){var n=i(310),s=i(311),r={mask:null,setMask:function(t){return this.mask=t,this;},clearMask:function(t){return void 0===t&&(t=!1),t&&this.mask&&this.mask.destroy(),this.mask=null,this;},createBitmapMask:function(t){return void 0===t&&(this.texture||this.shader)&&(t=this),new n(this.scene,t);},createGeometryMask:function(t){return void 0===t&&"Graphics"===this.type&&(t=this),new s(this.scene,t);}};t.exports=r;},function(t,e,i){var n=i(0),s=i(22),r=i(91),o=new n({initialize:function(t,e){var i=t.sys.renderer;this.renderer=i,this.bitmapMask=e,this.maskTexture=null,this.mainTexture=null,this.dirty=!0,this.mainFramebuffer=null,this.maskFramebuffer=null,this.invertAlpha=!1,this.isStencil=!1,this.createMask(),t.sys.game.events.on(s.CONTEXT_RESTORED,this.createMask,this),i&&i.on(r.RESIZE,this.createMask,this);},createMask:function(){var t,e,i,n,s,r,o=this.renderer;o&&o.gl&&(this.mainTexture&&this.clearMask(),t=o.width,e=o.height,i=0==(t&t-1)&&0==(e&e-1),n=o.gl,s=i?n.REPEAT:n.CLAMP_TO_EDGE,r=n.LINEAR,this.mainTexture=o.createTexture2D(0,r,r,s,s,n.RGBA,null,t,e),this.maskTexture=o.createTexture2D(0,r,r,s,s,n.RGBA,null,t,e),this.mainFramebuffer=o.createFramebuffer(t,e,this.mainTexture,!0),this.maskFramebuffer=o.createFramebuffer(t,e,this.maskTexture,!0));},clearMask:function(){var t=this.renderer;t&&t.gl&&this.mainTexture&&(t.deleteTexture(this.mainTexture),t.deleteTexture(this.maskTexture),t.deleteFramebuffer(this.mainFramebuffer),t.deleteFramebuffer(this.maskFramebuffer),this.mainTexture=null,this.maskTexture=null,this.mainFramebuffer=null,this.maskFramebuffer=null);},setBitmap:function(t){this.bitmapMask=t;},preRenderWebGL:function(t,e,i){t.pipelines.BITMAPMASK_PIPELINE.beginMask(this,e,i);},postRenderWebGL:function(t,e){t.pipelines.BITMAPMASK_PIPELINE.endMask(this,e);},preRenderCanvas:function(){},postRenderCanvas:function(){},destroy:function(){this.clearMask(),this.renderer&&this.renderer.off(r.RESIZE,this.createMask,this),this.bitmapMask=null,this.prevFramebuffer=null,this.renderer=null;}});t.exports=o;},function(t,e,i){var n=new(i(0))({initialize:function(t,e){this.geometryMask=e,this.invertAlpha=!1,this.isStencil=!0,this.level=0;},setShape:function(t){return this.geometryMask=t,this;},setInvertAlpha:function(t){return void 0===t&&(t=!0),this.invertAlpha=t,this;},preRenderWebGL:function(t,e,i){var n=t.gl;t.flush(),0===t.maskStack.length&&(n.enable(n.STENCIL_TEST),n.clear(n.STENCIL_BUFFER_BIT),t.maskCount=0),t.currentCameraMask.mask!==this&&(t.currentMask.mask=this),t.maskStack.push({mask:this,camera:i}),this.applyStencil(t,i,!0),t.maskCount++;},applyStencil:function(t,e,i){var n=t.gl,s=this.geometryMask,r=t.maskCount;n.colorMask(!1,!1,!1,!1),i?(n.stencilFunc(n.EQUAL,r,255),n.stencilOp(n.KEEP,n.KEEP,n.INCR)):(n.stencilFunc(n.EQUAL,r+1,255),n.stencilOp(n.KEEP,n.KEEP,n.DECR)),s.renderWebGL(t,s,e),t.flush(),n.colorMask(!0,!0,!0,!0),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),i?this.invertAlpha?n.stencilFunc(n.NOTEQUAL,r+1,255):n.stencilFunc(n.EQUAL,r+1,255):this.invertAlpha?n.stencilFunc(n.NOTEQUAL,r,255):n.stencilFunc(n.EQUAL,r,255);},postRenderWebGL:function(t){var e=t.gl;t.maskStack.pop(),t.maskCount--,t.flush();var i,n=t.currentMask;0===t.maskStack.length?(n.mask=null,e.disable(e.STENCIL_TEST)):((i=t.maskStack[t.maskStack.length-1]).mask.applyStencil(t,i.camera,!1),t.currentCameraMask.mask!==i.mask?(n.mask=i.mask,n.camera=i.camera):n.mask=null);},preRenderCanvas:function(t,e,i){var n=this.geometryMask;t.currentContext.save(),n.renderCanvas(t,n,i,null,null,!0),t.currentContext.clip();},postRenderCanvas:function(t){t.currentContext.restore();},destroy:function(){this.geometryMask=null;}});t.exports=n;},function(t,e){var i={scrollFactorX:1,scrollFactorY:1,setScrollFactor:function(t,e){return void 0===e&&(e=t),this.scrollFactorX=t,this.scrollFactorY=e,this;}};t.exports=i;},function(t,e,i){var n=i(14),s=i(25),h=i(177),r=i(269),o=i(270),u=i(3),a={_scaleX:1,_scaleY:1,_rotation:0,x:0,y:0,z:0,w:0,scale:{get:function(){return(this._scaleX+this._scaleY)/2;},set:function(t){this._scaleX=t,0===(this._scaleY=t)?this.renderFlags&=-5:this.renderFlags|=4;}},scaleX:{get:function(){return this._scaleX;},set:function(t){0===(this._scaleX=t)?this.renderFlags&=-5:this.renderFlags|=4;}},scaleY:{get:function(){return this._scaleY;},set:function(t){0===(this._scaleY=t)?this.renderFlags&=-5:this.renderFlags|=4;}},angle:{get:function(){return o(this._rotation*n.RAD_TO_DEG);},set:function(t){this.rotation=o(t)*n.DEG_TO_RAD;}},rotation:{get:function(){return this._rotation;},set:function(t){this._rotation=r(t);}},setPosition:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=i,this.w=n,this;},copyPosition:function(t){return void 0!==t.x&&(this.x=t.x),void 0!==t.y&&(this.y=t.y),void 0!==t.z&&(this.z=t.z),void 0!==t.w&&(this.w=t.w),this;},setRandomPosition:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.scene.sys.scale.width),void 0===n&&(n=this.scene.sys.scale.height),this.x=t+Math.random()*i,this.y=e+Math.random()*n,this;},setRotation:function(t){return void 0===t&&(t=0),this.rotation=t,this;},setAngle:function(t){return void 0===t&&(t=0),this.angle=t,this;},setScale:function(t,e){return void 0===t&&(t=1),void 0===e&&(e=t),this.scaleX=t,this.scaleY=e,this;},setX:function(t){return void 0===t&&(t=0),this.x=t,this;},setY:function(t){return void 0===t&&(t=0),this.y=t,this;},setZ:function(t){return void 0===t&&(t=0),this.z=t,this;},setW:function(t){return void 0===t&&(t=0),this.w=t,this;},getLocalTransformMatrix:function(t){return void 0===t&&(t=new s()),t.applyITRS(this.x,this.y,this._rotation,this._scaleX,this._scaleY);},getWorldTransformMatrix:function(t,e){void 0===t&&(t=new s()),void 0===e&&(e=new s());var i=this.parentContainer;if(!i)return this.getLocalTransformMatrix(t);for(t.applyITRS(this.x,this.y,this._rotation,this._scaleX,this._scaleY);i;)e.applyITRS(i.x,i.y,i._rotation,i._scaleX,i._scaleY),e.multiply(t,t),i=i.parentContainer;return t;},getLocalPoint:function(t,e,i,n){i=i||new u();var s=(n=n||this.scene.sys.cameras.main).scrollX,r=n.scrollY,o=t+s*this.scrollFactorX-s,a=e+r*this.scrollFactorY-r;return this.parentContainer?this.getWorldTransformMatrix().applyInverse(o,a,i):h(o,a,this.x,this.y,this.rotation,this.scaleX,this.scaleY,i),this._originComponent&&(i.x+=this._displayOriginX,i.y+=this._displayOriginY),i;},getParentRotation:function(){for(var t=0,e=this.parentContainer;e;)t+=e.rotation,e=e.parentContainer;return t;}};t.exports=a;},function(t,e){var i={_visible:!0,visible:{get:function(){return this._visible;},set:function(t){t?(this._visible=!0,this.renderFlags|=1):(this._visible=!1,this.renderFlags&=-2);}},setVisible:function(t){return this.visible=t,this;}};t.exports=i;},function(t,e,i){t.exports={CHANGE_DATA:i(638),CHANGE_DATA_KEY:i(639),DESTROY:i(640),REMOVE_DATA:i(641),SET_DATA:i(642)};},function(t,e,i){var h=i(130),u=i(4);t.exports=function(t,e,i,n){if(void 0===n&&(n=[]),!e&&!i)return n;e?i=Math.round(h(t)/e):e=h(t)/i;for(var s=t.x,r=t.y,o=0,a=0;a<i;a++)switch(n.push(new u(s,r)),o){case 0:(s+=e)>=t.right&&(o=1,r+=s-t.right,s=t.right);break;case 1:(r+=e)>=t.bottom&&(o=2,s-=r-t.bottom,r=t.bottom);break;case 2:(s-=e)<=t.left&&(o=3,r-=t.left-s,s=t.left);break;case 3:(r-=e)<=t.top&&(o=0,r=t.top);}return n;};},function(t,e){t.exports=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=[]);var n=Math.round(t.x1),s=Math.round(t.y1),r=Math.round(t.x2),o=Math.round(t.y2),a=Math.abs(r-n),h=Math.abs(o-s),u=n<r?1:-1,l=s<o?1:-1,c=a-h;i.push({x:n,y:s});for(var d=1;n!==r||s!==o;){var f=c<<1;-h<f&&(c-=h,n+=u),f<a&&(c+=a,s+=l),d%e==0&&i.push({x:n,y:s}),d++;}return i;};},function(t,e){t.exports=function(t,e,i){if(!e.length)return NaN;if(1===e.length)return e[0];var n,s,r=1;if(i){if(t<e[0][i])return e[0];for(;e[r][i]<t;)r++;}else for(;e[r]<t;)r++;return r>e.length&&(r=e.length),i?(n=e[r-1][i],(s=e[r][i])-t<=t-n?e[r]:e[r-1]):(n=e[r-1],(s=e[r])-t<=t-n?s:n);};},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n,s){void 0===s&&(s=!1),this.textureKey=t,this.textureFrame=e,this.index=i,this.frame=n,this.isFirst=!1,this.isLast=!1,this.prevFrame=null,this.nextFrame=null,this.duration=0,this.progress=0,this.isKeyFrame=s;},toJSON:function(){return{key:this.textureKey,frame:this.textureFrame,duration:this.duration,keyframe:this.isKeyFrame};},destroy:function(){this.frame=void 0;}});t.exports=n;},function(t,e){t.exports=function(t){var i=/\D/g;return t.sort(function(t,e){return parseInt(t.replace(i,""),10)-parseInt(e.replace(i,""),10);}),t;};},function(t,e,i){var n=i(185),s=i(0),r=i(102),o=i(9),a=i(132),h=i(22),T=i(2),d=i(6),f=i(186),p=i(322),u=new s({Extends:o,initialize:function(t){o.call(this),this.game=t,this.textureManager=null,this.globalTimeScale=1,this.anims=new r(),this.mixes=new r(),this.paused=!1,this.name="AnimationManager",t.events.once(h.BOOT,this.boot,this);},boot:function(){this.textureManager=this.game.textures,this.game.events.once(h.DESTROY,this.destroy,this);},addMix:function(t,e,i){var n,s=this.anims,r=this.mixes,o="string"==typeof t?t:t.key,a="string"==typeof e?e:e.key;return s.has(o)&&s.has(a)&&((n=(n=r.get(o))||{})[a]=i,r.set(o,n)),this;},removeMix:function(t,e){var i,n=this.mixes,s="string"==typeof t?t:t.key,r=n.get(s);return r&&(e?(i="string"==typeof e?e:e.key,r.hasOwnProperty(i)&&delete r[i]):e||n.delete(s)),this;},getMix:function(t,e){var i=this.mixes,n="string"==typeof t?t:t.key,s="string"==typeof e?e:e.key,r=i.get(n);return r&&r.hasOwnProperty(s)?r[s]:0;},add:function(t,e){return this.anims.has(t)?console.warn("Animation key exists: "+t):(e.key=t,this.anims.set(t,e),this.emit(a.ADD_ANIMATION,t,e)),this;},exists:function(t){return this.anims.has(t);},createFromAseprite:function(g,v){var m=[],t=this.game.cache.json.get(g);if(!t)return m;var y=this,e=d(t,"meta",null),x=d(t,"frames",null);return e&&x&&d(e,"frameTags",[]).forEach(function(t){var e=[],i=T(t,"name",null),n=T(t,"from",0),s=T(t,"to",0),r=T(t,"direction","forward");if(i&&(!v||v&&-1<v.indexOf(i))){for(var o=[],a=Number.MAX_SAFE_INTEGER,h=n;h<=s;h++){var u,l=h.toString(),c=x[l];c&&((u=T(c,"duration",Number.MAX_SAFE_INTEGER))<a&&(a=u),o.push({frame:l,duration:u}));}o.forEach(function(t){e.push({key:g,frame:t.frame,duration:a-t.duration});});var d=a*e.length;"reverse"===r&&(e=e.reverse());var f={key:i,frames:e,duration:d,yoyo:"pingpong"===r},p=y.create(f);p&&m.push(p);}}),m;},create:function(t){var e=t.key,i=!1;return e&&((i=this.get(e))||(i=new n(this,e,t),this.anims.set(e,i),this.emit(a.ADD_ANIMATION,e,i))),i;},fromJSON:function(t,e){void 0===e&&(e=!1),e&&this.anims.clear(),"string"==typeof t&&(t=JSON.parse(t));var i=[];if(t.hasOwnProperty("anims")&&Array.isArray(t.anims)){for(var n=0;n<t.anims.length;n++)i.push(this.create(t.anims[n]));t.hasOwnProperty("globalTimeScale")&&(this.globalTimeScale=t.globalTimeScale);}else t.hasOwnProperty("key")&&"frame"===t.type&&i.push(this.create(t));return i;},generateFrameNames:function(t,e){var i,n=d(e,"prefix",""),s=d(e,"start",0),r=d(e,"end",0),o=d(e,"suffix",""),a=d(e,"zeroPad",0),h=d(e,"outputArray",[]),u=d(e,"frames",!1),l=this.textureManager.get(t);if(!l)return h;if(e)for(u=u||p(s,r),i=0;i<u.length;i++){var c=n+f(u[i],a,"0",1)+o;l.has(c)?h.push({key:t,frame:c}):console.warn("generateFrameNames: Frame missing: "+c+" from texture: "+t);}else for(u=l.getFrameNames(),i=0;i<u.length;i++)h.push({key:t,frame:u[i]});return h;},generateFrameNumbers:function(t,e){var i=d(e,"start",0),n=d(e,"end",-1),s=d(e,"first",!1),r=d(e,"outputArray",[]),o=d(e,"frames",!1),a=this.textureManager.get(t);if(!a)return r;s&&a.has(s)&&r.push({key:t,frame:s}),o||(-1===n&&(n=a.frameTotal-2),o=p(i,n));for(var h=0;h<o.length;h++)a.has(o[h])?r.push({key:t,frame:o[h]}):console.warn("generateFrameNumbers: Frame "+h+" missing from texture: "+t);return r;},get:function(t){return this.anims.get(t);},pauseAll:function(){return this.paused||(this.paused=!0,this.emit(a.PAUSE_ALL)),this;},play:function(t,e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)e[i].anims.play(t);return this;},staggerPlay:function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=!0),Array.isArray(e)||(e=[e]);var s=e.length;n||s--;for(var r=0;r<e.length;r++){var o=i<0?Math.abs(i)*(s-r):i*r;e[r].anims.playAfterDelay(t,o);}return this;},remove:function(t){var e=this.get(t);return e&&(this.emit(a.REMOVE_ANIMATION,t,e),this.anims.delete(t),this.removeMix(t)),e;},resumeAll:function(){return this.paused&&(this.paused=!1,this.emit(a.RESUME_ALL)),this;},toJSON:function(t){var i={anims:[],globalTimeScale:this.globalTimeScale};return void 0!==t&&""!==t?i.anims.push(this.anims.get(t).toJSON()):this.anims.each(function(t,e){i.anims.push(e.toJSON());}),i;},destroy:function(){this.anims.clear(),this.mixes.clear(),this.textureManager=null,this.game=null;}});t.exports=u;},function(t,e){t.exports=function(t,e,i,n){var s,r=[],o=!1;if((i||n)&&(o=!0,i=i||"",n=n||""),e<t)for(s=t;e<=s;s--)o?r.push(i+s.toString()+n):r.push(s);else for(s=t;s<=e;s++)o?r.push(i+s.toString()+n):r.push(s);return r;};},function(t,e,i){var n=i(0),s=i(102),r=i(9),o=i(324),a=new n({initialize:function(){this.entries=new s(),this.events=new r();},add:function(t,e){return this.entries.set(t,e),this.events.emit(o.ADD,this,t,e),this;},has:function(t){return this.entries.has(t);},exists:function(t){return this.entries.has(t);},get:function(t){return this.entries.get(t);},remove:function(t){var e=this.get(t);return e&&(this.entries.delete(t),this.events.emit(o.REMOVE,this,t,e.data)),this;},getKeys:function(){return this.entries.keys();},destroy:function(){this.entries.clear(),this.events.removeAllListeners(),this.entries=null,this.events=null;}});t.exports=a;},function(t,e,i){t.exports={ADD:i(736),REMOVE:i(737)};},function(t,e,i){var n=i(323),s=i(0),r=i(22),o=new s({initialize:function(t){this.game=t,this.binary=new n(),this.bitmapFont=new n(),this.json=new n(),this.physics=new n(),this.shader=new n(),this.audio=new n(),this.video=new n(),this.text=new n(),this.html=new n(),this.obj=new n(),this.tilemap=new n(),this.xml=new n(),this.custom={},this.game.events.once(r.DESTROY,this.destroy,this);},addCustom:function(t){return this.custom.hasOwnProperty(t)||(this.custom[t]=new n()),this.custom[t];},destroy:function(){for(var t=["binary","bitmapFont","json","physics","shader","audio","video","text","html","obj","tilemap","xml"],e=0;e<t.length;e++)this[t[e]].destroy(),this[t[e]]=null;for(var i in this.custom)this.custom[i].destroy();this.custom=null,this.game=null;}});t.exports=o;},function(t,e,i){var s=i(133),w=i(190),l=i(18),n=i(0),r=i(11),o=i(333),E=i(37),b=i(135),a=i(10),h=i(3),u=new n({Extends:s,Mixins:[r.Flip,r.Tint,r.Pipeline],initialize:function(t,e,i,n){s.call(this,t,e,i,n),this.postPipelines=[],this.pipelineData={},this.inputEnabled=!0,this.fadeEffect=new o.Fade(this),this.flashEffect=new o.Flash(this),this.shakeEffect=new o.Shake(this),this.panEffect=new o.Pan(this),this.rotateToEffect=new o.RotateTo(this),this.zoomEffect=new o.Zoom(this),this.lerp=new h(1,1),this.followOffset=new h(),this.deadzone=null,this._follow=null;},setDeadzone:function(t,e){var i,n,s,r;return void 0===t?this.deadzone=null:(this.deadzone?(this.deadzone.width=t,this.deadzone.height=e):this.deadzone=new a(0,0,t,e),this._follow&&(i=this.width/2,n=this.height/2,s=this._follow.x-this.followOffset.x,r=this._follow.y-this.followOffset.y,this.midPoint.set(s,r),this.scrollX=s-i,this.scrollY=r-n),w(this.deadzone,this.midPoint.x,this.midPoint.y)),this;},fadeIn:function(t,e,i,n,s,r){return this.fadeEffect.start(!1,t,e,i,n,!0,s,r);},fadeOut:function(t,e,i,n,s,r){return this.fadeEffect.start(!0,t,e,i,n,!0,s,r);},fadeFrom:function(t,e,i,n,s,r,o){return this.fadeEffect.start(!1,t,e,i,n,s,r,o);},fade:function(t,e,i,n,s,r,o){return this.fadeEffect.start(!0,t,e,i,n,s,r,o);},flash:function(t,e,i,n,s,r,o){return this.flashEffect.start(t,e,i,n,s,r,o);},shake:function(t,e,i,n,s){return this.shakeEffect.start(t,e,i,n,s);},pan:function(t,e,i,n,s,r,o){return this.panEffect.start(t,e,i,n,s,r,o);},rotateTo:function(t,e,i,n,s,r,o){return this.rotateToEffect.start(t,e,i,n,s,r,o);},zoomTo:function(t,e,i,n,s,r){return this.zoomEffect.start(t,e,i,n,s,r);},preRender:function(){this.renderList.length=0;var t=this.width,e=this.height,i=.5*t,n=.5*e,s=this.zoom,r=this.matrix,o=t*this.originX,a=e*this.originY,h=this._follow,u=this.deadzone,l=this.scrollX,c=this.scrollY;u&&w(u,this.midPoint.x,this.midPoint.y);var d,f,p=!1;h&&!this.panEffect.isRunning&&(d=h.x-this.followOffset.x,f=h.y-this.followOffset.y,u?(d<u.x?l=b(l,l-(u.x-d),this.lerp.x):d>u.right&&(l=b(l,l+(d-u.right),this.lerp.x)),f<u.y?c=b(c,c-(u.y-f),this.lerp.y):f>u.bottom&&(c=b(c,c+(f-u.bottom),this.lerp.y))):(l=b(l,d-o,this.lerp.x),c=b(c,f-a,this.lerp.y)),p=!0),this.useBounds&&(l=this.clampX(l),c=this.clampY(c)),this.roundPixels&&(o=Math.round(o),a=Math.round(a),l=Math.round(l),c=Math.round(c));var g=(this.scrollX=l)+i,v=(this.scrollY=c)+n;this.midPoint.set(g,v);var m=t/s,y=e/s,x=g-m/2,T=v-y/2;this.roundPixels&&(x=Math.round(x),T=Math.round(T)),this.worldView.setTo(x,T,m,y),r.applyITRS(this.x+o,this.y+a,this.rotation,s,s),r.translate(-o,-a),this.shakeEffect.preRender(),p&&this.emit(E.FOLLOW_UPDATE,this,h);},setLerp:function(t,e){return void 0===t&&(t=1),void 0===e&&(e=t),this.lerp.set(t,e),this;},setFollowOffset:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),this.followOffset.set(t,e),this;},startFollow:function(t,e,i,n,s,r){void 0===e&&(e=!1),void 0===i&&(i=1),void 0===n&&(n=i),void 0===s&&(s=0),void 0===r&&(r=s),this._follow=t,this.roundPixels=e,i=l(i,0,1),n=l(n,0,1),this.lerp.set(i,n),this.followOffset.set(s,r);var o=this.width/2,a=this.height/2,h=t.x-s,u=t.y-r;return this.midPoint.set(h,u),this.scrollX=h-o,this.scrollY=u-a,this.useBounds&&(this.scrollX=this.clampX(this.scrollX),this.scrollY=this.clampY(this.scrollY)),this;},stopFollow:function(){return this._follow=null,this;},resetFX:function(){return this.rotateToEffect.reset(),this.panEffect.reset(),this.shakeEffect.reset(),this.flashEffect.reset(),this.fadeEffect.reset(),this;},update:function(t,e){this.visible&&(this.rotateToEffect.update(t,e),this.panEffect.update(t,e),this.zoomEffect.update(t,e),this.shakeEffect.update(t,e),this.flashEffect.update(t,e),this.fadeEffect.update(t,e));},destroy:function(){this.resetFX(),s.prototype.destroy.call(this),this._follow=null,this.deadzone=null;}});t.exports=u;},function(t,e,i){var o=i(38);t.exports=function(t){var e=new o();t=t.replace(/^(?:#|0x)?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n;});var i,n,s,r=/^(?:#|0x)?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return r&&(i=parseInt(r[1],16),n=parseInt(r[2],16),s=parseInt(r[3],16),e.setTo(i,n,s)),e;};},function(t,e){t.exports=function(t,e,i,n){return n<<24|t<<16|e<<8|i;};},function(t,e){t.exports=function(t,e,i,n){void 0===n&&(n={h:0,s:0,v:0}),t/=255,e/=255,i/=255;var s=Math.min(t,e,i),r=Math.max(t,e,i),o=r-s,a=0,h=0===r?0:o/r,u=r;return r!==s&&(r===t?a=(e-i)/o+(e<i?6:0):r===e?a=(i-t)/o+2:r===i&&(a=(t-e)/o+4),a/=6),n.hasOwnProperty("_h")?(n._h=a,n._s=h,n._v=u):(n.h=a,n.s=h,n.v=u),n;};},function(t,e){t.exports=function(t){return 16777215<t?{a:t>>>24,r:t>>16&255,g:t>>8&255,b:255&t}:{a:255,r:t>>16&255,g:t>>8&255,b:255&t};};},function(t,e,i){var n=i(38);t.exports=function(t){return new n(t.r,t.g,t.b,t.a);};},function(t,e,i){var a=i(38);t.exports=function(t){var e,i,n,s,r=new a(),o=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t.toLowerCase());return o&&(e=parseInt(o[1],10),i=parseInt(o[2],10),n=parseInt(o[3],10),s=void 0!==o[4]?parseFloat(o[4]):1,r.setTo(e,i,n,255*s)),r;};},function(t,e,i){t.exports={Fade:i(761),Flash:i(762),Pan:i(763),Shake:i(796),RotateTo:i(797),Zoom:i(798)};},function(t,e,i){t.exports={In:i(764),Out:i(765),InOut:i(766)};},function(t,e,i){t.exports={In:i(767),Out:i(768),InOut:i(769)};},function(t,e,i){t.exports={In:i(770),Out:i(771),InOut:i(772)};},function(t,e,i){t.exports={In:i(773),Out:i(774),InOut:i(775)};},function(t,e,i){t.exports={In:i(776),Out:i(777),InOut:i(778)};},function(t,e,i){t.exports={In:i(779),Out:i(780),InOut:i(781)};},function(t,e,i){t.exports=i(782);},function(t,e,i){t.exports={In:i(783),Out:i(784),InOut:i(785)};},function(t,e,i){t.exports={In:i(786),Out:i(787),InOut:i(788)};},function(t,e,i){t.exports={In:i(789),Out:i(790),InOut:i(791)};},function(t,e,i){t.exports={In:i(792),Out:i(793),InOut:i(794)};},function(t,e,i){t.exports=i(795);},function(t,e,i){var n=i(0),h=i(33),u=i(347),l=i(2),c=i(6),d=i(7),f=i(193),p=i(1),g=i(197),v=i(187),s=new n({initialize:function(t){void 0===t&&(t={});this.width=c(t,"width",1024),this.height=c(t,"height",768),this.zoom=c(t,"zoom",1),this.parent=c(t,"parent",void 0),this.scaleMode=c(t,"scaleMode",0),this.expandParent=c(t,"expandParent",!0),this.autoRound=c(t,"autoRound",!1),this.autoCenter=c(t,"autoCenter",0),this.resizeInterval=c(t,"resizeInterval",500),this.fullscreenTarget=c(t,"fullscreenTarget",null),this.minWidth=c(t,"minWidth",0),this.maxWidth=c(t,"maxWidth",0),this.minHeight=c(t,"minHeight",0),this.maxHeight=c(t,"maxHeight",0);var e=c(t,"scale",null);e&&(this.width=c(e,"width",this.width),this.height=c(e,"height",this.height),this.zoom=c(e,"zoom",this.zoom),this.parent=c(e,"parent",this.parent),this.scaleMode=c(e,"mode",this.scaleMode),this.expandParent=c(e,"expandParent",this.expandParent),this.autoRound=c(e,"autoRound",this.autoRound),this.autoCenter=c(e,"autoCenter",this.autoCenter),this.resizeInterval=c(e,"resizeInterval",this.resizeInterval),this.fullscreenTarget=c(e,"fullscreenTarget",this.fullscreenTarget),this.minWidth=c(e,"min.width",this.minWidth),this.maxWidth=c(e,"max.width",this.maxWidth),this.minHeight=c(e,"min.height",this.minHeight),this.maxHeight=c(e,"max.height",this.maxHeight)),this.renderType=c(t,"type",h.AUTO),this.canvas=c(t,"canvas",null),this.context=c(t,"context",null),this.canvasStyle=c(t,"canvasStyle",null),this.customEnvironment=c(t,"customEnvironment",!1),this.sceneConfig=c(t,"scene",null),this.seed=c(t,"seed",[(Date.now()*Math.random()).toString()]),f.RND=new f.RandomDataGenerator(this.seed),this.gameTitle=c(t,"title",""),this.gameURL=c(t,"url","https://phaser.io"),this.gameVersion=c(t,"version",""),this.autoFocus=c(t,"autoFocus",!0),this.domCreateContainer=c(t,"dom.createContainer",!1),this.domBehindCanvas=c(t,"dom.behindCanvas",!1),this.domPointerEvents=c(t,"dom.pointerEvents","none"),this.inputKeyboard=c(t,"input.keyboard",!0),this.inputKeyboardEventTarget=c(t,"input.keyboard.target",window),this.inputKeyboardCapture=c(t,"input.keyboard.capture",[]),this.inputMouse=c(t,"input.mouse",!0),this.inputMouseEventTarget=c(t,"input.mouse.target",null),this.inputMousePreventDefaultDown=c(t,"input.mouse.preventDefaultDown",!0),this.inputMousePreventDefaultUp=c(t,"input.mouse.preventDefaultUp",!0),this.inputMousePreventDefaultMove=c(t,"input.mouse.preventDefaultMove",!0),this.inputMousePreventDefaultWheel=c(t,"input.mouse.preventDefaultWheel",!0),this.inputTouch=c(t,"input.touch",u.input.touch),this.inputTouchEventTarget=c(t,"input.touch.target",null),this.inputTouchCapture=c(t,"input.touch.capture",!0),this.inputActivePointers=c(t,"input.activePointers",1),this.inputSmoothFactor=c(t,"input.smoothFactor",0),this.inputWindowEvents=c(t,"input.windowEvents",!0),this.inputGamepad=c(t,"input.gamepad",!1),this.inputGamepadEventTarget=c(t,"input.gamepad.target",window),this.disableContextMenu=c(t,"disableContextMenu",!1),this.audio=c(t,"audio",{}),this.hideBanner=!1===c(t,"banner",null),this.hidePhaser=c(t,"banner.hidePhaser",!1),this.bannerTextColor=c(t,"banner.text","#ffffff"),this.bannerBackgroundColor=c(t,"banner.background",["#ff0000","#ffff00","#00ff00","#00ffff","#000000"]),""===this.gameTitle&&this.hidePhaser&&(this.hideBanner=!0),this.fps=c(t,"fps",null);var i=c(t,"render",t);this.pipeline=c(i,"pipeline",null),this.antialias=c(i,"antialias",!0),this.antialiasGL=c(i,"antialiasGL",!0),this.mipmapFilter=c(i,"mipmapFilter","LINEAR"),this.desynchronized=c(i,"desynchronized",!1),this.roundPixels=c(i,"roundPixels",!1),this.pixelArt=c(i,"pixelArt",1!==this.zoom),this.pixelArt&&(this.antialias=!1,this.antialiasGL=!1,this.roundPixels=!0),this.transparent=c(i,"transparent",!1),this.clearBeforeRender=c(i,"clearBeforeRender",!0),this.preserveDrawingBuffer=c(i,"preserveDrawingBuffer",!1),this.premultipliedAlpha=c(i,"premultipliedAlpha",!0),this.failIfMajorPerformanceCaveat=c(i,"failIfMajorPerformanceCaveat",!1),this.powerPreference=c(i,"powerPreference","default"),this.batchSize=c(i,"batchSize",4096),this.maxTextures=c(i,"maxTextures",-1),this.maxLights=c(i,"maxLights",10);var n=c(t,"backgroundColor",0);this.backgroundColor=v(n),this.transparent&&(this.backgroundColor=v(0),this.backgroundColor.alpha=0),this.preBoot=c(t,"callbacks.preBoot",p),this.postBoot=c(t,"callbacks.postBoot",p),this.physics=c(t,"physics",{}),this.defaultPhysicsSystem=c(this.physics,"default",!1),this.loaderBaseURL=c(t,"loader.baseURL",""),this.loaderPath=c(t,"loader.path","");var s=u.os.android?6:32;this.loaderMaxParallelDownloads=c(t,"loader.maxParallelDownloads",s),this.loaderCrossOrigin=c(t,"loader.crossOrigin",void 0),this.loaderResponseType=c(t,"loader.responseType",""),this.loaderAsync=c(t,"loader.async",!0),this.loaderUser=c(t,"loader.user",""),this.loaderPassword=c(t,"loader.password",""),this.loaderTimeout=c(t,"loader.timeout",0),this.loaderWithCredentials=c(t,"loader.withCredentials",!1),this.installGlobalPlugins=[],this.installScenePlugins=[];var r=c(t,"plugins",null),o=g.DefaultScene;r&&(Array.isArray(r)?this.defaultPlugins=r:d(r)&&(this.installGlobalPlugins=l(r,"global",[]),this.installScenePlugins=l(r,"scene",[]),Array.isArray(r.default)?o=r.default:Array.isArray(r.defaultMerge)&&(o=o.concat(r.defaultMerge)))),this.defaultPlugins=o;var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAg";this.defaultImage=c(t,"images.default",a+"AQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg=="),this.missingImage=c(t,"images.missing",a+"CAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg=="),this.whiteImage=c(t,"images.white","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABdJREFUeNpi/P//PwMMMDEgAdwcgAADAJZuAwXJYZOzAAAAAElFTkSuQmCC"),window&&(window.FORCE_WEBGL?this.renderType=h.WEBGL:window.FORCE_CANVAS&&(this.renderType=h.CANVAS));}});t.exports=s;},function(t,e,i){t.exports={os:i(105),browser:i(136),features:i(191),input:i(808),audio:i(809),video:i(810),fullscreen:i(811),canvasFeatures:i(348)};},function(t,e,i){var n,s,r,o=i(31),a={supportInverseAlpha:!1,supportNewBlendModes:!1};t.exports=("function"!=typeof importScripts&&void 0!==document&&(a.supportNewBlendModes=(n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",s="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",(r=new Image()).onload=function(){var i=new Image();i.onload=function(){var t=o.create(i,6,1).getContext("2d");if(t.globalCompositeOperation="multiply",t.drawImage(r,0,0),t.drawImage(i,2,0),!t.getImageData(2,0,1,1))return!1;var e=t.getImageData(2,0,1,1).data;o.remove(i),a.supportNewBlendModes=255===e[0]&&0===e[1]&&0===e[2];},i.src=n+"/wCKxvRF"+s;},r.src=n+"AP804Oa6"+s,!1),a.supportInverseAlpha=function(){var t=o.create(this,2,1).getContext("2d");t.fillStyle="rgba(10, 20, 30, 0.5)",t.fillRect(0,0,1,1);var e=t.getImageData(0,0,1,1);if(null===e)return!1;t.putImageData(e,1,0);var i=t.getImageData(1,0,1,1);return i.data[0]===e.data[0]&&i.data[1]===e.data[1]&&i.data[2]===e.data[2]&&i.data[3]===e.data[3];}()),a);},function(t,e){t.exports=function(t,e,i,n){return Math.atan2(n-e,i-t);};},function(t,e){t.exports=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x);};},function(t,e){t.exports=function(t){return 0<=(t%=2*Math.PI)?t:t+2*Math.PI;};},function(t,e){t.exports=function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n);};},function(t,e){t.exports=function(t,e,i,n){var s=t-i,r=e-n;return s*s+r*r;};},function(t,e){t.exports=function(t,e,i){return void 0===i&&(i=1e-4),e-i<t;};},function(t,e){t.exports=function(t,e,i){return void 0===i&&(i=1e-4),t<e+i;};},function(t,e,i){var n=i(357);t.exports=function(t,e){return n(t)/n(e)/n(t-e);};},function(t,e){t.exports=function(t){if(0===t)return 1;for(var e=t;--t;)e*=t;return e;};},function(t,e){t.exports=function(t,e,i,n,s){return(u=1-t)*u*u*e+3*(h=1-(a=t))*h*a*i+3*(1-(o=t))*o*o*n+(r=t)*r*r*s;var r,o,a,h,u;};},function(t,e){t.exports=function(t,e,i,n){return(o=1-t)*o*e+2*(1-(r=t))*r*i+(s=t)*s*n;var s,r,o;};},function(t,e,i){var n=i(184);t.exports=function(t,e,i){return e+(i-e)*n(t,0,1);};},function(t,e){t.exports=function(t){var e=Math.log(t)/.6931471805599453;return 1<<Math.ceil(e);};},function(t,e){t.exports=function(t,e){var i=t.x,n=t.y;return t.x=i*Math.cos(e)-n*Math.sin(e),t.y=i*Math.sin(e)+n*Math.cos(e),t;};},function(t,e){t.exports=function(t){return 0<t?Math.ceil(t):Math.floor(t);};},function(t,e,i){var n=new(i(0))({initialize:function(t){this.val=new Float32Array(9),t?this.copy(t):this.identity();},clone:function(){return new n(this);},set:function(t){return this.copy(t);},copy:function(t){var e=this.val,i=t.val;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this;},fromMat4:function(t){var e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this;},fromArray:function(t){var e=this.val;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this;},identity:function(){var t=this.val;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this;},transpose:function(){var t=this.val,e=t[1],i=t[2],n=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=n,this;},invert:function(){var t=this.val,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8],l=u*r-o*h,c=-u*s+o*a,d=h*s-r*a,f=e*l+i*c+n*d;return f?(f=1/f,t[0]=l*f,t[1]=(-u*i+n*h)*f,t[2]=(o*i-n*r)*f,t[3]=c*f,t[4]=(u*e-n*a)*f,t[5]=(-o*e+n*s)*f,t[6]=d*f,t[7]=(-h*e+i*a)*f,t[8]=(r*e-i*s)*f,this):null;},adjoint:function(){var t=this.val,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8];return t[0]=r*u-o*h,t[1]=n*h-i*u,t[2]=i*o-n*r,t[3]=o*a-s*u,t[4]=e*u-n*a,t[5]=n*s-e*o,t[6]=s*h-r*a,t[7]=i*a-e*h,t[8]=e*r-i*s,this;},determinant:function(){var t=this.val,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],u=t[8];return e*(u*r-o*h)+i*(-u*s+o*a)+n*(h*s-r*a);},multiply:function(t){var e=this.val,i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=e[6],u=e[7],l=e[8],c=t.val,d=c[0],f=c[1],p=c[2],g=c[3],v=c[4],m=c[5],y=c[6],x=c[7],T=c[8];return e[0]=d*i+f*r+p*h,e[1]=d*n+f*o+p*u,e[2]=d*s+f*a+p*l,e[3]=g*i+v*r+m*h,e[4]=g*n+v*o+m*u,e[5]=g*s+v*a+m*l,e[6]=y*i+x*r+T*h,e[7]=y*n+x*o+T*u,e[8]=y*s+x*a+T*l,this;},translate:function(t){var e=this.val,i=t.x,n=t.y;return e[6]=i*e[0]+n*e[3]+e[6],e[7]=i*e[1]+n*e[4]+e[7],e[8]=i*e[2]+n*e[5]+e[8],this;},rotate:function(t){var e=this.val,i=e[0],n=e[1],s=e[2],r=e[3],o=e[4],a=e[5],h=Math.sin(t),u=Math.cos(t);return e[0]=u*i+h*r,e[1]=u*n+h*o,e[2]=u*s+h*a,e[3]=u*r-h*i,e[4]=u*o-h*n,e[5]=u*a-h*s,this;},scale:function(t){var e=this.val,i=t.x,n=t.y;return e[0]=i*e[0],e[1]=i*e[1],e[2]=i*e[2],e[3]=n*e[3],e[4]=n*e[4],e[5]=n*e[5],this;},fromQuat:function(t){var e=t.x,i=t.y,n=t.z,s=t.w,r=e+e,o=i+i,a=n+n,h=e*r,u=e*o,l=e*a,c=i*o,d=i*a,f=n*a,p=s*r,g=s*o,v=s*a,m=this.val;return m[0]=1-(c+f),m[3]=u+v,m[6]=l-g,m[1]=u-v,m[4]=1-(h+f),m[7]=d+p,m[2]=l+g,m[5]=d-p,m[8]=1-(h+c),this;},normalFromMat4:function(t){var e=t.val,i=this.val,n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],u=e[6],l=e[7],c=e[8],d=e[9],f=e[10],p=e[11],g=e[12],v=e[13],m=e[14],y=e[15],x=n*h-s*a,T=n*u-r*a,w=n*l-o*a,E=s*u-r*h,b=s*l-o*h,S=r*l-o*u,A=c*v-d*g,_=c*m-f*g,C=c*y-p*g,R=d*m-f*v,M=d*y-p*v,P=f*y-p*m,O=x*P-T*M+w*R+E*C-b*_+S*A;return O?(O=1/O,i[0]=(h*P-u*M+l*R)*O,i[1]=(u*C-a*P-l*_)*O,i[2]=(a*M-h*C+l*A)*O,i[3]=(r*M-s*P-o*R)*O,i[4]=(n*P-r*C+o*_)*O,i[5]=(s*C-n*M-o*A)*O,i[6]=(v*S-m*b+y*E)*O,i[7]=(m*w-g*S-y*T)*O,i[8]=(g*b-v*w+y*x)*O,this):null;}});t.exports=n;},function(t,e,i){var n=i(0),s=i(364),r=i(1),o=i(39),a=new Int8Array([1,2,0]),h=new Float32Array([0,0,0]),u=new o(1,0,0),l=new o(0,1,0),c=new o(),d=new s(),f=new n({initialize:function(t,e,i,n){this.onChangeCallback=r,this.set(t,e,i,n);},x:{get:function(){return this._x;},set:function(t){this._x=t,this.onChangeCallback(this);}},y:{get:function(){return this._y;},set:function(t){this._y=t,this.onChangeCallback(this);}},z:{get:function(){return this._z;},set:function(t){this._z=t,this.onChangeCallback(this);}},w:{get:function(){return this._w;},set:function(t){this._w=t,this.onChangeCallback(this);}},copy:function(t){return this.set(t);},set:function(t,e,i,n,s){return void 0===s&&(s=!0),"object"==typeof t?(this._x=t.x||0,this._y=t.y||0,this._z=t.z||0,this._w=t.w||0):(this._x=t||0,this._y=e||0,this._z=i||0,this._w=n||0),s&&this.onChangeCallback(this),this;},add:function(t){return this._x+=t.x,this._y+=t.y,this._z+=t.z,this._w+=t.w,this.onChangeCallback(this),this;},subtract:function(t){return this._x-=t.x,this._y-=t.y,this._z-=t.z,this._w-=t.w,this.onChangeCallback(this),this;},scale:function(t){return this._x*=t,this._y*=t,this._z*=t,this._w*=t,this.onChangeCallback(this),this;},length:function(){var t=this.x,e=this.y,i=this.z,n=this.w;return Math.sqrt(t*t+e*e+i*i+n*n);},lengthSq:function(){var t=this.x,e=this.y,i=this.z,n=this.w;return t*t+e*e+i*i+n*n;},normalize:function(){var t=this.x,e=this.y,i=this.z,n=this.w,s=t*t+e*e+i*i+n*n;return 0<s&&(s=1/Math.sqrt(s),this._x=t*s,this._y=e*s,this._z=i*s,this._w=n*s),this.onChangeCallback(this),this;},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;},lerp:function(t,e){void 0===e&&(e=0);var i=this.x,n=this.y,s=this.z,r=this.w;return this.set(i+e*(t.x-i),n+e*(t.y-n),s+e*(t.z-s),r+e*(t.w-r));},rotationTo:function(t,e){var i=t.x*e.x+t.y*e.y+t.z*e.z;return i<-.999999?(c.copy(u).cross(t).length()<1e-6&&c.copy(l).cross(t),c.normalize(),this.setAxisAngle(c,Math.PI)):.999999<i?this.set(0,0,0,1):(c.copy(t).cross(e),this._x=c.x,this._y=c.y,this._z=c.z,this._w=1+i,this.normalize());},setAxes:function(t,e,i){var n=d.val;return n[0]=e.x,n[3]=e.y,n[6]=e.z,n[1]=i.x,n[4]=i.y,n[7]=i.z,n[2]=-t.x,n[5]=-t.y,n[8]=-t.z,this.fromMat3(d).normalize();},identity:function(){return this.set(0,0,0,1);},setAxisAngle:function(t,e){e*=.5;var i=Math.sin(e);return this.set(i*t.x,i*t.y,i*t.z,Math.cos(e));},multiply:function(t){var e=this.x,i=this.y,n=this.z,s=this.w,r=t.x,o=t.y,a=t.z,h=t.w;return this.set(e*h+s*r+i*a-n*o,i*h+s*o+n*r-e*a,n*h+s*a+e*o-i*r,s*h-e*r-i*o-n*a);},slerp:function(t,e){var i=this.x,n=this.y,s=this.z,r=this.w,o=t.x,a=t.y,h=t.z,u=t.w,l=i*o+n*a+s*h+r*u;l<0&&(l=-l,o=-o,a=-a,h=-h,u=-u);var c,d,f=1-e,p=e;return 1e-6<1-l&&(c=Math.acos(l),d=Math.sin(c),f=Math.sin((1-e)*c)/d,p=Math.sin(e*c)/d),this.set(f*i+p*o,f*n+p*a,f*s+p*h,f*r+p*u);},invert:function(){var t=this.x,e=this.y,i=this.z,n=this.w,s=t*t+e*e+i*i+n*n,r=s?1/s:0;return this.set(-t*r,-e*r,-i*r,n*r);},conjugate:function(){return this._x=-this.x,this._y=-this.y,this._z=-this.z,this.onChangeCallback(this),this;},rotateX:function(t){t*=.5;var e=this.x,i=this.y,n=this.z,s=this.w,r=Math.sin(t),o=Math.cos(t);return this.set(e*o+s*r,i*o+n*r,n*o-i*r,s*o-e*r);},rotateY:function(t){t*=.5;var e=this.x,i=this.y,n=this.z,s=this.w,r=Math.sin(t),o=Math.cos(t);return this.set(e*o-n*r,i*o+s*r,n*o+e*r,s*o-i*r);},rotateZ:function(t){t*=.5;var e=this.x,i=this.y,n=this.z,s=this.w,r=Math.sin(t),o=Math.cos(t);return this.set(e*o+i*r,i*o-e*r,n*o+s*r,s*o-n*r);},calculateW:function(){var t=this.x,e=this.y,i=this.z;return this.w=-Math.sqrt(1-t*t-e*e-i*i),this;},setFromEuler:function(t,e){var i=t.x/2,n=t.y/2,s=t.z/2,r=Math.cos(i),o=Math.cos(n),a=Math.cos(s),h=Math.sin(i),u=Math.sin(n),l=Math.sin(s);switch(t.order){case"XYZ":this.set(h*o*a+r*u*l,r*u*a-h*o*l,r*o*l+h*u*a,r*o*a-h*u*l,e);break;case"YXZ":this.set(h*o*a+r*u*l,r*u*a-h*o*l,r*o*l-h*u*a,r*o*a+h*u*l,e);break;case"ZXY":this.set(h*o*a-r*u*l,r*u*a+h*o*l,r*o*l+h*u*a,r*o*a-h*u*l,e);break;case"ZYX":this.set(h*o*a-r*u*l,r*u*a+h*o*l,r*o*l-h*u*a,r*o*a+h*u*l,e);break;case"YZX":this.set(h*o*a+r*u*l,r*u*a+h*o*l,r*o*l-h*u*a,r*o*a-h*u*l,e);break;case"XZY":this.set(h*o*a-r*u*l,r*u*a-h*o*l,r*o*l+h*u*a,r*o*a+h*u*l,e);}return this;},setFromRotationMatrix:function(t){var e,i=t.val,n=i[0],s=i[4],r=i[8],o=i[1],a=i[5],h=i[9],u=i[2],l=i[6],c=i[10],d=n+a+c;return 0<d?(e=.5/Math.sqrt(d+1),this.set((l-h)*e,(r-u)*e,(o-s)*e,.25/e)):a<n&&c<n?(e=2*Math.sqrt(1+n-a-c),this.set(.25*e,(s+o)/e,(r+u)/e,(l-h)/e)):c<a?(e=2*Math.sqrt(1+a-n-c),this.set((s+o)/e,.25*e,(h+l)/e,(r-u)/e)):(e=2*Math.sqrt(1+c-n-a),this.set((r+u)/e,(h+l)/e,.25*e,(o-s)/e)),this;},fromMat3:function(t){var e,i,n,s,r=t.val,o=r[0]+r[4]+r[8];return 0<o?(s=Math.sqrt(o+1),this.w=.5*s,s=.5/s,this._x=(r[7]-r[5])*s,this._y=(r[2]-r[6])*s,this._z=(r[3]-r[1])*s):(e=0,r[4]>r[0]&&(e=1),r[8]>r[3*e+e]&&(e=2),i=a[e],n=a[i],s=Math.sqrt(r[3*e+e]-r[3*i+i]-r[3*n+n]+1),h[e]=.5*s,s=.5/s,h[i]=(r[3*i+e]+r[3*e+i])*s,h[n]=(r[3*n+e]+r[3*e+n])*s,this._x=h[0],this._y=h[1],this._z=h[2],this._w=(r[3*n+i]-r[3*i+n])*s),this.onChangeCallback(this),this;}});t.exports=f;},function(t,e,a){var h=a(367),u=a(31),l=a(33),c=a(191);t.exports=function(t){var e=t.config;if((e.customEnvironment||e.canvas)&&e.renderType===l.AUTO)throw new Error("Must set explicit renderType in custom environment");if(!e.customEnvironment&&!e.canvas&&e.renderType!==l.HEADLESS)if(e.renderType===l.CANVAS||e.renderType!==l.CANVAS&&!c.webGL){if(!c.canvas)throw new Error("Cannot create Canvas or WebGL context, aborting.");e.renderType=l.CANVAS;}else e.renderType=l.WEBGL;e.antialias||u.disableSmoothing();var i,n,s=t.scale.baseSize,r=s.width,o=s.height;e.canvas?(t.canvas=e.canvas,t.canvas.width=r,t.canvas.height=o):t.canvas=u.create(t,r,o,e.renderType),e.canvasStyle&&(t.canvas.style=e.canvasStyle),e.antialias||h.setCrisp(t.canvas),e.renderType!==l.HEADLESS&&(i=a(368),n=a(371),e.renderType===l.WEBGL?t.renderer=new n(t):(t.renderer=new i(t),t.context=t.renderer.gameContext));};},function(t,e){t.exports={setCrisp:function(e){return["optimizeSpeed","-moz-crisp-edges","-o-crisp-edges","-webkit-optimize-contrast","optimize-contrast","crisp-edges","pixelated"].forEach(function(t){e.style["image-rendering"]=t;}),e.style.msInterpolationMode="nearest-neighbor",e;},setBicubic:function(t){return t.style["image-rendering"]="auto",t.style.msInterpolationMode="bicubic",t;}};},function(t,e,i){var d=i(37),l=i(369),n=i(0),s=i(33),r=i(9),f=i(91),o=i(370),a=i(104),h=i(106),u=i(25),c=new n({Extends:r,initialize:function(t){r.call(this);var e=t.config;this.config={clearBeforeRender:e.clearBeforeRender,backgroundColor:e.backgroundColor,antialias:e.antialias,roundPixels:e.roundPixels},this.game=t,this.type=s.CANVAS,this.drawCount=0,this.width=0,this.height=0,this.gameCanvas=t.canvas;var i={alpha:t.config.transparent,desynchronized:t.config.desynchronized};this.gameContext=e.context?e.context:this.gameCanvas.getContext("2d",i),this.currentContext=this.gameContext,this.antialias=t.config.antialias,this.blendModes=o(),this.snapshotState={x:0,y:0,width:1,height:1,getPixel:!1,callback:null,type:"image/png",encoder:.92},this._tempMatrix1=new u(),this._tempMatrix2=new u(),this._tempMatrix3=new u(),this.isBooted=!1,this.init();},init:function(){this.game.textures.once(h.READY,this.boot,this);},boot:function(){var t=this.game,e=t.scale.baseSize;this.width=e.width,this.height=e.height,this.isBooted=!0,t.scale.on(a.RESIZE,this.onResize,this),this.resize(e.width,e.height);},onResize:function(t,e){e.width===this.width&&e.height===this.height||this.resize(e.width,e.height);},resize:function(t,e){this.width=t,this.height=e,this.emit(f.RESIZE,t,e);},resetTransform:function(){this.currentContext.setTransform(1,0,0,1,0,0);},setBlendMode:function(t){return this.currentContext.globalCompositeOperation=t,this;},setContext:function(t){return this.currentContext=t||this.gameContext,this;},setAlpha:function(t){return this.currentContext.globalAlpha=t,this;},preRender:function(){var t=this.gameContext,e=this.config,i=this.width,n=this.height;t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),e.clearBeforeRender&&(t.clearRect(0,0,i,n),e.transparent||(t.fillStyle=e.backgroundColor.rgba,t.fillRect(0,0,i,n))),t.save(),this.drawCount=0,this.emit(f.PRE_RENDER);},render:function(t,e,i){var n=e.length;this.emit(f.RENDER,t,i);var s=i.x,r=i.y,o=i.width,a=i.height,h=i.renderToTexture?i.context:t.sys.context;h.save(),this.game.scene.customViewports&&(h.beginPath(),h.rect(s,r,o,a),h.clip()),this.currentContext=h;var u=i.mask;u&&u.preRenderCanvas(this,null,i._maskCamera),i.transparent||(h.fillStyle=i.backgroundColor.rgba,h.fillRect(s,r,o,a)),h.globalAlpha=i.alpha,h.globalCompositeOperation="source-over",this.drawCount+=n,i.renderToTexture&&i.emit(d.PRE_RENDER,i),i.matrix.copyToContext(h);for(var l=0;l<n;l++){var c=e[l];c.mask&&c.mask.preRenderCanvas(this,c,i),c.renderCanvas(this,c,i),c.mask&&c.mask.postRenderCanvas(this,c,i);}h.setTransform(1,0,0,1,0,0),h.globalCompositeOperation="source-over",h.globalAlpha=1,i.flashEffect.postRenderCanvas(h),i.fadeEffect.postRenderCanvas(h),i.dirty=!1,u&&u.postRenderCanvas(this),h.restore(),i.renderToTexture&&(i.emit(d.POST_RENDER,i),i.renderToGame&&t.sys.context.drawImage(i.canvas,s,r));},postRender:function(){this.gameContext.restore(),this.emit(f.POST_RENDER);var t=this.snapshotState;t.callback&&(l(this.gameCanvas,t),t.callback=null);},snapshotCanvas:function(t,e,i,n,s,r,o,a,h){void 0===i&&(i=!1),this.snapshotArea(n,s,r,o,e,a,h);var u=this.snapshotState;return u.getPixel=i,l(this.canvas,u),u.callback=null,this;},snapshot:function(t,e,i){return this.snapshotArea(0,0,this.gameCanvas.width,this.gameCanvas.height,t,e,i);},snapshotArea:function(t,e,i,n,s,r,o){var a=this.snapshotState;return a.callback=s,a.type=r,a.encoder=o,a.getPixel=!1,a.x=t,a.y=e,a.width=Math.min(i,this.gameCanvas.width),a.height=Math.min(n,this.gameCanvas.height),this;},snapshotPixel:function(t,e,i){return this.snapshotArea(t,e,1,1,i),this.snapshotState.getPixel=!0,this;},batchSprite:function(t,e,i,n){var s,r,o,a,h,u,l,c,d,f,p,g,v,m,y,x,T,w=i.alpha*t.alpha;0!=w&&(s=this.currentContext,r=this._tempMatrix1,o=this._tempMatrix2,h=(a=e.canvasData).x,u=a.y,l=e.cutWidth,c=e.cutHeight,d=e.customPivot,f=e.source.resolution,p=t.displayOriginX,g=t.displayOriginY,v=-p+e.x,m=-g+e.y,t.isCropped&&((y=t._crop).flipX===t.flipX&&y.flipY===t.flipY||e.updateCropUVs(y,t.flipX,t.flipY),l=y.cw,c=y.ch,h=y.cx,u=y.cy,v=-p+y.x,m=-g+y.y,t.flipX&&(0<=v?v=-(v+l):v<0&&(v=Math.abs(v)-l)),t.flipY&&(0<=m?m=-(m+c):m<0&&(m=Math.abs(m)-c))),T=x=1,t.flipX&&(d||(v+=-e.realWidth+2*p),x=-1),t.flipY&&(d||(m+=-e.realHeight+2*g),T=-1),o.applyITRS(t.x,t.y,t.rotation,t.scaleX*x,t.scaleY*T),r.copyFrom(i.matrix),n?(r.multiplyWithOffset(n,-i.scrollX*t.scrollFactorX,-i.scrollY*t.scrollFactorY),o.e=t.x,o.f=t.y):(o.e-=i.scrollX*t.scrollFactorX,o.f-=i.scrollY*t.scrollFactorY),r.multiply(o),s.save(),r.setToContext(s),s.globalCompositeOperation=this.blendModes[t.blendMode],s.globalAlpha=w,s.imageSmoothingEnabled=!(!this.antialias||e.source.scaleMode),t.mask&&t.mask.preRenderCanvas(this,t,i),s.drawImage(e.source.image,h,u,l,c,v,m,l/f,c/f),t.mask&&t.mask.postRenderCanvas(this,t,i),s.restore());},destroy:function(){this.removeAllListeners(),this.game=null,this.gameCanvas=null,this.gameContext=null;}});t.exports=c;},function(t,e,i){var f=i(31),p=i(38),g=i(2);t.exports=function(t,e){var i,n,s,r,o=g(e,"callback"),a=g(e,"type","image/png"),h=g(e,"encoder",.92),u=Math.abs(Math.round(g(e,"x",0))),l=Math.abs(Math.round(g(e,"y",0))),c=g(e,"width",t.width),d=g(e,"height",t.height);g(e,"getPixel",!1)?(i=t.getContext("2d").getImageData(u,l,1,1).data,o.call(null,new p(i[0],i[1],i[2],i[3]/255))):0!==u||0!==l||c!==t.width||d!==t.height?((n=f.createWebGL(this,c,d)).getContext("2d").drawImage(t,u,l,c,d,0,0,c,d),(s=new Image()).onerror=function(){o.call(null),f.remove(n);},s.onload=function(){o.call(null,s),f.remove(n);},s.src=n.toDataURL(a,h)):((r=new Image()).onerror=function(){o.call(null);},r.onload=function(){o.call(null,r);},r.src=t.toDataURL(a,h));};},function(t,e,i){var n=i(35),s=i(348);t.exports=function(){var t=[],e=s.supportNewBlendModes,i="source-over";return t[n.NORMAL]=i,t[n.ADD]="lighter",t[n.MULTIPLY]=e?"multiply":i,t[n.SCREEN]=e?"screen":i,t[n.OVERLAY]=e?"overlay":i,t[n.DARKEN]=e?"darken":i,t[n.LIGHTEN]=e?"lighten":i,t[n.COLOR_DODGE]=e?"color-dodge":i,t[n.COLOR_BURN]=e?"color-burn":i,t[n.HARD_LIGHT]=e?"hard-light":i,t[n.SOFT_LIGHT]=e?"soft-light":i,t[n.DIFFERENCE]=e?"difference":i,t[n.EXCLUSION]=e?"exclusion":i,t[n.HUE]=e?"hue":i,t[n.SATURATION]=e?"saturation":i,t[n.COLOR]=e?"color":i,t[n.LUMINOSITY]=e?"luminosity":i,t[n.ERASE]="destination-out",t[n.SOURCE_IN]="source-in",t[n.SOURCE_OUT]="source-out",t[n.SOURCE_ATOP]="source-atop",t[n.DESTINATION_OVER]="destination-over",t[n.DESTINATION_IN]="destination-in",t[n.DESTINATION_OUT]="destination-out",t[n.DESTINATION_ATOP]="destination-atop",t[n.LIGHTER]="lighter",t[n.COPY]="copy",t[n.XOR]="xor",t;};},function(t,e,i){var n=i(93),o=i(37),s=i(0),v=i(33),r=i(9),u=i(91),m=i(22),g=i(138),y=i(69),a=i(1),x=i(372),h=i(141),l=i(104),T=i(106),w=i(12),f=i(383),c=new s({Extends:r,initialize:function(t){r.call(this);var e=t.config,i={alpha:e.transparent,desynchronized:e.desynchronized,depth:!1,antialias:e.antialiasGL,premultipliedAlpha:e.premultipliedAlpha,stencil:!0,failIfMajorPerformanceCaveat:e.failIfMajorPerformanceCaveat,powerPreference:e.powerPreference,preserveDrawingBuffer:e.preserveDrawingBuffer};this.config={clearBeforeRender:e.clearBeforeRender,antialias:e.antialias,backgroundColor:e.backgroundColor,contextCreation:i,roundPixels:e.roundPixels,maxTextures:e.maxTextures,maxTextureSize:e.maxTextureSize,batchSize:e.batchSize,maxLights:e.maxLights,mipmapFilter:e.mipmapFilter},this.game=t,this.type=v.WEBGL,this.pipelines=null,this.width=0,this.height=0,this.canvas=t.canvas,this.blendModes=[],this.contextLost=!1,this.snapshotState={x:0,y:0,width:1,height:1,getPixel:!1,callback:null,type:"image/png",encoder:.92,isFramebuffer:!1,bufferWidth:0,bufferHeight:0},this.currentActiveTexture=0,this.startActiveTexture=0,this.maxTextures=0,this.textureIndexes,this.tempTextures,this.textureZero,this.normalTexture,this.currentFramebuffer=null,this.fboStack=[],this.currentProgram=null,this.currentBlendMode=1/0,this.currentScissorEnabled=!1,this.currentScissor=null,this.scissorStack=[],this.contextLostHandler=a,this.contextRestoredHandler=a,this.gl=null,this.supportedExtensions=null,this.instancedArraysExtension=null,this.vaoExtension=null,this.extensions={},this.glFormats=[],this.compression={ETC1:!1,PVRTC:!1,S3TC:!1},this.drawingBufferHeight=0,this.blankTexture=null,this.whiteTexture=null,this.maskCount=0,this.maskStack=[],this.currentMask={mask:null,camera:null},this.currentCameraMask={mask:null,camera:null},this.glFuncMap=null,this.currentType="",this.newType=!1,this.nextTypeMatch=!1,this.finalType=!1,this.mipmapFilter=null,this.textureFlush=0,this.isTextureClean=!1,this.defaultScissor=[0,0,0,0],this.isBooted=!1,this.renderTarget=null,this.projectionMatrix,this.projectionWidth=0,this.projectionHeight=0,this.init(this.config);},init:function(t){var e=this.game,i=this.canvas,n=t.backgroundColor,s=e.config.context?e.config.context:i.getContext("webgl",t.contextCreation)||i.getContext("experimental-webgl",t.contextCreation);if(!s||s.isContextLost())throw this.contextLost=!0,new Error("WebGL unsupported");this.gl=s;var r=this;this.contextLostHandler=function(t){r.contextLost=!0,r.game.events.emit(m.CONTEXT_LOST,r),t.preventDefault();},this.contextRestoredHandler=function(){r.contextLost=!1,r.init(r.config),r.game.events.emit(m.CONTEXT_RESTORED,r);},i.addEventListener("webglcontextlost",this.contextLostHandler,!1),i.addEventListener("webglcontextrestored",this.contextRestoredHandler,!1),e.context=s;for(var o=0;o<=27;o++)this.blendModes.push({func:[s.ONE,s.ONE_MINUS_SRC_ALPHA],equation:s.FUNC_ADD});this.blendModes[1].func=[s.ONE,s.DST_ALPHA],this.blendModes[2].func=[s.DST_COLOR,s.ONE_MINUS_SRC_ALPHA],this.blendModes[3].func=[s.ONE,s.ONE_MINUS_SRC_COLOR],this.blendModes[17]={func:[s.ZERO,s.ONE_MINUS_SRC_ALPHA],equation:s.FUNC_REVERSE_SUBTRACT},this.glFormats[0]=s.BYTE,this.glFormats[1]=s.SHORT,this.glFormats[2]=s.UNSIGNED_BYTE,this.glFormats[3]=s.UNSIGNED_SHORT,this.glFormats[4]=s.FLOAT,this.glFuncMap={mat2:{func:s.uniformMatrix2fv,length:1,matrix:!0},mat3:{func:s.uniformMatrix3fv,length:1,matrix:!0},mat4:{func:s.uniformMatrix4fv,length:1,matrix:!0},"1f":{func:s.uniform1f,length:1},"1fv":{func:s.uniform1fv,length:1},"1i":{func:s.uniform1i,length:1},"1iv":{func:s.uniform1iv,length:1},"2f":{func:s.uniform2f,length:2},"2fv":{func:s.uniform2fv,length:1},"2i":{func:s.uniform2i,length:2},"2iv":{func:s.uniform2iv,length:1},"3f":{func:s.uniform3f,length:3},"3fv":{func:s.uniform3fv,length:1},"3i":{func:s.uniform3i,length:3},"3iv":{func:s.uniform3iv,length:1},"4f":{func:s.uniform4f,length:4},"4fv":{func:s.uniform4fv,length:1},"4i":{func:s.uniform4i,length:4},"4iv":{func:s.uniform4iv,length:1}};var a=s.getSupportedExtensions();t.maxTextures&&-1!==t.maxTextures||(t.maxTextures=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS)),t.maxTextureSize||(t.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE));var h="WEBGL_compressed_texture_",u="WEBKIT_"+h;this.compression.ETC1=s.getExtension(h+"etc1")||s.getExtension(u+"etc1"),this.compression.PVRTC=s.getExtension(h+"pvrtc")||s.getExtension(u+"pvrtc"),this.compression.S3TC=s.getExtension(h+"s3tc")||s.getExtension(u+"s3tc"),this.supportedExtensions=a;var l="ANGLE_instanced_arrays";this.instancedArraysExtension=-1<a.indexOf(l)?s.getExtension(l):null;var c="OES_vertex_array_object";this.vaoExtension=-1<a.indexOf(c)?s.getExtension(c):null,s.disable(s.DEPTH_TEST),s.disable(s.CULL_FACE),s.enable(s.BLEND),s.clearColor(n.redGL,n.greenGL,n.blueGL,n.alphaGL),this.mipmapFilter=s[t.mipmapFilter],this.maxTextures=w.checkShaderMax(s,t.maxTextures),this.textureIndexes=[];var d=this.tempTextures;if(Array.isArray(d))for(var f=0;o<this.maxTextures;f++)s.deleteTexture(d[f]);else d=new Array(this.maxTextures);for(var p=0;p<this.maxTextures;p++){var g=s.createTexture();s.activeTexture(s.TEXTURE0+p),s.bindTexture(s.TEXTURE_2D,g),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),d[p]=g,this.textureIndexes.push(p);}return this.tempTextures=d,this.currentActiveTexture=1,this.startActiveTexture++,s.activeTexture(s.TEXTURE1),this.pipelines=new x(this),this.setBlendMode(v.BlendModes.NORMAL),this.projectionMatrix=new y().identity(),e.textures.once(T.READY,this.boot,this),this;},boot:function(){var t=this.game,e=this.pipelines,i=t.scale.baseSize;this.width=i.width,this.height=i.height,this.isBooted=!0,this.renderTarget=new h(this,this.width,this.height,1,0,!0,!0),e.boot(t.config.pipeline),this.blankTexture=t.textures.getFrame("__DEFAULT"),this.whiteTexture=t.textures.getFrame("__WHITE");var n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,null),n.enable(n.SCISSOR_TEST),t.scale.on(l.RESIZE,this.onResize,this),this.resize(i.width,i.height);},onResize:function(t,e){e.width===this.width&&e.height===this.height||this.resize(e.width,e.height);},beginCapture:function(t,e){void 0===t&&(t=this.width),void 0===e&&(e=this.height),this.renderTarget.bind(!0,t,e),this.setProjectionMatrix(t,e),this.resetTextures();},endCapture:function(){return this.renderTarget.unbind(!0),this.resetProjectionMatrix(),this.renderTarget;},resize:function(t,e){var i=this.gl;return this.width=t,this.height=e,this.setProjectionMatrix(t,e),i.viewport(0,0,t,e),this.drawingBufferHeight=i.drawingBufferHeight,i.scissor(0,i.drawingBufferHeight-e,t,e),this.defaultScissor[2]=t,this.defaultScissor[3]=e,this.emit(u.RESIZE,t,e),this;},getAspectRatio:function(){return this.width/this.height;},setProjectionMatrix:function(t,e){return t===this.projectionWidth&&e===this.projectionHeight||(this.projectionWidth=t,this.projectionHeight=e,this.projectionMatrix.ortho(0,t,e,0,-1e3,1e3)),this;},resetProjectionMatrix:function(){this.projectionWidth=this.width,this.projectionHeight=this.height,this.projectionMatrix.ortho(0,this.width,this.height,0,-1e3,1e3);},hasExtension:function(t){return!!this.supportedExtensions&&this.supportedExtensions.indexOf(t);},getExtension:function(t){return this.hasExtension(t)?(t in this.extensions||(this.extensions[t]=this.gl.getExtension(t)),this.extensions[t]):null;},flush:function(){this.pipelines.flush();},pushScissor:function(t,e,i,n,s){void 0===s&&(s=this.drawingBufferHeight);var r=[t,e,i,n];return this.scissorStack.push(r),this.setScissor(t,e,i,n,s),this.currentScissor=r;},setScissor:function(t,e,i,n,s){void 0===s&&(s=this.drawingBufferHeight);var r,o,a,h,u=this.gl,l=this.currentScissor,c=0<i&&0<n;l&&c&&(r=l[0],o=l[1],a=l[2],h=l[3],c=r!==t||o!==e||a!==i||h!==n),c&&(this.flush(),u.scissor(t,s-e-n,i,n));},resetScissor:function(){var t=this.gl;t.enable(t.SCISSOR_TEST);var e,i,n,s,r=this.currentScissor;r&&(e=r[0],i=r[1],n=r[2],s=r[3],0<n&&0<s&&t.scissor(e,this.drawingBufferHeight-i-s,n,s));},popScissor:function(){var t=this.scissorStack;t.pop();var e=t[t.length-1];e&&this.setScissor(e[0],e[1],e[2],e[3]),this.currentScissor=e;},hasActiveStencilMask:function(){var t=this.currentMask.mask,e=this.currentCameraMask.mask;return t&&t.isStencil||e&&e.isStencil;},resetViewport:function(){var t=this.gl;t.viewport(0,0,this.width,this.height),this.drawingBufferHeight=t.drawingBufferHeight;},setBlendMode:function(t,e){void 0===e&&(e=!1);var i=this.gl,n=this.blendModes[t];return!!(e||t!==v.BlendModes.SKIP_CHECK&&this.currentBlendMode!==t)&&(this.flush(),i.enable(i.BLEND),i.blendEquation(n.equation),2<n.func.length?i.blendFuncSeparate(n.func[0],n.func[1],n.func[2],n.func[3]):i.blendFunc(n.func[0],n.func[1]),this.currentBlendMode=t,!0);},addBlendMode:function(t,e){return this.blendModes.push({func:t,equation:e})-1;},updateBlendMode:function(t,e,i){return this.blendModes[t]&&(this.blendModes[t].func=e,i&&(this.blendModes[t].equation=i)),this;},removeBlendMode:function(t){return 17<t&&this.blendModes[t]&&this.blendModes.splice(t,1),this;},setBlankTexture:function(){this.setTexture2D(this.blankTexture.glTexture);},setTextureSource:function(t){if(this.pipelines.forceZero())return this.setTextureZero(t.glTexture,!0),0;var e=this.gl,i=this.currentActiveTexture;return t.glIndexCounter<this.startActiveTexture&&(t.glIndexCounter=this.startActiveTexture,i<this.maxTextures?(t.glIndex=i,e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture++):(this.flush(),this.startActiveTexture++,this.textureFlush++,t.glIndexCounter=this.startActiveTexture,t.glIndex=1,e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture=2)),this.isTextureClean=!1,t.glIndex;},isNewNormalMap:function(t,e){return this.textureZero!==t||this.normalTexture!==e;},setTextureZero:function(t,e){var i;this.textureZero!==t&&(e&&this.flush(),(i=this.gl).activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,t),this.textureZero=t);},clearTextureZero:function(){this.textureZero=null;},setNormalMap:function(t){var e;this.normalTexture!==t&&((e=this.gl).activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),this.normalTexture=t,1===this.currentActiveTexture&&(this.currentActiveTexture=2));},clearNormalMap:function(){this.normalTexture=null,this.startActiveTexture++,this.currentActiveTexture=1,this.textureFlush++;},unbindTextures:function(){for(var t=this.gl,e=this.tempTextures,i=0;i<e.length;i++)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,null);this.normalTexture=null,this.textureZero=null,this.currentActiveTexture=1,this.startActiveTexture++,this.textureFlush++;},resetTextures:function(t){if(void 0===t&&(t=!1),!this.isTextureClean){this.flush();var e=this.gl,i=this.tempTextures;if(t){for(var n=0;n<i.length;n++)e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,i[n]);e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i[1]),this.isTextureClean=!0;}else e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,i[0]),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,i[1]);this.normalTexture=null,this.textureZero=null,this.currentActiveTexture=1,this.startActiveTexture++,this.textureFlush++;}},setTexture2D:function(t){if(this.pipelines.forceZero())return this.setTextureZero(t,!0),0;var e=this.gl,i=this.currentActiveTexture;return t.glIndexCounter<this.startActiveTexture&&(t.glIndexCounter=this.startActiveTexture,i<this.maxTextures?(t.glIndex=i,e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,t),this.currentActiveTexture++):(this.flush(),this.startActiveTexture++,this.textureFlush++,t.glIndexCounter=this.startActiveTexture,t.glIndex=1,e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t),this.currentActiveTexture=2)),this.isTextureClean=!1,t.glIndex;},pushFramebuffer:function(t,e,i,n){return t===this.currentFramebuffer?this:(this.fboStack.push(t),this.setFramebuffer(t,e,i,n));},setFramebuffer:function(t,e,i,n){if(void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=!0),t===this.currentFramebuffer)return this;var s=this.gl,r=this.width,o=this.height;return t&&t.renderTexture&&n?(r=t.renderTexture.width,o=t.renderTexture.height):this.flush(),s.bindFramebuffer(s.FRAMEBUFFER,t),n&&s.viewport(0,0,r,o),e&&(t?(this.drawingBufferHeight=o,this.pushScissor(0,0,r,o)):(this.drawingBufferHeight=this.height,this.popScissor())),this.currentFramebuffer=t,i&&this.resetTextures(),this;},popFramebuffer:function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!0);var n=this.fboStack;n.pop();var s=(s=n[n.length-1])||null;return this.setFramebuffer(s,t,e,i),s;},setProgram:function(t){return t!==this.currentProgram&&(this.flush(),this.gl.useProgram(t),this.currentProgram=t,!0);},resetProgram:function(){return this.gl.useProgram(this.currentProgram),this;},createTextureFromSource:function(t,e,i,n){var s=this.gl,r=s.NEAREST,o=s.NEAREST,a=s.CLAMP_TO_EDGE;e=t?t.width:e,i=t?t.height:i;var h=g(e,i);return h&&(a=s.REPEAT),n===v.ScaleModes.LINEAR&&this.config.antialias&&(r=h?this.mipmapFilter:s.LINEAR,o=s.LINEAR),t||"number"!=typeof e||"number"!=typeof i?this.createTexture2D(0,r,o,a,a,s.RGBA,t):this.createTexture2D(0,r,o,a,a,s.RGBA,null,e,i);},createTexture2D:function(t,e,i,n,s,r,o,a,h,u,l,c){u=null==u||u,void 0===l&&(l=!1),void 0===c&&(c=!1);var d=this.gl,f=d.createTexture();d.activeTexture(d.TEXTURE0);var p=d.getParameter(d.TEXTURE_BINDING_2D);return d.bindTexture(d.TEXTURE_2D,f),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,u),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),null==o?d.texImage2D(d.TEXTURE_2D,t,r,a,h,0,r,d.UNSIGNED_BYTE,null):(l||(a=o.width,h=o.height),d.texImage2D(d.TEXTURE_2D,t,r,r,d.UNSIGNED_BYTE,o)),g(a,h)&&d.generateMipmap(d.TEXTURE_2D),p&&d.bindTexture(d.TEXTURE_2D,p),f.isAlphaPremultiplied=u,f.isRenderTexture=!1,f.width=a,f.height=h,f.glIndex=0,f.glIndexCounter=-1,f;},createFramebuffer:function(t,e,i,n){var s,r,o=this.gl,a=o.createFramebuffer();if(this.setFramebuffer(a),n&&(r=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,r),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,t,e),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,r)),i.isRenderTexture=!0,i.isAlphaPremultiplied=!1,o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i,0),(s=o.checkFramebufferStatus(o.FRAMEBUFFER))===o.FRAMEBUFFER_COMPLETE)return a.renderTexture=i,this.setFramebuffer(null),this.resetTextures(),a;throw new Error("Framebuffer status: "+{36054:"Incomplete Attachment",36055:"Missing Attachment",36057:"Incomplete Dimensions",36061:"Framebuffer Unsupported"}[s]);},createProgram:function(t,e){var i=this.gl,n=i.createProgram(),s=i.createShader(i.VERTEX_SHADER),r=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(s,t),i.shaderSource(r,e),i.compileShader(s),i.compileShader(r),!i.getShaderParameter(s,i.COMPILE_STATUS))throw new Error("Vertex Shader failed:\n"+i.getShaderInfoLog(s));if(!i.getShaderParameter(r,i.COMPILE_STATUS))throw new Error("Fragment Shader failed:\n"+i.getShaderInfoLog(r));if(i.attachShader(n,s),i.attachShader(n,r),i.linkProgram(n),!i.getProgramParameter(n,i.LINK_STATUS))throw new Error("Link Program failed:\n"+i.getProgramInfoLog(n));return i.useProgram(n),n;},createVertexBuffer:function(t,e){var i=this.gl,n=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,t,e),i.bindBuffer(i.ARRAY_BUFFER,null),n;},createIndexBuffer:function(t,e){var i=this.gl,n=i.createBuffer();return i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,n),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t,e),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),n;},deleteTexture:function(t,e){return e&&this.resetTextures(!0),t&&this.gl.deleteTexture(t),this;},deleteFramebuffer:function(t){return t&&(this.gl.deleteFramebuffer(t),n(this.fboStack,t),this.currentFramebuffer===t&&(this.currentFramebuffer=null)),this;},deleteProgram:function(t){return t&&this.gl.deleteProgram(t),this;},deleteBuffer:function(t){return this.gl.deleteBuffer(t),this;},preRenderCamera:function(t){var e=t.x,i=t.y,n=t.width,s=t.height,r=t.backgroundColor;t.emit(o.PRE_RENDER,t),this.pipelines.preBatchCamera(t),this.pushScissor(e,i,n,s),t.mask&&(this.currentCameraMask.mask=t.mask,this.currentCameraMask.camera=t._maskCamera,t.mask.preRenderWebGL(this,t,t._maskCamera)),0<r.alphaGL&&this.pipelines.setMulti().drawFillRect(e,i,n,s,w.getTintFromFloats(r.blueGL,r.greenGL,r.redGL,1),r.alphaGL);},getCurrentStencilMask:function(){var t=null,e=this.maskStack,i=this.currentCameraMask;return 0<e.length?t=e[e.length-1]:i.mask&&i.mask.isStencil&&(t=i),t;},postRenderCamera:function(t){var e,i=t.flashEffect,n=t.fadeEffect;(i.isRunning||n.isRunning||n.isComplete)&&(e=this.pipelines.setMulti(),i.postRenderWebGL(e,w.getTintFromFloats),n.postRenderWebGL(e,w.getTintFromFloats)),t.dirty=!1,this.popScissor(),t.mask&&(this.currentCameraMask.mask=null,t.mask.postRenderWebGL(this,t._maskCamera)),this.pipelines.postBatchCamera(t),t.emit(o.POST_RENDER,t);},preRender:function(){var t,e;this.contextLost||((t=this.gl).bindFramebuffer(t.FRAMEBUFFER,null),this.config.clearBeforeRender&&(e=this.config.backgroundColor,t.clearColor(e.redGL,e.greenGL,e.blueGL,e.alphaGL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)),t.enable(t.SCISSOR_TEST),this.currentScissor=this.defaultScissor,this.scissorStack.length=0,this.scissorStack.push(this.currentScissor),this.game.scene.customViewports&&t.scissor(0,this.drawingBufferHeight-this.height,this.width,this.height),this.currentMask.mask=null,this.currentCameraMask.mask=null,this.maskStack.length=0,this.textureFlush=0,this.emit(u.PRE_RENDER));},render:function(t,e,i){if(!this.contextLost){var n=e.length;if(this.emit(u.RENDER,t,i),this.preRenderCamera(i),0===n)return this.setBlendMode(v.BlendModes.NORMAL),void this.postRenderCamera(i);this.currentType="";for(var s=this.currentMask,r=0;r<n;r++){this.finalType=r===n-1;var o=e[r],a=o.mask;(s=this.currentMask).mask&&s.mask!==a&&s.mask.postRenderWebGL(this,s.camera),a&&s.mask!==a&&a.preRenderWebGL(this,o,i),o.blendMode!==this.currentBlendMode&&this.setBlendMode(o.blendMode);var h=o.type;h!==this.currentType&&(this.newType=!0,this.currentType=h),this.finalType?this.nextTypeMatch=!1:this.nextTypeMatch=e[r+1].type===this.currentType,o.renderWebGL(this,o,i),this.newType=!1;}(s=this.currentMask).mask&&s.mask.postRenderWebGL(this,s.camera),this.setBlendMode(v.BlendModes.NORMAL),this.postRenderCamera(i);}},postRender:function(){var t;this.contextLost||(this.flush(),this.emit(u.POST_RENDER),(t=this.snapshotState).callback&&(f(this.canvas,t),t.callback=null),0<this.textureFlush&&(this.startActiveTexture++,this.currentActiveTexture=1));},snapshot:function(t,e,i){return this.snapshotArea(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight,t,e,i);},snapshotArea:function(t,e,i,n,s,r,o){var a=this.snapshotState;return a.callback=s,a.type=r,a.encoder=o,a.getPixel=!1,a.x=t,a.y=e,a.width=Math.min(i,this.gl.drawingBufferWidth),a.height=Math.min(n,this.gl.drawingBufferHeight),this;},snapshotPixel:function(t,e,i){return this.snapshotArea(t,e,1,1,i),this.snapshotState.getPixel=!0,this;},snapshotFramebuffer:function(t,e,i,n,s,r,o,a,h,u,l){void 0===s&&(s=!1),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=e),void 0===h&&(h=i);var c=this.currentFramebuffer;this.snapshotArea(r,o,a,h,n,u,l);var d=this.snapshotState;return d.getPixel=s,d.isFramebuffer=!0,d.bufferWidth=e,d.bufferHeight=i,this.setFramebuffer(t),f(this.canvas,d),this.setFramebuffer(c),d.callback=null,d.isFramebuffer=!1,this;},canvasToTexture:function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),e?this.updateCanvasTexture(t,e,n):this.createCanvasTexture(t,i,n);},createCanvasTexture:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var n=this.gl,s=n.NEAREST,r=n.NEAREST,o=t.width,a=t.height,h=n.CLAMP_TO_EDGE,u=g(o,a);return!e&&u&&(h=n.REPEAT),this.config.antialias&&(s=u?this.mipmapFilter:n.LINEAR,r=n.LINEAR),this.createTexture2D(0,s,r,h,h,n.RGBA,t,o,a,!0,!1,i);},updateCanvasTexture:function(t,e,i){void 0===i&&(i=!1);var n,s=this.gl,r=t.width,o=t.height;return 0<r&&0<o&&(s.activeTexture(s.TEXTURE0),n=s.getParameter(s.TEXTURE_BINDING_2D),s.bindTexture(s.TEXTURE_2D,e),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,i),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),e.width=r,e.height=o,n&&s.bindTexture(s.TEXTURE_2D,n)),e;},createVideoTexture:function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var n=this.gl,s=n.NEAREST,r=n.NEAREST,o=t.videoWidth,a=t.videoHeight,h=n.CLAMP_TO_EDGE,u=g(o,a);return!e&&u&&(h=n.REPEAT),this.config.antialias&&(s=u?this.mipmapFilter:n.LINEAR,r=n.LINEAR),this.createTexture2D(0,s,r,h,h,n.RGBA,t,o,a,!0,!0,i);},updateVideoTexture:function(t,e,i){void 0===i&&(i=!1);var n,s=this.gl,r=t.videoWidth,o=t.videoHeight;return 0<r&&0<o&&(s.activeTexture(s.TEXTURE0),n=s.getParameter(s.TEXTURE_BINDING_2D),s.bindTexture(s.TEXTURE_2D,e),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,i),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t),e.width=r,e.height=o,n&&s.bindTexture(s.TEXTURE_2D,n)),e;},setTextureFilter:function(t,e){var i=this.gl,n=[i.LINEAR,i.NEAREST][e];i.activeTexture(i.TEXTURE0);var s=i.getParameter(i.TEXTURE_BINDING_2D);return i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n),s&&i.bindTexture(i.TEXTURE_2D,s),this;},getMaxTextureSize:function(){return this.config.maxTextureSize;},destroy:function(){this.canvas.removeEventListener("webglcontextlost",this.contextLostHandler,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoredHandler,!1);for(var t=this.gl,e=this.tempTextures,i=0;i<e.length;i++)t.deleteTexture(e[i]);this.pipelines.destroy(),this.removeAllListeners(),this.fboStack=[],this.maskStack=[],this.extensions={},this.textureIndexes=[],this.gl=null,this.game=null,this.canvas=null,this.contextLost=!0,this.currentMask=null,this.currentCameraMask=null;}});t.exports=c;},function(t,e,i){var n=i(0),o=i(92),s=i(102),r=i(373),a=i(376),h=i(377),u=i(108),l=i(378),c=i(379),d=i(380),f=i(381),p=new n({initialize:function(t){this.game=t.game,this.renderer=t,this.classes=new s([[o.UTILITY_PIPELINE,f],[o.MULTI_PIPELINE,u],[o.BITMAPMASK_PIPELINE,r],[o.SINGLE_PIPELINE,d],[o.ROPE_PIPELINE,c],[o.LIGHT_PIPELINE,h],[o.POINTLIGHT_PIPELINE,l],[o.GRAPHICS_PIPELINE,a]]),this.postPipelineClasses=new s(),this.pipelines=new s(),this.current=null,this.previous=null,this.MULTI_PIPELINE=null,this.BITMAPMASK_PIPELINE=null,this.UTILITY_PIPELINE=null,this.fullFrame1,this.fullFrame2,this.halfFrame1,this.halfFrame2;},boot:function(t){var e,i=this,n=this.game;if(this.classes.each(function(t,e){s=i.add(t,new e({game:n})),t===o.UTILITY_PIPELINE&&(i.UTILITY_PIPELINE=s,i.fullFrame1=s.fullFrame1,i.fullFrame2=s.fullFrame2,i.halfFrame1=s.halfFrame1,i.halfFrame2=s.halfFrame2);}),this.MULTI_PIPELINE=this.get(o.MULTI_PIPELINE),this.BITMAPMASK_PIPELINE=this.get(o.BITMAPMASK_PIPELINE),t)for(e in t){var s,r=t[e];(s=new r(n)).isPostFX?this.postPipelineClasses.set(e,r):this.has(e)||(this.classes.set(e,r),this.add(e,s));}},add:function(t,e){if(!e.isPostFX){var i=this.pipelines,n=this.renderer;return i.has(t)?console.warn("Pipeline exists: "+t):(e.name=t,e.manager=this,i.set(t,e)),e.hasBooted||e.boot(),0!==n.width&&0!==n.height&&e.resize(n.width,n.height),e;}console.warn(t+" is a Post Pipeline. Use `addPostPipeline` instead");},addPostPipeline:function(t,e){this.postPipelineClasses.has(t)||this.postPipelineClasses.set(t,e);},flush:function(){this.current&&this.current.flush();},has:function(t){var e=this.pipelines;return"string"==typeof t?e.has(t):!!e.contains(t);},get:function(t){var e=this.pipelines;return"string"==typeof t?e.get(t):e.contains(t)?t:void 0;},getPostPipeline:function(t,e){var i,n=this.postPipelineClasses;if("string"==typeof t?i=n.get(t):"function"==typeof t?n.contains(t)&&(i=t):"object"==typeof t&&(i=n.get(t.name)),i){var s=new i(this.game);return e&&(s.gameObject=e),s;}},remove:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!0),this.pipelines.delete(t),e&&this.classes.delete(t),i&&this.postPipelineClasses.delete(t);},set:function(t,e,i){if(!t.isPostFX)return this.isCurrent(t,i)||(this.flush(),this.current&&this.current.unbind(),(this.current=t).bind(i)),t.updateProjectionMatrix(),t.onBind(e),t;},preBatch:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=e.length-1;0<=i;i--){var n=e[i];n.active&&n.preBatch(t);}}},postBatch:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=0;i<e.length;i++){var n=e[i];n.active&&n.postBatch(t);}}},preBatchCamera:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=e.length-1;0<=i;i--){var n=e[i];n.active&&n.preBatch(t);}}},postBatchCamera:function(t){if(t.hasPostPipeline){this.flush();for(var e=t.postPipelines,i=0;i<e.length;i++){var n=e[i];n.active&&n.postBatch(t);}}},isCurrent:function(t,e){var i=this.renderer,n=this.current;return n&&!e&&(e=n.currentShader),!(n!==t||e.program!==i.currentProgram);},copyFrame:function(t,e,i,n,s){return this.setUtility(this.UTILITY_PIPELINE.copyShader).copyFrame(t,e,i,n,s),this;},copyToGame:function(t){return this.setUtility(this.UTILITY_PIPELINE.copyShader).copyToGame(t),this;},drawFrame:function(t,e,i,n){return this.setUtility(this.UTILITY_PIPELINE.colorMatrixShader).drawFrame(t,e,i,n),this;},blendFrames:function(t,e,i,n,s){return this.setUtility(this.UTILITY_PIPELINE.linearShader).blendFrames(t,e,i,n,s),this;},blendFramesAdditive:function(t,e,i,n,s){return this.setUtility(this.UTILITY_PIPELINE.addShader).blendFramesAdditive(t,e,i,n,s),this;},clearFrame:function(t,e){return this.UTILITY_PIPELINE.clearFrame(t,e),this;},blitFrame:function(t,e,i,n,s,r){return this.setUtility(this.UTILITY_PIPELINE.copyShader).blitFrame(t,e,i,n,s,r),this;},copyFrameRect:function(t,e,i,n,s,r,o,a){return this.UTILITY_PIPELINE.copyFrameRect(t,e,i,n,s,r,o,a),this;},forceZero:function(){return this.current&&this.current.forceZero;},setMulti:function(){return this.set(this.MULTI_PIPELINE);},setUtility:function(t){return this.UTILITY_PIPELINE.bind(t);},rebind:function(t){void 0===t&&this.previous&&(t=this.previous);var e=this.renderer,i=e.gl;i.disable(i.DEPTH_TEST),i.disable(i.CULL_FACE),e.hasActiveStencilMask()?i.clear(i.DEPTH_BUFFER_BIT):(i.disable(i.STENCIL_TEST),i.clear(i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)),i.viewport(0,0,e.width,e.height),e.currentProgram=null,e.setBlendMode(0,!0);var n=this.pipelines.entries;for(var s in n)n[s].glReset=!0;t&&(this.current=t).rebind(),e.resetTextures();},clear:function(){var t=this.renderer;this.flush(),this.current?(this.current.unbind(),this.previous=this.current,this.current=null):this.previous=null,t.currentProgram=null,t.setBlendMode(0,!0);},destroy:function(){this.flush(),this.classes.clear(),this.postPipelineClasses.clear(),this.pipelines.clear(),this.renderer=null,this.game=null,this.classes=null,this.postPipelineClasses=null,this.pipelines=null,this.current=null,this.previous=null;}});t.exports=p;},function(t,e,i){var n=i(0),s=i(2),r=i(866),o=i(867),a=i(107),h=i(58),u=new n({Extends:h,initialize:function(t){t.fragShader=s(t,"fragShader",r),t.vertShader=s(t,"vertShader",o),t.batchSize=s(t,"batchSize",1),t.vertices=s(t,"vertices",[-1,1,-1,-7,7,1]),t.attributes=s(t,"attributes",[{name:"inPosition",size:2,type:a.FLOAT}]),h.call(this,t);},boot:function(){h.prototype.boot.call(this),this.set1i("uMainSampler",0),this.set1i("uMaskSampler",1);},resize:function(t,e){h.prototype.resize.call(this,t,e),this.set2f("uResolution",t,e);},beginMask:function(t,e,i){var n,s=this.gl;t.bitmapMask&&s&&((n=this.renderer).flush(),n.pushFramebuffer(t.mainFramebuffer),s.disable(s.STENCIL_TEST),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),n.currentCameraMask.mask!==t&&(n.currentMask.mask=t,n.currentMask.camera=i));},endMask:function(t,e){var i,n=this.gl,s=this.renderer,r=t.bitmapMask;r&&n&&(s.flush(),s.pushFramebuffer(t.maskFramebuffer),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),s.setBlendMode(0,!0),r.renderWebGL(s,r,e),s.flush(),s.popFramebuffer(),s.popFramebuffer(),(i=s.getCurrentStencilMask())?(n.enable(n.STENCIL_TEST),i.mask.applyStencil(s,i.camera,!0)):s.currentMask.mask=null,s.pipelines.set(this),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,t.maskTexture),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,t.mainTexture),this.set1i("uInvertMaskAlpha",t.invertAlpha),n.drawArrays(this.topology,0,3),s.resetTextures());}});t.exports=u;},function(t,e,i){t.exports={AFTER_FLUSH:i(868),BEFORE_FLUSH:i(869),BIND:i(870),BOOT:i(871),DESTROY:i(872),REBIND:i(873),RESIZE:i(874)};},function(t,e,i){var n=i(0),d=i(2),f=i(107),s=new n({initialize:function(t,e,i,n,s){this.pipeline=t,this.name=e,this.renderer=t.renderer,this.gl=this.renderer.gl,this.program=this.renderer.createProgram(i,n),this.attributes,this.vertexComponentCount=0,this.vertexSize=0,this.uniforms={},this.createAttributes(s),this.createUniforms();},createAttributes:function(t){for(var e=0,i=0,n=[],s=this.vertexComponentCount=0;s<t.length;s++){var r=t[s],o=r.name,a=d(r,"size",1),h=d(r,"type",f.FLOAT),u=h.enum,l=h.size,c=!!r.normalized;n.push({name:o,size:a,type:u,normalized:c,offset:i,enabled:!1,location:-1}),4===l?e+=a:e++,i+=a*l;}this.vertexSize=i,this.vertexComponentCount=e,this.attributes=n;},bind:function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),e&&this.pipeline.flush(),this.renderer.setProgram(this.program),t&&this.setAttribPointers(),this;},rebind:function(){return this.renderer.setProgram(this.program),this.setAttribPointers(!0),this;},setAttribPointers:function(t){void 0===t&&(t=!1);for(var e=this.gl,i=this.vertexSize,n=this.attributes,s=this.program,r=0;r<n.length;r++){var o,a=n[r],h=a.size,u=a.type,l=a.offset,c=a.enabled,d=a.location,f=!!a.normalized;t?0<=(o=e.getAttribLocation(s,a.name))?(e.enableVertexAttribArray(o),e.vertexAttribPointer(o,h,u,f,i,l),a.enabled=!0,a.location=o):-1!==o&&e.disableVertexAttribArray(o):c?e.vertexAttribPointer(d,h,u,f,i,l):!c&&-1<d&&(e.disableVertexAttribArray(d),a.location=-1);}return this;},createUniforms:function(){for(var t,e,i=this.gl,n=this.program,s=this.uniforms,r=i.getProgramParameter(n,i.ACTIVE_UNIFORMS),o=0;o<r;o++){var a,h=i.getActiveUniform(n,o);h&&(t=h.name,null!==(e=i.getUniformLocation(n,t))&&(s[t]={name:t,location:e,value1:null,value2:null,value3:null,value4:null}),0<(a=t.indexOf("["))&&(t=t.substr(0,a),s.hasOwnProperty(t)||null!==(e=i.getUniformLocation(n,t))&&(s[t]={name:t,location:e,value1:null,value2:null,value3:null,value4:null})));}return this;},hasUniform:function(t){return this.uniforms.hasOwnProperty(t);},resetUniform:function(t){var e=this.uniforms[t];return e&&(e.value1=null,e.value2=null,e.value3=null,e.value4=null),this;},setUniform1:function(t,e,i,n){var s=this.uniforms[e];return s&&(!n&&s.value1===i||(s.value1=i,this.renderer.setProgram(this.program),t.call(this.gl,s.location,i),this.pipeline.currentShader=this)),this;},setUniform2:function(t,e,i,n,s){var r=this.uniforms[e];return r&&(!s&&r.value1===i&&r.value2===n||(r.value1=i,r.value2=n,this.renderer.setProgram(this.program),t.call(this.gl,r.location,i,n),this.pipeline.currentShader=this)),this;},setUniform3:function(t,e,i,n,s,r){var o=this.uniforms[e];return o&&(!r&&o.value1===i&&o.value2===n&&o.value3===s||(o.value1=i,o.value2=n,o.value3=s,this.renderer.setProgram(this.program),t.call(this.gl,o.location,i,n,s),this.pipeline.currentShader=this)),this;},setUniform4:function(t,e,i,n,s,r,o){var a=this.uniforms[e];return a&&(!o&&a.value1===i&&a.value2===n&&a.value3===s&&a.value4===r||(a.value1=i,a.value2=n,a.value3=s,a.value4=r,this.renderer.setProgram(this.program),t.call(this.gl,a.location,i,n,s,r),this.pipeline.currentShader=this)),this;},set1f:function(t,e){return this.setUniform1(this.gl.uniform1f,t,e);},set2f:function(t,e,i){return this.setUniform2(this.gl.uniform2f,t,e,i);},set3f:function(t,e,i,n){return this.setUniform3(this.gl.uniform3f,t,e,i,n);},set4f:function(t,e,i,n,s){return this.setUniform4(this.gl.uniform4f,t,e,i,n,s);},set1fv:function(t,e){return this.setUniform1(this.gl.uniform1fv,t,e,!0);},set2fv:function(t,e){return this.setUniform1(this.gl.uniform2fv,t,e,!0);},set3fv:function(t,e){return this.setUniform1(this.gl.uniform3fv,t,e,!0);},set4fv:function(t,e){return this.setUniform1(this.gl.uniform4fv,t,e,!0);},set1iv:function(t,e){return this.setUniform1(this.gl.uniform1iv,t,e,!0);},set2iv:function(t,e){return this.setUniform1(this.gl.uniform2iv,t,e,!0);},set3iv:function(t,e){return this.setUniform1(this.gl.uniform3iv,t,e,!0);},set4iv:function(t,e){return this.setUniform1(this.gl.uniform4iv,t,e,!0);},set1i:function(t,e){return this.setUniform1(this.gl.uniform1i,t,e);},set2i:function(t,e,i){return this.setUniform2(this.gl.uniform2i,t,e,i);},set3i:function(t,e,i,n){return this.setUniform3(this.gl.uniform3i,t,e,i,n);},set4i:function(t,e,i,n,s){return this.setUniform4(this.gl.uniform4i,t,e,i,n,s);},setMatrix2fv:function(t,e,i){return this.setUniform2(this.gl.uniformMatrix2fv,t,e,i,!0);},setMatrix3fv:function(t,e,i){return this.setUniform2(this.gl.uniformMatrix3fv,t,e,i,!0);},setMatrix4fv:function(t,e,i){return this.setUniform2(this.gl.uniformMatrix4fv,t,e,i,!0);},destroy:function(){this.gl.deleteProgram(this.program),this.pipeline=null,this.renderer=null,this.gl=null,this.program=null,this.attributes=null,this.uniforms=null;}});t.exports=s;},function(t,e,i){var n=i(0),R=i(59),s=i(2),r=i(875),o=i(876),a=i(25),h=i(107),u=i(58),l=new n({Extends:u,initialize:function(t){t.fragShader=s(t,"fragShader",r),t.vertShader=s(t,"vertShader",o),t.attributes=s(t,"attributes",[{name:"inPosition",size:2},{name:"inColor",size:4,type:h.UNSIGNED_BYTE,normalized:!0}]),u.call(this,t),this.calcMatrix=new a(),this.tempTriangle=[{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0},{x:0,y:0,width:0}],this.strokeTint={TL:0,TR:0,BL:0,BR:0},this.fillTint={TL:0,TR:0,BL:0,BR:0},this.currentFrame={u0:0,v0:0,u1:1,v1:1},this.firstQuad=[0,0,0,0,0],this.prevQuad=[0,0,0,0,0],this.polygonCache=[];},batchFillRect:function(t,e,i,n,s,r){this.renderer.pipelines.set(this);var o=this.calcMatrix;r&&r.multiply(s,o);var a=t+i,h=e+n,u=o.getX(t,e),l=o.getY(t,e),c=o.getX(t,h),d=o.getY(t,h),f=o.getX(a,h),p=o.getY(a,h),g=o.getX(a,e),v=o.getY(a,e),m=this.fillTint;this.batchQuad(u,l,c,d,f,p,g,v,m.TL,m.TR,m.BL,m.BR);},batchFillTriangle:function(t,e,i,n,s,r,o,a){this.renderer.pipelines.set(this);var h=this.calcMatrix;a&&a.multiply(o,h);var u=h.getX(t,e),l=h.getY(t,e),c=h.getX(i,n),d=h.getY(i,n),f=h.getX(s,r),p=h.getY(s,r),g=this.fillTint;this.batchTri(u,l,c,d,f,p,g.TL,g.TR,g.BL);},batchStrokeTriangle:function(t,e,i,n,s,r,o,a,h){var u=this.tempTriangle;u[0].x=t,u[0].y=e,u[0].width=o,u[1].x=i,u[1].y=n,u[1].width=o,u[2].x=s,u[2].y=r,u[2].width=o,u[3].x=t,u[3].y=e,u[3].width=o,this.batchStrokePath(u,o,!1,a,h);},batchFillPath:function(t,e,i){this.renderer.pipelines.set(this);var n=this.calcMatrix;i&&i.multiply(e,n);for(var s,r,o=t.length,a=this.polygonCache,h=this.fillTint.TL,u=this.fillTint.TR,l=this.fillTint.BL,c=0;c<o;++c)r=t[c],a.push(r.x,r.y);o=(s=R(a)).length;for(var d=0;d<o;d+=3){var f=2*s[d+0],p=2*s[d+1],g=2*s[d+2],v=a[0+f],m=a[1+f],y=a[0+p],x=a[1+p],T=a[0+g],w=a[1+g],E=n.getX(v,m),b=n.getY(v,m),S=n.getX(y,x),A=n.getY(y,x),_=n.getX(T,w),C=n.getY(T,w);this.batchTri(E,b,S,A,_,C,h,u,l);}a.length=0;},batchStrokePath:function(t,e,i,n,s){this.renderer.pipelines.set(this),this.prevQuad[4]=0,this.firstQuad[4]=0;for(var r=t.length-1,o=0;o<r;o++){var a=t[o],h=t[o+1];this.batchLine(a.x,a.y,h.x,h.y,a.width/2,h.width/2,e,o,!i&&o===r-1,n,s);}},batchLine:function(t,e,i,n,s,r,o,a,h,u,l){this.renderer.pipelines.set(this);var c=this.calcMatrix;l&&l.multiply(u,c);var d,f,p=i-t,g=n-e,v=Math.sqrt(p*p+g*g),m=s*(n-e)/v,y=s*(t-i)/v,x=r*(n-e)/v,T=r*(t-i)/v,w=i-x,E=n-T,b=t-m,S=e-y,A=i+x,_=n+T,C=t+m,R=e+y,M=c.getX(w,E),P=c.getY(w,E),O=c.getX(b,S),L=c.getY(b,S),D=c.getX(A,_),F=c.getY(A,_),k=c.getX(C,R),I=c.getY(C,R),B=this.strokeTint,N=B.TL,Y=B.TR,X=B.BL,U=B.BR;this.batchQuad(k,I,O,L,M,P,D,F,N,Y,X,U),o<=2||(d=this.prevQuad,f=this.firstQuad,0<a&&d[4]?this.batchQuad(k,I,O,L,d[0],d[1],d[2],d[3],N,Y,X,U):(f[0]=k,f[1]=I,f[2]=O,f[3]=L,f[4]=1),h&&f[4]?this.batchQuad(M,P,D,F,f[0],f[1],f[2],f[3],N,Y,X,U):(d[0]=M,d[1]=P,d[2]=D,d[3]=F,d[4]=1));},batchVert:function(t,e,i){var n=this.vertexViewF32,s=this.vertexViewU32,r=this.vertexCount*this.currentShader.vertexComponentCount-1;n[++r]=t,n[++r]=e,s[++r]=i,this.vertexCount++;},batchQuad:function(t,e,i,n,s,r,o,a,h,u,l,c){var d=!1;return this.shouldFlush(6)&&(this.flush(),d=!0),this.batchVert(t,e,h),this.batchVert(i,n,l),this.batchVert(s,r,c),this.batchVert(t,e,h),this.batchVert(s,r,c),this.batchVert(o,a,u),d;},batchTri:function(t,e,i,n,s,r,o,a,h){var u=!1;return this.shouldFlush(3)&&(this.flush(),u=!0),this.batchVert(t,e,o),this.batchVert(i,n,a),this.batchVert(s,r,h),u;},destroy:function(){return u.prototype.destroy.call(this),this.polygonCache=null,this;}});t.exports=l;},function(t,e,i){var n=i(0),s=i(2),r=i(877),L=i(108),o=i(3),a=i(58),h=10,c=new o(),u=new n({Extends:L,initialize:function(t){h=t.game.renderer.config.maxLights;for(var e=s(t,"fragShader",r),i=[],n=1;n<=h;n++)i.push({name:"lights"+n,fragShader:e.replace("%LIGHT_COUNT%",n.toString())});t.shaders=i,L.call(this,t),this.inverseRotationMatrix=new Float32Array([1,0,0,0,1,0,0,0,1]),this.defaultNormalMap,this.lightsActive=!0;},boot:function(){a.prototype.boot.call(this);var t=this.gl,e=t.createTexture();t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([127,127,255,255])),this.defaultNormalMap={glTexture:e};for(var i=0;i<this.shaders.length;i++)this["lightShader"+(i+1)]=this.shaders[i];},onRender:function(t,e){var i=t.sys.lights;if(this.lightsActive=!1,i&&i.active){var n,s=i.getLights(e),r=s.length;if(0!==r){this.lightsActive=!0,this.setShader(this["lightShader"+r],!0);var o=this.renderer.height,a=e.matrix;for(this.set1i("uMainSampler",0),this.set1i("uNormSampler",1),this.set2f("uResolution",this.width/2,this.height/2),this.set4f("uCamera",e.x,e.y,e.rotation,e.zoom),this.set3f("uAmbientLightColor",i.ambientColor.r,i.ambientColor.g,i.ambientColor.b),n=0;n<r;n++){var h=s[n].light,u=h.color,l="uLights["+n+"].";a.transformPoint(h.x,h.y,c),this.set2f(l+"position",c.x-e.scrollX*h.scrollFactorX*e.zoom,o-(c.y-e.scrollY*h.scrollFactorY*e.zoom)),this.set3f(l+"color",u.r,u.g,u.b),this.set1f(l+"intensity",h.intensity),this.set1f(l+"radius",h.radius);}this.currentNormalMapRotation=null;}}},setNormalMapRotation:function(t){var e,i,n,s;t===this.currentNormalMapRotation&&0!==this.vertexCount||(0<this.vertexCount&&this.flush(),e=this.inverseRotationMatrix,t?(i=-t,n=Math.cos(i),s=Math.sin(i),e[1]=s,e[3]=-s,e[0]=e[4]=n):(e[0]=e[4]=1,e[1]=e[3]=0),this.setMatrix3fv("uInverseRotationMatrix",!1,e),this.currentNormalMapRotation=t);},setTexture2D:function(t,e){var i=this.renderer;void 0===t&&(t=i.tempTextures[0]);var n=this.getNormalMap(e);i.isNewNormalMap(t,n)&&(this.flush(),i.setTextureZero(t),i.setNormalMap(n));var s=e?e.rotation:0;return this.setNormalMapRotation(s),this.currentUnit=0;},setGameObject:function(t,e){void 0===e&&(e=t.frame);var i=this.renderer,n=e.glTexture,s=this.getNormalMap(t);return i.isNewNormalMap()&&(this.flush(),i.setTextureZero(n),i.setNormalMap(s)),this.setNormalMapRotation(t.rotation),this.currentUnit=0;},getNormalMap:function(t){var e;return t?t.displayTexture?e=t.displayTexture.dataSource[t.displayFrame.sourceIndex]:t.texture?e=t.texture.dataSource[t.frame.sourceIndex]:t.tileset&&(e=Array.isArray(t.tileset)?t.tileset[0].image.dataSource[0]:t.tileset.image.dataSource[0]):e=this.defaultNormalMap,(e=e||this.defaultNormalMap).glTexture;},batchSprite:function(t,e,i){this.lightsActive&&L.prototype.batchSprite.call(this,t,e,i);},batchTexture:function(t,e,i,n,s,r,o,a,h,u,l,c,d,f,p,g,v,m,y,x,T,w,E,b,S,A,_,C,R,M,P,O){this.lightsActive&&L.prototype.batchTexture.call(this,t,e,i,n,s,r,o,a,h,u,l,c,d,f,p,g,v,m,y,x,T,w,E,b,S,A,_,C,R,M,P,O);},batchTextureFrame:function(t,e,i,n,s,r,o){this.lightsActive&&L.prototype.batchTextureFrame.call(this,t,e,i,n,s,r,o);}});u.LIGHT_COUNT=h,t.exports=u;},function(t,e,i){var n=i(0),s=i(2),r=i(880),o=i(881),a=i(58),h=new n({Extends:a,initialize:function(t){t.vertShader=s(t,"vertShader",o),t.fragShader=s(t,"fragShader",r),t.attributes=s(t,"attributes",[{name:"inPosition",size:2},{name:"inLightPosition",size:2},{name:"inLightRadius"},{name:"inLightAttenuation"},{name:"inLightColor",size:4}]),a.call(this,t);},onRender:function(t,e){this.set2f("uResolution",this.width,this.height),this.set1f("uCameraZoom",e.zoom);},batchPointLight:function(t,e,i,n,s,r,o,a,h,u,l,c){var d=t.color,f=t.intensity,p=t.radius,g=t.attenuation,v=d.r*f,m=d.g*f,y=d.b*f,x=e.alpha*t.alpha;this.shouldFlush(6)&&this.flush(),this.batchLightVert(i,n,l,c,p,g,v,m,y,x),this.batchLightVert(s,r,l,c,p,g,v,m,y,x),this.batchLightVert(o,a,l,c,p,g,v,m,y,x),this.batchLightVert(i,n,l,c,p,g,v,m,y,x),this.batchLightVert(o,a,l,c,p,g,v,m,y,x),this.batchLightVert(h,u,l,c,p,g,v,m,y,x);},batchLightVert:function(t,e,i,n,s,r,o,a,h,u){var l=this.vertexViewF32,c=this.vertexCount*this.currentShader.vertexComponentCount-1;l[++c]=t,l[++c]=e,l[++c]=i,l[++c]=n,l[++c]=s,l[++c]=r,l[++c]=o,l[++c]=a,l[++c]=h,l[++c]=u,this.vertexCount++;}});t.exports=h;},function(t,e,i){var n=i(0),s=i(2),r=i(108),o=new n({Extends:r,initialize:function(t){t.topology=5,t.batchSize=s(t,"batchSize",256),r.call(this,t);}});t.exports=o;},function(t,e,i){var n=i(0),s=i(2),r=i(108),o=i(882),a=i(883),h=i(58),u=new n({Extends:r,initialize:function(t){t.fragShader=s(t,"fragShader",o),t.vertShader=s(t,"vertShader",a),t.forceZero=!0,r.call(this,t);},boot:function(){h.prototype.boot.call(this),this.set1i("uMainSampler",0);}});t.exports=u;},function(t,e,i){var n=i(884),u=i(35),s=i(0),r=i(198),o=i(885),a=i(886),h=i(2),l=i(887),c=i(382),d=i(58),f=new s({Extends:d,initialize:function(t){t.renderTarget=h(t,"renderTarget",[{scale:1},{scale:1},{scale:.5},{scale:.5}]),t.vertShader=h(t,"vertShader",c),t.shaders=h(t,"shaders",[{name:"Copy",fragShader:a},{name:"AddBlend",fragShader:n},{name:"LinearBlend",fragShader:l},{name:"ColorMatrix",fragShader:o}]),t.attributes=h(t,"attributes",[{name:"inPosition",size:2},{name:"inTexCoord",size:2}]),t.vertices=[-1,-1,0,0,-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0],t.batchSize=1,d.call(this,t),this.colorMatrix=new r(),this.copyShader,this.addShader,this.linearShader,this.colorMatrixShader,this.fullFrame1,this.fullFrame2,this.halfFrame1,this.halfFrame2;},boot:function(){d.prototype.boot.call(this);var t=this.shaders,e=this.renderTargets;this.copyShader=t[0],this.addShader=t[1],this.linearShader=t[2],this.colorMatrixShader=t[3],this.fullFrame1=e[0],this.fullFrame2=e[1],this.halfFrame1=e[2],this.halfFrame2=e[3];},copyFrame:function(t,e,i,n,s){void 0===i&&(i=1),void 0===n&&(n=!0),void 0===s&&(s=!0);var r=this.gl;this.setShader(this.copyShader),this.set1i("uMainSampler",0),this.set1f("uBrightness",i),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t.texture),e?(r.viewport(0,0,e.width,e.height),r.bindFramebuffer(r.FRAMEBUFFER,e.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.texture,0)):r.viewport(0,0,t.width,t.height),n&&(s?r.clearColor(0,0,0,0):r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT)),r.bufferData(r.ARRAY_BUFFER,this.vertexData,r.STATIC_DRAW),r.drawArrays(r.TRIANGLES,0,6),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindTexture(r.TEXTURE_2D,null);},blitFrame:function(t,e,i,n,s,r){void 0===i&&(i=1),void 0===n&&(n=!0),void 0===s&&(s=!0),void 0===r&&(r=!1);var o,a,h=this.gl;this.setShader(this.copyShader),this.set1i("uMainSampler",0),this.set1f("uBrightness",i),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,t.texture),t.height>e.height?(h.viewport(0,0,t.width,t.height),this.setTargetUVs(t,e)):(o=e.height-t.height,h.viewport(0,o,t.width,t.height)),h.bindFramebuffer(h.FRAMEBUFFER,e.framebuffer),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,e.texture,0),n&&(s?h.clearColor(0,0,0,0):h.clearColor(0,0,0,1),h.clear(h.COLOR_BUFFER_BIT)),r&&(a=this.renderer.currentBlendMode,this.renderer.setBlendMode(u.ERASE)),h.bufferData(h.ARRAY_BUFFER,this.vertexData,h.STATIC_DRAW),h.drawArrays(h.TRIANGLES,0,6),r&&this.renderer.setBlendMode(a),h.bindFramebuffer(h.FRAMEBUFFER,null),h.bindTexture(h.TEXTURE_2D,null),this.resetUVs();},copyFrameRect:function(t,e,i,n,s,r,o,a){void 0===o&&(o=!0),void 0===a&&(a=!0);var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,t.framebuffer),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,t.texture,0),o&&(a?h.clearColor(0,0,0,0):h.clearColor(0,0,0,1),h.clear(h.COLOR_BUFFER_BIT)),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,e.texture),h.copyTexSubImage2D(h.TEXTURE_2D,0,0,0,i,n,s,r),h.bindFramebuffer(h.FRAMEBUFFER,null),h.bindTexture(h.TEXTURE_2D,null);},copyToGame:function(t){var e=this.gl;this.setShader(this.copyShader),this.set1i("uMainSampler",0),this.set1f("uBrightness",1),this.renderer.popFramebuffer(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.texture),e.bufferData(e.ARRAY_BUFFER,this.vertexData,e.STATIC_DRAW),e.drawArrays(e.TRIANGLES,0,6),this.renderer.resetTextures();},drawFrame:function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=this.colorMatrix);var s=this.gl;this.setShader(this.colorMatrixShader),this.set1i("uMainSampler",0),this.set1fv("uColorMatrix",n.getData()),this.set1f("uAlpha",n.alpha),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t.texture),e?(s.viewport(0,0,e.width,e.height),s.bindFramebuffer(s.FRAMEBUFFER,e.framebuffer),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e.texture,0)):s.viewport(0,0,t.width,t.height),i?s.clearColor(0,0,0,0):s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT),s.bufferData(s.ARRAY_BUFFER,this.vertexData,s.STATIC_DRAW),s.drawArrays(s.TRIANGLES,0,6),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindTexture(s.TEXTURE_2D,null);},blendFrames:function(t,e,i,n,s,r){void 0===n&&(n=1),void 0===s&&(s=!0),void 0===r&&(r=this.linearShader);var o=this.gl;this.setShader(r),this.set1i("uMainSampler1",0),this.set1i("uMainSampler2",1),this.set1f("uStrength",n),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,t.texture),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,e.texture),i?(o.bindFramebuffer(o.FRAMEBUFFER,i.framebuffer),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,i.texture,0),o.viewport(0,0,i.width,i.height)):o.viewport(0,0,t.width,t.height),s?o.clearColor(0,0,0,0):o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT),o.bufferData(o.ARRAY_BUFFER,this.vertexData,o.STATIC_DRAW),o.drawArrays(o.TRIANGLES,0,6),o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindTexture(o.TEXTURE_2D,null);},blendFramesAdditive:function(t,e,i,n,s){this.blendFrames(t,e,i,n,s,this.addShader);},clearFrame:function(t,e){void 0===e&&(e=!0);var i=this.gl;i.viewport(0,0,t.width,t.height),i.bindFramebuffer(i.FRAMEBUFFER,t.framebuffer),e?i.clearColor(0,0,0,0):i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT);var n=this.renderer.currentFramebuffer;i.bindFramebuffer(i.FRAMEBUFFER,n);},setUVs:function(t,e,i,n,s,r,o,a){var h=this.vertexViewF32;h[2]=t,h[3]=e,h[6]=i,h[7]=n,h[10]=s,h[11]=r,h[14]=t,h[15]=e,h[18]=s,h[19]=r,h[22]=o,h[23]=a;},setTargetUVs:function(t,e){var i=.5<(i=e.height/t.height)?.5-(i-.5):.5-i+.5;this.setUVs(0,i,0,1+i,1,1+i,1,i);},flipX:function(){this.setUVs(1,0,1,1,0,1,0,0);},flipY:function(){this.setUVs(0,1,0,0,1,0,1,1);},resetUVs:function(){this.setUVs(0,0,0,1,1,1,1,0);}});t.exports=f;},function(t,e){t.exports=["#define SHADER_NAME PHASER_QUAD_VS","","precision mediump float;","","attribute vec2 inPosition;","attribute vec2 inTexCoord;","","varying vec2 outFragCoord;","varying vec2 outTexCoord;","","void main ()","{","    outFragCoord = inPosition.xy * 0.5 + 0.5;","    outTexCoord = inTexCoord;","","    gl_Position = vec4(inPosition, 0, 1);","}",""].join("\n");},function(t,e,i){var _=i(31),C=i(38),R=i(2);t.exports=function(t,e){var i=t.getContext("experimental-webgl"),n=R(e,"callback"),s=R(e,"type","image/png"),r=R(e,"encoder",.92),o=R(e,"x",0),a=R(e,"y",0),h=R(e,"getPixel",!1),u=R(e,"isFramebuffer",!1),l=u?R(e,"bufferWidth",1):i.drawingBufferWidth,c=u?R(e,"bufferHeight",1):i.drawingBufferHeight;if(h){var d=new Uint8Array(4),f=u?a:c-a;i.readPixels(o,f,1,1,i.RGBA,i.UNSIGNED_BYTE,d),n.call(null,new C(d[0],d[1],d[2],d[3]/255));}else{var p=R(e,"width",l),g=R(e,"height",c),v=new Uint8Array(p*g*4);i.readPixels(o,c-a-g,p,g,i.RGBA,i.UNSIGNED_BYTE,v);for(var m=_.createWebGL(this,p,g),y=m.getContext("2d"),x=y.getImageData(0,0,p,g),T=x.data,w=0;w<g;w++)for(var E=0;E<p;E++){var b=4*((g-w-1)*p+E),S=4*(w*p+E);T[0+S]=v[0+b],T[1+S]=v[1+b],T[2+S]=v[2+b],T[3+S]=v[3+b];}y.putImageData(x,0,0);var A=new Image();A.onerror=function(){n.call(null),_.remove(m);},A.onload=function(){n.call(null,A),_.remove(m);},A.src=m.toDataURL(s,r);}};},function(t,e,i){var u=i(33);t.exports=function(t){var e,i,n,s,r,o,a,h=t.config;h.hideBanner||(e="WebGL",h.renderType===u.CANVAS?e="Canvas":h.renderType===u.HEADLESS&&(e="Headless"),i=h.audio,a=(n=t.device.audio).webAudio&&!i.disableWebAudio?"Web Audio":i.noAudio||!n.webAudio&&!n.audioData?"No Audio":"HTML5 Audio",t.device.browser.ie?window.console&&console.log("Phaser v"+u.VERSION+" / https://phaser.io"):(r=[s=""],Array.isArray(h.bannerBackgroundColor)?(h.bannerBackgroundColor.forEach(function(t){s=s.concat("%c "),r.push("background: "+t),o=t;}),r[r.length-1]="color: "+h.bannerTextColor+"; background: "+o):(s=s.concat("%c "),r.push("color: "+h.bannerTextColor+"; background: "+h.bannerBackgroundColor)),r.push("background: transparent"),h.gameTitle&&(s=s.concat(h.gameTitle),h.gameVersion&&(s=s.concat(" v"+h.gameVersion)),h.hidePhaser||(s=s.concat(" / "))),h.hidePhaser||(s=s.concat("Phaser v"+u.VERSION+" ("+e+" | "+a+")")),s=s.concat(" %c "+h.gameURL),r[0]=s,console.log.apply(console,r)));};},function(t,e,i){var n=i(0),s=i(6),r=i(1),o=i(386),a=new n({initialize:function(t,e){this.game=t,this.raf=new o(),this.started=!1,this.running=!1,this.minFps=s(e,"min",5),this.targetFps=s(e,"target",60),this._min=1e3/this.minFps,this._target=1e3/this.targetFps,this.actualFps=this.targetFps,this.nextFpsUpdate=0,this.framesThisSecond=0,this.callback=r,this.forceSetTimeOut=s(e,"forceSetTimeOut",!1),this.time=0,this.startTime=0,this.lastTime=0,this.frame=0,this.inFocus=!0,this._pauseTime=0,this._coolDown=0,this.delta=0,this.deltaIndex=0,this.deltaHistory=[],this.deltaSmoothingMax=s(e,"deltaHistory",10),this.panicMax=s(e,"panicMax",120),this.rawDelta=0,this.now=0,this.smoothStep=s(e,"smoothStep",!0);},blur:function(){this.inFocus=!1;},focus:function(){this.inFocus=!0,this.resetDelta();},pause:function(){this._pauseTime=window.performance.now();},resume:function(){this.resetDelta(),this.startTime+=this.time-this._pauseTime;},resetDelta:function(){var t=window.performance.now();this.time=t,this.lastTime=t,this.nextFpsUpdate=t+1e3;for(var e=this.framesThisSecond=0;e<this.deltaSmoothingMax;e++)this.deltaHistory[e]=Math.min(this._target,this.deltaHistory[e]);this.delta=0,this.deltaIndex=0,this._coolDown=this.panicMax;},start:function(t){if(this.started)return this;this.started=!0,this.running=!0;for(var e=0;e<this.deltaSmoothingMax;e++)this.deltaHistory[e]=this._target;this.resetDelta(),this.startTime=window.performance.now(),this.callback=t,this.raf.start(this.step.bind(this),this.forceSetTimeOut,this._target);},step:function(){var t=window.performance.now(),e=(this.now=t)-this.lastTime;e<0&&(e=0),this.rawDelta=e;var i=this.deltaIndex,n=this.deltaHistory,s=this.deltaSmoothingMax,r=e,o=e;if(this.smoothStep){(0<this._coolDown||!this.inFocus)&&(this._coolDown--,r=Math.min(r,this._target)),r>this._min&&(r=n[i],r=Math.min(r,this._min)),n[i]=r,this.deltaIndex++,this.deltaIndex>s&&(this.deltaIndex=0);for(var a=o=0;a<s;a++)o+=n[a];o/=s;}this.delta=o,this.time+=this.rawDelta,t>this.nextFpsUpdate&&(this.actualFps=.25*this.framesThisSecond+.75*this.actualFps,this.nextFpsUpdate=t+1e3,this.framesThisSecond=0),this.framesThisSecond++;var h=o/this._target;this.callback(t,o,h),this.lastTime=t,this.frame++;},tick:function(){this.step();},sleep:function(){this.running&&(this.raf.stop(),this.running=!1);},wake:function(t){this.running||(t&&(this.startTime+=-this.lastTime+(this.lastTime+window.performance.now())),this.raf.start(this.step.bind(this),this.useRAF),this.running=!0,this.step());},getDuration:function(){return Math.round(this.lastTime-this.startTime)/1e3;},getDurationMS:function(){return Math.round(this.lastTime-this.startTime);},stop:function(){return this.running=!1,this.started=!1,this.raf.stop(),this;},destroy:function(){this.stop(),this.callback=r,this.raf=null,this.game=null;}});t.exports=a;},function(t,e,i){var n=i(0),s=i(1),r=new n({initialize:function(){this.isRunning=!1,this.callback=s,this.tick=0,this.isSetTimeOut=!1,this.timeOutID=null,this.lastTime=0,this.target=0;var n=this;this.step=function t(){var e=window.performance.now();n.lastTime=n.tick,n.tick=e,n.callback(e),n.timeOutID=window.requestAnimationFrame(t);},this.stepTimeout=function t(){var e=Date.now(),i=Math.min(Math.max(2*n.target+n.tick-e,0),n.target);n.lastTime=n.tick,n.tick=e,n.callback(e),n.timeOutID=window.setTimeout(t,i);};},start:function(t,e,i){this.isRunning||(this.callback=t,this.isSetTimeOut=e,this.target=i,this.isRunning=!0,this.timeOutID=e?window.setTimeout(this.stepTimeout,0):window.requestAnimationFrame(this.step));},stop:function(){this.isRunning=!1,this.isSetTimeOut?clearTimeout(this.timeOutID):window.cancelAnimationFrame(this.timeOutID);},destroy:function(){this.stop(),this.callback=s;}});t.exports=r;},function(t,e,i){var n=i(22);t.exports=function(t){var e,i=t.events;void 0!==document.hidden?e="visibilitychange":["webkit","moz","ms"].forEach(function(t){void 0!==document[t+"Hidden"]&&(document.hidden=function(){return document[t+"Hidden"];},e=t+"visibilitychange");});e&&document.addEventListener(e,function(t){document.hidden||"pause"===t.type?i.emit(n.HIDDEN):i.emit(n.VISIBLE);},!1),window.onblur=function(){i.emit(n.BLUR);},window.onfocus=function(){i.emit(n.FOCUS);},window.focus&&t.config.autoFocus&&window.focus();};},function(t,e,i){var m=i(389),y=i(31),x=i(6);t.exports=function(t){var e=x(t,"data",[]),i=x(t,"canvas",null),n=x(t,"palette",m),s=x(t,"pixelWidth",1),r=x(t,"pixelHeight",s),o=x(t,"resizeCanvas",!0),a=x(t,"clearCanvas",!0),h=x(t,"preRender",null),u=x(t,"postRender",null),l=Math.floor(Math.abs(e[0].length*s)),c=Math.floor(Math.abs(e.length*r));i||(i=y.create2D(this,l,c),a=o=!1),o&&(i.width=l,i.height=c);var d=i.getContext("2d");a&&d.clearRect(0,0,l,c),h&&h(i,d);for(var f=0;f<e.length;f++)for(var p=e[f],g=0;g<p.length;g++){var v=p[g];"."!==v&&" "!==v&&(d.fillStyle=n[v],d.fillRect(g*s,f*r,s,r));}return u&&u(i,d),i;};},function(t,e){t.exports={0:"#000",1:"#9D9D9D",2:"#FFF",3:"#BE2633",4:"#E06F8B",5:"#493C2B",6:"#A46422",7:"#EB8931",8:"#F7E26B",9:"#2F484E",A:"#44891A",B:"#A3CE27",C:"#1B2632",D:"#005784",E:"#31A2F2",F:"#B2DCEF"};},function(t,e,i){var n=i(0),o=i(358),s=i(94),a=i(3),h=new n({Extends:s,initialize:function(t,e,i,n){s.call(this,"CubicBezierCurve"),Array.isArray(t)&&(n=new a(t[6],t[7]),i=new a(t[4],t[5]),e=new a(t[2],t[3]),t=new a(t[0],t[1])),this.p0=t,this.p1=e,this.p2=i,this.p3=n;},getStartPoint:function(t){return void 0===t&&(t=new a()),t.copy(this.p0);},getResolution:function(t){return t;},getPoint:function(t,e){void 0===e&&(e=new a());var i=this.p0,n=this.p1,s=this.p2,r=this.p3;return e.set(o(t,i.x,n.x,s.x,r.x),o(t,i.y,n.y,s.y,r.y));},draw:function(t,e){void 0===e&&(e=32);var i=this.getPoints(e);t.beginPath(),t.moveTo(this.p0.x,this.p0.y);for(var n=1;n<i.length;n++)t.lineTo(i[n].x,i[n].y);return t.strokePath(),t;},toJSON:function(){return{type:this.type,points:[this.p0.x,this.p0.y,this.p1.x,this.p1.y,this.p2.x,this.p2.y,this.p3.x,this.p3.y]};}});h.fromJSON=function(t){var e=t.points,i=new a(e[0],e[1]),n=new a(e[2],e[3]),s=new a(e[4],e[5]),r=new a(e[6],e[7]);return new h(i,n,s,r);},t.exports=h;},function(t,e,i){var n=i(0),u=i(94),l=i(36),c=i(6),s=i(196),d=i(3),r=new n({Extends:u,initialize:function(t,e,i,n,s,r,o,a){var h;"object"==typeof t?(t=c(h=t,"x",0),e=c(h,"y",0),i=c(h,"xRadius",0),n=c(h,"yRadius",i),s=c(h,"startAngle",0),r=c(h,"endAngle",360),o=c(h,"clockwise",!1),a=c(h,"rotation",0)):(void 0===n&&(n=i),void 0===s&&(s=0),void 0===r&&(r=360),void 0===o&&(o=!1),void 0===a&&(a=0)),u.call(this,"EllipseCurve"),this.p0=new d(t,e),this._xRadius=i,this._yRadius=n,this._startAngle=l(s),this._endAngle=l(r),this._clockwise=o,this._rotation=l(a);},getStartPoint:function(t){return void 0===t&&(t=new d()),this.getPoint(0,t);},getResolution:function(t){return 2*t;},getPoint:function(t,e){void 0===e&&(e=new d());for(var i=2*Math.PI,n=this._endAngle-this._startAngle,s=Math.abs(n)<Number.EPSILON;n<0;)n+=i;for(;i<n;)n-=i;n<Number.EPSILON&&(n=s?0:i),this._clockwise&&!s&&(n===i?n=-i:n-=i);var r,o,a,h,u=this._startAngle+t*n,l=this.p0.x+this._xRadius*Math.cos(u),c=this.p0.y+this._yRadius*Math.sin(u);return 0!==this._rotation&&(r=Math.cos(this._rotation),o=Math.sin(this._rotation),l=(a=l-this.p0.x)*r-(h=c-this.p0.y)*o+this.p0.x,c=a*o+h*r+this.p0.y),e.set(l,c);},setXRadius:function(t){return this.xRadius=t,this;},setYRadius:function(t){return this.yRadius=t,this;},setWidth:function(t){return this.xRadius=t/2,this;},setHeight:function(t){return this.yRadius=t/2,this;},setStartAngle:function(t){return this.startAngle=t,this;},setEndAngle:function(t){return this.endAngle=t,this;},setClockwise:function(t){return this.clockwise=t,this;},setRotation:function(t){return this.rotation=t,this;},x:{get:function(){return this.p0.x;},set:function(t){this.p0.x=t;}},y:{get:function(){return this.p0.y;},set:function(t){this.p0.y=t;}},xRadius:{get:function(){return this._xRadius;},set:function(t){this._xRadius=t;}},yRadius:{get:function(){return this._yRadius;},set:function(t){this._yRadius=t;}},startAngle:{get:function(){return s(this._startAngle);},set:function(t){this._startAngle=l(t);}},endAngle:{get:function(){return s(this._endAngle);},set:function(t){this._endAngle=l(t);}},clockwise:{get:function(){return this._clockwise;},set:function(t){this._clockwise=t;}},angle:{get:function(){return s(this._rotation);},set:function(t){this._rotation=l(t);}},rotation:{get:function(){return this._rotation;},set:function(t){this._rotation=t;}},toJSON:function(){return{type:this.type,x:this.p0.x,y:this.p0.y,xRadius:this._xRadius,yRadius:this._yRadius,startAngle:s(this._startAngle),endAngle:s(this._endAngle),clockwise:this._clockwise,rotation:s(this._rotation)};}});r.fromJSON=function(t){return new r(t);},t.exports=r;},function(t,e,i){var n=i(0),s=i(94),r=i(199),o=i(10),a=i(3),h=new n({Extends:s,initialize:function(t,e){s.call(this,"LineCurve"),Array.isArray(t)&&(e=new a(t[2],t[3]),t=new a(t[0],t[1])),this.p0=t,this.p1=e,this.arcLengthDivisions=1;},getBounds:function(t){return void 0===t&&(t=new o()),r([this.p0,this.p1],t);},getStartPoint:function(t){return void 0===t&&(t=new a()),t.copy(this.p0);},getResolution:function(t){return void 0===t&&(t=1),t;},getPoint:function(t,e){return void 0===e&&(e=new a()),1===t?e.copy(this.p1):(e.copy(this.p1).subtract(this.p0).scale(t).add(this.p0),e);},getPointAt:function(t,e){return this.getPoint(t,e);},getTangent:function(t,e){return void 0===e&&(e=new a()),e.copy(this.p1).subtract(this.p0).normalize(),e;},getUtoTmapping:function(t,e,i){var n,s;return e?(s=(n=this.getLengths(i))[n.length-1],Math.min(e,s)/s):t;},draw:function(t){return t.lineBetween(this.p0.x,this.p0.y,this.p1.x,this.p1.y),t;},toJSON:function(){return{type:this.type,points:[this.p0.x,this.p0.y,this.p1.x,this.p1.y]};}});h.fromJSON=function(t){var e=t.points,i=new a(e[0],e[1]),n=new a(e[2],e[3]);return new h(i,n);},t.exports=h;},function(t,e,i){var n=i(0),s=i(3),r=new n({initialize:function(t,e){this.active=!1,this.p0=new s(t,e);},getPoint:function(t,e){return void 0===e&&(e=new s()),e.copy(this.p0);},getPointAt:function(t,e){return this.getPoint(t,e);},getResolution:function(){return 1;},getLength:function(){return 0;},toJSON:function(){return{type:"MoveTo",points:[this.p0.x,this.p0.y]};}});t.exports=r;},function(t,e,i){var n=i(0),s=i(94),r=i(359),o=i(3),a=new n({Extends:s,initialize:function(t,e,i){s.call(this,"QuadraticBezier"),Array.isArray(t)&&(i=new o(t[4],t[5]),e=new o(t[2],t[3]),t=new o(t[0],t[1])),this.p0=t,this.p1=e,this.p2=i;},getStartPoint:function(t){return void 0===t&&(t=new o()),t.copy(this.p0);},getResolution:function(t){return t;},getPoint:function(t,e){void 0===e&&(e=new o());var i=this.p0,n=this.p1,s=this.p2;return e.set(r(t,i.x,n.x,s.x),r(t,i.y,n.y,s.y));},draw:function(t,e){void 0===e&&(e=32);var i=this.getPoints(e);t.beginPath(),t.moveTo(this.p0.x,this.p0.y);for(var n=1;n<i.length;n++)t.lineTo(i[n].x,i[n].y);return t.strokePath(),t;},toJSON:function(){return{type:this.type,points:[this.p0.x,this.p0.y,this.p1.x,this.p1.y,this.p2.x,this.p2.y]};}});a.fromJSON=function(t){var e=t.points,i=new o(e[0],e[1]),n=new o(e[2],e[3]),s=new o(e[4],e[5]);return new a(i,n,s);},t.exports=a;},function(t,e,i){var l=i(194),n=i(0),s=i(94),c=i(3),r=new n({Extends:s,initialize:function(t){void 0===t&&(t=[]),s.call(this,"SplineCurve"),this.points=[],this.addPoints(t);},addPoints:function(t){for(var e=0;e<t.length;e++){var i=new c();"number"==typeof t[e]?(i.x=t[e],i.y=t[e+1],e++):Array.isArray(t[e])?(i.x=t[e][0],i.y=t[e][1]):(i.x=t[e].x,i.y=t[e].y),this.points.push(i);}return this;},addPoint:function(t,e){var i=new c(t,e);return this.points.push(i),i;},getStartPoint:function(t){return void 0===t&&(t=new c()),t.copy(this.points[0]);},getResolution:function(t){return t*this.points.length;},getPoint:function(t,e){void 0===e&&(e=new c());var i=this.points,n=(i.length-1)*t,s=Math.floor(n),r=n-s,o=i[0===s?s:s-1],a=i[s],h=i[s>i.length-2?i.length-1:s+1],u=i[s>i.length-3?i.length-1:s+2];return e.set(l(r,o.x,a.x,h.x,u.x),l(r,o.y,a.y,h.y,u.y));},toJSON:function(){for(var t=[],e=0;e<this.points.length;e++)t.push(this.points[e].x),t.push(this.points[e].y);return{type:this.type,points:t};}});r.fromJSON=function(t){return new r(t.points);},t.exports=r;},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n){e&&""!==e||(e=["precision mediump float;","uniform vec2 resolution;","varying vec2 fragCoord;","void main () {","    vec2 uv = fragCoord / resolution.xy;","    gl_FragColor = vec4(uv.xyx, 1.0);","}"].join("\n")),i&&""!==i||(i=["precision mediump float;","uniform mat4 uProjectionMatrix;","uniform mat4 uViewMatrix;","uniform vec2 uResolution;","attribute vec2 inPosition;","varying vec2 fragCoord;","varying vec2 outTexCoord;","void main () {","   gl_Position = uProjectionMatrix * uViewMatrix * vec4(inPosition, 1.0, 1.0);","   fragCoord = vec2(inPosition.x, uResolution.y - inPosition.y);","   outTexCoord = vec2(inPosition.x / uResolution.x, fragCoord.y / uResolution.y);","}"].join("\n")),void 0===n&&(n=null),this.key=t,this.fragmentSrc=e,this.vertexSrc=i,this.uniforms=n;}});t.exports=n;},function(t,e,i){var n=i(38);n.ColorSpectrum=i(909),n.ColorToRGBA=i(910),n.ComponentToHex=i(398),n.GetColor=i(103),n.GetColor32=i(328),n.HexStringToColor=i(327),n.HSLToColor=i(911),n.HSVColorWheel=i(912),n.HSVToRGB=i(188),n.HueToComponent=i(399),n.IntegerToColor=i(189),n.IntegerToRGB=i(330),n.Interpolate=i(913),n.ObjectToColor=i(331),n.RandomRGB=i(914),n.RGBStringToColor=i(332),n.RGBToHSV=i(329),n.RGBToString=i(915),n.ValueToColor=i(187),t.exports=n;},function(t,e){t.exports=function(t){var e=t.toString(16);return 1===e.length?"0"+e:e;};},function(t,e){t.exports=function(t,e,i){return i<0&&(i+=1),1<i&&--i,i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t;};},function(t,e,i){var n=i(105);t.exports=function(t){var e;"complete"!==document.readyState&&"interactive"!==document.readyState?(e=function(){document.removeEventListener("deviceready",e,!0),document.removeEventListener("DOMContentLoaded",e,!0),window.removeEventListener("load",e,!0),t();},document.body?n.cordova?document.addEventListener("deviceready",e,!1):(document.addEventListener("DOMContentLoaded",e,!0),window.addEventListener("load",e,!0)):window.setTimeout(e,20)):t();};},function(t,e){t.exports=function(t){if(!t)return window.innerHeight;var e=Math.abs(window.orientation),i={w:0,h:0},n=document.createElement("div");return n.setAttribute("style","position: fixed; height: 100vh; width: 0; top: 0"),document.documentElement.appendChild(n),i.w=90===e?n.offsetHeight:window.innerWidth,i.h=90===e?window.innerWidth:n.offsetHeight,document.documentElement.removeChild(n),n=null,90!==Math.abs(window.orientation)?i.h:i.w;};},function(t,e,i){var s=i(201);t.exports=function(t,e){var i=window.screen,n=!!i&&(i.orientation||i.mozOrientation||i.msOrientation);return n&&"string"==typeof n.type?n.type:"string"==typeof n?n:"number"==typeof window.orientation?0===window.orientation||180===window.orientation?s.ORIENTATION.PORTRAIT:s.ORIENTATION.LANDSCAPE:window.matchMedia?window.matchMedia("(orientation: portrait)").matches?s.ORIENTATION.PORTRAIT:window.matchMedia("(orientation: landscape)").matches?s.ORIENTATION.LANDSCAPE:void 0:t<e?s.ORIENTATION.PORTRAIT:s.ORIENTATION.LANDSCAPE;};},function(t,e){t.exports={NO_CENTER:0,CENTER_BOTH:1,CENTER_HORIZONTALLY:2,CENTER_VERTICALLY:3};},function(t,e){t.exports={LANDSCAPE:"landscape-primary",PORTRAIT:"portrait-primary"};},function(t,e){t.exports={NONE:0,WIDTH_CONTROLS_HEIGHT:1,HEIGHT_CONTROLS_WIDTH:2,FIT:3,ENVELOP:4,RESIZE:5};},function(t,e){t.exports={NO_ZOOM:1,ZOOM_2X:2,ZOOM_4X:4,MAX_ZOOM:-1};},function(t,e){t.exports=function(t){var e;return""!==t&&("string"==typeof t?e=document.getElementById(t):t&&1===t.nodeType&&(e=t)),e=e||document.body;};},function(t,e){t.exports=function(t){var e="";try{window.DOMParser?e=new DOMParser().parseFromString(t,"text/xml"):(e=new ActiveXObject("Microsoft.XMLDOM")).loadXML(t);}catch(t){e=null;}return e&&e.documentElement&&!e.getElementsByTagName("parsererror").length?e:null;};},function(t,e,i){var n=i(0),a=i(203),s=i(9),r=i(51),o=i(22),h=i(410),u=i(411),l=i(412),c=i(413),d=i(25),v=i(177),f=new n({initialize:function(t,e){this.game=t,this.scaleManager,this.canvas,this.config=e,this.enabled=!0,this.events=new s(),this.isOver=!0,this.defaultCursor="",this.keyboard=e.inputKeyboard?new h(this):null,this.mouse=e.inputMouse?new u(this):null,this.touch=e.inputTouch?new c(this):null,this.pointers=[],this.pointersTotal=e.inputActivePointers,e.inputTouch&&1===this.pointersTotal&&(this.pointersTotal=2);for(var i=0;i<=this.pointersTotal;i++){var n=new l(this,i);n.smoothFactor=e.inputSmoothFactor,this.pointers.push(n);}this.mousePointer=e.inputMouse?this.pointers[0]:null,this.activePointer=this.pointers[0],this.globalTopOnly=!0,this.time=0,this._tempPoint={x:0,y:0},this._tempHitTest=[],this._tempMatrix=new d(),this._tempMatrix2=new d(),this._tempSkip=!1,this.mousePointerContainer=[this.mousePointer],t.events.once(o.BOOT,this.boot,this);},boot:function(){this.canvas=this.game.canvas,this.scaleManager=this.game.scale,this.events.emit(r.MANAGER_BOOT),this.game.events.on(o.PRE_RENDER,this.preRender,this),this.game.events.once(o.DESTROY,this.destroy,this);},setCanvasOver:function(t){this.isOver=!0,this.events.emit(r.GAME_OVER,t);},setCanvasOut:function(t){this.isOver=!1,this.events.emit(r.GAME_OUT,t);},preRender:function(){var t=this.game.loop.now,e=this.game.loop.delta,i=this.game.scene.getScenes(!0,!0);this.time=t,this.events.emit(r.MANAGER_UPDATE);for(var n=0;n<i.length;n++){var s=i[n];if(s.sys.input&&s.sys.input.updatePoll(t,e)&&this.globalTopOnly)return;}},setDefaultCursor:function(t){this.defaultCursor=t,this.canvas.style.cursor!==t&&(this.canvas.style.cursor=t);},setCursor:function(t){t.cursor&&(this.canvas.style.cursor=t.cursor);},resetCursor:function(t){t.cursor&&this.canvas&&(this.canvas.style.cursor=this.defaultCursor);},addPointer:function(t){void 0===t&&(t=1);var e=[];10<this.pointersTotal+t&&(t=10-this.pointersTotal);for(var i=0;i<t;i++){var n=this.pointers.length,s=new l(this,n);s.smoothFactor=this.config.inputSmoothFactor,this.pointers.push(s),this.pointersTotal++,e.push(s);}return e;},updateInputPlugins:function(t,e){var i=this.game.scene.getScenes(!0,!0);this._tempSkip=!1;for(var n=0;n<i.length;n++){var s=i[n];if(s.sys.input)if(s.sys.input.update(t,e)&&this.globalTopOnly||this._tempSkip)return;}},onTouchStart:function(t){for(var e=this.pointers,i=[],n=0;n<t.changedTouches.length;n++)for(var s=t.changedTouches[n],r=1;r<this.pointersTotal;r++){var o=e[r];if(!o.active){o.touchstart(s,t),this.activePointer=o,i.push(o);break;}}this.updateInputPlugins(a.TOUCH_START,i);},onTouchMove:function(t){for(var e=this.pointers,i=[],n=0;n<t.changedTouches.length;n++)for(var s=t.changedTouches[n],r=1;r<this.pointersTotal;r++){var o=e[r];if(o.active&&o.identifier===s.identifier){o.touchmove(s,t),this.activePointer=o,i.push(o);break;}}this.updateInputPlugins(a.TOUCH_MOVE,i);},onTouchEnd:function(t){for(var e=this.pointers,i=[],n=0;n<t.changedTouches.length;n++)for(var s=t.changedTouches[n],r=1;r<this.pointersTotal;r++){var o=e[r];if(o.active&&o.identifier===s.identifier){o.touchend(s,t),i.push(o);break;}}this.updateInputPlugins(a.TOUCH_END,i);},onTouchCancel:function(t){for(var e=this.pointers,i=[],n=0;n<t.changedTouches.length;n++)for(var s=t.changedTouches[n],r=1;r<this.pointersTotal;r++){var o=e[r];if(o.active&&o.identifier===s.identifier){o.touchcancel(s,t),i.push(o);break;}}this.updateInputPlugins(a.TOUCH_CANCEL,i);},onMouseDown:function(t){var e=this.mousePointer;e.down(t),e.updateMotion(),this.activePointer=e,this.updateInputPlugins(a.MOUSE_DOWN,this.mousePointerContainer);},onMouseMove:function(t){var e=this.mousePointer;e.move(t),e.updateMotion(),this.activePointer=e,this.updateInputPlugins(a.MOUSE_MOVE,this.mousePointerContainer);},onMouseUp:function(t){var e=this.mousePointer;e.up(t),e.updateMotion(),this.activePointer=e,this.updateInputPlugins(a.MOUSE_UP,this.mousePointerContainer);},onMouseWheel:function(t){var e=this.mousePointer;e.wheel(t),this.activePointer=e,this.updateInputPlugins(a.MOUSE_WHEEL,this.mousePointerContainer);},onPointerLockChange:function(t){var e=this.mouse.locked;this.mousePointer.locked=e,this.events.emit(r.POINTERLOCK_CHANGE,t,e);},inputCandidate:function(t,e){var i=t.input;if(!i||!i.enabled||!i.alwaysEnabled&&!t.willRender(e))return!1;var n=!0,s=t.parentContainer;if(s)do{if(!s.willRender(e)){n=!1;break;}s=s.parentContainer;}while(s);return n;},hitTest:function(t,e,i,n){void 0===n&&(n=this._tempHitTest);var s=this._tempPoint,r=i.scrollX,o=i.scrollY;n.length=0;var a=t.x,h=t.y;i.getWorldPoint(a,h,s),t.worldX=s.x,t.worldY=s.y;for(var u={x:0,y:0},l=this._tempMatrix,c=this._tempMatrix2,d=0;d<e.length;d++){var f,p,g=e[d];this.inputCandidate(g,i)&&(f=s.x+r*g.scrollFactorX-r,p=s.y+o*g.scrollFactorY-o,g.parentContainer?(g.getWorldTransformMatrix(l,c),l.applyInverse(f,p,u)):v(f,p,g.x,g.y,g.rotation,g.scaleX,g.scaleY,u),this.pointWithinHitArea(g,u.x,u.y)&&n.push(g));}return n;},pointWithinHitArea:function(t,e,i){e+=t.displayOriginX,i+=t.displayOriginY;var n=t.input;return!(!n||!n.hitAreaCallback(n.hitArea,e,i,t))&&(n.localX=e,n.localY=i,!0);},pointWithinInteractiveObject:function(t,e,i){return!!t.hitArea&&(e+=t.gameObject.displayOriginX,i+=t.gameObject.displayOriginY,t.localX=e,t.localY=i,t.hitAreaCallback(t.hitArea,e,i,t));},transformPointer:function(t,e,i,n){var s=t.position,r=t.prevPosition;r.x=s.x,r.y=s.y;var o=this.scaleManager.transformX(e),a=this.scaleManager.transformY(i),h=t.smoothFactor;n&&0!==h?(s.x=o*h+r.x*(1-h),s.y=a*h+r.y*(1-h)):(s.x=o,s.y=a);},destroy:function(){this.events.removeAllListeners(),this.game.events.off(o.PRE_RENDER),this.keyboard&&this.keyboard.destroy(),this.mouse&&this.mouse.destroy(),this.touch&&this.touch.destroy();for(var t=0;t<this.pointers.length;t++)this.pointers[t].destroy();this.pointers=[],this._tempHitTest=[],this._tempMatrix.destroy(),this.canvas=null,this.game=null;}});t.exports=f;},function(t,e,i){var s=i(93),n=i(0),r=i(22),o=i(51),a=i(143),h=i(1),u=new n({initialize:function(t){this.manager=t,this.queue=[],this.preventDefault=!0,this.captures=[],this.enabled=!1,this.target,this.onKeyDown=h,this.onKeyUp=h,t.events.once(o.MANAGER_BOOT,this.boot,this);},boot:function(){var t=this.manager.config;this.enabled=t.inputKeyboard,this.target=t.inputKeyboardEventTarget,this.addCapture(t.inputKeyboardCapture),!this.target&&window&&(this.target=window),this.enabled&&this.target&&this.startListeners(),this.manager.game.events.on(r.POST_STEP,this.postUpdate,this);},startListeners:function(){var i=this;this.onKeyDown=function(t){var e;!t.defaultPrevented&&i.enabled&&i.manager&&(i.queue.push(t),i.manager.events.emit(o.MANAGER_PROCESS),e=t.altKey||t.ctrlKey||t.shiftKey||t.metaKey,i.preventDefault&&!e&&-1<i.captures.indexOf(t.keyCode)&&t.preventDefault());},this.onKeyUp=function(t){var e;!t.defaultPrevented&&i.enabled&&i.manager&&(i.queue.push(t),i.manager.events.emit(o.MANAGER_PROCESS),e=t.altKey||t.ctrlKey||t.shiftKey||t.metaKey,i.preventDefault&&!e&&-1<i.captures.indexOf(t.keyCode)&&t.preventDefault());};var t=this.target;t&&(t.addEventListener("keydown",this.onKeyDown,!1),t.addEventListener("keyup",this.onKeyUp,!1),this.enabled=!0);},stopListeners:function(){var t=this.target;t.removeEventListener("keydown",this.onKeyDown,!1),t.removeEventListener("keyup",this.onKeyUp,!1),this.enabled=!1;},postUpdate:function(){this.queue=[];},addCapture:function(t){"string"==typeof t&&(t=t.split(",")),Array.isArray(t)||(t=[t]);for(var e=this.captures,i=0;i<t.length;i++){var n=t[i];"string"==typeof n&&(n=a[n.trim().toUpperCase()]),-1===e.indexOf(n)&&e.push(n);}this.preventDefault=0<e.length;},removeCapture:function(t){"string"==typeof t&&(t=t.split(",")),Array.isArray(t)||(t=[t]);for(var e=this.captures,i=0;i<t.length;i++){var n=t[i];"string"==typeof n&&(n=a[n.toUpperCase()]),s(e,n);}this.preventDefault=0<e.length;},clearCaptures:function(){this.captures=[],this.preventDefault=!1;},destroy:function(){this.stopListeners(),this.clearCaptures(),this.queue=[],this.manager.game.events.off(r.POST_RENDER,this.postUpdate,this),this.target=null,this.enabled=!1,this.manager=null;}});t.exports=u;},function(t,e,i){var n=i(0),o=i(191),s=i(51),r=i(1),a=new n({initialize:function(t){this.manager=t,this.preventDefaultDown=!0,this.preventDefaultUp=!0,this.preventDefaultMove=!0,this.preventDefaultWheel=!1,this.enabled=!1,this.target,this.locked=!1,this.onMouseMove=r,this.onMouseDown=r,this.onMouseUp=r,this.onMouseDownWindow=r,this.onMouseUpWindow=r,this.onMouseOver=r,this.onMouseOut=r,this.onMouseWheel=r,this.pointerLockChange=r,this.isTop=!0,t.events.once(s.MANAGER_BOOT,this.boot,this);},boot:function(){var t=this.manager.config;this.enabled=t.inputMouse,this.target=t.inputMouseEventTarget,this.passive=t.inputMousePassive,this.preventDefaultDown=t.inputMousePreventDefaultDown,this.preventDefaultUp=t.inputMousePreventDefaultUp,this.preventDefaultMove=t.inputMousePreventDefaultMove,this.preventDefaultWheel=t.inputMousePreventDefaultWheel,this.target?"string"==typeof this.target&&(this.target=document.getElementById(this.target)):this.target=this.manager.game.canvas,t.disableContextMenu&&this.disableContextMenu(),this.enabled&&this.target&&this.startListeners();},disableContextMenu:function(){return document.body.addEventListener("contextmenu",function(t){return t.preventDefault(),!1;}),this;},requestPointerLock:function(){var t;o.pointerLock&&((t=this.target).requestPointerLock=t.requestPointerLock||t.mozRequestPointerLock||t.webkitRequestPointerLock,t.requestPointerLock());},releasePointerLock:function(){o.pointerLock&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock());},startListeners:function(){var t=this.target;if(t){var i=this,n=this.manager,e=n.canvas,s=window&&window.focus&&n.game.config.autoFocus;this.onMouseMove=function(t){!t.defaultPrevented&&i.enabled&&n&&n.enabled&&(n.onMouseMove(t),i.preventDefaultMove&&t.preventDefault());},this.onMouseDown=function(t){s&&window.focus(),!t.defaultPrevented&&i.enabled&&n&&n.enabled&&(n.onMouseDown(t),i.preventDefaultDown&&t.target===e&&t.preventDefault());},this.onMouseDownWindow=function(t){!t.defaultPrevented&&i.enabled&&n&&n.enabled&&t.target!==e&&n.onMouseDown(t);},this.onMouseUp=function(t){!t.defaultPrevented&&i.enabled&&n&&n.enabled&&(n.onMouseUp(t),i.preventDefaultUp&&t.target===e&&t.preventDefault());},this.onMouseUpWindow=function(t){!t.defaultPrevented&&i.enabled&&n&&n.enabled&&t.target!==e&&n.onMouseUp(t);},this.onMouseOver=function(t){!t.defaultPrevented&&i.enabled&&n&&n.enabled&&n.setCanvasOver(t);},this.onMouseOut=function(t){!t.defaultPrevented&&i.enabled&&n&&n.enabled&&n.setCanvasOut(t);},this.onMouseWheel=function(t){!t.defaultPrevented&&i.enabled&&n&&n.enabled&&n.onMouseWheel(t),i.preventDefaultWheel&&t.target===e&&t.preventDefault();};var r={passive:!0};if(t.addEventListener("mousemove",this.onMouseMove),t.addEventListener("mousedown",this.onMouseDown),t.addEventListener("mouseup",this.onMouseUp),t.addEventListener("mouseover",this.onMouseOver,r),t.addEventListener("mouseout",this.onMouseOut,r),this.preventDefaultWheel?t.addEventListener("wheel",this.onMouseWheel,{passive:!1}):t.addEventListener("wheel",this.onMouseWheel,r),window&&n.game.config.inputWindowEvents)try{window.top.addEventListener("mousedown",this.onMouseDownWindow,r),window.top.addEventListener("mouseup",this.onMouseUpWindow,r);}catch(t){window.addEventListener("mousedown",this.onMouseDownWindow,r),window.addEventListener("mouseup",this.onMouseUpWindow,r),this.isTop=!1;}o.pointerLock&&(this.pointerLockChange=function(t){var e=i.target;i.locked=document.pointerLockElement===e||document.mozPointerLockElement===e||document.webkitPointerLockElement===e,n.onPointerLockChange(t);},document.addEventListener("pointerlockchange",this.pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this.pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this.pointerLockChange,!0)),this.enabled=!0;}},stopListeners:function(){var t=this.target;t.removeEventListener("mousemove",this.onMouseMove),t.removeEventListener("mousedown",this.onMouseDown),t.removeEventListener("mouseup",this.onMouseUp),t.removeEventListener("mouseover",this.onMouseOver),t.removeEventListener("mouseout",this.onMouseOut),window&&((t=this.isTop?window.top:window).removeEventListener("mousedown",this.onMouseDownWindow),t.removeEventListener("mouseup",this.onMouseUpWindow)),o.pointerLock&&(document.removeEventListener("pointerlockchange",this.pointerLockChange,!0),document.removeEventListener("mozpointerlockchange",this.pointerLockChange,!0),document.removeEventListener("webkitpointerlockchange",this.pointerLockChange,!0));},destroy:function(){this.stopListeners(),this.target=null,this.enabled=!1,this.manager=null;}});t.exports=a;},function(t,e,i){var h=i(349),n=i(0),s=i(50),u=i(124),l=i(360),r=i(3),o=i(105),a=new n({initialize:function(t,e){this.manager=t,this.id=e,this.event,this.downElement,this.upElement,this.camera=null,this.button=0,this.buttons=0,this.position=new r(),this.prevPosition=new r(),this.midPoint=new r(-1,-1),this.velocity=new r(),this.angle=0,this.distance=0,this.smoothFactor=0,this.motionFactor=.2,this.worldX=0,this.worldY=0,this.moveTime=0,this.downX=0,this.downY=0,this.downTime=0,this.upX=0,this.upY=0,this.upTime=0,this.primaryDown=!1,this.isDown=!1,this.wasTouch=!1,this.wasCanceled=!1,this.movementX=0,this.movementY=0,this.identifier=0,this.pointerId=null,this.active=0===e,this.locked=!1,this.deltaX=0,this.deltaY=0,this.deltaZ=0;},updateWorldPoint:function(t){var e=t.getWorldPoint(this.x,this.y);return this.worldX=e.x,this.worldY=e.y,this;},positionToCamera:function(t,e){return t.getWorldPoint(this.x,this.y,e);},updateMotion:function(){var t,e,i,n,s=this.position.x,r=this.position.y,o=this.midPoint.x,a=this.midPoint.y;s===o&&r===a||(t=l(this.motionFactor,o,s),e=l(this.motionFactor,a,r),u(t,s,.1)&&(t=s),u(e,r,.1)&&(e=r),this.midPoint.set(t,e),i=s-t,n=r-e,this.velocity.set(i,n),this.angle=h(t,e,s,r),this.distance=Math.sqrt(i*i+n*n));},up:function(t){"buttons"in t&&(this.buttons=t.buttons),this.event=t,this.button=t.button,this.upElement=t.target,this.manager.transformPointer(this,t.pageX,t.pageY,!1),0===t.button&&(this.primaryDown=!1,this.upX=this.x,this.upY=this.y),0===this.buttons&&(this.isDown=!1,this.upTime=t.timeStamp,this.wasTouch=!1);},down:function(t){"buttons"in t&&(this.buttons=t.buttons),this.event=t,this.button=t.button,this.downElement=t.target,this.manager.transformPointer(this,t.pageX,t.pageY,!1),0===t.button&&(this.primaryDown=!0,this.downX=this.x,this.downY=this.y),o.macOS&&t.ctrlKey&&(this.buttons=2,this.primaryDown=!1),this.isDown||(this.isDown=!0,this.downTime=t.timeStamp),this.wasTouch=!1;},move:function(t){"buttons"in t&&(this.buttons=t.buttons),this.event=t,this.manager.transformPointer(this,t.pageX,t.pageY,!0),this.locked&&(this.movementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.movementY=t.movementY||t.mozMovementY||t.webkitMovementY||0),this.moveTime=t.timeStamp,this.wasTouch=!1;},wheel:function(t){"buttons"in t&&(this.buttons=t.buttons),this.event=t,this.manager.transformPointer(this,t.pageX,t.pageY,!1),this.deltaX=t.deltaX,this.deltaY=t.deltaY,this.deltaZ=t.deltaZ,this.wasTouch=!1;},touchstart:function(t,e){t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,this.active=!0,this.buttons=1,this.event=e,this.downElement=t.target,this.manager.transformPointer(this,t.pageX,t.pageY,!1),this.primaryDown=!0,this.downX=this.x,this.downY=this.y,this.downTime=e.timeStamp,this.isDown=!0,this.wasTouch=!0,this.wasCanceled=!1,this.updateMotion();},touchmove:function(t,e){this.event=e,this.manager.transformPointer(this,t.pageX,t.pageY,!0),this.moveTime=e.timeStamp,this.wasTouch=!0,this.updateMotion();},touchend:function(t,e){this.buttons=0,this.event=e,this.upElement=t.target,this.manager.transformPointer(this,t.pageX,t.pageY,!1),this.primaryDown=!1,this.upX=this.x,this.upY=this.y,this.upTime=e.timeStamp,this.isDown=!1,this.wasTouch=!0,this.wasCanceled=!1,this.active=!1,this.updateMotion();},touchcancel:function(t,e){this.buttons=0,this.event=e,this.upElement=t.target,this.manager.transformPointer(this,t.pageX,t.pageY,!1),this.primaryDown=!1,this.upX=this.x,this.upY=this.y,this.upTime=e.timeStamp,this.isDown=!1,this.wasTouch=!0,this.wasCanceled=!0,this.active=!1;},noButtonDown:function(){return 0===this.buttons;},leftButtonDown:function(){return!!(1&this.buttons);},rightButtonDown:function(){return!!(2&this.buttons);},middleButtonDown:function(){return!!(4&this.buttons);},backButtonDown:function(){return!!(8&this.buttons);},forwardButtonDown:function(){return!!(16&this.buttons);},leftButtonReleased:function(){return 0===this.button&&!this.isDown;},rightButtonReleased:function(){return 2===this.button&&!this.isDown;},middleButtonReleased:function(){return 1===this.button&&!this.isDown;},backButtonReleased:function(){return 3===this.button&&!this.isDown;},forwardButtonReleased:function(){return 4===this.button&&!this.isDown;},getDistance:function(){return this.isDown?s(this.downX,this.downY,this.x,this.y):s(this.downX,this.downY,this.upX,this.upY);},getDistanceX:function(){return this.isDown?Math.abs(this.downX-this.x):Math.abs(this.downX-this.upX);},getDistanceY:function(){return this.isDown?Math.abs(this.downY-this.y):Math.abs(this.downY-this.upY);},getDuration:function(){return this.isDown?this.manager.time-this.downTime:this.upTime-this.downTime;},getAngle:function(){return this.isDown?h(this.downX,this.downY,this.x,this.y):h(this.downX,this.downY,this.upX,this.upY);},getInterpolatedPosition:function(t,e){void 0===t&&(t=10),void 0===e&&(e=[]);for(var i=this.prevPosition.x,n=this.prevPosition.y,s=this.position.x,r=this.position.y,o=0;o<t;o++){var a=1/t*o;e[o]={x:l(a,i,s),y:l(a,n,r)};}return e;},destroy:function(){this.camera=null,this.manager=null,this.position=null;},x:{get:function(){return this.position.x;},set:function(t){this.position.x=t;}},y:{get:function(){return this.position.y;},set:function(t){this.position.y=t;}},time:{get:function(){return this.event?this.event.timeStamp:0;}}});t.exports=a;},function(t,e,i){var n=i(0),s=i(51),r=i(1),o=new n({initialize:function(t){this.manager=t,this.capture=!0,this.enabled=!1,this.target,this.onTouchStart=r,this.onTouchStartWindow=r,this.onTouchMove=r,this.onTouchEnd=r,this.onTouchEndWindow=r,this.onTouchCancel=r,this.onTouchCancelWindow=r,this.onTouchOver=r,this.onTouchOut=r,t.events.once(s.MANAGER_BOOT,this.boot,this);},boot:function(){var t=this.manager.config;this.enabled=t.inputTouch,this.target=t.inputTouchEventTarget,this.capture=t.inputTouchCapture,this.target||(this.target=this.manager.game.canvas),t.disableContextMenu&&this.disableContextMenu(),this.enabled&&this.target&&this.startListeners();},disableContextMenu:function(){return document.body.addEventListener("contextmenu",function(t){return t.preventDefault(),!1;}),this;},startListeners:function(){var e=this,i=this.manager.canvas,n=window&&window.focus&&this.manager.game.config.autoFocus;this.onTouchStart=function(t){n&&window.focus(),!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&(e.manager.onTouchStart(t),e.capture&&t.cancelable&&t.target===i&&t.preventDefault());},this.onTouchStartWindow=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&t.target!==i&&e.manager.onTouchStart(t);},this.onTouchMove=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&(e.manager.onTouchMove(t),e.capture&&t.cancelable&&t.preventDefault());},this.onTouchEnd=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&(e.manager.onTouchEnd(t),e.capture&&t.cancelable&&t.target===i&&t.preventDefault());},this.onTouchEndWindow=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&t.target!==i&&e.manager.onTouchEnd(t);},this.onTouchCancel=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&(e.manager.onTouchCancel(t),e.capture&&t.preventDefault());},this.onTouchCancelWindow=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&e.manager.onTouchCancel(t);},this.onTouchOver=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&e.manager.setCanvasOver(t);},this.onTouchOut=function(t){!t.defaultPrevented&&e.enabled&&e.manager&&e.manager.enabled&&e.manager.setCanvasOut(t);};var t,s,r=this.target;r&&(s={passive:!(t={passive:!0})},r.addEventListener("touchstart",this.onTouchStart,this.capture?s:t),r.addEventListener("touchmove",this.onTouchMove,this.capture?s:t),r.addEventListener("touchend",this.onTouchEnd,this.capture?s:t),r.addEventListener("touchcancel",this.onTouchCancel,this.capture?s:t),r.addEventListener("touchover",this.onTouchOver,this.capture?s:t),r.addEventListener("touchout",this.onTouchOut,this.capture?s:t),window&&this.manager.game.config.inputWindowEvents&&(window.addEventListener("touchstart",this.onTouchStartWindow,s),window.addEventListener("touchend",this.onTouchEndWindow,s),window.addEventListener("touchcancel",this.onTouchCancelWindow,s)),this.enabled=!0);},stopListeners:function(){var t=this.target;t.removeEventListener("touchstart",this.onTouchStart),t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("touchcancel",this.onTouchCancel),t.removeEventListener("touchover",this.onTouchOver),t.removeEventListener("touchout",this.onTouchOut),window&&(window.removeEventListener("touchstart",this.onTouchStartWindow),window.removeEventListener("touchend",this.onTouchEndWindow));},destroy:function(){this.stopListeners(),this.target=null,this.enabled=!1,this.manager=null;}});t.exports=o;},function(t,e,i){var n=i(0),u=i(22),s=i(9),r=i(8),o=i(16),a=i(5),l=i(2),g=i(24),h=i(93),c=new n({Extends:s,initialize:function(t){s.call(this),this.game=t,this.plugins=[],this.scenePlugins=[],this._pendingGlobal=[],this._pendingScene=[],t.isBooted?this.boot():t.events.once(u.BOOT,this.boot,this);},boot:function(){for(var t,e,i,n,s,r,o=this.game.config,a=(a=o.installGlobalPlugins).concat(this._pendingGlobal),h=0;h<a.length;h++)t=a[h],e=l(t,"key",null),i=l(t,"plugin",null),n=l(t,"start",!1),s=l(t,"mapping",null),r=l(t,"data",null),e&&(i?this.install(e,i,n,s,r):console.warn("Missing `plugin` for key: "+e));for(a=(a=o.installScenePlugins).concat(this._pendingScene),h=0;h<a.length;h++)t=a[h],e=l(t,"key",null),i=l(t,"plugin",null),s=l(t,"mapping",null),e&&(i?this.installScenePlugin(e,i,s):console.warn("Missing `plugin` for key: "+e));this._pendingGlobal=[],this._pendingScene=[],this.game.events.once(u.DESTROY,this.destroy,this);},addToScene:function(t,e,i){for(var n,s=this.game,r=t.scene,o=t.settings.map,a=t.settings.isBooted,h=0;h<e.length;h++)s[f=e[h]]?(t[f]=s[f],o.hasOwnProperty(f)&&(r[o[f]]=t[f])):"game"===f&&o.hasOwnProperty(f)&&(r[o[f]]=s);for(var u=0;u<i.length;u++)for(n=i[u],h=0;h<n.length;h++){var l,c,d,f=n[h];g.hasCore(f)&&(c=(l=g.getCore(f)).mapping,d=new l.plugin(r,this,c),t[c]=d,l.custom?r[c]=d:o.hasOwnProperty(c)&&(r[o[c]]=d),a&&d.boot());}for(n=this.plugins,h=0;h<n.length;h++){var p=n[h];p.mapping&&(r[p.mapping]=p.plugin);}},getDefaultScenePlugins:function(){return this.game.config.defaultPlugins.concat(this.scenePlugins);},installScenePlugin:function(t,e,i,n,s){if(void 0===s&&(s=!1),"function"==typeof e){if(g.hasCore(t)){if(!s&&g.hasCore(t))return void console.warn("Scene Plugin key in use: "+t);}else g.register(t,e,i,!0),this.scenePlugins.push(t);var r;n&&(r=new e(n,this,t),n.sys[t]=r,i&&""!==i&&(n[i]=r),r.boot());}else console.warn("Invalid Scene Plugin: "+t);},install:function(t,e,i,n,s){if(void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=null),"function"!=typeof e)return console.warn("Invalid Plugin: "+t),null;if(g.hasCustom(t))return console.warn("Plugin key in use: "+t),null;if(null!==n&&(i=!0),this.game.isBooted){if(g.registerCustom(t,e,n,s),i)return this.start(t);}else this._pendingGlobal.push({key:t,plugin:e,start:i,mapping:n,data:s});return null;},getIndex:function(t){for(var e=this.plugins,i=0;i<e.length;i++){if(e[i].key===t)return i;}return-1;},getEntry:function(t){var e=this.getIndex(t);if(-1!==e)return this.plugins[e];},isActive:function(t){var e=this.getEntry(t);return e&&e.active;},start:function(t,e){void 0===e&&(e=t);var i=this.getEntry(e);return i&&!i.active?(i.active=!0,i.plugin.start()):i=i||this.createEntry(t,e),i?i.plugin:null;},createEntry:function(t,e){var i,n=g.getCustom(t);return n&&(n={key:e,plugin:i=new n.plugin(this),active:!0,mapping:n.mapping,data:n.data},this.plugins.push(n),i.init(n.data),i.start()),n;},stop:function(t){var e=this.getEntry(t);return e&&e.active&&(e.active=!1,e.plugin.stop()),this;},get:function(t,e){void 0===e&&(e=!0);var i=this.getEntry(t);if(i)return i.plugin;var n=this.getClass(t);return n&&e?(i=this.createEntry(t,t))?i.plugin:null:n||null;},getClass:function(t){return g.getCustomClass(t);},removeGlobalPlugin:function(t){var e=this.getEntry(t);e&&h(this.plugins,e),g.removeCustom(t);},removeScenePlugin:function(t){h(this.scenePlugins,t),g.remove(t);},registerGameObject:function(t,e,i){return e&&a.register(t,e),i&&o.register(t,i),this;},removeGameObject:function(t,e,i){return void 0===e&&(e=!0),void 0===i&&(i=!0),e&&a.remove(t),i&&o.remove(t),this;},registerFileType:function(t,e,i){r.register(t,e),i&&i.sys.load&&(i.sys.load[t]=e);},destroy:function(){for(var t=0;t<this.plugins.length;t++)this.plugins[t].plugin.destroy();g.destroyCustomPlugins(),this.game.noReturn&&g.destroyCorePlugins(),this.game=null,this.plugins=[],this.scenePlugins=[];}});t.exports=c;},function(t,e,i){var l=i(201),n=i(0),s=i(9),r=i(104),o=i(22),a=i(401),h=i(407),c=i(402),u=i(1),d=i(10),f=i(416),p=i(76),g=i(3),v=new n({Extends:s,initialize:function(t){s.call(this),this.game=t,this.canvas,this.canvasBounds=new d(),this.parent=null,this.parentIsWindow=!1,this.parentSize=new f(),this.gameSize=new f(),this.baseSize=new f(),this.displaySize=new f(),this.scaleMode=l.SCALE_MODE.NONE,this.zoom=1,this._resetZoom=!1,this.displayScale=new g(1,1),this.autoRound=!1,this.autoCenter=l.CENTER.NO_CENTER,this.orientation=l.ORIENTATION.LANDSCAPE,this.fullscreen,this.fullscreenTarget=null,this._createdFullscreenTarget=!1,this.dirty=!1,this.resizeInterval=500,this._lastCheck=0,this._checkOrientation=!1,this.listeners={orientationChange:u,windowResize:u,fullScreenChange:u,fullScreenError:u};},preBoot:function(){this.parseConfig(this.game.config),this.game.events.once(o.BOOT,this.boot,this);},boot:function(){var t=this.game;this.canvas=t.canvas,this.fullscreen=t.device.fullscreen,this.scaleMode!==l.SCALE_MODE.RESIZE&&this.displaySize.setAspectMode(this.scaleMode),this.scaleMode===l.SCALE_MODE.NONE?this.resize(this.width,this.height):(this.getParentBounds(),0<this.parentSize.width&&0<this.parentSize.height&&this.displaySize.setParent(this.parentSize),this.refresh()),t.events.on(o.PRE_STEP,this.step,this),t.events.once(o.READY,this.refresh,this),t.events.once(o.DESTROY,this.destroy,this),this.startListeners();},parseConfig:function(t){this.getParent(t),this.getParentBounds();var e,i,n,s,r=t.width,o=t.height,a=t.scaleMode,h=t.zoom,u=t.autoRound;"string"==typeof r&&(0===(e=this.parentSize.width)&&(e=window.innerWidth),i=parseInt(r,10)/100,r=Math.floor(e*i)),"string"==typeof o&&(0===(n=this.parentSize.height)&&(n=window.innerHeight),s=parseInt(o,10)/100,o=Math.floor(n*s)),this.scaleMode=a,this.autoRound=u,this.autoCenter=t.autoCenter,this.resizeInterval=t.resizeInterval,u&&(r=Math.floor(r),o=Math.floor(o)),this.gameSize.setSize(r,o),h===l.ZOOM.MAX_ZOOM&&(h=this.getMaxZoom()),1!==(this.zoom=h)&&(this._resetZoom=!0),this.baseSize.setSize(r,o),u&&(this.baseSize.width=Math.floor(this.baseSize.width),this.baseSize.height=Math.floor(this.baseSize.height)),0<t.minWidth&&this.displaySize.setMin(t.minWidth*h,t.minHeight*h),0<t.maxWidth&&this.displaySize.setMax(t.maxWidth*h,t.maxHeight*h),this.displaySize.setSize(r,o),this.orientation=c(r,o);},getParent:function(t){var e,i=t.parent;null!==i&&(this.parent=h(i),this.parentIsWindow=this.parent===document.body,t.expandParent&&t.scaleMode!==l.SCALE_MODE.NONE&&(e=this.parent.getBoundingClientRect(),!this.parentIsWindow&&0!==e.height||(document.documentElement.style.height="100%",document.body.style.height="100%",e=this.parent.getBoundingClientRect(),this.parentIsWindow||0!==e.height||(this.parent.style.overflow="hidden",this.parent.style.width="100%",this.parent.style.height="100%"))),t.fullscreenTarget&&!this.fullscreenTarget&&(this.fullscreenTarget=h(t.fullscreenTarget)));},getParentBounds:function(){if(!this.parent)return!1;var t=this.parentSize,e=this.parent.getBoundingClientRect();this.parentIsWindow&&this.game.device.os.iOS&&(e.height=a(!0));var i=e.width,n=e.height;return(t.width!==i||t.height!==n)&&(t.setSize(i,n),!0);},lockOrientation:function(t){var e=screen.lockOrientation||screen.mozLockOrientation||screen.msLockOrientation;return!!e&&e.call(screen,t);},setParentSize:function(t,e){return this.parentSize.setSize(t,e),this.refresh();},setGameSize:function(t,e){var i=this.autoRound;i&&(t=Math.floor(t),e=Math.floor(e));var n=this.width,s=this.height;return this.gameSize.resize(t,e),this.baseSize.resize(t,e),i&&(this.baseSize.width=Math.floor(this.baseSize.width),this.baseSize.height=Math.floor(this.baseSize.height)),this.displaySize.setAspectRatio(t/e),this.canvas.width=this.baseSize.width,this.canvas.height=this.baseSize.height,this.refresh(n,s);},resize:function(t,e){var i=this.zoom,n=this.autoRound;n&&(t=Math.floor(t),e=Math.floor(e));var s=this.width,r=this.height;this.gameSize.resize(t,e),this.baseSize.resize(t,e),n&&(this.baseSize.width=Math.floor(this.baseSize.width),this.baseSize.height=Math.floor(this.baseSize.height)),this.displaySize.setSize(t*i,e*i),this.canvas.width=this.baseSize.width,this.canvas.height=this.baseSize.height;var o=this.canvas.style,a=t*i,h=e*i;return n&&(a=Math.floor(a),h=Math.floor(h)),a===t&&h===e||(o.width=a+"px",o.height=h+"px"),this.refresh(s,r);},setZoom:function(t){return this.zoom=t,this._resetZoom=!0,this.refresh();},setMaxZoom:function(){return this.zoom=this.getMaxZoom(),this._resetZoom=!0,this.refresh();},refresh:function(t,e){void 0===t&&(t=this.width),void 0===e&&(e=this.height),this.updateScale(),this.updateBounds(),this.updateOrientation(),this.displayScale.set(this.baseSize.width/this.canvasBounds.width,this.baseSize.height/this.canvasBounds.height);var i,n,s=this.game.domContainer;return s&&(this.baseSize.setCSS(s),i=this.canvas.style,(n=s.style).transform="scale("+this.displaySize.width/this.baseSize.width+","+this.displaySize.height/this.baseSize.height+")",n.marginLeft=i.marginLeft,n.marginTop=i.marginTop),this.emit(r.RESIZE,this.gameSize,this.baseSize,this.displaySize,t,e),this;},updateOrientation:function(){var t;this._checkOrientation&&(this._checkOrientation=!1,(t=c(this.width,this.height))!==this.orientation&&(this.orientation=t,this.emit(r.ORIENTATION_CHANGE,t)));},updateScale:function(){var t,e,i=this.canvas.style,n=this.gameSize.width,s=this.gameSize.height,r=this.zoom,o=this.autoRound;this.scaleMode===l.SCALE_MODE.NONE?(this.displaySize.setSize(n*r,s*r),t=this.displaySize.width,e=this.displaySize.height,o&&(t=Math.floor(t),e=Math.floor(e)),this._resetZoom&&(i.width=t+"px",i.height=e+"px",this._resetZoom=!1)):this.scaleMode===l.SCALE_MODE.RESIZE?(this.displaySize.setSize(this.parentSize.width,this.parentSize.height),this.gameSize.setSize(this.displaySize.width,this.displaySize.height),this.baseSize.setSize(this.displaySize.width,this.displaySize.height),t=this.displaySize.width,e=this.displaySize.height,o&&(t=Math.floor(t),e=Math.floor(e)),this.canvas.width=t,this.canvas.height=e):(this.displaySize.setSize(this.parentSize.width,this.parentSize.height),t=this.displaySize.width,e=this.displaySize.height,o&&(t=Math.floor(t),e=Math.floor(e)),i.width=t+"px",i.height=e+"px"),this.getParentBounds(),this.updateCenter();},getMaxZoom:function(){var t=p(this.parentSize.width,this.gameSize.width,0,!0),e=p(this.parentSize.height,this.gameSize.height,0,!0);return Math.max(Math.min(t,e),1);},updateCenter:function(){var t,e,i,n,s,r,o,a=this.autoCenter;a!==l.CENTER.NO_CENTER&&(e=(t=this.canvas).style,n=(i=t.getBoundingClientRect()).width,s=i.height,r=Math.floor((this.parentSize.width-n)/2),o=Math.floor((this.parentSize.height-s)/2),a===l.CENTER.CENTER_HORIZONTALLY?o=0:a===l.CENTER.CENTER_VERTICALLY&&(r=0),e.marginLeft=r+"px",e.marginTop=o+"px");},updateBounds:function(){var t=this.canvasBounds,e=this.canvas.getBoundingClientRect();t.x=e.left+(window.pageXOffset||0)-(document.documentElement.clientLeft||0),t.y=e.top+(window.pageYOffset||0)-(document.documentElement.clientTop||0),t.width=e.width,t.height=e.height;},transformX:function(t){return(t-this.canvasBounds.left)*this.displayScale.x;},transformY:function(t){return(t-this.canvasBounds.top)*this.displayScale.y;},startFullscreen:function(t){void 0===t&&(t={navigationUI:"hide"});var e,i=this.fullscreen;i.available?i.active||(e=this.getFullscreenTarget(),i.keyboard?e[i.request](Element.ALLOW_KEYBOARD_INPUT):e[i.request](t)):this.emit(r.FULLSCREEN_UNSUPPORTED);},fullscreenSuccessHandler:function(){this.getParentBounds(),this.refresh(),this.emit(r.ENTER_FULLSCREEN);},fullscreenErrorHandler:function(t){this.removeFullscreenTarget(),this.emit(r.FULLSCREEN_FAILED,t);},getFullscreenTarget:function(){var t;return this.fullscreenTarget||((t=document.createElement("div")).style.margin="0",t.style.padding="0",t.style.width="100%",t.style.height="100%",this.fullscreenTarget=t,this._createdFullscreenTarget=!0),this._createdFullscreenTarget&&(this.canvas.parentNode.insertBefore(this.fullscreenTarget,this.canvas),this.fullscreenTarget.appendChild(this.canvas)),this.fullscreenTarget;},removeFullscreenTarget:function(){var t,e;!this._createdFullscreenTarget||(t=this.fullscreenTarget)&&t.parentNode&&((e=t.parentNode).insertBefore(this.canvas,t),e.removeChild(t));},stopFullscreen:function(){var t=this.fullscreen;if(!t.available)return this.emit(r.FULLSCREEN_UNSUPPORTED),!1;t.active&&document[t.cancel](),this.removeFullscreenTarget(),this.getParentBounds(),this.emit(r.LEAVE_FULLSCREEN),this.refresh();},toggleFullscreen:function(t){this.fullscreen.active?this.stopFullscreen():this.startFullscreen(t);},startListeners:function(){var e=this,i=this.listeners;i.orientationChange=function(){e.updateBounds(),e._checkOrientation=!0,e.dirty=!0;},i.windowResize=function(){e.updateBounds(),e.dirty=!0;},window.addEventListener("orientationchange",i.orientationChange,!1),window.addEventListener("resize",i.windowResize,!1),this.fullscreen.available&&(i.fullScreenChange=function(t){return e.onFullScreenChange(t);},i.fullScreenError=function(t){return e.onFullScreenError(t);},["webkit","moz",""].forEach(function(t){document.addEventListener(t+"fullscreenchange",i.fullScreenChange,!1),document.addEventListener(t+"fullscreenerror",i.fullScreenError,!1);}),document.addEventListener("MSFullscreenChange",i.fullScreenChange,!1),document.addEventListener("MSFullscreenError",i.fullScreenError,!1));},onFullScreenChange:function(){document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||document.mozFullScreenElement?this.fullscreenSuccessHandler():this.stopFullscreen();},onFullScreenError:function(){this.removeFullscreenTarget();},step:function(t,e){this.parent&&(this._lastCheck+=e,(this.dirty||this._lastCheck>this.resizeInterval)&&(this.getParentBounds()&&this.refresh(),this.dirty=!1,this._lastCheck=0));},stopListeners:function(){var e=this.listeners;window.removeEventListener("orientationchange",e.orientationChange,!1),window.removeEventListener("resize",e.windowResize,!1);["webkit","moz",""].forEach(function(t){document.removeEventListener(t+"fullscreenchange",e.fullScreenChange,!1),document.removeEventListener(t+"fullscreenerror",e.fullScreenError,!1);}),document.removeEventListener("MSFullscreenChange",e.fullScreenChange,!1),document.removeEventListener("MSFullscreenError",e.fullScreenError,!1);},destroy:function(){this.removeAllListeners(),this.stopListeners(),this.game=null,this.canvas=null,this.canvasBounds=null,this.parent=null,this.fullscreenTarget=null,this.parentSize.destroy(),this.gameSize.destroy(),this.baseSize.destroy(),this.displaySize.destroy();},isFullscreen:{get:function(){return this.fullscreen.active;}},width:{get:function(){return this.gameSize.width;}},height:{get:function(){return this.gameSize.height;}},isPortrait:{get:function(){return this.orientation===l.ORIENTATION.PORTRAIT;}},isLandscape:{get:function(){return this.orientation===l.ORIENTATION.LANDSCAPE;}},isGamePortrait:{get:function(){return this.height>this.width;}},isGameLandscape:{get:function(){return this.width>this.height;}}});t.exports=v;},function(t,e,i){var n=i(18),s=i(0),r=i(76),o=i(3),a=new s({initialize:function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=0),void 0===n&&(n=null),this._width=t,this._height=e,this._parent=n,this.aspectMode=i,this.aspectRatio=0===e?1:t/e,this.minWidth=0,this.minHeight=0,this.maxWidth=Number.MAX_VALUE,this.maxHeight=Number.MAX_VALUE,this.snapTo=new o();},setAspectMode:function(t){return void 0===t&&(t=0),this.aspectMode=t,this.setSize(this._width,this._height);},setSnap:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.snapTo.set(t,e),this.setSize(this._width,this._height);},setParent:function(t){return this._parent=t,this.setSize(this._width,this._height);},setMin:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.minWidth=n(t,0,this.maxWidth),this.minHeight=n(e,0,this.maxHeight),this.setSize(this._width,this._height);},setMax:function(t,e){return void 0===t&&(t=Number.MAX_VALUE),void 0===e&&(e=t),this.maxWidth=n(t,this.minWidth,Number.MAX_VALUE),this.maxHeight=n(e,this.minHeight,Number.MAX_VALUE),this.setSize(this._width,this._height);},setSize:function(t,e){switch(void 0===t&&(t=0),void 0===e&&(e=t),this.aspectMode){case a.NONE:this._width=this.getNewWidth(r(t,this.snapTo.x)),this._height=this.getNewHeight(r(e,this.snapTo.y)),this.aspectRatio=0===this._height?1:this._width/this._height;break;case a.WIDTH_CONTROLS_HEIGHT:this._width=this.getNewWidth(r(t,this.snapTo.x)),this._height=this.getNewHeight(this._width*(1/this.aspectRatio),!1);break;case a.HEIGHT_CONTROLS_WIDTH:this._height=this.getNewHeight(r(e,this.snapTo.y)),this._width=this.getNewWidth(this._height*this.aspectRatio,!1);break;case a.FIT:this.constrain(t,e,!0);break;case a.ENVELOP:this.constrain(t,e,!1);}return this;},setAspectRatio:function(t){return this.aspectRatio=t,this.setSize(this._width,this._height);},resize:function(t,e){return this._width=this.getNewWidth(r(t,this.snapTo.x)),this._height=this.getNewHeight(r(e,this.snapTo.y)),this.aspectRatio=0===this._height?1:this._width/this._height,this;},getNewWidth:function(t,e){return void 0===e&&(e=!0),t=n(t,this.minWidth,this.maxWidth),e&&this._parent&&t>this._parent.width&&(t=Math.max(this.minWidth,this._parent.width)),t;},getNewHeight:function(t,e){return void 0===e&&(e=!0),t=n(t,this.minHeight,this.maxHeight),e&&this._parent&&t>this._parent.height&&(t=Math.max(this.minHeight,this._parent.height)),t;},constrain:function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=t),void 0===i&&(i=!0),t=this.getNewWidth(t),e=this.getNewHeight(e);var n=this.snapTo,s=0===e?1:t/e;return i&&this.aspectRatio>s||!i&&this.aspectRatio<s?(e=(t=r(t,n.x))/this.aspectRatio,0<n.y&&(t=(e=r(e,n.y))*this.aspectRatio)):(i&&this.aspectRatio<s||!i&&this.aspectRatio>s)&&(t=(e=r(e,n.y))*this.aspectRatio,0<n.x&&(e=(t=r(t,n.x))*(1/this.aspectRatio))),this._width=t,this._height=e,this;},fitTo:function(t,e){return this.constrain(t,e,!0);},envelop:function(t,e){return this.constrain(t,e,!1);},setWidth:function(t){return this.setSize(t,this._height);},setHeight:function(t){return this.setSize(this._width,t);},toString:function(){return"[{ Size (width="+this._width+" height="+this._height+" aspectRatio="+this.aspectRatio+" aspectMode="+this.aspectMode+") }]";},setCSS:function(t){t&&t.style&&(t.style.width=this._width+"px",t.style.height=this._height+"px");},copy:function(t){return t.setAspectMode(this.aspectMode),t.aspectRatio=this.aspectRatio,t.setSize(this.width,this.height);},destroy:function(){this._parent=null,this.snapTo=null;},width:{get:function(){return this._width;},set:function(t){this.setSize(t,this._height);}},height:{get:function(){return this._height;},set:function(t){this.setSize(this._width,t);}}});a.NONE=0,a.WIDTH_CONTROLS_HEIGHT=1,a.HEIGHT_CONTROLS_WIDTH=2,a.FIT=3,a.ENVELOP=4,t.exports=a;},function(t,e,i){var n=i(0),r=i(144),s=i(20),o=i(22),u=i(6),a=i(95),h=i(1),l=i(418),c=i(204),d=new n({initialize:function(t,e){if(this.game=t,this.keys={},this.scenes=[],this._pending=[],this._start=[],this._queue=[],this._data={},this.isProcessing=!1,this.isBooted=!1,this.customViewports=0,e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++)this._pending.push({key:"default",scene:e[i],autoStart:0===i,data:{}});}t.events.once(o.READY,this.bootQueue,this);},bootQueue:function(){if(!this.isBooted){for(var t=0;t<this._pending.length;t++){var e,i,n,s=(i=this._pending[t]).key;(n=i.scene)instanceof l?e=this.createSceneFromInstance(s,n):"object"==typeof n?e=this.createSceneFromObject(s,n):"function"==typeof n&&(e=this.createSceneFromFunction(s,n)),s=e.sys.settings.key,this.keys[s]=e,this.scenes.push(e),this._data[s]&&(e.sys.settings.data=this._data[s].data,this._data[s].autoStart&&(i.autoStart=!0)),(i.autoStart||e.sys.settings.active)&&this._start.push(s);}for(this._pending.length=0,this._data={},this.isBooted=!0,t=0;t<this._start.length;t++)i=this._start[t],this.start(i);this._start.length=0;}},processQueue:function(){var t,e,i=this._pending.length,n=this._queue.length;if(0!==i||0!==n){if(i){for(t=0;t<i;t++)e=this._pending[t],this.add(e.key,e.scene,e.autoStart,e.data);for(t=0;t<this._start.length;t++)e=this._start[t],this.start(e);return this._start.length=0,void(this._pending.length=0);}for(t=0;t<this._queue.length;t++)this[(e=this._queue[t]).op](e.keyA,e.keyB);this._queue.length=0;}},add:function(t,e,i,n){return void 0===i&&(i=!1),void 0===n&&(n={}),this.isProcessing||!this.isBooted?(this._pending.push({key:t,scene:e,autoStart:i,data:n}),this.isBooted||(this._data[t]={data:n}),null):(t=this.getKey(t,e),e instanceof l?s=this.createSceneFromInstance(t,e):"object"==typeof e?(e.key=t,s=this.createSceneFromObject(t,e)):"function"==typeof e&&(s=this.createSceneFromFunction(t,e)),s.sys.settings.data=n,t=s.sys.settings.key,this.keys[t]=s,this.scenes.push(s),(i||s.sys.settings.active)&&(this._pending.length?this._start.push(t):this.start(t)),s);var s;},remove:function(t){if(this.isProcessing)this._queue.push({op:"remove",keyA:t,keyB:null});else{var e=this.getScene(t);if(!e||e.sys.isTransitioning())return this;var i=this.scenes.indexOf(e),n=e.sys.settings.key;-1<i&&(delete this.keys[n],this.scenes.splice(i,1),-1<this._start.indexOf(n)&&(i=this._start.indexOf(n),this._start.splice(i,1)),e.sys.destroy());}return this;},bootScene:function(t){var e,i=t.sys,n=i.settings;i.sceneUpdate=h,t.init&&(t.init.call(t,n.data),n.status=r.INIT,n.isTransition&&i.events.emit(s.TRANSITION_INIT,n.transitionFrom,n.transitionDuration)),i.load&&(e=i.load).reset(),e&&t.preload?(t.preload.call(t),0===e.list.size?this.create(t):(n.status=r.LOADING,e.once(a.COMPLETE,this.loadComplete,this),e.start())):this.create(t);},loadComplete:function(t){this.create(t.scene);},payloadComplete:function(t){this.bootScene(t.scene);},update:function(t,e){this.processQueue(),this.isProcessing=!0;for(var i=this.scenes.length-1;0<=i;i--){var n=this.scenes[i].sys;n.settings.status>r.START&&n.settings.status<=r.RUNNING&&n.step(t,e);}},render:function(t){for(var e=0;e<this.scenes.length;e++){var i=this.scenes[e].sys;i.settings.visible&&i.settings.status>=r.LOADING&&i.settings.status<r.SLEEPING&&i.render(t);}this.isProcessing=!1;},create:function(t){var e=t.sys,i=e.settings;t.create&&(i.status=r.CREATING,t.create.call(t,i.data),i.status===r.DESTROYED)||(i.isTransition&&e.events.emit(s.TRANSITION_START,i.transitionFrom,i.transitionDuration),t.update&&(e.sceneUpdate=t.update),i.status=r.RUNNING,e.events.emit(s.CREATE,t));},createSceneFromFunction:function(t,e){var i=new e();if(i instanceof l){var n=i.sys.settings.key;if(""!==n&&(t=n),this.keys.hasOwnProperty(t))throw new Error("Cannot add a Scene with duplicate key: "+t);return this.createSceneFromInstance(t,i);}return i.sys=new c(i),i.sys.settings.key=t,i.sys.init(this.game),i;},createSceneFromInstance:function(t,e){return""===e.sys.settings.key&&(e.sys.settings.key=t),e.sys.init(this.game),e;},createSceneFromObject:function(t,e){var i=new l(e),n=i.sys.settings.key;""!==n?t=n:i.sys.settings.key=t,i.sys.init(this.game);for(var s,r=["init","preload","create","update","render"],o=0;o<r.length;o++){var a=u(e,r[o],null);a&&(i[r[o]]=a);}if(e.hasOwnProperty("extend"))for(var h in e.extend){e.extend.hasOwnProperty(h)&&(s=e.extend[h],"data"===h&&i.hasOwnProperty("data")&&"object"==typeof s?i.data.merge(s):"sys"!==h&&(i[h]=s));}return i;},getKey:function(t,e){if(t=t||"default","function"==typeof e)return t;if(e instanceof l?t=e.sys.settings.key:"object"==typeof e&&e.hasOwnProperty("key")&&(t=e.key),this.keys.hasOwnProperty(t))throw new Error("Cannot add a Scene with duplicate key: "+t);return t;},getScenes:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);for(var i=[],n=this.scenes,s=0;s<n.length;s++){var r=n[s];r&&(!t||t&&r.sys.isActive())&&i.push(r);}return e?i.reverse():i;},getScene:function(t){if("string"==typeof t){if(this.keys[t])return this.keys[t];}else for(var e=0;e<this.scenes.length;e++)if(t===this.scenes[e])return t;return null;},isActive:function(t){var e=this.getScene(t);return e?e.sys.isActive():null;},isPaused:function(t){var e=this.getScene(t);return e?e.sys.isPaused():null;},isVisible:function(t){var e=this.getScene(t);return e?e.sys.isVisible():null;},isSleeping:function(t){var e=this.getScene(t);return e?e.sys.isSleeping():null;},pause:function(t,e){var i=this.getScene(t);return i&&i.sys.pause(e),this;},resume:function(t,e){var i=this.getScene(t);return i&&i.sys.resume(e),this;},sleep:function(t,e){var i=this.getScene(t);return i&&!i.sys.isTransitioning()&&i.sys.sleep(e),this;},wake:function(t,e){var i=this.getScene(t);return i&&i.sys.wake(e),this;},run:function(t,e){var i=this.getScene(t);if(!i){for(var n=0;n<this._pending.length;n++)if(this._pending[n].key===t){this.queueOp("start",t,e);break;}return this;}i.sys.isSleeping()?i.sys.wake(e):i.sys.isPaused()?i.sys.resume(e):this.start(t,e);},start:function(t,e){if(!this.isBooted)return this._data[t]={autoStart:!0,data:e},this;var i=this.getScene(t);if(i){var n,s=i.sys;if(s.isActive()||s.isPaused())s.shutdown(),s.sceneUpdate=h,s.start(e);else if(s.sceneUpdate=h,s.start(e),s.load&&(n=s.load),n&&s.settings.hasOwnProperty("pack")&&(n.reset(),n.addPack({payload:s.settings.pack})))return s.settings.status=r.LOADING,n.once(a.COMPLETE,this.payloadComplete,this),n.start(),this;this.bootScene(i);}return this;},stop:function(t,e){var i=this.getScene(t);return i&&!i.sys.isTransitioning()&&i.sys.shutdown(e),this;},switch:function(t,e){var i=this.getScene(t),n=this.getScene(e);return i&&n&&i!==n&&(this.sleep(t),this.isSleeping(e)?this.wake(e):this.start(e)),this;},getAt:function(t){return this.scenes[t];},getIndex:function(t){var e=this.getScene(t);return this.scenes.indexOf(e);},bringToTop:function(t){var e,i;return this.isProcessing?this._queue.push({op:"bringToTop",keyA:t,keyB:null}):-1!==(e=this.getIndex(t))&&e<this.scenes.length&&(i=this.getScene(t),this.scenes.splice(e,1),this.scenes.push(i)),this;},sendToBack:function(t){var e,i;return this.isProcessing?this._queue.push({op:"sendToBack",keyA:t,keyB:null}):-1!==(e=this.getIndex(t))&&0<e&&(i=this.getScene(t),this.scenes.splice(e,1),this.scenes.unshift(i)),this;},moveDown:function(t){var e,i,n,s;return this.isProcessing?this._queue.push({op:"moveDown",keyA:t,keyB:null}):0<(e=this.getIndex(t))&&(i=e-1,n=this.getScene(t),s=this.getAt(i),this.scenes[e]=s,this.scenes[i]=n),this;},moveUp:function(t){var e,i,n,s;return this.isProcessing?this._queue.push({op:"moveUp",keyA:t,keyB:null}):(e=this.getIndex(t))<this.scenes.length-1&&(i=e+1,n=this.getScene(t),s=this.getAt(i),this.scenes[e]=s,this.scenes[i]=n),this;},moveAbove:function(t,e){return t===e||(this.isProcessing?this._queue.push({op:"moveAbove",keyA:t,keyB:e}):(i=this.getIndex(t),n=this.getIndex(e),-1!==i&&-1!==n&&(s=this.getAt(n),this.scenes.splice(n,1),this.scenes.splice(i+1,0,s)))),this;var i,n,s;},moveBelow:function(t,e){return t===e||(this.isProcessing?this._queue.push({op:"moveBelow",keyA:t,keyB:e}):(i=this.getIndex(t),n=this.getIndex(e),-1!==i&&-1!==n&&(s=this.getAt(n),this.scenes.splice(n,1),0===i?this.scenes.unshift(s):this.scenes.splice(i,0,s)))),this;var i,n,s;},queueOp:function(t,e,i){return this._queue.push({op:t,keyA:e,keyB:i}),this;},swapPosition:function(t,e){return t===e||(this.isProcessing?this._queue.push({op:"swapPosition",keyA:t,keyB:e}):(i=this.getIndex(t))!==(n=this.getIndex(e))&&-1!==i&&-1!==n&&(s=this.getAt(i),this.scenes[i]=this.scenes[n],this.scenes[n]=s)),this;var i,n,s;},dump:function(){for(var t=[],e=["pending","init","start","loading","creating","running","paused","sleeping","shutdown","destroyed"],i=0;i<this.scenes.length;i++){var n=this.scenes[i].sys,s=!n.settings.visible||n.settings.status!==r.RUNNING&&n.settings.status!==r.PAUSED?"[-] ":"[*] ";s+=n.settings.key+" ("+e[n.settings.status]+")",t.push(s);}console.log(t.join("\n"));},destroy:function(){for(var t=0;t<this.scenes.length;t++){this.scenes[t].sys.destroy();}this.update=h,this.scenes=[],this._pending=[],this._start=[],this._queue=[],this.game=null;}});t.exports=d;},function(t,e,i){var n=i(0),s=i(204),r=new n({initialize:function(t){this.sys=new s(this,t),this.game,this.anims,this.cache,this.registry,this.sound,this.textures,this.events,this.cameras,this.add,this.make,this.scene,this.children,this.lights,this.data,this.input,this.load,this.time,this.tweens,this.physics,this.matter,this.scale,this.plugins,this.renderer;},update:function(){}});t.exports=r;},function(t,e,i){var r=i(2),o=i(205);t.exports=function(t){var e=t.game.config.defaultPhysicsSystem,i=r(t.settings,"physics",!1);if(e||i){var n=[];if(e&&n.push(o(e+"Physics")),i)for(var s in i)s=o(s.concat("Physics")),-1===n.indexOf(s)&&n.push(s);return n;}};},function(t,e,i){var n=i(2);t.exports=function(t){var e=t.plugins.getDefaultScenePlugins(),i=n(t.settings,"plugins",!1);return Array.isArray(i)?i:e||[];};},function(t,e,i){var n=i(144),s=i(6),r=i(127),o=i(978),a={create:function(t){return"string"==typeof t?t={key:t}:void 0===t&&(t={}),{status:n.PENDING,key:s(t,"key",""),active:s(t,"active",!1),visible:s(t,"visible",!0),isBooted:!1,isTransition:!1,transitionFrom:null,transitionDuration:0,transitionAllowInput:!0,data:{},pack:s(t,"pack",!1),cameras:s(t,"cameras",null),map:s(t,"map",r(o,s(t,"mapAdd",{}))),physics:s(t,"physics",{}),loader:s(t,"loader",{}),plugins:s(t,"plugins",!1),input:s(t,"input",{})};}};t.exports=a;},function(t,e,i){var h=i(31),s=i(423),n=i(0),u=i(38),r=i(33),o=i(9),l=i(106),a=i(22),c=i(388),d=i(6),f=i(425),p=i(206),g=new n({Extends:o,initialize:function(t){o.call(this),this.game=t,this.name="TextureManager",this.list={},this._tempCanvas=h.create2D(this,1,1),this._tempContext=this._tempCanvas.getContext("2d"),this._pending=0,t.events.once(a.BOOT,this.boot,this);},boot:function(){this._pending=3,this.on(l.LOAD,this.updatePending,this),this.on(l.ERROR,this.updatePending,this);var t=this.game.config;this.addBase64("__DEFAULT",t.defaultImage),this.addBase64("__MISSING",t.missingImage),this.addBase64("__WHITE",t.whiteImage),this.game.events.once(a.DESTROY,this.destroy,this);},updatePending:function(){this._pending--,0===this._pending&&(this.off(l.LOAD),this.off(l.ERROR),this.emit(l.READY));},checkKey:function(t){return!this.exists(t)||(console.error("Texture key already in use: "+t),!1);},remove:function(t){if("string"==typeof t){if(!this.exists(t))return console.warn("No texture found matching key: "+t),this;t=this.get(t);}return this.list.hasOwnProperty(t.key)&&(t.destroy(),this.emit(l.REMOVE,t.key)),this;},removeKey:function(t){return this.list.hasOwnProperty(t)&&delete this.list[t],this;},addBase64:function(e,t){var i,n;return this.checkKey(e)&&(i=this,(n=new Image()).onerror=function(){i.emit(l.ERROR,e);},n.onload=function(){var t=i.create(e,n);f.Image(t,0),i.emit(l.ADD,e,t),i.emit(l.LOAD,e,t);},n.src=t),this;},getBase64:function(t,e,i,n){void 0===i&&(i="image/png"),void 0===n&&(n=.92);var s,r,o="",a=this.getFrame(t,e);return a&&(a.source.isRenderTexture||a.source.isGLTexture)?console.warn("Cannot getBase64 from WebGL Texture"):a&&(s=a.canvasData,(r=h.create2D(this,s.width,s.height)).getContext("2d").drawImage(a.source.image,s.x,s.y,s.width,s.height,0,0,s.width,s.height),o=r.toDataURL(i,n),h.remove(r)),o;},addImage:function(t,e,i){var n=null;return this.checkKey(t)&&(n=this.create(t,e),f.Image(n,0),i&&n.setDataSource(i),this.emit(l.ADD,t,n)),n;},addGLTexture:function(t,e,i,n){var s=null;return this.checkKey(t)&&(void 0===i&&(i=e.width),void 0===n&&(n=e.height),(s=this.create(t,e,i,n)).add("__BASE",0,0,0,i,n),this.emit(l.ADD,t,s)),s;},addRenderTexture:function(t,e){var i=null;return this.checkKey(t)&&((i=this.create(t,e)).add("__BASE",0,0,0,e.width,e.height),this.emit(l.ADD,t,i)),i;},generate:function(t,e){if(this.checkKey(t)){var i=h.create(this,1,1);return e.canvas=i,c(e),this.addCanvas(t,i);}return null;},createCanvas:function(t,e,i){if(void 0===e&&(e=256),void 0===i&&(i=256),this.checkKey(t)){var n=h.create(this,e,i,r.CANVAS,!0);return this.addCanvas(t,n);}return null;},addCanvas:function(t,e,i){void 0===i&&(i=!1);var n=null;return i?n=new s(this,t,e,e.width,e.height):this.checkKey(t)&&(n=new s(this,t,e,e.width,e.height),this.list[t]=n,this.emit(l.ADD,t,n)),n;},addAtlas:function(t,e,i,n){return Array.isArray(i.textures)||Array.isArray(i.frames)?this.addAtlasJSONArray(t,e,i,n):this.addAtlasJSONHash(t,e,i,n);},addAtlasJSONArray:function(t,e,i,n){var s=null;if(this.checkKey(t)){if(s=this.create(t,e),Array.isArray(i))for(var r=1===i.length,o=0;o<s.source.length;o++){var a=r?i[0]:i[o];f.JSONArray(s,o,a);}else f.JSONArray(s,0,i);n&&s.setDataSource(n),this.emit(l.ADD,t,s);}return s;},addAtlasJSONHash:function(t,e,i,n){var s=null;if(this.checkKey(t)){if(s=this.create(t,e),Array.isArray(i))for(var r=0;r<i.length;r++)f.JSONHash(s,r,i[r]);else f.JSONHash(s,0,i);n&&s.setDataSource(n),this.emit(l.ADD,t,s);}return s;},addAtlasXML:function(t,e,i,n){var s=null;return this.checkKey(t)&&(s=this.create(t,e),f.AtlasXML(s,0,i),n&&s.setDataSource(n),this.emit(l.ADD,t,s)),s;},addUnityAtlas:function(t,e,i,n){var s=null;return this.checkKey(t)&&(s=this.create(t,e),f.UnityYAML(s,0,i),n&&s.setDataSource(n),this.emit(l.ADD,t,s)),s;},addSpriteSheet:function(t,e,i){var n,s,r=null;return this.checkKey(t)&&(n=(r=this.create(t,e)).source[0].width,s=r.source[0].height,f.SpriteSheet(r,0,0,0,n,s,i),this.emit(l.ADD,t,r)),r;},addSpriteSheetFromAtlas:function(t,e){if(!this.checkKey(t))return null;var i=d(e,"atlas",null),n=d(e,"frame",null);if(i&&n){var s=this.get(i).get(n);if(s){var r=this.create(t,s.source.image);return s.trimmed?f.SpriteSheetFromAtlas(r,s,e):f.SpriteSheet(r,0,s.cutX,s.cutY,s.cutWidth,s.cutHeight,e),this.emit(l.ADD,t,r),r;}}},create:function(t,e,i,n){var s=null;return this.checkKey(t)&&(s=new p(this,t,e,i,n),this.list[t]=s),s;},exists:function(t){return this.list.hasOwnProperty(t);},get:function(t){return void 0===t&&(t="__DEFAULT"),this.list[t]?this.list[t]:t instanceof p?t:this.list.__MISSING;},cloneFrame:function(t,e){if(this.list[t])return this.list[t].get(e).clone();},getFrame:function(t,e){if(this.list[t])return this.list[t].get(e);},getTextureKeys:function(){var t=[];for(var e in this.list)"__DEFAULT"!==e&&"__MISSING"!==e&&t.push(e);return t;},getPixel:function(t,e,i,n){var s=this.getFrame(i,n);if(s){t-=s.x,e-=s.y;var r=s.data.cut;if(t+=r.x,e+=r.y,t>=r.x&&t<r.r&&e>=r.y&&e<r.b){var o=this._tempContext;o.clearRect(0,0,1,1),o.drawImage(s.source.image,t,e,1,1,0,0,1,1);var a=o.getImageData(0,0,1,1);return new u(a.data[0],a.data[1],a.data[2],a.data[3]);}}return null;},getPixelAlpha:function(t,e,i,n){var s=this.getFrame(i,n);if(s){t-=s.x,e-=s.y;var r=s.data.cut;if(t+=r.x,e+=r.y,t>=r.x&&t<r.r&&e>=r.y&&e<r.b){var o=this._tempContext;return o.clearRect(0,0,1,1),o.drawImage(s.source.image,t,e,1,1,0,0,1,1),o.getImageData(0,0,1,1).data[3];}}return null;},setTexture:function(t,e,i){return this.list[e]&&(t.texture=this.list[e],t.frame=t.texture.get(i)),t;},renameTexture:function(t,e){var i=this.get(t);return!(!i||t===e)&&(i.key=e,this.list[e]=i,delete this.list[t],!0);},each:function(t,e){for(var i=[null],n=1;n<arguments.length;n++)i.push(arguments[n]);for(var s in this.list)i[0]=this.list[s],t.apply(e,i);},destroy:function(){for(var t in this.list)this.list[t].destroy();this.list={},this.game=null,h.remove(this._tempCanvas);}});t.exports=g;},function(t,e,i){var n=i(0),f=i(18),p=i(38),s=i(33),r=i(138),o=i(206),a=new n({Extends:o,initialize:function(t,e,i,n,s){o.call(this,t,e,i,n,s),this.add("__BASE",0,0,0,n,s),this._source=this.frames.__BASE.source,this.canvas=this._source.image,this.context=this.canvas.getContext("2d"),this.width=n,this.height=s,this.imageData=this.context.getImageData(0,0,n,s),this.data=null,this.imageData&&(this.data=this.imageData.data),this.pixels=null,this.buffer,this.data&&(this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data);},update:function(){return this.imageData=this.context.getImageData(0,0,this.width,this.height),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this.manager.game.config.renderType===s.WEBGL&&this.refresh(),this;},draw:function(t,e,i){return this.context.drawImage(i,t,e),this.update();},drawFrame:function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var s=this.manager.getFrame(t,e);if(s){var r=s.canvasData,o=s.cutWidth,a=s.cutHeight,h=s.source.resolution;return this.context.drawImage(s.source.image,r.x,r.y,o,a,i,n,o/h,a/h),this.update();}return this;},setPixel:function(t,e,i,n,s,r){var o;return void 0===r&&(r=255),t=Math.abs(Math.floor(t)),e=Math.abs(Math.floor(e)),-1<this.getIndex(t,e)&&((o=this.context.getImageData(t,e,1,1)).data[0]=i,o.data[1]=n,o.data[2]=s,o.data[3]=r,this.context.putImageData(o,t,e)),this;},putData:function(t,e,i,n,s,r,o){return void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=t.width),void 0===o&&(o=t.height),this.context.putImageData(t,e,i,n,s,r,o),this;},getData:function(t,e,i,n){return t=f(Math.floor(t),0,this.width-1),e=f(Math.floor(e),0,this.height-1),i=f(i,1,this.width-t),n=f(n,1,this.height-e),this.context.getImageData(t,e,i,n);},getPixel:function(t,e,i){i=i||new p();var n,s,r,o,a,h=this.getIndex(t,e);return-1<h&&(s=(n=this.data)[h+0],r=n[h+1],o=n[h+2],a=n[h+3],i.setTo(s,r,o,a)),i;},getPixels:function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.width),void 0===n&&(n=i),t=Math.abs(Math.round(t)),e=Math.abs(Math.round(e));for(var s=f(t,0,this.width),r=f(t+i,0,this.width),o=f(e,0,this.height),a=f(e+n,0,this.height),h=new p(),u=[],l=o;l<a;l++){for(var c=[],d=s;d<r;d++)h=this.getPixel(d,l,h),c.push({x:d,y:l,color:h.color,alpha:h.alphaGL});u.push(c);}return u;},getIndex:function(t,e){return t=Math.abs(Math.round(t)),e=Math.abs(Math.round(e)),t<this.width&&e<this.height?4*(t+e*this.width):-1;},refresh:function(){return this._source.update(),this;},getCanvas:function(){return this.canvas;},getContext:function(){return this.context;},clear:function(t,e,i,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.width),void 0===n&&(n=this.height),this.context.clearRect(t,e,i,n),this.update();},setSize:function(t,e){return void 0===e&&(e=t),t===this.width&&e===this.height||(this.canvas.width=t,this.canvas.height=e,this._source.width=t,this._source.height=e,this._source.isPowerOf2=r(t,e),this.frames.__BASE.setSize(t,e,0,0),this.width=t,this.height=e,this.refresh()),this;},destroy:function(){o.prototype.destroy.call(this),this._source=null,this.canvas=null,this.context=null,this.imageData=null,this.data=null,this.pixels=null,this.buffer=null;}});t.exports=a;},function(t,e,i){var n=i(31),s=i(0),o=i(138),a=i(168),r=new s({initialize:function(t,e,i,n,s){void 0===s&&(s=!1);var r=t.manager.game;this.renderer=r.renderer,this.texture=t,this.source=e,this.image=e,this.compressionAlgorithm=null,this.resolution=1,this.width=i||e.naturalWidth||e.videoWidth||e.width||0,this.height=n||e.naturalHeight||e.videoHeight||e.height||0,this.scaleMode=a.DEFAULT,this.isCanvas=e instanceof HTMLCanvasElement,this.isVideo=window.hasOwnProperty("HTMLVideoElement")&&e instanceof HTMLVideoElement,this.isRenderTexture="RenderTexture"===e.type,this.isGLTexture=window.hasOwnProperty("WebGLTexture")&&e instanceof WebGLTexture,this.isPowerOf2=o(this.width,this.height),this.glTexture=null,this.glIndex=0,this.glIndexCounter=-1,this.flipY=s,this.init(r);},init:function(t){var e=this.renderer;e&&(e.gl?this.isCanvas?this.glTexture=e.createCanvasTexture(this.image,!1,this.flipY):this.isVideo?this.glTexture=e.createVideoTexture(this.image,!1,this.flipY):this.isRenderTexture?(this.image=this.source.canvas,this.glTexture=e.createTextureFromSource(null,this.width,this.height,this.scaleMode)):this.isGLTexture?this.glTexture=this.source:this.glTexture=e.createTextureFromSource(this.image,this.width,this.height,this.scaleMode):this.isRenderTexture&&(this.image=this.source.canvas)),t.config.antialias||this.setFilter(1);},setFilter:function(t){this.renderer.gl&&this.renderer.setTextureFilter(this.glTexture,t),this.scaleMode=t;},setFlipY:function(t){return void 0===t&&(t=!0),this.flipY=t,this;},update:function(){var t=this.renderer.gl;t&&this.isCanvas?this.glTexture=this.renderer.updateCanvasTexture(this.image,this.glTexture,this.flipY):t&&this.isVideo&&(this.glTexture=this.renderer.updateVideoTexture(this.image,this.glTexture,this.flipY));},destroy:function(){this.glTexture&&this.renderer.deleteTexture(this.glTexture,!0),this.isCanvas&&n.remove(this.image),this.renderer=null,this.texture=null,this.source=null,this.image=null,this.glTexture=null;}});t.exports=r;},function(t,e,i){t.exports={AtlasXML:i(979),Canvas:i(980),Image:i(981),JSONArray:i(982),JSONHash:i(983),SpriteSheet:i(984),SpriteSheetFromAtlas:i(985),UnityYAML:i(986)};},function(t,e,i){var n=i(427),s=i(430),r=i(432),o={create:function(t){var e=t.config.audio,i=t.device.audio;return new(e.noAudio||!i.webAudio&&!i.audioData?s:i.webAudio&&!e.disableWebAudio?r:n)(t);}};t.exports=o;},function(t,e,i){var n=i(145),s=i(0),o=i(70),r=i(429),a=new s({Extends:n,initialize:function(t){this.override=!0,this.audioPlayDelay=.1,this.loopEndOffset=.05,this.onBlurPausedSounds=[],this.locked="ontouchstart"in window,this.lockedActionsQueue=this.locked?[]:null,this._mute=!1,this._volume=1,n.call(this,t);},add:function(t,e){var i=new r(this,t,e);return this.sounds.push(i),i;},unlock:function(){this.locked=!1;var e,i,n,r=this;this.game.cache.audio.entries.each(function(t,e){for(var i=0;i<e.length;i++)if("true"===e[i].dataset.locked)return!(r.locked=!0);return!0;}),this.locked&&(e=!1,i=function(){e=!0;},n=function(){var s,t;e?e=!1:(document.body.removeEventListener("touchmove",i),document.body.removeEventListener("touchend",n),s=[],r.game.cache.audio.entries.each(function(t,e){for(var i=0;i<e.length;i++){var n=e[i];"true"===n.dataset.locked&&s.push(n);}return!0;}),0!==s.length&&((t=s[s.length-1]).oncanplaythrough=function(){t.oncanplaythrough=null,s.forEach(function(t){t.dataset.locked="false";}),r.unlocked=!0;},s.forEach(function(t){t.load();})));},this.once(o.UNLOCKED,function(){for(this.forEachActiveSound(function(t){null===t.currentMarker&&0===t.duration&&(t.duration=t.tags[0].duration),t.totalDuration=t.tags[0].duration;});this.lockedActionsQueue.length;){var t=this.lockedActionsQueue.shift();t.sound[t.prop].apply?t.sound[t.prop].apply(t.sound,t.value||[]):t.sound[t.prop]=t.value;}},this),document.body.addEventListener("touchmove",i,!1),document.body.addEventListener("touchend",n,!1));},onBlur:function(){this.forEachActiveSound(function(t){t.isPlaying&&(this.onBlurPausedSounds.push(t),t.onBlur());});},onFocus:function(){this.onBlurPausedSounds.forEach(function(t){t.onFocus();}),this.onBlurPausedSounds.length=0;},destroy:function(){n.prototype.destroy.call(this),this.onBlurPausedSounds.length=0,this.onBlurPausedSounds=null;},isLocked:function(t,e,i){return"true"===t.tags[0].dataset.locked&&(this.lockedActionsQueue.push({sound:t,prop:e,value:i}),!0);},setMute:function(t){return this.mute=t,this;},mute:{get:function(){return this._mute;},set:function(t){this._mute=t,this.forEachActiveSound(function(t){t.updateMute();}),this.emit(o.GLOBAL_MUTE,this,t);}},setVolume:function(t){return this.volume=t,this;},volume:{get:function(){return this._volume;},set:function(t){this._volume=t,this.forEachActiveSound(function(t){t.updateVolume();}),this.emit(o.GLOBAL_VOLUME,this,t);}}});t.exports=a;},function(t,e,i){var a=i(78);t.exports=function(t,e,i,n,s){if(void 0===n&&(n=0),void 0===s&&(s=t.length),a(t,n,s))for(var r=n;r<s;r++){var o=t[r];if(!e||e&&void 0===i&&o.hasOwnProperty(e)||e&&void 0!==i&&o[e]===i)return o;}return null;};},function(t,e,i){var n=i(146),s=i(0),r=i(70),o=i(18),a=new s({Extends:n,initialize:function(t,e,i){if(void 0===i&&(i={}),this.tags=t.game.cache.audio.get(e),!this.tags)throw new Error('There is no audio asset with key "'+e+'" in the audio cache');this.audio=null,this.startTime=0,this.previousTime=0,this.duration=this.tags[0].duration,this.totalDuration=this.tags[0].duration,n.call(this,t,e,i);},play:function(t,e){return!this.manager.isLocked(this,"play",[t,e])&&!!n.prototype.play.call(this,t,e)&&!!this.pickAndPlayAudioTag()&&(this.emit(r.PLAY,this),!0);},pause:function(){return!this.manager.isLocked(this,"pause")&&!(0<this.startTime)&&!!n.prototype.pause.call(this)&&(this.currentConfig.seek=this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0),this.stopAndReleaseAudioTag(),this.emit(r.PAUSE,this),!0);},resume:function(){return!this.manager.isLocked(this,"resume")&&!(0<this.startTime)&&!!n.prototype.resume.call(this)&&!!this.pickAndPlayAudioTag()&&(this.emit(r.RESUME,this),!0);},stop:function(){return!this.manager.isLocked(this,"stop")&&!!n.prototype.stop.call(this)&&(this.stopAndReleaseAudioTag(),this.emit(r.STOP,this),!0);},pickAndPlayAudioTag:function(){if(!this.pickAudioTag())return this.reset(),!1;var t=this.currentConfig.seek,e=this.currentConfig.delay,i=(this.currentMarker?this.currentMarker.start:0)+t;return this.previousTime=i,this.audio.currentTime=i,this.applyConfig(),0===e?(this.startTime=0,this.audio.paused&&this.playCatchPromise()):(this.startTime=window.performance.now()+1e3*e,this.audio.paused||this.audio.pause()),this.resetConfig(),!0;},pickAudioTag:function(){if(this.audio)return!0;for(var t=0;t<this.tags.length;t++){var e=this.tags[t];if("false"===e.dataset.used)return e.dataset.used="true",this.audio=e,!0;}if(!this.manager.override)return!1;var i=[];this.manager.forEachActiveSound(function(t){t.key===this.key&&t.audio&&i.push(t);},this),i.sort(function(t,e){return t.loop===e.loop?e.seek/e.duration-t.seek/t.duration:t.loop?1:-1;});var n=i[0];return this.audio=n.audio,n.reset(),n.audio=null,n.startTime=0,!(n.previousTime=0);},playCatchPromise:function(){var t=this.audio.play();t&&t.catch(function(t){console.warn(t);});},stopAndReleaseAudioTag:function(){this.startTime=0,this.previousTime=0,this.audio&&(this.audio.pause(),this.audio.dataset.used="false",this.audio=null);},reset:function(){n.prototype.stop.call(this);},onBlur:function(){this.isPlaying=!1,this.isPaused=!0,this.currentConfig.seek=this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0),this.currentConfig.delay=Math.max(0,(this.startTime-window.performance.now())/1e3),this.stopAndReleaseAudioTag();},onFocus:function(){this.isPlaying=!0,this.isPaused=!1,this.pickAndPlayAudioTag();},update:function(t){if(this.isPlaying)if(0<this.startTime)this.startTime<t-this.manager.audioPlayDelay&&(this.audio.currentTime+=Math.max(0,t-this.startTime)/1e3,this.startTime=0,this.previousTime=this.audio.currentTime,this.playCatchPromise());else{var e=this.currentMarker?this.currentMarker.start:0,i=e+this.duration,n=this.audio.currentTime;if(this.currentConfig.loop)n>=i-this.manager.loopEndOffset?(this.audio.currentTime=e+Math.max(0,n-i),n=this.audio.currentTime):n<e&&(this.audio.currentTime+=e,n=this.audio.currentTime),n<this.previousTime&&this.emit(r.LOOPED,this);else if(i<=n)return this.reset(),this.stopAndReleaseAudioTag(),void this.emit(r.COMPLETE,this);this.previousTime=n;}},destroy:function(){n.prototype.destroy.call(this),this.tags=null,this.audio&&this.stopAndReleaseAudioTag();},updateMute:function(){this.audio&&(this.audio.muted=this.currentConfig.mute||this.manager.mute);},updateVolume:function(){this.audio&&(this.audio.volume=o(this.currentConfig.volume*this.manager.volume,0,1));},calculateRate:function(){n.prototype.calculateRate.call(this),this.audio&&(this.audio.playbackRate=this.totalRate);},mute:{get:function(){return this.currentConfig.mute;},set:function(t){this.currentConfig.mute=t,this.manager.isLocked(this,"mute",t)||(this.updateMute(),this.emit(r.MUTE,this,t));}},setMute:function(t){return this.mute=t,this;},volume:{get:function(){return this.currentConfig.volume;},set:function(t){this.currentConfig.volume=t,this.manager.isLocked(this,"volume",t)||(this.updateVolume(),this.emit(r.VOLUME,this,t));}},setVolume:function(t){return this.volume=t,this;},rate:{get:function(){return this.currentConfig.rate;},set:function(t){this.currentConfig.rate=t,this.manager.isLocked(this,r.RATE,t)||(this.calculateRate(),this.emit(r.RATE,this,t));}},setRate:function(t){return this.rate=t,this;},detune:{get:function(){return this.currentConfig.detune;},set:function(t){this.currentConfig.detune=t,this.manager.isLocked(this,r.DETUNE,t)||(this.calculateRate(),this.emit(r.DETUNE,this,t));}},setDetune:function(t){return this.detune=t,this;},seek:{get:function(){return this.isPlaying?this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0):this.isPaused?this.currentConfig.seek:0;},set:function(t){this.manager.isLocked(this,"seek",t)||0<this.startTime||(this.isPlaying||this.isPaused)&&(t=Math.min(Math.max(0,t),this.duration),this.isPlaying?(this.previousTime=t,this.audio.currentTime=t):this.isPaused&&(this.currentConfig.seek=t),this.emit(r.SEEK,this,t));}},setSeek:function(t){return this.seek=t,this;},loop:{get:function(){return this.currentConfig.loop;},set:function(t){this.currentConfig.loop=t,this.manager.isLocked(this,"loop",t)||(this.audio&&(this.audio.loop=t),this.emit(r.LOOP,this,t));}},setLoop:function(t){return this.loop=t,this;},pan:{get:function(){return this.currentConfig.pan;},set:function(t){this.currentConfig.pan=t,this.emit(r.PAN,this,t);}},setPan:function(t){return this.pan=t,this;}});t.exports=a;},function(t,e,i){var n=i(145),s=i(0),r=i(9),o=i(431),a=i(1),h=new s({Extends:r,initialize:function(t){r.call(this),this.game=t,this.sounds=[],this.mute=!1,this.volume=1,this.rate=1,this.detune=0,this.pauseOnBlur=!0,this.locked=!1;},add:function(t,e){var i=new o(this,t,e);return this.sounds.push(i),i;},addAudioSprite:function(t,e){var i=this.add(t,e);return i.spritemap={},i;},play:function(t,e){return!1;},playAudioSprite:function(t,e,i){return!1;},remove:function(t){return n.prototype.remove.call(this,t);},removeByKey:function(t){return n.prototype.removeByKey.call(this,t);},pauseAll:a,resumeAll:a,stopAll:a,update:a,setRate:a,setDetune:a,setMute:a,setVolume:a,forEachActiveSound:function(t,e){n.prototype.forEachActiveSound.call(this,t,e);},destroy:function(){n.prototype.destroy.call(this);}});t.exports=h;},function(t,e,i){function n(){return!1;}function s(){return this;}var r=i(146),o=i(0),a=i(9),h=i(17),u=new o({Extends:a,initialize:function(t,e,i){void 0===i&&(i={}),a.call(this),this.manager=t,this.key=e,this.isPlaying=!1,this.isPaused=!1,this.totalRate=1,this.duration=0,this.totalDuration=0,this.config=h({mute:!1,volume:1,rate:1,detune:0,seek:0,loop:!1,delay:0,pan:0},i),this.currentConfig=this.config,this.mute=!1,this.volume=1,this.rate=1,this.detune=0,this.seek=0,this.loop=!1,this.pan=0,this.markers={},this.currentMarker=null,this.pendingRemove=!1;},addMarker:n,updateMarker:n,removeMarker:function(){return null;},play:n,pause:n,resume:n,stop:n,destroy:function(){r.prototype.destroy.call(this);},setMute:s,setVolume:s,setRate:s,setDetune:s,setSeek:s,setLoop:s,setPan:s});t.exports=u;},function(t,e,i){var c=i(433),n=i(145),s=i(0),d=i(70),r=i(22),o=i(434),a=new s({Extends:n,initialize:function(t){this.context=this.createAudioContext(t),this.masterMuteNode=this.context.createGain(),this.masterVolumeNode=this.context.createGain(),this.masterMuteNode.connect(this.masterVolumeNode),this.masterVolumeNode.connect(this.context.destination),this.destination=this.masterMuteNode,this.locked="suspended"===this.context.state&&("ontouchstart"in window||"onclick"in window),n.call(this,t),this.locked&&t.isBooted?this.unlock():t.events.once(r.BOOT,this.unlock,this);},createAudioContext:function(t){var e=t.config.audio;return e.context?(e.context.resume(),e.context):window.hasOwnProperty("AudioContext")?new AudioContext():window.hasOwnProperty("webkitAudioContext")?new window.webkitAudioContext():void 0;},setAudioContext:function(t){return this.context&&this.context.close(),this.masterMuteNode&&this.masterMuteNode.disconnect(),this.masterVolumeNode&&this.masterVolumeNode.disconnect(),this.context=t,this.masterMuteNode=t.createGain(),this.masterVolumeNode=t.createGain(),this.masterMuteNode.connect(this.masterVolumeNode),this.masterVolumeNode.connect(t.destination),this.destination=this.masterMuteNode,this;},add:function(t,e){var i=new o(this,t,e);return this.sounds.push(i),i;},decodeAudio:function(t,e){for(var i=Array.isArray(t)?t:[{key:t,data:e}],n=this.game.cache.audio,s=i.length,r=0;r<i.length;r++){var o=i[r],a=o.key,h=o.data;"string"==typeof h&&(h=c(h));var u=function(t,e){n.add(t,e),this.emit(d.DECODED,t),0===--s&&this.emit(d.DECODED_ALL);}.bind(this,a),l=function(t,e){console.error("Error decoding audio: "+t+" - ",e?e.message:""),0===--s&&this.emit(d.DECODED_ALL);}.bind(this,a);this.context.decodeAudioData(h,u,l);}},unlock:function(){function e(){var t;i.context&&n&&(t=n.removeEventListener,i.context.resume().then(function(){t("touchstart",e),t("touchend",e),t("click",e),t("keydown",e),i.unlocked=!0;},function(){t("touchstart",e),t("touchend",e),t("click",e),t("keydown",e);}));}var i=this,n=document.body;n&&(n.addEventListener("touchstart",e,!1),n.addEventListener("touchend",e,!1),n.addEventListener("click",e,!1),n.addEventListener("keydown",e,!1));},onBlur:function(){this.locked||this.context.suspend();},onFocus:function(){var t=this.context;"suspended"!==t.state&&"interrupted"!==t.state||this.locked||t.resume();},update:function(t,e){n.prototype.update.call(this,t,e);var i=this.context;i&&"interrupted"===i.state&&i.resume();},destroy:function(){var t;this.destination=null,this.masterVolumeNode.disconnect(),this.masterVolumeNode=null,this.masterMuteNode.disconnect(),this.masterMuteNode=null,this.game.config.audio.context?this.context.suspend():(t=this).context.close().then(function(){t.context=null;}),n.prototype.destroy.call(this);},setMute:function(t){return this.mute=t,this;},mute:{get:function(){return 0===this.masterMuteNode.gain.value;},set:function(t){this.masterMuteNode.gain.setValueAtTime(t?0:1,0),this.emit(d.GLOBAL_MUTE,this,t);}},setVolume:function(t){return this.volume=t,this;},volume:{get:function(){return this.masterVolumeNode.gain.value;},set:function(t){this.masterVolumeNode.gain.setValueAtTime(t,0),this.emit(d.GLOBAL_VOLUME,this,t);}}});t.exports=a;},function(t,e){for(var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=new Uint8Array(256),n=0;n<i.length;n++)c[i.charCodeAt(n)]=n;t.exports=function(t){var e,i,n,s,r=(t=t.substr(t.indexOf(",")+1)).length,o=.75*r,a=0;"="===t[r-1]&&(o--,"="===t[r-2]&&o--);for(var h=new ArrayBuffer(o),u=new Uint8Array(h),l=0;l<r;l+=4)e=c[t.charCodeAt(l)],i=c[t.charCodeAt(l+1)],n=c[t.charCodeAt(l+2)],s=c[t.charCodeAt(l+3)],u[a++]=e<<2|i>>4,u[a++]=(15&i)<<4|n>>2,u[a++]=(3&n)<<6|63&s;return h;};},function(t,e,i){var n=i(146),s=i(0),r=i(70),o=new s({Extends:n,initialize:function(t,e,i){if(void 0===i&&(i={}),this.audioBuffer=t.game.cache.audio.get(e),!this.audioBuffer)throw new Error('Audio key "'+e+'" missing from cache');this.source=null,this.loopSource=null,this.muteNode=t.context.createGain(),this.volumeNode=t.context.createGain(),this.pannerNode=null,this.playTime=0,this.startTime=0,this.loopTime=0,this.rateUpdates=[],this.hasEnded=!1,this.hasLooped=!1,this.muteNode.connect(this.volumeNode),t.context.createStereoPanner?(this.pannerNode=t.context.createStereoPanner(),this.volumeNode.connect(this.pannerNode),this.pannerNode.connect(t.destination)):this.volumeNode.connect(t.destination),this.duration=this.audioBuffer.duration,this.totalDuration=this.audioBuffer.duration,n.call(this,t,e,i);},play:function(t,e){return!!n.prototype.play.call(this,t,e)&&(this.stopAndRemoveBufferSource(),this.createAndStartBufferSource(),this.emit(r.PLAY,this),!0);},pause:function(){return!(this.manager.context.currentTime<this.startTime)&&!!n.prototype.pause.call(this)&&(this.currentConfig.seek=this.getCurrentTime(),this.stopAndRemoveBufferSource(),this.emit(r.PAUSE,this),!0);},resume:function(){return!(this.manager.context.currentTime<this.startTime)&&!!n.prototype.resume.call(this)&&(this.createAndStartBufferSource(),this.emit(r.RESUME,this),!0);},stop:function(){return!!n.prototype.stop.call(this)&&(this.stopAndRemoveBufferSource(),this.emit(r.STOP,this),!0);},createAndStartBufferSource:function(){var t=this.currentConfig.seek,e=this.currentConfig.delay,i=this.manager.context.currentTime+e,n=(this.currentMarker?this.currentMarker.start:0)+t,s=this.duration-t;this.playTime=i-t,this.startTime=i,this.source=this.createBufferSource(),this.applyConfig(),this.source.start(Math.max(0,i),Math.max(0,n),Math.max(0,s)),this.resetConfig();},createAndStartLoopBufferSource:function(){var t=this.getLoopTime(),e=this.currentMarker?this.currentMarker.start:0,i=this.duration;this.loopTime=t,this.loopSource=this.createBufferSource(),this.loopSource.playbackRate.setValueAtTime(this.totalRate,0),this.loopSource.start(Math.max(0,t),Math.max(0,e),Math.max(0,i));},createBufferSource:function(){var e=this,t=this.manager.context.createBufferSource();return t.buffer=this.audioBuffer,t.connect(this.muteNode),t.onended=function(t){t.target===e.source&&(e.currentConfig.loop?e.hasLooped=!0:e.hasEnded=!0);},t;},stopAndRemoveBufferSource:function(){this.source&&(this.source.stop(),this.source.disconnect(),this.source=null),this.playTime=0,this.startTime=0,this.stopAndRemoveLoopBufferSource();},stopAndRemoveLoopBufferSource:function(){this.loopSource&&(this.loopSource.stop(),this.loopSource.disconnect(),this.loopSource=null),this.loopTime=0;},applyConfig:function(){this.rateUpdates.length=0,this.rateUpdates.push({time:0,rate:1}),n.prototype.applyConfig.call(this);},update:function(){this.hasEnded?(this.hasEnded=!1,n.prototype.stop.call(this),this.stopAndRemoveBufferSource(),this.emit(r.COMPLETE,this)):this.hasLooped&&(this.hasLooped=!1,this.source=this.loopSource,this.loopSource=null,this.playTime=this.startTime=this.loopTime,this.rateUpdates.length=0,this.rateUpdates.push({time:0,rate:this.totalRate}),this.createAndStartLoopBufferSource(),this.emit(r.LOOPED,this));},destroy:function(){n.prototype.destroy.call(this),this.audioBuffer=null,this.stopAndRemoveBufferSource(),this.muteNode.disconnect(),this.muteNode=null,this.volumeNode.disconnect(),this.volumeNode=null,this.pannerNode&&(this.pannerNode.disconnect(),this.pannerNode=null),this.rateUpdates.length=0,this.rateUpdates=null;},calculateRate:function(){n.prototype.calculateRate.call(this);var t=this.manager.context.currentTime;this.source&&"number"==typeof this.totalRate&&this.source.playbackRate.setValueAtTime(this.totalRate,t),this.isPlaying&&(this.rateUpdates.push({time:Math.max(this.startTime,t)-this.playTime,rate:this.totalRate}),this.loopSource&&(this.stopAndRemoveLoopBufferSource(),this.createAndStartLoopBufferSource()));},getCurrentTime:function(){for(var t=0,e=0;e<this.rateUpdates.length;e++){t+=((e<this.rateUpdates.length-1?this.rateUpdates[e+1].time:this.manager.context.currentTime-this.playTime)-this.rateUpdates[e].time)*this.rateUpdates[e].rate;}return t;},getLoopTime:function(){for(var t=0,e=0;e<this.rateUpdates.length-1;e++)t+=(this.rateUpdates[e+1].time-this.rateUpdates[e].time)*this.rateUpdates[e].rate;var i=this.rateUpdates[this.rateUpdates.length-1];return this.playTime+i.time+(this.duration-t)/i.rate;},rate:{get:function(){return this.currentConfig.rate;},set:function(t){this.currentConfig.rate=t,this.calculateRate(),this.emit(r.RATE,this,t);}},setRate:function(t){return this.rate=t,this;},detune:{get:function(){return this.currentConfig.detune;},set:function(t){this.currentConfig.detune=t,this.calculateRate(),this.emit(r.DETUNE,this,t);}},setDetune:function(t){return this.detune=t,this;},mute:{get:function(){return 0===this.muteNode.gain.value;},set:function(t){this.currentConfig.mute=t,this.muteNode.gain.setValueAtTime(t?0:1,0),this.emit(r.MUTE,this,t);}},setMute:function(t){return this.mute=t,this;},volume:{get:function(){return this.volumeNode.gain.value;},set:function(t){this.currentConfig.volume=t,this.volumeNode.gain.setValueAtTime(t,0),this.emit(r.VOLUME,this,t);}},setVolume:function(t){return this.volume=t,this;},seek:{get:function(){return this.isPlaying?this.manager.context.currentTime<this.startTime?this.startTime-this.playTime:this.getCurrentTime():this.isPaused?this.currentConfig.seek:0;},set:function(t){this.manager.context.currentTime<this.startTime||(this.isPlaying||this.isPaused)&&(t=Math.min(Math.max(0,t),this.duration),this.currentConfig.seek=t,this.isPlaying&&(this.stopAndRemoveBufferSource(),this.createAndStartBufferSource()),this.emit(r.SEEK,this,t));}},setSeek:function(t){return this.seek=t,this;},loop:{get:function(){return this.currentConfig.loop;},set:function(t){this.currentConfig.loop=t,this.isPlaying&&(this.stopAndRemoveLoopBufferSource(),t&&this.createAndStartLoopBufferSource()),this.emit(r.LOOP,this,t);}},setLoop:function(t){return this.loop=t,this;},pan:{get:function(){return this.pannerNode?this.pannerNode.pan.value:0;},set:function(t){this.currentConfig.pan=t,this.pannerNode&&this.pannerNode.pan.setValueAtTime(t,this.manager.context.currentTime),this.emit(r.PAN,this,t);}},setPan:function(t){return this.pan=t,this;}});t.exports=o;},function(t,e){t.exports=function(t){for(var e=t.length,i=t[0].length,n=new Array(i),s=0;s<i;s++){n[s]=new Array(e);for(var r=e-1;-1<r;r--)n[s][r]=t[r][s];}return n;};},function(t,e){function g(t,e,i){var n=t[e];t[e]=t[i],t[i]=n;}function v(t,e){return t<e?-1:e<t?1:0;}var m=function(t,e,i,n,s){for(void 0===i&&(i=0),void 0===n&&(n=t.length-1),void 0===s&&(s=v);i<n;){var r,o,a,h,u,l,c;600<n-i&&(r=n-i+1,o=e-i+1,a=Math.log(r),h=.5*Math.exp(2*a/3),u=.5*Math.sqrt(a*h*(r-h)/r)*(o-r/2<0?-1:1),l=Math.max(i,Math.floor(e-o*h/r+u)),c=Math.min(n,Math.floor(e+(r-o)*h/r+u)),m(t,e,l,c,s));var d=t[e],f=i,p=n;for(g(t,i,e),0<s(t[n],d)&&g(t,i,n);f<p;){for(g(t,f,p),f++,p--;s(t[f],d)<0;)f++;for(;0<s(t[p],d);)p--;}0===s(t[i],d)?g(t,i,p):g(t,++p,n),p<=e&&(i=p+1),e<=p&&(n=p-1);}};t.exports=m;},function(t,e,i){var f=i(6),p=i(131);t.exports=function(t,e,i){var n,s=f(i,"max",0),r=f(i,"qty",1),o=f(i,"random",!1),a=f(i,"randomB",!1),h=f(i,"repeat",0),u=f(i,"yoyo",!1),l=[];a&&p(e),-1===h&&(h=0===s?0:(n=t.length*e.length*r,u&&(n*=2),Math.ceil(s/n)));for(var c=0;c<=h;c++){var d=function(t,e,i){for(var n=[],s=0;s<t.length;s++)for(var r=0;r<e.length;r++)for(var o=0;o<i;o++)n.push({a:t[s],b:e[r]});return n;}(t,e,r);o&&p(d),l=l.concat(d),u&&(d.reverse(),l=l.concat(d));}return s&&l.splice(s),l;};},function(t,e,i){t.exports={PROCESS_QUEUE_ADD:i(1041),PROCESS_QUEUE_REMOVE:i(1042)};},function(t,e,i){var f=i(13);t.exports=function(t,e){var i,n,s,r,o,a,h,u,l,c,d=f(e,"anims",null);return null===d||("string"==typeof d?t.anims.play(d):"object"==typeof d&&(i=t.anims,(n=f(d,"key",void 0))&&(s=f(d,"startFrame",void 0),r=f(d,"delay",0),o=f(d,"repeat",0),a=f(d,"repeatDelay",0),h=f(d,"yoyo",!1),u=f(d,"play",!1),l=f(d,"delayedPlay",0),c={key:n,delay:r,repeat:o,repeatDelay:a,yoyo:h,startFrame:s},u?i.play(c):0<l?i.playAfterDelay(c,l):i.load(c)))),t;};},function(t,e,i){var n=i(0),s=i(109),r=new n({initialize:function(t,e,i,n,s){this.parent=t,this.x=e,this.y=i,this.frame=n,this.data={},this.tint=16777215,this._visible=s,this._alpha=1,this.flipX=!1,this.flipY=!1;},setFrame:function(t){return void 0===t?this.frame=this.parent.frame:t instanceof s&&t.texture===this.parent.texture?this.frame=t:this.frame=this.parent.texture.get(t),this;},resetFlip:function(){return this.flipX=!1,this.flipY=!1,this;},reset:function(t,e,i){return this.x=t,this.y=e,this.flipX=!1,this.flipY=!1,this._alpha=1,this._visible=!0,this.parent.dirty=!0,i&&this.setFrame(i),this;},setPosition:function(t,e){return this.x=t,this.y=e,this;},setFlipX:function(t){return this.flipX=t,this;},setFlipY:function(t){return this.flipY=t,this;},setFlip:function(t,e){return this.flipX=t,this.flipY=e,this;},setVisible:function(t){return this.visible=t,this;},setAlpha:function(t){return this.alpha=t,this;},setTint:function(t){return this.tint=t,this;},destroy:function(){this.parent.dirty=!0,this.parent.children.remove(this),this.parent=void 0,this.frame=void 0,this.data=void 0;},visible:{get:function(){return this._visible;},set:function(t){this.parent.dirty|=this._visible!==t,this._visible=t;}},alpha:{get:function(){return this._alpha;},set:function(t){this.parent.dirty|=0<this._alpha!=0<t,this._alpha=t;}}});t.exports=r;},function(t,e,i){var a=i(10);t.exports=function(t,e,i){void 0===i&&(i=new a());var n=Math.min(t.x,e.x),s=Math.min(t.y,e.y),r=Math.max(t.right,e.right)-n,o=Math.max(t.bottom,e.bottom)-s;return i.setTo(n,s,r,o);};},function(t,e,i){var n=i(0),s=i(11),r=i(1055),o=i(15),a=i(7),h=i(202),u=i(20),l=i(140),c=new n({Extends:o,Mixins:[s.AlphaSingle,s.BlendMode,s.Depth,s.Origin,s.ScrollFactor,s.Transform,s.Visible,r],initialize:function(t,e,i,n,s,r){o.call(this,t,"DOMElement"),this.parent=t.sys.game.domContainer,this.cache=t.sys.cache.html,this.node,this.transformOnly=!1,this.skewX=0,this.skewY=0,this.rotate3d=new l(),this.rotate3dAngle="deg",this.pointerEvents="auto",this.width=0,this.height=0,this.displayWidth=0,this.displayHeight=0,this.handler=this.dispatchNativeEvent.bind(this),this.setPosition(e,i),"string"==typeof n?"#"===n[0]?this.setElement(n.substr(1),s,r):this.createElement(n,s,r):n&&this.setElement(n,s,r),t.sys.events.on(u.SLEEP,this.handleSceneEvent,this),t.sys.events.on(u.WAKE,this.handleSceneEvent,this);},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},handleSceneEvent:function(t){var e=this.node,i=e.style;e&&(i.display=t.settings.visible?"block":"none");},setSkew:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.skewX=t,this.skewY=e,this;},setPerspective:function(t){return this.parent.style.perspective=t+"px",this;},perspective:{get:function(){return parseFloat(this.parent.style.perspective);},set:function(t){this.parent.style.perspective=t+"px";}},addListener:function(t){if(this.node){t=t.split(" ");for(var e=0;e<t.length;e++)this.node.addEventListener(t[e],this.handler,!1);}return this;},removeListener:function(t){if(this.node){t=t.split(" ");for(var e=0;e<t.length;e++)this.node.removeEventListener(t[e],this.handler);}return this;},dispatchNativeEvent:function(t){this.emit(t.type,t);},createElement:function(t,e,i){return this.setElement(document.createElement(t),e,i);},setElement:function(t,e,i){var n;if(this.removeElement(),"string"==typeof t?("#"===t[0]&&(t=t.substr(1)),n=document.getElementById(t)):"object"==typeof t&&1===t.nodeType&&(n=t),!n)return this;if(this.node=n,e&&a(e))for(var s in e)n.style[s]=e[s];else"string"==typeof e&&(n.style=e);return n.style.zIndex="0",n.style.display="inline",n.style.position="absolute",(n.phaser=this).parent&&this.parent.appendChild(n),i&&(n.innerText=i),this.updateSize();},createFromCache:function(t,e){var i=this.cache.get(t);return i&&this.createFromHTML(i,e),this;},createFromHTML:function(t,e){void 0===e&&(e="div"),this.removeElement();var i=document.createElement(e);return(this.node=i).style.zIndex="0",i.style.display="inline",i.style.position="absolute",(i.phaser=this).parent&&this.parent.appendChild(i),i.innerHTML=t,this.updateSize();},removeElement:function(){return this.node&&(h(this.node),this.node=null),this;},updateSize:function(){var t=this.node,e=t.getBoundingClientRect();return this.width=t.clientWidth,this.height=t.clientHeight,this.displayWidth=e.width||0,this.displayHeight=e.height||0,this;},getChildByProperty:function(t,e){if(this.node)for(var i=this.node.querySelectorAll("*"),n=0;n<i.length;n++)if(i[n][t]===e)return i[n];return null;},getChildByID:function(t){return this.getChildByProperty("id",t);},getChildByName:function(t){return this.getChildByProperty("name",t);},setClassName:function(t){return this.node&&(this.node.className=t,this.updateSize()),this;},setText:function(t){return this.node&&(this.node.innerText=t,this.updateSize()),this;},setHTML:function(t){return this.node&&(this.node.innerHTML=t,this.updateSize()),this;},preUpdate:function(){var t=this.parentContainer,e=this.node;e&&t&&!t.willRender()&&(e.style.display="none");},willRender:function(){return!0;},preDestroy:function(){this.removeElement(),this.scene.sys.events.off(u.SLEEP,this.handleSceneEvent,this),this.scene.sys.events.off(u.WAKE,this.handleSceneEvent,this);}});t.exports=c;},function(t,e,i){var g=i(1056),v=i(15),n=i(25),m=new n(),y=new n(),x=new n();t.exports=function(t,e,i,n){var s,r,o,a,h,u,l,c,d,f,p;e.node&&(s=e.node.style,r=e.scene.sys.settings,!s||!r.visible||v.RENDER_MASK!==e.renderFlags||0!==e.cameraFilter&&e.cameraFilter&i.id||e.parentContainer&&!e.parentContainer.willRender()?s.display="none":(o=e.parentContainer,a=i.alpha*e.alpha,o&&(a*=o.alpha),h=m,u=y,l=x,d=c=0,p=f="0%",n?(c=e.width*e.scaleX*e.originX,d=e.height*e.scaleY*e.originY,u.applyITRS(e.x-c,e.y-d,e.rotation,e.scaleX,e.scaleY),h.copyFrom(i.matrix),h.multiplyWithOffset(n,-i.scrollX*e.scrollFactorX,-i.scrollY*e.scrollFactorY),u.e=e.x-c,u.f=e.y-d):(c=e.width*e.originX,d=e.height*e.originY,u.applyITRS(e.x-c,e.y-d,e.rotation,e.scaleX,e.scaleY),h.copyFrom(i.matrix),f=100*e.originX+"%",p=100*e.originY+"%",u.e-=i.scrollX*e.scrollFactorX,u.f-=i.scrollY*e.scrollFactorY),h.multiply(u,l),e.transformOnly||(s.display="block",s.opacity=a,s.zIndex=e._depth,s.pointerEvents=e.pointerEvents,s.mixBlendMode=g[e._blendMode]),s.transform=l.getCSSMatrix()+" skew("+e.skewX+"rad, "+e.skewY+"rad) rotate3d("+e.rotate3d.x+","+e.rotate3d.y+","+e.rotate3d.z+","+e.rotate3d.w+e.rotate3dAngle+")",s.transformOrigin=f+" "+p));};},function(t,e,i){var n=i(0),s=i(11),r=i(15),o=i(1060),a=new n({Extends:r,Mixins:[s.Alpha,s.BlendMode,s.Depth,s.Flip,s.Origin,s.ScrollFactor,s.Size,s.Texture,s.Tint,s.Transform,s.Visible,o],initialize:function(t){r.call(this,t,"Extern");},addedToScene:function(){this.scene.sys.updateList.add(this);},removedFromScene:function(){this.scene.sys.updateList.remove(this);},preUpdate:function(){},render:function(){}});t.exports=a;},function(t,e,i){var s=i(218),r=i(98),o=i(14),a=i(4);t.exports=function(t,e,i){void 0===i&&(i=new a());var n=r(e,0,o.PI2);return s(t,n,i);};},function(t,e,i){var o=i(447),a=i(218),h=i(98),u=i(14);t.exports=function(t,e,i,n){void 0===n&&(n=[]),!e&&0<i&&(e=o(t)/i);for(var s=0;s<e;s++){var r=h(s/e,0,u.PI2);n.push(a(t,r));}return n;};},function(t,e){t.exports=function(t){var e=t.width/2,i=t.height/2,n=Math.pow(e-i,2)/Math.pow(e+i,2);return Math.PI*(e+i)*(1+3*n/(10+Math.sqrt(4-3*n)));};},function(t,e,i){var y=i(217),x=i(30);t.exports=function(t,e,i,n,s,r){var o=e.commandBuffer,a=o.length,h=s||t.currentContext;if(0!==a&&x(t,h,e,i,n)){i.addToRenderList(e);var u,l,c,d,f,p=0,g=0,v=0;h.beginPath();for(var m=0;m<a;++m){switch(o[m]){case y.ARC:h.arc(o[m+1],o[m+2],o[m+3],o[m+4],o[m+5],o[m+6]),m+=7;break;case y.LINE_STYLE:f=o[m+1],c=o[m+2],u=o[m+3],p=(16711680&c)>>>16,g=(65280&c)>>>8,v=255&c,h.strokeStyle="rgba("+p+","+g+","+v+","+u+")",h.lineWidth=f,m+=3;break;case y.FILL_STYLE:d=o[m+1],l=o[m+2],p=(16711680&d)>>>16,g=(65280&d)>>>8,v=255&d,h.fillStyle="rgba("+p+","+g+","+v+","+l+")",m+=2;break;case y.BEGIN_PATH:h.beginPath();break;case y.CLOSE_PATH:h.closePath();break;case y.FILL_PATH:r||h.fill();break;case y.STROKE_PATH:r||h.stroke();break;case y.FILL_RECT:r?h.rect(o[m+1],o[m+2],o[m+3],o[m+4]):h.fillRect(o[m+1],o[m+2],o[m+3],o[m+4]),m+=4;break;case y.FILL_TRIANGLE:h.beginPath(),h.moveTo(o[m+1],o[m+2]),h.lineTo(o[m+3],o[m+4]),h.lineTo(o[m+5],o[m+6]),h.closePath(),r||h.fill(),m+=6;break;case y.STROKE_TRIANGLE:h.beginPath(),h.moveTo(o[m+1],o[m+2]),h.lineTo(o[m+3],o[m+4]),h.lineTo(o[m+5],o[m+6]),h.closePath(),r||h.stroke(),m+=6;break;case y.LINE_TO:h.lineTo(o[m+1],o[m+2]),m+=2;break;case y.MOVE_TO:h.moveTo(o[m+1],o[m+2]),m+=2;break;case y.LINE_FX_TO:h.lineTo(o[m+1],o[m+2]),m+=5;break;case y.MOVE_FX_TO:h.moveTo(o[m+1],o[m+2]),m+=5;break;case y.SAVE:h.save();break;case y.RESTORE:h.restore();break;case y.TRANSLATE:h.translate(o[m+1],o[m+2]),m+=2;break;case y.SCALE:h.scale(o[m+1],o[m+2]),m+=2;break;case y.ROTATE:h.rotate(o[m+1]),m+=1;break;case y.GRADIENT_FILL_STYLE:m+=5;break;case y.GRADIENT_LINE_STYLE:m+=6;}}h.restore();}};},function(t,e,i){var n=i(0),s=i(137),r=i(80),o=i(2),a=i(68),h=new n({initialize:function(t,e,i,n){void 0===n&&(n=!1),this.propertyKey=e,this.propertyValue=i,this.defaultValue=i,this.steps=0,this.counter=0,this.start=0,this.end=0,this.ease,this.emitOnly=n,this.onEmit=this.defaultEmit,this.onUpdate=this.defaultUpdate,this.loadConfig(t);},loadConfig:function(t,e){void 0===t&&(t={}),e&&(this.propertyKey=e),this.propertyValue=o(t,this.propertyKey,this.defaultValue),this.setMethods(),this.emitOnly&&(this.onUpdate=this.defaultUpdate);},toJSON:function(){return this.propertyValue;},onChange:function(t){return this.propertyValue=t,this.setMethods();},setMethods:function(){var t,e,i,n=this.propertyValue,s=typeof n;return this.onEmit=this.defaultEmit,this.onUpdate=this.defaultUpdate,"number"==s?(this.onEmit=this.staticValueEmit,this.onUpdate=this.staticValueUpdate):Array.isArray(n)?this.onEmit=this.randomStaticValueEmit:"function"==s?this.emitOnly?this.onEmit=n:this.onUpdate=n:"object"==s&&this.hasBoth(n,"start","end")?(this.start=n.start,this.end=n.end,(t=this.has(n,"random"))&&(this.onEmit=this.randomRangedValueEmit),this.has(n,"steps")?(this.steps=n.steps,this.counter=this.start,this.onEmit=this.steppedEmit):(e=this.has(n,"ease")?n.ease:"Linear",this.ease=r(e,n.easeParams),t||(this.onEmit=this.easedValueEmit),this.onUpdate=this.easeValueUpdate)):"object"==s&&this.hasBoth(n,"min","max")?(this.start=n.min,this.end=n.max,this.onEmit=this.randomRangedValueEmit):"object"==s&&this.has(n,"random")?(i=n.random,Array.isArray(i)&&(this.start=i[0],this.end=i[1]),this.onEmit=this.randomRangedValueEmit):"object"==s&&this.hasEither(n,"onEmit","onUpdate")&&(this.has(n,"onEmit")&&(this.onEmit=n.onEmit),this.has(n,"onUpdate")&&(this.onUpdate=n.onUpdate)),this;},has:function(t,e){return t.hasOwnProperty(e);},hasBoth:function(t,e,i){return t.hasOwnProperty(e)&&t.hasOwnProperty(i);},hasEither:function(t,e,i){return t.hasOwnProperty(e)||t.hasOwnProperty(i);},defaultEmit:function(t,e,i){return i;},defaultUpdate:function(t,e,i,n){return n;},staticValueEmit:function(){return this.propertyValue;},staticValueUpdate:function(){return this.propertyValue;},randomStaticValueEmit:function(){var t=Math.floor(Math.random()*this.propertyValue.length);return this.propertyValue[t];},randomRangedValueEmit:function(t,e){var i=s(this.start,this.end);return t&&t.data[e]&&(t.data[e].min=i),i;},steppedEmit:function(){var t=this.counter,e=this.counter+(this.end-this.start)/this.steps;return this.counter=a(e,this.start,this.end),t;},easedValueEmit:function(t,e){var i;return t&&t.data[e]&&((i=t.data[e]).min=this.start,i.max=this.end),this.start;},easeValueUpdate:function(t,e,i){var n=t.data[e];return(n.max-n.min)*this.ease(i)+n.min;}});t.exports=h;},function(t,e,i){var n=i(0),o=i(2),s=new n({initialize:function(t,e,i,n,s){var r;"object"==typeof t?(t=o(r=t,"x",0),e=o(r,"y",0),i=o(r,"power",0),n=o(r,"epsilon",100),s=o(r,"gravity",50)):(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=100),void 0===s&&(s=50)),this.x=t,this.y=e,this.active=!0,this._gravity=s,this._power=0,this._epsilon=0,this.power=i,this.epsilon=n;},update:function(t,e){var i,n,s=this.x-t.x,r=this.y-t.y,o=s*s+r*r;0!==o&&(i=Math.sqrt(o),o<this._epsilon&&(o=this._epsilon),n=this._power*e/(o*i)*100,t.velocityX+=s*n,t.velocityY+=r*n);},epsilon:{get:function(){return Math.sqrt(this._epsilon);},set:function(t){this._epsilon=t*t;}},power:{get:function(){return this._power/this._gravity;},set:function(t){this._power=t*this._gravity;}},gravity:{get:function(){return this._gravity;},set:function(t){var e=this.power;this._gravity=t,this.power=e;}}});t.exports=s;},function(t,e,i){var n=i(0),l=i(36),c=i(50),s=new n({initialize:function(t){this.emitter=t,this.frame=null,this.x=0,this.y=0,this.velocityX=0,this.velocityY=0,this.accelerationX=0,this.accelerationY=0,this.maxVelocityX=1e4,this.maxVelocityY=1e4,this.bounce=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.angle=0,this.rotation=0,this.tint=16777215,this.life=1e3,this.lifeCurrent=1e3,this.delayCurrent=0,this.lifeT=0,this.data={tint:{min:16777215,max:16777215,current:16777215},alpha:{min:1,max:1},rotate:{min:0,max:0},scaleX:{min:1,max:1},scaleY:{min:1,max:1}};},isAlive:function(){return 0<this.lifeCurrent;},resetPosition:function(){this.x=0,this.y=0;},fire:function(t,e){var i=this.emitter;this.frame=i.getFrame(),i.emitZone&&i.emitZone.getPoint(this),this.x+=void 0===t?i.x.onEmit(this,"x"):t,this.y+=void 0===e?i.y.onEmit(this,"y"):e,this.life=i.lifespan.onEmit(this,"lifespan"),this.lifeCurrent=this.life,this.lifeT=0;var n,s,r,o,a,h=i.speedX.onEmit(this,"speedX"),u=i.speedY?i.speedY.onEmit(this,"speedY"):h;i.radial?(n=l(i.angle.onEmit(this,"angle")),this.velocityX=Math.cos(n)*Math.abs(h),this.velocityY=Math.sin(n)*Math.abs(u)):i.moveTo?(s=i.moveToX.onEmit(this,"moveToX"),r=i.moveToY?i.moveToY.onEmit(this,"moveToY"):s,o=Math.atan2(r-this.y,s-this.x),a=c(this.x,this.y,s,r)/(this.life/1e3),this.velocityX=Math.cos(o)*a,this.velocityY=Math.sin(o)*a):(this.velocityX=h,this.velocityY=u),i.acceleration&&(this.accelerationX=i.accelerationX.onEmit(this,"accelerationX"),this.accelerationY=i.accelerationY.onEmit(this,"accelerationY")),this.maxVelocityX=i.maxVelocityX.onEmit(this,"maxVelocityX"),this.maxVelocityY=i.maxVelocityY.onEmit(this,"maxVelocityY"),this.delayCurrent=i.delay.onEmit(this,"delay"),this.scaleX=i.scaleX.onEmit(this,"scaleX"),this.scaleY=i.scaleY?i.scaleY.onEmit(this,"scaleY"):this.scaleX,this.angle=i.rotate.onEmit(this,"rotate"),this.rotation=l(this.angle),this.bounce=i.bounce.onEmit(this,"bounce"),this.alpha=i.alpha.onEmit(this,"alpha"),this.tint=i.tint.onEmit(this,"tint");},computeVelocity:function(t,e,i,n){var s=this.velocityX,r=this.velocityY,o=this.accelerationX,a=this.accelerationY,h=this.maxVelocityX,u=this.maxVelocityY;s+=t.gravityX*i,r+=t.gravityY*i,o&&(s+=o*i),a&&(r+=a*i),h<s?s=h:s<-h&&(s=-h),u<r?r=u:r<-u&&(r=-u),this.velocityX=s,this.velocityY=r;for(var l=0;l<n.length;l++)n[l].update(this,e,i);},checkBounds:function(t){var e=t.bounds,i=-this.bounce;this.x<e.x&&t.collideLeft?(this.x=e.x,this.velocityX*=i):this.x>e.right&&t.collideRight&&(this.x=e.right,this.velocityX*=i),this.y<e.y&&t.collideTop?(this.y=e.y,this.velocityY*=i):this.y>e.bottom&&t.collideBottom&&(this.y=e.bottom,this.velocityY*=i);},update:function(t,e,i){if(0<this.delayCurrent)return this.delayCurrent-=t,!1;var n=this.emitter,s=1-this.lifeCurrent/this.life;return this.lifeT=s,this.computeVelocity(n,t,e,i),this.x+=this.velocityX*e,this.y+=this.velocityY*e,n.bounds&&this.checkBounds(n),n.deathZone&&n.deathZone.willKill(this)?!(this.lifeCurrent=0):(this.scaleX=n.scaleX.onUpdate(this,"scaleX",s,this.scaleX),n.scaleY?this.scaleY=n.scaleY.onUpdate(this,"scaleY",s,this.scaleY):this.scaleY=this.scaleX,this.angle=n.rotate.onUpdate(this,"rotate",s,this.angle),this.rotation=l(this.angle),this.alpha=n.alpha.onUpdate(this,"alpha",s,this.alpha),this.tint=n.tint.onUpdate(this,"tint",s,this.tint),this.lifeCurrent-=t,this.lifeCurrent<=0);}});t.exports=s;},function(t,e,i){var n=i(35),s=i(0),r=i(11),o=i(453),a=i(454),h=i(449),u=i(2),l=i(210),c=i(455),d=i(126),f=i(451),p=i(456),g=i(10),v=i(79),m=i(3),y=i(68),x=new s({Mixins:[r.BlendMode,r.Mask,r.ScrollFactor,r.Visible],initialize:function(t,e){this.manager=t,this.texture=t.texture,this.frames=[t.defaultFrame],this.defaultFrame=t.defaultFrame,this.configFastMap=["active","blendMode","collideBottom","collideLeft","collideRight","collideTop","deathCallback","deathCallbackScope","emitCallback","emitCallbackScope","follow","frequency","gravityX","gravityY","maxParticles","name","on","particleBringToTop","particleClass","radial","timeScale","trackVisible","visible"],this.configOpMap=["accelerationX","accelerationY","angle","alpha","bounce","delay","lifespan","maxVelocityX","maxVelocityY","moveToX","moveToY","quantity","rotate","scaleX","scaleY","speedX","speedY","tint","x","y"],this.name="",this.particleClass=f,this.x=new h(e,"x",0,!0),this.y=new h(e,"y",0,!0),this.radial=!0,this.gravityX=0,this.gravityY=0,this.acceleration=!1,this.accelerationX=new h(e,"accelerationX",0,!0),this.accelerationY=new h(e,"accelerationY",0,!0),this.maxVelocityX=new h(e,"maxVelocityX",1e4,!0),this.maxVelocityY=new h(e,"maxVelocityY",1e4,!0),this.speedX=new h(e,"speedX",0,!0),this.speedY=new h(e,"speedY",0,!0),this.moveTo=!1,this.moveToX=new h(e,"moveToX",0,!0),this.moveToY=new h(e,"moveToY",0,!0),this.bounce=new h(e,"bounce",0,!0),this.scaleX=new h(e,"scaleX",1),this.scaleY=new h(e,"scaleY",1),this.tint=new h(e,"tint",16777215),this.alpha=new h(e,"alpha",1),this.lifespan=new h(e,"lifespan",1e3,!0),this.angle=new h(e,"angle",{min:0,max:360},!0),this.rotate=new h(e,"rotate",0),this.emitCallback=null,this.emitCallbackScope=null,this.deathCallback=null,this.deathCallbackScope=null,this.maxParticles=0,this.quantity=new h(e,"quantity",1,!0),this.delay=new h(e,"delay",0,!0),this.frequency=0,this.on=!0,this.particleBringToTop=!0,this.timeScale=1,this.emitZone=null,this.deathZone=null,this.bounds=null,this.collideLeft=!0,this.collideRight=!0,this.collideTop=!0,this.collideBottom=!0,this.active=!0,this.visible=!0,this.blendMode=n.NORMAL,this.follow=null,this.followOffset=new m(),this.trackVisible=!1,this.currentFrame=0,this.randomFrame=!0,this.frameQuantity=1,this.dead=[],this.alive=[],this._counter=0,this._frameCounter=0,e&&this.fromJSON(e);},fromJSON:function(t){if(!t)return this;for(var e,i=0,n="",i=0;i<this.configFastMap.length;i++)n=this.configFastMap[i],d(t,n)&&(this[n]=u(t,n));for(i=0;i<this.configOpMap.length;i++)n=this.configOpMap[i],d(t,n)&&this[n].loadConfig(t);return this.acceleration=0!==this.accelerationX.propertyValue||0!==this.accelerationY.propertyValue,this.moveTo=0!==this.moveToX.propertyValue||0!==this.moveToY.propertyValue,d(t,"speed")&&(this.speedX.loadConfig(t,"speed"),this.speedY=null),(c(t,["speedX","speedY"])||this.moveTo)&&(this.radial=!1),d(t,"scale")&&(this.scaleX.loadConfig(t,"scale"),this.scaleY=null),d(t,"callbackScope")&&(e=u(t,"callbackScope",null),this.emitCallbackScope=e,this.deathCallbackScope=e),d(t,"emitZone")&&this.setEmitZone(t.emitZone),d(t,"deathZone")&&this.setDeathZone(t.deathZone),d(t,"bounds")&&this.setBounds(t.bounds),d(t,"followOffset")&&this.followOffset.setFromObject(u(t,"followOffset",0)),d(t,"frame")&&this.setFrame(t.frame),d(t,"reserve")&&this.reserve(t.reserve),this;},toJSON:function(t){void 0===t&&(t={});for(var e=0,i="",e=0;e<this.configFastMap.length;e++)t[i=this.configFastMap[e]]=this[i];for(e=0;e<this.configOpMap.length;e++)this[i=this.configOpMap[e]]&&(t[i]=this[i].toJSON());return this.speedY||(delete t.speedX,t.speed=this.speedX.toJSON()),this.scaleY||(delete t.scaleX,t.scale=this.scaleX.toJSON()),t;},startFollow:function(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=!1),this.follow=t,this.followOffset.set(e,i),this.trackVisible=n,this;},stopFollow:function(){return this.follow=null,this.followOffset.set(0,0),this.trackVisible=!1,this;},getFrame:function(){if(1===this.frames.length)return this.defaultFrame;if(this.randomFrame)return l(this.frames);var t=this.frames[this.currentFrame];return this._frameCounter++,this._frameCounter===this.frameQuantity&&(this._frameCounter=0,this.currentFrame=y(this.currentFrame+1,0,this._frameLength)),t;},setFrame:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=1),this.randomFrame=e,this.frameQuantity=i,this.currentFrame=0,this._frameCounter=0;var n,s,r=typeof t;return Array.isArray(t)||"string"==r||"number"==r?this.manager.setEmitterFrames(t,this):"object"==r&&((t=u(n=t,"frames",null))&&this.manager.setEmitterFrames(t,this),s=u(n,"cycle",!1),this.randomFrame=!s,this.frameQuantity=u(n,"quantity",i)),this._frameLength=this.frames.length,1===this._frameLength&&(this.frameQuantity=1,this.randomFrame=!1),this;},setRadial:function(t){return void 0===t&&(t=!0),this.radial=t,this;},setPosition:function(t,e){return this.x.onChange(t),this.y.onChange(e),this;},setBounds:function(t,e,i,n){var s;return"object"==typeof t&&(t=(s=t).x,e=s.y,i=d(s,"w")?s.w:s.width,n=d(s,"h")?s.h:s.height),this.bounds?this.bounds.setTo(t,e,i,n):this.bounds=new g(t,e,i,n),this;},setSpeedX:function(t){return this.speedX.onChange(t),this.radial=!1,this;},setSpeedY:function(t){return this.speedY&&(this.speedY.onChange(t),this.radial=!1),this;},setSpeed:function(t){return this.speedX.onChange(t),this.speedY=null,this.radial=!0,this;},setScaleX:function(t){return this.scaleX.onChange(t),this;},setScaleY:function(t){return this.scaleY.onChange(t),this;},setScale:function(t){return this.scaleX.onChange(t),this.scaleY=null,this;},setGravityX:function(t){return this.gravityX=t,this;},setGravityY:function(t){return this.gravityY=t,this;},setGravity:function(t,e){return this.gravityX=t,this.gravityY=e,this;},setAlpha:function(t){return this.alpha.onChange(t),this;},setTint:function(t){return this.tint.onChange(t),this;},setEmitterAngle:function(t){return this.angle.onChange(t),this;},setAngle:function(t){return this.angle.onChange(t),this;},setLifespan:function(t){return this.lifespan.onChange(t),this;},setQuantity:function(t){return this.quantity.onChange(t),this;},setFrequency:function(t,e){return this.frequency=t,this._counter=0,e&&this.quantity.onChange(e),this;},setEmitZone:function(t){if(void 0===t)this.emitZone=null;else{var e=u(t,"type","random"),i=u(t,"source",null);switch(e){case"random":this.emitZone=new p(i);break;case"edge":var n=u(t,"quantity",1),s=u(t,"stepRate",0),r=u(t,"yoyo",!1),o=u(t,"seamless",!0);this.emitZone=new a(i,n,s,r,o);}}return this;},setDeathZone:function(t){var e,i,n;return void 0===t?this.deathZone=null:(e=u(t,"type","onEnter"),(i=u(t,"source",null))&&"function"==typeof i.contains&&(n="onEnter"===e,this.deathZone=new o(i,n))),this;},reserve:function(t){for(var e=this.dead,i=0;i<t;i++)e.push(new this.particleClass(this));return this;},getAliveParticleCount:function(){return this.alive.length;},getDeadParticleCount:function(){return this.dead.length;},getParticleCount:function(){return this.getAliveParticleCount()+this.getDeadParticleCount();},atLimit:function(){return 0<this.maxParticles&&this.getParticleCount()===this.maxParticles;},onParticleEmit:function(t,e){return void 0===t?(this.emitCallback=null,this.emitCallbackScope=null):"function"==typeof t&&(this.emitCallback=t,e&&(this.emitCallbackScope=e)),this;},onParticleDeath:function(t,e){return void 0===t?(this.deathCallback=null,this.deathCallbackScope=null):"function"==typeof t&&(this.deathCallback=t,e&&(this.deathCallbackScope=e)),this;},killAll:function(){for(var t=this.dead,e=this.alive;0<e.length;)t.push(e.pop());return this;},forEachAlive:function(t,e){for(var i=this.alive,n=i.length,s=0;s<n;++s)t.call(e,i[s],this);return this;},forEachDead:function(t,e){for(var i=this.dead,n=i.length,s=0;s<n;++s)t.call(e,i[s],this);return this;},start:function(){return this.on=!0,this._counter=0,this;},stop:function(){return this.on=!1,this;},pause:function(){return this.active=!1,this;},resume:function(){return this.active=!0,this;},remove:function(){return this.manager.removeEmitter(this),this;},depthSort:function(){return v(this.alive,this.depthSortCallback),this;},flow:function(t,e){return void 0===e&&(e=1),this.frequency=t,this.quantity.onChange(e),this.start();},explode:function(t,e,i){return this.frequency=-1,this.emitParticle(t,e,i);},emitParticleAt:function(t,e,i){return this.emitParticle(i,t,e);},emitParticle:function(t,e,i){if(!this.atLimit()){void 0===t&&(t=this.quantity.onEmit());for(var n=this.dead,s=this.follow?this.follow.x+this.followOffset.x:e,r=this.follow?this.follow.y+this.followOffset.y:i,o=0;o<t;o++){var a=n.pop();if((a=a||new this.particleClass(this)).fire(s,r),this.particleBringToTop?this.alive.push(a):this.alive.unshift(a),this.emitCallback&&this.emitCallback.call(this.emitCallbackScope,a,this),this.atLimit())break;}return a;}},preUpdate:function(t,e){var i=(e*=this.timeScale)/1e3;this.trackVisible&&(this.visible=this.follow.visible);var n=this.manager.getProcessors(),s=this.alive,r=this.dead,o=0,a=[],h=s.length;for(o=0;o<h;o++){var u=s[o];u.update(e,i,n)&&a.push({index:o,particle:u});}if(0<(h=a.length))for(var l=this.deathCallback,c=this.deathCallbackScope,o=h-1;0<=o;o--){var d=a[o];s.splice(d.index,1),r.push(d.particle),l&&l.call(c,d.particle),d.particle.resetPosition();}this.on&&(0===this.frequency?this.emitParticle():0<this.frequency&&(this._counter-=e,this._counter<=0&&(this.emitParticle(),this._counter=this.frequency-Math.abs(this._counter))));},depthSortCallback:function(t,e){return t.y-e.y;}});t.exports=x;},function(t,e,i){var n=new(i(0))({initialize:function(t,e){this.source=t,this.killOnEnter=e;},willKill:function(t){var e=this.source.contains(t.x,t.y);return e&&this.killOnEnter||!e&&!this.killOnEnter;}});t.exports=n;},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0),this.source=t,this.points=[],this.quantity=e,this.stepRate=i,this.yoyo=n,this.counter=-1,this.seamless=s,this._length=0,this._direction=0,this.updateSource();},updateSource:function(){var t,e;this.points=this.source.getPoints(this.quantity,this.stepRate),this.seamless&&(t=this.points[0],e=this.points[this.points.length-1],t.x===e.x&&t.y===e.y&&this.points.pop());var i=this._length;return this._length=this.points.length,this._length<i&&this.counter>this._length&&(this.counter=this._length-1),this;},changeSource:function(t){return this.source=t,this.updateSource();},getPoint:function(t){0===this._direction?(this.counter++,this.counter>=this._length&&(this.yoyo?(this._direction=1,this.counter=this._length-1):this.counter=0)):(this.counter--,-1===this.counter&&(this.yoyo?(this._direction=0,this.counter=0):this.counter=this._length-1));var e=this.points[this.counter];e&&(t.x=e.x,t.y=e.y);}});t.exports=n;},function(t,e){t.exports=function(t,e){for(var i=0;i<e.length;i++)if(t.hasOwnProperty(e[i]))return!0;return!1;};},function(t,e,i){var n=i(0),s=i(3),r=new n({initialize:function(t){this.source=t,this._tempVec=new s();},getPoint:function(t){var e=this._tempVec;this.source.getRandomPoint(e),t.x=e.x,t.y=e.y;}});t.exports=r;},function(t,e,i){var n=i(0),s=i(11),o=i(73),r=new n({Extends:o,Mixins:[s.PathFollower],initialize:function(t,e,i,n,s,r){o.call(this,t,i,n,s,r),this.path=e;},preUpdate:function(t,e){this.anims.update(t,e),this.pathUpdate(t);}});t.exports=r;},function(t,e){t.exports=function(t,e,i){var n=t.canvas,s=t.context,r=t.style,o=[],a=0,h=i.length;0<r.maxLines&&r.maxLines<i.length&&(h=r.maxLines),r.syncFont(n,s);for(var u=0;u<h;u++){var l=r.strokeThickness;l+=s.measureText(i[u]).width,r.wordWrap&&(l-=s.measureText(" ").width),o[u]=Math.ceil(l),a=Math.max(a,o[u]);}var c=e.fontSize+r.strokeThickness,d=c*h,f=t.lineSpacing;return 1<h&&(d+=f*(h-1)),{width:a,height:d,lines:h,lineWidths:o,lineSpacing:f,lineHeight:c};};},function(t,e,i){var n=i(0),a=i(13),h=i(6),s=i(460),u={fontFamily:["fontFamily","Courier"],fontSize:["fontSize","16px"],fontStyle:["fontStyle",""],backgroundColor:["backgroundColor",null],color:["color","#fff"],stroke:["stroke","#fff"],strokeThickness:["strokeThickness",0],shadowOffsetX:["shadow.offsetX",0],shadowOffsetY:["shadow.offsetY",0],shadowColor:["shadow.color","#000"],shadowBlur:["shadow.blur",0],shadowStroke:["shadow.stroke",!1],shadowFill:["shadow.fill",!1],align:["align","left"],maxLines:["maxLines",0],fixedWidth:["fixedWidth",0],fixedHeight:["fixedHeight",0],resolution:["resolution",0],rtl:["rtl",!1],testString:["testString","|MÃ‰qgy"],baselineX:["baselineX",1.2],baselineY:["baselineY",1.4],wordWrapWidth:["wordWrap.width",null],wordWrapCallback:["wordWrap.callback",null],wordWrapCallbackScope:["wordWrap.callbackScope",null],wordWrapUseAdvanced:["wordWrap.useAdvancedWrap",!1]},r=new n({initialize:function(t,e){this.parent=t,this.fontFamily,this.fontSize,this.fontStyle,this.backgroundColor,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.align,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.rtl,this.testString,this.baselineX,this.baselineY,this.wordWrapWidth,this.wordWrapCallback,this.wordWrapCallbackScope,this.wordWrapUseAdvanced,this._font,this.setStyle(e,!1,!0);var i=h(e,"metrics",!1);this.metrics=i?{ascent:h(i,"ascent",0),descent:h(i,"descent",0),fontSize:h(i,"fontSize",0)}:s(this);},setStyle:function(t,e,i){for(var n in void 0===e&&(e=!0),void 0===i&&(i=!1),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),u){var s=i?u[n][1]:this[n];this[n]=("wordWrapCallback"===n||"wordWrapCallbackScope"===n?h:a)(t,u[n][0],s);}var r=h(t,"font",null);null!==r&&this.setFont(r,!1),this._font=[this.fontStyle,this.fontSize,this.fontFamily].join(" ").trim();var o=h(t,"fill",null);return null!==o&&(this.color=o),e?this.update(!0):this.parent;},syncFont:function(t,e){e.font=this._font;},syncStyle:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round";},syncShadow:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0);},update:function(t){return t&&(this._font=[this.fontStyle,this.fontSize,this.fontFamily].join(" ").trim(),this.metrics=s(this)),this.parent.updateText();},setFont:function(t,e){void 0===e&&(e=!0);var i,n,s=t,r="",o="";return"string"!=typeof t?(s=h(t,"fontFamily","Courier"),r=h(t,"fontSize","16px"),o=h(t,"fontStyle","")):(n=0,o=2<(i=t.split(" ")).length?i[n++]:"",r=i[n++]||"16px",s=i[n++]||"Courier"),s===this.fontFamily&&r===this.fontSize&&o===this.fontStyle||(this.fontFamily=s,this.fontSize=r,this.fontStyle=o,e&&this.update(!0)),this.parent;},setFontFamily:function(t){return this.fontFamily!==t&&(this.fontFamily=t,this.update(!0)),this.parent;},setFontStyle:function(t){return this.fontStyle!==t&&(this.fontStyle=t,this.update(!0)),this.parent;},setFontSize:function(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize!==t&&(this.fontSize=t,this.update(!0)),this.parent;},setTestString:function(t){return this.testString=t,this.update(!0);},setFixedSize:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(!1);},setBackgroundColor:function(t){return this.backgroundColor=t,this.update(!1);},setFill:function(t){return this.color=t,this.update(!1);},setColor:function(t){return this.color=t,this.update(!1);},setResolution:function(t){return this.resolution=t,this.update(!1);},setStroke:function(t,e){return void 0===e&&(e=this.strokeThickness),void 0===t&&0!==this.strokeThickness?(this.strokeThickness=0,this.update(!0)):this.stroke===t&&this.strokeThickness===e||(this.stroke=t,this.strokeThickness=e,this.update(!0)),this.parent;},setShadow:function(t,e,i,n,s,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i="#000"),void 0===n&&(n=0),void 0===s&&(s=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=i,this.shadowBlur=n,this.shadowStroke=s,this.shadowFill=r,this.update(!1);},setShadowOffset:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1);},setShadowColor:function(t){return void 0===t&&(t="#000"),this.shadowColor=t,this.update(!1);},setShadowBlur:function(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1);},setShadowStroke:function(t){return this.shadowStroke=t,this.update(!1);},setShadowFill:function(t){return this.shadowFill=t,this.update(!1);},setWordWrapWidth:function(t,e){return void 0===e&&(e=!1),this.wordWrapWidth=t,this.wordWrapUseAdvanced=e,this.update(!1);},setWordWrapCallback:function(t,e){return void 0===e&&(e=null),this.wordWrapCallback=t,this.wordWrapCallbackScope=e,this.update(!1);},setAlign:function(t){return void 0===t&&(t="left"),this.align=t,this.update(!1);},setMaxLines:function(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1);},getTextMetrics:function(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize};},toJSON:function(){var t={};for(var e in u)t[e]=this[e];return t.metrics=this.getTextMetrics(),t;},destroy:function(){this.parent=void 0;}});t.exports=r;},function(t,e,i){var y=i(31);t.exports=function(t){var e=y.create(this),i=e.getContext("2d");t.syncFont(e,i);var n=i.measureText(t.testString);if("actualBoundingBoxAscent"in n){var s=n.actualBoundingBoxAscent,r=n.actualBoundingBoxDescent;return y.remove(e),{ascent:s,descent:r,fontSize:s+r};}var o=Math.ceil(n.width*t.baselineX),a=2*(h=o),h=h*t.baselineY|0;e.width=o,e.height=a,i.fillStyle="#f00",i.fillRect(0,0,o,a),i.font=t._font,i.textBaseline="alphabetic",i.fillStyle="#000",i.fillText(t.testString,0,h);var u={ascent:0,descent:0,fontSize:0},l=i.getImageData(0,0,o,a);if(!l)return u.ascent=h,u.descent=6+h,u.fontSize=u.ascent+u.descent,y.remove(e),u;for(var c,d=l.data,f=d.length,p=4*o,g=0,v=!1,m=0;m<h;m++){for(c=0;c<p;c+=4)if(255!==d[g+c]){v=!0;break;}if(v)break;g+=p;}for(u.ascent=h-m,g=f-p,v=!1,m=a;h<m;m--){for(c=0;c<p;c+=4)if(255!==d[g+c]){v=!0;break;}if(v)break;g-=p;}return u.descent=m-h,u.fontSize=u.ascent+u.descent,y.remove(e),u;};},function(t,e,i){var n=i(1097),s=i(0),u=i(36),l=i(59),c=i(65),d=i(14),f=i(34),r=new s({Extends:f,Mixins:[n],initialize:function(t,e,i,n,s,r,o,a,h){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=128),void 0===s&&(s=0),void 0===r&&(r=360),void 0===o&&(o=!1),f.call(this,t,"Arc",new c(0,0,n)),this._startAngle=s,this._endAngle=r,this._anticlockwise=o,this._iterations=.01,this.setPosition(e,i);var u=2*this.geom.radius;this.setSize(u,u),void 0!==a&&this.setFillStyle(a,h),this.updateDisplayOrigin(),this.updateData();},iterations:{get:function(){return this._iterations;},set:function(t){this._iterations=t,this.updateData();}},radius:{get:function(){return this.geom.radius;},set:function(t){var e=2*(this.geom.radius=t);this.setSize(e,e),this.updateDisplayOrigin(),this.updateData();}},startAngle:{get:function(){return this._startAngle;},set:function(t){this._startAngle=t,this.updateData();}},endAngle:{get:function(){return this._endAngle;},set:function(t){this._endAngle=t,this.updateData();}},anticlockwise:{get:function(){return this._anticlockwise;},set:function(t){this._anticlockwise=t,this.updateData();}},setRadius:function(t){return this.radius=t,this;},setIterations:function(t){return void 0===t&&(t=.01),this.iterations=t,this;},setStartAngle:function(t,e){return this._startAngle=t,void 0!==e&&(this._anticlockwise=e),this.updateData();},setEndAngle:function(t,e){return this._endAngle=t,void 0!==e&&(this._anticlockwise=e),this.updateData();},updateData:function(){var t=this._iterations,e=t,i=this.geom.radius,n=u(this._startAngle),s=u(this._endAngle),r=i,o=i;s-=n,this._anticlockwise?s<-d.PI2?s=-d.PI2:0<s&&(s=-d.PI2+s%d.PI2):s>d.PI2?s=d.PI2:s<0&&(s=d.PI2+s%d.PI2);for(var a,h=[r+Math.cos(n)*i,o+Math.sin(n)*i];e<1;)a=s*e+n,h.push(r+Math.cos(a)*i,o+Math.sin(a)*i),e+=t;return a=s+n,h.push(r+Math.cos(a)*i,o+Math.sin(a)*i),h.push(r+Math.cos(n)*i,o+Math.sin(n)*i),this.pathIndexes=l(h),this.pathData=h,this;}});t.exports=r;},function(t,e,i){var n=i(0),s=i(1100),r=i(59),o=i(10),a=i(34),h=new n({Extends:a,Mixins:[s],initialize:function(t,e,i,n,s,r){void 0===e&&(e=0),void 0===i&&(i=0),a.call(this,t,"Curve",n),this._smoothness=32,this._curveBounds=new o(),this.closePath=!1,this.setPosition(e,i),void 0!==s&&this.setFillStyle(s,r),this.updateData();},smoothness:{get:function(){return this._smoothness;},set:function(t){this._smoothness=t,this.updateData();}},setSmoothness:function(t){return this._smoothness=t,this.updateData();},updateData:function(){var t=this._curveBounds,e=this._smoothness;this.geom.getBounds(t,e),this.setSize(t.width,t.height),this.updateDisplayOrigin();for(var i=[],n=this.geom.getPoints(e),s=0;s<n.length;s++)i.push(n[s].x,n[s].y);return i.push(n[0].x,n[0].y),this.pathIndexes=r(i),this.pathData=i,this;}});t.exports=h;},function(t,e,i){var n=i(0),s=i(59),r=i(1103),a=i(111),h=i(34),o=new n({Extends:h,Mixins:[r],initialize:function(t,e,i,n,s,r,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=128),void 0===s&&(s=128),h.call(this,t,"Ellipse",new a(n/2,s/2,n,s)),this._smoothness=64,this.setPosition(e,i),this.width=n,this.height=s,void 0!==r&&this.setFillStyle(r,o),this.updateDisplayOrigin(),this.updateData();},smoothness:{get:function(){return this._smoothness;},set:function(t){this._smoothness=t,this.updateData();}},setSize:function(t,e){return this.width=t,this.height=e,this.geom.setPosition(t/2,e/2),this.geom.setSize(t,e),this.updateData();},setSmoothness:function(t){return this._smoothness=t,this.updateData();},updateData:function(){for(var t=[],e=this.geom.getPoints(this._smoothness),i=0;i<e.length;i++)t.push(e[i].x,e[i].y);return t.push(e[0].x,e[0].y),this.pathIndexes=s(t),this.pathData=t,this;}});t.exports=o;},function(t,e,i){var n=i(0),c=i(34),s=i(1106),r=new n({Extends:c,Mixins:[s],initialize:function(t,e,i,n,s,r,o,a,h,u,l){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=128),void 0===s&&(s=128),void 0===r&&(r=32),void 0===o&&(o=32),c.call(this,t,"Grid",null),this.cellWidth=r,this.cellHeight=o,this.showCells=!0,this.outlineFillColor=0,this.outlineFillAlpha=0,this.showOutline=!0,this.showAltCells=!1,this.altFillColor,this.altFillAlpha,this.setPosition(e,i),this.setSize(n,s),this.setFillStyle(a,h),void 0!==u&&this.setOutlineStyle(u,l),this.updateDisplayOrigin();},setFillStyle:function(t,e){return void 0===e&&(e=1),void 0===t?this.showCells=!1:(this.fillColor=t,this.fillAlpha=e,this.showCells=!0),this;},setAltFillStyle:function(t,e){return void 0===e&&(e=1),void 0===t?this.showAltCells=!1:(this.altFillColor=t,this.altFillAlpha=e,this.showAltCells=!0),this;},setOutlineStyle:function(t,e){return void 0===e&&(e=1),void 0===t?this.showOutline=!1:(this.outlineFillColor=t,this.outlineFillAlpha=e,this.showOutline=!0),this;}});t.exports=r;},function(t,e,i){var n=i(1109),s=i(0),h=i(34),r=new s({Extends:h,Mixins:[n],initialize:function(t,e,i,n,s,r,o,a){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=48),void 0===s&&(s=32),void 0===r&&(r=15658734),void 0===o&&(o=10066329),void 0===a&&(a=13421772),h.call(this,t,"IsoBox",null),this.projection=4,this.fillTop=r,this.fillLeft=o,this.fillRight=a,this.showTop=!0,this.showLeft=!0,this.showRight=!0,this.isFilled=!0,this.setPosition(e,i),this.setSize(n,s),this.updateDisplayOrigin();},setProjection:function(t){return this.projection=t,this;},setFaces:function(t,e,i){return void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),this.showTop=t,this.showLeft=e,this.showRight=i,this;},setFillStyle:function(t,e,i){return this.fillTop=t,this.fillLeft=e,this.fillRight=i,this.isFilled=!0,this;}});t.exports=r;},function(t,e,i){var n=i(0),s=i(1112),u=i(34),r=new n({Extends:u,Mixins:[s],initialize:function(t,e,i,n,s,r,o,a,h){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=48),void 0===s&&(s=32),void 0===r&&(r=!1),void 0===o&&(o=15658734),void 0===a&&(a=10066329),void 0===h&&(h=13421772),u.call(this,t,"IsoTriangle",null),this.projection=4,this.fillTop=o,this.fillLeft=a,this.fillRight=h,this.showTop=!0,this.showLeft=!0,this.showRight=!0,this.isReversed=r,this.isFilled=!0,this.setPosition(e,i),this.setSize(n,s),this.updateDisplayOrigin();},setProjection:function(t){return this.projection=t,this;},setReversed:function(t){return this.isReversed=t,this;},setFaces:function(t,e,i){return void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),this.showTop=t,this.showLeft=e,this.showRight=i,this;},setFillStyle:function(t,e,i){return this.fillTop=t,this.fillLeft=e,this.fillRight=i,this.isFilled=!0,this;}});t.exports=r;},function(t,e,i){var n=i(0),c=i(34),d=i(47),s=i(1115),r=new n({Extends:c,Mixins:[s],initialize:function(t,e,i,n,s,r,o,a,h){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=128),void 0===o&&(o=0),c.call(this,t,"Line",new d(n,s,r,o));var u=Math.max(1,this.geom.right-this.geom.left),l=Math.max(1,this.geom.bottom-this.geom.top);this.lineWidth=1,this._startWidth=1,this._endWidth=1,this.setPosition(e,i),this.setSize(u,l),void 0!==a&&this.setStrokeStyle(1,a,h),this.updateDisplayOrigin();},setLineWidth:function(t,e){return void 0===e&&(e=t),this._startWidth=t,this._endWidth=e,this.lineWidth=t,this;},setTo:function(t,e,i,n){return this.geom.setTo(t,e,i,n),this;}});t.exports=r;},function(t,e,i){var n=i(1118),s=i(0),r=i(59),a=i(469),h=i(227),u=i(34),o=i(472),l=new s({Extends:u,Mixins:[n],initialize:function(t,e,i,n,s,r){void 0===e&&(e=0),void 0===i&&(i=0),u.call(this,t,"Polygon",new h(n));var o=a(this.geom);this.setPosition(e,i),this.setSize(o.width,o.height),void 0!==s&&this.setFillStyle(s,r),this.updateDisplayOrigin(),this.updateData();},smooth:function(t){void 0===t&&(t=1);for(var e=0;e<t;e++)o(this.geom);return this.updateData();},updateData:function(){for(var t=[],e=this.geom.points,i=0;i<e.length;i++)t.push(e[i].x,e[i].y);return t.push(e[0].x,e[0].y),this.pathIndexes=r(t),this.pathData=t,this;}});t.exports=l;},function(t,e,i){var h=i(10);t.exports=function(t,e){void 0===e&&(e=new h());for(var i,n=1/0,s=1/0,r=-n,o=-s,a=0;a<t.points.length;a++)i=t.points[a],n=Math.min(n,i.x),s=Math.min(s,i.y),r=Math.max(r,i.x),o=Math.max(o,i.y);return e.x=n,e.y=s,e.width=r-n,e.height=o-s,e;};},function(t,e,i){var g=i(67),v=i(47),m=i(471);t.exports=function(t,e,i,n){void 0===n&&(n=[]);var s=t.points,r=m(t);!e&&0<i&&(e=r/i);for(var o=0;o<e;o++)for(var a=r*(o/e),h=0,u=0;u<s.length;u++){var l=s[u],c=s[(u+1)%s.length],d=new v(l.x,l.y,c.x,c.y),f=g(d);if(!(a<h||h+f<a)){var p=d.getPoint((a-h)/f);n.push(p);break;}h+=f;}return n;};},function(t,e,i){var a=i(67),h=i(47);t.exports=function(t){for(var e=t.points,i=0,n=0;n<e.length;n++){var s=e[n],r=e[(n+1)%e.length],o=new h(s.x,s.y,r.x,r.y);i+=a(o);}return i;};},function(t,e){function c(t,e){return t[0]=e[0],t[1]=e[1],t;}t.exports=function(t){for(var e=[],i=t.points,n=0;n<i.length;n++)e.push([i[n].x,i[n].y]);var s=[];for(0<e.length&&s.push(c([0,0],e[0])),n=0;n<e.length-1;n++){var r=e[n],o=e[n+1],a=r[0],h=r[1],u=o[0],l=o[1];s.push([.85*a+.15*u,.85*h+.15*l]),s.push([.15*a+.85*u,.15*h+.85*l]);}return 1<e.length&&s.push(c([0,0],e[e.length-1])),t.setTo(s);};},function(t,e,i){var n=i(0),a=i(10),h=i(34),s=i(1121),r=new n({Extends:h,Mixins:[s],initialize:function(t,e,i,n,s,r,o){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=128),void 0===s&&(s=128),h.call(this,t,"Rectangle",new a(0,0,n,s)),this.setPosition(e,i),this.setSize(n,s),void 0!==r&&this.setFillStyle(r,o),this.updateDisplayOrigin(),this.updateData();},setSize:function(t,e){return this.width=t,this.height=e,this.geom.setSize(t,e),this.updateData(),this;},updateData:function(){var t=[],e=this.geom,i=this._tempLine;return e.getLineA(i),t.push(i.x1,i.y1,i.x2,i.y2),e.getLineB(i),t.push(i.x2,i.y2),e.getLineC(i),t.push(i.x2,i.y2),e.getLineD(i),t.push(i.x2,i.y2),this.pathData=t,this;}});t.exports=r;},function(t,e,i){var n=i(1124),s=i(0),u=i(59),h=i(34),r=new s({Extends:h,Mixins:[n],initialize:function(t,e,i,n,s,r,o,a){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=5),void 0===s&&(s=32),void 0===r&&(r=64),h.call(this,t,"Star",null),this._points=n,this._innerRadius=s,this._outerRadius=r,this.setPosition(e,i),this.setSize(2*r,2*r),void 0!==o&&this.setFillStyle(o,a),this.updateDisplayOrigin(),this.updateData();},setPoints:function(t){return this._points=t,this.updateData();},setInnerRadius:function(t){return this._innerRadius=t,this.updateData();},setOuterRadius:function(t){return this._outerRadius=t,this.updateData();},points:{get:function(){return this._points;},set:function(t){this._points=t,this.updateData();}},innerRadius:{get:function(){return this._innerRadius;},set:function(t){this._innerRadius=t,this.updateData();}},outerRadius:{get:function(){return this._outerRadius;},set:function(t){this._outerRadius=t,this.updateData();}},updateData:function(){var t=[],e=this._points,i=this._innerRadius,n=this._outerRadius,s=Math.PI/2*3,r=Math.PI/e,o=n,a=n;t.push(o,a+-n);for(var h=0;h<e;h++)t.push(o+Math.cos(s)*n,a+Math.sin(s)*n),s+=r,t.push(o+Math.cos(s)*i,a+Math.sin(s)*i),s+=r;return t.push(o,a+-n),this.pathIndexes=u(t),this.pathData=t,this;}});t.exports=r;},function(t,e,i){var n=i(0),f=i(34),p=i(82),s=i(1127),r=new n({Extends:f,Mixins:[s],initialize:function(t,e,i,n,s,r,o,a,h,u,l){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=128),void 0===r&&(r=64),void 0===o&&(o=0),void 0===a&&(a=128),void 0===h&&(h=128),f.call(this,t,"Triangle",new p(n,s,r,o,a,h));var c=this.geom.right-this.geom.left,d=this.geom.bottom-this.geom.top;this.setPosition(e,i),this.setSize(c,d),void 0!==u&&this.setFillStyle(u,l),this.updateDisplayOrigin(),this.updateData();},setTo:function(t,e,i,n,s,r){return this.geom.setTo(t,e,i,n,s,r),this.updateData();},updateData:function(){var t=[],e=this.geom,i=this._tempLine;return e.getLineA(i),t.push(i.x1,i.y1,i.x2,i.y2),e.getLineB(i),t.push(i.x2,i.y2),e.getLineC(i),t.push(i.x2,i.y2),this.pathData=t,this;}});t.exports=r;},function(t,e,i){var c=i(4),d=i(67);t.exports=function(t,e,i){void 0===i&&(i=new c());var n=t.getLineA(),s=t.getLineB(),r=t.getLineC();if(e<=0||1<=e)return i.x=n.x1,i.y=n.y1,i;var o=d(n),a=d(s),h=d(r),u=(o+a+h)*e,l=0;return u<o?(l=u/o,i.x=n.x1+(n.x2-n.x1)*l,i.y=n.y1+(n.y2-n.y1)*l):o+a<u?(l=(u-=o+a)/h,i.x=r.x1+(r.x2-r.x1)*l,i.y=r.y1+(r.y2-r.y1)*l):(l=(u-=o)/a,i.x=s.x1+(s.x2-s.x1)*l,i.y=s.y1+(s.y2-s.y1)*l),i;};},function(t,e,i){var g=i(67),v=i(4);t.exports=function(t,e,i,n){void 0===n&&(n=[]);var s=t.getLineA(),r=t.getLineB(),o=t.getLineC(),a=g(s),h=g(r),u=g(o),l=a+h+u;!e&&0<i&&(e=l/i);for(var c=0;c<e;c++){var d=l*(c/e),f=0,p=new v();d<a?(f=d/a,p.x=s.x1+(s.x2-s.x1)*f,p.y=s.y1+(s.y2-s.y1)*f):a+h<d?(f=(d-=a+h)/u,p.x=o.x1+(o.x2-o.x1)*f,p.y=o.y1+(o.y2-o.y1)*f):(f=(d-=a)/h,p.x=r.x1+(r.x2-r.x1)*f,p.y=r.y1+(r.y2-r.y1)*f),n.push(p);}return n;};},function(t,e){t.exports=function(t,e,i){if(!t||"number"==typeof t)return!1;if(t.hasOwnProperty(e))return t[e]=i,!0;if(-1===e.indexOf("."))return!1;for(var n=e.split("."),s=t,r=t,o=0;o<n.length;o++){if(!s.hasOwnProperty(n[o]))return!1;s=(r=s)[n[o]];}return r[n[n.length-1]]=i,!0;};},function(t,e,i){var P=i(116),O=i(117);t.exports=function(t,e,i,n,s,r,o){if(void 0===n&&(n=!1),void 0===r&&(r=16777215),void 0===o&&(o=1),t.length===e.length){var a={faces:[],vertices:[]},h=n?3:2,u=Array.isArray(r),l=Array.isArray(o);if(Array.isArray(i)&&0<i.length)for(_=0;_<i.length;_++){var c=i[_],d=2*i[_],f=i[_]*h,p=t[f],g=t[1+f],v=n?t[2+f]:0,m=e[d],y=e[1+d],x=u?r[c]:r,T=l?o[c]:o,w=0,E=0,b=0;s&&(w=s[f],E=s[1+f],b=n?s[2+f]:0),a.vertices.push(new O(p,g,v,m,y,x,T,w,E,b));}else for(var S=0,A=0,_=0;_<t.length;_+=h)p=t[_],g=t[_+1],v=n?t[_+2]:0,m=e[S],y=e[S+1],x=u?r[A]:r,T=l?o[A]:o,b=E=w=0,s&&(w=s[_],E=s[_+1],b=n?s[_+2]:0),a.vertices.push(new O(p,g,v,m,y,x,T,w,E,b)),S+=2,A++;for(_=0;_<a.vertices.length;_+=3){var C=a.vertices[_],R=a.vertices[_+1],M=a.vertices[_+2];a.faces.push(new P(C,R,M));}return a;}console.warn("GenerateVerts: vertices and uvs count not equal");};},function(t,e,i){var k=i(116),n=i(69),s=i(39),I=i(117),B=new s(),N=new s(),Y=new n();t.exports=function(t,e,i,n,s,r,o,a,h,u){void 0===i&&(i=1),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===h&&(h=0),void 0===u&&(u=!0);var l={faces:[],verts:[]},c=t.materials;B.set(n,s,r),N.set(o,a,h),Y.fromRotationXYTranslation(N,B,u);for(var d=0;d<t.models.length;d++)for(var f=t.models[d],p=f.vertices,g=f.textureCoords,v=f.faces,m=0;m<v.length;m++){var y=v[m],x=y.vertices[0],T=y.vertices[1],w=y.vertices[2],E=p[x.vertexIndex],b=p[T.vertexIndex],S=p[w.vertexIndex],A=x.textureCoordsIndex,_=T.textureCoordsIndex,C=w.textureCoordsIndex,R=-1===A?{u:0,v:1}:g[A],M=-1===_?{u:0,v:0}:g[_],P=-1===C?{u:1,v:1}:g[C],O=16777215;""!==y.material&&c[y.material]&&(O=c[y.material]);var L=new I(E.x*i,E.y*i,E.z*i,R.u,R.v,O).transformMat4(Y),D=new I(b.x*i,b.y*i,b.z*i,M.u,M.v,O).transformMat4(Y),F=new I(S.x*i,S.y*i,S.z*i,P.u,P.v,O).transformMat4(Y);l.verts.push(L,D,F),l.faces.push(new k(L,D,F));}return e&&(e.faces=e.faces.concat(l.faces),e.vertices=e.vertices.concat(l.verts)),l;};},function(t,e,i){var a=i(65),n=i(0),s=i(11),h=i(200),r=i(12),o=new n({Extends:a,Mixins:[s.ScrollFactor,s.Visible],initialize:function(t,e,i,n,s,r,o){a.call(this,t,e,i),this.color=new h(n,s,r),this.intensity=o,this.renderFlags=15,this.cameraFilter=0,this.setScrollFactor(1,1);},willRender:function(t){return!(o.RENDER_MASK!==this.renderFlags||0!==this.cameraFilter&&this.cameraFilter&t.id);},setColor:function(t){var e=r.getFloatsFromUintRGB(t);return this.color.set(e[0],e[1],e[2]),this;},setIntensity:function(t){return this.intensity=t,this;},setRadius:function(t){return this.radius=t,this;}});o.RENDER_MASK=15,t.exports=o;},function(t,e,i){var o=i(151),n=i(0),a=i(50),h=i(481),u=i(150),s=i(200),r=i(74),l=i(79),c=i(12),d=new n({initialize:function(){this.lights=[],this.ambientColor=new s(.1,.1,.1),this.active=!1,this.maxLights=-1,this.visibleLights=0;},addPointLight:function(t,e,i,n,s,r){return this.systems.displayList.add(new u(this.scene,t,e,i,n,s,r));},enable:function(){return-1===this.maxLights&&(this.maxLights=this.systems.renderer.config.maxLights),this.active=!0,this;},disable:function(){return this.active=!1,this;},getLights:function(t){for(var e=this.lights,i=t.worldView,n=[],s=0;s<e.length;s++){var r=e[s];r.willRender(t)&&o(r,i)&&n.push({light:r,distance:a(r.x,r.y,i.centerX,i.centerY)});}return n.length>this.maxLights&&(l(n,this.sortByDistance),n=n.slice(0,this.maxLights)),this.visibleLights=n.length,n;},sortByDistance:function(t,e){return t.distance>=e.distance;},setAmbientColor:function(t){var e=c.getFloatsFromUintRGB(t);return this.ambientColor.set(e[0],e[1],e[2]),this;},getMaxVisibleLights:function(){return this.maxLights;},getLightCount:function(){return this.lights.length;},addLight:function(t,e,i,n,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=128),void 0===n&&(n=16777215),void 0===s&&(s=1);var r=c.getFloatsFromUintRGB(n),o=new h(t,e,i,r[0],r[1],r[2],s);return this.lights.push(o),o;},removeLight:function(t){var e=this.lights.indexOf(t);return 0<=e&&r(this.lights,e),this;},shutdown:function(){this.lights.length=0;},destroy:function(){this.shutdown();}});t.exports=d;},function(t,e,i){var n=i(56),s=i(17)(!1,s={Circle:i(1191),Ellipse:i(1201),Intersects:i(484),Line:i(1221),Mesh:i(1243),Point:i(1246),Polygon:i(1260),Rectangle:i(502),Triangle:i(1293)},n);t.exports=s;},function(t,e,i){t.exports={CircleToCircle:i(231),CircleToRectangle:i(151),GetCircleToCircle:i(1211),GetCircleToRectangle:i(1212),GetLineToCircle:i(232),GetLineToLine:i(485),GetLineToPoints:i(486),GetLineToPolygon:i(487),GetLineToRectangle:i(234),GetRaysFromPointToPolygon:i(1213),GetRectangleIntersection:i(1214),GetRectangleToRectangle:i(1215),GetRectangleToTriangle:i(1216),GetTriangleToCircle:i(1217),GetTriangleToLine:i(492),GetTriangleToTriangle:i(1218),LineToCircle:i(233),LineToLine:i(96),LineToRectangle:i(488),PointToLine:i(496),PointToLineSegment:i(1219),RectangleToRectangle:i(152),RectangleToTriangle:i(489),RectangleToValues:i(1220),TriangleToCircle:i(491),TriangleToLine:i(493),TriangleToTriangle:i(494)};},function(t,e,i){var g=i(39);t.exports=function(t,e,i){var n=t.x1,s=t.y1,r=t.x2,o=t.y2,a=e.x1,h=e.y1,u=r-n,l=o-s,c=e.x2-a,d=e.y2-h;if(0==u||0==d*u-c*l)return!1;var f=(u*(h-s)+l*(n-a))/(c*l-d*u),p=(a+c*f-n)/u;return p<0||f<0||1<f?null:(void 0===i&&(i=new g()),i.set(n+u*p,s+l*p,p));};},function(t,e,i){var a=i(39),h=i(485),u=new(i(47))(),l=new a();t.exports=function(t,e,i){void 0===i&&(i=new a());var n=!1;i.set(),l.set();for(var s=e[0],r=1;r<e.length;r++){var o=e[r];u.setTo(s.x,s.y,o.x,o.y),s=o,h(t,u,l)&&(!n||l.z<i.z)&&(i.copy(l),n=!0);}return n?i:null;};},function(t,e,i){var n=i(39),r=i(140),o=i(486),a=new n();t.exports=function(t,e,i){void 0===i&&(i=new r()),Array.isArray(e)||(e=[e]);var n=!1;i.set(),a.set();for(var s=0;s<e.length;s++)o(t,e[s].points,a)&&(!n||a.z<i.z)&&(i.set(a.x,a.y,a.z,s),n=!0);return n?i:null;};},function(t,e){t.exports=function(t,e){var i=t.x1,n=t.y1,s=t.x2,r=t.y2,o=e.x,a=e.y,h=e.right,u=e.bottom,l=0;if(o<=i&&i<=h&&a<=n&&n<=u||o<=s&&s<=h&&a<=r&&r<=u)return!0;if(i<o&&o<=s){if(a<(l=n+(r-n)*(o-i)/(s-i))&&l<=u)return!0;}else if(h<i&&s<=h&&a<=(l=n+(r-n)*(h-i)/(s-i))&&l<=u)return!0;if(n<a&&a<=r){if(o<=(l=i+(s-i)*(a-n)/(r-n))&&l<=h)return!0;}else if(u<n&&r<=u&&o<=(l=i+(s-i)*(u-n)/(r-n))&&l<=h)return!0;return!1;};},function(t,e,i){var l=i(96),c=i(57),d=i(235),f=i(490);t.exports=function(t,e){if(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)return!1;var i=e.getLineA(),n=e.getLineB(),s=e.getLineC();if(c(t,i.x1,i.y1)||c(t,i.x2,i.y2))return!0;if(c(t,n.x1,n.y1)||c(t,n.x2,n.y2))return!0;if(c(t,s.x1,s.y1)||c(t,s.x2,s.y2))return!0;var r=t.getLineA(),o=t.getLineB(),a=t.getLineC(),h=t.getLineD();if(l(i,r)||l(i,o)||l(i,a)||l(i,h))return!0;if(l(n,r)||l(n,o)||l(n,a)||l(n,h))return!0;if(l(s,r)||l(s,o)||l(s,a)||l(s,h))return!0;var u=f(t);return 0<d(e,u,!0).length;};},function(t,e){t.exports=function(t,e){return void 0===e&&(e=[]),e.push({x:t.x,y:t.y}),e.push({x:t.right,y:t.y}),e.push({x:t.right,y:t.bottom}),e.push({x:t.x,y:t.bottom}),e;};},function(t,e,i){var n=i(233),s=i(115);t.exports=function(t,e){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)&&(!!s(t,e.x,e.y)||!!n(t.getLineA(),e)||!!n(t.getLineB(),e)||!!n(t.getLineC(),e));};},function(t,e,i){var u=i(4),l=i(493),c=i(96);t.exports=function(t,e,i){if(void 0===i&&(i=[]),l(t,e))for(var n=t.getLineA(),s=t.getLineB(),r=t.getLineC(),o=[new u(),new u(),new u()],a=[c(n,e,o[0]),c(s,e,o[1]),c(r,e,o[2])],h=0;h<3;h++)a[h]&&i.push(o[h]);return i;};},function(t,e,i){var n=i(96);t.exports=function(t,e){return!(!t.contains(e.x1,e.y1)&&!t.contains(e.x2,e.y2))||!!n(t.getLineA(),e)||!!n(t.getLineB(),e)||!!n(t.getLineC(),e);};},function(t,e,i){var l=i(235),c=i(495),d=i(96);t.exports=function(t,e){if(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)return!1;var i=t.getLineA(),n=t.getLineB(),s=t.getLineC(),r=e.getLineA(),o=e.getLineB(),a=e.getLineC();if(d(i,r)||d(i,o)||d(i,a))return!0;if(d(n,r)||d(n,o)||d(n,a))return!0;if(d(s,r)||d(s,o)||d(s,a))return!0;var h=c(t),u=l(e,h,!0);return 0<u.length||(h=c(e),0<l(t,h,!0).length);};},function(t,e){t.exports=function(t,e){return void 0===e&&(e=[]),e.push({x:t.x1,y:t.y1}),e.push({x:t.x2,y:t.y2}),e.push({x:t.x3,y:t.y3}),e;};},function(t,e){t.exports=function(t,e,i){void 0===i&&(i=1);var n=e.x1,s=e.y1,r=e.x2,o=e.y2,a=t.x,h=t.y,u=(r-n)*(r-n)+(o-s)*(o-s);if(0==u)return!1;var l=((a-n)*(r-n)+(h-s)*(o-s))/u;if(l<0)return Math.sqrt((n-a)*(n-a)+(s-h)*(s-h))<=i;if(0<=l&&l<=1){var c=((s-h)*(r-n)-(n-a)*(o-s))/u;return Math.abs(c)*Math.sqrt(u)<=i;}return Math.sqrt((r-a)*(r-a)+(o-h)*(o-h))<=i;};},function(t,e,i){var n=i(14),s=i(68),r=i(97);t.exports=function(t){var e=r(t)-n.TAU;return s(e,-Math.PI,Math.PI);};},function(t,e){var D=!0,F="untitled",k="",I="";function B(t){return 0===t.models.length&&t.models.push({faces:[],name:F,textureCoords:[],vertexNormals:[],vertices:[]}),k="",t.models[t.models.length-1];}t.exports=function(t,e){void 0===e&&(e=!0),D=e;var i={materials:{},materialLibraries:[],models:[]};I=k="";for(var n,s,r,o,a,h,u,l,c,d,f,p,g,v,m,y,x,T,w,E,b,S,A,_,C,R,M,P=t.split("\n"),O=0;O<P.length;O++){var L=(R=P[O],M=void 0,-1<(M=R.indexOf("#"))?R.substring(0,M):R).replace(/\s\s+/g," ").trim().split(" ");switch(L[0].toLowerCase()){case"o":_=i,C=void 0,C=2<=(A=L).length?A[1]:F,_.models.push({faces:[],name:C,textureCoords:[],vertexNormals:[],vertices:[]}),k="";break;case"g":2===(S=L).length&&(k=S[1]);break;case"v":x=i,b=E=w=T=void 0,T=(y=L).length,w=2<=T?parseFloat(y[1]):0,E=3<=T?parseFloat(y[2]):0,b=4<=T?parseFloat(y[3]):0,B(x).vertices.push({x:w,y:E,z:b});break;case"vt":f=i,m=v=g=p=void 0,p=(d=L).length,g=2<=p?parseFloat(d[1]):0,v=3<=p?parseFloat(d[2]):0,m=4<=p?parseFloat(d[3]):0,isNaN(g)&&(g=0),isNaN(v)&&(v=0),isNaN(m)&&(m=0),D&&(v=1-v),B(f).textureCoords.push({u:g,v:v,w:m});break;case"vn":a=i,c=l=u=h=void 0,h=(o=L).length,u=2<=h?parseFloat(o[1]):0,l=3<=h?parseFloat(o[2]):0,c=4<=h?parseFloat(o[3]):0,B(a).vertexNormals.push({x:u,y:l,z:c});break;case"f":!function(t,e){var i=t.length-1;if(!(i<3)){for(var n={group:k,material:I,vertices:[]},s=0;s<i;s++){var r,o,a,h=t[s+1].split("/"),u=h.length;u<1||3<u||(o=r=a=0,a=parseInt(h[0],10),1<u&&""!==h[1]&&(r=parseInt(h[1],10)),2<u&&(o=parseInt(h[2],10)),0!==a&&(a<0&&(a=B(e).vertices.length+1+a),--r,--a,--o,n.vertices.push({textureCoordsIndex:r,vertexIndex:a,vertexNormalIndex:o})));}B(e).faces.push(n);}}(L,i);break;case"mtllib":r=i,2<=(s=L).length&&r.materialLibraries.push(s[1]);break;case"usemtl":2<=(n=L).length&&(I=n[1]);}}return i;};},function(t,e,i){var l=i(103);t.exports=function(t){for(var e={},i=t.split("\n"),n="",s=0;s<i.length;s++){var r=i[s].trim();if(0!==r.indexOf("#")&&""!==r){var o=r.replace(/\s\s+/g," ").trim().split(" ");switch(o[0].toLowerCase()){case"newmtl":n=o[1];break;case"kd":var a=Math.floor(255*o[1]),h=2<=o.length?Math.floor(255*o[2]):a,u=3<=o.length?Math.floor(255*o[3]):a;e[n]=l(a,h,u);}}}return e;};},function(t,e){t.exports=function(t){return Math.sqrt(t.x*t.x+t.y*t.y);};},function(t,e){t.exports=function(t){return t.x*t.x+t.y*t.y;};},function(t,e,i){var n=i(10);n.Area=i(1267),n.Ceil=i(1268),n.CeilAll=i(1269),n.CenterOn=i(190),n.Clone=i(1270),n.Contains=i(57),n.ContainsPoint=i(1271),n.ContainsRect=i(503),n.CopyFrom=i(1272),n.Decompose=i(490),n.Equals=i(1273),n.FitInside=i(1274),n.FitOutside=i(1275),n.Floor=i(1276),n.FloorAll=i(1277),n.FromPoints=i(199),n.FromXY=i(1278),n.GetAspectRatio=i(237),n.GetCenter=i(1279),n.GetPoint=i(171),n.GetPoints=i(306),n.GetSize=i(1280),n.Inflate=i(1281),n.Intersection=i(1282),n.MarchingAnts=i(316),n.MergePoints=i(1283),n.MergeRect=i(1284),n.MergeXY=i(1285),n.Offset=i(1286),n.OffsetPoint=i(1287),n.Overlaps=i(1288),n.Perimeter=i(130),n.PerimeterPoint=i(1289),n.Random=i(174),n.RandomOutside=i(1290),n.SameDimensions=i(1291),n.Scale=i(1292),n.Union=i(441),t.exports=n;},function(t,e){t.exports=function(t,e){return!(e.width*e.height>t.width*t.height)&&e.x>t.x&&e.x<t.right&&e.right>t.x&&e.right<t.right&&e.y>t.y&&e.y<t.bottom&&e.bottom>t.y&&e.bottom<t.bottom;};},function(t,e,i){var n=i(4);t.exports=function(t,e){return void 0===e&&(e=new n()),e.x=(t.x1+t.x2+t.x3)/3,e.y=(t.y1+t.y2+t.y3)/3,e;};},function(t,e){t.exports=function(t,e,i){return t.x1+=e,t.y1+=i,t.x2+=e,t.y2+=i,t.x3+=e,t.y3+=i,t;};},function(t,e,i){var d=i(4);function f(t,e,i,n){var s=t-i,r=e-n,o=s*s+r*r;return Math.sqrt(o);}t.exports=function(t,e){void 0===e&&(e=new d());var i=t.x1,n=t.y1,s=t.x2,r=t.y2,o=t.x3,a=t.y3,h=f(o,a,s,r),u=f(i,n,o,a),l=f(s,r,i,n),c=h+u+l;return e.x=(i*h+s*u+o*l)/c,e.y=(n*h+r*u+a*l)/c,e;};},function(t,e){t.exports=function(r,o){return function(t,e,i,n){var s=r.getPixelAlpha(e,i,n.texture.key,n.frame.name);return s&&o<=s;};};},function(t,e){t.exports=function(t,e,i){return{gameObject:t,enabled:!0,alwaysEnabled:!1,draggable:!1,dropZone:!1,cursor:!1,target:null,camera:null,hitArea:e,hitAreaCallback:i,hitAreaDebug:null,customHitArea:!1,localX:0,localY:0,dragState:0,dragStartX:0,dragStartY:0,dragStartXGlobal:0,dragStartYGlobal:0,dragX:0,dragY:0};};},function(t,e,i){var n=new(i(0))({initialize:function(t,e){this.pad=t,this.events=t.events,this.index=e,this.value=0,this.threshold=.1;},update:function(t){this.value=t;},getValue:function(){return Math.abs(this.value)<this.threshold?0:this.value;},destroy:function(){this.pad=null,this.events=null;}});t.exports=n;},function(t,e,i){var n=i(0),s=i(239),r=new n({initialize:function(t,e){this.pad=t,this.events=t.manager,this.index=e,this.value=0,this.threshold=1,this.pressed=!1;},update:function(t){this.value=t;var e=this.pad,i=this.index;t>=this.threshold?this.pressed||(this.pressed=!0,this.events.emit(s.BUTTON_DOWN,e,this,t),this.pad.emit(s.GAMEPAD_BUTTON_DOWN,i,t,this)):this.pressed&&(this.pressed=!1,this.events.emit(s.BUTTON_UP,e,this,t),this.pad.emit(s.GAMEPAD_BUTTON_UP,i,t,this));},destroy:function(){this.pad=null,this.events=null;}});t.exports=r;},function(t,e,i){var a=i(509),h=i(510),n=i(0),u=i(9),l=i(3),s=new n({Extends:u,initialize:function(t,e){u.call(this),this.manager=t,this.pad=e,this.id=e.id,this.index=e.index;for(var i=[],n=0;n<e.buttons.length;n++)i.push(new h(this,n));this.buttons=i;for(var s=[],n=0;n<e.axes.length;n++)s.push(new a(this,n));this.axes=s,this.vibration=e.vibrationActuator;var r={value:0,pressed:!1};this._LCLeft=i[14]?i[14]:r,this._LCRight=i[15]?i[15]:r,this._LCTop=i[12]?i[12]:r,this._LCBottom=i[13]?i[13]:r,this._RCLeft=i[2]?i[2]:r,this._RCRight=i[1]?i[1]:r,this._RCTop=i[3]?i[3]:r,this._RCBottom=i[0]?i[0]:r,this._FBLeftTop=i[4]?i[4]:r,this._FBLeftBottom=i[6]?i[6]:r,this._FBRightTop=i[5]?i[5]:r,this._FBRightBottom=i[7]?i[7]:r;var o={value:0};this._HAxisLeft=s[0]?s[0]:o,this._VAxisLeft=s[1]?s[1]:o,this._HAxisRight=s[2]?s[2]:o,this._VAxisRight=s[3]?s[3]:o,this.leftStick=new l(),this.rightStick=new l(),this._created=performance.now();},getAxisTotal:function(){return this.axes.length;},getAxisValue:function(t){return this.axes[t].getValue();},setAxisThreshold:function(t){for(var e=0;e<this.axes.length;e++)this.axes[e].threshold=t;},getButtonTotal:function(){return this.buttons.length;},getButtonValue:function(t){return this.buttons[t].value;},isButtonDown:function(t){return this.buttons[t].pressed;},update:function(t){if(!(t.timestamp<this._created)){for(var e=this.buttons,i=t.buttons,n=e.length,s=0;s<n;s++)e[s].update(i[s].value);var r=this.axes,o=t.axes,n=r.length;for(s=0;s<n;s++)r[s].update(o[s]);2<=n&&(this.leftStick.set(r[0].getValue(),r[1].getValue()),4<=n&&this.rightStick.set(r[2].getValue(),r[3].getValue()));}},destroy:function(){var t;for(this.removeAllListeners(),this.manager=null,this.pad=null,t=0;t<this.buttons.length;t++)this.buttons[t].destroy();for(t=0;t<this.axes.length;t++)this.axes[t].destroy();this.buttons=[],this.axes=[];},connected:{get:function(){return this.pad.connected;}},timestamp:{get:function(){return this.pad.timestamp;}},left:{get:function(){return this._LCLeft.pressed;}},right:{get:function(){return this._LCRight.pressed;}},up:{get:function(){return this._LCTop.pressed;}},down:{get:function(){return this._LCBottom.pressed;}},A:{get:function(){return this._RCBottom.pressed;}},Y:{get:function(){return this._RCTop.pressed;}},X:{get:function(){return this._RCLeft.pressed;}},B:{get:function(){return this._RCRight.pressed;}},L1:{get:function(){return this._FBLeftTop.value;}},L2:{get:function(){return this._FBLeftBottom.value;}},R1:{get:function(){return this._FBRightTop.value;}},R2:{get:function(){return this._FBRightBottom.value;}}});t.exports=s;},function(t,e,i){var n=i(0),s=i(9),r=i(154),o=new n({Extends:s,initialize:function(t,e){s.call(this),this.plugin=t,this.keyCode=e,this.originalEvent=void 0,this.enabled=!0,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.metaKey=!1,this.location=0,this.timeDown=0,this.duration=0,this.timeUp=0,this.emitOnRepeat=!1,this.repeats=0,this._justDown=!1,this._justUp=!1,this._tick=-1;},setEmitOnRepeat:function(t){return this.emitOnRepeat=t,this;},onDown:function(t){this.originalEvent=t,this.enabled&&(this.altKey=t.altKey,this.ctrlKey=t.ctrlKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.location=t.location,this.repeats++,this.isDown?this.emitOnRepeat&&this.emit(r.DOWN,this,t):(this.isDown=!0,this.isUp=!1,this.timeDown=t.timeStamp,this.duration=0,this._justDown=!0,this._justUp=!1,this.emit(r.DOWN,this,t)));},onUp:function(t){this.originalEvent=t,this.enabled&&(this.isDown=!1,this.isUp=!0,this.timeUp=t.timeStamp,this.duration=this.timeUp-this.timeDown,this.repeats=0,this._justDown=!1,this._justUp=!0,this._tick=-1,this.emit(r.UP,this,t));},reset:function(){return this.preventDefault=!0,this.enabled=!0,this.isDown=!1,this.isUp=!0,this.altKey=!1,this.ctrlKey=!1,this.shiftKey=!1,this.metaKey=!1,this.timeDown=0,this.duration=0,this.timeUp=0,this.repeats=0,this._justDown=!1,this._justUp=!1,this._tick=-1,this;},getDuration:function(){return this.isDown?this.plugin.game.loop.time-this.timeDown:0;},destroy:function(){this.removeAllListeners(),this.originalEvent=null,this.plugin=null;}});t.exports=o;},function(t,e,i){var n=i(0),o=i(154),a=i(2),h=i(514),u=i(516),s=new n({initialize:function(t,e,i){if(void 0===i&&(i={}),e.length<2)return!1;this.manager=t,this.enabled=!0,this.keyCodes=[];for(var n=0;n<e.length;n++){var s=e[n];"string"==typeof s?this.keyCodes.push(s.toUpperCase().charCodeAt(0)):"number"==typeof s?this.keyCodes.push(s):s.hasOwnProperty("keyCode")&&this.keyCodes.push(s.keyCode);}this.current=this.keyCodes[0],this.index=0,this.size=this.keyCodes.length,this.timeLastMatched=0,this.matched=!1,this.timeMatched=0,this.resetOnWrongKey=a(i,"resetOnWrongKey",!0),this.maxKeyDelay=a(i,"maxKeyDelay",0),this.resetOnMatch=a(i,"resetOnMatch",!1),this.deleteOnMatch=a(i,"deleteOnMatch",!1);var r=this;this.onKeyDown=function(t){!r.matched&&r.enabled&&h(t,r)&&(r.manager.emit(o.COMBO_MATCH,r,t),r.resetOnMatch?u(r):r.deleteOnMatch&&r.destroy());},this.manager.on(o.ANY_KEY_DOWN,this.onKeyDown);},progress:{get:function(){return this.index/this.size;}},destroy:function(){this.enabled=!1,this.keyCodes=[],this.manager.off(o.ANY_KEY_DOWN,this.onKeyDown),this.manager=null;}});t.exports=s;},function(t,e,i){var r=i(515);t.exports=function(t,e){if(e.matched)return!0;var i,n=!1,s=!1;return t.keyCode===e.current&&(0<e.index&&0<e.maxKeyDelay?(i=e.timeLastMatched+e.maxKeyDelay,t.timeStamp<=i&&(s=!0,n=r(t,e))):(s=!0,n=r(t,e))),!s&&e.resetOnWrongKey&&(e.index=0,e.current=e.keyCodes[0]),n&&(e.timeLastMatched=t.timeStamp,e.matched=!0,e.timeMatched=t.timeStamp),n;};},function(t,e){t.exports=function(t,e){return e.timeLastMatched=t.timeStamp,e.index++,e.index===e.size||(e.current=e.keyCodes[e.index],!1);};},function(t,e){t.exports=function(t){return t.current=t.keyCodes[0],t.index=0,t.timeLastMatched=0,t.matched=!1,t.timeMatched=0,t;};},function(t,e,i){var r=i(240);t.exports=function(t,e){var i=r(e,t.xhrSettings),n=new XMLHttpRequest();if(n.open("GET",t.src,i.async,i.user,i.password),n.responseType=t.xhrSettings.responseType,n.timeout=i.timeout,i.headers)for(var s in i.headers)n.setRequestHeader(s,i.headers[s]);return i.header&&i.headerValue&&n.setRequestHeader(i.header,i.headerValue),i.requestedWith&&n.setRequestHeader("X-Requested-With",i.requestedWith),i.overrideMimeType&&n.overrideMimeType(i.overrideMimeType),i.withCredentials&&(n.withCredentials=!0),n.onload=t.onLoad.bind(t,n),n.onerror=t.onError.bind(t,n),n.onprogress=t.onProgress.bind(t),n.send(),n;};},function(t,e,i){var n=i(0),s=i(21),a=i(23),r=i(8),u=i(2),l=i(519),c=i(7),d=new n({Extends:a,initialize:function(t,e,i,n,s){var r;c(e)&&(e=u(r=e,"key"),n=u(r,"xhrSettings"),s=u(r,"context",s));var o={type:"audio",cache:t.cacheManager.audio,extension:i.type,responseType:"arraybuffer",key:e,url:i.url,xhrSettings:n,config:{context:s}};a.call(this,t,o);},onProcess:function(){this.state=s.FILE_PROCESSING;var e=this;this.config.context.decodeAudioData(this.xhrLoader.response,function(t){e.data=t,e.onProcessComplete();},function(t){console.error("Error decoding audio: "+e.key+" - ",t?t.message:null),e.onProcessError();}),this.config.context=null;}});d.create=function(t,e,i,n,s){var r=t.systems.game,o=r.config.audio,a=r.device.audio;c(e)&&(i=u(e,"url",[]),n=u(e,"config",{}));var h=d.getAudioURL(r,i);return h?a.webAudio&&!o.disableWebAudio?new d(t,e,h,s,r.sound.context):new l(t,e,h,n):null;},d.getAudioURL=function(t,e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var n=u(e[i],"url",e[i]);if(0===n.indexOf("blob:")||0===n.indexOf("data:"))return{url:n,type:""};var s=n.match(/\.([a-zA-Z0-9]+)($|\?)/),s=u(e[i],"type",s?s[1]:"").toLowerCase();if(t.device.audio[s])return{url:n,type:s};}return null;},r.register("audio",function(t,e,i,n){var s,r=this.systems.game,o=r.config.audio,a=r.device.audio;if(o.noAudio||!a.webAudio&&!a.audioData)return this;if(Array.isArray(t))for(var h=0;h<t.length;h++)(s=d.create(this,t[h]))&&this.addFile(s);else(s=d.create(this,t,e,i,n))&&this.addFile(s);return this;}),t.exports=d;},function(t,e,i){var n=i(0),s=i(95),o=i(23),a=i(2),r=i(155),h=i(7),u=new n({Extends:o,initialize:function(t,e,i,n){var s;h(e)&&(e=a(s=e,"key"),n=a(s,"config",n));var r={type:"audio",cache:t.cacheManager.audio,extension:i.type,key:e,url:i.url,config:n};o.call(this,t,r),this.locked="ontouchstart"in window,this.loaded=!1,this.filesLoaded=0,this.filesTotal=0;},onLoad:function(){this.loaded||(this.loaded=!0,this.loader.nextFile(this,!0));},onError:function(){for(var t=0;t<this.data.length;t++){var e=this.data[t];e.oncanplaythrough=null,e.onerror=null;}this.loader.nextFile(this,!1);},onProgress:function(t){var e=t.target;e.oncanplaythrough=null,e.onerror=null,this.filesLoaded++,this.percentComplete=Math.min(this.filesLoaded/this.filesTotal,1),this.loader.emit(s.FILE_PROGRESS,this,this.percentComplete),this.filesLoaded===this.filesTotal&&this.onLoad();},load:function(){this.data=[];var t=this.config&&this.config.instances||1;this.filesTotal=t,this.filesLoaded=0;for(var e=this.percentComplete=0;e<t;e++){var i=new Audio();i.dataset||(i.dataset={}),i.dataset.name=this.key+("0"+e).slice(-2),i.dataset.used="false",this.locked?i.dataset.locked="true":(i.dataset.locked="false",i.preload="auto",i.oncanplaythrough=this.onProgress.bind(this),i.onerror=this.onError.bind(this)),this.data.push(i);}for(e=0;e<this.data.length;e++)(i=this.data[e]).src=r(this,this.loader.baseURL),this.locked||i.load();this.locked&&setTimeout(this.onLoad.bind(this));}});t.exports=u;},function(t,e,i){var n=i(0),s=i(21),a=i(23),r=i(8),h=i(2),u=i(7),o=new n({Extends:a,initialize:function(t,e,i,n){var s,r="js";u(e)&&(e=h(s=e,"key"),i=h(s,"url"),n=h(s,"xhrSettings"),r=h(s,"extension",r));var o={type:"script",cache:!1,extension:r,responseType:"text",key:e,url:i,xhrSettings:n};a.call(this,t,o);},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=document.createElement("script"),this.data.language="javascript",this.data.type="text/javascript",this.data.defer=!1,this.data.text=this.xhrLoader.responseText,document.head.appendChild(this.data),this.onProcessComplete();}});r.register("script",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new o(this,t[n]));else this.addFile(new o(this,t,e,i));return this;}),t.exports=o;},function(t,e,i){var r=i(522),o=i(157),n=i(0),a=i(62),s=i(524),h=i(525),u=new n({initialize:function(t){this.world=t,this.scene=t.scene,this.sys=t.scene.sys;},collider:function(t,e,i,n,s){return this.world.addCollider(t,e,i,n,s);},overlap:function(t,e,i,n,s){return this.world.addOverlap(t,e,i,n,s);},existing:function(t,e){var i=e?a.STATIC_BODY:a.DYNAMIC_BODY;return this.world.enableBody(t,i),t;},staticImage:function(t,e,i,n){var s=new r(this.scene,t,e,i,n);return this.sys.displayList.add(s),this.world.enableBody(s,a.STATIC_BODY),s;},image:function(t,e,i,n){var s=new r(this.scene,t,e,i,n);return this.sys.displayList.add(s),this.world.enableBody(s,a.DYNAMIC_BODY),s;},staticSprite:function(t,e,i,n){var s=new o(this.scene,t,e,i,n);return this.sys.displayList.add(s),this.sys.updateList.add(s),this.world.enableBody(s,a.STATIC_BODY),s;},sprite:function(t,e,i,n){var s=new o(this.scene,t,e,i,n);return this.sys.displayList.add(s),this.sys.updateList.add(s),this.world.enableBody(s,a.DYNAMIC_BODY),s;},staticGroup:function(t,e){return this.sys.updateList.add(new h(this.world,this.world.scene,t,e));},group:function(t,e){return this.sys.updateList.add(new s(this.world,this.world.scene,t,e));},destroy:function(){this.world=null,this.scene=null,this.sys=null;}});t.exports=u;},function(t,e,i){var n=i(0),s=i(243),r=i(125),o=new n({Extends:r,Mixins:[s.Acceleration,s.Angular,s.Bounce,s.Debug,s.Drag,s.Enable,s.Friction,s.Gravity,s.Immovable,s.Mass,s.Pushable,s.Size,s.Velocity],initialize:function(t,e,i,n,s){r.call(this,t,e,i,n,s),this.body=null;}});t.exports=o;},function(t,e,i){var d=i(244),f=i(65),p=i(231),g=i(151);t.exports=function(t,e,i,n,s,r){var o=d(t,e-n,i-n,2*n,2*n,s,r);if(0===o.length)return o;for(var a=new f(e,i,n),h=new f(),u=[],l=0;l<o.length;l++){var c=o[l];c.isCircle?(h.setTo(c.center.x,c.center.y,c.halfWidth),p(a,h)&&u.push(c)):g(a,c)&&u.push(c);}return u;};},function(t,e,i){var r=i(157),n=i(0),o=i(62),a=i(2),h=i(113),u=i(7),s=new n({Extends:h,initialize:function(t,e,i,n){var s;i||n?u(i)?(n=i,i=null,n.internalCreateCallback=this.createCallbackHandler,n.internalRemoveCallback=this.removeCallbackHandler):Array.isArray(i)&&u(i[0])?(n=i[0],s=this,i.forEach(function(t){t.internalCreateCallback=s.createCallbackHandler,t.internalRemoveCallback=s.removeCallbackHandler;}),i=null):n={internalCreateCallback:this.createCallbackHandler,internalRemoveCallback:this.removeCallbackHandler}:n={internalCreateCallback:this.createCallbackHandler,internalRemoveCallback:this.removeCallbackHandler},this.world=t,n.classType=a(n,"classType",r),this.physicsType=o.DYNAMIC_BODY,this.defaults={setCollideWorldBounds:a(n,"collideWorldBounds",!1),setBoundsRectangle:a(n,"customBoundsRectangle",null),setAccelerationX:a(n,"accelerationX",0),setAccelerationY:a(n,"accelerationY",0),setAllowDrag:a(n,"allowDrag",!0),setAllowGravity:a(n,"allowGravity",!0),setAllowRotation:a(n,"allowRotation",!0),setBounceX:a(n,"bounceX",0),setBounceY:a(n,"bounceY",0),setDragX:a(n,"dragX",0),setDragY:a(n,"dragY",0),setEnable:a(n,"enable",!0),setGravityX:a(n,"gravityX",0),setGravityY:a(n,"gravityY",0),setFrictionX:a(n,"frictionX",0),setFrictionY:a(n,"frictionY",0),setMaxVelocityX:a(n,"maxVelocityX",1e4),setMaxVelocityY:a(n,"maxVelocityY",1e4),setVelocityX:a(n,"velocityX",0),setVelocityY:a(n,"velocityY",0),setAngularVelocity:a(n,"angularVelocity",0),setAngularAcceleration:a(n,"angularAcceleration",0),setAngularDrag:a(n,"angularDrag",0),setMass:a(n,"mass",1),setImmovable:a(n,"immovable",!1)},h.call(this,e,i,n),this.type="PhysicsGroup";},createCallbackHandler:function(t){t.body||this.world.enableBody(t,o.DYNAMIC_BODY);var e=t.body;for(var i in this.defaults)e[i](this.defaults[i]);},removeCallbackHandler:function(t){t.body&&this.world.disableBody(t);},setVelocity:function(t,e,i){void 0===i&&(i=0);for(var n=this.getChildren(),s=0;s<n.length;s++)n[s].body.velocity.set(t+s*i,e+s*i);return this;},setVelocityX:function(t,e){void 0===e&&(e=0);for(var i=this.getChildren(),n=0;n<i.length;n++)i[n].body.velocity.x=t+n*e;return this;},setVelocityY:function(t,e){void 0===e&&(e=0);for(var i=this.getChildren(),n=0;n<i.length;n++)i[n].body.velocity.y=t+n*e;return this;}});t.exports=s;},function(t,e,i){var s=i(157),n=i(0),r=i(62),o=i(2),a=i(113),h=i(7),u=new n({Extends:a,initialize:function(t,e,i,n){i||n?h(i)?(n=i,i=null,n.internalCreateCallback=this.createCallbackHandler,n.internalRemoveCallback=this.removeCallbackHandler,n.createMultipleCallback=this.createMultipleCallbackHandler,n.classType=o(n,"classType",s)):Array.isArray(i)&&h(i[0])?(n=i,i=null,n.forEach(function(t){t.internalCreateCallback=this.createCallbackHandler,t.internalRemoveCallback=this.removeCallbackHandler,t.createMultipleCallback=this.createMultipleCallbackHandler,t.classType=o(t,"classType",s);})):n={internalCreateCallback:this.createCallbackHandler,internalRemoveCallback:this.removeCallbackHandler}:n={internalCreateCallback:this.createCallbackHandler,internalRemoveCallback:this.removeCallbackHandler,createMultipleCallback:this.createMultipleCallbackHandler,classType:s},this.world=t,this.physicsType=r.STATIC_BODY,a.call(this,e,i,n),this.type="StaticPhysicsGroup";},createCallbackHandler:function(t){t.body||this.world.enableBody(t,r.STATIC_BODY);},removeCallbackHandler:function(t){t.body&&this.world.disableBody(t);},createMultipleCallbackHandler:function(){this.refresh();},refresh:function(){for(var t=this.children.entries,e=0;e<t.length;e++)t[e].body.reset();return this;}});t.exports=u;},function(t,e,i){var v=i(350),n=i(527),p=i(18),s=i(0),o=i(528),g=i(62),m=i(50),r=i(9),y=i(245),x=i(124),T=i(354),w=i(355),E=i(246),b=i(247),S=i(529),a=i(6),A=i(14),h=i(211),_=i(530),u=i(10),l=i(531),C=i(532),R=i(537),M=i(538),c=i(149),d=i(539),P=i(248),f=i(25),O=i(3),L=i(68),D=new s({Extends:r,initialize:function(t,e){r.call(this),this.scene=t,this.bodies=new c(),this.staticBodies=new c(),this.pendingDestroy=new c(),this.colliders=new h(),this.gravity=new O(a(e,"gravity.x",0),a(e,"gravity.y",0)),this.bounds=new u(a(e,"x",0),a(e,"y",0),a(e,"width",t.sys.scale.width),a(e,"height",t.sys.scale.height)),this.checkCollision={up:a(e,"checkCollision.up",!0),down:a(e,"checkCollision.down",!0),left:a(e,"checkCollision.left",!0),right:a(e,"checkCollision.right",!0)},this.fps=a(e,"fps",60),this.fixedStep=a(e,"fixedStep",!0),this._elapsed=0,this._frameTime=1/this.fps,this._frameTimeMS=1e3*this._frameTime,this.stepsLastFrame=0,this.timeScale=a(e,"timeScale",1),this.OVERLAP_BIAS=a(e,"overlapBias",4),this.TILE_BIAS=a(e,"tileBias",16),this.forceX=a(e,"forceX",!1),this.isPaused=a(e,"isPaused",!1),this._total=0,this.drawDebug=a(e,"debug",!1),this.debugGraphic,this.defaults={debugShowBody:a(e,"debugShowBody",!0),debugShowStaticBody:a(e,"debugShowStaticBody",!0),debugShowVelocity:a(e,"debugShowVelocity",!0),bodyDebugColor:a(e,"debugBodyColor",16711935),staticBodyDebugColor:a(e,"debugStaticBodyColor",255),velocityDebugColor:a(e,"debugVelocityColor",65280)},this.maxEntries=a(e,"maxEntries",16),this.useTree=a(e,"useTree",!0),this.tree=new l(this.maxEntries),this.staticTree=new l(this.maxEntries),this.treeMinMax={minX:0,minY:0,maxX:0,maxY:0},this._tempMatrix=new f(),this._tempMatrix2=new f(),this.drawDebug&&this.createDebugGraphic();},enable:function(t,e){void 0===e&&(e=g.DYNAMIC_BODY),Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var n=t[i];if(n.isParent)for(var s=n.getChildren(),r=0;r<s.length;r++){var o=s[r];o.isParent?this.enable(o,e):this.enableBody(o,e);}else this.enableBody(n,e);}},enableBody:function(t,e){return void 0===e&&(e=g.DYNAMIC_BODY),t.body||(e===g.DYNAMIC_BODY?t.body=new n(this,t):e===g.STATIC_BODY&&(t.body=new d(this,t))),this.add(t.body),t;},add:function(t){return t.physicsType===g.DYNAMIC_BODY?this.bodies.set(t):t.physicsType===g.STATIC_BODY&&(this.staticBodies.set(t),this.staticTree.insert(t)),t.enable=!0,t;},disable:function(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];if(i.isParent)for(var n=i.getChildren(),s=0;s<n.length;s++){var r=n[s];r.isParent?this.disable(r):this.disableBody(r.body);}else this.disableBody(i.body);}},disableBody:function(t){this.remove(t),t.enable=!1;},remove:function(t){t.physicsType===g.DYNAMIC_BODY?(this.tree.remove(t),this.bodies.delete(t)):t.physicsType===g.STATIC_BODY&&(this.staticBodies.delete(t),this.staticTree.remove(t));},createDebugGraphic:function(){var t=this.scene.sys.add.graphics({x:0,y:0});return t.setDepth(Number.MAX_VALUE),this.debugGraphic=t,this.drawDebug=!0,t;},setBounds:function(t,e,i,n,s,r,o,a){return this.bounds.setTo(t,e,i,n),void 0!==s&&this.setBoundsCollision(s,r,o,a),this;},setBoundsCollision:function(t,e,i,n){return void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=!0),this.checkCollision.left=t,this.checkCollision.right=e,this.checkCollision.up=i,this.checkCollision.down=n,this;},pause:function(){return this.isPaused=!0,this.emit(y.PAUSE),this;},resume:function(){return this.isPaused=!1,this.emit(y.RESUME),this;},addCollider:function(t,e,i,n,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=i);var r=new o(this,!1,t,e,i,n,s);return this.colliders.add(r),r;},addOverlap:function(t,e,i,n,s){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=i);var r=new o(this,!0,t,e,i,n,s);return this.colliders.add(r),r;},removeCollider:function(t){return this.colliders.remove(t),this;},setFPS:function(t){return this.fps=t,this._frameTime=1/this.fps,this._frameTimeMS=1e3*this._frameTime,this;},update:function(t,e){if(!this.isPaused&&0!==this.bodies.size){var i,n=this._frameTime,s=this._frameTimeMS*this.timeScale;this._elapsed+=e;var r=this.bodies.entries,o=this._elapsed>=s;for(this.fixedStep||(n=.001*e,o=!0,this._elapsed=0),h=0;h<r.length;h++)(i=r[h]).enable&&i.preUpdate(o,n);if(o){this._elapsed-=s,this.stepsLastFrame=1,this.useTree&&(this.tree.clear(),this.tree.load(r));for(var a=this.colliders.update(),h=0;h<a.length;h++){var u=a[h];u.active&&u.update();}this.emit(y.WORLD_STEP,n);}for(;this._elapsed>=s;)this._elapsed-=s,this.step(n);}},step:function(t){for(var e,i=this.bodies.entries,n=i.length,s=0;s<n;s++)(e=i[s]).enable&&e.update(t);this.useTree&&(this.tree.clear(),this.tree.load(i));var r=this.colliders.update();for(s=0;s<r.length;s++){var o=r[s];o.active&&o.update();}this.emit(y.WORLD_STEP,t),this.stepsLastFrame++;},postUpdate:function(){var t,e=(o=this.bodies.entries).length,i=this.bodies,n=this.staticBodies;if(this.stepsLastFrame)for(u=this.stepsLastFrame=0;u<e;u++)(t=o[u]).enable&&t.postUpdate();if(this.drawDebug){var s=this.debugGraphic;for(s.clear(),u=0;u<e;u++)(t=o[u]).willDrawDebug()&&t.drawDebug(s);for(e=(o=n.entries).length,u=0;u<e;u++)(t=o[u]).willDrawDebug()&&t.drawDebug(s);}var r=this.pendingDestroy;if(0<r.size){for(var o,a=this.tree,h=this.staticTree,e=(o=r.entries).length,u=0;u<e;u++)(t=o[u]).physicsType===g.DYNAMIC_BODY?(a.remove(t),i.delete(t)):t.physicsType===g.STATIC_BODY&&(h.remove(t),n.delete(t)),t.world=void 0,t.gameObject=void 0;r.clear();}},updateMotion:function(t,e){t.allowRotation&&this.computeAngularVelocity(t,e),this.computeVelocity(t,e);},computeAngularVelocity:function(t,e){var i=t.angularVelocity,n=t.angularAcceleration,s=t.angularDrag,r=t.maxAngular;n?i+=n*e:t.allowDrag&&s&&(T(i-(s*=e),0,.1)?i-=s:w(i+s,0,.1)?i+=s:i=0);var o=(i=p(i,-r,r))-t.angularVelocity;t.angularVelocity+=o,t.rotation+=t.angularVelocity*e;},computeVelocity:function(t,e){var i=t.velocity.x,n=t.acceleration.x,s=t.drag.x,r=t.maxVelocity.x,o=t.velocity.y,a=t.acceleration.y,h=t.drag.y,u=t.maxVelocity.y,l=t.speed,c=t.maxSpeed,d=t.allowDrag,f=t.useDamping;t.allowGravity&&(i+=(this.gravity.x+t.gravity.x)*e,o+=(this.gravity.y+t.gravity.y)*e),n?i+=n*e:d&&s&&(f?(i*=s=Math.pow(s,e),l=Math.sqrt(i*i+o*o),x(l,0,.001)&&(i=0)):T(i-(s*=e),0,.01)?i-=s:w(i+s,0,.01)?i+=s:i=0),a?o+=a*e:d&&h&&(f?(o*=h=Math.pow(h,e),l=Math.sqrt(i*i+o*o),x(l,0,.001)&&(o=0)):T(o-(h*=e),0,.01)?o-=h:w(o+h,0,.01)?o+=h:o=0),i=p(i,-r,r),o=p(o,-u,u),t.velocity.set(i,o),-1<c&&c<l&&(t.velocity.normalize().scale(c),l=c),t.speed=l;},separate:function(t,e,i,n,s,r){if(!r&&!t.enable||!e.enable||t.checkCollision.none||e.checkCollision.none||!this.intersects(t,e))return!1;if(i&&!1===i.call(n,t.gameObject,e.gameObject))return!1;if(t.isCircle&&e.isCircle)return this.separateCircle(t,e,s);if(t.isCircle!==e.isCircle){var o=t.isCircle?e:t,a=t.isCircle?t:e,h=o.x,u=o.y,l=o.right,c=o.bottom,d=a.center;if((d.y<u||d.y>c)&&(d.x<h||d.x>l))return this.separateCircle(t,e,s);}var f=!1,p=!1;s?(f=R(t,e,s,this.OVERLAP_BIAS),p=M(t,e,s,this.OVERLAP_BIAS)):this.forceX||Math.abs(this.gravity.y+t.gravity.y)<Math.abs(this.gravity.x+t.gravity.x)?(f=R(t,e,s,this.OVERLAP_BIAS),this.intersects(t,e)&&(p=M(t,e,s,this.OVERLAP_BIAS))):(p=M(t,e,s,this.OVERLAP_BIAS),this.intersects(t,e)&&(f=R(t,e,s,this.OVERLAP_BIAS)));var g=f||p;return g&&(s?(t.onOverlap||e.onOverlap)&&this.emit(y.OVERLAP,t.gameObject,e.gameObject,t,e):(t.onCollide||e.onCollide)&&this.emit(y.COLLIDE,t.gameObject,e.gameObject,t,e)),g;},separateCircle:function(t,e,i,n){E(t,e,!1,n),b(t,e,!1,n);var s,r,o=0;if(t.isCircle!==e.isCircle?(s={x:e.isCircle?t.position.x:e.position.x,y:e.isCircle?t.position.y:e.position.y,right:e.isCircle?t.right:e.right,bottom:e.isCircle?t.bottom:e.bottom},(r={x:t.isCircle?t.center.x:e.center.x,y:t.isCircle?t.center.y:e.center.y,radius:t.isCircle?t.halfWidth:e.halfWidth}).y<s.y?r.x<s.x?o=m(r.x,r.y,s.x,s.y)-r.radius:s.right<r.x&&(o=m(r.x,r.y,s.right,s.y)-r.radius):s.bottom<r.y&&(r.x<s.x?o=m(r.x,r.y,s.x,s.bottom)-r.radius:s.right<r.x&&(o=m(r.x,r.y,s.right,s.bottom)-r.radius)),o*=-1):o=t.halfWidth+e.halfWidth-m(t.center.x,t.center.y,e.center.x,e.center.y),t.overlapR=o,e.overlapR=o,i||0===o||t.immovable&&e.immovable||t.customSeparateX||e.customSeparateX)return 0!==o&&(t.onOverlap||e.onOverlap)&&this.emit(y.OVERLAP,t.gameObject,e.gameObject,t,e),0!==o;var a=t.center.x-e.center.x,h=t.center.y-e.center.y,u=Math.sqrt(Math.pow(a,2)+Math.pow(h,2)),l=(e.center.x-t.center.x)/u||0,c=(e.center.y-t.center.y)/u||0,d=2*(t.velocity.x*l+t.velocity.y*c-e.velocity.x*l-e.velocity.y*c)/(t.mass+e.mass);(t.immovable||e.immovable)&&(d*=2),t.immovable||(t.velocity.x=t.velocity.x-d/t.mass*l,t.velocity.y=t.velocity.y-d/t.mass*c),e.immovable||(e.velocity.x=e.velocity.x+d/e.mass*l,e.velocity.y=e.velocity.y+d/e.mass*c),t.immovable||e.immovable||(o/=2);var f=v(t.center,e.center),p=(o+A.EPSILON)*Math.cos(f),g=(o+A.EPSILON)*Math.sin(f);return t.immovable||(t.x-=p,t.y-=g,t.updateCenter()),e.immovable||(e.x+=p,e.y+=g,e.updateCenter()),t.velocity.x*=t.bounce.x,t.velocity.y*=t.bounce.y,e.velocity.x*=e.bounce.x,e.velocity.y*=e.bounce.y,(t.onCollide||e.onCollide)&&this.emit(y.COLLIDE,t.gameObject,e.gameObject,t,e),!0;},intersects:function(t,e){return t!==e&&(t.isCircle||e.isCircle?t.isCircle?e.isCircle?m(t.center.x,t.center.y,e.center.x,e.center.y)<=t.halfWidth+e.halfWidth:this.circleBodyIntersects(t,e):this.circleBodyIntersects(e,t):!(t.right<=e.position.x||t.bottom<=e.position.y||t.position.x>=e.right||t.position.y>=e.bottom));},circleBodyIntersects:function(t,e){var i=p(t.center.x,e.left,e.right),n=p(t.center.y,e.top,e.bottom);return(t.center.x-i)*(t.center.x-i)+(t.center.y-n)*(t.center.y-n)<=t.halfWidth*t.halfWidth;},overlap:function(t,e,i,n,s){return void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=i),this.collideObjects(t,e,i,n,s,!0);},collide:function(t,e,i,n,s){return void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=i),this.collideObjects(t,e,i,n,s,!1);},collideObjects:function(t,e,i,n,s,r){var o;t.isParent&&void 0===t.physicsType&&(t=t.children.entries),e&&e.isParent&&void 0===e.physicsType&&(e=e.children.entries);var a=Array.isArray(t),h=Array.isArray(e);if(this._total=0,a||h){if(!a&&h)for(o=0;o<e.length;o++)this.collideHandler(t,e[o],i,n,s,r);else if(a&&!h){if(e)for(o=0;o<t.length;o++)this.collideHandler(t[o],e,i,n,s,r);else for(o=0;o<t.length;o++)for(var u=t[o],l=o+1;l<t.length;l++)o!==l&&this.collideHandler(u,t[l],i,n,s,r);}else for(o=0;o<t.length;o++)for(l=0;l<e.length;l++)this.collideHandler(t[o],e[l],i,n,s,r);}else this.collideHandler(t,e,i,n,s,r);return 0<this._total;},collideHandler:function(t,e,i,n,s,r){if(void 0===e&&t.isParent)return this.collideGroupVsGroup(t,t,i,n,s,r);if(!t||!e)return!1;if(t.body){if(e.body)return this.collideSpriteVsSprite(t,e,i,n,s,r);if(e.isParent)return this.collideSpriteVsGroup(t,e,i,n,s,r);if(e.isTilemap)return this.collideSpriteVsTilemapLayer(t,e,i,n,s,r);}else if(t.isParent){if(e.body)return this.collideSpriteVsGroup(e,t,i,n,s,r);if(e.isParent)return this.collideGroupVsGroup(t,e,i,n,s,r);if(e.isTilemap)return this.collideGroupVsTilemapLayer(t,e,i,n,s,r);}else if(t.isTilemap){if(e.body)return this.collideSpriteVsTilemapLayer(e,t,i,n,s,r);if(e.isParent)return this.collideGroupVsTilemapLayer(e,t,i,n,s,r);}},collideSpriteVsSprite:function(t,e,i,n,s,r){return!(!t.body||!e.body)&&(this.separate(t.body,e.body,n,s,r)&&(i&&i.call(s,t,e),this._total++),!0);},collideSpriteVsGroup:function(t,e,i,n,s,r){var o,a=t.body;if(0!==e.length&&a&&a.enable&&!a.checkCollision.none)if(this.useTree||e.physicsType===g.STATIC_BODY){var h=this.treeMinMax;h.minX=a.left,h.minY=a.top,h.maxX=a.right,h.maxY=a.bottom;for(var u=e.physicsType===g.DYNAMIC_BODY?this.tree.search(h):this.staticTree.search(h),l=u.length,c=0;c<l;c++)a!==(o=u[c])&&o.enable&&!o.checkCollision.none&&e.contains(o.gameObject)&&this.separate(a,o,n,s,r,!0)&&(i&&i.call(s,a.gameObject,o.gameObject),this._total++);}else{var d=e.getChildren(),f=e.children.entries.indexOf(t);for(l=d.length,c=0;c<l;c++)(o=d[c].body)&&c!==f&&o.enable&&this.separate(a,o,n,s,r)&&(i&&i.call(s,a.gameObject,o.gameObject),this._total++);}},collideGroupVsTilemapLayer:function(t,e,i,n,s,r){var o=t.getChildren();if(0===o.length)return!1;for(var a=!1,h=0;h<o.length;h++)o[h].body&&this.collideSpriteVsTilemapLayer(o[h],e,i,n,s,r)&&(a=!0);return a;},collideTiles:function(t,e,i,n,s){return!(!t.body.enable||0===e.length)&&this.collideSpriteVsTilesHandler(t,e,i,n,s,!1,!1);},overlapTiles:function(t,e,i,n,s){return!(!t.body.enable||0===e.length)&&this.collideSpriteVsTilesHandler(t,e,i,n,s,!0,!1);},collideSpriteVsTilemapLayer:function(t,e,i,n,s,r){var o=t.body;if(!o.enable||o.checkCollision.none)return!1;var a,h=o.position.x,u=o.position.y,l=o.width,c=o.height,d=e.layer;d.tileWidth>d.baseTileWidth&&(h-=a=(d.tileWidth-d.baseTileWidth)*e.scaleX,l+=a),d.tileHeight>d.baseTileHeight&&(c+=(d.tileHeight-d.baseTileHeight)*e.scaleY);var f=S(h,u,l,c,null,e.scene.cameras.main,e.layer);return 0!==f.length&&this.collideSpriteVsTilesHandler(t,f,i,n,s,r,!0);},collideSpriteVsTilesHandler:function(t,e,i,n,s,r,o){for(var a,h,u=t.body,l={left:0,right:0,top:0,bottom:0},c=!1,d=0;d<e.length;d++){var f=(h=(a=e[d]).tilemapLayer).tileToWorldXY(a.x,a.y);l.left=f.x,l.top=f.y,a.baseHeight!==a.height&&(l.top-=(a.height-a.baseHeight)*h.scaleY),l.right=l.left+a.width*h.scaleX,l.bottom=l.top+a.height*h.scaleY,P(l,u)&&(!n||n.call(s,t,a))&&_(a,t)&&(r||C(d,u,a,l,h,this.TILE_BIAS,o))&&(this._total++,c=!0,i&&i.call(s,t,a),r&&u.onOverlap?this.emit(y.TILE_OVERLAP,t,a,u):u.onCollide&&this.emit(y.TILE_COLLIDE,t,a,u));}return c;},collideGroupVsGroup:function(t,e,i,n,s,r){if(0!==t.length&&0!==e.length)for(var o=t.getChildren(),a=0;a<o.length;a++)this.collideSpriteVsGroup(o[a],e,i,n,s,r);},wrap:function(t,e){t.body?this.wrapObject(t,e):t.getChildren?this.wrapArray(t.getChildren(),e):Array.isArray(t)?this.wrapArray(t,e):this.wrapObject(t,e);},wrapArray:function(t,e){for(var i=0;i<t.length;i++)this.wrapObject(t[i],e);},wrapObject:function(t,e){void 0===e&&(e=0),t.x=L(t.x,this.bounds.left-e,this.bounds.right+e),t.y=L(t.y,this.bounds.top-e,this.bounds.bottom+e);},shutdown:function(){this.tree.clear(),this.staticTree.clear(),this.bodies.clear(),this.staticBodies.clear(),this.colliders.destroy(),this.removeAllListeners();},destroy:function(){this.shutdown(),this.scene=null;}});t.exports=D;},function(t,e,i){var n=i(0),s=i(62),r=i(245),a=i(196),o=i(10),h=i(57),u=i(3),l=new n({initialize:function(t,e){var i=e.displayWidth?e.displayWidth:64,n=e.displayHeight?e.displayHeight:64;this.world=t,this.gameObject=e,this.transform={x:e.x,y:e.y,rotation:e.angle,scaleX:e.scaleX,scaleY:e.scaleY,displayOriginX:e.displayOriginX,displayOriginY:e.displayOriginY},this.debugShowBody=t.defaults.debugShowBody,this.debugShowVelocity=t.defaults.debugShowVelocity,this.debugBodyColor=t.defaults.bodyDebugColor,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new u(),this.position=new u(e.x-e.scaleX*e.displayOriginX,e.y-e.scaleY*e.displayOriginY),this.prev=this.position.clone(),this.prevFrame=this.position.clone(),this.allowRotation=!0,this.rotation=e.angle,this.preRotation=e.angle,this.width=i,this.height=n,this.sourceWidth=i,this.sourceHeight=n,e.frame&&(this.sourceWidth=e.frame.realWidth,this.sourceHeight=e.frame.realHeight),this.halfWidth=Math.abs(i/2),this.halfHeight=Math.abs(n/2),this.center=new u(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.velocity=new u(),this.newVelocity=new u(),this.deltaMax=new u(),this.acceleration=new u(),this.allowDrag=!0,this.drag=new u(),this.allowGravity=!0,this.gravity=new u(),this.bounce=new u(),this.worldBounce=null,this.customBoundsRectangle=t.bounds,this.onWorldBounds=!1,this.onCollide=!1,this.onOverlap=!1,this.maxVelocity=new u(1e4,1e4),this.maxSpeed=-1,this.friction=new u(1,0),this.useDamping=!1,this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=s.FACING_NONE,this.immovable=!1,this.pushable=!0,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={none:!0,up:!1,down:!1,left:!1,right:!1},this.syncBounds=!1,this.physicsType=s.DYNAMIC_BODY,this._sx=e.scaleX,this._sy=e.scaleY,this._dx=0,this._dy=0,this._tx=0,this._ty=0,this._bounds=new o();},updateBounds:function(){var t,e=this.gameObject,i=this.transform;e.parentContainer?(t=e.getWorldTransformMatrix(this.world._tempMatrix,this.world._tempMatrix2),i.x=t.tx,i.y=t.ty,i.rotation=a(t.rotation),i.scaleX=t.scaleX,i.scaleY=t.scaleY):(i.x=e.x,i.y=e.y,i.rotation=e.angle,i.scaleX=e.scaleX,i.scaleY=e.scaleY),i.displayOriginX=e.displayOriginX,i.displayOriginY=e.displayOriginY;var n,s,r,o=!1;this.syncBounds?(n=e.getBounds(this._bounds),this.width=n.width,this.height=n.height,o=!0):(s=Math.abs(i.scaleX),r=Math.abs(i.scaleY),this._sx===s&&this._sy===r||(this.width=this.sourceWidth*s,this.height=this.sourceHeight*r,this._sx=s,this._sy=r,o=!0)),o&&(this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.updateCenter());},updateCenter:function(){this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight);},updateFromGameObject:function(){this.updateBounds();var t=this.transform;this.position.x=t.x+t.scaleX*(this.offset.x-t.displayOriginX),this.position.y=t.y+t.scaleY*(this.offset.y-t.displayOriginY),this.updateCenter();},resetFlags:function(t){void 0===t&&(t=!1);var e=this.wasTouching,i=this.touching,n=this.blocked;t?(e.none=!0,e.up=!1,e.down=!1,e.left=!1,e.right=!1):(e.none=i.none,e.up=i.up,e.down=i.down,e.left=i.left,e.right=i.right),i.none=!0,i.up=!1,i.down=!1,i.left=!1,i.right=!1,n.none=!0,n.up=!1,n.down=!1,n.left=!1,n.right=!1,this.overlapR=0,this.overlapX=0,this.overlapY=0,this.embedded=!1;},preUpdate:function(t,e){t&&this.resetFlags(),this.updateFromGameObject(),this.rotation=this.transform.rotation,this.preRotation=this.rotation,this.moves&&(this.prev.x=this.position.x,this.prev.y=this.position.y,this.prevFrame.x=this.position.x,this.prevFrame.y=this.position.y),t&&this.update(e);},update:function(t){var e,i;this.prev.x=this.position.x,this.prev.y=this.position.y,this.moves&&(this.world.updateMotion(this,t),e=this.velocity.x,i=this.velocity.y,this.newVelocity.set(e*t,i*t),this.position.add(this.newVelocity),this.updateCenter(),this.angle=Math.atan2(i,e),this.speed=Math.sqrt(e*e+i*i),this.collideWorldBounds&&this.checkWorldBounds()&&this.onWorldBounds&&this.world.emit(r.WORLD_BOUNDS,this,this.blocked.up,this.blocked.down,this.blocked.left,this.blocked.right)),this._dx=this.position.x-this.prev.x,this._dy=this.position.y-this.prev.y;},postUpdate:function(){var t,e,i=this.position.x-this.prevFrame.x,n=this.position.y-this.prevFrame.y;this.moves&&(0!==(t=this.deltaMax.x)&&0!==i&&(i<0&&i<-t?i=-t:0<i&&t<i&&(i=t)),0!==(e=this.deltaMax.y)&&0!==n&&(n<0&&n<-e?n=-e:0<n&&e<n&&(n=e)),this.gameObject.x+=i,this.gameObject.y+=n),i<0?this.facing=s.FACING_LEFT:0<i&&(this.facing=s.FACING_RIGHT),n<0?this.facing=s.FACING_UP:0<n&&(this.facing=s.FACING_DOWN),this.allowRotation&&(this.gameObject.angle+=this.deltaZ()),this._tx=i,this._ty=n;},setBoundsRectangle:function(t){return this.customBoundsRectangle=t||this.world.bounds,this;},checkWorldBounds:function(){var t=this.position,e=this.customBoundsRectangle,i=this.world.checkCollision,n=this.worldBounce?-this.worldBounce.x:-this.bounce.x,s=this.worldBounce?-this.worldBounce.y:-this.bounce.y,r=!1;return t.x<e.x&&i.left?(t.x=e.x,this.velocity.x*=n,r=this.blocked.left=!0):this.right>e.right&&i.right&&(t.x=e.right-this.width,this.velocity.x*=n,r=this.blocked.right=!0),t.y<e.y&&i.up?(t.y=e.y,this.velocity.y*=s,r=this.blocked.up=!0):this.bottom>e.bottom&&i.down&&(t.y=e.bottom-this.height,this.velocity.y*=s,r=this.blocked.down=!0),r&&(this.blocked.none=!1,this.updateCenter()),r;},setOffset:function(t,e){return void 0===e&&(e=t),this.offset.set(t,e),this;},setSize:function(t,e,i){void 0===i&&(i=!0);var n,s,r=this.gameObject;return!t&&r.frame&&(t=r.frame.realWidth),!e&&r.frame&&(e=r.frame.realHeight),this.sourceWidth=t,this.sourceHeight=e,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.updateCenter(),i&&r.getCenter&&(n=(r.width-t)/2,s=(r.height-e)/2,this.offset.set(n,s)),this.isCircle=!1,this.radius=0,this;},setCircle:function(t,e,i){return void 0===e&&(e=this.offset.x),void 0===i&&(i=this.offset.y),0<t?(this.isCircle=!0,this.radius=t,this.sourceWidth=2*t,this.sourceHeight=2*t,this.width=this.sourceWidth*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.set(e,i),this.updateCenter()):this.isCircle=!1,this;},reset:function(t,e){this.stop();var i=this.gameObject;i.setPosition(t,e),i.getTopLeft?i.getTopLeft(this.position):this.position.set(t,e),this.prev.copy(this.position),this.prevFrame.copy(this.position),this.rotation=i.angle,this.preRotation=i.angle,this.updateBounds(),this.updateCenter(),this.resetFlags(!0);},stop:function(){return this.velocity.set(0),this.acceleration.set(0),this.speed=0,this.angularVelocity=0,this.angularAcceleration=0,this;},getBounds:function(t){return t.x=this.x,t.y=this.y,t.right=this.right,t.bottom=this.bottom,t;},hitTest:function(t,e){return this.isCircle?0<this.radius&&t>=this.left&&t<=this.right&&e>=this.top&&e<=this.bottom&&(this.center.x-t)*(this.center.x-t)+(this.center.y-e)*(this.center.y-e)<=this.radius*this.radius:h(this,t,e);},onFloor:function(){return this.blocked.down;},onCeiling:function(){return this.blocked.up;},onWall:function(){return this.blocked.left||this.blocked.right;},deltaAbsX:function(){return 0<this._dx?this._dx:-this._dx;},deltaAbsY:function(){return 0<this._dy?this._dy:-this._dy;},deltaX:function(){return this._dx;},deltaY:function(){return this._dy;},deltaXFinal:function(){return this._tx;},deltaYFinal:function(){return this._ty;},deltaZ:function(){return this.rotation-this.preRotation;},destroy:function(){this.enable=!1,this.world&&this.world.pendingDestroy.set(this);},drawDebug:function(t){var e=this.position,i=e.x+this.halfWidth,n=e.y+this.halfHeight;this.debugShowBody&&(t.lineStyle(t.defaultStrokeWidth,this.debugBodyColor),this.isCircle?t.strokeCircle(i,n,this.width/2):(this.checkCollision.up&&t.lineBetween(e.x,e.y,e.x+this.width,e.y),this.checkCollision.right&&t.lineBetween(e.x+this.width,e.y,e.x+this.width,e.y+this.height),this.checkCollision.down&&t.lineBetween(e.x,e.y+this.height,e.x+this.width,e.y+this.height),this.checkCollision.left&&t.lineBetween(e.x,e.y,e.x,e.y+this.height))),this.debugShowVelocity&&(t.lineStyle(t.defaultStrokeWidth,this.world.defaults.velocityDebugColor,1),t.lineBetween(i,n,i+this.velocity.x/2,n+this.velocity.y/2));},willDrawDebug:function(){return this.debugShowBody||this.debugShowVelocity;},setCollideWorldBounds:function(t,e,i,n){void 0===t&&(t=!0),this.collideWorldBounds=t;var s=void 0!==e,r=void 0!==i;return(s||r)&&(this.worldBounce||(this.worldBounce=new u()),s&&(this.worldBounce.x=e),r&&(this.worldBounce.y=i)),void 0!==n&&(this.onWorldBounds=n),this;},setVelocity:function(t,e){return this.velocity.set(t,e),t=this.velocity.x,e=this.velocity.y,this.speed=Math.sqrt(t*t+e*e),this;},setVelocityX:function(t){this.velocity.x=t;var e=this.velocity.y;return this.speed=Math.sqrt(t*t+e*e),this;},setVelocityY:function(t){this.velocity.y=t;var e=this.velocity.x;return this.speed=Math.sqrt(e*e+t*t),this;},setMaxVelocity:function(t,e){return this.maxVelocity.set(t,e),this;},setMaxVelocityX:function(t){return this.maxVelocity.x=t,this;},setMaxVelocityY:function(t){return this.maxVelocity.y=t,this;},setMaxSpeed:function(t){return this.maxSpeed=t,this;},setBounce:function(t,e){return this.bounce.set(t,e),this;},setBounceX:function(t){return this.bounce.x=t,this;},setBounceY:function(t){return this.bounce.y=t,this;},setAcceleration:function(t,e){return this.acceleration.set(t,e),this;},setAccelerationX:function(t){return this.acceleration.x=t,this;},setAccelerationY:function(t){return this.acceleration.y=t,this;},setAllowDrag:function(t){return void 0===t&&(t=!0),this.allowDrag=t,this;},setAllowGravity:function(t){return void 0===t&&(t=!0),this.allowGravity=t,this;},setAllowRotation:function(t){return void 0===t&&(t=!0),this.allowRotation=t,this;},setDrag:function(t,e){return this.drag.set(t,e),this;},setDamping:function(t){return this.useDamping=t,this;},setDragX:function(t){return this.drag.x=t,this;},setDragY:function(t){return this.drag.y=t,this;},setGravity:function(t,e){return this.gravity.set(t,e),this;},setGravityX:function(t){return this.gravity.x=t,this;},setGravityY:function(t){return this.gravity.y=t,this;},setFriction:function(t,e){return this.friction.set(t,e),this;},setFrictionX:function(t){return this.friction.x=t,this;},setFrictionY:function(t){return this.friction.y=t,this;},setAngularVelocity:function(t){return this.angularVelocity=t,this;},setAngularAcceleration:function(t){return this.angularAcceleration=t,this;},setAngularDrag:function(t){return this.angularDrag=t,this;},setMass:function(t){return this.mass=t,this;},setImmovable:function(t){return void 0===t&&(t=!0),this.immovable=t,this;},setEnable:function(t){return void 0===t&&(t=!0),this.enable=t,this;},processX:function(t,e,i,n){this.x+=t,this.updateCenter(),null!==e&&(this.velocity.x=e);var s=this.blocked;i&&(s.left=!0),n&&(s.right=!0);},processY:function(t,e,i,n){this.y+=t,this.updateCenter(),null!==e&&(this.velocity.y=e);var s=this.blocked;i&&(s.up=!0),n&&(s.down=!0);},x:{get:function(){return this.position.x;},set:function(t){this.position.x=t;}},y:{get:function(){return this.position.y;},set:function(t){this.position.y=t;}},left:{get:function(){return this.position.x;}},right:{get:function(){return this.position.x+this.width;}},top:{get:function(){return this.position.y;}},bottom:{get:function(){return this.position.y+this.height;}}});t.exports=l;},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n,s,r,o){this.world=t,this.name="",this.active=!0,this.overlapOnly=e,this.object1=i,this.object2=n,this.collideCallback=s,this.processCallback=r,this.callbackContext=o;},setName:function(t){return this.name=t,this;},update:function(){this.world.collideObjects(this.object1,this.object2,this.collideCallback,this.processCallback,this.callbackContext,this.overlapOnly);},destroy:function(){this.world.removeCollider(this),this.active=!1,this.world=null,this.object1=null,this.object2=null,this.collideCallback=null,this.processCallback=null,this.callbackContext=null;}});t.exports=n;},function(t,e,i){var d=i(26),n=i(3),f=new n(),p=new n();t.exports=function(t,e,i,n,s,r,o){var a=o.tilemapLayer.tilemap._convert.WorldToTileXY;a(t,e,!0,f,r,o);var h=f.x,u=f.y;a(t+i,e+n,!1,p,r,o);var l=Math.ceil(p.x),c=Math.ceil(p.y);return d(h,u,l-h,c-u,s,o);};},function(t,e){t.exports=function(t,e){return t.collisionCallback?!t.collisionCallback.call(t.collisionCallbackContext,e,t):!t.layer.callbacks[t.index]||!t.layer.callbacks[t.index].callback.call(t.layer.callbacks[t.index].callbackContext,e,t);};},function(t,e,i){var a=i(436);function n(t){if(!(this instanceof n))return new n(t);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear();}function f(t,e){m(t,0,t.children.length,e,t);}function m(t,e,i,n,s){(s=s||p(null)).minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var r,o=e;o<i;o++)r=t.children[o],l(s,t.leaf?n(r):r);return s;}function l(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t;}function r(t,e){return t.minX-e.minX;}function o(t,e){return t.minY-e.minY;}function y(t){return(t.maxX-t.minX)*(t.maxY-t.minY);}function c(t){return t.maxX-t.minX+(t.maxY-t.minY);}function d(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY;}function u(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY;}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};}function g(t,e,i,n,s){for(var r,o=[e,i];o.length;)(i=o.pop())-(e=o.pop())<=n||(r=e+Math.ceil((i-e)/n/2)*n,a(t,r,e,i,s),o.push(e,r,r,i));}n.prototype={all:function(){return this._all(this.data,[]);},search:function(t){var e=this.data,i=[],n=this.toBBox;if(!u(t,e))return i;for(var s,r,o,a,h=[];e;){for(s=0,r=e.children.length;s<r;s++)o=e.children[s],u(t,a=e.leaf?n(o):o)&&(e.leaf?i.push(o):d(t,a)?this._all(o,i):h.push(o));e=h.pop();}return i;},collides:function(t){var e=this.data,i=this.toBBox;if(!u(t,e))return!1;for(var n,s,r,o,a=[];e;){for(n=0,s=e.children.length;n<s;n++)if(r=e.children[n],u(t,o=e.leaf?i(r):r)){if(e.leaf||d(t,o))return!0;a.push(r);}e=a.pop();}return!1;},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this;}var n,s=this._build(t.slice(),0,t.length-1,0);return this.data.children.length?this.data.height===s.height?this._splitRoot(this.data,s):(this.data.height<s.height&&(n=this.data,this.data=s,s=n),this._insert(s,this.data.height-s.height-1,!0)):this.data=s,this;},insert:function(t){return t&&this._insert(t,this.data.height-1),this;},clear:function(){return this.data=p([]),this;},remove:function(t,e){if(!t)return this;for(var i,n,s,r,o=this.data,a=this.toBBox(t),h=[],u=[];o||h.length;){if(o||(o=h.pop(),n=h[h.length-1],i=u.pop(),r=!0),o.leaf&&-1!==(s=function(t,e,i){if(!i)return e.indexOf(t);for(var n=0;n<e.length;n++)if(i(t,e[n]))return n;return-1;}(t,o.children,e)))return o.children.splice(s,1),h.push(o),this._condense(h),this;r||o.leaf||!d(o,a)?n?(i++,o=n.children[i],r=!1):o=null:(h.push(o),u.push(i),i=0,o=(n=o).children[0]);}return this;},toBBox:function(t){return{minX:t.left,minY:t.top,maxX:t.right,maxY:t.bottom};},compareMinX:function(t,e){return t.left-e.left;},compareMinY:function(t,e){return t.top-e.top;},toJSON:function(){return this.data;},fromJSON:function(t){return this.data=t,this;},_all:function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e;},_build:function(t,e,i,n){var s,r=i-e+1,o=this._maxEntries;if(r<=o)return f(s=p(t.slice(e,i+1)),this.toBBox),s;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),(s=p([])).leaf=!1,s.height=n;var a,h,u,l,c=Math.ceil(r/o),d=c*Math.ceil(Math.sqrt(o));for(g(t,e,i,d,this.compareMinX),a=e;a<=i;a+=d)for(g(t,a,u=Math.min(a+d-1,i),c,this.compareMinY),h=a;h<=u;h+=c)l=Math.min(h+c-1,u),s.children.push(this._build(t,h,l,n-1));return f(s,this.toBBox),s;},_chooseSubtree:function(t,e,i,n){for(var s,r,o,a,h,u,l,c,d,f;n.push(e),!e.leaf&&n.length-1!==i;){for(l=c=1/0,s=0,r=e.children.length;s<r;s++)h=y(o=e.children[s]),d=t,f=o,(u=(Math.max(f.maxX,d.maxX)-Math.min(f.minX,d.minX))*(Math.max(f.maxY,d.maxY)-Math.min(f.minY,d.minY))-h)<c?(c=u,l=h<l?h:l,a=o):u===c&&h<l&&(l=h,a=o);e=a||e.children[0];}return e;},_insert:function(t,e,i){var n=this.toBBox,s=i?t:n(t),r=[],o=this._chooseSubtree(s,this.data,e,r);for(o.children.push(t),l(o,s);0<=e&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(s,r,e);},_split:function(t,e){var i=t[e],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);var r=this._chooseSplitIndex(i,s,n),o=p(i.children.splice(r,i.children.length-r));o.height=i.height,o.leaf=i.leaf,f(i,this.toBBox),f(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(i,o);},_splitRoot:function(t,e){this.data=p([t,e]),this.data.height=t.height+1,this.data.leaf=!1,f(this.data,this.toBBox);},_chooseSplitIndex:function(t,e,i){for(var n,s,r,o,a,h,u,l,c,d,f,p,g=a=1/0,v=e;v<=i-e;v++)n=m(t,0,v,this.toBBox),s=m(t,v,i,this.toBBox),u=n,l=s,p=f=d=c=void 0,c=Math.max(u.minX,l.minX),d=Math.max(u.minY,l.minY),f=Math.min(u.maxX,l.maxX),p=Math.min(u.maxY,l.maxY),r=Math.max(0,f-c)*Math.max(0,p-d),o=y(n)+y(s),r<g?(g=r,h=v,a=o<a?o:a):r===g&&o<a&&(a=o,h=v);return h;},_chooseSplitAxis:function(t,e,i){var n=t.leaf?this.compareMinX:r,s=t.leaf?this.compareMinY:o;this._allDistMargin(t,e,i,n)<this._allDistMargin(t,e,i,s)&&t.children.sort(n);},_allDistMargin:function(t,e,i,n){t.children.sort(n);for(var s,r=this.toBBox,o=m(t,0,e,r),a=m(t,i-e,i,r),h=c(o)+c(a),u=e;u<i-e;u++)s=t.children[u],l(o,t.leaf?r(s):s),h+=c(o);for(u=i-e-1;e<=u;u--)s=t.children[u],l(a,t.leaf?r(s):s),h+=c(a);return h;},_adjustParentBBoxes:function(t,e,i){for(var n=i;0<=n;n--)l(e[n],t);},_condense:function(t){for(var e,i=t.length-1;0<=i;i--)0===t[i].children.length?0<i?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():f(t[i],this.toBBox);}},t.exports=n;},function(t,e,i){var m=i(533),y=i(535),x=i(248);t.exports=function(t,e,i,n,s,r,o){var a=n.left,h=n.top,u=n.right,l=n.bottom,c=i.faceLeft||i.faceRight,d=i.faceTop||i.faceBottom;if(o||(d=c=!0),!c&&!d)return!1;var f=0,p=0,g=0,v=1;if(e.deltaAbsX()>e.deltaAbsY()?g=-1:e.deltaAbsX()<e.deltaAbsY()&&(v=-1),0!==e.deltaX()&&0!==e.deltaY()&&c&&d&&(g=Math.min(Math.abs(e.position.x-u),Math.abs(e.right-a)),v=Math.min(Math.abs(e.position.y-l),Math.abs(e.bottom-h))),g<v){if(c&&0!==(f=m(e,i,a,u,r,o))&&!x(n,e))return!0;d&&(p=y(e,i,h,l,r,o));}else{if(d&&0!==(p=y(e,i,h,l,r,o))&&!x(n,e))return!0;c&&(f=m(e,i,a,u,r,o));}return 0!==f||0!==p;};},function(t,e,i){var c=i(534);t.exports=function(t,e,i,n,s,r){var o=0,a=e.faceLeft,h=e.faceRight,u=e.collideLeft,l=e.collideRight;return r||(l=u=h=a=!0),t.deltaX()<0&&l&&t.checkCollision.left?h&&t.x<n&&(o=t.x-n)<-s&&(o=0):0<t.deltaX()&&u&&t.checkCollision.right&&a&&t.right>i&&s<(o=t.right-i)&&(o=0),0!==o&&(t.customSeparateX?t.overlapX=o:c(t,o)),o;};},function(t,e){t.exports=function(t,e){e<0?(t.blocked.none=!1,t.blocked.left=!0):0<e&&(t.blocked.none=!1,t.blocked.right=!0),t.position.x-=e,0===t.bounce.x?t.velocity.x=0:t.velocity.x=-t.velocity.x*t.bounce.x;};},function(t,e,i){var c=i(536);t.exports=function(t,e,i,n,s,r){var o=0,a=e.faceTop,h=e.faceBottom,u=e.collideUp,l=e.collideDown;return r||(l=u=h=a=!0),t.deltaY()<0&&l&&t.checkCollision.up?h&&t.y<n&&(o=t.y-n)<-s&&(o=0):0<t.deltaY()&&u&&t.checkCollision.down&&a&&t.bottom>i&&s<(o=t.bottom-i)&&(o=0),0!==o&&(t.customSeparateY?t.overlapY=o:c(t,o)),o;};},function(t,e){t.exports=function(t,e){e<0?(t.blocked.none=!1,t.blocked.up=!0):0<e&&(t.blocked.none=!1,t.blocked.down=!0),t.position.y-=e,0===t.bounce.y?t.velocity.y=0:t.velocity.y=-t.velocity.y*t.bounce.y;};},function(t,e,i){var h=i(246),u=i(1389);t.exports=function(t,e,i,n){var s=h(t,e,i,n),r=t.immovable,o=e.immovable;if(i||0===s||r&&o||t.customSeparateX||e.customSeparateX)return 0!==s||t.embedded&&e.embedded;var a=u.Set(t,e,s);return r||o?(r?u.RunImmovableBody1(a):o&&u.RunImmovableBody2(a),!0):0<a||u.Check();};},function(t,e,i){var h=i(247),u=i(1390);t.exports=function(t,e,i,n){var s=h(t,e,i,n),r=t.immovable,o=e.immovable;if(i||0===s||r&&o||t.customSeparateY||e.customSeparateY)return 0!==s||t.embedded&&e.embedded;var a=u.Set(t,e,s);return r||o?(r?u.RunImmovableBody1(a):o&&u.RunImmovableBody2(a),!0):0<a||u.Check();};},function(t,e,i){var n=i(66),s=i(0),r=i(62),o=i(57),a=i(3),h=new s({initialize:function(t,e){var i=e.displayWidth?e.displayWidth:64,n=e.displayHeight?e.displayHeight:64;this.world=t,this.gameObject=e,this.debugShowBody=t.defaults.debugShowStaticBody,this.debugBodyColor=t.defaults.staticBodyDebugColor,this.enable=!0,this.isCircle=!1,this.radius=0,this.offset=new a(),this.position=new a(e.x-i*e.originX,e.y-n*e.originY),this.width=i,this.height=n,this.halfWidth=Math.abs(this.width/2),this.halfHeight=Math.abs(this.height/2),this.center=new a(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.velocity=a.ZERO,this.allowGravity=!1,this.gravity=a.ZERO,this.bounce=a.ZERO,this.onWorldBounds=!1,this.onCollide=!1,this.onOverlap=!1,this.mass=1,this.immovable=!0,this.pushable=!1,this.customSeparateX=!1,this.customSeparateY=!1,this.overlapX=0,this.overlapY=0,this.overlapR=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,up:!0,down:!0,left:!0,right:!0},this.touching={none:!0,up:!1,down:!1,left:!1,right:!1},this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1},this.blocked={none:!0,up:!1,down:!1,left:!1,right:!1},this.physicsType=r.STATIC_BODY,this._dx=0,this._dy=0;},setGameObject:function(t,e){return t&&t!==this.gameObject&&(this.gameObject.body=null,(t.body=this).gameObject=t),e&&this.updateFromGameObject(),this;},updateFromGameObject:function(){this.world.staticTree.remove(this);var t=this.gameObject;return t.getTopLeft(this.position),this.width=t.displayWidth,this.height=t.displayHeight,this.halfWidth=Math.abs(this.width/2),this.halfHeight=Math.abs(this.height/2),this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.world.staticTree.insert(this),this;},setOffset:function(t,e){return void 0===e&&(e=t),this.world.staticTree.remove(this),this.position.x-=this.offset.x,this.position.y-=this.offset.y,this.offset.set(t,e),this.position.x+=this.offset.x,this.position.y+=this.offset.y,this.updateCenter(),this.world.staticTree.insert(this),this;},setSize:function(t,e,i){void 0===i&&(i=!0);var n,s,r=this.gameObject;return!t&&r.frame&&(t=r.frame.realWidth),!e&&r.frame&&(e=r.frame.realHeight),this.world.staticTree.remove(this),this.width=t,this.height=e,this.halfWidth=Math.floor(t/2),this.halfHeight=Math.floor(e/2),i&&r.getCenter&&(n=r.displayWidth/2,s=r.displayHeight/2,this.position.x-=this.offset.x,this.position.y-=this.offset.y,this.offset.set(n-this.halfWidth,s-this.halfHeight),this.position.x+=this.offset.x,this.position.y+=this.offset.y),this.updateCenter(),this.isCircle=!1,this.radius=0,this.world.staticTree.insert(this),this;},setCircle:function(t,e,i){return void 0===e&&(e=this.offset.x),void 0===i&&(i=this.offset.y),0<t?(this.world.staticTree.remove(this),this.isCircle=!0,this.radius=t,this.width=2*t,this.height=2*t,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this.offset.set(e,i),this.updateCenter(),this.world.staticTree.insert(this)):this.isCircle=!1,this;},updateCenter:function(){this.center.set(this.position.x+this.halfWidth,this.position.y+this.halfHeight);},reset:function(t,e){var i=this.gameObject;void 0===t&&(t=i.x),void 0===e&&(e=i.y),this.world.staticTree.remove(this),i.setPosition(t,e),i.getTopLeft(this.position),this.updateCenter(),this.world.staticTree.insert(this);},stop:function(){return this;},getBounds:function(t){return t.x=this.x,t.y=this.y,t.right=this.right,t.bottom=this.bottom,t;},hitTest:function(t,e){return(this.isCircle?n:o)(this,t,e);},postUpdate:function(){},deltaAbsX:function(){return 0;},deltaAbsY:function(){return 0;},deltaX:function(){return 0;},deltaY:function(){return 0;},deltaZ:function(){return 0;},destroy:function(){this.enable=!1,this.world.pendingDestroy.set(this);},drawDebug:function(t){var e=this.position,i=e.x+this.halfWidth,n=e.y+this.halfHeight;this.debugShowBody&&(t.lineStyle(t.defaultStrokeWidth,this.debugBodyColor,1),this.isCircle?t.strokeCircle(i,n,this.width/2):t.strokeRect(e.x,e.y,this.width,this.height));},willDrawDebug:function(){return this.debugShowBody;},setMass:function(t){return t<=0&&(t=.1),this.mass=t,this;},x:{get:function(){return this.position.x;},set:function(t){this.world.staticTree.remove(this),this.position.x=t,this.world.staticTree.insert(this);}},y:{get:function(){return this.position.y;},set:function(t){this.world.staticTree.remove(this),this.position.y=t,this.world.staticTree.insert(this);}},left:{get:function(){return this.position.x;}},right:{get:function(){return this.position.x+this.width;}},top:{get:function(){return this.position.y;}},bottom:{get:function(){return this.position.y+this.height;}}});t.exports=h;},function(t,e,i){var n=new(i(0))({initialize:function(t){this.pluginManager=t,this.game=t.game;},init:function(){},start:function(){},stop:function(){},destroy:function(){this.pluginManager=null,this.game=null,this.scene=null,this.systems=null;}});t.exports=n;},function(t,e,i){var h=new(i(3))();t.exports=function(t,e,i,n){var s=i.tilemapLayer,r=s.cullPaddingX,o=s.cullPaddingY,a=s.tilemap.tileToWorldXY(t,e,h,n,s);return a.x>n.worldView.x+s.scaleX*i.tileWidth*(-r-.5)&&a.x<n.worldView.right+s.scaleX*i.tileWidth*(r-.5)&&a.y>n.worldView.y+s.scaleY*i.tileHeight*(-o-1)&&a.y<n.worldView.bottom+s.scaleY*i.tileHeight*(o-.5);};},function(t,e,i){var u=i(26);t.exports=function(t,e,i,n,s,r,o){for(var a=u(i,n,s,r,null,o),h=0;h<a.length;h++)a[h]&&a[h].index===t&&(a[h].index=e);};},function(t,e,i){var n=i(10),l=i(139),c=i(76),d=new n();t.exports=function(t,e){var i=t.tilemapLayer.tilemap,n=t.tilemapLayer,s=Math.floor(i.tileWidth*n.scaleX),r=Math.floor(i.tileHeight*n.scaleY),o=c(e.worldView.x-n.x,s,0,!0)-n.cullPaddingX,a=l(e.worldView.right-n.x,s,0,!0)+n.cullPaddingX,h=c(e.worldView.y-n.y,r,0,!0)-n.cullPaddingY,u=l(e.worldView.bottom-n.y,r,0,!0)+n.cullPaddingY;return d.setTo(o,h,a-o,u-h);};},function(t,e,i){var o=i(543),a=i(159);t.exports=function(t,e,i,n){void 0===i&&(i=[]),void 0===n&&(n=0),i.length=0;var s=t.tilemapLayer,r=o(t,e);return!s.skipCull&&1===s.scrollFactorX&&1===s.scrollFactorY||(r.left=0,r.right=t.width,r.top=0,r.bottom=t.height),a(t,r,n,i),i;};},function(t,e,i){var o=i(546),a=i(159);t.exports=function(t,e,i,n){void 0===i&&(i=[]),void 0===n&&(n=0),i.length=0;var s,r=t.tilemapLayer;return r.skipCull||1!==r.scrollFactorX||1!==r.scrollFactorY||(s=o(t,e),a(t,s,n,i)),i;};},function(t,e,i){var h=i(139),u=i(76);t.exports=function(t,e){var i=t.tilemapLayer.tilemap,n=t.tilemapLayer,s=Math.floor(i.tileWidth*n.scaleX),r=Math.floor(i.tileHeight*n.scaleY),o=t.hexSideLength,a=(r-o)/2+o;return{left:u(e.worldView.x-n.x,s,0,!0)-n.cullPaddingX,right:h(e.worldView.right-n.x,s,0,!0)+n.cullPaddingX,top:u(e.worldView.y-n.y,a,0,!0)-n.cullPaddingY,bottom:h(e.worldView.bottom-n.y,a,0,!0)+n.cullPaddingY};};},function(t,e,i){var f=i(541);t.exports=function(t,e,i,n){void 0===i&&(i=[]),void 0===n&&(n=0),i.length=0;var s,r,o,a=t.tilemapLayer,h=t.data,u=t.width,l=t.height,c=u,d=l;if(!a.skipCull)if(0===n){for(r=0;r<d;r++)for(s=0;h[r]&&s<c;s++)if(f(s,r,t,e)){if(!(o=h[r][s])||-1===o.index||!o.visible||0===o.alpha)continue;i.push(o);}}else if(1===n){for(r=0;r<d;r++)for(s=c;h[r]&&0<=s;s--)if(f(s,r,t,e)){if(!(o=h[r][s])||-1===o.index||!o.visible||0===o.alpha)continue;i.push(o);}}else if(2===n){for(r=d;0<=r;r--)for(s=0;h[r]&&s<c;s++)if(f(s,r,t,e)){if(!(o=h[r][s])||-1===o.index||!o.visible||0===o.alpha)continue;i.push(o);}}else if(3===n)for(r=d;0<=r;r--)for(s=c;h[r]&&0<=s;s--)if(f(s,r,t,e)){if(!(o=h[r][s])||-1===o.index||!o.visible||0===o.alpha)continue;i.push(o);}return a.tilesDrawn=i.length,a.tilesTotal=u*l,i;};},function(t,e,i){var o=i(549),a=i(159);t.exports=function(t,e,i,n){void 0===i&&(i=[]),void 0===n&&(n=0),i.length=0;var s,r=t.tilemapLayer;return r.skipCull||1!==r.scrollFactorX||1!==r.scrollFactorY||(s=o(t,e),a(t,s,n,i)),i;};},function(t,e,i){var o=i(139),a=i(76);t.exports=function(t,e){var i=t.tilemapLayer.tilemap,n=t.tilemapLayer,s=Math.floor(i.tileWidth*n.scaleX),r=Math.floor(i.tileHeight*n.scaleY);return{left:a(e.worldView.x-n.x,s,0,!0)-n.cullPaddingX,right:o(e.worldView.right-n.x,s,0,!0)+n.cullPaddingX,top:a(e.worldView.y-n.y,r/2,0,!0)-n.cullPaddingY,bottom:o(e.worldView.bottom-n.y,r/2,0,!0)+n.cullPaddingY};};},function(t,e,i){var f=i(3);t.exports=function(t,e,i,n,s){i=i||new f();var r=s.baseTileWidth,o=s.baseTileHeight,a=s.tilemapLayer,h=0,u=0;a&&(n=n||a.scene.cameras.main,h=a.x+n.scrollX*(1-a.scrollFactorX),r*=a.scaleX,u=a.y+n.scrollY*(1-a.scrollFactorY),o*=a.scaleY);var l=s.hexSideLength,c=h+t*r+e%2*(r/2),d=u+e*((o-l)/2+l);return i.set(c,d);};},function(t,e,i){var d=i(3);t.exports=function(t,e,i,n,s){i=i||new d();var r=s.baseTileWidth,o=s.baseTileHeight,a=s.tilemapLayer,h=0,u=0;a&&(n=n||a.scene.cameras.main,h=a.x+n.scrollX*(1-a.scrollFactorX),r*=a.scaleX,u=a.y+n.scrollY*(1-a.scrollFactorY),o*=a.scaleY);var l=h+r/2*(t-e),c=u+(t+e)*(o/2);return i.set(l,c);};},function(t,e,i){var d=i(3);t.exports=function(t,e,i,n,s){i=i||new d();var r=s.baseTileWidth,o=s.baseTileHeight,a=s.tilemapLayer,h=0,u=0;a&&(n=n||a.scene.cameras.main,h=a.x+n.scrollX*(1-a.scrollFactorX),r*=a.scaleX,u=a.y+n.scrollY*(1-a.scrollFactorY),o*=a.scaleY);var l=h+t*r+e%2*(r/2),c=u+e*(o/2);return i.set(l,c);};},function(t,e,i){var r=i(253),o=i(254),a=i(3);t.exports=function(t,e,i,n,s){return(i=i||new a(0,0)).x=r(t,n,s),i.y=o(e,n,s),i;};},function(t,e){t.exports=function(t,e,i){var n=i.baseTileHeight,s=i.tilemapLayer,r=0;s&&(void 0===e&&(e=s.scene.cameras.main),r=s.y+e.scrollY*(1-s.scrollFactorY),n*=s.scaleY);var o=s.tilemap.hexSideLength;return r+t*((n-o)/2+o);};},function(t,e){t.exports=function(t,e,i){var n=i.baseTileHeight,s=i.tilemapLayer,r=0;return s&&(void 0===e&&(e=s.scene.cameras.main),r=s.y+e.scrollY*(1-s.scrollFactorY),n*=s.scaleY),r+t*(n/2);};},function(t,e,i){var f=i(3);t.exports=function(t,e,i,n,s,r){n=n||new f();var o=r.baseTileWidth,a=r.baseTileHeight,h=r.tilemapLayer;h&&(s=s||h.scene.cameras.main,e-=h.y+s.scrollY*(1-h.scrollFactorY),a*=h.scaleY,t-=h.x+s.scrollX*(1-h.scrollFactorX),o*=h.scaleX);var u=r.hexSideLength,l=(a-u)/2+u,c=i?Math.floor(e/l):e/l,d=i?Math.floor((t-c%2*.5*o)/o):(t-c%2*.5*o)/o;return n.set(d,c);};},function(t,e,i){var c=i(3);t.exports=function(t,e,i,n,s,r){n=n||new c();var o=r.baseTileWidth,a=r.baseTileHeight,h=r.tilemapLayer;h&&(s=s||h.scene.cameras.main,e-=h.y+s.scrollY*(1-h.scrollFactorY),a*=h.scaleY,t-=h.x+s.scrollX*(1-h.scrollFactorX),o*=h.scaleX);var u=i?Math.floor((t/(o/2)+e/(a/2))/2):(t/(o/2)+e/(a/2))/2,l=i?Math.floor((e/(a/2)-t/(o/2))/2):(e/(a/2)-t/(o/2))/2;return n.set(u,l);};},function(t,e,i){var c=i(3);t.exports=function(t,e,i,n,s,r){n=n||new c();var o=r.baseTileWidth,a=r.baseTileHeight,h=r.tilemapLayer;h&&(s=s||h.scene.cameras.main,e-=h.y+s.scrollY*(1-h.scrollFactorY),a*=h.scaleY,t-=h.x+s.scrollX*(1-h.scrollFactorX),o*=h.scaleX);var u=i?Math.floor(e/(a/2)):e/(a/2),l=i?Math.floor((t+u%2*.5*o)/o):(t+u%2*.5*o)/o;return n.set(l,u);};},function(t,e,i){var o=i(255),a=i(256),h=i(3);t.exports=function(t,e,i,n,s,r){return void 0===i&&(i=!0),(n=n||new h(0,0)).x=o(t,i,s,r),n.y=a(e,i,s,r),n;};},function(t,e){t.exports=function(t,e,i,n){var s=n.baseTileHeight,r=n.tilemapLayer;r&&(i=i||r.scene.cameras.main,t-=r.y+i.scrollY*(1-r.scrollFactorY),s*=r.scaleY);var o=n.hexSideLength,a=(s-o)/2+o;return e?Math.floor(t/a):t/a;};},function(t,e){t.exports=function(t,e,i,n){var s=n.baseTileHeight,r=n.tilemapLayer;return r&&(i=i||r.scene.cameras.main,t-=r.y+i.scrollY*(1-r.scrollFactorY),s*=r.scaleY),e?Math.floor(t/(s/2)):t/(s/2);};},function(t,e,i){var s=i(119);t.exports=function(t,e,i){if(s(t,e,i)){var n=i.data[e][t];return null!==n&&-1<n.index;}return!1;};},function(t,e,i){var o=i(85),a=i(119),h=i(252);t.exports=function(t,e,i,n,s){if(void 0===i&&(i=!0),void 0===n&&(n=!0),!a(t,e,s))return null;var r=s.data[e][t];return r?(s.data[e][t]=i?null:new o(s,-1,t,e,s.tileWidth,s.tileHeight),n&&r&&r.collides&&h(t,e,s),r):null;};},function(t,e,i){var a=i(40),h=i(259),u=i(565),l=i(566),c=i(577);t.exports=function(t,e,i,n,s,r){var o;switch(e){case a.ARRAY_2D:o=h(t,i,n,s,r);break;case a.CSV:o=u(t,i,n,s,r);break;case a.TILED_JSON:o=l(t,i,r);break;case a.WELTMEISTER:o=c(t,i,r);break;default:console.warn("Unrecognized tilemap data format: "+e),o=null;}return o;};},function(t,e,i){var a=i(40),h=i(259);t.exports=function(t,e,i,n,s){var r=e.trim().split("\n").map(function(t){return t.split(",");}),o=h(t,r,i,n,s);return o.format=a.CSV,o;};},function(t,e,i){var r=i(567),o=i(568),a=i(29),h=i(40),u=i(258),l=i(121),c=i(569),d=i(570),f=i(573),p=i(575);t.exports=function(t,e,i){var n=new l({width:e.width,height:e.height,name:t,tileWidth:e.tilewidth,tileHeight:e.tileheight,orientation:u(e.orientation),format:h.TILED_JSON,version:e.version,properties:e.properties,renderOrder:e.renderorder,infinite:e.infinite});n.orientation===a.HEXAGONAL&&(n.hexSideLength=e.hexsidelength),n.layers=f(e,i),n.images=c(e);var s=p(e);return n.tilesets=s.tilesets,n.imageCollections=s.imageCollections,n.objects=d(e),n.tiles=o(n),r(n),n;};},function(t,e,i){var u=i(17);t.exports=function(t){for(var e,i,n,s,r,o=0;o<t.layers.length;o++){e=t.layers[o],0;for(var a=0;a<e.data.length;a++){r=e.data[a];for(var h=0;h<r.length;h++)null===(i=r[h])||i.index<0||(n=t.tiles[i.index][2],s=t.tilesets[n],i.width=s.tileWidth,i.height=s.tileHeight,s.tileProperties&&s.tileProperties[i.index-s.firstgid]&&(i.properties=u(i.properties,s.tileProperties[i.index-s.firstgid])));}}};},function(t,e,i){var p=i(122);t.exports=function(t){for(var e=[],i=0;i<t.imageCollections.length;i++)for(var n=t.imageCollections[i],s=n.images,r=0;r<s.length;r++){var o,a=s[r];(o=new p(a.image,a.gid,n.imageWidth,n.imageHeight,0,0)).updateTileData(n.imageWidth,n.imageHeight),t.tilesets.push(o);}for(i=0;i<t.tilesets.length;i++)for(var h=(o=t.tilesets[i]).tileMargin,u=o.tileMargin,l=0,c=0,d=0,f=o.firstgid;f<o.firstgid+o.total&&(e[f]=[h,u,i],h+=o.tileWidth+o.tileSpacing,++l!==o.total)&&(++c!==o.columns||(h=o.tileMargin,u+=o.tileHeight+o.tileSpacing,c=0,++d!==o.rows));f++);return e;};},function(t,e,i){var h=i(2),u=i(161);t.exports=function(t){for(var e=[],i=[],n=u(t);n.i<n.layers.length||0<i.length;)if(n.i>=n.layers.length){if(i.length<1){console.warn("TilemapParser.parseTiledJSON - Invalid layer group hierarchy");break;}n=i.pop();}else{var s,r,o,a=n.layers[n.i];n.i++,"imagelayer"===a.type?(s=h(a,"offsetx",0)+h(a,"startx",0),r=h(a,"offsety",0)+h(a,"starty",0),e.push({name:n.name+a.name,image:a.image,x:n.x+s+a.x,y:n.y+r+a.y,alpha:n.opacity*a.opacity,visible:n.visible&&a.visible,properties:h(a,"properties",{})})):"group"===a.type&&(o=u(t,a,n),i.push(n),n=o);}return e;};},function(t,e,i){var d=i(2),f=i(260),p=i(572),g=i(161);t.exports=function(t){for(var e=[],i=[],n=g(t);n.i<n.layers.length||0<i.length;)if(n.i>=n.layers.length){if(i.length<1){console.warn("TilemapParser.parseTiledJSON - Invalid layer group hierarchy");break;}n=i.pop();}else{var s,r=n.layers[n.i];if(n.i++,r.opacity*=n.opacity,r.visible=n.visible&&r.visible,"objectgroup"===r.type){r.name=n.name+r.name;for(var o=n.x+d(r,"startx",0)+d(r,"offsetx",0),a=n.y+d(r,"starty",0)+d(r,"offsety",0),h=[],u=0;u<r.objects.length;u++){var l=f(r.objects[u],o,a);h.push(l);}var c=new p(r);c.objects=h,e.push(c);}else{"group"===r.type&&(s=g(t,r,n),i.push(n),n=s);}}return e;};},function(t,e,i){var r=i(126);t.exports=function(t,e){for(var i={},n=0;n<e.length;n++){var s=e[n];r(t,s)&&(i[s]=t[s]);}return i;};},function(t,e,i){var n=i(0),s=i(2),r=new n({initialize:function(t){void 0===t&&(t={}),this.name=s(t,"name","object layer"),this.opacity=s(t,"opacity",1),this.properties=s(t,"properties",{}),this.propertyTypes=s(t,"propertytypes",{}),this.type=s(t,"type","objectgroup"),this.visible=s(t,"visible",!0),this.objects=s(t,"objects",[]);}});t.exports=r;},function(t,e,i){var P=i(574),O=i(29),L=i(161),D=i(258),F=i(2),k=i(120),I=i(261),B=i(85);t.exports=function(t,e){for(var i=F(t,"infinite",!1),n=[],s=[],r=L(t);r.i<r.layers.length||0<s.length;)if(r.i>=r.layers.length){if(s.length<1){console.warn("TilemapParser.parseTiledJSON - Invalid layer group hierarchy");break;}r=s.pop();}else{var o,a=r.layers[r.i];if(r.i++,"tilelayer"===a.type){if(a.compression)console.warn("TilemapParser.parseTiledJSON - Layer compression is unsupported, skipping layer '"+a.name+"'");else{if(a.encoding&&"base64"===a.encoding){if(a.chunks)for(var h=0;h<a.chunks.length;h++)a.chunks[h].data=P(a.chunks[h].data);a.data&&(a.data=P(a.data)),delete a.encoding;}var u,l,c=[],d=0;if(i){var f,p=F(a,"startx",0)+a.x,g=F(a,"starty",0)+a.y;(f=new k({name:r.name+a.name,x:r.x+F(a,"offsetx",0)+p*t.tilewidth,y:r.y+F(a,"offsety",0)+g*t.tileheight,width:a.width,height:a.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,alpha:r.opacity*a.opacity,visible:r.visible&&a.visible,properties:F(a,"properties",[]),orientation:D(t.orientation)})).orientation===O.HEXAGONAL&&(f.hexSideLength=t.hexsidelength);for(var v=0;v<a.height;v++){c.push([null]);for(var m=0;m<a.width;m++)c[v][m]=null;}for(v=0,M=a.chunks.length;v<M;v++)for(var y=a.chunks[v],x=y.x-p,T=y.y-g,w=0,E=0,b=y.data.length;E<b;E++){var S,A=d+x,_=w+T;0<(S=I(y.data[E])).gid?((u=new B(f,S.gid,A,_,t.tilewidth,t.tileheight)).rotation=S.rotation,u.flipX=S.flipped,c[_][A]=u):(l=e?null:new B(f,-1,A,_,t.tilewidth,t.tileheight),c[_][A]=l),++d===y.width&&(w++,d=0);}}else{(f=new k({name:r.name+a.name,x:r.x+F(a,"offsetx",0)+a.x,y:r.y+F(a,"offsety",0)+a.y,width:a.width,height:a.height,tileWidth:t.tilewidth,tileHeight:t.tileheight,alpha:r.opacity*a.opacity,visible:r.visible&&a.visible,properties:F(a,"properties",[]),orientation:D(t.orientation)})).orientation===O.HEXAGONAL&&(f.hexSideLength=t.hexsidelength);for(var C=[],R=0,M=a.data.length;R<M;R++)0<(S=I(a.data[R])).gid?((u=new B(f,S.gid,d,c.length,t.tilewidth,t.tileheight)).rotation=S.rotation,u.flipX=S.flipped,C.push(u)):(l=e?null:new B(f,-1,d,c.length,t.tilewidth,t.tileheight),C.push(l)),++d===a.width&&(c.push(C),d=0,C=[]);}f.data=c,n.push(f);}}else"group"===a.type&&(o=L(t,a,r),s.push(r),r=o);}return n;};},function(t,e){t.exports=function(t){for(var e=window.atob(t),i=e.length,n=new Array(i/4),s=0;s<i;s+=4)n[s/4]=(e.charCodeAt(s)|e.charCodeAt(s+1)<<8|e.charCodeAt(s+2)<<16|e.charCodeAt(s+3)<<24)>>>0;return n;};},function(t,e,i){var w=i(122),E=i(576),b=i(260),S=i(1453);t.exports=function(t){for(var e,i=[],n=[],s=null,r=0;r<t.tilesets.length;r++){var o=t.tilesets[r];if(o.source)console.warn("External tilesets unsupported. Use Embed Tileset and re-export");else if(o.image){var a=new w(o.name,o.firstgid,o.tilewidth,o.tileheight,o.margin,o.spacing);if(1<t.version){var h=void 0,u=void 0;if(Array.isArray(o.tiles)){h=h||{},u=u||{};for(var l=0;l<o.tiles.length;l++){var c,d,f=o.tiles[l];f.properties&&(c={},f.properties.forEach(function(t){c[t.name]=t.value;}),u[f.id]=c),f.objectgroup&&((h[f.id]||(h[f.id]={})).objectgroup=f.objectgroup,f.objectgroup.objects&&(d=f.objectgroup.objects.map(function(t){return b(t);}),h[f.id].objectgroup.objects=d)),f.animation&&((h[f.id]||(h[f.id]={})).animation=f.animation),f.type&&((h[f.id]||(h[f.id]={})).type=f.type);}}Array.isArray(o.wangsets)&&(h=h||{},u=u||{},S(o.wangsets,h)),h&&(a.tileData=h,a.tileProperties=u);}else if(o.tileproperties&&(a.tileProperties=o.tileproperties),o.tiles)for(e in a.tileData=o.tiles,a.tileData){var p,g=a.tileData[e].objectgroup;g&&g.objects&&(p=g.objects.map(function(t){return b(t);}),a.tileData[e].objectgroup.objects=p);}a.updateTileData(o.imagewidth,o.imageheight),i.push(a);}else{for(var v=new E(o.name,o.firstgid,o.tilewidth,o.tileheight,o.margin,o.spacing,o.properties),m=0,l=0;l<o.tiles.length;l++){var y=(f=o.tiles[l]).image,x=parseInt(f.id,10),T=o.firstgid+x;v.addImage(T,y),m=Math.max(x,m);}v.maxId=m,n.push(v);}s&&(s.lastgid=o.firstgid-1),s=o;}return{tilesets:i,imageCollections:n};};},function(t,e,i){var n=new(i(0))({initialize:function(t,e,i,n,s,r,o){(void 0===i||i<=0)&&(i=32),(void 0===n||n<=0)&&(n=32),void 0===s&&(s=0),void 0===r&&(r=0),this.name=t,this.firstgid=0|e,this.imageWidth=0|i,this.imageHeight=0|n,this.imageMargin=0|s,this.imageSpacing=0|r,this.properties=o||{},this.images=[],this.total=0;},containsImageIndex:function(t){return t>=this.firstgid&&t<this.firstgid+this.total;},addImage:function(t,e){return this.images.push({gid:t,image:e}),this.total++,this;}});t.exports=n;},function(t,e,i){var a=i(40),h=i(121),u=i(578),l=i(579);t.exports=function(t,e,i){if(0===e.layer.length)return console.warn("No layers found in the Weltmeister map: "+t),null;for(var n=0,s=0,r=0;r<e.layer.length;r++)e.layer[r].width>n&&(n=e.layer[r].width),e.layer[r].height>s&&(s=e.layer[r].height);var o=new h({width:n,height:s,name:t,tileWidth:e.layer[0].tilesize,tileHeight:e.layer[0].tilesize,format:a.WELTMEISTER});return o.layers=u(e,i),o.tilesets=l(e),o;};},function(t,e,i){var d=i(120),f=i(85);t.exports=function(t,e){for(var i=[],n=0;n<t.layer.length;n++){for(var s=t.layer[n],r=new d({name:s.name,width:s.width,height:s.height,tileWidth:s.tilesize,tileHeight:s.tilesize,visible:1===s.visible}),o=[],a=[],h=0;h<s.data.length;h++){for(var u=0;u<s.data[h].length;u++){var l=s.data[h][u]-1,c=-1<l?new f(r,l,u,h,s.tilesize,s.tilesize):e?null:new f(r,-1,u,h,s.tilesize,s.tilesize);o.push(c);}a.push(o),o=[];}r.data=a,i.push(r);}return i;};},function(t,e,i){var o=i(122);t.exports=function(t){for(var e=[],i=[],n=0;n<t.layer.length;n++){var s=t.layer[n],r=s.tilesetName;""!==r&&-1===i.indexOf(r)&&(i.push(r),e.push(new o(r,0,s.tilesize,s.tilesize,0,0)));}return e;};},function(t,e,i){var n=i(0),b=i(36),l=i(40),S=i(2),f=i(120),s=i(29),A=i(362),r=i(74),_=i(73),p=i(85),h=i(251),g=i(581),c=i(122),o=new n({initialize:function(t,e){this.scene=t,this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.width=e.width,this.height=e.height,this.orientation=e.orientation,this.renderOrder=e.renderOrder,this.format=e.format,this.version=e.version,this.properties=e.properties,this.widthInPixels=e.widthInPixels,this.heightInPixels=e.heightInPixels,this.imageCollections=e.imageCollections,this.images=e.images,this.layers=e.layers,this.tilesets=e.tilesets,this.objects=e.objects,this.currentLayerIndex=0,this.hexSideLength=e.hexSideLength;var i=this.orientation;this._convert={WorldToTileXY:h.GetWorldToTileXYFunction(i),WorldToTileX:h.GetWorldToTileXFunction(i),WorldToTileY:h.GetWorldToTileYFunction(i),TileToWorldXY:h.GetTileToWorldXYFunction(i),TileToWorldX:h.GetTileToWorldXFunction(i),TileToWorldY:h.GetTileToWorldYFunction(i)};},createBlankDynamicLayer:function(t,e,i,n,s,r,o,a){return console.warn("createBlankDynamicLayer is deprecated. Use createBlankLayer"),this.createBlankLayer(t,e,i,n,s,r,o,a);},createDynamicLayer:function(t,e,i,n){return console.warn("createDynamicLayer is deprecated. Use createLayer"),this.createLayer(t,e,i,n);},createStaticLayer:function(t,e,i,n){return console.warn("createStaticLayer is deprecated. Use createLayer"),this.createLayer(t,e,i,n);},setRenderOrder:function(t){var e=["right-down","left-down","right-up","left-up"];return"number"==typeof t&&(t=e[t]),-1<e.indexOf(t)&&(this.renderOrder=t),this;},addTilesetImage:function(t,e,i,n,s,r,o){if(void 0===t)return null;if(null==e&&(e=t),!this.scene.sys.textures.exists(e))return console.warn("Invalid Tileset Image: "+e),null;var a=this.scene.sys.textures.get(e),h=this.getTilesetIndex(t);if(null===h&&this.format===l.TILED_JSON)return console.warn("No data found for Tileset: "+t),null;var u=this.tilesets[h];return u?(u.setTileSize(i,n),u.setSpacing(s,r),u.setImage(a)):(void 0===i&&(i=this.tileWidth),void 0===n&&(n=this.tileHeight),void 0===s&&(s=0),void 0===r&&(r=0),void 0===o&&(o=0),(u=new c(t,o,i,n,s,r)).setImage(a),this.tilesets.push(u)),u;},copy:function(t,e,i,n,s,r,o,a){return null!==(a=this.getLayer(a))?(h.Copy(t,e,i,n,s,r,o,a),this):null;},createBlankLayer:function(t,e,i,n,s,r,o,a){if(void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=this.width),void 0===r&&(r=this.height),void 0===o&&(o=this.tileWidth),void 0===a&&(a=this.tileHeight),null!==this.getLayerIndex(t))return console.warn("Invalid Tilemap Layer ID: "+t),null;for(var h,u=new f({name:t,tileWidth:o,tileHeight:a,width:s,height:r,orientation:this.orientation}),l=0;l<r;l++){h=[];for(var c=0;c<s;c++)h.push(new p(u,-1,c,l,o,a,this.tileWidth,this.tileHeight));u.data.push(h);}this.layers.push(u),this.currentLayerIndex=this.layers.length-1;var d=new g(this.scene,this,this.currentLayerIndex,e,i,n);return d.setRenderOrder(this.renderOrder),this.scene.sys.displayList.add(d),d;},createLayer:function(t,e,i,n){var s=this.getLayerIndex(t);if(null===s)return console.warn("Invalid Tilemap Layer ID: "+t),"string"==typeof t&&console.warn("Valid tilelayer names:\n\t"+this.getTileLayerNames().join(",\n\t")),null;var r=this.layers[s];if(r.tilemapLayer)return console.warn("Tilemap Layer ID already exists:"+t),null;this.currentLayerIndex=s,void 0===i&&(i=r.x),void 0===n&&(n=r.y);var o=new g(this.scene,this,s,e,i,n);return o.setRenderOrder(this.renderOrder),this.scene.sys.displayList.add(o),o;},createFromObjects:function(t,e){var i=[],n=this.getObjectLayer(t);if(!n)return console.warn("createFromObjects: Invalid objectLayerName given: "+t),i;Array.isArray(e)||(e=[e]);for(var s=n.objects,r=0;r<e.length;r++){for(var o,a=e[r],h=S(a,"id",null),u=S(a,"gid",null),l=S(a,"name",null),c=[],d=0;d<s.length;d++)o=s[d],(null===h&&null===u&&null===l||null!==h&&o.id===h||null!==u&&o.gid===u||null!==l&&o.name===l)&&c.push(o);for(var f=S(a,"classType",_),p=S(a,"scene",this.scene),g=S(a,"container",null),v=S(a,"key",null),m=S(a,"frame",null),y=0;y<c.length;y++){o=c[y];var x=new f(p);x.setName(o.name),x.setPosition(o.x,o.y),x.setTexture(v,m),o.width&&(x.displayWidth=o.width),o.height&&(x.displayHeight=o.height);var T,w={x:x.originX*o.width,y:(x.originY-1)*o.height};if(o.rotation&&(T=b(o.rotation),A(w,T),x.rotation=T),x.x+=w.x,x.y+=w.y,void 0===o.flippedHorizontal&&void 0===o.flippedVertical||x.setFlip(o.flippedHorizontal,o.flippedVertical),o.visible||(x.visible=!1),Array.isArray(o.properties))o.properties.forEach(function(t){var e=t.name;void 0!==x[e]?x[e]=t.value:x.setData(e,t.value);});else for(var E in o.properties)void 0!==x[E]?x[E]=o.properties[E]:x.setData(E,o.properties[E]);g?g.add(x):p.add.existing(x),i.push(x);}}return i;},createFromTiles:function(t,e,i,n,s,r){return null===(r=this.getLayer(r))?null:h.CreateFromTiles(t,e,i,n,s,r);},fill:function(t,e,i,n,s,r,o){return void 0===r&&(r=!0),null===(o=this.getLayer(o))?null:(h.Fill(t,e,i,n,s,r,o),this);},filterObjects:function(t,e,i){if("string"==typeof t){var n=t;if(!(t=this.getObjectLayer(t)))return console.warn("No object layer found with the name: "+n),null;}return t.objects.filter(e,i);},filterTiles:function(t,e,i,n,s,r,o,a){return null===(a=this.getLayer(a))?null:h.FilterTiles(t,e,i,n,s,r,o,a);},findByIndex:function(t,e,i,n){return null===(n=this.getLayer(n))?null:h.FindByIndex(t,e,i,n);},findObject:function(t,e,i){if("string"==typeof t){var n=t;if(!(t=this.getObjectLayer(t)))return console.warn("No object layer found with the name: "+n),null;}return t.objects.find(e,i)||null;},findTile:function(t,e,i,n,s,r,o,a){return null===(a=this.getLayer(a))?null:h.FindTile(t,e,i,n,s,r,o,a);},forEachTile:function(t,e,i,n,s,r,o,a){return null===(a=this.getLayer(a))?null:(h.ForEachTile(t,e,i,n,s,r,o,a),this);},getImageIndex:function(t){return this.getIndex(this.images,t);},getImageLayerNames:function(){return this.images&&Array.isArray(this.images)?this.images.map(function(t){return t.name;}):[];},getIndex:function(t,e){for(var i=0;i<t.length;i++)if(t[i].name===e)return i;return null;},getLayer:function(t){var e=this.getLayerIndex(t);return null!==e?this.layers[e]:null;},getObjectLayer:function(t){var e=this.getIndex(this.objects,t);return null!==e?this.objects[e]:null;},getObjectLayerNames:function(){return this.objects&&Array.isArray(this.objects)?this.objects.map(function(t){return t.name;}):[];},getLayerIndex:function(t){return void 0===t?this.currentLayerIndex:"string"==typeof t?this.getLayerIndexByName(t):"number"==typeof t&&t<this.layers.length?t:t instanceof g?t.layerIndex:null;},getLayerIndexByName:function(t){return this.getIndex(this.layers,t);},getTileAt:function(t,e,i,n){return null===(n=this.getLayer(n))?null:h.GetTileAt(t,e,i,n);},getTileAtWorldXY:function(t,e,i,n,s){return null===(s=this.getLayer(s))?null:h.GetTileAtWorldXY(t,e,i,n,s);},getTileLayerNames:function(){return this.layers&&Array.isArray(this.layers)?this.layers.map(function(t){return t.name;}):[];},getTilesWithin:function(t,e,i,n,s,r){return null===(r=this.getLayer(r))?null:h.GetTilesWithin(t,e,i,n,s,r);},getTilesWithinShape:function(t,e,i,n){return null===(n=this.getLayer(n))?null:h.GetTilesWithinShape(t,e,i,n);},getTilesWithinWorldXY:function(t,e,i,n,s,r,o){return null===(o=this.getLayer(o))?null:h.GetTilesWithinWorldXY(t,e,i,n,s,r,o);},getTileset:function(t){var e=this.getIndex(this.tilesets,t);return null!==e?this.tilesets[e]:null;},getTilesetIndex:function(t){return this.getIndex(this.tilesets,t);},hasTileAt:function(t,e,i){return null===(i=this.getLayer(i))?null:h.HasTileAt(t,e,i);},hasTileAtWorldXY:function(t,e,i,n){return null===(n=this.getLayer(n))?null:h.HasTileAtWorldXY(t,e,i,n);},layer:{get:function(){return this.layers[this.currentLayerIndex];},set:function(t){this.setLayer(t);}},putTileAt:function(t,e,i,n,s){return void 0===n&&(n=!0),null===(s=this.getLayer(s))?null:h.PutTileAt(t,e,i,n,s);},putTileAtWorldXY:function(t,e,i,n,s,r){return void 0===n&&(n=!0),null===(r=this.getLayer(r))?null:h.PutTileAtWorldXY(t,e,i,n,s,r);},putTilesAt:function(t,e,i,n,s){return void 0===n&&(n=!0),null===(s=this.getLayer(s))?null:(h.PutTilesAt(t,e,i,n,s),this);},randomize:function(t,e,i,n,s,r){return null===(r=this.getLayer(r))?null:(h.Randomize(t,e,i,n,s,r),this);},calculateFacesAt:function(t,e,i){return null===(i=this.getLayer(i))?null:(h.CalculateFacesAt(t,e,i),this);},calculateFacesWithin:function(t,e,i,n,s){return null===(s=this.getLayer(s))?null:(h.CalculateFacesWithin(t,e,i,n,s),this);},removeLayer:function(t){var e=this.getLayerIndex(t);if(null===e)return null;r(this.layers,e);for(var i=e;i<this.layers.length;i++)this.layers[i].tilemapLayer&&this.layers[i].tilemapLayer.layerIndex--;return this.currentLayerIndex===e&&(this.currentLayerIndex=0),this;},destroyLayer:function(t){var e=this.getLayerIndex(t);return null!==e?((t=this.layers[e]).destroy(),r(this.layers,e),this.currentLayerIndex===e&&(this.currentLayerIndex=0),this):null;},removeAllLayers:function(){for(var t=this.layers,e=0;e<t.length;e++)t[e].tilemapLayer&&t[e].tilemapLayer.destroy(!1);return t.length=0,this.currentLayerIndex=0,this;},removeTile:function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=!0);var n=[];Array.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++){var r=t[s];n.push(this.removeTileAt(r.x,r.y,!0,i,r.tilemapLayer)),-1<e&&this.putTileAt(e,r.x,r.y,i,r.tilemapLayer);}return n;},removeTileAt:function(t,e,i,n,s){return void 0===i&&(i=!0),void 0===n&&(n=!0),null===(s=this.getLayer(s))?null:h.RemoveTileAt(t,e,i,n,s);},removeTileAtWorldXY:function(t,e,i,n,s,r){return void 0===i&&(i=!0),void 0===n&&(n=!0),null===(r=this.getLayer(r))?null:h.RemoveTileAtWorldXY(t,e,i,n,s,r);},renderDebug:function(t,e,i){return null===(i=this.getLayer(i))?null:(this.orientation===s.ORTHOGONAL&&h.RenderDebug(t,e,i),this);},renderDebugFull:function(t,e){for(var i=this.layers,n=0;n<i.length;n++)h.RenderDebug(t,e,i[n]);return this;},replaceByIndex:function(t,e,i,n,s,r,o){return null===(o=this.getLayer(o))?null:(h.ReplaceByIndex(t,e,i,n,s,r,o),this);},setCollision:function(t,e,i,n,s){return void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===s&&(s=!0),null===(n=this.getLayer(n))?null:(h.SetCollision(t,e,i,n,s),this);},setCollisionBetween:function(t,e,i,n,s){return void 0===i&&(i=!0),void 0===n&&(n=!0),null===(s=this.getLayer(s))?null:(h.SetCollisionBetween(t,e,i,n,s),this);},setCollisionByProperty:function(t,e,i,n){return void 0===e&&(e=!0),void 0===i&&(i=!0),null===(n=this.getLayer(n))?null:(h.SetCollisionByProperty(t,e,i,n),this);},setCollisionByExclusion:function(t,e,i,n){return void 0===e&&(e=!0),void 0===i&&(i=!0),null===(n=this.getLayer(n))?null:(h.SetCollisionByExclusion(t,e,i,n),this);},setCollisionFromCollisionGroup:function(t,e,i){return void 0===t&&(t=!0),void 0===e&&(e=!0),null===(i=this.getLayer(i))?null:(h.SetCollisionFromCollisionGroup(t,e,i),this);},setTileIndexCallback:function(t,e,i,n){return null===(n=this.getLayer(n))?null:(h.SetTileIndexCallback(t,e,i,n),this);},setTileLocationCallback:function(t,e,i,n,s,r,o){return null===(o=this.getLayer(o))?null:(h.SetTileLocationCallback(t,e,i,n,s,r,o),this);},setLayer:function(t){var e=this.getLayerIndex(t);return null!==e&&(this.currentLayerIndex=e),this;},setBaseTileSize:function(t,e){this.tileWidth=t,this.tileHeight=e,this.widthInPixels=this.width*t,this.heightInPixels=this.height*e;for(var i=0;i<this.layers.length;i++){this.layers[i].baseTileWidth=t,this.layers[i].baseTileHeight=e;for(var n=this.layers[i].data,s=this.layers[i].width,r=this.layers[i].height,o=0;o<r;o++)for(var a=0;a<s;a++){var h=n[o][a];null!==h&&h.setSize(void 0,void 0,t,e);}}return this;},setLayerTileSize:function(t,e,i){if(null===(i=this.getLayer(i)))return this;i.tileWidth=t,i.tileHeight=e;for(var n=i.data,s=i.width,r=i.height,o=0;o<r;o++)for(var a=0;a<s;a++){var h=n[o][a];null!==h&&h.setSize(t,e);}return this;},shuffle:function(t,e,i,n,s){return null===(s=this.getLayer(s))?null:(h.Shuffle(t,e,i,n,s),this);},swapByIndex:function(t,e,i,n,s,r,o){return null===(o=this.getLayer(o))?null:(h.SwapByIndex(t,e,i,n,s,r,o),this);},tileToWorldX:function(t,e,i){return null===(i=this.getLayer(i))?null:this._convert.TileToWorldX(t,e,i);},tileToWorldY:function(t,e,i){return null===(i=this.getLayer(i))?null:this._convert.TileToWorldY(t,e,i);},tileToWorldXY:function(t,e,i,n,s){return null===(s=this.getLayer(s))?null:this._convert.TileToWorldXY(t,e,i,n,s);},weightedRandomize:function(t,e,i,n,s,r){return null===(r=this.getLayer(r))?null:(h.WeightedRandomize(e,i,n,s,t,r),this);},worldToTileX:function(t,e,i,n){return null===(n=this.getLayer(n))?null:this._convert.WorldToTileX(t,e,i,n);},worldToTileY:function(t,e,i,n){return null===(n=this.getLayer(n))?null:this._convert.WorldToTileY(t,e,i,n);},worldToTileXY:function(t,e,i,n,s,r){return null===(r=this.getLayer(r))?null:this._convert.WorldToTileXY(t,e,i,n,s,r);},destroy:function(){this.removeAllLayers(),this.tilesets.length=0,this.objects.length=0,this.scene=null;}});t.exports=o;},function(t,e,i){var n=i(0),s=i(11),o=i(15),a=i(251),r=i(1456),h=new n({Extends:o,Mixins:[s.Alpha,s.BlendMode,s.ComputedSize,s.Depth,s.Flip,s.GetBounds,s.Origin,s.Pipeline,s.Transform,s.Visible,s.ScrollFactor,r],initialize:function(t,e,i,n,s,r){o.call(this,t,"TilemapLayer"),this.isTilemap=!0,this.tilemap=e,this.layerIndex=i,this.layer=e.layers[i],(this.layer.tilemapLayer=this).tileset=[],this.tilesDrawn=0,this.tilesTotal=this.layer.width*this.layer.height,this.culledTiles=[],this.skipCull=!1,this.cullPaddingX=1,this.cullPaddingY=1,this.cullCallback=a.GetCullTilesFunction(this.layer.orientation),this._renderOrder=0,this.gidMap=[],this.setTilesets(n),this.setAlpha(this.layer.alpha),this.setPosition(s,r),this.setOrigin(),this.setSize(e.tileWidth*this.layer.width,e.tileHeight*this.layer.height),this.initPipeline();},setTilesets:function(t){var e=[],i=[],n=this.tilemap;Array.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++){var r=t[s];if("string"==typeof r&&(r=n.getTileset(r)),r){i.push(r);for(var o=r.firstgid,a=0;a<r.total;a++)e[o+a]=r;}}this.gidMap=e,this.tileset=i;},setRenderOrder:function(t){return"string"==typeof t&&(t=["right-down","left-down","right-up","left-up"].indexOf(t)),0<=t&&t<4&&(this._renderOrder=t),this;},calculateFacesAt:function(t,e){return a.CalculateFacesAt(t,e,this.layer),this;},calculateFacesWithin:function(t,e,i,n){return a.CalculateFacesWithin(t,e,i,n,this.layer),this;},createFromTiles:function(t,e,i,n,s){return a.CreateFromTiles(t,e,i,n,s,this.layer);},cull:function(t){return this.cullCallback(this.layer,t,this.culledTiles,this._renderOrder);},copy:function(t,e,i,n,s,r,o){return a.Copy(t,e,i,n,s,r,o,this.layer),this;},fill:function(t,e,i,n,s,r){return a.Fill(t,e,i,n,s,r,this.layer),this;},filterTiles:function(t,e,i,n,s,r,o){return a.FilterTiles(t,e,i,n,s,r,o,this.layer);},findByIndex:function(t,e,i){return a.FindByIndex(t,e,i,this.layer);},findTile:function(t,e,i,n,s,r,o){return a.FindTile(t,e,i,n,s,r,o,this.layer);},forEachTile:function(t,e,i,n,s,r,o){return a.ForEachTile(t,e,i,n,s,r,o,this.layer),this;},getTileAt:function(t,e,i){return a.GetTileAt(t,e,i,this.layer);},getTileAtWorldXY:function(t,e,i,n){return a.GetTileAtWorldXY(t,e,i,n,this.layer);},getTilesWithin:function(t,e,i,n,s){return a.GetTilesWithin(t,e,i,n,s,this.layer);},getTilesWithinShape:function(t,e,i){return a.GetTilesWithinShape(t,e,i,this.layer);},getTilesWithinWorldXY:function(t,e,i,n,s,r){return a.GetTilesWithinWorldXY(t,e,i,n,s,r,this.layer);},hasTileAt:function(t,e){return a.HasTileAt(t,e,this.layer);},hasTileAtWorldXY:function(t,e,i){return a.HasTileAtWorldXY(t,e,i,this.layer);},putTileAt:function(t,e,i,n){return a.PutTileAt(t,e,i,n,this.layer);},putTileAtWorldXY:function(t,e,i,n,s){return a.PutTileAtWorldXY(t,e,i,n,s,this.layer);},putTilesAt:function(t,e,i,n){return a.PutTilesAt(t,e,i,n,this.layer),this;},randomize:function(t,e,i,n,s){return a.Randomize(t,e,i,n,s,this.layer),this;},removeTileAt:function(t,e,i,n){return a.RemoveTileAt(t,e,i,n,this.layer);},removeTileAtWorldXY:function(t,e,i,n,s){return a.RemoveTileAtWorldXY(t,e,i,n,s,this.layer);},renderDebug:function(t,e){return a.RenderDebug(t,e,this.layer),this;},replaceByIndex:function(t,e,i,n,s,r){return a.ReplaceByIndex(t,e,i,n,s,r,this.layer),this;},setSkipCull:function(t){return void 0===t&&(t=!0),this.skipCull=t,this;},setCullPadding:function(t,e){return void 0===t&&(t=1),void 0===e&&(e=1),this.cullPaddingX=t,this.cullPaddingY=e,this;},setCollision:function(t,e,i,n){return a.SetCollision(t,e,i,this.layer,n),this;},setCollisionBetween:function(t,e,i,n){return a.SetCollisionBetween(t,e,i,n,this.layer),this;},setCollisionByProperty:function(t,e,i){return a.SetCollisionByProperty(t,e,i,this.layer),this;},setCollisionByExclusion:function(t,e,i){return a.SetCollisionByExclusion(t,e,i,this.layer),this;},setCollisionFromCollisionGroup:function(t,e){return a.SetCollisionFromCollisionGroup(t,e,this.layer),this;},setTileIndexCallback:function(t,e,i){return a.SetTileIndexCallback(t,e,i,this.layer),this;},setTileLocationCallback:function(t,e,i,n,s,r){return a.SetTileLocationCallback(t,e,i,n,s,r,this.layer),this;},shuffle:function(t,e,i,n){return a.Shuffle(t,e,i,n,this.layer),this;},swapByIndex:function(t,e,i,n,s,r){return a.SwapByIndex(t,e,i,n,s,r,this.layer),this;},tileToWorldX:function(t,e){return this.tilemap.tileToWorldX(t,e,this);},tileToWorldY:function(t,e){return this.tilemap.tileToWorldY(t,e,this);},tileToWorldXY:function(t,e,i,n){return this.tilemap.tileToWorldXY(t,e,i,n,this);},weightedRandomize:function(t,e,i,n,s){return a.WeightedRandomize(e,i,n,s,t,this.layer),this;},worldToTileX:function(t,e,i){return this.tilemap.worldToTileX(t,e,i,this);},worldToTileY:function(t,e,i){return this.tilemap.worldToTileY(t,e,i,this);},worldToTileXY:function(t,e,i,n,s){return this.tilemap.worldToTileXY(t,e,i,n,s,this);},destroy:function(t){void 0===t&&(t=!0),this.tilemap&&(this.layer.tilemapLayer===this&&(this.layer.tilemapLayer=void 0),t&&this.tilemap.removeLayer(this),this.tilemap=void 0,this.layer=void 0,this.culledTiles.length=0,this.cullCallback=null,this.gidMap=[],this.tileset=[],o.prototype.destroy.call(this));}});t.exports=h;},function(t,e,i){var n=i(0),s=i(2),r=new n({initialize:function(t){this.delay=0,this.repeat=0,this.repeatCount=0,this.loop=!1,this.callback,this.callbackScope,this.args,this.timeScale=1,this.startAt=0,this.elapsed=0,this.paused=!1,this.hasDispatched=!1,this.reset(t);},reset:function(t){return this.delay=s(t,"delay",0),this.repeat=s(t,"repeat",0),this.loop=s(t,"loop",!1),this.callback=s(t,"callback",void 0),this.callbackScope=s(t,"callbackScope",this.callback),this.args=s(t,"args",[]),this.timeScale=s(t,"timeScale",1),this.startAt=s(t,"startAt",0),this.paused=s(t,"paused",!1),this.elapsed=this.startAt,this.hasDispatched=!1,this.repeatCount=-1===this.repeat||this.loop?999999999999:this.repeat,this;},getProgress:function(){return this.elapsed/this.delay;},getOverallProgress:function(){if(0<this.repeat){var t=this.delay+this.delay*this.repeat;return(this.elapsed+this.delay*(this.repeat-this.repeatCount))/t;}return this.getProgress();},getRepeatCount:function(){return this.repeatCount;},getElapsed:function(){return this.elapsed;},getElapsedSeconds:function(){return .001*this.elapsed;},getRemaining:function(){return this.delay-this.elapsed;},getRemainingSeconds:function(){return .001*this.getRemaining();},getOverallRemaining:function(){return this.delay*(1+this.repeatCount)-this.elapsed;},getOverallRemainingSeconds:function(){return .001*this.getOverallRemaining();},remove:function(t){void 0===t&&(t=!1),this.elapsed=this.delay,this.hasDispatched=!t,this.repeatCount=0;},destroy:function(){this.callback=void 0,this.callbackScope=void 0,this.args=[];}});t.exports=r;},function(t,e,i){var n=i(1465);t.exports=function(t){var e,i=[];if(t.hasOwnProperty("props"))for(e in t.props)"_"!==e.substr(0,1)&&i.push({key:e,value:t.props[e]});else for(e in t)-1===n.indexOf(e)&&"_"!==e.substr(0,1)&&i.push({key:e,value:t[e]});return i;};},function(t,e,i){var n=i(6);t.exports=function(t){var e=n(t,"tweens",null);return null===e?[]:("function"==typeof e&&(e=e.call()),Array.isArray(e)||(e=[e]),e);};},function(t,e,i){var _=i(265),C=i(13),R=i(99),M=i(80),P=i(162),O=i(6),L=i(264),D=i(266),F=i(268);t.exports=function(t,e,i){void 0===i&&(i=_);var n=O(e,"from",0),s=O(e,"to",1),r=[{value:n}],o=P(e,"delay",i.delay),a=P(e,"duration",i.duration),h=O(e,"easeParams",i.easeParams),u=M(O(e,"ease",i.ease),h),l=P(e,"hold",i.hold),c=P(e,"repeat",i.repeat),d=P(e,"repeatDelay",i.repeatDelay),f=R(e,"yoyo",i.yoyo),p=[],g=L("value",s),v=F(r[0],0,"value",g.getEnd,g.getStart,g.getActive,u,o,a,f,l,c,d,!1,!1);v.start=n,v.current=n,v.to=s,p.push(v);var m=new D(t,p,r);m.offset=C(e,"offset",null),m.completeDelay=C(e,"completeDelay",0),m.loop=Math.round(C(e,"loop",0)),m.loopDelay=Math.round(C(e,"loopDelay",0)),m.paused=R(e,"paused",!1),m.useFrames=R(e,"useFrames",!1);for(var y=O(e,"callbackScope",m),x=[m,null],T=D.TYPES,w=0;w<T.length;w++){var E,b,S=T[w],A=O(e,S,!1);A&&(E=O(e,S+"Scope",y),b=O(e,S+"Params",[]),m.setCallback(S,A,x.concat(b),E));}return m;};},function(t,e,i){var _=i(80),C=i(6),R=i(14);t.exports=function(t,e){void 0===e&&(e={});var h=C(e,"start",0),i=C(e,"ease",null),n=C(e,"grid",null),a=C(e,"from",0),u="first"===a,l="center"===a,c="last"===a,d="number"==typeof a,f=Array.isArray(t),p=f?parseFloat(t[0]):parseFloat(t),g=f?parseFloat(t[1]):0,v=Math.max(p,g);if(f&&(h+=p),n){var s,r,m=n[0],y=n[1],o=0,x=0,T=[];c?(o=m-1,x=y-1):d?(o=a%m,x=Math.floor(a/m)):l&&(o=(m-1)/2,x=(y-1)/2);for(var w=R.MIN_SAFE_INTEGER,E=0;E<y;E++){T[E]=[];for(var b=0;b<m;b++){s=o-b,r=x-E;var S=Math.sqrt(s*s+r*r);w<S&&(w=S),T[E][b]=S;}}}var A=i?_(i):null;return n?function(t,e,i,n){var s,r=0,o=n%m,a=Math.floor(n/m);return 0<=o&&o<m&&0<=a&&a<y&&(r=T[a][o]),(f?(s=g-p,A?r/w*s*A(r/w):r/w*s):A?r*p*A(r/w):r*p)+h;}:function(t,e,i,n,s){var r,o;return s--,u?r=n:l?r=Math.abs(s/2-n):c?r=s-n:d&&(r=Math.abs(a-n)),(f?(o=l?(g-p)/s*(2*r):(g-p)/s*r,A?o*A(r/s):o):A?s*v*A(r/s):r*p)+h;};};},function(t,e,i){var S=i(77),A=i(265),_=i(13),C=i(99),R=i(80),M=i(162),P=i(263),O=i(584),L=i(6),D=i(588),F=i(163);t.exports=function(t,e){var i=new D(t);i.completeDelay=_(e,"completeDelay",0),i.loop=Math.round(_(e,"loop",0)),i.loopDelay=Math.round(_(e,"loopDelay",0)),i.paused=C(e,"paused",!1),i.useFrames=C(e,"useFrames",!1);var n,s,r=L(e,"callbackScope",i),o=[i],a=L(e,"onStart",!1);a&&(n=L(e,"onStartScope",r),s=L(e,"onStartParams",[]),i.setCallback("onStart",a,o.concat(s),n));var h,u,l=L(e,"onUpdate",!1);l&&(h=L(e,"onUpdateScope",r),u=L(e,"onUpdateParams",[]),i.setCallback("onUpdate",l,o.concat(u),h));var c,d,f=L(e,"onLoop",!1);f&&(c=L(e,"onLoopScope",r),d=L(e,"onLoopParams",[]),i.setCallback("onLoop",f,o.concat(d),c));var p,g,v=L(e,"onYoyo",!1);v&&(p=L(e,"onYoyoScope",r),g=L(e,"onYoyoParams",[]),i.setCallback("onYoyo",v,o.concat(null,g),p));var m,y,x=L(e,"onComplete",!1);x&&(m=L(e,"onCompleteScope",r),y=L(e,"onCompleteParams",[]),i.setCallback("onComplete",x,o.concat(y),m));var T=O(e);if(0===T.length)return i.paused=!0,i;var w=S(A);w.targets=P(e);var E=_(e,"totalDuration",0);w.duration=0<E?Math.floor(E/T.length):M(e,"duration",w.duration),w.delay=M(e,"delay",w.delay),w.easeParams=L(e,"easeParams",w.easeParams),w.ease=R(L(e,"ease",w.ease),w.easeParams),w.hold=M(e,"hold",w.hold),w.repeat=M(e,"repeat",w.repeat),w.repeatDelay=M(e,"repeatDelay",w.repeatDelay),w.yoyo=C(e,"yoyo",w.yoyo),w.flipX=C(e,"flipX",w.flipX),w.flipY=C(e,"flipY",w.flipY);for(var b=0;b<T.length;b++)i.queue(F(i,T[b],w));return i;};},function(t,e,i){var n=i(0),s=i(9),r=i(267),o=i(163),a=i(100),h=new n({Extends:s,initialize:function(t){s.call(this),this.manager=t,this.isTimeline=!0,this.data=[],this.totalData=0,this.useFrames=!1,this.timeScale=1,this.loop=0,this.loopDelay=0,this.loopCounter=0,this.completeDelay=0,this.countdown=0,this.state=a.PENDING_ADD,this._pausedState=a.PENDING_ADD,this.paused=!1,this.elapsed=0,this.totalElapsed=0,this.duration=0,this.progress=0,this.totalDuration=0,this.totalProgress=0,this.callbacks={onComplete:null,onLoop:null,onStart:null,onUpdate:null,onYoyo:null},this.callbackScope;},dispatchTimelineEvent:function(t,e){this.emit(t,this),e&&e.func.apply(e.scope,e.params);},setTimeScale:function(t){return this.timeScale=t,this;},getTimeScale:function(){return this.timeScale;},isPlaying:function(){return this.state===a.ACTIVE;},add:function(t){return this.queue(o(this,t));},queue:function(t){return this.isPlaying()||(t.parent=this,t.parentIsTimeline=!0,this.data.push(t),this.totalData=this.data.length),this;},hasOffset:function(t){return null!==t.offset;},isOffsetAbsolute:function(t){return"number"==typeof t;},isOffsetRelative:function(t){if("string"==typeof t){var e=t[0];if("-"===e||"+"===e)return!0;}return!1;},getRelativeOffset:function(t,e){var i=t[0],n=parseFloat(t.substr(2)),s=e;switch(i){case"+":s+=n;break;case"-":s-=n;}return Math.max(0,s);},calcDuration:function(){for(var t=0,e=0,i=0,n=0;n<this.totalData;n++){var s=this.data[n];s.init(),this.hasOffset(s)?this.isOffsetAbsolute(s.offset)?(s.calculatedOffset=s.offset,0===s.offset&&(i=0)):this.isOffsetRelative(s.offset)&&(s.calculatedOffset=this.getRelativeOffset(s.offset,t)):s.calculatedOffset=i,t=s.totalDuration+s.calculatedOffset,e+=s.totalDuration,i+=s.totalDuration;}this.duration=e,this.loopCounter=-1===this.loop?999999999999:this.loop,0<this.loopCounter?this.totalDuration=this.duration+this.completeDelay+(this.duration+this.loopDelay)*this.loopCounter:this.totalDuration=this.duration+this.completeDelay;},init:function(){return this.calcDuration(),this.progress=0,this.totalProgress=0,!this.paused||(this.state=a.PAUSED,!1);},resetTweens:function(t){for(var e=0;e<this.totalData;e++){this.data[e].play(t);}},setCallback:function(t,e,i,n){return-1!==h.TYPES.indexOf(t)&&(this.callbacks[t]={func:e,scope:n,params:i}),this;},makeActive:function(t){return this.manager.makeActive(t);},play:function(){if(this.state!==a.ACTIVE){if(this.paused)return this.paused=!1,void this.manager.makeActive(this);this.resetTweens(!1),this.state=a.ACTIVE,this.dispatchTimelineEvent(r.TIMELINE_START,this.callbacks.onStart);}},nextState:function(){0<this.loopCounter?(this.elapsed=0,this.progress=0,this.loopCounter--,this.resetTweens(!0),0<this.loopDelay?(this.countdown=this.loopDelay,this.state=a.LOOP_DELAY):(this.state=a.ACTIVE,this.dispatchTimelineEvent(r.TIMELINE_LOOP,this.callbacks.onLoop))):0<this.completeDelay?(this.state=a.COMPLETE_DELAY,this.countdown=this.completeDelay):(this.state=a.PENDING_REMOVE,this.dispatchTimelineEvent(r.TIMELINE_COMPLETE,this.callbacks.onComplete));},update:function(t,e){if(this.state!==a.PAUSED){switch(this.useFrames&&(e=+this.manager.timeScale),e*=this.timeScale,this.elapsed+=e,this.progress=Math.min(this.elapsed/this.duration,1),this.totalElapsed+=e,this.totalProgress=Math.min(this.totalElapsed/this.totalDuration,1),this.state){case a.ACTIVE:for(var i=this.totalData,n=0;n<this.totalData;n++){this.data[n].update(t,e)&&i--;}this.dispatchTimelineEvent(r.TIMELINE_UPDATE,this.callbacks.onUpdate),0===i&&this.nextState();break;case a.LOOP_DELAY:this.countdown-=e,this.countdown<=0&&(this.state=a.ACTIVE,this.dispatchTimelineEvent(r.TIMELINE_LOOP,this.callbacks.onLoop));break;case a.COMPLETE_DELAY:this.countdown-=e,this.countdown<=0&&(this.state=a.PENDING_REMOVE,this.dispatchTimelineEvent(r.TIMELINE_COMPLETE,this.callbacks.onComplete));}return this.state===a.PENDING_REMOVE;}},stop:function(){this.state=a.PENDING_REMOVE;},pause:function(){if(this.state!==a.PAUSED)return this.paused=!0,this._pausedState=this.state,this.state=a.PAUSED,this.emit(r.TIMELINE_PAUSE,this),this;},resume:function(){return this.state===a.PAUSED&&(this.paused=!1,this.state=this._pausedState,this.emit(r.TIMELINE_RESUME,this)),this;},hasTarget:function(t){for(var e=0;e<this.data.length;e++)if(this.data[e].hasTarget(t))return!0;return!1;},destroy:function(){for(var t=0;t<this.data.length;t++)this.data[t].stop();}});h.TYPES=["onStart","onUpdate","onLoop","onComplete","onYoyo"],t.exports=h;},,,,,,,,,,,,function(t,e){var i=function(){return this;}();try{i=i||new Function("return this")();}catch(t){"object"==typeof window&&(i=window);}t.exports=i;},function(t,e,i){var a=i(276);t.exports=function(t,e,i,n){for(var s=t[0],r=1;r<t.length;r++){var o=t[r];a(o,s,e,i,n),s=o;}return t;};},function(t,e,i){var r=i(46);t.exports=function(t,e,i,n,s){return r(t,"angle",e,i,n,s);};},function(t,e){t.exports=function(t,e,i){for(var n=0;n<t.length;n++){var s=t[n];e.call(i,s);}return t;};},function(t,e){t.exports=function(t,e,i){void 0===i&&(i=0);for(var n=i;n<t.length;n++){var s=t[n],r=!0;for(var o in e)s[o]!==e[o]&&(r=!1);if(r)return s;}return null;};},function(t,e){t.exports=function(t,e,i){void 0===i&&(i=0);for(var n=i;n<t.length;n++){var s=t[n],r=!0;for(var o in e)s[o]!==e[o]&&(r=!1);if(r)return s;}return null;};},function(t,e,i){var v=i(289),m=i(123),y=i(2),n=i(1),x=new(i(129))({sys:{queueDepthSort:n,events:{once:n}}},0,0,1,1);t.exports=function(t,e){void 0===e&&(e={});var i=e.hasOwnProperty("width"),n=e.hasOwnProperty("height"),s=y(e,"width",-1),r=y(e,"height",-1),o=y(e,"cellWidth",1),a=y(e,"cellHeight",o),h=y(e,"position",m.TOP_LEFT),u=y(e,"x",0),l=y(e,"y",0),c=0,d=0,f=s*o,p=r*a;x.setPosition(u,l),x.setSize(o,a);for(var g=0;g<t.length;g++)if(v(t[g],x,h),i&&-1===s)x.x+=o;else if(n&&-1===r)x.y+=a;else if(n&&!i){if(d+=a,x.y+=a,d===p&&(d=0,c+=o,x.y=l,x.x+=o,c===f))break;}else if(c+=o,x.x+=o,c===f&&(c=0,d+=a,x.x=u,x.y+=a,d===p))break;return t;};},function(t,e,i){var s=i(18),n={_alpha:1,_alphaTL:1,_alphaTR:1,_alphaBL:1,_alphaBR:1,clearAlpha:function(){return this.setAlpha(1);},setAlpha:function(t,e,i,n){return void 0===t&&(t=1),void 0===e?this.alpha=t:(this._alphaTL=s(t,0,1),this._alphaTR=s(e,0,1),this._alphaBL=s(i,0,1),this._alphaBR=s(n,0,1)),this;},alpha:{get:function(){return this._alpha;},set:function(t){var e=s(t,0,1);this._alpha=e,this._alphaTL=e,this._alphaTR=e,this._alphaBL=e,0===(this._alphaBR=e)?this.renderFlags&=-3:this.renderFlags|=2;}},alphaTopLeft:{get:function(){return this._alphaTL;},set:function(t){var e=s(t,0,1);0!==(this._alphaTL=e)&&(this.renderFlags|=2);}},alphaTopRight:{get:function(){return this._alphaTR;},set:function(t){var e=s(t,0,1);0!==(this._alphaTR=e)&&(this.renderFlags|=2);}},alphaBottomLeft:{get:function(){return this._alphaBL;},set:function(t){var e=s(t,0,1);0!==(this._alphaBL=e)&&(this.renderFlags|=2);}},alphaBottomRight:{get:function(){return this._alphaBR;},set:function(t){var e=s(t,0,1);0!==(this._alphaBR=e)&&(this.renderFlags|=2);}}};t.exports=n;},function(t,e){t.exports={width:0,height:0,displayWidth:{get:function(){return this.scaleX*this.width;},set:function(t){this.scaleX=t/this.width;}},displayHeight:{get:function(){return this.scaleY*this.height;},set:function(t){this.scaleY=t/this.height;}},setSize:function(t,e){return this.width=t,this.height=e,this;},setDisplaySize:function(t,e){return this.displayWidth=t,this.displayHeight=e,this;}};},function(t,e){var i={texture:null,frame:null,isCropped:!1,setCrop:function(t,e,i,n){return void 0===t?this.isCropped=!1:this.frame&&("number"==typeof t?this.frame.setCropUVs(this._crop,t,e,i,n,this.flipX,this.flipY):this.frame.setCropUVs(this._crop,t.x,t.y,t.width,t.height,this.flipX,this.flipY),this.isCropped=!0),this;},resetCropObject:function(){return{u0:0,v0:0,u1:0,v1:0,width:0,height:0,x:0,y:0,flipX:!1,flipY:!1,cx:0,cy:0,cw:0,ch:0};}};t.exports=i;},function(t,e){t.exports={flipX:!1,flipY:!1,toggleFlipX:function(){return this.flipX=!this.flipX,this;},toggleFlipY:function(){return this.flipY=!this.flipY,this;},setFlipX:function(t){return this.flipX=t,this;},setFlipY:function(t){return this.flipY=t,this;},setFlip:function(t,e){return this.flipX=t,this.flipY=e,this;},resetFlip:function(){return this.flipX=!1,this.flipY=!1,this;}};},function(t,e,i){var l=i(10),n=i(308),s=i(3),r={prepareBoundsOutput:function(t,e){return void 0===e&&(e=!1),0!==this.rotation&&n(t,this.x,this.y,this.rotation),e&&this.parentContainer&&this.parentContainer.getBoundsTransformMatrix().transformPoint(t.x,t.y,t),t;},getCenter:function(t){return void 0===t&&(t=new s()),t.x=this.x-this.displayWidth*this.originX+this.displayWidth/2,t.y=this.y-this.displayHeight*this.originY+this.displayHeight/2,t;},getTopLeft:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX,t.y=this.y-this.displayHeight*this.originY,this.prepareBoundsOutput(t,e);},getTopCenter:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX+this.displayWidth/2,t.y=this.y-this.displayHeight*this.originY,this.prepareBoundsOutput(t,e);},getTopRight:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX+this.displayWidth,t.y=this.y-this.displayHeight*this.originY,this.prepareBoundsOutput(t,e);},getLeftCenter:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX,t.y=this.y-this.displayHeight*this.originY+this.displayHeight/2,this.prepareBoundsOutput(t,e);},getRightCenter:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX+this.displayWidth,t.y=this.y-this.displayHeight*this.originY+this.displayHeight/2,this.prepareBoundsOutput(t,e);},getBottomLeft:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX,t.y=this.y-this.displayHeight*this.originY+this.displayHeight,this.prepareBoundsOutput(t,e);},getBottomCenter:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX+this.displayWidth/2,t.y=this.y-this.displayHeight*this.originY+this.displayHeight,this.prepareBoundsOutput(t,e);},getBottomRight:function(t,e){return(t=t||new s()).x=this.x-this.displayWidth*this.originX+this.displayWidth,t.y=this.y-this.displayHeight*this.originY+this.displayHeight,this.prepareBoundsOutput(t,e);},getBounds:function(t){var e,i,n,s,r,o,a,h,u;return void 0===t&&(t=new l()),h=(a=(this.parentContainer?(u=this.parentContainer.getBoundsTransformMatrix(),this.getTopLeft(t),u.transformPoint(t.x,t.y,t),e=t.x,i=t.y,this.getTopRight(t),u.transformPoint(t.x,t.y,t),n=t.x,s=t.y,this.getBottomLeft(t),u.transformPoint(t.x,t.y,t),r=t.x,o=t.y,this.getBottomRight(t),u.transformPoint(t.x,t.y,t)):(this.getTopLeft(t),e=t.x,i=t.y,this.getTopRight(t),n=t.x,s=t.y,this.getBottomLeft(t),r=t.x,o=t.y,this.getBottomRight(t)),t.x),t.y),t.x=Math.min(e,n,r,a),t.y=Math.min(i,s,o,h),t.width=Math.max(e,n,r,a)-t.x,t.height=Math.max(i,s,o,h)-t.y,t;}};t.exports=r;},function(t,e){t.exports="blur";},function(t,e){t.exports="boot";},function(t,e){t.exports="contextlost";},function(t,e){t.exports="contextrestored";},function(t,e){t.exports="destroy";},function(t,e){t.exports="focus";},function(t,e){t.exports="hidden";},function(t,e){t.exports="pause";},function(t,e){t.exports="postrender";},function(t,e){t.exports="poststep";},function(t,e){t.exports="prerender";},function(t,e){t.exports="prestep";},function(t,e){t.exports="ready";},function(t,e){t.exports="resume";},function(t,e){t.exports="step";},function(t,e){t.exports="visible";},function(t,e){t.exports="postrender";},function(t,e){t.exports="prerender";},function(t,e){t.exports="render";},function(t,e){t.exports="resize";},function(t,e){var i={_originComponent:!0,originX:.5,originY:.5,_displayOriginX:0,_displayOriginY:0,displayOriginX:{get:function(){return this._displayOriginX;},set:function(t){this._displayOriginX=t,this.originX=t/this.width;}},displayOriginY:{get:function(){return this._displayOriginY;},set:function(t){this._displayOriginY=t,this.originY=t/this.height;}},setOrigin:function(t,e){return void 0===t&&(t=.5),void 0===e&&(e=t),this.originX=t,this.originY=e,this.updateDisplayOrigin();},setOriginFromFrame:function(){return this.frame&&this.frame.customPivot?(this.originX=this.frame.pivotX,this.originY=this.frame.pivotY,this.updateDisplayOrigin()):this.setOrigin();},setDisplayOrigin:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.displayOriginX=t,this.displayOriginY=e,this;},updateDisplayOrigin:function(){return this._displayOriginX=this.originX*this.width,this._displayOriginY=this.originY*this.height,this;}};t.exports=i;},function(t,e,i){var h=i(36),o=i(99),a=i(6),u=i(100),l=i(3),n={path:null,rotateToPath:!1,pathRotationOffset:0,pathOffset:null,pathVector:null,pathDelta:null,pathTween:null,pathConfig:null,_prevDirection:u.PLAYING_FORWARD,setPath:function(t,e){void 0===e&&(e=this.pathConfig);var i=this.pathTween;return i&&i.isPlaying()&&i.stop(),this.path=t,e&&this.startFollow(e),this;},setRotateToPath:function(t,e){return void 0===e&&(e=0),this.rotateToPath=t,this.pathRotationOffset=e,this;},isFollowing:function(){var t=this.pathTween;return t&&t.isPlaying();},startFollow:function(t,e){void 0===t&&(t={}),void 0===e&&(e=0);var i=this.pathTween;i&&i.isPlaying()&&i.stop(),"number"==typeof t&&(t={duration:t}),t.from=a(t,"from",0),t.to=a(t,"to",1);var n=o(t,"positionOnPath",!1);this.rotateToPath=o(t,"rotateToPath",!1),this.pathRotationOffset=a(t,"rotationOffset",0);var s,r=a(t,"startAt",e);return r&&(t.onStart=function(t){var e=t.data[0];e.progress=r,e.elapsed=e.duration*r;var i=e.ease(e.progress);e.current=e.start+(e.end-e.start)*i,e.target[e.key]=e.current;}),this.pathOffset||(this.pathOffset=new l(this.x,this.y)),this.pathVector||(this.pathVector=new l()),this.pathDelta||(this.pathDelta=new l()),this.pathDelta.reset(),this.pathTween=this.scene.sys.tweens.addCounter(t),this.path.getStartPoint(this.pathOffset),n&&(this.x=this.pathOffset.x,this.y=this.pathOffset.y),this.pathOffset.x=this.x-this.pathOffset.x,this.pathOffset.y=this.y-this.pathOffset.y,this._prevDirection=u.PLAYING_FORWARD,this.rotateToPath&&(s=this.path.getPoint(.1),this.rotation=Math.atan2(s.y-this.y,s.x-this.x)+h(this.pathRotationOffset)),this.pathConfig=t,this;},pauseFollow:function(){var t=this.pathTween;return t&&t.isPlaying()&&t.pause(),this;},resumeFollow:function(){var t=this.pathTween;return t&&t.isPaused()&&t.resume(),this;},stopFollow:function(){var t=this.pathTween;return t&&t.isPlaying()&&t.stop(),this;},pathUpdate:function(){var t=this.pathTween;if(t){var e=t.data[0],i=this.pathDelta,n=this.pathVector;if(i.copy(n).negate(),e.state===u.COMPLETE)return this.path.getPoint(1,n),i.add(n),n.add(this.pathOffset),void this.setPosition(n.x,n.y);if(e.state!==u.PLAYING_FORWARD&&e.state!==u.PLAYING_BACKWARD)return;this.path.getPoint(t.getValue(),n),i.add(n),n.add(this.pathOffset);var s=this.x,r=this.y;this.setPosition(n.x,n.y);var o=this.x-s,a=this.y-r;if(0==o&&0==a)return;if(e.state!==this._prevDirection)return void(this._prevDirection=e.state);this.rotateToPath&&(this.rotation=Math.atan2(a,o)+h(this.pathRotationOffset));}}};t.exports=n;},function(t,e){var i={_sizeComponent:!0,width:0,height:0,displayWidth:{get:function(){return Math.abs(this.scaleX*this.frame.realWidth);},set:function(t){this.scaleX=t/this.frame.realWidth;}},displayHeight:{get:function(){return Math.abs(this.scaleY*this.frame.realHeight);},set:function(t){this.scaleY=t/this.frame.realHeight;}},setSizeToFrame:function(t){return void 0===t&&(t=this.frame),this.width=t.realWidth,this.height=t.realHeight,this;},setSize:function(t,e){return this.width=t,this.height=e,this;},setDisplaySize:function(t,e){return this.displayWidth=t,this.displayHeight=e,this;}};t.exports=i;},function(t,e){var i={texture:null,frame:null,isCropped:!1,setTexture:function(t,e){return this.texture=this.scene.sys.textures.get(t),this.setFrame(e);},setFrame:function(t,e,i){return void 0===e&&(e=!0),void 0===i&&(i=!0),this.frame=this.texture.get(t),this.frame.cutWidth&&this.frame.cutHeight?this.renderFlags|=8:this.renderFlags&=-9,this._sizeComponent&&e&&this.setSizeToFrame(),this._originComponent&&i&&(this.frame.customPivot?this.setOrigin(this.frame.pivotX,this.frame.pivotY):this.updateDisplayOrigin()),this;}};t.exports=i;},function(t,e){var i={texture:null,frame:null,isCropped:!1,setCrop:function(t,e,i,n){return void 0===t?this.isCropped=!1:this.frame&&("number"==typeof t?this.frame.setCropUVs(this._crop,t,e,i,n,this.flipX,this.flipY):this.frame.setCropUVs(this._crop,t.x,t.y,t.width,t.height,this.flipX,this.flipY),this.isCropped=!0),this;},setTexture:function(t,e){return this.texture=this.scene.sys.textures.get(t),this.setFrame(e);},setFrame:function(t,e,i){return void 0===e&&(e=!0),void 0===i&&(i=!0),this.frame=this.texture.get(t),this.frame.cutWidth&&this.frame.cutHeight?this.renderFlags|=8:this.renderFlags&=-9,this._sizeComponent&&e&&this.setSizeToFrame(),this._originComponent&&i&&(this.frame.customPivot?this.setOrigin(this.frame.pivotX,this.frame.pivotY):this.updateDisplayOrigin()),this.isCropped&&this.frame.updateCropUVs(this._crop,this.flipX,this.flipY),this;},resetCropObject:function(){return{u0:0,v0:0,u1:0,v1:0,width:0,height:0,x:0,y:0,flipX:!1,flipY:!1,cx:0,cy:0,cw:0,ch:0};}};t.exports=i;},function(t,e){var i={tintTopLeft:16777215,tintTopRight:16777215,tintBottomLeft:16777215,tintBottomRight:16777215,tintFill:!1,clearTint:function(){return this.setTint(16777215),this;},setTint:function(t,e,i,n){return void 0===t&&(t=16777215),void 0===e&&(n=i=e=t),this.tintTopLeft=t,this.tintTopRight=e,this.tintBottomLeft=i,this.tintBottomRight=n,this.tintFill=!1,this;},setTintFill:function(t,e,i,n){return this.setTint(t,e,i,n),this.tintFill=!0,this;},tint:{set:function(t){this.setTint(t,t,t,t);}},isTinted:{get:function(){var t=16777215;return this.tintFill||this.tintTopLeft!==t||this.tintTopRight!==t||this.tintBottomLeft!==t||this.tintBottomRight!==t;}}};t.exports=i;},function(t,e){t.exports="changedata";},function(t,e){t.exports="changedata-";},function(t,e){t.exports="destroy";},function(t,e){t.exports="removedata";},function(t,e){t.exports="setdata";},function(t,e){t.exports="addedtoscene";},function(t,e){t.exports="destroy";},function(t,e){t.exports="removedfromscene";},function(t,e){t.exports="complete";},function(t,e){t.exports="created";},function(t,e){t.exports="error";},function(t,e){t.exports="loop";},function(t,e){t.exports="play";},function(t,e){t.exports="seeked";},function(t,e){t.exports="seeking";},function(t,e){t.exports="stop";},function(t,e){t.exports="timeout";},function(t,e){t.exports="unlocked";},function(t,e){t.exports="addedtoscene";},function(t,e){t.exports="boot";},function(t,e){t.exports="create";},function(t,e){t.exports="destroy";},function(t,e){t.exports="pause";},function(t,e){t.exports="postupdate";},function(t,e){t.exports="prerender";},function(t,e){t.exports="preupdate";},function(t,e){t.exports="ready";},function(t,e){t.exports="removedfromscene";},function(t,e){t.exports="render";},function(t,e){t.exports="resume";},function(t,e){t.exports="shutdown";},function(t,e){t.exports="sleep";},function(t,e){t.exports="start";},function(t,e){t.exports="transitioncomplete";},function(t,e){t.exports="transitioninit";},function(t,e){t.exports="transitionout";},function(t,e){t.exports="transitionstart";},function(t,e){t.exports="transitionwake";},function(t,e){t.exports="update";},function(t,e){t.exports="wake";},function(t,e,i){var r=i(46);t.exports=function(t,e,i,n,s){return r(t,"alpha",e,i,n,s);};},function(t,e,i){var r=i(46);t.exports=function(t,e,i,n,s){return r(t,"x",e,i,n,s);};},function(t,e,i){var a=i(46);t.exports=function(t,e,i,n,s,r,o){return null==i&&(i=e),a(t,"x",e,n,r,o),a(t,"y",i,s,r,o);};},function(t,e,i){var r=i(46);t.exports=function(t,e,i,n,s){return r(t,"y",e,i,n,s);};},function(t,e){t.exports=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=6.28);for(var s=i,r=(n-i)/t.length,o=0;o<t.length;o++)t[o].x=e.x+e.radius*Math.cos(s),t[o].y=e.y+e.radius*Math.sin(s),s+=r;return t;};},function(t,e){t.exports=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=6.28);for(var s=i,r=(n-i)/t.length,o=e.width/2,a=e.height/2,h=0;h<t.length;h++)t[h].x=e.x+o*Math.cos(s),t[h].y=e.y+a*Math.sin(s),s+=r;return t;};},function(t,e,i){var o=i(172);t.exports=function(t,e){for(var i=o(e,t.length),n=0;n<t.length;n++){var s=t[n],r=i[n];s.x=r.x,s.y=r.y;}return t;};},function(t,e,i){var r=i(316),o=i(178),a=i(179);t.exports=function(t,e,i){void 0===i&&(i=0);var n=r(e,!1,t.length);0<i?o(n,i):i<0&&a(n,Math.abs(i));for(var s=0;s<t.length;s++)t[s].x=n[s].x,t[s].y=n[s].y;return t;};},function(t,e,i){var c=i(317);t.exports=function(t,e,i){var n=c({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},i),s=c({x1:e.x2,y1:e.y2,x2:e.x3,y2:e.y3},i),r=c({x1:e.x3,y1:e.y3,x2:e.x1,y2:e.y1},i);n.pop(),s.pop(),r.pop();for(var o=(n=n.concat(s,r)).length/t.length,a=0,h=0;h<t.length;h++){var u=t[h],l=n[Math.floor(a)];u.x=l.x,u.y=l.y,a+=o;}return t;};},function(t,e){t.exports=function(t,e,i){for(var n=0;n<t.length;n++){var s=t[n];s.anims&&s.anims.play(e,i);}return t;};},function(t,e,i){var n=i(170);t.exports=function(t,e){for(var i=0;i<t.length;i++)n(e,t[i]);return t;};},function(t,e,i){var n=i(180);t.exports=function(t,e){for(var i=0;i<t.length;i++)n(e,t[i]);return t;};},function(t,e,i){var n=i(173);t.exports=function(t,e){for(var i=0;i<t.length;i++)n(e,t[i]);return t;};},function(t,e,i){var n=i(174);t.exports=function(t,e){for(var i=0;i<t.length;i++)n(e,t[i]);return t;};},function(t,e,i){var n=i(181);t.exports=function(t,e){for(var i=0;i<t.length;i++)n(e,t[i]);return t;};},function(t,e,i){var r=i(46);t.exports=function(t,e,i,n,s){return r(t,"rotation",e,i,n,s);};},function(t,e,i){var a=i(182),h=i(50);t.exports=function(t,e,i){for(var n=e.x,s=e.y,r=0;r<t.length;r++){var o=t[r];a(o,n,s,i,Math.max(1,h(o.x,o.y,n,s)));}return t;};},function(t,e,i){var a=i(182);t.exports=function(t,e,i,n){var s=e.x,r=e.y;if(0===n)return t;for(var o=0;o<t.length;o++)a(t[o],s,r,i,n);return t;};},function(t,e,i){var r=i(46);t.exports=function(t,e,i,n,s){return r(t,"scaleX",e,i,n,s);};},function(t,e,i){var a=i(46);t.exports=function(t,e,i,n,s,r,o){return null==i&&(i=e),a(t,"scaleX",e,n,r,o),a(t,"scaleY",i,s,r,o);};},function(t,e,i){var r=i(46);t.exports=function(t,e,i,n,s){return r(t,"scaleY",e,i,n,s);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"alpha",e,i,n,s);};},function(t,e,i){var s=i(27);t.exports=function(t,e,i,n){return s(t,"blendMode",e,0,i,n);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"depth",e,i,n,s);};},function(t,e){t.exports=function(t,e,i){for(var n=0;n<t.length;n++)t[n].setInteractive(e,i);return t;};},function(t,e,i){var a=i(27);t.exports=function(t,e,i,n,s,r,o){return null==i&&(i=e),a(t,"originX",e,n,r,o),a(t,"originY",i,s,r,o),t.forEach(function(t){t.updateDisplayOrigin();}),t;};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"rotation",e,i,n,s);};},function(t,e,i){var a=i(27);t.exports=function(t,e,i,n,s,r,o){return null==i&&(i=e),a(t,"scaleX",e,n,r,o),a(t,"scaleY",i,s,r,o);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"scaleX",e,i,n,s);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"scaleY",e,i,n,s);};},function(t,e,i){var a=i(27);t.exports=function(t,e,i,n,s,r,o){return null==i&&(i=e),a(t,"scrollFactorX",e,n,r,o),a(t,"scrollFactorY",i,s,r,o);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"scrollFactorX",e,i,n,s);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"scrollFactorY",e,i,n,s);};},function(t,e){t.exports=function(t,e,i,n,s){for(var r=0;r<t.length;r++)t[r].setTint(e,i,n,s);return t;};},function(t,e,i){var s=i(27);t.exports=function(t,e,i,n){return s(t,"visible",e,0,i,n);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"x",e,i,n,s);};},function(t,e,i){var a=i(27);t.exports=function(t,e,i,n,s,r,o){return null==i&&(i=e),a(t,"x",e,n,r,o),a(t,"y",i,s,r,o);};},function(t,e,i){var r=i(27);t.exports=function(t,e,i,n,s){return r(t,"y",e,i,n,s);};},function(t,e,i){var d=i(3);t.exports=function(t,e,i,n,s){var r,o,a;if(void 0===n&&(n=0),void 0===s&&(s=new d()),1<t.length){if(0===n){for(var h=t.length-1,u=t[h].x,l=t[h].y,c=h-1;0<=c;c--)r=(a=t[c]).x,o=a.y,a.x=u,a.y=l,u=r,l=o;t[h].x=e,t[h].y=i;}else{for(u=t[0].x,l=t[0].y,c=1;c<t.length;c++)r=(a=t[c]).x,o=a.y,a.x=u,a.y=l,u=r,l=o;t[0].x=e,t[0].y=i;}}else u=t[0].x,l=t[0].y,t[0].x=e,t[0].y=i;return s.x=u,s.y=l,s;};},function(t,e,i){var n=i(131);t.exports=function(t){return n(t);};},function(t,e,i){var a=i(183);t.exports=function(t,e,i,n,s){void 0===s&&(s=!1);var r,o=Math.abs(n-i)/t.length;if(s)for(r=0;r<t.length;r++)t[r][e]+=a(r*o,i,n);else for(r=0;r<t.length;r++)t[r][e]=a(r*o,i,n);return t;};},function(t,e,i){var a=i(184);t.exports=function(t,e,i,n,s){void 0===s&&(s=!1);var r,o=Math.abs(n-i)/t.length;if(s)for(r=0;r<t.length;r++)t[r][e]+=a(r*o,i,n);else for(r=0;r<t.length;r++)t[r][e]=a(r*o,i,n);return t;};},function(t,e){t.exports=function(t,e,i,n,s){void 0===s&&(s=!1);var r,o=Math.abs(n-i)/t.length;if(s)for(r=0;r<t.length;r++)t[r][e]+=r*o+i;else for(r=0;r<t.length;r++)t[r][e]=r*o+i;return t;};},function(t,e){t.exports=function(t){for(var e=0;e<t.length;e++)t[e].visible=!t[e].visible;return t;};},function(t,e,i){var r=i(68);t.exports=function(t,e,i){void 0===i&&(i=0);for(var n=0;n<t.length;n++){var s=t[n];s.x=r(s.x,e.left-i,e.right+i),s.y=r(s.y,e.top-i,e.bottom+i);}return t;};},function(t,e,i){t.exports={Animation:i(185),AnimationFrame:i(319),AnimationManager:i(321),AnimationState:i(164),Events:i(132)};},function(t,e){t.exports="add";},function(t,e){t.exports="animationcomplete";},function(t,e){t.exports="animationcomplete-";},function(t,e){t.exports="animationrepeat";},function(t,e){t.exports="animationrestart";},function(t,e){t.exports="animationstart";},function(t,e){t.exports="animationstop";},function(t,e){t.exports="animationupdate";},function(t,e){t.exports="pauseall";},function(t,e){t.exports="remove";},function(t,e){t.exports="resumeall";},function(t,e,i){t.exports={BaseCache:i(323),CacheManager:i(325),Events:i(324)};},function(t,e){t.exports="add";},function(t,e){t.exports="remove";},function(t,e,i){t.exports={Controls:i(739),Scene2D:i(742)};},function(t,e,i){t.exports={FixedKeyControl:i(740),SmoothedKeyControl:i(741)};},function(t,e,i){var n=i(0),s=i(6),r=new n({initialize:function(t){this.camera=s(t,"camera",null),this.left=s(t,"left",null),this.right=s(t,"right",null),this.up=s(t,"up",null),this.down=s(t,"down",null),this.zoomIn=s(t,"zoomIn",null),this.zoomOut=s(t,"zoomOut",null),this.zoomSpeed=s(t,"zoomSpeed",.01),this.minZoom=s(t,"minZoom",.001),this.maxZoom=s(t,"maxZoom",1e3),this.speedX=0,this.speedY=0;var e=s(t,"speed",null);"number"==typeof e?(this.speedX=e,this.speedY=e):(this.speedX=s(t,"speed.x",0),this.speedY=s(t,"speed.y",0)),this._zoom=0,this.active=null!==this.camera;},start:function(){return this.active=null!==this.camera,this;},stop:function(){return this.active=!1,this;},setCamera:function(t){return this.camera=t,this;},update:function(t){var e;this.active&&(void 0===t&&(t=1),e=this.camera,this.up&&this.up.isDown?e.scrollY-=this.speedY*t|0:this.down&&this.down.isDown&&(e.scrollY+=this.speedY*t|0),this.left&&this.left.isDown?e.scrollX-=this.speedX*t|0:this.right&&this.right.isDown&&(e.scrollX+=this.speedX*t|0),this.zoomIn&&this.zoomIn.isDown?(e.zoom-=this.zoomSpeed,e.zoom<this.minZoom&&(e.zoom=this.minZoom)):this.zoomOut&&this.zoomOut.isDown&&(e.zoom+=this.zoomSpeed,e.zoom>this.maxZoom&&(e.zoom=this.maxZoom)));},destroy:function(){this.camera=null,this.left=null,this.right=null,this.up=null,this.down=null,this.zoomIn=null,this.zoomOut=null;}});t.exports=r;},function(t,e,i){var n=i(0),s=i(6),r=new n({initialize:function(t){this.camera=s(t,"camera",null),this.left=s(t,"left",null),this.right=s(t,"right",null),this.up=s(t,"up",null),this.down=s(t,"down",null),this.zoomIn=s(t,"zoomIn",null),this.zoomOut=s(t,"zoomOut",null),this.zoomSpeed=s(t,"zoomSpeed",.01),this.minZoom=s(t,"minZoom",.001),this.maxZoom=s(t,"maxZoom",1e3),this.accelX=0,this.accelY=0;var e=s(t,"acceleration",null);"number"==typeof e?(this.accelX=e,this.accelY=e):(this.accelX=s(t,"acceleration.x",0),this.accelY=s(t,"acceleration.y",0)),this.dragX=0,this.dragY=0;var i=s(t,"drag",null);"number"==typeof i?(this.dragX=i,this.dragY=i):(this.dragX=s(t,"drag.x",0),this.dragY=s(t,"drag.y",0)),this.maxSpeedX=0,this.maxSpeedY=0;var n=s(t,"maxSpeed",null);"number"==typeof n?(this.maxSpeedX=n,this.maxSpeedY=n):(this.maxSpeedX=s(t,"maxSpeed.x",0),this.maxSpeedY=s(t,"maxSpeed.y",0)),this._speedX=0,this._speedY=0,this._zoom=0,this.active=null!==this.camera;},start:function(){return this.active=null!==this.camera,this;},stop:function(){return this.active=!1,this;},setCamera:function(t){return this.camera=t,this;},update:function(t){var e;this.active&&(void 0===t&&(t=1),e=this.camera,0<this._speedX?(this._speedX-=this.dragX*t,this._speedX<0&&(this._speedX=0)):this._speedX<0&&(this._speedX+=this.dragX*t,0<this._speedX&&(this._speedX=0)),0<this._speedY?(this._speedY-=this.dragY*t,this._speedY<0&&(this._speedY=0)):this._speedY<0&&(this._speedY+=this.dragY*t,0<this._speedY&&(this._speedY=0)),this.up&&this.up.isDown?(this._speedY+=this.accelY,this._speedY>this.maxSpeedY&&(this._speedY=this.maxSpeedY)):this.down&&this.down.isDown&&(this._speedY-=this.accelY,this._speedY<-this.maxSpeedY&&(this._speedY=-this.maxSpeedY)),this.left&&this.left.isDown?(this._speedX+=this.accelX,this._speedX>this.maxSpeedX&&(this._speedX=this.maxSpeedX)):this.right&&this.right.isDown&&(this._speedX-=this.accelX,this._speedX<-this.maxSpeedX&&(this._speedX=-this.maxSpeedX)),this.zoomIn&&this.zoomIn.isDown?this._zoom=-this.zoomSpeed:this.zoomOut&&this.zoomOut.isDown?this._zoom=this.zoomSpeed:this._zoom=0,0!==this._speedX&&(e.scrollX-=this._speedX*t|0),0!==this._speedY&&(e.scrollY-=this._speedY*t|0),0!==this._zoom&&(e.zoom+=this._zoom,e.zoom<this.minZoom?e.zoom=this.minZoom:e.zoom>this.maxZoom&&(e.zoom=this.maxZoom)));},destroy:function(){this.camera=null,this.left=null,this.right=null,this.up=null,this.down=null,this.zoomIn=null,this.zoomOut=null;}});t.exports=r;},function(t,e,i){t.exports={Camera:i(326),BaseCamera:i(133),CameraManager:i(799),Effects:i(333),Events:i(37)};},function(t,e){t.exports="cameradestroy";},function(t,e){t.exports="camerafadeincomplete";},function(t,e){t.exports="camerafadeinstart";},function(t,e){t.exports="camerafadeoutcomplete";},function(t,e){t.exports="camerafadeoutstart";},function(t,e){t.exports="cameraflashcomplete";},function(t,e){t.exports="cameraflashstart";},function(t,e){t.exports="followupdate";},function(t,e){t.exports="camerapancomplete";},function(t,e){t.exports="camerapanstart";},function(t,e){t.exports="postrender";},function(t,e){t.exports="prerender";},function(t,e){t.exports="camerarotatecomplete";},function(t,e){t.exports="camerarotatestart";},function(t,e){t.exports="camerashakecomplete";},function(t,e){t.exports="camerashakestart";},function(t,e){t.exports="camerazoomcomplete";},function(t,e){t.exports="camerazoomstart";},function(t,e,i){var n=i(18),s=i(0),u=i(37),r=new s({initialize:function(t){this.camera=t,this.isRunning=!1,this.isComplete=!1,this.direction=!0,this.duration=0,this.red=0,this.green=0,this.blue=0,this.alpha=0,this.progress=0,this._elapsed=0,this._onUpdate,this._onUpdateScope;},start:function(t,e,i,n,s,r,o,a){if(void 0===t&&(t=!0),void 0===e&&(e=1e3),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=!1),void 0===o&&(o=null),void 0===a&&(a=this.camera.scene),!r&&this.isRunning)return this.camera;this.isRunning=!0,this.isComplete=!1,this.duration=e,this.direction=t,this.progress=0,this.red=i,this.green=n,this.blue=s,this.alpha=t?Number.MIN_VALUE:1,this._elapsed=0,this._onUpdate=o,this._onUpdateScope=a;var h=t?u.FADE_OUT_START:u.FADE_IN_START;return this.camera.emit(h,this.camera,this,e,i,n,s),this.camera;},update:function(t,e){this.isRunning&&(this._elapsed+=e,this.progress=n(this._elapsed/this.duration,0,1),this._onUpdate&&this._onUpdate.call(this._onUpdateScope,this.camera,this.progress),this._elapsed<this.duration?this.alpha=this.direction?this.progress:1-this.progress:(this.alpha=this.direction?1:0,this.effectComplete()));},postRenderCanvas:function(t){if(!this.isRunning&&!this.isComplete)return!1;var e=this.camera;return t.fillStyle="rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")",t.fillRect(e.x,e.y,e.width,e.height),!0;},postRenderWebGL:function(t,e){if(!this.isRunning&&!this.isComplete)return!1;var i=this.camera,n=this.red/255,s=this.green/255,r=this.blue/255;return t.drawFillRect(i.x,i.y,i.width,i.height,e(r,s,n,1),this.alpha),!0;},effectComplete:function(){this._onUpdate=null,this._onUpdateScope=null,this.isRunning=!1,this.isComplete=!0;var t=this.direction?u.FADE_OUT_COMPLETE:u.FADE_IN_COMPLETE;this.camera.emit(t,this.camera,this);},reset:function(){this.isRunning=!1,this.isComplete=!1,this._onUpdate=null,this._onUpdateScope=null;},destroy:function(){this.reset(),this.camera=null;}});t.exports=r;},function(t,e,i){var n=i(18),s=i(0),a=i(37),r=new s({initialize:function(t){this.camera=t,this.isRunning=!1,this.duration=0,this.red=0,this.green=0,this.blue=0,this.alpha=0,this.progress=0,this._elapsed=0,this._onUpdate,this._onUpdateScope;},start:function(t,e,i,n,s,r,o){return void 0===t&&(t=250),void 0===e&&(e=255),void 0===i&&(i=255),void 0===n&&(n=255),void 0===s&&(s=!1),void 0===r&&(r=null),void 0===o&&(o=this.camera.scene),!s&&this.isRunning||(this.isRunning=!0,this.duration=t,this.progress=0,this.red=e,this.green=i,this.blue=n,this.alpha=1,this._elapsed=0,this._onUpdate=r,this._onUpdateScope=o,this.camera.emit(a.FLASH_START,this.camera,this,t,e,i,n)),this.camera;},update:function(t,e){this.isRunning&&(this._elapsed+=e,this.progress=n(this._elapsed/this.duration,0,1),this._onUpdate&&this._onUpdate.call(this._onUpdateScope,this.camera,this.progress),this._elapsed<this.duration?this.alpha=1-this.progress:this.effectComplete());},postRenderCanvas:function(t){if(!this.isRunning)return!1;var e=this.camera;return t.fillStyle="rgba("+this.red+","+this.green+","+this.blue+","+this.alpha+")",t.fillRect(e.x,e.y,e.width,e.height),!0;},postRenderWebGL:function(t,e){if(!this.isRunning)return!1;var i=this.camera,n=this.red/255,s=this.green/255,r=this.blue/255;return t.drawFillRect(i.x,i.y,i.width,i.height,e(r,s,n,1),this.alpha),!0;},effectComplete:function(){this._onUpdate=null,this._onUpdateScope=null,this.isRunning=!1,this.camera.emit(a.FLASH_COMPLETE,this.camera,this);},reset:function(){this.isRunning=!1,this._onUpdate=null,this._onUpdateScope=null;},destroy:function(){this.reset(),this.camera=null;}});t.exports=r;},function(t,e,i){var a=i(18),n=i(0),h=i(134),u=i(37),s=i(3),r=new n({initialize:function(t){this.camera=t,this.isRunning=!1,this.duration=0,this.source=new s(),this.current=new s(),this.destination=new s(),this.ease,this.progress=0,this._elapsed=0,this._onUpdate,this._onUpdateScope;},start:function(t,e,i,n,s,r,o){void 0===i&&(i=1e3),void 0===n&&(n=h.Linear),void 0===s&&(s=!1),void 0===r&&(r=null),void 0===o&&(o=this.camera.scene);var a=this.camera;return!s&&this.isRunning||(this.isRunning=!0,this.duration=i,this.progress=0,this.source.set(a.scrollX,a.scrollY),this.destination.set(t,e),a.getScroll(t,e,this.current),"string"==typeof n&&h.hasOwnProperty(n)?this.ease=h[n]:"function"==typeof n&&(this.ease=n),this._elapsed=0,this._onUpdate=r,this._onUpdateScope=o,this.camera.emit(u.PAN_START,this.camera,this,i,t,e)),a;},update:function(t,e){var i,n,s,r,o;this.isRunning&&(this._elapsed+=e,i=a(this._elapsed/this.duration,0,1),this.progress=i,n=this.camera,this._elapsed<this.duration?(s=this.ease(i),n.getScroll(this.destination.x,this.destination.y,this.current),r=this.source.x+(this.current.x-this.source.x)*s,o=this.source.y+(this.current.y-this.source.y)*s,n.setScroll(r,o),this._onUpdate&&this._onUpdate.call(this._onUpdateScope,n,i,r,o)):(n.centerOn(this.destination.x,this.destination.y),this._onUpdate&&this._onUpdate.call(this._onUpdateScope,n,i,n.scrollX,n.scrollY),this.effectComplete()));},effectComplete:function(){this._onUpdate=null,this._onUpdateScope=null,this.isRunning=!1,this.camera.emit(u.PAN_COMPLETE,this.camera,this);},reset:function(){this.isRunning=!1,this._onUpdate=null,this._onUpdateScope=null;},destroy:function(){this.reset(),this.camera=null,this.source=null,this.destination=null;}});t.exports=r;},function(t,e){t.exports=function(t,e){return void 0===e&&(e=1.70158),t*t*((e+1)*t-e);};},function(t,e){t.exports=function(t,e){return void 0===e&&(e=1.70158),--t*t*((e+1)*t+e)+1;};},function(t,e){t.exports=function(t,e){void 0===e&&(e=1.70158);var i=1.525*e;return(t*=2)<1?t*t*((1+i)*t-i)*.5:.5*((t-=2)*t*((1+i)*t+i)+2);};},function(t,e){t.exports=function(t){return(t=1-t)<1/2.75?1-7.5625*t*t:t<2/2.75?1-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1-(7.5625*(t-=2.25/2.75)*t+.9375):1-(7.5625*(t-=2.625/2.75)*t+.984375);};},function(t,e){t.exports=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375;};},function(t,e){t.exports=function(t){var e=!1;return t<.5?(t=1-2*t,e=!0):t=2*t-1,t<1/2.75?t*=7.5625*t:t=t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5;};},function(t,e){t.exports=function(t){return 1-Math.sqrt(1-t*t);};},function(t,e){t.exports=function(t){return Math.sqrt(1- --t*t);};},function(t,e){t.exports=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1);};},function(t,e){t.exports=function(t){return t*t*t;};},function(t,e){t.exports=function(t){return--t*t*t+1;};},function(t,e){t.exports=function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2);};},function(t,e){t.exports=function(t,e,i){if(void 0===e&&(e=.1),void 0===i&&(i=.1),0===t)return 0;if(1===t)return 1;var n=i/4;return e<1?e=1:n=i*Math.asin(1/e)/(2*Math.PI),-(e*Math.pow(2,10*--t)*Math.sin((t-n)*(2*Math.PI)/i));};},function(t,e){t.exports=function(t,e,i){if(void 0===e&&(e=.1),void 0===i&&(i=.1),0===t)return 0;if(1===t)return 1;var n=i/4;return e<1?e=1:n=i*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-n)*(2*Math.PI)/i)+1;};},function(t,e){t.exports=function(t,e,i){if(void 0===e&&(e=.1),void 0===i&&(i=.1),0===t)return 0;if(1===t)return 1;var n=i/4;return e<1?e=1:n=i*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*--t)*Math.sin((t-n)*(2*Math.PI)/i)*-.5:e*Math.pow(2,-10*--t)*Math.sin((t-n)*(2*Math.PI)/i)*.5+1;};},function(t,e){t.exports=function(t){return Math.pow(2,10*(t-1))-.001;};},function(t,e){t.exports=function(t){return 1-Math.pow(2,-10*t);};},function(t,e){t.exports=function(t){return(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)));};},function(t,e){t.exports=function(t){return t;};},function(t,e){t.exports=function(t){return t*t;};},function(t,e){t.exports=function(t){return t*(2-t);};},function(t,e){t.exports=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1);};},function(t,e){t.exports=function(t){return t*t*t*t;};},function(t,e){t.exports=function(t){return 1- --t*t*t*t;};},function(t,e){t.exports=function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2);};},function(t,e){t.exports=function(t){return t*t*t*t*t;};},function(t,e){t.exports=function(t){return--t*t*t*t*t+1;};},function(t,e){t.exports=function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2);};},function(t,e){t.exports=function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2);};},function(t,e){t.exports=function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2);};},function(t,e){t.exports=function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t));};},function(t,e){t.exports=function(t,e){return void 0===e&&(e=1),t<=0?0:1<=t?1:1/e*(1+(e*t|0));};},function(t,e,i){var o=i(18),n=i(0),r=i(37),s=i(3),a=new n({initialize:function(t){this.camera=t,this.isRunning=!1,this.duration=0,this.intensity=new s(),this.progress=0,this._elapsed=0,this._offsetX=0,this._offsetY=0,this._onUpdate,this._onUpdateScope;},start:function(t,e,i,n,s){return void 0===t&&(t=100),void 0===e&&(e=.05),void 0===i&&(i=!1),void 0===n&&(n=null),void 0===s&&(s=this.camera.scene),!i&&this.isRunning||(this.isRunning=!0,this.duration=t,this.progress=0,"number"==typeof e?this.intensity.set(e):this.intensity.set(e.x,e.y),this._elapsed=0,this._offsetX=0,this._offsetY=0,this._onUpdate=n,this._onUpdateScope=s,this.camera.emit(r.SHAKE_START,this.camera,this,t,e)),this.camera;},preRender:function(){this.isRunning&&this.camera.matrix.translate(this._offsetX,this._offsetY);},update:function(t,e){var i,n,s,r;this.isRunning&&(this._elapsed+=e,this.progress=o(this._elapsed/this.duration,0,1),this._onUpdate&&this._onUpdate.call(this._onUpdateScope,this.camera,this.progress),this._elapsed<this.duration?(i=this.intensity,n=this.camera.width,s=this.camera.height,r=this.camera.zoom,this._offsetX=(Math.random()*i.x*n*2-i.x*n)*r,this._offsetY=(Math.random()*i.y*s*2-i.y*s)*r,this.camera.roundPixels&&(this._offsetX=Math.round(this._offsetX),this._offsetY=Math.round(this._offsetY))):this.effectComplete());},effectComplete:function(){this._offsetX=0,this._offsetY=0,this._onUpdate=null,this._onUpdateScope=null,this.isRunning=!1,this.camera.emit(r.SHAKE_COMPLETE,this.camera,this);},reset:function(){this.isRunning=!1,this._offsetX=0,this._offsetY=0,this._onUpdate=null,this._onUpdateScope=null;},destroy:function(){this.reset(),this.camera=null,this.intensity=null;}});t.exports=a;},function(t,e,i){var l=i(18),n=i(0),d=i(37),f=i(134),s=new n({initialize:function(t){this.camera=t,this.isRunning=!1,this.duration=0,this.source=0,this.current=0,this.destination=0,this.ease,this.progress=0,this._elapsed=0,this._onUpdate,this._onUpdateScope,this.clockwise=!0,this.shortestPath=!1;},start:function(t,e,i,n,s,r,o){void 0===i&&(i=1e3),void 0===n&&(n=f.Linear),void 0===s&&(s=!1),void 0===r&&(r=null),void 0===o&&(o=this.camera.scene),void 0===e&&(e=!1),this.shortestPath=e;var a=t;t<0?(a=-1*t,this.clockwise=!1):this.clockwise=!0;var h=360*Math.PI/180;a-=Math.floor(a/h)*h;var u,l,c=this.camera;return!s&&this.isRunning||(this.isRunning=!0,this.duration=i,this.progress=0,this.source=c.rotation,this.destination=a,"string"==typeof n&&f.hasOwnProperty(n)?this.ease=f[n]:"function"==typeof n&&(this.ease=n),this._elapsed=0,this._onUpdate=r,this._onUpdateScope=o,this.shortestPath&&(l=u=0,(u=this.destination>this.source?Math.abs(this.destination-this.source):Math.abs(this.destination+h)-this.source)<(l=this.source>this.destination?Math.abs(this.source-this.destination):Math.abs(this.source+h)-this.destination)?this.clockwise=!0:l<u&&(this.clockwise=!1)),this.camera.emit(d.ROTATE_START,this.camera,this,i,a)),c;},update:function(t,e){var i,n,s,r,o,a,h,u;this.isRunning&&(this._elapsed+=e,i=l(this._elapsed/this.duration,0,1),this.progress=i,n=this.camera,this._elapsed<this.duration?(s=this.ease(i),this.current=n.rotation,r=0,o=360*Math.PI/180,a=this.destination,h=this.current,!1===this.clockwise&&(a=this.current,h=this.destination),r=h<=a?Math.abs(a-h):Math.abs(a+o)-h,u=0,u=this.clockwise?n.rotation+r*s:n.rotation-r*s,n.rotation=u,this._onUpdate&&this._onUpdate.call(this._onUpdateScope,n,i,u)):(n.rotation=this.destination,this._onUpdate&&this._onUpdate.call(this._onUpdateScope,n,i,this.destination),this.effectComplete()));},effectComplete:function(){this._onUpdate=null,this._onUpdateScope=null,this.isRunning=!1,this.camera.emit(d.ROTATE_COMPLETE,this.camera,this);},reset:function(){this.isRunning=!1,this._onUpdate=null,this._onUpdateScope=null;},destroy:function(){this.reset(),this.camera=null,this.source=null,this.destination=null;}});t.exports=s;},function(t,e,i){var n=i(18),s=i(0),a=i(134),h=i(37),r=new s({initialize:function(t){this.camera=t,this.isRunning=!1,this.duration=0,this.source=1,this.destination=1,this.ease,this.progress=0,this._elapsed=0,this._onUpdate,this._onUpdateScope;},start:function(t,e,i,n,s,r){void 0===e&&(e=1e3),void 0===i&&(i=a.Linear),void 0===n&&(n=!1),void 0===s&&(s=null),void 0===r&&(r=this.camera.scene);var o=this.camera;return!n&&this.isRunning||(this.isRunning=!0,this.duration=e,this.progress=0,this.source=o.zoom,this.destination=t,"string"==typeof i&&a.hasOwnProperty(i)?this.ease=a[i]:"function"==typeof i&&(this.ease=i),this._elapsed=0,this._onUpdate=s,this._onUpdateScope=r,this.camera.emit(h.ZOOM_START,this.camera,this,e,t)),o;},update:function(t,e){this.isRunning&&(this._elapsed+=e,this.progress=n(this._elapsed/this.duration,0,1),this._elapsed<this.duration?(this.camera.zoom=this.source+(this.destination-this.source)*this.ease(this.progress),this._onUpdate&&this._onUpdate.call(this._onUpdateScope,this.camera,this.progress,this.camera.zoom)):(this.camera.zoom=this.destination,this._onUpdate&&this._onUpdate.call(this._onUpdateScope,this.camera,this.progress,this.destination),this.effectComplete()));},effectComplete:function(){this._onUpdate=null,this._onUpdateScope=null,this.isRunning=!1,this.camera.emit(h.ZOOM_COMPLETE,this.camera,this);},reset:function(){this.isRunning=!1,this._onUpdate=null,this._onUpdateScope=null;},destroy:function(){this.reset(),this.camera=null;}});t.exports=r;},function(t,e,i){var a=i(326),n=i(0),v=i(2),s=i(24),h=i(57),r=i(104),o=i(20),u=new n({initialize:function(t){this.scene=t,this.systems=t.sys,this.roundPixels=t.sys.game.config.roundPixels,this.cameras=[],this.main,this.default,t.sys.events.once(o.BOOT,this.boot,this),t.sys.events.on(o.START,this.start,this);},boot:function(){var t=this.systems;t.settings.cameras?this.fromJSON(t.settings.cameras):this.add(),this.main=this.cameras[0],this.default=new a(0,0,t.scale.width,t.scale.height).setScene(this.scene),t.game.scale.on(r.RESIZE,this.onResize,this),this.systems.events.once(o.DESTROY,this.destroy,this);},start:function(){var t;this.main||((t=this.systems).settings.cameras?this.fromJSON(t.settings.cameras):this.add(),this.main=this.cameras[0]);var e=this.systems.events;e.on(o.UPDATE,this.update,this),e.once(o.SHUTDOWN,this.shutdown,this);},add:function(t,e,i,n,s,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=this.scene.sys.scale.width),void 0===n&&(n=this.scene.sys.scale.height),void 0===s&&(s=!1),void 0===r&&(r="");var o=new a(t,e,i,n);return o.setName(r),o.setScene(this.scene),o.setRoundPixels(this.roundPixels),o.id=this.getNextID(),this.cameras.push(o),s&&(this.main=o),o;},addExisting:function(t,e){return void 0===e&&(e=!1),-1===this.cameras.indexOf(t)?(t.id=this.getNextID(),t.setRoundPixels(this.roundPixels),this.cameras.push(t),e&&(this.main=t),t):null;},getNextID:function(){for(var t=this.cameras,e=1,i=0;i<32;i++){for(var n=!1,s=0;s<t.length;s++){var r=t[s];r&&r.id===e&&(n=!0);}if(!n)return e;e<<=1;}return 0;},getTotal:function(t){void 0===t&&(t=!1);for(var e=0,i=this.cameras,n=0;n<i.length;n++){var s=i[n];(!t||t&&s.visible)&&e++;}return e;},fromJSON:function(t){Array.isArray(t)||(t=[t]);for(var e=this.scene.sys.scale.width,i=this.scene.sys.scale.height,n=0;n<t.length;n++){var s=t[n],r=v(s,"x",0),o=v(s,"y",0),a=v(s,"width",e),h=v(s,"height",i),u=this.add(r,o,a,h);u.name=v(s,"name",""),u.zoom=v(s,"zoom",1),u.rotation=v(s,"rotation",0),u.scrollX=v(s,"scrollX",0),u.scrollY=v(s,"scrollY",0),u.roundPixels=v(s,"roundPixels",!1),u.visible=v(s,"visible",!0);var l=v(s,"backgroundColor",!1);l&&u.setBackgroundColor(l);var c,d,f,p,g=v(s,"bounds",null);g&&(c=v(g,"x",0),d=v(g,"y",0),f=v(g,"width",e),p=v(g,"height",i),u.setBounds(c,d,f,p));}return this;},getCamera:function(t){for(var e=this.cameras,i=0;i<e.length;i++)if(e[i].name===t)return e[i];return null;},getCamerasBelowPointer:function(t){for(var e=this.cameras,i=t.x,n=t.y,s=[],r=0;r<e.length;r++){var o=e[r];o.visible&&o.inputEnabled&&h(o,i,n)&&s.unshift(o);}return s;},remove:function(t,e){void 0===e&&(e=!0),Array.isArray(t)||(t=[t]);for(var i=0,n=this.cameras,s=0;s<t.length;s++){var r=n.indexOf(t[s]);-1!==r&&(e?n[r].destroy():n[r].renderList=[],n.splice(r,1),i++);}return!this.main&&n[0]&&(this.main=n[0]),i;},render:function(t,e){for(var i=this.scene,n=this.cameras,s=0;s<this.cameras.length;s++){var r,o=n[s];o.visible&&0<o.alpha&&(o.preRender(),r=this.getVisibleChildren(e.getChildren(),o),t.render(i,r,o));}},getVisibleChildren:function(t,e){for(var i=[],n=0;n<t.length;n++){var s=t[n];s.willRender(e)&&i.push(s);}return i;},resetAll:function(){for(var t=0;t<this.cameras.length;t++)this.cameras[t].destroy();return this.cameras=[],this.main=this.add(),this.main;},update:function(t,e){for(var i=0;i<this.cameras.length;i++)this.cameras[i].update(t,e);},onResize:function(t,e,i,n,s){for(var r=0;r<this.cameras.length;r++){var o=this.cameras[r];0===o._x&&0===o._y&&o._width===n&&o._height===s&&o.setSize(e.width,e.height);}},resize:function(t,e){for(var i=0;i<this.cameras.length;i++)this.cameras[i].setSize(t,e);},shutdown:function(){this.main=void 0;for(var t=0;t<this.cameras.length;t++)this.cameras[t].destroy();this.cameras=[];var e=this.systems.events;e.off(o.UPDATE,this.update,this),e.off(o.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.default.destroy(),this.scene.sys.events.off(o.START,this.start,this),this.scene=null,this.systems=null;}});s.register("CameraManager",u,"cameras"),t.exports=u;},function(t,e){t.exports="enterfullscreen";},function(t,e){t.exports="fullscreenfailed";},function(t,e){t.exports="fullscreenunsupported";},function(t,e){t.exports="leavefullscreen";},function(t,e){t.exports="orientationchange";},function(t,e){t.exports="resize";},function(t,e,i){t.exports={Config:i(346),CreateRenderer:i(366),DebugHeader:i(384),Events:i(22),TimeStep:i(385),VisibilityHandler:i(387)};},function(t,e){var i,n,s=t.exports={};function r(){throw new Error("setTimeout has not been defined");}function o(){throw new Error("clearTimeout has not been defined");}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0);}catch(t){try{return i.call(null,e,0);}catch(t){return i.call(this,e,0);}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r;}catch(t){i=r;}try{n="function"==typeof clearTimeout?clearTimeout:o;}catch(t){n=o;}}();var h,u=[],l=!1,c=-1;function d(){l&&h&&(l=!1,h.length?u=h.concat(u):c=-1,u.length&&f());}function f(){if(!l){var t=a(d);l=!0;for(var e=u.length;e;){for(h=u,u=[];++c<e;)h&&h[c].run();c=-1,e=u.length;}h=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e);}catch(t){try{return n.call(null,e);}catch(t){return n.call(this,e);}}}(t);}}function p(t,e){this.fun=t,this.array=e;}function g(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];u.push(new p(t,e)),1!==u.length||l||a(f);},p.prototype.run=function(){this.fun.apply(null,this.array);},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=g,s.addListener=g,s.once=g,s.off=g,s.removeListener=g,s.removeAllListeners=g,s.emit=g,s.prependListener=g,s.prependOnceListener=g,s.listeners=function(t){return[];},s.binding=function(t){throw new Error("process.binding is not supported");},s.cwd=function(){return"/";},s.chdir=function(t){throw new Error("process.chdir is not supported");},s.umask=function(){return 0;};},function(t,e,i){var n=i(136),s={gamepads:!1,mspointer:!1,touch:!1,wheelEvent:null};t.exports=("function"==typeof importScripts||(("ontouchstart"in document.documentElement||navigator.maxTouchPoints&&1<=navigator.maxTouchPoints)&&(s.touch=!0),(navigator.msPointerEnabled||navigator.pointerEnabled)&&(s.mspointer=!0),navigator.getGamepads&&(s.gamepads=!0),"onwheel"in window||n.ie&&"WheelEvent"in window?s.wheelEvent="wheel":"onmousewheel"in window?s.wheelEvent="mousewheel":n.firefox&&"MouseScrollEvent"in window&&(s.wheelEvent="DOMMouseScroll")),s);},function(t,e,i){var s=i(136),r={audioData:!1,dolby:!1,m4a:!1,mp3:!1,ogg:!1,opus:!1,wav:!1,webAudio:!1,webm:!1};t.exports=function(){if("function"==typeof importScripts)return r;r.audioData=!!window.Audio,r.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var t,e,i=document.createElement("audio"),n=!!i.canPlayType;try{n&&(i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(r.ogg=!0),(i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||i.canPlayType("audio/opus;").replace(/^no$/,""))&&(r.opus=!0),i.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(r.mp3=!0),i.canPlayType("audio/wav").replace(/^no$/,"")&&(r.wav=!0),(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/aac;").replace(/^no$/,""))&&(r.m4a=!0),i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(r.webm=!0),""!==i.canPlayType('audio/mp4;codecs="ec-3"')&&(s.edge?r.dolby=!0:s.safari&&9<=s.safariVersion&&/Mac OS X (\d+)_(\d+)/.test(navigator.userAgent)&&(t=parseInt(RegExp.$1,10),e=parseInt(RegExp.$2,10),(10===t&&11<=e||10<t)&&(r.dolby=!0))));}catch(t){}return r;}();},function(t,e){var i={h264:!1,hls:!1,mp4:!1,ogg:!1,vp9:!1,webm:!1};t.exports=function(){if("function"==typeof importScripts)return i;var t=document.createElement("video"),e=!!t.canPlayType;try{e&&(t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"")&&(i.ogg=!0),t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.h264=!0,i.mp4=!0),t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")&&(i.webm=!0),t.canPlayType('video/webm; codecs="vp9"').replace(/^no$/,"")&&(i.vp9=!0),t.canPlayType('application/x-mpegURL; codecs="avc1.42E01E"').replace(/^no$/,"")&&(i.hls=!0));}catch(t){}return i;}();},function(t,e){var r={available:!1,cancel:"",keyboard:!1,request:""};t.exports=function(){if("function"==typeof importScripts)return r;for(var t="Fullscreen",e="FullScreen",i=["request"+t,"request"+e,"webkitRequest"+t,"webkitRequest"+e,"msRequest"+t,"msRequest"+e,"mozRequest"+e,"mozRequest"+t],n=0;n<i.length;n++)if(document.documentElement[i[n]]){r.available=!0,r.request=i[n];break;}var s=["cancel"+e,"exit"+t,"webkitCancel"+e,"webkitExit"+t,"msCancel"+e,"msExit"+t,"mozCancel"+e,"mozExit"+t];if(r.available)for(n=0;n<s.length;n++)if(document[s[n]]){r.cancel=s[n];break;}return window.Element&&Element.ALLOW_KEYBOARD_INPUT&&!/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)&&(r.keyboard=!0),Object.defineProperty(r,"active",{get:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);}}),r;}();},function(t,e,i){t.exports={Between:i(349),BetweenPoints:i(350),BetweenPointsY:i(813),BetweenY:i(814),CounterClockwise:i(815),Normalize:i(351),Random:i(816),RandomDegrees:i(817),Reverse:i(818),RotateTo:i(819),ShortestBetween:i(820),Wrap:i(269),WrapDegrees:i(270)};},function(t,e){t.exports=function(t,e){return Math.atan2(e.x-t.x,e.y-t.y);};},function(t,e){t.exports=function(t,e,i,n){return Math.atan2(i-t,n-e);};},function(t,e,i){var n=i(14);t.exports=function(t){return t>Math.PI&&(t-=n.PI2),Math.abs(((t+n.TAU)%n.PI2-n.PI2)%n.PI2);};},function(t,e,i){var n=i(137);t.exports=function(){return n(-Math.PI,Math.PI);};},function(t,e,i){var n=i(137);t.exports=function(){return n(-180,180);};},function(t,e,i){var n=i(351);t.exports=function(t){return n(t+Math.PI);};},function(t,e,i){var n=i(14);t.exports=function(t,e,i){return void 0===i&&(i=.05),t===e||(Math.abs(e-t)<=i||Math.abs(e-t)>=n.PI2-i?t=e:(Math.abs(e-t)>Math.PI&&(e<t?e+=n.PI2:e-=n.PI2),t<e?t+=i:e<t&&(t-=i))),t;};},function(t,e){t.exports=function(t,e){var i=e-t;return 0==i?0:i-360*Math.floor((i+180)/360);};},function(t,e,i){t.exports={Between:i(50),BetweenPoints:i(352),BetweenPointsSquared:i(822),Chebyshev:i(823),Power:i(824),Snake:i(825),Squared:i(353)};},function(t,e){t.exports=function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n;};},function(t,e){t.exports=function(t,e,i,n){return Math.max(Math.abs(t-i),Math.abs(e-n));};},function(t,e){t.exports=function(t,e,i,n,s){return void 0===s&&(s=2),Math.sqrt(Math.pow(i-t,s)+Math.pow(n-e,s));};},function(t,e){t.exports=function(t,e,i,n){return Math.abs(t-i)+Math.abs(e-n);};},function(t,e,i){t.exports={Back:i(334),Bounce:i(335),Circular:i(336),Cubic:i(337),Elastic:i(338),Expo:i(339),Linear:i(340),Quadratic:i(341),Quartic:i(342),Quintic:i(343),Sine:i(344),Stepped:i(345)};},function(t,e,i){t.exports={Ceil:i(828),Equal:i(124),Floor:i(829),GreaterThan:i(354),LessThan:i(355)};},function(t,e){t.exports=function(t,e){return void 0===e&&(e=1e-4),Math.ceil(t-e);};},function(t,e){t.exports=function(t,e){return void 0===e&&(e=1e-4),Math.floor(t+e);};},function(t,e,i){t.exports={Bezier:i(831),CatmullRom:i(832),CubicBezier:i(358),Linear:i(833),QuadraticBezier:i(359),SmoothStep:i(360),SmootherStep:i(834)};},function(t,e,i){var r=i(356);t.exports=function(t,e){for(var i=0,n=t.length-1,s=0;s<=n;s++)i+=Math.pow(1-e,n-s)*Math.pow(e,s)*t[s]*r(n,s);return i;};},function(t,e,i){var r=i(194);t.exports=function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n);return t[0]===t[i]?(e<0&&(s=Math.floor(n=i*(1+e))),r(n-s,t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i])):e<0?t[0]-(r(-n,t[0],t[0],t[1],t[1])-t[0]):1<e?t[i]-(r(n-i,t[i],t[i],t[i-1],t[i-1])-t[i]):r(n-s,t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2]);};},function(t,e,i){var r=i(135);t.exports=function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n);return e<0?r(t[0],t[1],n):1<e?r(t[i],t[i-1],i-n):r(t[s],t[i<s+1?i:s+1],n-s);};},function(t,e,i){var n=i(183);t.exports=function(t,e,i){return e+(i-e)*n(t,0,1);};},function(t,e,i){t.exports={GetNext:i(361),IsSize:i(138),IsValue:i(836)};},function(t,e){t.exports=function(t){return 0<t&&0==(t&t-1);};},function(t,e,i){t.exports={Ceil:i(139),Floor:i(76),To:i(838)};},function(t,e){t.exports=function(t,e,i,n){return void 0===i&&(i=0),0===e?t:(t-=i,t=e*Math.round(t/e),n?(i+t)/e:i+t);};},function(t,e,i){var n=new(i(0))({initialize:function(t){void 0===t&&(t=[(Date.now()*Math.random()).toString()]),this.c=1,this.s0=0,this.s1=0,this.s2=0,this.n=0,this.signs=[-1,1],t&&this.init(t);},rnd:function(){var t=2091639*this.s0+2.3283064365386963e-10*this.c;return this.c=0|t,this.s0=this.s1,this.s1=this.s2,this.s2=t-this.c,this.s2;},hash:function(t){var e,i=this.n;t=t.toString();for(var n=0;n<t.length;n++)e=.02519603282416938*(i+=t.charCodeAt(n)),e-=i=e>>>0,i=(e*=i)>>>0,i+=4294967296*(e-=i);return 2.3283064365386963e-10*((this.n=i)>>>0);},init:function(t){"string"==typeof t?this.state(t):this.sow(t);},sow:function(t){if(this.n=4022871197,this.s0=this.hash(" "),this.s1=this.hash(" "),this.s2=this.hash(" "),this.c=1,t)for(var e=0;e<t.length&&null!=t[e];e++){var i=t[e];this.s0-=this.hash(i),this.s0+=~~(this.s0<0),this.s1-=this.hash(i),this.s1+=~~(this.s1<0),this.s2-=this.hash(i),this.s2+=~~(this.s2<0);}},integer:function(){return 4294967296*this.rnd();},frac:function(){return this.rnd()+11102230246251565e-32*(2097152*this.rnd()|0);},real:function(){return this.integer()+this.frac();},integerInRange:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t);},between:function(t,e){return Math.floor(this.realInRange(0,e-t+1)+t);},realInRange:function(t,e){return this.frac()*(e-t)+t;},normal:function(){return 1-2*this.frac();},uuid:function(){for(var t="",e="",e=t="";t++<36;e+=~t%5|3*t&4?(15^t?8^this.frac()*(20^t?16:4):4).toString(16):"-");return e;},pick:function(t){return t[this.integerInRange(0,t.length-1)];},sign:function(){return this.pick(this.signs);},weightedPick:function(t){return t[~~(Math.pow(this.frac(),2)*(t.length-1)+.5)];},timestamp:function(t,e){return this.realInRange(t||9466848e5,e||1577862e6);},angle:function(){return this.integerInRange(-180,180);},rotation:function(){return this.realInRange(-3.1415926,3.1415926);},state:function(t){return"string"==typeof t&&t.match(/^!rnd/)&&(t=t.split(","),this.c=parseFloat(t[1]),this.s0=parseFloat(t[2]),this.s1=parseFloat(t[3]),this.s2=parseFloat(t[4])),["!rnd",this.c,this.s0,this.s1,this.s2].join(",");},shuffle:function(t){for(var e=t.length-1;0<e;e--){var i=Math.floor(this.frac()*(e+1)),n=t[i];t[i]=t[e],t[e]=n;}return t;}});t.exports=n;},function(t,e){t.exports=function(t){for(var e=0,i=0;i<t.length;i++)e+=+t[i];return e/t.length;};},function(t,e){t.exports=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var n=Math.pow(i,-e);return Math.ceil(t*n)/n;};},function(t,e){t.exports=function(t,e){return Math.abs(t-e);};},function(t,e,i){var m=i(18),n=i(0),s=i(69),r=i(1),o=new s(),a=new n({initialize:function t(e,i,n,s){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=t.DefaultOrder),this._x=e,this._y=i,this._z=n,this._order=s,this.onChangeCallback=r;},x:{get:function(){return this._x;},set:function(t){this._x=t,this.onChangeCallback(this);}},y:{get:function(){return this._y;},set:function(t){this._y=t,this.onChangeCallback(this);}},z:{get:function(){return this._z;},set:function(t){this._z=t,this.onChangeCallback(this);}},order:{get:function(){return this._order;},set:function(t){this._order=t,this.onChangeCallback(this);}},set:function(t,e,i,n){return void 0===n&&(n=this._order),this._x=t,this._y=e,this._z=i,this._order=n,this.onChangeCallback(this),this;},copy:function(t){return this.set(t.x,t.y,t.z,t.order);},setFromQuaternion:function(t,e,i){return void 0===e&&(e=this._order),void 0===i&&(i=!1),o.fromQuat(t),this.setFromRotationMatrix(o,e,i);},setFromRotationMatrix:function(t,e,i){void 0===e&&(e=this._order),void 0===i&&(i=!1);var n=t.val,s=n[0],r=n[4],o=n[8],a=n[1],h=n[5],u=n[9],l=n[2],c=n[6],d=n[10],f=0,p=0,g=0,v=.99999;switch(e){case"XYZ":p=Math.asin(m(o,-1,1)),Math.abs(o)<v?(f=Math.atan2(-u,d),g=Math.atan2(-r,s)):f=Math.atan2(c,h);break;case"YXZ":f=Math.asin(-m(u,-1,1)),Math.abs(u)<v?(p=Math.atan2(o,d),g=Math.atan2(a,h)):p=Math.atan2(-l,s);break;case"ZXY":f=Math.asin(m(c,-1,1)),g=Math.abs(c)<v?(p=Math.atan2(-l,d),Math.atan2(-r,h)):Math.atan2(a,s);break;case"ZYX":p=Math.asin(-m(l,-1,1)),g=Math.abs(l)<v?(f=Math.atan2(c,d),Math.atan2(a,s)):Math.atan2(-r,h);break;case"YZX":g=Math.asin(m(a,-1,1)),p=Math.abs(a)<v?(f=Math.atan2(-u,h),Math.atan2(-l,s)):Math.atan2(o,d);break;case"XZY":g=Math.asin(-m(r,-1,1)),Math.abs(r)<v?(f=Math.atan2(c,h),p=Math.atan2(o,s)):f=Math.atan2(-u,d);}return this._x=f,this._y=p,this._z=g,this._order=e,i&&this.onChangeCallback(this),this;}});a.RotationOrders=["XYZ","YXZ","ZXY","ZYX","YZX","XZY"],a.DefaultOrder="XYZ",t.exports=a;},function(t,e){t.exports=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var n=Math.pow(i,-e);return Math.floor(t*n)/n;};},function(t,e){t.exports=function(t,e){return t/e/1e3;};},function(t,e){t.exports=function(t){return t==parseFloat(t)?!(t%2):void 0;};},function(t,e){t.exports=function(t){return t===parseFloat(t)?!(t%2):void 0;};},function(t,e){t.exports=function(t,e,i){return Math.min(t+e,i);};},function(t,e){t.exports=function(t){var e=t.length;if(0===e)return 0;t.sort(function(t,e){return t-e;});var i=Math.floor(e/2);return e%2==0?(t[i]+t[i-1])/2:t[i];};},function(t,e){t.exports=function(t,e,i){return Math.max(t-e,i);};},function(t,e){t.exports=function(t,e,i,n){void 0===i&&(i=e+1);var s=(t-e)/(i-e);return 1<s?void 0!==n?(s=(n-t)/(n-i))<0&&(s=0):s=1:s<0&&(s=0),s;};},function(t,e){t.exports=function(t,e){void 0===e&&(e=1);var i=2*Math.random()*Math.PI;return t.x=Math.cos(i)*e,t.y=Math.sin(i)*e,t;};},function(t,e){t.exports=function(t,e){void 0===e&&(e=1);var i=2*Math.random()*Math.PI,n=2*Math.random()-1,s=Math.sqrt(1-n*n)*e;return t.x=Math.cos(i)*s,t.y=Math.sin(i)*s,t.z=n*e,t;};},function(t,e){t.exports=function(t,e){return void 0===e&&(e=1),t.x=(2*Math.random()-1)*e,t.y=(2*Math.random()-1)*e,t.z=(2*Math.random()-1)*e,t.w=(2*Math.random()-1)*e,t;};},function(t,e){t.exports=function(t,e,i,n,s){return t.x=e+s*Math.cos(n),t.y=i+s*Math.sin(n),t;};},function(t,e){t.exports=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=10);var n=Math.pow(i,-e);return Math.round(t*n)/n;};},function(t,e){t.exports=function(t,e,i,n){void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),n*=Math.PI/t;for(var s=[],r=[],o=0;o<t;o++)e+=(i-=e*n)*n,s[o]=i,r[o]=e;return{sin:r,cos:s,length:t};};},function(t,e,i){var o=i(3);t.exports=function(t,e,i,n){void 0===n&&(n=new o());var s=0,r=0;return 0<t&&t<=e*i&&(s=e-1<t?t-(r=Math.floor(t/e))*e:t),n.set(s,r);};},function(t,e){t.exports=function(t,e,i){return Math.abs(t-e)<=i;};},function(t,e,i){var n=i(39),s=i(69),r=i(365),o=new s(),a=new r(),h=new n();t.exports=function(t,e,i){return a.setAxisAngle(e,i),o.fromRotationTranslation(a,h.set(0,0,0)),t.transformMat4(o);};},function(t,e){t.exports="addtexture";},function(t,e){t.exports="onerror";},function(t,e){t.exports="onload";},function(t,e){t.exports="ready";},function(t,e){t.exports="removetexture";},function(t,e){t.exports=["#define SHADER_NAME PHASER_BITMAP_MASK_FS","","precision mediump float;","","uniform vec2 uResolution;","uniform sampler2D uMainSampler;","uniform sampler2D uMaskSampler;","uniform bool uInvertMaskAlpha;","","void main ()","{","    vec2 uv = gl_FragCoord.xy / uResolution;","    vec4 mainColor = texture2D(uMainSampler, uv);","    vec4 maskColor = texture2D(uMaskSampler, uv);","    float alpha = mainColor.a;","","    if (!uInvertMaskAlpha)","    {","        alpha *= (maskColor.a);","    }","    else","    {","        alpha *= (1.0 - maskColor.a);","    }","","    gl_FragColor = vec4(mainColor.rgb * alpha, alpha);","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_BITMAP_MASK_VS","","precision mediump float;","","attribute vec2 inPosition;","","void main ()","{","    gl_Position = vec4(inPosition, 0.0, 1.0);","}",""].join("\n");},function(t,e){t.exports="pipelineafterflush";},function(t,e){t.exports="pipelinebeforeflush";},function(t,e){t.exports="pipelinebind";},function(t,e){t.exports="pipelineboot";},function(t,e){t.exports="pipelinedestroy";},function(t,e){t.exports="pipelinerebind";},function(t,e){t.exports="pipelineresize";},function(t,e){t.exports=["#define SHADER_NAME PHASER_GRAPHICS_FS","","precision mediump float;","","varying vec4 outColor;","","void main ()","{","    gl_FragColor = vec4(outColor.bgr * outColor.a, outColor.a);","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_GRAPHICS_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec4 inColor;","","varying vec4 outColor;","","void main ()","{","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","","    outColor = inColor;","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_LIGHT_FS","","precision mediump float;","","struct Light","{","    vec2 position;","    vec3 color;","    float intensity;","    float radius;","};","","const int kMaxLights = %LIGHT_COUNT%;","","uniform vec4 uCamera; /* x, y, rotation, zoom */","uniform vec2 uResolution;","uniform sampler2D uMainSampler;","uniform sampler2D uNormSampler;","uniform vec3 uAmbientLightColor;","uniform Light uLights[kMaxLights];","uniform mat3 uInverseRotationMatrix;","","varying vec2 outTexCoord;","varying vec4 outTint;","","void main()","{","    vec3 finalColor = vec3(0.0, 0.0, 0.0);","    vec4 color = texture2D(uMainSampler, outTexCoord) * vec4(outTint.bgr * outTint.a, outTint.a);","    vec3 normalMap = texture2D(uNormSampler, outTexCoord).rgb;","    vec3 normal = normalize(uInverseRotationMatrix * vec3(normalMap * 2.0 - 1.0));","    vec2 res = vec2(min(uResolution.x, uResolution.y)) * uCamera.w;","","    for (int index = 0; index < kMaxLights; ++index)","    {","        Light light = uLights[index];","        vec3 lightDir = vec3((light.position.xy / res) - (gl_FragCoord.xy / res), 0.1);","        vec3 lightNormal = normalize(lightDir);","        float distToSurf = length(lightDir) * uCamera.w;","        float diffuseFactor = max(dot(normal, lightNormal), 0.0);","        float radius = (light.radius / res.x * uCamera.w) * uCamera.w;","        float attenuation = clamp(1.0 - distToSurf * distToSurf / (radius * radius), 0.0, 1.0);","        vec3 diffuse = light.color * diffuseFactor;","        finalColor += (attenuation * diffuse) * light.intensity;","    }","","    vec4 colorOutput = vec4(uAmbientLightColor + finalColor, 1.0);","","    gl_FragColor = color * vec4(colorOutput.rgb * colorOutput.a, colorOutput.a);","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_MULTI_FS","","precision mediump float;","","uniform sampler2D uMainSampler[%count%];","","varying vec2 outTexCoord;","varying float outTexId;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    vec4 texture;","","    %forloop%","","    vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);","","    //  Multiply texture tint","    vec4 color = texture * texel;","","    if (outTintEffect == 1.0)","    {","        //  Solid color + texture alpha","        color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);","    }","    else if (outTintEffect == 2.0)","    {","        //  Solid color, no texture","        color = texel;","    }","","    gl_FragColor = color;","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_MULTI_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec2 inTexCoord;","attribute float inTexId;","attribute float inTintEffect;","attribute vec4 inTint;","","varying vec2 outTexCoord;","varying float outTexId;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","","    outTexCoord = inTexCoord;","    outTexId = inTexId;","    outTint = inTint;","    outTintEffect = inTintEffect;","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_POINTLIGHT_FS","","precision mediump float;","","uniform vec2 uResolution;","uniform float uCameraZoom;","","varying vec4 lightPosition;","varying vec4 lightColor;","varying float lightRadius;","varying float lightAttenuation;","","void main ()","{","    vec2 center = (lightPosition.xy + 1.0) * (uResolution.xy * 0.5);","","    float distToSurf = length(center - gl_FragCoord.xy);","","    float radius = 1.0 - distToSurf / (lightRadius * uCameraZoom);","","    float intensity = smoothstep(0.0, 1.0, radius * lightAttenuation);","","    vec4 color = vec4(intensity, intensity, intensity, 0.0) * lightColor;","","    gl_FragColor = vec4(color.rgb * lightColor.a, color.a);","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_POINTLIGHT_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec2 inLightPosition;","attribute vec4 inLightColor;","attribute float inLightRadius;","attribute float inLightAttenuation;","","varying vec4 lightPosition;","varying vec4 lightColor;","varying float lightRadius;","varying float lightAttenuation;","","void main ()","{","    lightColor = inLightColor;","    lightRadius = inLightRadius;","    lightAttenuation = inLightAttenuation;","    lightPosition = uProjectionMatrix * vec4(inLightPosition, 1.0, 1.0);","","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_SINGLE_FS","","precision mediump float;","","uniform sampler2D uMainSampler;","","varying vec2 outTexCoord;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    vec4 texture = texture2D(uMainSampler, outTexCoord);","    vec4 texel = vec4(outTint.bgr * outTint.a, outTint.a);","","    //  Multiply texture tint","    vec4 color = texture * texel;","","    if (outTintEffect == 1.0)","    {","        //  Solid color + texture alpha","        color.rgb = mix(texture.rgb, outTint.bgr * outTint.a, texture.a);","    }","    else if (outTintEffect == 2.0)","    {","        //  Solid color, no texture","        color = texel;","    }","","    gl_FragColor = color;","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_SINGLE_VS","","precision mediump float;","","uniform mat4 uProjectionMatrix;","","attribute vec2 inPosition;","attribute vec2 inTexCoord;","attribute float inTexId;","attribute float inTintEffect;","attribute vec4 inTint;","","varying vec2 outTexCoord;","varying float outTintEffect;","varying vec4 outTint;","","void main ()","{","    gl_Position = uProjectionMatrix * vec4(inPosition, 1.0, 1.0);","","    outTexCoord = inTexCoord;","    outTint = inTint;","    outTintEffect = inTintEffect;","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_ADD_BLEND_FS","","precision mediump float;","","uniform sampler2D uMainSampler1;","uniform sampler2D uMainSampler2;","uniform float uStrength;","","varying vec2 outTexCoord;","","void main ()","{","    vec4 frame1 = texture2D(uMainSampler1, outTexCoord);","    vec4 frame2 = texture2D(uMainSampler2, outTexCoord);","","    gl_FragColor = frame1 + frame2 * uStrength;","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_COLORMATRIX_FS","","precision mediump float;","","uniform sampler2D uMainSampler;","uniform float uColorMatrix[20];","uniform float uAlpha;","","varying vec2 outTexCoord;","","void main ()","{","    vec4 c = texture2D(uMainSampler, outTexCoord);","","    if (uAlpha == 0.0)","    {","        gl_FragColor = c;","","        return;","    }","","    if (c.a > 0.0)","    {","        c.rgb /= c.a;","    }","","    vec4 result;","","    result.r = (uColorMatrix[0] * c.r) + (uColorMatrix[1] * c.g) + (uColorMatrix[2] * c.b) + (uColorMatrix[3] * c.a) + uColorMatrix[4];","    result.g = (uColorMatrix[5] * c.r) + (uColorMatrix[6] * c.g) + (uColorMatrix[7] * c.b) + (uColorMatrix[8] * c.a) + uColorMatrix[9];","    result.b = (uColorMatrix[10] * c.r) + (uColorMatrix[11] * c.g) + (uColorMatrix[12] * c.b) + (uColorMatrix[13] * c.a) + uColorMatrix[14];","    result.a = (uColorMatrix[15] * c.r) + (uColorMatrix[16] * c.g) + (uColorMatrix[17] * c.b) + (uColorMatrix[18] * c.a) + uColorMatrix[19];","","    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);","","    rgb *= result.a;","","    gl_FragColor = vec4(rgb, result.a);","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_COPY_FS","","precision mediump float;","","uniform sampler2D uMainSampler;","uniform float uBrightness;","","varying vec2 outTexCoord;","","void main ()","{","    gl_FragColor = texture2D(uMainSampler, outTexCoord) * uBrightness;","}",""].join("\n");},function(t,e){t.exports=["#define SHADER_NAME PHASER_LINEAR_BLEND_FS","","precision mediump float;","","uniform sampler2D uMainSampler1;","uniform sampler2D uMainSampler2;","uniform float uStrength;","","varying vec2 outTexCoord;","","void main ()","{","    vec4 frame1 = texture2D(uMainSampler1, outTexCoord);","    vec4 frame2 = texture2D(uMainSampler2, outTexCoord);","","    gl_FragColor = mix(frame1, frame2 * uStrength, 0.5);","}",""].join("\n");},function(t,e,i){t.exports={GenerateTexture:i(388),Palettes:i(889)};},function(t,e,i){t.exports={ARNE16:i(389),C64:i(890),CGA:i(891),JMP:i(892),MSX:i(893)};},function(t,e){t.exports={0:"#000",1:"#fff",2:"#8b4131",3:"#7bbdc5",4:"#8b41ac",5:"#6aac41",6:"#3931a4",7:"#d5de73",8:"#945a20",9:"#5a4100",A:"#bd736a",B:"#525252",C:"#838383",D:"#acee8b",E:"#7b73de",F:"#acacac"};},function(t,e){t.exports={0:"#000",1:"#2234d1",2:"#0c7e45",3:"#44aacc",4:"#8a3622",5:"#5c2e78",6:"#aa5c3d",7:"#b5b5b5",8:"#5e606e",9:"#4c81fb",A:"#6cd947",B:"#7be2f9",C:"#eb8a60",D:"#e23d69",E:"#ffd93f",F:"#fff"};},function(t,e){t.exports={0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#f5f4eb"};},function(t,e){t.exports={0:"#000",1:"#191028",2:"#46af45",3:"#a1d685",4:"#453e78",5:"#7664fe",6:"#833129",7:"#9ec2e8",8:"#dc534b",9:"#e18d79",A:"#d6b97b",B:"#e9d8a1",C:"#216c4b",D:"#d365c8",E:"#afaab9",F:"#fff"};},function(t,e,i){t.exports={Path:i(895),MoveTo:i(393),CubicBezier:i(390),Curve:i(94),Ellipse:i(391),Line:i(392),QuadraticBezier:i(394),Spline:i(395)};},function(t,e,i){var n=i(0),l=i(390),u=i(391),s=i(5),r=i(392),o=i(393),a=i(394),h=i(10),c=i(395),d=i(3),f=i(14),p=new n({initialize:function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.name="",this.curves=[],this.cacheLengths=[],this.autoClose=!1,this.startPoint=new d(),this._tmpVec2A=new d(),this._tmpVec2B=new d(),"object"==typeof t?this.fromJSON(t):this.startPoint.set(t,e);},add:function(t){return this.curves.push(t),this;},circleTo:function(t,e,i){return void 0===e&&(e=!1),this.ellipseTo(t,t,0,360,e,i);},closePath:function(){var t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);return t.equals(e)||this.curves.push(new r(e,t)),this;},cubicBezierTo:function(t,e,i,n,s,r){var o,a,h=this.getEndPoint(),u=t instanceof d?(o=t,a=e,i):(o=new d(i,n),a=new d(s,r),new d(t,e));return this.add(new l(h,o,a,u));},quadraticBezierTo:function(t,e,i,n){var s,r=this.getEndPoint(),o=t instanceof d?(s=t,e):(s=new d(i,n),new d(t,e));return this.add(new a(r,s,o));},draw:function(t,e){for(var i=0;i<this.curves.length;i++){var n=this.curves[i];n.active&&n.draw(t,e);}return t;},ellipseTo:function(t,e,i,n,s,r){var o=new u(0,0,t,e,i,n,s,r),a=this.getEndPoint(this._tmpVec2A),h=o.getStartPoint(this._tmpVec2B);return a.subtract(h),o.x=a.x,o.y=a.y,this.add(o);},fromJSON:function(t){this.curves=[],this.cacheLengths=[],this.startPoint.set(t.x,t.y),this.autoClose=t.autoClose;for(var e=0;e<t.curves.length;e++){var i=t.curves[e];switch(i.type){case"LineCurve":this.add(r.fromJSON(i));break;case"EllipseCurve":this.add(u.fromJSON(i));break;case"SplineCurve":this.add(c.fromJSON(i));break;case"CubicBezierCurve":this.add(l.fromJSON(i));break;case"QuadraticBezierCurve":this.add(a.fromJSON(i));}}return this;},getBounds:function(t,e){void 0===t&&(t=new h()),void 0===e&&(e=16),t.x=Number.MAX_VALUE,t.y=Number.MAX_VALUE;for(var i=new h(),n=f.MIN_SAFE_INTEGER,s=f.MIN_SAFE_INTEGER,r=0;r<this.curves.length;r++){var o=this.curves[r];o.active&&(o.getBounds(i,e),t.x=Math.min(t.x,i.x),t.y=Math.min(t.y,i.y),n=Math.max(n,i.right),s=Math.max(s,i.bottom));}return t.right=n,t.bottom=s,t;},getCurveLengths:function(){if(this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var t=[],e=0,i=0;i<this.curves.length;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t;},getEndPoint:function(t){return void 0===t&&(t=new d()),0<this.curves.length?this.curves[this.curves.length-1].getPoint(1,t):t.copy(this.startPoint),t;},getLength:function(){var t=this.getCurveLengths();return t[t.length-1];},getPoint:function(t,e){void 0===e&&(e=new d());for(var i=t*this.getLength(),n=this.getCurveLengths(),s=0;s<n.length;){if(n[s]>=i){var r=n[s]-i,o=this.curves[s],a=o.getLength(),h=0===a?0:1-r/a;return o.getPointAt(h,e);}s++;}return null;},getPoints:function(t){void 0===t&&(t=12);for(var e,i=[],n=0;n<this.curves.length;n++){var s=this.curves[n];if(s.active)for(var r=s.getResolution(t),o=s.getPoints(r),a=0;a<o.length;a++){var h=o[a];e&&e.equals(h)||(i.push(h),e=h);}}return this.autoClose&&1<i.length&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i;},getRandomPoint:function(t){return void 0===t&&(t=new d()),this.getPoint(Math.random(),t);},getSpacedPoints:function(t){void 0===t&&(t=40);for(var e=[],i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e;},getStartPoint:function(t){return void 0===t&&(t=new d()),t.copy(this.startPoint);},getTangent:function(t,e){void 0===e&&(e=new d());for(var i=t*this.getLength(),n=this.getCurveLengths(),s=0;s<n.length;){if(n[s]>=i){var r=n[s]-i,o=this.curves[s],a=o.getLength(),h=0===a?0:1-r/a;return o.getTangentAt(h,e);}s++;}return null;},lineTo:function(t,e){t instanceof d?this._tmpVec2B.copy(t):this._tmpVec2B.set(t,e);var i=this.getEndPoint(this._tmpVec2A);return this.add(new r([i.x,i.y,this._tmpVec2B.x,this._tmpVec2B.y]));},splineTo:function(t){return t.unshift(this.getEndPoint()),this.add(new c(t));},moveTo:function(t,e){return t instanceof d?this.add(new o(t.x,t.y)):this.add(new o(t,e));},toJSON:function(){for(var t=[],e=0;e<this.curves.length;e++)t.push(this.curves[e].toJSON());return{type:"Path",x:this.startPoint.x,y:this.startPoint.y,autoClose:this.autoClose,curves:t};},updateArcLengths:function(){this.cacheLengths=[],this.getCurveLengths();},destroy:function(){this.curves.length=0,this.cacheLengths.length=0,this.startPoint=void 0;}});s.register("path",function(t,e){return new p(t,e);}),t.exports=p;},function(t,e,i){t.exports={DataManager:i(101),DataManagerPlugin:i(897),Events:i(315)};},function(t,e,i){var n=i(0),s=i(101),r=i(24),o=i(20),a=new n({Extends:s,initialize:function(t){s.call(this,t,t.sys.events),this.scene=t,this.systems=t.sys,t.sys.events.once(o.BOOT,this.boot,this),t.sys.events.on(o.START,this.start,this);},boot:function(){this.events=this.systems.events,this.events.once(o.DESTROY,this.destroy,this);},start:function(){this.events.once(o.SHUTDOWN,this.shutdown,this);},shutdown:function(){this.systems.events.off(o.SHUTDOWN,this.shutdown,this);},destroy:function(){s.prototype.destroy.call(this),this.events.off(o.START,this.start,this),this.scene=null,this.systems=null;}});r.register("DataManagerPlugin",a,"data"),t.exports=a;},function(t,e,i){t.exports={Align:i(899),BaseShader:i(396),Bounds:i(902),Canvas:i(906),Color:i(397),ColorMatrix:i(198),Masks:i(916),RGB:i(200)};},function(t,e,i){var n=i(123),s=i(17)(!1,s={In:i(900),To:i(901)},n);t.exports=s;},function(t,e,i){t.exports={BottomCenter:i(290),BottomLeft:i(291),BottomRight:i(292),Center:i(293),LeftCenter:i(295),QuickSet:i(289),RightCenter:i(296),TopCenter:i(297),TopLeft:i(298),TopRight:i(299)};},function(t,e,i){t.exports={BottomCenter:i(277),BottomLeft:i(278),BottomRight:i(279),LeftBottom:i(280),LeftCenter:i(281),LeftTop:i(282),QuickSet:i(276),RightBottom:i(283),RightCenter:i(284),RightTop:i(285),TopCenter:i(286),TopLeft:i(287),TopRight:i(288)};},function(t,e,i){t.exports={CenterOn:i(294),GetBottom:i(42),GetBounds:i(903),GetCenterX:i(87),GetCenterY:i(89),GetLeft:i(43),GetOffsetX:i(904),GetOffsetY:i(905),GetRight:i(44),GetTop:i(45),SetBottom:i(55),SetCenterX:i(88),SetCenterY:i(90),SetLeft:i(53),SetRight:i(54),SetTop:i(52)};},function(t,e,i){var s=i(42),r=i(43),o=i(44),a=i(45);t.exports=function(t,e){void 0===e&&(e={});var i=r(t),n=a(t);return e.x=i,e.y=n,e.width=o(t)-i,e.height=s(t)-n,e;};},function(t,e){t.exports=function(t){return t.width*t.originX;};},function(t,e){t.exports=function(t){return t.height*t.originY;};},function(t,e,i){t.exports={CanvasInterpolation:i(367),CanvasPool:i(31),Smoothing:i(192),TouchAction:i(907),UserSelect:i(908)};},function(t,e){t.exports=function(t,e){return void 0===e&&(e="none"),t.style.msTouchAction=e,t.style["ms-touch-action"]=e,t.style["touch-action"]=e,t;};},function(t,e){t.exports=function(e,i){void 0===i&&(i="none");return["-webkit-","-khtml-","-moz-","-ms-",""].forEach(function(t){e.style[t+"user-select"]=i;}),e.style["-webkit-touch-callout"]=i,e.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",e;};},function(t,e,i){var u=i(103);t.exports=function(t){void 0===t&&(t=1024);var e=[],i=255,n=0,s=0;for(h=0;h<=255;h++)e.push({r:i,g:h,b:s,color:u(i,h,s)});for(h=n=255;0<=h;h--)e.push({r:h,g:n,b:s,color:u(h,n,s)});for(h=i=0;h<=255;h++,n--)e.push({r:i,g:n,b:h,color:u(i,n,h)});for(s=255,h=n=0;h<=255;h++,s--,i++)e.push({r:i,g:n,b:s,color:u(i,n,s)});if(1024===t)return e;for(var r=[],o=0,a=1024/t,h=0;h<t;h++)r.push(e[Math.floor(o)]),o+=a;return r;};},function(t,e){t.exports=function(t){var e={r:t>>16&255,g:t>>8&255,b:255&t,a:255};return 16777215<t&&(e.a=t>>>24),e;};},function(t,e,i){var h=i(38),u=i(399);t.exports=function(t,e,i){var n,s,r=i,o=i,a=i;return 0!==e&&(r=u(s=2*i-(n=i<.5?i*(1+e):i+e-i*e),n,t+1/3),o=u(s,n,t),a=u(s,n,t-1/3)),new h().setGLTo(r,o,a,1);};},function(t,e,i){var s=i(188);t.exports=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1);for(var i=[],n=0;n<=359;n++)i.push(s(n/359,t,e));return i;};},function(t,e,i){function o(t,e,i,n,s,r,o,a){void 0===o&&(o=100),void 0===a&&(a=0);var h=a/o;return{r:u(t,n,h),g:u(e,s,h),b:u(i,r,h)};}var u=i(135);t.exports={RGBWithRGB:o,ColorWithRGB:function(t,e,i,n,s,r){return void 0===s&&(s=100),void 0===r&&(r=0),o(t.r,t.g,t.b,e,i,n,s,r);},ColorWithColor:function(t,e,i,n){return void 0===i&&(i=100),void 0===n&&(n=0),o(t.r,t.g,t.b,e.r,e.g,e.b,i,n);}};},function(t,e,i){var n=i(195),s=i(38);t.exports=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=255),new s(n(t,e),n(t,e),n(t,e));};},function(t,e,i){var r=i(398);t.exports=function(t,e,i,n,s){return void 0===n&&(n=255),void 0===s&&(s="#"),"#"===s?"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1,7):"0x"+r(n)+r(t)+r(e)+r(i);};},function(t,e,i){t.exports={BitmapMask:i(310),GeometryMask:i(311)};},function(t,e,i){var n={AddToDOM:i(142),DOMContentLoaded:i(400),GetInnerHeight:i(401),GetScreenOrientation:i(402),GetTarget:i(407),ParseXML:i(408),RemoveFromDOM:i(202),RequestAnimationFrame:i(386)};t.exports=n;},function(t,e,i){t.exports={EventEmitter:i(919)};},function(t,e,i){var n=i(0),s=i(9),r=i(24),o=new n({Extends:s,initialize:function(){s.call(this);},shutdown:function(){this.removeAllListeners();},destroy:function(){this.removeAllListeners();}});r.register("EventEmitter",o,"events"),t.exports=o;},function(t,e,i){var n=i(142),s=i(321),r=i(325),o=i(31),a=i(0),h=i(346),u=i(921),l=i(366),c=i(101),d=i(384),f=i(347),p=i(400),g=i(9),v=i(22),m=i(409),y=i(24),x=i(414),T=i(415),w=i(417),E=i(106),b=i(422),S=i(385),A=i(387),_=i(426),C=new a({initialize:function(t){this.config=new h(t),this.renderer=null,this.domContainer=null,this.canvas=null,this.context=null,this.isBooted=!1,this.isRunning=!1,this.events=new g(),this.anims=new s(this),this.textures=new b(this),this.cache=new r(this),this.registry=new c(this),this.input=new m(this,this.config),this.scene=new w(this,this.config.sceneConfig),this.device=f,this.scale=new T(this,this.config),this.sound=null,this.sound=_.create(this),this.loop=new S(this,this.config.fps),this.plugins=new x(this,this.config),this.pendingDestroy=!1,this.removeCanvas=!1,this.noReturn=!1,this.hasFocus=!1,p(this.boot.bind(this));},boot:function(){y.hasCore("EventEmitter")?(this.isBooted=!0,this.config.preBoot(this),this.scale.preBoot(),l(this),u(this),d(this),n(this.canvas,this.config.parent),this.textures.once(E.READY,this.texturesReady,this),this.events.emit(v.BOOT)):console.warn("Aborting. Core Plugins missing.");},texturesReady:function(){this.events.emit(v.READY),this.start();},start:function(){this.isRunning=!0,this.config.postBoot(this),this.renderer?this.loop.start(this.step.bind(this)):this.loop.start(this.headlessStep.bind(this)),A(this);var t=this.events;t.on(v.HIDDEN,this.onHidden,this),t.on(v.VISIBLE,this.onVisible,this),t.on(v.BLUR,this.onBlur,this),t.on(v.FOCUS,this.onFocus,this);},step:function(t,e){if(this.pendingDestroy)return this.runDestroy();var i=this.events;i.emit(v.PRE_STEP,t,e),i.emit(v.STEP,t,e),this.scene.update(t,e),i.emit(v.POST_STEP,t,e);var n=this.renderer;n.preRender(),i.emit(v.PRE_RENDER,n,t,e),this.scene.render(n),n.postRender(),i.emit(v.POST_RENDER,n,t,e);},headlessStep:function(t,e){if(this.pendingDestroy)return this.runDestroy();var i=this.events;i.emit(v.PRE_STEP,t,e),i.emit(v.STEP,t,e),this.scene.update(t,e),i.emit(v.POST_STEP,t,e),i.emit(v.PRE_RENDER),i.emit(v.POST_RENDER);},onHidden:function(){this.loop.pause(),this.events.emit(v.PAUSE);},onVisible:function(){this.loop.resume(),this.events.emit(v.RESUME);},onBlur:function(){this.hasFocus=!1,this.loop.blur();},onFocus:function(){this.hasFocus=!0,this.loop.focus();},getFrame:function(){return this.loop.frame;},getTime:function(){return this.loop.now;},destroy:function(t,e){void 0===e&&(e=!1),this.pendingDestroy=!0,this.removeCanvas=t,this.noReturn=e;},runDestroy:function(){this.scene.destroy(),this.events.emit(v.DESTROY),this.events.removeAllListeners(),this.renderer&&this.renderer.destroy(),this.removeCanvas&&this.canvas&&(o.remove(this.canvas),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)),this.domContainer&&this.domContainer.parentNode.removeChild(this.domContainer),this.loop.destroy(),this.pendingDestroy=!1;}});t.exports=C;},function(t,e,i){var n=i(142);t.exports=function(t){var e,i=t.config;i.parent&&i.domCreateContainer&&((e=document.createElement("div")).style.cssText=["display: block;","width: "+t.scale.width+"px;","height: "+t.scale.height+"px;","padding: 0; margin: 0;","position: absolute;","overflow: hidden;","pointer-events: "+i.domPointerEvents+";","transform: scale(1);","transform-origin: left top;"].join(" "),t.domContainer=e,n(e,i.parent));};},function(t,e){t.exports="boot";},function(t,e){t.exports="destroy";},function(t,e){t.exports="dragend";},function(t,e){t.exports="dragenter";},function(t,e){t.exports="drag";},function(t,e){t.exports="dragleave";},function(t,e){t.exports="dragover";},function(t,e){t.exports="dragstart";},function(t,e){t.exports="drop";},function(t,e){t.exports="gameout";},function(t,e){t.exports="gameover";},function(t,e){t.exports="gameobjectdown";},function(t,e){t.exports="dragend";},function(t,e){t.exports="dragenter";},function(t,e){t.exports="drag";},function(t,e){t.exports="dragleave";},function(t,e){t.exports="dragover";},function(t,e){t.exports="dragstart";},function(t,e){t.exports="drop";},function(t,e){t.exports="gameobjectmove";},function(t,e){t.exports="gameobjectout";},function(t,e){t.exports="gameobjectover";},function(t,e){t.exports="pointerdown";},function(t,e){t.exports="pointermove";},function(t,e){t.exports="pointerout";},function(t,e){t.exports="pointerover";},function(t,e){t.exports="pointerup";},function(t,e){t.exports="wheel";},function(t,e){t.exports="gameobjectup";},function(t,e){t.exports="gameobjectwheel";},function(t,e){t.exports="boot";},function(t,e){t.exports="process";},function(t,e){t.exports="update";},function(t,e){t.exports="pointerdown";},function(t,e){t.exports="pointerdownoutside";},function(t,e){t.exports="pointermove";},function(t,e){t.exports="pointerout";},function(t,e){t.exports="pointerover";},function(t,e){t.exports="pointerup";},function(t,e){t.exports="pointerupoutside";},function(t,e){t.exports="wheel";},function(t,e){t.exports="pointerlockchange";},function(t,e){t.exports="preupdate";},function(t,e){t.exports="shutdown";},function(t,e){t.exports="start";},function(t,e){t.exports="update";},function(t,e){t.exports="addfile";},function(t,e){t.exports="complete";},function(t,e){t.exports="filecomplete";},function(t,e){t.exports="filecomplete-";},function(t,e){t.exports="loaderror";},function(t,e){t.exports="load";},function(t,e){t.exports="fileprogress";},function(t,e){t.exports="postprocess";},function(t,e){t.exports="progress";},function(t,e){t.exports="start";},function(t,e,i){t.exports={game:"game",renderer:"renderer",anims:"anims",cache:"cache",plugins:"plugins",registry:"registry",scale:"scale",sound:"sound",textures:"textures",events:"events",cameras:"cameras",add:"add",make:"make",scenePlugin:"scene",displayList:"children",lights:"lights",data:"data",input:"input",load:"load",time:"time",tweens:"tweens",arcadePhysics:"physics",impactPhysics:"impact",matterPhysics:"matter"};},function(t,e){t.exports=function(t,e,i){if(i.getElementsByTagName("TextureAtlas")){var n=t.source[e];t.add("__BASE",e,0,0,n.width,n.height);for(var s=i.getElementsByTagName("SubTexture"),r=0;r<s.length;r++){var o,a,h,u,l=s[r].attributes,c=l.name.value,d=parseInt(l.x.value,10),f=parseInt(l.y.value,10),p=parseInt(l.width.value,10),g=parseInt(l.height.value,10),v=t.add(c,e,d,f,p,g);l.frameX&&(o=Math.abs(parseInt(l.frameX.value,10)),a=Math.abs(parseInt(l.frameY.value,10)),h=parseInt(l.frameWidth.value,10),u=parseInt(l.frameHeight.value,10),v.setTrim(p,g,o,a,h,u));}return t;}console.warn("Invalid Texture Atlas XML given");};},function(t,e){t.exports=function(t,e){var i=t.source[e];return t.add("__BASE",e,0,0,i.width,i.height),t;};},function(t,e){t.exports=function(t,e){var i=t.source[e];return t.add("__BASE",e,0,0,i.width,i.height),t;};},function(t,e,i){var l=i(77);t.exports=function(t,e,i){if(i.frames||i.textures){var n=t.source[e];t.add("__BASE",e,0,0,n.width,n.height);for(var s=Array.isArray(i.textures)?i.textures[e].frames:i.frames,r=0;r<s.length;r++){var o=s[r],a=t.add(o.filename,e,o.frame.x,o.frame.y,o.frame.w,o.frame.h);o.trimmed&&a.setTrim(o.sourceSize.w,o.sourceSize.h,o.spriteSourceSize.x,o.spriteSourceSize.y,o.spriteSourceSize.w,o.spriteSourceSize.h),o.rotated&&(a.rotated=!0,a.updateUVsInverted());var h=o.anchor||o.pivot;h&&(a.customPivot=!0,a.pivotX=h.x,a.pivotY=h.y),a.customData=l(o);}for(var u in i)"frames"!==u&&(Array.isArray(i[u])?t.customData[u]=i[u].slice(0):t.customData[u]=i[u]);return t;}console.warn("Invalid Texture Atlas JSON Array");};},function(t,e,i){var l=i(77);t.exports=function(t,e,i){if(i.frames){var n=t.source[e];t.add("__BASE",e,0,0,n.width,n.height);var s,r,o,a=i.frames;for(var h in a){a.hasOwnProperty(h)&&(s=a[h],r=t.add(h,e,s.frame.x,s.frame.y,s.frame.w,s.frame.h),s.trimmed&&r.setTrim(s.sourceSize.w,s.sourceSize.h,s.spriteSourceSize.x,s.spriteSourceSize.y,s.spriteSourceSize.w,s.spriteSourceSize.h),s.rotated&&(r.rotated=!0,r.updateUVsInverted()),(o=s.anchor||s.pivot)&&(r.customPivot=!0,r.pivotX=o.x,r.pivotY=o.y),r.customData=l(s));}for(var u in i)"frames"!==u&&(Array.isArray(i[u])?t.customData[u]=i[u].slice(0):t.customData[u]=i[u]);return t;}console.warn("Invalid Texture Atlas JSON Hash given, missing 'frames' Object");};},function(t,e,i){var E=i(2);t.exports=function(t,e,i,n,s,r,o){var a=E(o,"frameWidth",null),h=E(o,"frameHeight",a);if(null===a)throw new Error("TextureManager.SpriteSheet: Invalid frameWidth given.");var u=t.source[e];t.add("__BASE",e,0,0,u.width,u.height);var l=E(o,"startFrame",0),c=E(o,"endFrame",-1),d=E(o,"margin",0),f=E(o,"spacing",0),p=Math.floor((s-d+f)/(a+f))*Math.floor((r-d+f)/(h+f));0===p&&console.warn("SpriteSheet frame dimensions will result in zero frames for texture:",t.key),(p<l||l<-p)&&(l=0),l<0&&(l=p+l),-1!==c&&(p=l+(c+1));for(var g=d,v=d,m=0,y=0,x=0;x<p;x++){y=m=0;var T=g+a,w=v+h;s<T&&(m=T-s),r<w&&(y=w-r),t.add(x,e,i+g,n+v,a-m,h-y),s<(g+=a+f)+a&&(g=d,v+=h+f);}return t;};},function(t,e,i){var z=i(2);t.exports=function(t,e,i){var n=z(i,"frameWidth",null),s=z(i,"frameHeight",n);if(!n)throw new Error("TextureManager.SpriteSheetFromAtlas: Invalid frameWidth given.");var r=t.source[0];t.add("__BASE",0,0,0,r.width,r.height);var o=z(i,"startFrame",0),a=z(i,"endFrame",-1),h=z(i,"margin",0),u=z(i,"spacing",0),l=e.cutX,c=e.cutY,d=e.cutWidth,f=e.cutHeight,p=e.realWidth,g=e.realHeight,v=Math.floor((p-h+u)/(n+u)),m=Math.floor((g-h+u)/(s+u)),y=v*m,x=e.x,T=n-x,w=n-(p-d-x),E=e.y,b=s-E,S=s-(g-f-E);(y<o||o<-y)&&(o=0),o<0&&(o=y+o),-1!==a&&(y=o+(a+1));for(var A=h,_=h,C=0,R=e.sourceIndex,M=0;M<m;M++){for(var P=0===M,O=M===m-1,L=0;L<v;L++){var D,F,k,I,B,N,Y=0===L,X=L===v-1,U=t.add(C,R,l+A,c+_,n,s);(Y||P||X||O)&&(D=Y?x:0,F=P?E:0,I=k=0,Y&&(k+=n-T),X&&(k+=n-w),P&&(I+=s-b),O&&(I+=s-S),B=n-k,N=s-I,U.cutWidth=B,U.cutHeight=N,U.setTrim(n,s,D,F,B,N)),A+=u,A+=Y?T:X?w:n,C++;}A=h,_+=u,_+=P?b:O?S:s;}return t;};},function(t,e){function p(t,e,i,n){var s=g-n.y-n.height;t.add(i,e,n.x,s,n.width,n.height);}var g=0;t.exports=function(t,e,i){var n=t.source[e];t.add("__BASE",e,0,0,n.width,n.height),g=n.height;for(var s=i.split("\n"),r=/^[ ]*(- )*(\w+)+[: ]+(.*)/,o="",a="",h={x:0,y:0,width:0,height:0},u=0;u<s.length;u++){var l=s[u].match(r);if(l){var c="- "===l[1],d=l[2],f=l[3];if(c&&(a!==o&&(p(t,e,a,h),o=a),h={x:0,y:0,width:0,height:0}),"name"!==d)switch(d){case"x":case"y":case"width":case"height":h[d]=parseInt(f,10);}else a=f;}}return a!==o&&p(t,e,a,h),t;};},function(t,e){t.exports="complete";},function(t,e){t.exports="decoded";},function(t,e){t.exports="decodedall";},function(t,e){t.exports="destroy";},function(t,e){t.exports="detune";},function(t,e){t.exports="detune";},function(t,e){t.exports="mute";},function(t,e){t.exports="rate";},function(t,e){t.exports="volume";},function(t,e){t.exports="loop";},function(t,e){t.exports="looped";},function(t,e){t.exports="mute";},function(t,e){t.exports="pan";},function(t,e){t.exports="pauseall";},function(t,e){t.exports="pause";},function(t,e){t.exports="play";},function(t,e){t.exports="rate";},function(t,e){t.exports="resumeall";},function(t,e){t.exports="resume";},function(t,e){t.exports="seek";},function(t,e){t.exports="stopall";},function(t,e){t.exports="stop";},function(t,e){t.exports="unlocked";},function(t,e){t.exports="volume";},function(t,e,i){var n={Events:i(75),DisplayList:i(1012),GameObjectCreator:i(16),GameObjectFactory:i(5),UpdateList:i(1040),Components:i(11),GetCalcMatrix:i(19),BuildGameObject:i(28),BuildGameObjectAnimation:i(439),GameObject:i(15),BitmapText:i(148),Blitter:i(213),Bob:i(440),Container:i(214),DOMElement:i(442),DynamicBitmapText:i(215),Extern:i(444),Graphics:i(216),Group:i(113),Image:i(125),Layer:i(219),Particles:i(1074),PathFollower:i(457),RenderTexture:i(221),RetroFont:i(1082),Rope:i(223),Sprite:i(73),Text:i(224),GetTextSize:i(458),MeasureText:i(460),TextStyle:i(459),TileSprite:i(225),Zone:i(129),Video:i(226),Shape:i(34),Arc:i(461),Curve:i(462),Ellipse:i(463),Grid:i(464),IsoBox:i(465),IsoTriangle:i(466),Line:i(467),Polygon:i(468),Rectangle:i(473),Star:i(474),Triangle:i(475),Factories:{Blitter:i(1130),Container:i(1131),DOMElement:i(1132),DynamicBitmapText:i(1133),Extern:i(1134),Graphics:i(1135),Group:i(1136),Image:i(1137),Layer:i(1138),Particles:i(1139),PathFollower:i(1140),RenderTexture:i(1141),Rope:i(1142),Sprite:i(1143),StaticBitmapText:i(1144),Text:i(1145),TileSprite:i(1146),Zone:i(1147),Video:i(1148),Arc:i(1149),Curve:i(1150),Ellipse:i(1151),Grid:i(1152),IsoBox:i(1153),IsoTriangle:i(1154),Line:i(1155),Polygon:i(1156),Rectangle:i(1157),Star:i(1158),Triangle:i(1159)},Creators:{Blitter:i(1160),Container:i(1161),DynamicBitmapText:i(1162),Graphics:i(1163),Group:i(1164),Image:i(1165),Layer:i(1166),Particles:i(1167),RenderTexture:i(1168),Rope:i(1169),Sprite:i(1170),StaticBitmapText:i(1171),Text:i(1172),TileSprite:i(1173),Zone:i(1174),Video:i(1175)}};n.Shader=i(229),n.Mesh=i(230),n.PointLight=i(150),n.Factories.Shader=i(1184),n.Factories.Mesh=i(1185),n.Factories.PointLight=i(1186),n.Creators.Shader=i(1187),n.Creators.Mesh=i(1188),n.Creators.PointLight=i(1189),n.Light=i(481),n.LightsManager=i(482),n.LightsPlugin=i(1190),t.exports=n;},function(t,e,i){var n=i(0),s=i(110),r=i(24),o=i(75),a=i(20),h=i(79),u=new n({Extends:s,initialize:function(t){s.call(this,t),this.sortChildrenFlag=!1,this.scene=t,this.systems=t.sys,this.events=t.sys.events,this.addCallback=this.addChildCallback,this.removeCallback=this.removeChildCallback,this.events.once(a.BOOT,this.boot,this),this.events.on(a.START,this.start,this);},boot:function(){this.events.once(a.DESTROY,this.destroy,this);},addChildCallback:function(t){t.displayList&&t.displayList!==this&&t.removeFromDisplayList(),t.displayList||(this.queueDepthSort(),t.displayList=this,t.emit(o.ADDED_TO_SCENE,t,this.scene),this.events.emit(a.ADDED_TO_SCENE,t,this.scene));},removeChildCallback:function(t){this.queueDepthSort(),t.displayList=null,t.emit(o.REMOVED_FROM_SCENE,t,this.scene),this.events.emit(a.REMOVED_FROM_SCENE,t,this.scene);},start:function(){this.events.once(a.SHUTDOWN,this.shutdown,this);},queueDepthSort:function(){this.sortChildrenFlag=!0;},depthSort:function(){this.sortChildrenFlag&&(h(this.list,this.sortByDepth),this.sortChildrenFlag=!1);},sortByDepth:function(t,e){return t._depth-e._depth;},getChildren:function(){return this.list;},shutdown:function(){for(var t=this.list,e=t.length;e--;)t[e].destroy(!0);t.length=0,this.events.off(a.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.events.off(a.START,this.start,this),this.scene=null,this.systems=null,this.events=null;}});r.register("DisplayList",u,"displayList"),t.exports=u;},function(t,e,i){t.exports={CheckMatrix:i(209),MatrixToString:i(1014),ReverseColumns:i(1015),ReverseRows:i(1016),Rotate180:i(1017),RotateLeft:i(1018),RotateMatrix:i(147),RotateRight:i(1019),Translate:i(1020),TransposeMatrix:i(435)};},function(t,e,i){var o=i(186),a=i(209);t.exports=function(t){var e="";if(!a(t))return e;for(var i=0;i<t.length;i++){for(var n=0;n<t[i].length;n++){var s=t[i][n].toString();e+="undefined"!==s?o(s,2):"?",n<t[i].length-1&&(e+=" |");}if(i<t.length-1){e+="\n";for(var r=0;r<t[i].length;r++)e+="---",r<t[i].length-1&&(e+="+");e+="\n";}}return e;};},function(t,e){t.exports=function(t){return t.reverse();};},function(t,e){t.exports=function(t){for(var e=0;e<t.length;e++)t[e].reverse();return t;};},function(t,e,i){var n=i(147);t.exports=function(t){return n(t,180);};},function(t,e,i){var n=i(147);t.exports=function(t){return n(t,90);};},function(t,e,i){var n=i(147);t.exports=function(t){return n(t,-90);};},function(t,e,i){var r=i(178),o=i(179);t.exports=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),0!==i&&(i<0?r(t,Math.abs(i)):o(t,i)),0!==e)for(var n=0;n<t.length;n++){var s=t[n];e<0?r(s,Math.abs(e)):o(s,e);}return t;};},function(t,e){t.exports=function(t,e,i,n,s){if(void 0===s&&(s=t),0<i){var r=i-t.length;if(r<=0)return null;}if(!Array.isArray(e))return-1===t.indexOf(e)?(t.push(e),n&&n.call(s,e),e):null;for(var o=e.length-1;0<=o;)-1!==t.indexOf(e[o])&&e.splice(o,1),o--;if(0===(o=e.length))return null;0<i&&r<o&&(e.splice(r),o=r);for(var a=0;a<o;a++){var h=e[a];t.push(h),n&&n.call(s,h);}return e;};},function(t,e){t.exports=function(t,e,i,n,s,r){if(void 0===i&&(i=0),void 0===r&&(r=t),0<n){var o=n-t.length;if(o<=0)return null;}if(!Array.isArray(e))return-1===t.indexOf(e)?(t.splice(i,0,e),s&&s.call(r,e),e):null;for(var a=e.length-1;0<=a;)-1!==t.indexOf(e[a])&&e.pop(),a--;if(0===(a=e.length))return null;0<n&&o<a&&(e.splice(o),a=o);for(var h=a-1;0<=h;h--){var u=e[h];t.splice(i,0,u),s&&s.call(r,u);}return e;};},function(t,e){t.exports=function(t,e){var i=t.indexOf(e);return-1!==i&&i<t.length&&(t.splice(i,1),t.push(e)),e;};},function(t,e,i){var a=i(78);t.exports=function(t,e,i,n,s){void 0===n&&(n=0),void 0===s&&(s=t.length);var r=0;if(a(t,n,s))for(var o=n;o<s;o++){t[o][e]===i&&r++;}return r;};},function(t,e){t.exports=function(t,e,i){for(var n=[null],s=3;s<arguments.length;s++)n.push(arguments[s]);for(s=0;s<t.length;s++)n[0]=t[s],e.apply(i,n);return t;};},function(t,e,i){var a=i(78);t.exports=function(t,e,i,n,s){if(void 0===n&&(n=0),void 0===s&&(s=t.length),a(t,n,s)){for(var r=[null],o=5;o<arguments.length;o++)r.push(arguments[o]);for(o=n;o<s;o++)r[0]=t[o],e.apply(i,r);}return t;};},function(t,e){t.exports=function(t,e){var i,n,s=t.indexOf(e);return 0<s&&(i=t[s-1],n=t.indexOf(i),t[s]=i,t[n]=e),t;};},function(t,e){t.exports=function(t,e,i){var n=t.indexOf(e);if(-1===n||i<0||i>=t.length)throw new Error("Supplied index out of bounds");return n!==i&&(t.splice(n,1),t.splice(i,0,e)),e;};},function(t,e){t.exports=function(t,e){var i,n,s=t.indexOf(e);return-1!==s&&s<t.length-1&&(i=t[s+1],n=t.indexOf(i),t[s]=i,t[n]=e),t;};},function(t,e){t.exports=function(t,e,i){if(e===i)return t;var n=t.indexOf(e),s=t.indexOf(i);if(n<0||s<0)throw new Error("Supplied items must be elements of the same array");return s<n||(t.splice(n,1),s===t.length-1?t.push(e):t.splice(s,0,e)),t;};},function(t,e){t.exports=function(t,e,i){if(e===i)return t;var n=t.indexOf(e),s=t.indexOf(i);if(n<0||s<0)throw new Error("Supplied items must be elements of the same array");return n<s||(t.splice(n,1),0===s?t.unshift(e):t.splice(s,0,e)),t;};},function(t,e,i){var o=i(363);t.exports=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=null),void 0===i&&(i=1),null===e&&(e=t,t=0);for(var n=[],s=Math.max(o((e-t)/(i||1)),0),r=0;r<s;r++)n.push(t),t+=i;return n;};},function(t,e,i){var r=i(74);t.exports=function(t,e,i,n){if(void 0===n&&(n=t),e<0||e>t.length-1)throw new Error("Index out of bounds");var s=r(t,e);return i&&i.call(n,s),s;};},function(t,e,i){var u=i(78);t.exports=function(t,e,i,n,s){if(void 0===e&&(e=0),void 0===i&&(i=t.length),void 0===s&&(s=t),u(t,e,i)){var r=i-e,o=t.splice(e,r);if(n)for(var a=0;a<o.length;a++){var h=o[a];n.call(s,h);}return o;}return[];};},function(t,e,i){var s=i(74);t.exports=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length);var n=e+Math.floor(Math.random()*i);return s(t,n);};},function(t,e){t.exports=function(t,e,i){var n=t.indexOf(e),s=t.indexOf(i);return-1!==n&&-1===s&&(t[n]=i,!0);};},function(t,e){t.exports=function(t,e){var i=t.indexOf(e);return-1!==i&&0<i&&(t.splice(i,1),t.unshift(e)),e;};},function(t,e,i){var a=i(78);t.exports=function(t,e,i,n,s){if(void 0===n&&(n=0),void 0===s&&(s=t.length),a(t,n,s))for(var r=n;r<s;r++){var o=t[r];o.hasOwnProperty(e)&&(o[e]=i);}return t;};},function(t,e){t.exports=function(t,e,i){if(e===i)return t;var n=t.indexOf(e),s=t.indexOf(i);if(n<0||s<0)throw new Error("Supplied items must be elements of the same array");return t[n]=i,t[s]=e,t;};},function(t,e,i){var n=i(0),s=i(211),r=i(24),o=i(20),a=new n({Extends:s,initialize:function(t){s.call(this),this.checkQueue=!0,this.scene=t,this.systems=t.sys,t.sys.events.once(o.BOOT,this.boot,this),t.sys.events.on(o.START,this.start,this);},boot:function(){this.systems.events.once(o.DESTROY,this.destroy,this);},start:function(){var t=this.systems.events;t.on(o.PRE_UPDATE,this.update,this),t.on(o.UPDATE,this.sceneUpdate,this),t.once(o.SHUTDOWN,this.shutdown,this);},sceneUpdate:function(t,e){for(var i=this._active,n=i.length,s=0;s<n;s++){var r=i[s];r.active&&r.preUpdate.call(r,t,e);}},shutdown:function(){for(var t=this._active.length;t--;)this._active[t].destroy(!0);for(t=this._pending.length;t--;)this._pending[t].destroy(!0);for(t=this._destroy.length;t--;)this._destroy[t].destroy(!0);this._toProcess=0,this._pending=[],this._active=[],this._destroy=[],this.removeAllListeners();var e=this.systems.events;e.off(o.PRE_UPDATE,this.update,this),e.off(o.UPDATE,this.sceneUpdate,this),e.off(o.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.systems.events.off(o.START,this.start,this),this.scene=null,this.systems=null;}});r.register("UpdateList",a,"updateList"),t.exports=a;},function(t,e){t.exports="add";},function(t,e){t.exports="remove";},function(t,e){t.exports=function(t,e,i,n){if(void 0===i&&(i=!1),void 0===n)return n={local:{x:0,y:0,width:0,height:0},global:{x:0,y:0,width:0,height:0},lines:{shortest:0,longest:0,lengths:null,height:0},wrappedText:"",words:[],characters:[],scaleX:0,scaleY:0};var s,r,o,a,h=t.text,u=h.length,l=t.maxWidth,c=t.wordWrapCharCode,d=Number.MAX_VALUE,f=Number.MAX_VALUE,p=0,g=0,v=t.fontData.chars,m=t.fontData.lineHeight,y=t.letterSpacing,x=0,T=0,w=0,E=null,b=t._align,S=0,A=t.fontSize/t.fontData.size,_=A*t.scaleX,C=A*t.scaleY,R=null,M=0,P=[],O=Number.MAX_VALUE,L=0,D=0,F=0,k=[],I=[],B=null;if(0<l){for(X=0;X<u;X++){10!==(w=h.charCodeAt(X))?(E=v[w])&&(null!==R&&(s=E.kerning[M]),w===c?null!==B&&(k.push({word:B.word,i:B.i,x:B.x*_,y:B.y*C,w:B.w*_,h:B.h*C,cr:!1}),B=null):(null===B&&(B={word:"",i:X,x:x,y:T,w:0,h:m,cr:!1}),B.word=B.word.concat(h[X]),B.w+=E.xOffset+E.xAdvance+(void 0!==s?s:0)),x+=E.xAdvance+y,R=E,M=w):(null!==B&&(k.push({word:B.word,i:B.i,x:B.x*_,y:B.y*C,w:B.w*_,h:B.h*C,cr:!0}),B=null),x=0,T+=m,R=null);}null!==B&&k.push({word:B.word,i:B.i,x:B.x*_,y:B.y*C,w:B.w*_,h:B.h*C,cr:!1}),R=null;for(var N=M=T=x=0,Y=[],X=0;X<k.length;X++){var U,z=k[X],G=z.x,W=z.x+z.w;U&&(N=G-(G-(U.x+U.w)+U.w),U=null),l<G-N||l<W-N?(Y.push(z.i-1),U=z.cr?(Y.push(z.i+z.word.length),N=0,null):z):z.cr&&(Y.push(z.i+z.word.length),N=0,U=null);}for(X=Y.length-1;0<=X;X--)r=h,o=Y[X],a="\n",h=r.substr(0,o)+a+r.substr(o+1);u=(n.wrappedText=h).length,k=[],B=null;}var V,H,j,K,Z=0;for(X=0;X<u;X++){10!==(w=h.charCodeAt(X))?(E=v[w])&&(S=x,null!==R&&(S+=void 0!==(V=E.kerning[M])?V:0),S<d&&(d=S),T<f&&(f=T),p<(H=S+E.xAdvance)&&(p=H),g<(j=T+m)&&(g=j),K=E.xOffset+E.xAdvance+(void 0!==V?V:0),w===c?null!==B&&(k.push({word:B.word,i:B.i,x:B.x*_,y:B.y*C,w:B.w*_,h:B.h*C}),B=null):(null===B&&(B={word:"",i:Z,x:x,y:T,w:0,h:m}),B.word=B.word.concat(h[X]),B.w+=K),I.push({i:Z,char:h[X],code:w,x:(E.xOffset+x)*A,y:(E.yOffset+T)*A,w:E.width*A,h:E.height*A,t:T*A,r:H*A,b:m*A,line:D,glyph:E}),x+=E.xAdvance+y,R=E,M=w,F=H*A,Z++):(null!==B&&(k.push({word:B.word,i:B.i,x:B.x*_,y:B.y*C,w:B.w*_,h:B.h*C}),B=null),x=0,T+=m,R=null,L<(P[D]=F)&&(L=F),F<O&&(O=F),D++,F=0);}if(null!==B&&k.push({word:B.word,i:B.i,x:B.x*_,y:B.y*C,w:B.w*_,h:B.h*C}),L<(P[D]=F)&&(L=F),F<O&&(O=F),0<b)for(var q=0;q<I.length;q++){var J,Q,$=I[q];1===b?(J=(L-P[$.line])/2,$.x+=J,$.r+=J):2===b&&(Q=L-P[$.line],$.x+=Q,$.r+=Q);}var tt=n.local,et=n.global,it=n.lines;return tt.x=d*A,tt.y=f*A,tt.width=p*A,tt.height=g*A,et.x=t.x-t._displayOriginX+d*_,et.y=t.y-t._displayOriginY+f*C,et.width=p*_,et.height=g*C,it.shortest=O,it.longest=L,it.lengths=P,e&&(tt.x=Math.ceil(tt.x),tt.y=Math.ceil(tt.y),tt.width=Math.ceil(tt.width),tt.height=Math.ceil(tt.height),et.x=Math.ceil(et.x),et.y=Math.ceil(et.y),et.width=Math.ceil(et.width),et.height=Math.ceil(et.height),it.shortest=Math.ceil(O),it.longest=Math.ceil(L)),i&&(t._displayOriginX=t.originX*tt.width,t._displayOriginY=t.originY*tt.height,et.x=t.x-t._displayOriginX*t.scaleX,et.y=t.y-t._displayOriginY*t.scaleY,e&&(et.x=Math.ceil(et.x),et.y=Math.ceil(et.y))),n.words=k,n.characters=I,n.lines.height=m,n.scale=A,n.scaleX=t.scaleX,n.scaleY=t.scaleY,n;};},function(t,e,i){var c=i(212);t.exports=function(t,e,i,n,s,r,o){var a=t.sys.textures.get(i),h=a.get(n),u=t.sys.cache.xml.get(s);if(h&&u){var l=c(u,h,r,o,a);return t.sys.cache.bitmapFont.add(e,{data:l,texture:i,frame:n,fromAtlas:!0}),!0;}return!1;};},function(t,e,i){var n=i(1),s=i(1),n=i(1046),s=i(1048);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var I=i(1047),B=i(19),N=i(12);t.exports=function(t,e,i,n){if(0!==e._text.length){i.addToRenderList(e);var s,r=t.pipelines.set(e.pipeline,e),o=B(e,i,n).calc,a=i.roundPixels,h=i.alpha,u=e.charColors,l=e.tintFill,c=N.getTintAppendFloatAlpha,d=c(e.tintTopLeft,h*e._alphaTL),f=c(e.tintTopRight,h*e._alphaTR),p=c(e.tintBottomLeft,h*e._alphaBL),g=c(e.tintBottomRight,h*e._alphaBR),v=e.frame.glTexture,m=r.setGameObject(e),y=e.getTextBounds(!1).characters,x=e.dropShadowX,T=e.dropShadowY,w=0!==x||0!==T;if(t.pipelines.preBatch(e),w)for(var E=e.dropShadowColor,b=e.dropShadowAlpha,S=c(E,h*b*e._alphaTL),A=c(E,h*b*e._alphaTR),_=c(E,h*b*e._alphaBL),C=c(E,h*b*e._alphaBR),R=0;R<y.length;R++)k=(s=y[R]).glyph,32!==s.code&&0!==k.width&&0!==k.height&&I(r,e,s,k,x,T,o,a,S,A,_,C,1,v,m);for(R=0;R<y.length;R++){var M,P,O,L,D,F,k=(s=y[R]).glyph;32!==s.code&&0!==k.width&&0!==k.height&&(u[s.i]?(P=(M=u[s.i]).tintEffect,O=c(M.tintTL,h*e._alphaTL),L=c(M.tintTR,h*e._alphaTR),D=c(M.tintBL,h*e._alphaBL),F=c(M.tintBR,h*e._alphaBR),I(r,e,s,k,0,0,o,a,O,L,D,F,P,v,m)):I(r,e,s,k,0,0,o,a,d,f,p,g,l,v,m));}t.pipelines.postBatch(e);}};},function(t,e){t.exports=function(t,e,i,n,s,r,o,a,h,u,l,c,d,f,p){var g=i.x-e.displayOriginX+s,v=i.y-e.displayOriginY+r,m=g+i.w,y=v+i.h,x=o.getXRound(g,v,a),T=o.getYRound(g,v,a),w=o.getXRound(g,y,a),E=o.getYRound(g,y,a),b=o.getXRound(m,y,a),S=o.getYRound(m,y,a),A=o.getXRound(m,v,a),_=o.getYRound(m,v,a);t.batchQuad(e,x,T,w,E,b,S,A,_,n.u0,n.v0,n.u1,n.v1,h,u,l,c,d,f,p);};},function(t,e,i){var k=i(30);t.exports=function(t,e,i,n){var s=e._text,r=s.length,o=t.currentContext;if(0!==r&&k(t,o,e,i,n)){i.addToRenderList(e);var a,h=e.fromAtlas?e.frame:e.texture.frames.__BASE,u=e.fontData.chars,l=e.fontData.lineHeight,c=e._letterSpacing,d=0,f=0,p=null,g=0,v=0,m=0,y=0,x=0,T=0,w=null,E=0,b=h.source.image,S=h.cutX,A=h.cutY,_=e._fontSize/e.fontData.size,C=e._align,R=0,M=0,P=e.getTextBounds(!1);0<e.maxWidth&&(r=(s=P.wrappedText).length);var O=e._bounds.lines;1===C?M=(O.longest-O.lengths[0])/2:2===C&&(M=O.longest-O.lengths[0]),o.translate(-e.displayOriginX,-e.displayOriginY);for(var L,D=i.roundPixels,F=0;F<r;F++){10!==(a=s.charCodeAt(F))?(p=u[a])&&(g=S+p.x,v=A+p.y,m=p.width,y=p.height,x=p.xOffset+d,T=p.yOffset+f,null!==w&&(x+=void 0!==(L=p.kerning[E])?L:0),x*=_,T*=_,x+=M,d+=p.xAdvance+c,w=p,E=a,0!==m&&0!==y&&32!==a&&(D&&(x=Math.round(x),T=Math.round(T)),o.save(),o.translate(x,T),o.scale(_,_),o.drawImage(b,g,v,m,y,0,0,m,y),o.restore())):(R++,1===C?M=(O.longest-O.lengths[R])/2:2===C&&(M=O.longest-O.lengths[R]),d=0,f+=l,w=null);}o.restore();}};},function(t,e,i){var n=i(1),s=i(1),n=i(1050),s=i(1051);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var n=i(25),P=i(12),O=new n();t.exports=function(t,e,i,n){var s=e.getRenderList();if(0!==s.length){var r=i.alpha*e.alpha;if(0!=r){i.addToRenderList(e);var o=t.pipelines.set(this.pipeline,e),a=i.scrollX*e.scrollFactorX,h=i.scrollY*e.scrollFactorY,u=O.copyFrom(i.matrix);n&&(u.multiplyWithOffset(n,-a,-h),h=a=0);var l=e.x-a,c=e.y-h,d=-1,f=i.roundPixels;t.pipelines.preBatch(e);for(var p=0;p<s.length;p++){var g,v,m,y,x,T,w,E,b,S,A,_,C=s[p],R=C.frame,M=C.alpha*r;0!=M&&(g=R.width,v=R.height,m=l+C.x+R.x,y=c+C.y+R.y,C.flipX&&(g*=-1,m+=R.width),C.flipY&&(v*=-1,y+=R.height),x=m+g,T=y+v,w=u.getX(m,y),E=u.getY(m,y),b=u.getX(x,T),S=u.getY(x,T),A=P.getTintAppendFloatAlpha(C.tint,M),R.sourceIndex!==d&&(_=o.setGameObject(e,R),d=R.sourceIndex),f&&(w=Math.round(w),E=Math.round(E),b=Math.round(b),S=Math.round(S)),o.batchQuad(e,w,E,w,S,b,S,b,E,R.u0,R.v0,R.u1,R.v1,A,A,A,A,!1,R.glTexture,_)&&(d=-1));}t.pipelines.postBatch(e);}}};},function(t,e){t.exports=function(t,e,i,n){var s=e.getRenderList();if(0!==s.length){var r=t.currentContext,o=i.alpha*e.alpha;if(0!=o){i.addToRenderList(e),r.globalCompositeOperation=t.blendModes[e.blendMode],r.imageSmoothingEnabled=!(!t.antialias||e.frame.source.scaleMode);var a=e.x-i.scrollX*e.scrollFactorX,h=e.y-i.scrollY*e.scrollFactorY;r.save(),n&&n.copyToContext(r);for(var u=i.roundPixels,l=0;l<s.length;l++){var c=s[l],d=c.flipX||c.flipY,f=c.frame,p=f.canvasData,g=f.x,v=f.y,m=1,y=1,x=c.alpha*o;0!=x&&(r.globalAlpha=x,d?(c.flipX&&(m=-1,g-=p.width),c.flipY&&(y=-1,v-=p.height),r.save(),r.translate(c.x+a,c.y+h),r.scale(m,y),r.drawImage(f.source.image,p.x,p.y,p.width,p.height,g,v,p.width,p.height),r.restore()):(u&&(g=Math.round(g),v=Math.round(v)),r.drawImage(f.source.image,p.x,p.y,p.width,p.height,g+c.x+a,v+c.y+h,p.width,p.height)));}r.restore();}}};},function(t,e,i){var n=i(1),s=i(1),n=i(1053),s=i(1054);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e){t.exports=function(t,e,i,n){i.addToRenderList(e);var s=e.list,r=s.length;if(0!==r){var o=e.localTransform;n?(o.loadIdentity(),o.multiply(n),o.translate(e.x,e.y),o.rotate(e.rotation),o.scale(e.scaleX,e.scaleY)):o.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY),t.pipelines.preBatch(e);var a=-1!==e.blendMode;a||t.setBlendMode(0);for(var h=e.alpha,u=e.scrollFactorX,l=e.scrollFactorY,c=0;c<r;c++){var d,f,p,g,v,m,y,x,T=s[c];T.willRender(i)&&(g=void 0!==T.alphaTopLeft?(d=T.alphaTopLeft,f=T.alphaTopRight,p=T.alphaBottomLeft,T.alphaBottomRight):p=f=d=T.alpha,v=T.scrollFactorX,m=T.scrollFactorY,a||T.blendMode===t.currentBlendMode||t.setBlendMode(T.blendMode),(y=T.mask)&&y.preRenderWebGL(t,T,i),(x=T.type)!==t.currentType&&(t.newType=!0,t.currentType=x),t.nextTypeMatch=c<r-1&&s[c+1].type===t.currentType,T.setScrollFactor(v*u,m*l),T.setAlpha(d*h,f*h,p*h,g*h),T.renderWebGL(t,T,i,o),T.setAlpha(d,f,p,g),T.setScrollFactor(v,m),y&&y.postRenderWebGL(t,i),t.newType=!1);}t.pipelines.postBatch(e);}};},function(t,e){t.exports=function(t,e,i,n){i.addToRenderList(e);var s=e.list;if(0!==s.length){var r=e.localTransform;n?(r.loadIdentity(),r.multiply(n),r.translate(e.x,e.y),r.rotate(e.rotation),r.scale(e.scaleX,e.scaleY)):r.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY);var o=-1!==e.blendMode;o||t.setBlendMode(0);var a=e._alpha,h=e.scrollFactorX,u=e.scrollFactorY;e.mask&&e.mask.preRenderCanvas(t,null,i);for(var l=0;l<s.length;l++){var c,d,f,p=s[l];p.willRender(i)&&(c=p.alpha,d=p.scrollFactorX,f=p.scrollFactorY,o||p.blendMode===t.currentBlendMode||t.setBlendMode(p.blendMode),p.setScrollFactor(d*h,f*u),p.setAlpha(c*a),p.renderCanvas(t,p,i,r),p.setAlpha(c),p.setScrollFactor(d,f));}e.mask&&e.mask.postRenderCanvas(t);}};},function(t,e,i){var n=i(1),s=i(1),n=i(443),s=i(443);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e){t.exports=["normal","multiply","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"];},function(t,e,i){var n=i(1),s=i(1),n=i(1058),s=i(1059);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var ot=i(19),n=i(25),at=i(12),ht=new n();t.exports=function(t,e,i,n){var s=e.text,r=s.length;if(0!==r){i.addToRenderList(e);var o=t.pipelines.set(e.pipeline,e),a=ot(e,i,n),h=a.sprite,u=a.calc,l=ht,c=0<e.cropWidth||0<e.cropHeight;c&&(o.flush(),t.pushScissor(u.tx,u.ty,e.cropWidth*u.scaleX,e.cropHeight*u.scaleY));var d,f,p,g,v=e.frame.glTexture,m=e.tintFill,y=at.getTintAppendFloatAlpha(e.tintTopLeft,i.alpha*e._alphaTL),x=at.getTintAppendFloatAlpha(e.tintTopRight,i.alpha*e._alphaTR),T=at.getTintAppendFloatAlpha(e.tintBottomLeft,i.alpha*e._alphaBL),w=at.getTintAppendFloatAlpha(e.tintBottomRight,i.alpha*e._alphaBR),E=o.setGameObject(e),b=0,S=0,A=0,_=e.letterSpacing,C=e.scrollX,R=e.scrollY,M=e.fontData,P=M.chars,O=M.lineHeight,L=e.fontSize/M.size,D=0,F=e._align,k=0,I=0,B=e.getTextBounds(!1);0<e.maxWidth&&(r=(s=B.wrappedText).length);var N=e._bounds.lines;1===F?I=(N.longest-N.lengths[0])/2:2===F&&(I=N.longest-N.lengths[0]);var Y=i.roundPixels,X=e.displayCallback,U=e.callbackData;t.pipelines.preBatch(e);for(var z,G,W,V,H,j,K,Z,q,J,Q,$,tt,et,it,nt,st,rt=0;rt<r;rt++){10!==(d=s.charCodeAt(rt))?(st=P[d])&&(f=st.width,p=st.height,W=st.xOffset+b-C,V=st.yOffset+S-R,null!==g&&(W+=void 0!==(z=st.kerning[A])?z:0),b+=st.xAdvance+_,g=st,A=d,0!==f&&0!==p&&32!==d&&(L=e.fontSize/e.fontData.size,D=0,X&&(U.color=0,U.tint.topLeft=y,U.tint.topRight=x,U.tint.bottomLeft=T,U.tint.bottomRight=w,U.index=rt,U.charCode=d,U.x=W,U.y=V,U.scale=L,U.rotation=D,U.data=st.data,W=(G=X(U)).x,V=G.y,L=G.scale,D=G.rotation,w=G.color?(y=G.color,x=G.color,T=G.color,G.color):(y=G.tint.topLeft,x=G.tint.topRight,T=G.tint.bottomLeft,G.tint.bottomRight),y=at.getTintAppendFloatAlpha(y,i.alpha*e._alphaTL),x=at.getTintAppendFloatAlpha(x,i.alpha*e._alphaTR),T=at.getTintAppendFloatAlpha(T,i.alpha*e._alphaBL),w=at.getTintAppendFloatAlpha(w,i.alpha*e._alphaBR)),W*=L,V*=L,W-=e.displayOriginX,V-=e.displayOriginY,W+=I,l.applyITRS(W,V,D,L,L),u.multiply(l,h),H=st.u0,j=st.v0,K=st.u1,Z=st.v1,q=h.e,J=h.f,Q=p*h.c+h.e,$=p*h.d+h.f,tt=f*h.a+p*h.c+h.e,et=f*h.b+p*h.d+h.f,it=f*h.a+h.e,nt=f*h.b+h.f,Y&&(q=Math.round(q),J=Math.round(J),Q=Math.round(Q),$=Math.round($),tt=Math.round(tt),et=Math.round(et),it=Math.round(it),nt=Math.round(nt)),o.batchQuad(e,q,J,Q,$,tt,et,it,nt,H,j,K,Z,y,x,T,w,m,v,E))):(k++,1===F?I=(N.longest-N.lengths[k])/2:2===F&&(I=N.longest-N.lengths[k]),b=0,S+=O,g=null);}c&&(o.flush(),t.popScissor()),t.pipelines.postBatch(e);}};},function(t,e,i){var Y=i(30);t.exports=function(t,e,i,n){var s=e._text,r=s.length,o=t.currentContext;if(0!==r&&Y(t,o,e,i,n)){i.addToRenderList(e);var a,h=e.fromAtlas?e.frame:e.texture.frames.__BASE,u=e.displayCallback,l=e.callbackData,c=e.fontData.chars,d=e.fontData.lineHeight,f=e._letterSpacing,p=0,g=0,v=null,m=0,y=0,x=0,T=0,w=0,E=0,b=null,S=0,A=e.frame.source.image,_=h.cutX,C=h.cutY,R=0,M=0,P=e._fontSize/e.fontData.size,O=e._align,L=0,D=0;e.getTextBounds(!1);var F=e._bounds.lines;1===O?D=(F.longest-F.lengths[0])/2:2===O&&(D=F.longest-F.lengths[0]),o.translate(-e.displayOriginX,-e.displayOriginY);var k=i.roundPixels;0<e.cropWidth&&0<e.cropHeight&&(o.beginPath(),o.rect(0,0,e.cropWidth,e.cropHeight),o.clip());for(var I,B,N=0;N<r;N++){M=P,R=0,10!==(a=s.charCodeAt(N))?(v=c[a])&&(m=_+v.x,y=C+v.y,x=v.width,T=v.height,w=v.xOffset+p-e.scrollX,E=v.yOffset+g-e.scrollY,null!==b&&(w+=void 0!==(I=v.kerning[S])?I:0),u&&(l.index=N,l.charCode=a,l.x=w,l.y=E,l.scale=M,l.rotation=R,l.data=v.data,w=(B=u(l)).x,E=B.y,M=B.scale,R=B.rotation),w*=M,E*=M,w+=D,p+=v.xAdvance+f,b=v,S=a,0!==x&&0!==T&&32!==a&&(k&&(w=Math.round(w),E=Math.round(E)),o.save(),o.translate(w,E),o.rotate(R),o.scale(M,M),o.drawImage(A,m,y,x,T,0,0,x,T),o.restore())):(L++,1===O?D=(F.longest-F.lengths[L])/2:2===O&&(D=F.longest-F.lengths[L]),p=0,g+=d,b=null);}o.restore();}};},function(t,e,i){var n=i(1),s=i(1),n=i(1061),s=i(1062);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var r=i(19);t.exports=function(t,e,i,n){t.pipelines.clear();var s=r(e,i,n).calc;e.render.call(e,t,i,s),t.pipelines.rebind();};},function(t,e){},function(t,e,i){var n=i(1),s=i(1),n=i(1064),s=i(448);s=i(448),t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){function B(t,e,i){this.x=t,this.y=e,this.width=i;}function N(t,e,i){this.points=[],this.pointsLength=1,this.points[0]=new B(t,e,i);}var Y=i(217),X=i(19),n=i(25),U=i(12),z=[],G=new n();t.exports=function(t,e,i,n){if(0!==e.commandBuffer.length){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline,e);t.pipelines.preBatch(e);for(var r=X(e,i,n).calc,o=G.loadIdentity(),a=e.commandBuffer,h=i.alpha*e.alpha,u=1,l=s.fillTint,c=s.strokeTint,d=0,f=0,p=0,g=2*Math.PI,v=[],m=0,y=!0,x=null,T=U.getTintAppendFloatAlpha,w=0;w<a.length;w++)switch(a[w]){case Y.BEGIN_PATH:v.length=0,y=!(x=null);break;case Y.CLOSE_PATH:y=!1,x&&x.points.length&&x.points.push(x.points[0]);break;case Y.FILL_PATH:for(m=0;m<v.length;m++)s.batchFillPath(v[m].points,o,r);break;case Y.STROKE_PATH:for(m=0;m<v.length;m++)s.batchStrokePath(v[m].points,u,y,o,r);break;case Y.LINE_STYLE:u=a[++w];var E=T(a[++w],a[++w]*h);c.TL=E,c.TR=E,c.BL=E,c.BR=E;break;case Y.FILL_STYLE:var b=T(a[++w],a[++w]*h);l.TL=b,l.TR=b,l.BL=b,l.BR=b;break;case Y.GRADIENT_FILL_STYLE:var S=a[++w]*h,A=a[++w]*h,_=a[++w]*h,C=a[++w]*h;l.TL=T(a[++w],S),l.TR=T(a[++w],A),l.BL=T(a[++w],_),l.BR=T(a[++w],C);break;case Y.GRADIENT_LINE_STYLE:u=a[++w];var R=a[++w]*h;c.TL=T(a[++w],R),c.TR=T(a[++w],R),c.BL=T(a[++w],R),c.BR=T(a[++w],R);break;case Y.ARC:var M=0,P=a[++w],O=a[++w],L=a[++w],D=a[++w],F=a[++w],k=a[++w],I=a[++w];for(F-=D,k?F<-g?F=-g:0<F&&(F=F%g-g):g<F?F=g:F<0&&(F=g+F%g),null===x&&(x=new N(P+Math.cos(D)*L,O+Math.sin(D)*L,u),v.push(x),M+=.01);M<1+I;)p=F*M+D,d=P+Math.cos(p)*L,f=O+Math.sin(p)*L,x.points.push(new B(d,f,u)),M+=.01;p=F+D,d=P+Math.cos(p)*L,f=O+Math.sin(p)*L,x.points.push(new B(d,f,u));break;case Y.FILL_RECT:s.batchFillRect(a[++w],a[++w],a[++w],a[++w],o,r);break;case Y.FILL_TRIANGLE:s.batchFillTriangle(a[++w],a[++w],a[++w],a[++w],a[++w],a[++w],o,r);break;case Y.STROKE_TRIANGLE:s.batchStrokeTriangle(a[++w],a[++w],a[++w],a[++w],a[++w],a[++w],u,o,r);break;case Y.LINE_TO:null!==x?x.points.push(new B(a[++w],a[++w],u)):(x=new N(a[++w],a[++w],u),v.push(x));break;case Y.MOVE_TO:x=new N(a[++w],a[++w],u),v.push(x);break;case Y.SAVE:z.push(o.copyToArray());break;case Y.RESTORE:o.copyFromArray(z.pop());break;case Y.TRANSLATE:P=a[++w],O=a[++w],o.translate(P,O);break;case Y.SCALE:P=a[++w],O=a[++w],o.scale(P,O);break;case Y.ROTATE:o.rotate(a[++w]);}t.pipelines.postBatch(e);}};},function(t,e,i){var n=i(1),s=i(1),n=i(1066),s=i(1067);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e){t.exports=function(t,e,i,n){i.addToRenderList(e),e.pipeline.batchSprite(e,i,n);};},function(t,e){t.exports=function(t,e,i,n){i.addToRenderList(e),t.batchSprite(e,e.frame,i,n);};},function(t,e,i){var n=i(1),s=i(1),n=i(1069),s=i(1070);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e){t.exports=function(t,e,i,n){i.addToRenderList(e),this.pipeline.batchSprite(e,i,n);};},function(t,e){t.exports=function(t,e,i,n){i.addToRenderList(e),t.batchSprite(e,e.frame,i,n);};},function(t,e,i){var n=i(1),s=i(1),n=i(1072),s=i(1073);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e){t.exports=function(t,e,i){var n=e.list,s=n.length;if(0!==s){e.depthSort(),t.pipelines.preBatch(e);var r=-1!==e.blendMode;r||t.setBlendMode(0);for(var o=e.alpha,a=0;a<s;a++){var h,u,l,c,d,f,p=n[a];p.willRender(i)&&(c=void 0!==p.alphaTopLeft?(h=p.alphaTopLeft,u=p.alphaTopRight,l=p.alphaBottomLeft,p.alphaBottomRight):l=u=h=p.alpha,r||p.blendMode===t.currentBlendMode||t.setBlendMode(p.blendMode),(d=p.mask)&&d.preRenderWebGL(t,p,i),(f=p.type)!==t.currentType&&(t.newType=!0,t.currentType=f),t.nextTypeMatch=a<s-1&&n[a+1].type===t.currentType,p.setAlpha(h*o,u*o,l*o,c*o),p.renderWebGL(t,p,i),p.setAlpha(h,u,l,c),d&&d.postRenderWebGL(t,i),t.newType=!1);}t.pipelines.postBatch(e);}};},function(t,e){t.exports=function(t,e,i){var n=e.list;if(0!==n.length){e.depthSort();var s=-1!==e.blendMode;s||t.setBlendMode(0);var r=e._alpha;e.mask&&e.mask.preRenderCanvas(t,null,i);for(var o=0;o<n.length;o++){var a,h=n[o];h.willRender(i)&&(a=h.alpha,s||h.blendMode===t.currentBlendMode||t.setBlendMode(h.blendMode),h.setAlpha(a*r),h.renderCanvas(t,h,i),h.setAlpha(a));}e.mask&&e.mask.postRenderCanvas(t);}};},function(t,e,i){t.exports={EmitterOp:i(449),GravityWell:i(450),Particle:i(451),ParticleEmitter:i(452),ParticleEmitterManager:i(220),Zones:i(1078)};},function(t,e,i){var n=i(1),s=i(1),n=i(1076),s=i(1077);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var n=i(25),N=i(12),Y=new n(),X=new n(),U=new n(),z=new n();t.exports=function(t,e,i,n){var s=e.emitters.list,r=s.length;if(0!==r){var o=t.pipelines.set(e.pipeline),a=Y,h=X,u=U,l=z;n?(l.loadIdentity(),l.multiply(n),l.translate(e.x,e.y),l.rotate(e.rotation),l.scale(e.scaleX,e.scaleY)):l.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY);var c=i.roundPixels,d=e.defaultFrame.glTexture,f=N.getTintAppendFloatAlpha,p=o.setGameObject(e,e.defaultFrame);t.pipelines.preBatch(e);for(var g=0;g<r;g++){var v=s[g],m=v.alive,y=m.length;if(v.visible&&0!==y){i.addToRenderList(v);var x=v.scrollFactorX,T=v.scrollFactorY;t.setBlendMode(v.blendMode),v.mask&&(v.mask.preRenderWebGL(t,v,i),t.pipelines.set(e.pipeline));for(var w=0;w<y;w++){var E,b,S,A,_,C,R,M,P,O,L,D,F,k,I=m[w],B=I.alpha*i.alpha;B<=0||(u.applyITRS(I.x,I.y,I.rotation,I.scaleX,I.scaleY),a.copyFrom(i.matrix),a.multiplyWithOffset(l,-i.scrollX*x,-i.scrollY*T),u.e=I.x,u.f=I.y,a.multiply(u,h),b=-(E=I.frame).halfWidth,S=-E.halfHeight,A=b+E.width,_=S+E.height,C=h.getXRound(b,S,c),R=h.getYRound(b,S,c),M=h.getXRound(b,_,c),P=h.getYRound(b,_,c),O=h.getXRound(A,_,c),L=h.getYRound(A,_,c),D=h.getXRound(A,S,c),F=h.getYRound(A,S,c),k=f(I.tint,B),o.batchQuad(v,C,R,M,P,O,L,D,F,E.u0,E.v0,E.u1,E.v1,k,k,k,k,0,d,p));}v.mask&&v.mask.postRenderWebGL(t,i);}}t.pipelines.postBatch(e);}};},function(t,e,i){var n=i(25),A=new n(),_=new n(),C=new n(),R=new n();t.exports=function(t,e,i,n){var s=e.emitters.list,r=s.length;if(0!==r){var o=A.copyFrom(i.matrix),a=_,h=C,u=R;n?(u.loadIdentity(),u.multiply(n),u.translate(e.x,e.y),u.rotate(e.rotation),u.scale(e.scaleX,e.scaleY)):u.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY);for(var l=t.currentContext,c=i.roundPixels,d=0;d<r;d++){var f=s[d],p=f.alive,g=p.length;if(f.visible&&0!==g){i.addToRenderList(f);var v=f.scrollFactorX,m=f.scrollFactorY;l.save(),l.globalCompositeOperation=t.blendModes[f.blendMode];for(var y=0;y<g;y++){var x,T,w,E,b=p[y],S=b.alpha*i.alpha;S<=0||(h.applyITRS(b.x,b.y,b.rotation,b.scaleX,b.scaleY),o.copyFrom(i.matrix),o.multiplyWithOffset(u,-i.scrollX*v,-i.scrollY*m),h.e=b.x,h.f=b.y,o.multiply(h,a),T=(x=b.frame).canvasData,w=-x.halfWidth,E=-x.halfHeight,l.globalAlpha=S,l.save(),a.setToContext(l),c&&(w=Math.round(w),E=Math.round(E)),l.imageSmoothingEnabled=!(!t.antialias||x.source.scaleMode),l.drawImage(x.source.image,T.x,T.y,T.width,T.height,w,E,T.width,T.height),l.restore());}l.restore();}}}};},function(t,e,i){t.exports={DeathZone:i(453),EdgeZone:i(454),RandomZone:i(456)};},function(t,e,i){var n=i(1),s=i(1),n=i(1080),s=i(1081);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var c=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=i.alpha,r=e.renderTarget,o=r.width,a=r.height,h=c.getTintAppendFloatAlpha,u=t.pipelines.set(e.pipeline),l=u.setTexture2D(r.texture);t.pipelines.preBatch(e),u.batchTexture(e,r.texture,o,a,e.x,e.y,o,a,e.scaleX,e.scaleY,e.rotation,e.flipX,!e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,o,a,h(e.tintTopLeft,s*e._alphaTL),h(e.tintTopRight,s*e._alphaTR),h(e.tintBottomLeft,s*e._alphaBL),h(e.tintBottomRight,s*e._alphaBR),e.tintFill,0,0,i,n,!0,l),t.resetTextures(),t.pipelines.postBatch(e);};},function(t,e){t.exports=function(t,e,i,n){i.addToRenderList(e),t.batchSprite(e,e.frame,i,n);};},function(t,e,i){var n=i(1083),s=i(17)(!1,s={Parse:i(1084)},n);t.exports=s;},function(t,e){t.exports={TEXT_SET1:" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",TEXT_SET2:" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ",TEXT_SET3:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ",TEXT_SET4:"ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789",TEXT_SET5:"ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789",TEXT_SET6:"ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ",TEXT_SET7:"AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39",TEXT_SET8:"0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ",TEXT_SET9:"ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!",TEXT_SET10:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",TEXT_SET11:"ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789"};},function(t,e,i){var M=i(6);t.exports=function(t,e){var i=e.width,n=e.height,s=Math.floor(i/2),r=Math.floor(n/2),o=M(e,"chars","");if(""!==o){var a=M(e,"image",""),h=t.sys.textures.getFrame(a),u=h.cutX,l=h.cutY,c=h.source.width,d=h.source.height,f=M(e,"offset.x",0),p=M(e,"offset.y",0),g=M(e,"spacing.x",0),v=M(e,"spacing.y",0),m=M(e,"lineSpacing",0),y=M(e,"charsPerRow",null);null===y&&(y=c/i)>o.length&&(y=o.length);for(var x=f,T=p,w={retroFont:!0,font:a,size:i,lineHeight:n+m,chars:{}},E=0,b=0;b<o.length;b++){var S=o.charCodeAt(b),A=(u+x)/c,_=(l+T)/d,C=(u+x+i)/c,R=(l+T+n)/d;w.chars[S]={x:x,y:T,width:i,height:n,centerX:s,centerY:r,xOffset:0,yOffset:0,xAdvance:i,data:{},kerning:{},u0:A,v0:_,u1:C,v1:R},++E===y?(E=0,x=f,T+=n+v):x+=i+g;}return{data:w,frame:null,texture:a};}};},function(t,e,i){var n=i(1),s=i(1),n=i(1086),s=i(1087);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var R=i(19),M=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline,e),r=R(e,i,n).calc,o=e.vertices,a=e.uv,h=e.colors,u=e.alphas,l=e.alpha,c=M.getTintAppendFloatAlpha,d=i.roundPixels,f=o.length,p=Math.floor(.5*f);s.flush(),t.pipelines.preBatch(e);var g=s.setGameObject(e),v=s.vertexViewF32,m=s.vertexViewU32,y=s.vertexCount*s.currentShader.vertexComponentCount-1,x=0,T=e.tintFill;e.dirty&&e.updateVertices();for(var w=e.debugCallback,E=[],b=0;b<f;b+=2){var S=o[b+0],A=o[b+1],_=S*r.a+A*r.c+r.e,C=S*r.b+A*r.d+r.f;d&&(_=Math.round(_),C=Math.round(C)),v[++y]=_,v[++y]=C,v[++y]=a[b+0],v[++y]=a[b+1],v[++y]=g,v[++y]=T,m[++y]=c(h[x],i.alpha*(u[x]*l)),x++,w&&(E[b+0]=_,E[b+1]=C);}w&&w.call(e,e,f,E),s.vertexCount+=p,t.pipelines.postBatch(e);};},function(t,e){t.exports=function(){};},function(t,e,i){var n=i(1),s=i(1),n=i(1089),s=i(1090);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var l=i(12);t.exports=function(t,e,i,n){var s,r,o,a,h,u;0!==e.width&&0!==e.height&&(i.addToRenderList(e),r=(s=e.frame).width,o=s.height,a=l.getTintAppendFloatAlpha,u=(h=t.pipelines.set(e.pipeline,e)).setTexture2D(s.glTexture,e),t.pipelines.preBatch(e),h.batchTexture(e,s.glTexture,r,o,e.x,e.y,r/e.style.resolution,o/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,r,o,a(e.tintTopLeft,i.alpha*e._alphaTL),a(e.tintTopRight,i.alpha*e._alphaTR),a(e.tintBottomLeft,i.alpha*e._alphaBL),a(e.tintBottomRight,i.alpha*e._alphaBR),e.tintFill,0,0,i,n,!1,u),t.pipelines.postBatch(e));};},function(t,e){t.exports=function(t,e,i,n){0!==e.width&&0!==e.height&&(i.addToRenderList(e),t.batchSprite(e,e.frame,i,n));};},function(t,e,i){var n=i(1),s=i(1),n=i(1092),s=i(1093);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var u=i(12);t.exports=function(t,e,i,n){e.updateCanvas();var s,r,o,a=e.width,h=e.height;0!==a&&0!==h&&(i.addToRenderList(e),t.pipelines.preBatch(e),s=u.getTintAppendFloatAlpha,o=(r=t.pipelines.set(e.pipeline,e)).setTexture2D(e.fillPattern,e),r.batchTexture(e,e.fillPattern,e.displayFrame.width*e.tileScaleX,e.displayFrame.height*e.tileScaleY,e.x,e.y,a,h,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.originX*a,e.originY*h,0,0,a,h,s(e.tintTopLeft,i.alpha*e._alphaTL),s(e.tintTopRight,i.alpha*e._alphaTR),s(e.tintBottomLeft,i.alpha*e._alphaBL),s(e.tintBottomRight,i.alpha*e._alphaBR),e.tintFill,e.tilePositionX%e.displayFrame.width/e.displayFrame.width,e.tilePositionY%e.displayFrame.height/e.displayFrame.height,i,n,!1,o),t.pipelines.postBatch(e));};},function(t,e){t.exports=function(t,e,i,n){e.updateCanvas(),i.addToRenderList(e),t.batchSprite(e,e.frame,i,n);};},function(t,e,i){var n=i(1),s=i(1),n=i(1095),s=i(1096);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e){t.exports=function(t,e,i,n){e.videoTexture&&(i.addToRenderList(e),e.pipeline.batchSprite(e,i,n));};},function(t,e){t.exports=function(t,e,i,n){e.videoTexture&&(i.addToRenderList(e),t.batchSprite(e,e.frame,i,n));};},function(t,e,i){var n=i(1),s=i(1),n=i(1098),s=i(1099);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var l=i(19),c=i(114),d=i(81);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=l(e,i,n),o=s.calcMatrix.copyFrom(r.calc),a=e._displayOriginX,h=e._displayOriginY,u=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&c(s,o,e,u,a,h),e.isStroked&&d(s,e,u,a,h),t.pipelines.postBatch(e);};},function(t,e,i){var o=i(36),a=i(48),h=i(60),u=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r=t.currentContext;u(t,r,e,i,n)&&(s=e.radius,r.beginPath(),r.arc(s-e.originX*(2*s),s-e.originY*(2*s),s,o(e._startAngle),o(e._endAngle),e.anticlockwise),e.closePath&&r.closePath(),e.isFilled&&(a(r,e),r.fill()),e.isStroked&&(h(r,e),r.stroke()),r.restore());};},function(t,e,i){var n=i(1),s=i(1),n=i(1101),s=i(1102);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var l=i(114),c=i(19),d=i(81);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=c(e,i,n),o=s.calcMatrix.copyFrom(r.calc),a=e._displayOriginX+e._curveBounds.x,h=e._displayOriginY+e._curveBounds.y,u=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&l(s,o,e,u,a,h),e.isStroked&&d(s,e,u,a,h),t.pipelines.postBatch(e);};},function(t,e,i){var p=i(48),g=i(60),v=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.currentContext;if(v(t,s,e,i,n)){var r=e._displayOriginX+e._curveBounds.x,o=e._displayOriginY+e._curveBounds.y,a=e.pathData,h=a.length-1,u=a[0]-r,l=a[1]-o;s.beginPath(),s.moveTo(u,l),e.closePath||(h-=2);for(var c=2;c<h;c+=2){var d=a[c]-r,f=a[c+1]-o;s.lineTo(d,f);}e.closePath&&s.closePath(),e.isFilled&&(p(s,e),s.fill()),e.isStroked&&(g(s,e),s.stroke()),s.restore();}};},function(t,e,i){var n=i(1),s=i(1),n=i(1104),s=i(1105);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var l=i(114),c=i(19),d=i(81);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=c(e,i,n),o=s.calcMatrix.copyFrom(r.calc),a=e._displayOriginX,h=e._displayOriginY,u=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&l(s,o,e,u,a,h),e.isStroked&&d(s,e,u,a,h),t.pipelines.postBatch(e);};},function(t,e,i){var p=i(48),g=i(60),v=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.currentContext;if(v(t,s,e,i,n)){var r=e._displayOriginX,o=e._displayOriginY,a=e.pathData,h=a.length-1,u=a[0]-r,l=a[1]-o;s.beginPath(),s.moveTo(u,l),e.closePath||(h-=2);for(var c=2;c<h;c+=2){var d=a[c]-r,f=a[c+1]-o;s.lineTo(d,f);}s.closePath(),e.isFilled&&(p(s,e),s.fill()),e.isStroked&&(g(s,e),s.stroke()),s.restore();}};},function(t,e,i){var n=i(1),s=i(1),n=i(1107),s=i(1108);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var O=i(19),L=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=O(e,i,n);s.calcMatrix.copyFrom(r.calc).translate(-e._displayOriginX,-e._displayOriginY);var o,a,h=i.alpha*e.alpha,u=e.width,l=e.height,c=e.cellWidth,d=e.cellHeight,f=Math.ceil(u/c),p=Math.ceil(l/d),g=c,v=d,m=c-(f*c-u),y=d-(p*d-l),x=e.showCells,T=e.showAltCells,w=e.showOutline,E=0,b=0,S=0,A=0,_=0;if(w&&(g--,v--,m===c&&m--,y===d&&y--),t.pipelines.preBatch(e),x&&0<e.fillAlpha)for(o=s.fillTint,a=L.getTintAppendFloatAlpha(e.fillColor,e.fillAlpha*h),o.TL=a,o.TR=a,o.BL=a,o.BR=a,b=0;b<p;b++)for(T&&(S=b%2),E=0;E<f;E++)T&&S?S=0:(S++,A=E<f-1?g:m,_=b<p-1?v:y,s.batchFillRect(E*c,b*d,A,_));if(T&&0<e.altFillAlpha)for(o=s.fillTint,a=L.getTintAppendFloatAlpha(e.altFillColor,e.altFillAlpha*h),o.TL=a,o.TR=a,o.BL=a,o.BR=a,b=0;b<p;b++)for(T&&(S=b%2),E=0;E<f;E++)!T||S?(S=0,A=E<f-1?g:m,_=b<p-1?v:y,s.batchFillRect(E*c,b*d,A,_)):S=1;if(w&&0<e.outlineFillAlpha){var C=s.strokeTint,R=L.getTintAppendFloatAlpha(e.outlineFillColor,e.outlineFillAlpha*h);for(C.TL=R,C.TR=R,C.BL=R,C.BR=R,E=1;E<f;E++){var M=E*c;s.batchLine(M,0,M,l,1,1,1,0,!1);}for(b=1;b<p;b++){var P=b*d;s.batchLine(0,P,u,P,1,1,1,0,!1);}}t.pipelines.postBatch(e);};},function(t,e,i){var R=i(48),M=i(60),P=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.currentContext;if(P(t,s,e,i,n)){var r=-e._displayOriginX,o=-e._displayOriginY,a=i.alpha*e.alpha,h=e.width,u=e.height,l=e.cellWidth,c=e.cellHeight,d=Math.ceil(h/l),f=Math.ceil(u/c),p=l,g=c,v=l-(d*l-h),m=c-(f*c-u),y=e.showCells,x=e.showAltCells,T=e.showOutline,w=0,E=0,b=0,S=0,A=0;if(T&&(p--,g--,v===l&&v--,m===c&&m--),y&&0<e.fillAlpha)for(R(s,e),E=0;E<f;E++)for(x&&(b=E%2),w=0;w<d;w++)x&&b?b=0:(b++,S=w<d-1?p:v,A=E<f-1?g:m,s.fillRect(r+w*l,o+E*c,S,A));if(x&&0<e.altFillAlpha)for(R(s,e,e.altFillColor,e.altFillAlpha*a),E=0;E<f;E++)for(x&&(b=E%2),w=0;w<d;w++)!x||b?(b=0,S=w<d-1?p:v,A=E<f-1?g:m,s.fillRect(r+w*l,o+E*c,S,A)):b=1;if(T&&0<e.outlineFillAlpha){for(M(s,e,e.outlineFillColor,e.outlineFillAlpha*a),w=1;w<d;w++){var _=w*l;s.beginPath(),s.moveTo(_+r,o),s.lineTo(_+r,u+o),s.stroke();}for(E=1;E<f;E++){var C=E*c;s.beginPath(),s.moveTo(r,C+o),s.lineTo(r+h,C+o),s.stroke();}}s.restore();}};},function(t,e,i){var n=i(1),s=i(1),n=i(1110),s=i(1111);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var w=i(19),E=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r,o,a,h,u,l,c,d,f=t.pipelines.set(e.pipeline),p=w(e,i,n),g=f.calcMatrix.copyFrom(p.calc),v=e.width,m=e.height,y=v/2,x=v/e.projection,T=i.alpha*e.alpha;e.isFilled&&(t.pipelines.preBatch(e),e.showTop&&(s=E.getTintAppendFloatAlpha(e.fillTop,T),r=g.getX(-y,-m),o=g.getY(-y,-m),a=g.getX(0,-x-m),h=g.getY(0,-x-m),u=g.getX(y,-m),l=g.getY(y,-m),c=g.getX(0,x-m),d=g.getY(0,x-m),f.batchQuad(e,r,o,a,h,u,l,c,d,0,0,1,1,s,s,s,s,2)),e.showLeft&&(s=E.getTintAppendFloatAlpha(e.fillLeft,T),r=g.getX(-y,0),o=g.getY(-y,0),a=g.getX(0,x),h=g.getY(0,x),u=g.getX(0,x-m),l=g.getY(0,x-m),c=g.getX(-y,-m),d=g.getY(-y,-m),f.batchQuad(e,r,o,a,h,u,l,c,d,0,0,1,1,s,s,s,s,2)),e.showRight&&(s=E.getTintAppendFloatAlpha(e.fillRight,T),r=g.getX(y,0),o=g.getY(y,0),a=g.getX(0,x),h=g.getY(0,x),u=g.getX(0,x-m),l=g.getY(0,x-m),c=g.getX(y,-m),d=g.getY(y,-m),f.batchQuad(e,r,o,a,h,u,l,c,d,0,0,1,1,s,s,s,s,2)),t.pipelines.postBatch(e));};},function(t,e,i){var u=i(48),l=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r,o,a,h=t.currentContext;l(t,h,e,i,n)&&e.isFilled&&(s=e.width,r=e.height,o=s/2,a=s/e.projection,e.showTop&&(u(h,e,e.fillTop),h.beginPath(),h.moveTo(-o,-r),h.lineTo(0,-a-r),h.lineTo(o,-r),h.lineTo(o,-1),h.lineTo(0,a-1),h.lineTo(-o,-1),h.lineTo(-o,-r),h.fill()),e.showLeft&&(u(h,e,e.fillLeft),h.beginPath(),h.moveTo(-o,0),h.lineTo(0,a),h.lineTo(0,a-r),h.lineTo(-o,-r),h.lineTo(-o,0),h.fill()),e.showRight&&(u(h,e,e.fillRight),h.beginPath(),h.moveTo(o,0),h.lineTo(0,a),h.lineTo(0,a-r),h.lineTo(o,-r),h.lineTo(o,0),h.fill()),h.restore());};},function(t,e,i){var n=i(1),s=i(1),n=i(1113),s=i(1114);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var E=i(19),b=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r,o,a,h,u,l,c,d,f=t.pipelines.set(e.pipeline),p=E(e,i,n),g=f.calcMatrix.copyFrom(p.calc),v=e.width,m=e.height,y=v/2,x=v/e.projection,T=e.isReversed,w=i.alpha*e.alpha;e.isFilled&&(t.pipelines.preBatch(e),e.showTop&&T&&(s=b.getTintAppendFloatAlpha(e.fillTop,w),r=g.getX(-y,-m),o=g.getY(-y,-m),a=g.getX(0,-x-m),h=g.getY(0,-x-m),u=g.getX(y,-m),l=g.getY(y,-m),c=g.getX(0,x-m),d=g.getY(0,x-m),f.batchQuad(e,r,o,a,h,u,l,c,d,0,0,1,1,s,s,s,s,2)),e.showLeft&&(s=b.getTintAppendFloatAlpha(e.fillLeft,w),l=(u=(h=(a=(o=T?(r=g.getX(-y,-m),g.getY(-y,-m)):(r=g.getX(-y,0),g.getY(-y,0)),g.getX(0,x)),g.getY(0,x)),g.getX(0,x-m)),g.getY(0,x-m)),f.batchTri(e,r,o,a,h,u,l,0,0,1,1,s,s,s,2)),e.showRight&&(s=b.getTintAppendFloatAlpha(e.fillRight,w),l=(u=(h=(a=(o=T?(r=g.getX(y,-m),g.getY(y,-m)):(r=g.getX(y,0),g.getY(y,0)),g.getX(0,x)),g.getY(0,x)),g.getX(0,x-m)),g.getY(0,x-m)),f.batchTri(e,r,o,a,h,u,l,0,0,1,1,s,s,s,2)),t.pipelines.postBatch(e));};},function(t,e,i){var l=i(48),c=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r,o,a,h,u=t.currentContext;c(t,u,e,i,n)&&e.isFilled&&(s=e.width,r=e.height,o=s/2,a=s/e.projection,h=e.isReversed,e.showTop&&h&&(l(u,e,e.fillTop),u.beginPath(),u.moveTo(-o,-r),u.lineTo(0,-a-r),u.lineTo(o,-r),u.lineTo(0,a-r),u.fill()),e.showLeft&&(l(u,e,e.fillLeft),u.beginPath(),h?u.moveTo(-o,-r):u.moveTo(-o,0),u.lineTo(0,a),u.lineTo(0,a-r),u.fill()),e.showRight&&(l(u,e,e.fillRight),u.beginPath(),h?u.moveTo(o,-r):u.moveTo(o,0),u.lineTo(0,a),u.lineTo(0,a-r),u.fill()),u.restore());};},function(t,e,i){var n=i(1),s=i(1),n=i(1116),s=i(1117);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var f=i(19),p=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=f(e,i,n);s.calcMatrix.copyFrom(r.calc);var o,a,h,u,l=e._displayOriginX,c=e._displayOriginY,d=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isStroked&&(o=s.strokeTint,a=p.getTintAppendFloatAlpha(e.strokeColor,e.strokeAlpha*d),o.TL=a,o.TR=a,o.BL=a,o.BR=a,h=e._startWidth,u=e._endWidth,s.batchLine(e.geom.x1-l,e.geom.y1-c,e.geom.x2-l,e.geom.y2-c,h,u,1,0,!1,r.sprite,r.camera)),t.pipelines.postBatch(e);};},function(t,e,i){var a=i(60),h=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r,o=t.currentContext;h(t,o,e,i,n)&&(s=e._displayOriginX,r=e._displayOriginY,e.isStroked&&(a(o,e),o.beginPath(),o.moveTo(e.geom.x1-s,e.geom.y1-r),o.lineTo(e.geom.x2-s,e.geom.y2-r),o.stroke()),o.restore());};},function(t,e,i){var n=i(1),s=i(1),n=i(1119),s=i(1120);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var l=i(114),c=i(19),d=i(81);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=c(e,i,n),o=s.calcMatrix.copyFrom(r.calc),a=e._displayOriginX,h=e._displayOriginY,u=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&l(s,o,e,u,a,h),e.isStroked&&d(s,e,u,a,h),t.pipelines.postBatch(e);};},function(t,e,i){var p=i(48),g=i(60),v=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.currentContext;if(v(t,s,e,i,n)){var r=e._displayOriginX,o=e._displayOriginY,a=e.pathData,h=a.length-1,u=a[0]-r,l=a[1]-o;s.beginPath(),s.moveTo(u,l),e.closePath||(h-=2);for(var c=2;c<h;c+=2){var d=a[c]-r,f=a[c+1]-o;s.lineTo(d,f);}s.closePath(),e.isFilled&&(p(s,e),s.fill()),e.isStroked&&(g(s,e),s.stroke()),s.restore();}};},function(t,e,i){var n=i(1),s=i(1),n=i(1122),s=i(1123);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var c=i(19),d=i(81),f=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=c(e,i,n);s.calcMatrix.copyFrom(r.calc);var o,a,h=e._displayOriginX,u=e._displayOriginY,l=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&(o=s.fillTint,a=f.getTintAppendFloatAlpha(e.fillColor,e.fillAlpha*l),o.TL=a,o.TR=a,o.BL=a,o.BR=a,s.batchFillRect(-h,-u,e.width,e.height)),e.isStroked&&d(s,e,l,h,u),t.pipelines.postBatch(e);};},function(t,e,i){var a=i(48),h=i(60),u=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r,o=t.currentContext;u(t,o,e,i,n)&&(s=e._displayOriginX,r=e._displayOriginY,e.isFilled&&(a(o,e),o.fillRect(-s,-r,e.width,e.height)),e.isStroked&&(h(o,e),o.beginPath(),o.rect(-s,-r,e.width,e.height),o.stroke()),o.restore());};},function(t,e,i){var n=i(1),s=i(1),n=i(1125),s=i(1126);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var l=i(114),c=i(19),d=i(81);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=c(e,i,n),o=s.calcMatrix.copyFrom(r.calc),a=e._displayOriginX,h=e._displayOriginY,u=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&l(s,o,e,u,a,h),e.isStroked&&d(s,e,u,a,h),t.pipelines.postBatch(e);};},function(t,e,i){var p=i(48),g=i(60),v=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.currentContext;if(v(t,s,e,i,n)){var r=e._displayOriginX,o=e._displayOriginY,a=e.pathData,h=a.length-1,u=a[0]-r,l=a[1]-o;s.beginPath(),s.moveTo(u,l),e.closePath||(h-=2);for(var c=2;c<h;c+=2){var d=a[c]-r,f=a[c+1]-o;s.lineTo(d,f);}s.closePath(),e.isFilled&&(p(s,e),s.fill()),e.isStroked&&(g(s,e),s.stroke()),s.restore();}};},function(t,e,i){var n=i(1),s=i(1),n=i(1128),s=i(1129);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var m=i(19),y=i(81),x=i(12);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=m(e,i,n);s.calcMatrix.copyFrom(r.calc);var o,a,h,u,l,c,d,f,p=e._displayOriginX,g=e._displayOriginY,v=i.alpha*e.alpha;t.pipelines.preBatch(e),e.isFilled&&(o=s.fillTint,a=x.getTintAppendFloatAlpha(e.fillColor,e.fillAlpha*v),o.TL=a,o.TR=a,o.BL=a,o.BR=a,h=e.geom.x1-p,u=e.geom.y1-g,l=e.geom.x2-p,c=e.geom.y2-g,d=e.geom.x3-p,f=e.geom.y3-g,s.batchFillTriangle(h,u,l,c,d,f,r.sprite,r.camera)),e.isStroked&&y(s,e,v,p,g),t.pipelines.postBatch(e);};},function(t,e,i){var f=i(48),p=i(60),g=i(30);t.exports=function(t,e,i,n){i.addToRenderList(e);var s,r,o,a,h,u,l,c,d=t.currentContext;g(t,d,e,i,n)&&(s=e._displayOriginX,r=e._displayOriginY,o=e.geom.x1-s,a=e.geom.y1-r,h=e.geom.x2-s,u=e.geom.y2-r,l=e.geom.x3-s,c=e.geom.y3-r,d.beginPath(),d.moveTo(o,a),d.lineTo(h,u),d.lineTo(l,c),d.closePath(),e.isFilled&&(f(d,e),d.fill()),e.isStroked&&(p(d,e),d.stroke()),d.restore());};},function(t,e,i){var s=i(213);i(5).register("blitter",function(t,e,i,n){return this.displayList.add(new s(this.scene,t,e,i,n));});},function(t,e,i){var n=i(214);i(5).register("container",function(t,e,i){return this.displayList.add(new n(this.scene,t,e,i));});},function(t,e,i){var o=i(442);i(5).register("dom",function(t,e,i,n,s){var r=new o(this.scene,t,e,i,n,s);return this.displayList.add(r),r;});},function(t,e,i){var r=i(215);i(5).register("dynamicBitmapText",function(t,e,i,n,s){return this.displayList.add(new r(this.scene,t,e,i,n,s));});},function(t,e,i){var n=i(444);i(5).register("extern",function(){var t=new n(this.scene);return this.displayList.add(t),t;});},function(t,e,i){var n=i(216);i(5).register("graphics",function(t){return this.displayList.add(new n(this.scene,t));});},function(t,e,i){var n=i(113);i(5).register("group",function(t,e){return this.updateList.add(new n(this.scene,t,e));});},function(t,e,i){var s=i(125);i(5).register("image",function(t,e,i,n){return this.displayList.add(new s(this.scene,t,e,i,n));});},function(t,e,i){var n=i(219);i(5).register("layer",function(t){return this.displayList.add(new n(this.scene,t));});},function(t,e,i){var n=i(5),s=i(220);n.register("particles",function(t,e,i){return this.displayList.add(new s(this.scene,t,e,i));});},function(t,e,i){var n=i(5),o=i(457);n.register("follower",function(t,e,i,n,s){var r=new o(this.scene,t,e,i,n,s);return this.displayList.add(r),this.updateList.add(r),r;});},function(t,e,i){var n=i(5),o=i(221);n.register("renderTexture",function(t,e,i,n,s,r){return this.displayList.add(new o(this.scene,t,e,i,n,s,r));});},function(t,e,i){var h=i(223);i(5).register("rope",function(t,e,i,n,s,r,o,a){return this.displayList.add(new h(this.scene,t,e,i,n,s,r,o,a));});},function(t,e,i){var n=i(5),r=i(73);n.register("sprite",function(t,e,i,n){var s=new r(this.scene,t,e,i,n);return this.displayList.add(s),s;});},function(t,e,i){var o=i(148);i(5).register("bitmapText",function(t,e,i,n,s,r){return this.displayList.add(new o(this.scene,t,e,i,n,s,r));});},function(t,e,i){var s=i(224);i(5).register("text",function(t,e,i,n){return this.displayList.add(new s(this.scene,t,e,i,n));});},function(t,e,i){var o=i(225);i(5).register("tileSprite",function(t,e,i,n,s,r){return this.displayList.add(new o(this.scene,t,e,i,n,s,r));});},function(t,e,i){var s=i(129);i(5).register("zone",function(t,e,i,n){return this.displayList.add(new s(this.scene,t,e,i,n));});},function(t,e,i){var n=i(226);i(5).register("video",function(t,e,i){return this.displayList.add(new n(this.scene,t,e,i));});},function(t,e,i){var h=i(461),n=i(5);n.register("arc",function(t,e,i,n,s,r,o,a){return this.displayList.add(new h(this.scene,t,e,i,n,s,r,o,a));}),n.register("circle",function(t,e,i,n,s){return this.displayList.add(new h(this.scene,t,e,i,0,360,!1,n,s));});},function(t,e,i){var n=i(5),r=i(462);n.register("curve",function(t,e,i,n,s){return this.displayList.add(new r(this.scene,t,e,i,n,s));});},function(t,e,i){var o=i(463);i(5).register("ellipse",function(t,e,i,n,s,r){return this.displayList.add(new o(this.scene,t,e,i,n,s,r));});},function(t,e,i){var n=i(5),l=i(464);n.register("grid",function(t,e,i,n,s,r,o,a,h,u){return this.displayList.add(new l(this.scene,t,e,i,n,s,r,o,a,h,u));});},function(t,e,i){var n=i(5),a=i(465);n.register("isobox",function(t,e,i,n,s,r,o){return this.displayList.add(new a(this.scene,t,e,i,n,s,r,o));});},function(t,e,i){var n=i(5),h=i(466);n.register("isotriangle",function(t,e,i,n,s,r,o,a){return this.displayList.add(new h(this.scene,t,e,i,n,s,r,o,a));});},function(t,e,i){var n=i(5),h=i(467);n.register("line",function(t,e,i,n,s,r,o,a){return this.displayList.add(new h(this.scene,t,e,i,n,s,r,o,a));});},function(t,e,i){var n=i(5),r=i(468);n.register("polygon",function(t,e,i,n,s){return this.displayList.add(new r(this.scene,t,e,i,n,s));});},function(t,e,i){var n=i(5),o=i(473);n.register("rectangle",function(t,e,i,n,s,r){return this.displayList.add(new o(this.scene,t,e,i,n,s,r));});},function(t,e,i){var a=i(474);i(5).register("star",function(t,e,i,n,s,r,o){return this.displayList.add(new a(this.scene,t,e,i,n,s,r,o));});},function(t,e,i){var n=i(5),l=i(475);n.register("triangle",function(t,e,i,n,s,r,o,a,h,u){return this.displayList.add(new l(this.scene,t,e,i,n,s,r,o,a,h,u));});},function(t,e,i){var r=i(213),o=i(28),n=i(16),a=i(13);n.register("blitter",function(t,e){void 0===t&&(t={});var i=a(t,"key",null),n=a(t,"frame",null),s=new r(this.scene,0,0,i,n);return void 0!==e&&(t.add=e),o(this.scene,s,t),s;});},function(t,e,i){var o=i(28),a=i(214),n=i(16),h=i(13);n.register("container",function(t,e){void 0===t&&(t={});var i=h(t,"x",0),n=h(t,"y",0),s=h(t,"children",null),r=new a(this.scene,i,n,s);return void 0!==e&&(t.add=e),o(this.scene,r,t),r;});},function(t,e,i){var o=i(215),a=i(28),n=i(16),h=i(13);n.register("dynamicBitmapText",function(t,e){void 0===t&&(t={});var i=h(t,"font",""),n=h(t,"text",""),s=h(t,"size",!1),r=new o(this.scene,0,0,i,n,s);return void 0!==e&&(t.add=e),a(this.scene,r,t),r;});},function(t,e,i){var n=i(16),s=i(216);n.register("graphics",function(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var i=new s(this.scene,t);return t.add&&this.scene.sys.displayList.add(i),i;});},function(t,e,i){var n=i(16),s=i(113);n.register("group",function(t){return new s(this.scene,null,t);});},function(t,e,i){var r=i(28),n=i(16),o=i(13),a=i(125);n.register("image",function(t,e){void 0===t&&(t={});var i=o(t,"key",null),n=o(t,"frame",null),s=new a(this.scene,0,0,i,n);return void 0!==e&&(t.add=e),r(this.scene,s,t),s;});},function(t,e,i){var s=i(28),r=i(219),n=i(16),o=i(13);n.register("layer",function(t,e){void 0===t&&(t={});var i=o(t,"children",null),n=new r(this.scene,i);return void 0!==e&&(t.add=e),s(this.scene,n,t),n;});},function(t,e,i){var n=i(16),o=i(13),a=i(2),h=i(220);n.register("particles",function(t,e){void 0===t&&(t={});var i=o(t,"key",null),n=o(t,"frame",null),s=a(t,"emitters",null),r=new h(this.scene,i,n,s);return void 0!==e&&(t.add=e),a(t,"add",!1)?this.displayList.add(r):this.updateList.add(r),r;});},function(t,e,i){var u=i(28),n=i(16),l=i(13),c=i(221);n.register("renderTexture",function(t,e){void 0===t&&(t={});var i=l(t,"x",0),n=l(t,"y",0),s=l(t,"width",32),r=l(t,"height",32),o=l(t,"key",void 0),a=l(t,"frame",void 0),h=new c(this.scene,i,n,s,r,o,a);return void 0!==e&&(t.add=e),u(this.scene,h,t),h;});},function(t,e,i){var u=i(28),n=i(16),l=i(13),c=i(6),d=i(223);n.register("rope",function(t,e){void 0===t&&(t={});var i=l(t,"key",null),n=l(t,"frame",null),s=l(t,"horizontal",!0),r=c(t,"points",void 0),o=c(t,"colors",void 0),a=c(t,"alphas",void 0),h=new d(this.scene,0,0,i,n,r,s,o,a);return void 0!==e&&(t.add=e),u(this.scene,h,t),t.add||this.updateList.add(h),h;});},function(t,e,i){var r=i(28),o=i(439),n=i(16),a=i(13),h=i(73);n.register("sprite",function(t,e){void 0===t&&(t={});var i=a(t,"key",null),n=a(t,"frame",null),s=new h(this.scene,0,0,i,n);return void 0!==e&&(t.add=e),r(this.scene,s,t),o(s,t),s;});},function(t,e,i){var a=i(148),h=i(28),n=i(16),u=i(13),l=i(6);n.register("bitmapText",function(t,e){void 0===t&&(t={});var i=l(t,"font",""),n=u(t,"text",""),s=u(t,"size",!1),r=l(t,"align",0),o=new a(this.scene,0,0,i,n,s,r);return void 0!==e&&(t.add=e),h(this.scene,o,t),o;});},function(t,e,i){var o=i(28),n=i(16),a=i(13),h=i(224);n.register("text",function(t,e){void 0===t&&(t={});var i=a(t,"text",""),n=a(t,"style",null),s=a(t,"padding",null);null!==s&&(n.padding=s);var r=new h(this.scene,0,0,i,n);return void 0!==e&&(t.add=e),o(this.scene,r,t),r.autoRound=a(t,"autoRound",!0),r.resolution=a(t,"resolution",1),r;});},function(t,e,i){var u=i(28),n=i(16),l=i(13),c=i(225);n.register("tileSprite",function(t,e){void 0===t&&(t={});var i=l(t,"x",0),n=l(t,"y",0),s=l(t,"width",512),r=l(t,"height",512),o=l(t,"key",""),a=l(t,"frame",""),h=new c(this.scene,i,n,s,r,o,a);return void 0!==e&&(t.add=e),u(this.scene,h,t),h;});},function(t,e,i){var n=i(16),r=i(13),o=i(129);n.register("zone",function(t){var e=r(t,"x",0),i=r(t,"y",0),n=r(t,"width",1),s=r(t,"height",n);return new o(this.scene,e,i,n,s);});},function(t,e,i){var s=i(28),n=i(16),r=i(13),o=i(226);n.register("video",function(t,e){void 0===t&&(t={});var i=r(t,"key",null),n=new o(this.scene,0,0,i);return void 0!==e&&(t.add=e),s(this.scene,n,t),t.add||this.updateList.add(n),n;});},function(t,e,i){var n=i(1),s=i(1),n=i(1177),s=i(1178);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var r=i(19);t.exports=function(t,e,i,n){var s;e.shader&&(i.addToRenderList(e),t.pipelines.clear(),e.renderToTexture?e.load():(s=r(e,i,n).calc,t.width===e._rendererWidth&&t.height===e._rendererHeight||e.projOrtho(0,t.width,t.height,0),e.load(s.matrix)),e.flush(),t.pipelines.rebind());};},function(t,e){t.exports=function(){};},function(t,e,i){var n=i(1),s=i(1),n=i(1180),s=i(1181);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var R=i(19);t.exports=function(t,e,i,n){var s=e.faces,r=s.length;if(0!==r){i.addToRenderList(e);var o=t.pipelines.set(e.pipeline,e),a=R(e,i,n).calc,h=o.setGameObject(e),u=o.vertexViewF32,l=o.vertexViewU32,c=o.vertexCount*o.currentShader.vertexComponentCount-1,d=e.tintFill,f=[],p=e.debugCallback,g=a.a,v=a.b,m=a.c,y=a.d,x=a.e,T=a.f,w=e.viewPosition.z,E=e.hideCCW,b=i.roundPixels,S=i.alpha*e.alpha,A=0;t.pipelines.preBatch(e);for(var _=0;_<r;_++){var C=s[_];C.isInView(i,E,w,S,g,v,m,y,x,T,b)&&(o.shouldFlush(3)&&(o.flush(),c=0),c=C.load(u,l,c,h,d),A++,o.vertexCount+=3,p&&f.push(C));}e.totalFrame+=A,p&&p.call(e,e,f),t.pipelines.postBatch(e);}};},function(t,e){t.exports=function(){};},function(t,e,i){var n=i(1),s=i(1),n=i(1183);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var E=i(19);t.exports=function(t,e,i,n){i.addToRenderList(e);var s=t.pipelines.set(e.pipeline),r=E(e,i,n).calc,o=e.width,a=e.height,h=-e._radius,u=-e._radius,l=h+o,c=u+a,d=r.getX(0,0),f=r.getY(0,0),p=r.getX(h,u),g=r.getY(h,u),v=r.getX(h,c),m=r.getY(h,c),y=r.getX(l,c),x=r.getY(l,c),T=r.getX(l,u),w=r.getY(l,u);t.pipelines.preBatch(e),s.batchPointLight(e,i,p,g,v,m,y,x,T,w,d,f),t.pipelines.postBatch(e);};},function(t,e,i){var a=i(229);i(5).register("shader",function(t,e,i,n,s,r,o){return this.displayList.add(new a(this.scene,t,e,i,n,s,r,o));});},function(t,e,i){var c=i(230);i(5).register("mesh",function(t,e,i,n,s,r,o,a,h,u,l){return this.displayList.add(new c(this.scene,t,e,i,n,s,r,o,a,h,u,l));});},function(t,e,i){var n=i(5),o=i(150);n.register("pointlight",function(t,e,i,n,s,r){return this.displayList.add(new o(this.scene,t,e,i,n,s,r));});},function(t,e,i){var h=i(28),n=i(16),u=i(13),l=i(229);n.register("shader",function(t,e){void 0===t&&(t={});var i=u(t,"key",null),n=u(t,"x",0),s=u(t,"y",0),r=u(t,"width",128),o=u(t,"height",128),a=new l(this.scene,i,n,s,r,o);return void 0!==e&&(t.add=e),h(this.scene,a,t),a;});},function(t,e,i){var d=i(28),n=i(16),f=i(13),p=i(6),g=i(230);n.register("mesh",function(t,e){void 0===t&&(t={});var i=f(t,"key",null),n=f(t,"frame",null),s=p(t,"vertices",[]),r=p(t,"uvs",[]),o=p(t,"indicies",[]),a=p(t,"containsZ",!1),h=p(t,"normals",[]),u=p(t,"colors",16777215),l=p(t,"alphas",1),c=new g(this.scene,0,0,i,n,s,r,o,a,h,u,l);return void 0!==e&&(t.add=e),d(this.scene,c,t),c;});},function(t,e,i){var a=i(28),n=i(16),h=i(13),u=i(150);n.register("pointlight",function(t,e){void 0===t&&(t={});var i=h(t,"color",16777215),n=h(t,"radius",128),s=h(t,"intensity",1),r=h(t,"attenuation",.1),o=new u(this.scene,0,0,i,n,s,r);return void 0!==e&&(t.add=e),a(this.scene,o,t),o;});},function(t,e,i){var n=i(0),s=i(482),r=i(24),o=i(20),a=new n({Extends:s,initialize:function(t){this.scene=t,this.systems=t.sys,t.sys.settings.isBooted||t.sys.events.once(o.BOOT,this.boot,this),s.call(this);},boot:function(){var t=this.systems.events;t.on(o.SHUTDOWN,this.shutdown,this),t.on(o.DESTROY,this.destroy,this);},destroy:function(){this.shutdown(),this.scene=void 0,this.systems=void 0;}});r.register("LightsPlugin",a,"lights"),t.exports=a;},function(t,e,i){var n=i(65);n.Area=i(1192),n.Circumference=i(302),n.CircumferencePoint=i(169),n.Clone=i(1193),n.Contains=i(66),n.ContainsPoint=i(1194),n.ContainsRect=i(1195),n.CopyFrom=i(1196),n.Equals=i(1197),n.GetBounds=i(1198),n.GetPoint=i(300),n.GetPoints=i(301),n.Offset=i(1199),n.OffsetPoint=i(1200),n.Random=i(170),t.exports=n;},function(t,e){t.exports=function(t){return 0<t.radius?Math.PI*t.radius*t.radius:0;};},function(t,e,i){var n=i(65);t.exports=function(t){return new n(t.x,t.y,t.radius);};},function(t,e,i){var n=i(66);t.exports=function(t,e){return n(t,e.x,e.y);};},function(t,e,i){var n=i(66);t.exports=function(t,e){return n(t,e.x,e.y)&&n(t,e.right,e.y)&&n(t,e.x,e.bottom)&&n(t,e.right,e.bottom);};},function(t,e){t.exports=function(t,e){return e.setTo(t.x,t.y,t.radius);};},function(t,e){t.exports=function(t,e){return t.x===e.x&&t.y===e.y&&t.radius===e.radius;};},function(t,e,i){var n=i(10);t.exports=function(t,e){return void 0===e&&(e=new n()),e.x=t.left,e.y=t.top,e.width=t.diameter,e.height=t.diameter,e;};},function(t,e){t.exports=function(t,e,i){return t.x+=e,t.y+=i,t;};},function(t,e){t.exports=function(t,e){return t.x+=e.x,t.y+=e.y,t;};},function(t,e,i){var n=i(111);n.Area=i(1202),n.Circumference=i(447),n.CircumferencePoint=i(218),n.Clone=i(1203),n.Contains=i(112),n.ContainsPoint=i(1204),n.ContainsRect=i(1205),n.CopyFrom=i(1206),n.Equals=i(1207),n.GetBounds=i(1208),n.GetPoint=i(445),n.GetPoints=i(446),n.Offset=i(1209),n.OffsetPoint=i(1210),n.Random=i(180),t.exports=n;},function(t,e){t.exports=function(t){return t.isEmpty()?0:t.getMajorRadius()*t.getMinorRadius()*Math.PI;};},function(t,e,i){var n=i(111);t.exports=function(t){return new n(t.x,t.y,t.width,t.height);};},function(t,e,i){var n=i(112);t.exports=function(t,e){return n(t,e.x,e.y);};},function(t,e,i){var n=i(112);t.exports=function(t,e){return n(t,e.x,e.y)&&n(t,e.right,e.y)&&n(t,e.x,e.bottom)&&n(t,e.right,e.bottom);};},function(t,e){t.exports=function(t,e){return e.setTo(t.x,t.y,t.width,t.height);};},function(t,e){t.exports=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height;};},function(t,e,i){var n=i(10);t.exports=function(t,e){return void 0===e&&(e=new n()),e.x=t.left,e.y=t.top,e.width=t.width,e.height=t.height,e;};},function(t,e){t.exports=function(t,e,i){return t.x+=e,t.y+=i,t;};},function(t,e){t.exports=function(t,e){return t.x+=e.x,t.y+=e.y,t;};},function(t,e,i){var g=i(4),v=i(231);t.exports=function(t,e,i){var n,s,r,o,a,h,u,l,c,d,f,p;return void 0===i&&(i=[]),v(t,e)&&(n=t.x,s=t.y,r=t.radius,o=e.x,a=e.y,h=e.radius,s===a?0===(p=(f=-2*a)*f-4*(d=1)*(o*o+(u=(h*h-r*r-o*o+n*n)/(2*(n-o)))*u-2*o*u+a*a-h*h))?i.push(new g(u,-f/(2*d))):0<p&&(i.push(new g(u,(-f+Math.sqrt(p))/(2*d))),i.push(new g(u,(-f-Math.sqrt(p))/(2*d)))):0===(p=(f=2*s*(l=(n-o)/(s-a))-2*(c=(h*h-r*r-o*o+n*n-a*a+s*s)/(2*(s-a)))*l-2*n)*f-4*(d=l*l+1)*(n*n+s*s+c*c-r*r-2*s*c))?(u=-f/(2*d),i.push(new g(u,c-u*l))):0<p&&(u=(-f+Math.sqrt(p))/(2*d),i.push(new g(u,c-u*l)),u=(-f-Math.sqrt(p))/(2*d),i.push(new g(u,c-u*l)))),i;};},function(t,e,i){var a=i(232),h=i(151);t.exports=function(t,e,i){var n,s,r,o;return void 0===i&&(i=[]),h(t,e)&&(n=e.getLineA(),s=e.getLineB(),r=e.getLineC(),o=e.getLineD(),a(n,t,i),a(s,t,i),a(r,t,i),a(o,t,i)),i;};},function(t,e,i){var h=i(140),u=i(487),l=new(i(47))();function c(t,e,i,n,s){var r=Math.cos(t),o=Math.sin(t);l.setTo(e,i,e+r,i+o);var a=u(l,n);a&&s.push(new h(a.x,a.y,t,a.w));}function d(t,e){return t.z-e.z;}t.exports=function(t,e,i){Array.isArray(i)||(i=[i]);for(var n=[],s=[],r=0;r<i.length;r++)for(var o=i[r].points,a=0;a<o.length;a++){var h=Math.atan2(o[a].y-e,o[a].x-t);-1===s.indexOf(h)&&(c(h,t,e,i,n),c(h-1e-5,t,e,i,n),c(h+1e-5,t,e,i,n),s.push(h));}return n.sort(d);};},function(t,e,i){var n=i(10),s=i(152);t.exports=function(t,e,i){return void 0===i&&(i=new n()),s(t,e)&&(i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.width=Math.min(t.right,e.right)-i.x,i.height=Math.min(t.bottom,e.bottom)-i.y),i;};},function(t,e,i){var a=i(234),h=i(152);t.exports=function(t,e,i){var n,s,r,o;return void 0===i&&(i=[]),h(t,e)&&(n=t.getLineA(),s=t.getLineB(),r=t.getLineC(),o=t.getLineD(),a(n,e,i),a(s,e,i),a(r,e,i),a(o,e,i)),i;};},function(t,e,i){var o=i(489),a=i(234);t.exports=function(t,e,i){var n,s,r;return void 0===i&&(i=[]),o(t,e)&&(n=e.getLineA(),s=e.getLineB(),r=e.getLineC(),a(n,t,i),a(s,t,i),a(r,t,i)),i;};},function(t,e,i){var o=i(232),a=i(491);t.exports=function(t,e,i){var n,s,r;return void 0===i&&(i=[]),a(t,e)&&(n=t.getLineA(),s=t.getLineB(),r=t.getLineC(),o(n,e,i),o(s,e,i),o(r,e,i)),i;};},function(t,e,i){var o=i(494),a=i(492);t.exports=function(t,e,i){var n,s,r;return void 0===i&&(i=[]),o(t,e)&&(n=e.getLineA(),s=e.getLineB(),r=e.getLineC(),a(t,n,i),a(t,s,i),a(t,r,i)),i;};},function(t,e,i){var o=i(496);t.exports=function(t,e){if(!o(t,e))return!1;var i=Math.min(e.x1,e.x2),n=Math.max(e.x1,e.x2),s=Math.min(e.y1,e.y2),r=Math.max(e.y1,e.y2);return t.x>=i&&t.x<=n&&t.y>=s&&t.y<=r;};},function(t,e){t.exports=function(t,e,i,n,s,r){return void 0===r&&(r=0),!(e>t.right+r||i<t.left-r||n>t.bottom+r||s<t.top-r);};},function(t,e,i){var n=i(47);n.Angle=i(97),n.BresenhamPoints=i(317),n.CenterOn=i(1222),n.Clone=i(1223),n.CopyFrom=i(1224),n.Equals=i(1225),n.Extend=i(1226),n.GetEasedPoints=i(1227),n.GetMidPoint=i(1228),n.GetNearestPoint=i(1229),n.GetNormal=i(1230),n.GetPoint=i(307),n.GetPoints=i(172),n.GetShortestDistance=i(1231),n.Height=i(1232),n.Length=i(67),n.NormalAngle=i(497),n.NormalX=i(1233),n.NormalY=i(1234),n.Offset=i(1235),n.PerpSlope=i(1236),n.Random=i(173),n.ReflectAngle=i(1237),n.Rotate=i(1238),n.RotateAroundPoint=i(1239),n.RotateAroundXY=i(236),n.SetToAngle=i(1240),n.Slope=i(1241),n.Width=i(1242),t.exports=n;},function(t,e){t.exports=function(t,e,i){var n=e-(t.x1+t.x2)/2,s=i-(t.y1+t.y2)/2;return t.x1+=n,t.y1+=s,t.x2+=n,t.y2+=s,t;};},function(t,e,i){var n=i(47);t.exports=function(t){return new n(t.x1,t.y1,t.x2,t.y2);};},function(t,e){t.exports=function(t,e){return e.setTo(t.x1,t.y1,t.x2,t.y2);};},function(t,e){t.exports=function(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2;};},function(t,e,i){var o=i(67);t.exports=function(t,e,i){void 0===i&&(i=e);var n=o(t),s=t.x2-t.x1,r=t.y2-t.y1;return e&&(t.x1=t.x1-s/n*e,t.y1=t.y1-r/n*e),i&&(t.x2=t.x2+s/n*i,t.y2=t.y2+r/n*i),t;};},function(t,e,i){var y=i(352),x=i(80),T=i(4);t.exports=function(t,e,i,n,s){void 0===n&&(n=0),void 0===s&&(s=[]);var r,o=[],a=t.x1,h=t.y1,u=t.x2-a,l=t.y2-h,c=x(e,s),d=i-1;for(g=0;g<d;g++)r=c(g/d),o.push(new T(a+u*r,h+l*r));if(r=c(1),o.push(new T(a+u*r,h+l*r)),0<n){for(var f=o[0],p=[f],g=1;g<o.length-1;g++){var v=o[g];y(f,v)>=n&&(p.push(v),f=v);}var m=o[o.length-1];return y(f,m)<n&&p.pop(),p.push(m),p;}return o;};},function(t,e,i){var n=i(4);t.exports=function(t,e){return void 0===e&&(e=new n()),e.x=(t.x1+t.x2)/2,e.y=(t.y1+t.y2)/2,e;};},function(t,e,i){var u=i(4);t.exports=function(t,e,i){void 0===i&&(i=new u());var n=t.x1,s=t.y1,r=t.x2,o=t.y2,a=(r-n)*(r-n)+(o-s)*(o-s);if(0==a)return i;var h=((e.x-n)*(r-n)+(e.y-s)*(o-s))/a;return i.x=n+h*(r-n),i.y=s+h*(o-s),i;};},function(t,e,i){var n=i(14),s=i(97),r=i(4);t.exports=function(t,e){void 0===e&&(e=new r());var i=s(t)-n.TAU;return e.x=Math.cos(i),e.y=Math.sin(i),e;};},function(t,e){t.exports=function(t,e){var i=t.x1,n=t.y1,s=t.x2,r=t.y2,o=(s-i)*(s-i)+(r-n)*(r-n);if(0==o)return!1;var a=((n-e.y)*(s-i)-(i-e.x)*(r-n))/o;return Math.abs(a)*Math.sqrt(o);};},function(t,e){t.exports=function(t){return Math.abs(t.y1-t.y2);};},function(t,e,i){var n=i(14),s=i(97);t.exports=function(t){return Math.cos(s(t)-n.TAU);};},function(t,e,i){var n=i(14),s=i(97);t.exports=function(t){return Math.sin(s(t)-n.TAU);};},function(t,e){t.exports=function(t,e,i){return t.x1+=e,t.y1+=i,t.x2+=e,t.y2+=i,t;};},function(t,e){t.exports=function(t){return-((t.x2-t.x1)/(t.y2-t.y1));};},function(t,e,i){var n=i(97),s=i(497);t.exports=function(t,e){return 2*s(e)-Math.PI-n(t);};},function(t,e,i){var s=i(236);t.exports=function(t,e){var i=(t.x1+t.x2)/2,n=(t.y1+t.y2)/2;return s(t,i,n,e);};},function(t,e,i){var n=i(236);t.exports=function(t,e,i){return n(t,e.x,e.y,i);};},function(t,e){t.exports=function(t,e,i,n,s){return t.x1=e,t.y1=i,t.x2=e+Math.cos(n)*s,t.y2=i+Math.sin(n)*s,t;};},function(t,e){t.exports=function(t){return(t.y2-t.y1)/(t.x2-t.x1);};},function(t,e){t.exports=function(t){return Math.abs(t.x1-t.x2);};},function(t,e,i){var n={Face:i(116),GenerateGridVerts:i(1244),GenerateObjVerts:i(480),GenerateVerts:i(479),ParseObj:i(498),ParseObjMaterial:i(499),RotateFace:i(1245),Vertex:i(117)};t.exports=n;},function(t,e,i){var rt=i(116),ot=i(2),n=i(69),s=i(39),at=i(117),ht=new s(),ut=new s(),lt=new n();t.exports=function(t){var e=ot(t,"mesh"),i=ot(t,"texture",null),n=ot(t,"frame"),s=ot(t,"width",1),r=ot(t,"height",s),o=ot(t,"widthSegments",1),a=ot(t,"heightSegments",o),h=ot(t,"x",0),u=ot(t,"y",0),l=ot(t,"z",0),c=ot(t,"rotateX",0),d=ot(t,"rotateY",0),f=ot(t,"rotateZ",0),p=ot(t,"zIsUp",!0),g=ot(t,"isOrtho",!!e&&e.dirtyCache[11]),v=ot(t,"colors",[16777215]),m=ot(t,"alphas",[1]),y=ot(t,"tile",!1),x=ot(t,"flipY",!1),T=ot(t,"width",null),w={faces:[],verts:[]};if(ht.set(h,u,l),ut.set(c,d,f),lt.fromRotationXYTranslation(ut,ht,p),!i&&e)i=e.texture;else{if(!e||"string"!=typeof i)return w;i=e.scene.sys.textures.get(i);}var E=i.get(n);!T&&g&&i&&e&&(s=E.width/e.height,r=E.height/e.height);var b=s/2,S=r/2,A=Math.floor(o),_=Math.floor(a),C=A+1,R=_+1,M=s/A,P=r/_,O=[],L=[],D=0,F=1,k=0,I=1;E&&(D=E.u0,F=E.u1,I=x?(k=E.v1,E.v0):(k=E.v0,E.v1));for(var B=F-D,N=I-k,Y=0;Y<R;Y++)for(var X=Y*P-S,U=0;U<C;U++){var z=U*M-b;L.push(z,-X);var G=D+U/A*B,W=k+Y/_*N;O.push(G,W);}Array.isArray(v)||(v=[v]),Array.isArray(m)||(m=[m]);var V=0,H=0;for(Y=0;Y<_;Y++)for(U=0;U<A;U++){var j=2*(U+C*Y),K=2*(U+C*(Y+1)),Z=2*(U+1+C*(Y+1)),q=2*(U+1+C*Y),J=v[H],Q=m[V],$=new at(L[j],L[1+j],0,O[j],O[1+j],J,Q).transformMat4(lt),tt=new at(L[K],L[1+K],0,O[K],O[1+K],J,Q).transformMat4(lt),et=new at(L[q],L[1+q],0,O[q],O[1+q],J,Q).transformMat4(lt),it=new at(L[K],L[1+K],0,O[K],O[1+K],J,Q).transformMat4(lt),nt=new at(L[Z],L[1+Z],0,O[Z],O[1+Z],J,Q).transformMat4(lt),st=new at(L[q],L[1+q],0,O[q],O[1+q],J,Q).transformMat4(lt);y&&($.setUVs(D,I),tt.setUVs(D,k),et.setUVs(F,I),it.setUVs(D,k),nt.setUVs(F,k),st.setUVs(F,I)),++H===v.length&&(H=0),++V===m.length&&(V=0),w.verts.push($,tt,et,it,nt,st),w.faces.push(new rt($,tt,et),new rt(it,nt,st));}return e&&(e.faces=e.faces.concat(w.faces),e.vertices=e.vertices.concat(w.verts)),w;};},function(t,e){t.exports=function(t,e,i,n){var s,r,o;void 0===i&&void 0===n&&(r=(s=t.getInCenter()).x,o=s.y);var a=Math.cos(e),h=Math.sin(e),u=t.vertex1,l=t.vertex2,c=t.vertex3,d=u.x-r,f=u.y-o;u.set(d*a-f*h+r,d*h+f*a+o),d=l.x-r,f=l.y-o,l.set(d*a-f*h+r,d*h+f*a+o),d=c.x-r,f=c.y-o,c.set(d*a-f*h+r,d*h+f*a+o);};},function(t,e,i){var n=i(4);n.Ceil=i(1247),n.Clone=i(1248),n.CopyFrom=i(1249),n.Equals=i(1250),n.Floor=i(1251),n.GetCentroid=i(1252),n.GetMagnitude=i(500),n.GetMagnitudeSq=i(501),n.GetRectangleFromPoints=i(1253),n.Interpolate=i(1254),n.Invert=i(1255),n.Negative=i(1256),n.Project=i(1257),n.ProjectUnit=i(1258),n.SetMagnitude=i(1259),t.exports=n;},function(t,e){t.exports=function(t){return t.setTo(Math.ceil(t.x),Math.ceil(t.y));};},function(t,e,i){var n=i(4);t.exports=function(t){return new n(t.x,t.y);};},function(t,e){t.exports=function(t,e){return e.setTo(t.x,t.y);};},function(t,e){t.exports=function(t,e){return t.x===e.x&&t.y===e.y;};},function(t,e){t.exports=function(t){return t.setTo(Math.floor(t.x),Math.floor(t.y));};},function(t,e,i){var s=i(4);t.exports=function(t,e){if(void 0===e&&(e=new s()),!Array.isArray(t))throw new Error("GetCentroid points argument must be an array");var i=t.length;if(i<1)throw new Error("GetCentroid points array must not be empty");if(1===i)e.x=t[0].x,e.y=t[0].y;else{for(var n=0;n<i;n++)e.x+=t[n].x,e.y+=t[n].y;e.x/=i,e.y/=i;}return e;};},function(t,e,i){var h=i(10);t.exports=function(t,e){void 0===e&&(e=new h());for(var i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY,o=0;o<t.length;o++){var a=t[o];a.x>i&&(i=a.x),a.x<n&&(n=a.x),a.y>s&&(s=a.y),a.y<r&&(r=a.y);}return e.x=n,e.y=r,e.width=i-n,e.height=s-r,e;};},function(t,e,i){var s=i(4);t.exports=function(t,e,i,n){return void 0===i&&(i=0),void 0===n&&(n=new s()),n.x=t.x+(e.x-t.x)*i,n.y=t.y+(e.y-t.y)*i,n;};},function(t,e){t.exports=function(t){return t.setTo(t.y,t.x);};},function(t,e,i){var n=i(4);t.exports=function(t,e){return void 0===e&&(e=new n()),e.setTo(-t.x,-t.y);};},function(t,e,i){var s=i(4),r=i(501);t.exports=function(t,e,i){void 0===i&&(i=new s());var n=(t.x*e.x+t.y*e.y)/r(e);return 0!=n&&(i.x=n*e.x,i.y=n*e.y),i;};},function(t,e,i){var s=i(4);t.exports=function(t,e,i){void 0===i&&(i=new s());var n=t.x*e.x+t.y*e.y;return 0!=n&&(i.x=n*e.x,i.y=n*e.y),i;};},function(t,e,i){var n=i(500);t.exports=function(t,e){var i;return 0===t.x&&0===t.y||(i=n(t),t.x/=i,t.y/=i),t.x*=e,t.y*=e,t;};},function(t,e,i){var n=i(227);n.Clone=i(1261),n.Contains=i(228),n.ContainsPoint=i(1262),n.Earcut=i(59),n.GetAABB=i(469),n.GetNumberArray=i(1263),n.GetPoints=i(470),n.Perimeter=i(471),n.Reverse=i(1264),n.Simplify=i(1265),n.Smooth=i(472),n.Translate=i(1266),t.exports=n;},function(t,e,i){var n=i(227);t.exports=function(t){return new n(t.points);};},function(t,e,i){var n=i(228);t.exports=function(t,e){return n(t,e.x,e.y);};},function(t,e){t.exports=function(t,e){void 0===e&&(e=[]);for(var i=0;i<t.points.length;i++)e.push(t.points[i].x),e.push(t.points[i].y);return e;};},function(t,e){t.exports=function(t){return t.points.reverse(),t;};},function(t,e){function r(t,e){var i=t.length-1,n=[t[0]];return function t(e,i,n,s,r){for(var o,a,h,u,l,c,d,f,p,g=s,v=i+1;v<n;v++){var m=(a=e[v],h=e[i],u=e[n],p=f=d=c=l=void 0,c=h.x,d=h.y,f=u.x-c,p=u.y-d,0===f&&0===p||(1<(l=((a.x-c)*f+(a.y-d)*p)/(f*f+p*p))?(c=u.x,d=u.y):0<l&&(c+=f*l,d+=p*l)),(f=a.x-c)*f+(p=a.y-d)*p);g<m&&(o=v,g=m);}s<g&&(1<o-i&&t(e,i,o,s,r),r.push(e[o]),1<n-o&&t(e,o,n,s,r));}(t,0,i,e,n),n.push(t[i]),n;}t.exports=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=!1);var n,s=t.points;return 2<s.length&&(n=e*e,i||(s=function(t,e){for(var i,n,s,r,o,a=t[0],h=[a],u=1,l=t.length;u<l;u++)i=t[u],s=a,o=r=void 0,r=(n=i).x-s.x,o=n.y-s.y,e<r*r+o*o&&(h.push(i),a=i);return a!==i&&h.push(i),h;}(s,n)),t.setTo(r(s,n))),t;};},function(t,e){t.exports=function(t,e,i){for(var n=t.points,s=0;s<n.length;s++)n[s].x+=e,n[s].y+=i;return t;};},function(t,e){t.exports=function(t){return t.width*t.height;};},function(t,e){t.exports=function(t){return t.x=Math.ceil(t.x),t.y=Math.ceil(t.y),t;};},function(t,e){t.exports=function(t){return t.x=Math.ceil(t.x),t.y=Math.ceil(t.y),t.width=Math.ceil(t.width),t.height=Math.ceil(t.height),t;};},function(t,e,i){var n=i(10);t.exports=function(t){return new n(t.x,t.y,t.width,t.height);};},function(t,e,i){var n=i(57);t.exports=function(t,e){return n(t,e.x,e.y);};},function(t,e){t.exports=function(t,e){return e.setTo(t.x,t.y,t.width,t.height);};},function(t,e){t.exports=function(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height;};},function(t,e,i){var n=i(237);t.exports=function(t,e){var i=n(t);return i<n(e)?t.setSize(e.height*i,e.height):t.setSize(e.width,e.width/i),t.setPosition(e.centerX-t.width/2,e.centerY-t.height/2);};},function(t,e,i){var n=i(237);t.exports=function(t,e){var i=n(t);return i>n(e)?t.setSize(e.height*i,e.height):t.setSize(e.width,e.width/i),t.setPosition(e.centerX-t.width/2,e.centerY-t.height/2);};},function(t,e){t.exports=function(t){return t.x=Math.floor(t.x),t.y=Math.floor(t.y),t;};},function(t,e){t.exports=function(t){return t.x=Math.floor(t.x),t.y=Math.floor(t.y),t.width=Math.floor(t.width),t.height=Math.floor(t.height),t;};},function(t,e,i){var r=i(10);t.exports=function(t,e,i,n,s){return void 0===s&&(s=new r()),s.setTo(Math.min(t,i),Math.min(e,n),Math.abs(t-i),Math.abs(e-n));};},function(t,e,i){var n=i(4);t.exports=function(t,e){return void 0===e&&(e=new n()),e.x=t.centerX,e.y=t.centerY,e;};},function(t,e,i){var n=i(4);t.exports=function(t,e){return void 0===e&&(e=new n()),e.x=t.width,e.y=t.height,e;};},function(t,e,i){var r=i(190);t.exports=function(t,e,i){var n=t.centerX,s=t.centerY;return t.setSize(t.width+2*e,t.height+2*i),r(t,n,s);};},function(t,e,i){var n=i(10),s=i(152);t.exports=function(t,e,i){return void 0===i&&(i=new n()),s(t,e)?(i.x=Math.max(t.x,e.x),i.y=Math.max(t.y,e.y),i.width=Math.min(t.right,e.right)-i.x,i.height=Math.min(t.bottom,e.bottom)-i.y):i.setEmpty(),i;};},function(t,e){t.exports=function(t,e){for(var i=t.x,n=t.right,s=t.y,r=t.bottom,o=0;o<e.length;o++)i=Math.min(i,e[o].x),n=Math.max(n,e[o].x),s=Math.min(s,e[o].y),r=Math.max(r,e[o].y);return t.x=i,t.y=s,t.width=n-i,t.height=r-s,t;};},function(t,e){t.exports=function(t,e){var i=Math.min(t.x,e.x),n=Math.max(t.right,e.right);t.x=i,t.width=n-i;var s=Math.min(t.y,e.y),r=Math.max(t.bottom,e.bottom);return t.y=s,t.height=r-s,t;};},function(t,e){t.exports=function(t,e,i){var n=Math.min(t.x,e),s=Math.max(t.right,e);t.x=n,t.width=s-n;var r=Math.min(t.y,i),o=Math.max(t.bottom,i);return t.y=r,t.height=o-r,t;};},function(t,e){t.exports=function(t,e,i){return t.x+=e,t.y+=i,t;};},function(t,e){t.exports=function(t,e){return t.x+=e.x,t.y+=e.y,t;};},function(t,e){t.exports=function(t,e){return t.x<e.right&&t.right>e.x&&t.y<e.bottom&&t.bottom>e.y;};},function(t,e,i){var a=i(4),h=i(36);t.exports=function(t,e,i){void 0===i&&(i=new a()),e=h(e);var n=Math.sin(e),s=Math.cos(e),r=0<s?t.width/2:t.width/-2,o=0<n?t.height/2:t.height/-2;return Math.abs(r*n)<Math.abs(o*s)?o=r*n/s:r=o*s/n,i.x=r+t.centerX,i.y=o+t.centerY,i;};},function(t,e,i){var n=i(195),s=i(503),r=i(4);t.exports=function(t,e,i){if(void 0===i&&(i=new r()),s(t,e))switch(n(0,3)){case 0:i.x=t.x+Math.random()*(e.right-t.x),i.y=t.y+Math.random()*(e.top-t.y);break;case 1:i.x=e.x+Math.random()*(t.right-e.x),i.y=e.bottom+Math.random()*(t.bottom-e.bottom);break;case 2:i.x=t.x+Math.random()*(e.x-t.x),i.y=e.y+Math.random()*(t.bottom-e.y);break;case 3:i.x=e.right+Math.random()*(t.right-e.right),i.y=t.y+Math.random()*(e.bottom-t.y);}return i;};},function(t,e){t.exports=function(t,e){return t.width===e.width&&t.height===e.height;};},function(t,e){t.exports=function(t,e,i){return void 0===i&&(i=e),t.width*=e,t.height*=i,t;};},function(t,e,i){var n=i(82);n.Area=i(1294),n.BuildEquilateral=i(1295),n.BuildFromPolygon=i(1296),n.BuildRight=i(1297),n.CenterOn=i(1298),n.Centroid=i(504),n.CircumCenter=i(1299),n.CircumCircle=i(1300),n.Clone=i(1301),n.Contains=i(115),n.ContainsArray=i(235),n.ContainsPoint=i(1302),n.CopyFrom=i(1303),n.Decompose=i(495),n.Equals=i(1304),n.GetPoint=i(476),n.GetPoints=i(477),n.InCenter=i(506),n.Perimeter=i(1305),n.Offset=i(505),n.Random=i(181),n.Rotate=i(1306),n.RotateAroundPoint=i(1307),n.RotateAroundXY=i(238),t.exports=n;},function(t,e){t.exports=function(t){var e=t.x1,i=t.y1,n=t.x2,s=t.y2,r=t.x3,o=t.y3;return Math.abs(((r-e)*(s-i)-(n-e)*(o-i))/2);};},function(t,e,i){var s=i(82);t.exports=function(t,e,i){var n=i*(Math.sqrt(3)/2);return new s(t,e,t+i/2,e+n,t-i/2,e+n);};},function(t,e,i){var v=i(59),m=i(82);t.exports=function(t,e,i,n,s){void 0===e&&(e=null),void 0===i&&(i=1),void 0===n&&(n=1),void 0===s&&(s=[]);for(var r,o,a,h,u,l,c,d,f,p=v(t,e),g=0;g<p.length;g+=3)r=p[g],o=p[g+1],a=p[g+2],h=t[2*r]*i,u=t[2*r+1]*n,l=t[2*o]*i,c=t[2*o+1]*n,d=t[2*a]*i,f=t[2*a+1]*n,s.push(new m(h,u,l,c,d,f));return s;};},function(t,e,i){var s=i(82);t.exports=function(t,e,i,n){return void 0===n&&(n=i),new s(t,e,t,e-n,t+i,e);};},function(t,e,i){var a=i(504),h=i(505);t.exports=function(t,e,i,n){void 0===n&&(n=a);var s=n(t),r=e-s.x,o=i-s.y;return h(t,r,o);};},function(t,e,i){var c=i(3);t.exports=function(t,e){void 0===e&&(e=new c());var i=t.x3,n=t.y3,s=t.x1-i,r=t.y1-n,o=t.x2-i,a=t.y2-n,h=2*(s*a-r*o),u=r*(o*o+a*a)-(s*s+r*r)*a,l=s*(o*o+a*a)-(s*s+r*r)*o;return e.x=i-u/h,e.y=n+l/h,e;};},function(t,e,i){var x=i(65);t.exports=function(t,e){void 0===e&&(e=new x());var i,n,s,r,o=t.x1,a=t.y1,h=t.x2,u=t.y2,l=t.x3,c=t.y3,d=h-o,f=u-a,p=l-o,g=c-a,v=d*(o+h)+f*(a+u),m=p*(o+l)+g*(a+c),y=2*(d*(c-u)-f*(l-h));return Math.abs(y)<1e-6?(i=Math.min(o,h,l),n=Math.min(a,u,c),s=.5*(Math.max(o,h,l)-i),r=.5*(Math.max(a,u,c)-n),e.x=i+s,e.y=n+r):(e.x=(g*v-f*m)/y,e.y=(d*m-p*v)/y,s=e.x-o,r=e.y-a),e.radius=Math.sqrt(s*s+r*r),e;};},function(t,e,i){var n=i(82);t.exports=function(t){return new n(t.x1,t.y1,t.x2,t.y2,t.x3,t.y3);};},function(t,e,i){var n=i(115);t.exports=function(t,e){return n(t,e.x,e.y);};},function(t,e){t.exports=function(t,e){return e.setTo(t.x1,t.y1,t.x2,t.y2,t.x3,t.y3);};},function(t,e){t.exports=function(t,e){return t.x1===e.x1&&t.y1===e.y1&&t.x2===e.x2&&t.y2===e.y2&&t.x3===e.x3&&t.y3===e.y3;};},function(t,e,i){var s=i(67);t.exports=function(t){var e=t.getLineA(),i=t.getLineB(),n=t.getLineC();return s(e)+s(i)+s(n);};},function(t,e,i){var n=i(238),s=i(506);t.exports=function(t,e){var i=s(t);return n(t,i.x,i.y,e);};},function(t,e,i){var n=i(238);t.exports=function(t,e,i){return n(t,e.x,e.y,i);};},function(t,e,i){var n=i(203),s=i(17)(!1,s={CreatePixelPerfectHandler:i(507),CreateInteractiveObject:i(508),Events:i(51),Gamepad:i(1309),InputManager:i(409),InputPlugin:i(1321),InputPluginCache:i(153),Keyboard:i(1322),Mouse:i(1336),Pointer:i(412),Touch:i(1337)},n);t.exports=s;},function(t,e,i){t.exports={Axis:i(509),Button:i(510),Events:i(239),Gamepad:i(511),GamepadPlugin:i(1316),Configs:i(1317)};},function(t,e){t.exports="down";},function(t,e){t.exports="up";},function(t,e){t.exports="connected";},function(t,e){t.exports="disconnected";},function(t,e){t.exports="down";},function(t,e){t.exports="up";},function(t,e,i){var n=i(0),s=i(9),r=i(239),h=i(511),o=i(6),a=i(153),u=i(51),l=new n({Extends:s,initialize:function(t){s.call(this),this.scene=t.scene,this.settings=this.scene.sys.settings,this.sceneInputPlugin=t,this.enabled=!0,this.target,this.gamepads=[],this.queue=[],this.onGamepadHandler,this._pad1,this._pad2,this._pad3,this._pad4,t.pluginEvents.once(u.BOOT,this.boot,this),t.pluginEvents.on(u.START,this.start,this);},boot:function(){var t=this.scene.sys.game,e=this.settings.input,i=t.config;this.enabled=o(e,"gamepad",i.inputGamepad)&&t.device.input.gamepads,this.target=o(e,"gamepad.target",i.inputGamepadEventTarget),this.sceneInputPlugin.pluginEvents.once(u.DESTROY,this.destroy,this);},start:function(){this.enabled&&(this.startListeners(),this.refreshPads()),this.sceneInputPlugin.pluginEvents.once(u.SHUTDOWN,this.shutdown,this);},isActive:function(){return this.enabled&&this.scene.sys.isActive();},startListeners:function(){function t(t){!t.defaultPrevented&&e.isActive()&&(e.refreshPads(),e.queue.push(t));}var e=this,i=this.target;this.onGamepadHandler=t,i.addEventListener("gamepadconnected",t,!1),i.addEventListener("gamepaddisconnected",t,!1),this.sceneInputPlugin.pluginEvents.on(u.UPDATE,this.update,this);},stopListeners:function(){this.target.removeEventListener("gamepadconnected",this.onGamepadHandler),this.target.removeEventListener("gamepaddisconnected",this.onGamepadHandler),this.sceneInputPlugin.pluginEvents.off(u.UPDATE,this.update);for(var t=0;t<this.gamepads.length;t++)this.gamepads[t].removeAllListeners();},disconnectAll:function(){for(var t=0;t<this.gamepads.length;t++)this.gamepads[t].pad.connected=!1;},refreshPads:function(){var t=navigator.getGamepads();if(t)for(var e=this.gamepads,i=0;i<t.length;i++){var n,s,r,o,a=t[i];a&&(n=a.id,(r=e[s=a.index])?r.id!==n?(r.destroy(),e[s]=new h(this,a)):r.update(a):(o=new h(this,a),e[s]=o,this._pad1?this._pad2?this._pad3?this._pad4||(this._pad4=o):this._pad3=o:this._pad2=o:this._pad1=o));}else this.disconnectAll();},getAll:function(){for(var t=[],e=this.gamepads,i=0;i<e.length;i++)e[i]&&t.push(e[i]);return t;},getPad:function(t){for(var e=this.gamepads,i=0;i<e.length;i++)if(e[i]&&e[i].index===t)return e[i];},update:function(){if(this.enabled){this.refreshPads();var t=this.queue.length;if(0!==t)for(var e=this.queue.splice(0,t),i=0;i<t;i++){var n=e[i],s=this.getPad(n.gamepad.index);"gamepadconnected"===n.type?this.emit(r.CONNECTED,s,n):"gamepaddisconnected"===n.type&&this.emit(r.DISCONNECTED,s,n);}}},shutdown:function(){this.stopListeners(),this.removeAllListeners();},destroy:function(){this.shutdown();for(var t=0;t<this.gamepads.length;t++)this.gamepads[t]&&this.gamepads[t].destroy();this.gamepads=[],this.scene=null,this.settings=null,this.sceneInputPlugin=null,this.target=null;},total:{get:function(){return this.gamepads.length;}},pad1:{get:function(){return this._pad1;}},pad2:{get:function(){return this._pad2;}},pad3:{get:function(){return this._pad3;}},pad4:{get:function(){return this._pad4;}}});a.register("GamepadPlugin",l,"gamepad","gamepad","inputGamepad"),t.exports=l;},function(t,e,i){t.exports={DUALSHOCK_4:i(1318),SNES_USB:i(1319),XBOX_360:i(1320)};},function(t,e){t.exports={UP:12,DOWN:13,LEFT:14,RIGHT:15,SHARE:8,OPTIONS:9,PS:16,TOUCHBAR:17,X:0,CIRCLE:1,SQUARE:2,TRIANGLE:3,L1:4,R1:5,L2:6,R2:7,L3:10,R3:11,LEFT_STICK_H:0,LEFT_STICK_V:1,RIGHT_STICK_H:2,RIGHT_STICK_V:3};},function(t,e){t.exports={UP:12,DOWN:13,LEFT:14,RIGHT:15,SELECT:8,START:9,B:0,A:1,Y:2,X:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5};},function(t,e){t.exports={UP:12,DOWN:13,LEFT:14,RIGHT:15,MENU:16,A:0,B:1,X:2,Y:3,LB:4,RB:5,LT:6,RT:7,BACK:8,START:9,LS:10,RS:11,LEFT_STICK_H:0,LEFT_STICK_V:1,RIGHT_STICK_H:2,RIGHT_STICK_V:3};},function(t,e,i){var o=i(65),a=i(66),n=i(0),h=i(203),p=i(508),s=i(507),r=i(50),u=i(111),l=i(112),g=i(51),c=i(9),v=i(2),d=i(56),f=i(153),m=i(7),y=i(24),x=i(10),T=i(57),w=i(20),E=i(82),b=i(115),S=new n({Extends:c,initialize:function(t){c.call(this),this.scene=t,this.systems=t.sys,this.settings=t.sys.settings,this.manager=t.sys.game.input,this.pluginEvents=new c(),this.enabled=!0,this.displayList,this.cameras,f.install(this),this.mouse=this.manager.mouse,this.topOnly=!0,this.pollRate=-1,this._pollTimer=0;var e={cancelled:!1};this._eventContainer={stopPropagation:function(){e.cancelled=!0;}},this._eventData=e,this.dragDistanceThreshold=0,this.dragTimeThreshold=0,this._temp=[],this._tempZones=[],this._list=[],this._pendingInsertion=[],this._pendingRemoval=[],this._draggable=[],this._drag={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[]},this._dragState=[],this._over={0:[],1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[]},this._validTypes=["onDown","onUp","onOver","onOut","onMove","onDragStart","onDrag","onDragEnd","onDragEnter","onDragLeave","onDragOver","onDrop"],this._updatedThisFrame=!1,t.sys.events.once(w.BOOT,this.boot,this),t.sys.events.on(w.START,this.start,this);},boot:function(){this.cameras=this.systems.cameras,this.displayList=this.systems.displayList,this.systems.events.once(w.DESTROY,this.destroy,this),this.pluginEvents.emit(g.BOOT);},start:function(){var t=this.systems.events;t.on(w.TRANSITION_START,this.transitionIn,this),t.on(w.TRANSITION_OUT,this.transitionOut,this),t.on(w.TRANSITION_COMPLETE,this.transitionComplete,this),t.on(w.PRE_UPDATE,this.preUpdate,this),t.once(w.SHUTDOWN,this.shutdown,this),this.manager.events.on(g.GAME_OUT,this.onGameOut,this),this.manager.events.on(g.GAME_OVER,this.onGameOver,this),this.enabled=!0,this._dragState=[0,0,0,0,0,0,0,0,0,0],this.pluginEvents.emit(g.START);},onGameOver:function(t){this.isActive()&&this.emit(g.GAME_OVER,t.timeStamp,t);},onGameOut:function(t){this.isActive()&&this.emit(g.GAME_OUT,t.timeStamp,t);},preUpdate:function(){this.pluginEvents.emit(g.PRE_UPDATE);var t=this._pendingRemoval,e=this._pendingInsertion,i=t.length,n=e.length;if(0!==i||0!==n){for(var s=this._list,r=0;r<i;r++){var o=t[r],a=s.indexOf(o);-1<a&&(s.splice(a,1),this.clear(o,!0));}t.length=0,this._pendingRemoval.length=0,this._list=s.concat(e.splice(0));}},isActive:function(){return this.enabled&&this.scene.sys.isActive();},updatePoll:function(t,e){if(!this.isActive())return!1;if(this.pluginEvents.emit(g.UPDATE,t,e),this._updatedThisFrame)return this._updatedThisFrame=!1;for(var i=this.manager,n=i.pointers,s=i.pointersTotal,r=0;r<s;r++)n[r].updateMotion();if(0===this._list.length)return!1;var o=this.pollRate;if(-1===o)return!1;if(0<o){if(this._pollTimer-=e,!(this._pollTimer<0))return!1;this._pollTimer=this.pollRate;}var a=!1;for(r=0;r<s;r++){var h=0,u=n[r];this._tempZones=[],this._temp=this.hitTestPointer(u),this.sortGameObjects(this._temp,u),this.sortDropZones(this._tempZones),this.topOnly&&(this._temp.length&&this._temp.splice(1),this._tempZones.length&&this._tempZones.splice(1)),h+=this.processOverOutEvents(u),2===this.getDragState(u)&&this.processDragThresholdEvent(u,t),0<h&&(a=!0);}return a;},update:function(t,e){if(!this.isActive())return!1;for(var i=e.length,n=!1,s=0;s<i;s++){var r=0,o=e[s];switch(this._tempZones=[],this._temp=this.hitTestPointer(o),this.sortGameObjects(this._temp,o),this.sortDropZones(this._tempZones),this.topOnly&&(this._temp.length&&this._temp.splice(1),this._tempZones.length&&this._tempZones.splice(1)),t){case h.MOUSE_DOWN:r+=this.processDragDownEvent(o),r+=this.processDownEvents(o),r+=this.processOverOutEvents(o);break;case h.MOUSE_UP:r+=this.processDragUpEvent(o),r+=this.processUpEvents(o),r+=this.processOverOutEvents(o);break;case h.TOUCH_START:r+=this.processDragDownEvent(o),r+=this.processDownEvents(o),r+=this.processOverEvents(o);break;case h.TOUCH_END:case h.TOUCH_CANCEL:r+=this.processDragUpEvent(o),r+=this.processUpEvents(o),r+=this.processOutEvents(o);break;case h.MOUSE_MOVE:case h.TOUCH_MOVE:r+=this.processDragMoveEvent(o),r+=this.processMoveEvents(o),r+=this.processOverOutEvents(o);break;case h.MOUSE_WHEEL:r+=this.processWheelEvent(o);}0<r&&(n=!0);}return this._updatedThisFrame=!0,n;},clear:function(t,e){void 0===e&&(e=!1);var i=t.input;if(i){e||this.queueForRemoval(t),i.gameObject=void 0,i.target=void 0,i.hitArea=void 0,i.hitAreaCallback=void 0,i.callbackContext=void 0,t.input=null;var n=this._draggable.indexOf(t);return-1<n&&this._draggable.splice(n,1),-1<(n=this._drag[0].indexOf(t))&&this._drag[0].splice(n,1),-1<(n=this._over[0].indexOf(t))&&(this._over[0].splice(n,1),this.manager.resetCursor(i)),t;}},disable:function(t){t.input.enabled=!1;},enable:function(t,e,i,n){return void 0===n&&(n=!1),t.input?t.input.enabled=!0:this.setHitArea(t,e,i),t.input&&n&&!t.input.dropZone&&(t.input.dropZone=n),this;},hitTestPointer:function(t){for(var e=this.cameras.getCamerasBelowPointer(t),i=0;i<e.length;i++){for(var n=e[i],s=this.manager.hitTest(t,this._list,n),r=0;r<s.length;r++){var o=s[r];o.input.dropZone&&this._tempZones.push(o);}if(0<s.length)return t.camera=n,s;}return t.camera=e[0],[];},processDownEvents:function(t){for(var e=0,i=this._temp,n=this._eventData,s=this._eventContainer,r=n.cancelled=!1,o=0;o<i.length;o++){var a=i[o];if(a.input){if(e++,a.emit(g.GAMEOBJECT_POINTER_DOWN,t,a.input.localX,a.input.localY,s),n.cancelled||!a.input){r=!0;break;}if(this.emit(g.GAMEOBJECT_DOWN,t,a,s),n.cancelled||!a.input){r=!0;break;}}}return!r&&this.manager&&(t.downElement===this.manager.game.canvas?this.emit(g.POINTER_DOWN,t,i):this.emit(g.POINTER_DOWN_OUTSIDE,t)),e;},getDragState:function(t){return this._dragState[t.id];},setDragState:function(t,e){this._dragState[t.id]=e;},processDragThresholdEvent:function(t,e){var i=!1,n=this.dragTimeThreshold,s=this.dragDistanceThreshold;if((0<s&&r(t.x,t.y,t.downX,t.downY)>=s||0<n&&e>=t.downTime+n)&&(i=!0),i)return this.setDragState(t,3),this.processDragStartList(t);},processDragStartList:function(t){if(3!==this.getDragState(t))return 0;for(var e=this._drag[t.id],i=0;i<e.length;i++){var n=e[i],s=n.input;s.dragState=2,s.dragStartX=n.x,s.dragStartY=n.y,s.dragStartXGlobal=t.worldX,s.dragStartYGlobal=t.worldY,s.dragX=s.dragStartXGlobal-s.dragStartX,s.dragY=s.dragStartYGlobal-s.dragStartY,n.emit(g.GAMEOBJECT_DRAG_START,t,s.dragX,s.dragY),this.emit(g.DRAG_START,t,n);}return this.setDragState(t,4),e.length;},processDragDownEvent:function(t){var e=this._temp;if(0===this._draggable.length||0===e.length||!t.primaryDown||0!==this.getDragState(t))return 0;this.setDragState(t,1);for(var i=[],n=0;n<e.length;n++){var s=e[n];s.input.draggable&&0===s.input.dragState&&i.push(s);}return 0===i.length?(this.setDragState(t,0),0):(1<i.length&&(this.sortGameObjects(i,t),this.topOnly&&i.splice(1)),this._drag[t.id]=i,0===this.dragDistanceThreshold&&0===this.dragTimeThreshold?(this.setDragState(t,3),this.processDragStartList(t)):(this.setDragState(t,2),0));},processDragMoveEvent:function(t){if(2===this.getDragState(t)&&this.processDragThresholdEvent(t,this.manager.game.loop.now),4!==this.getDragState(t))return 0;for(var e=this._tempZones,i=this._drag[t.id],n=0;n<i.length;n++){var s,r,o,a,h,u,l,c,d=i[n],f=d.input,p=f.target;p?0===(s=e.indexOf(p))?(d.emit(g.GAMEOBJECT_DRAG_OVER,t,p),this.emit(g.DRAG_OVER,t,d,p)):0<s?(d.emit(g.GAMEOBJECT_DRAG_LEAVE,t,p),this.emit(g.DRAG_LEAVE,t,d,p),f.target=e[0],p=f.target,d.emit(g.GAMEOBJECT_DRAG_ENTER,t,p),this.emit(g.DRAG_ENTER,t,d,p)):(d.emit(g.GAMEOBJECT_DRAG_LEAVE,t,p),this.emit(g.DRAG_LEAVE,t,d,p),e[0]?(f.target=e[0],p=f.target,d.emit(g.GAMEOBJECT_DRAG_ENTER,t,p),this.emit(g.DRAG_ENTER,t,d,p)):f.target=null):!p&&e[0]&&(f.target=e[0],p=f.target,d.emit(g.GAMEOBJECT_DRAG_ENTER,t,p),this.emit(g.DRAG_ENTER,t,d,p)),o=d.parentContainer?(a=t.worldX-f.dragStartXGlobal,h=t.worldY-f.dragStartYGlobal,u=d.getParentRotation(),l=a*Math.cos(u)+h*Math.sin(u),c=h*Math.cos(u)-a*Math.sin(u),l*=1/d.parentContainer.scaleX,c*=1/d.parentContainer.scaleY,r=l+f.dragStartX,c+f.dragStartY):(r=t.worldX-f.dragX,t.worldY-f.dragY),d.emit(g.GAMEOBJECT_DRAG,t,r,o),this.emit(g.DRAG,t,d,r,o);}return i.length;},processDragUpEvent:function(t){for(var e=this._drag[t.id],i=0;i<e.length;i++){var n,s,r=e[i],o=r.input;o&&2===o.dragState&&(o.dragState=0,o.dragX=o.localX-r.displayOriginX,o.dragY=o.localY-r.displayOriginY,n=!1,(s=o.target)&&(r.emit(g.GAMEOBJECT_DROP,t,s),this.emit(g.DROP,t,r,s),n=!(o.target=null)),r.input&&(r.emit(g.GAMEOBJECT_DRAG_END,t,o.dragX,o.dragY,n),this.emit(g.DRAG_END,t,r,n)));}return this.setDragState(t,0),e.splice(0),0;},processMoveEvents:function(t){for(var e=0,i=this._temp,n=this._eventData,s=this._eventContainer,r=n.cancelled=!1,o=0;o<i.length;o++){var a=i[o];if(a.input){if(e++,a.emit(g.GAMEOBJECT_POINTER_MOVE,t,a.input.localX,a.input.localY,s),n.cancelled||!a.input){r=!0;break;}if(this.emit(g.GAMEOBJECT_MOVE,t,a,s),n.cancelled||!a.input){r=!0;break;}if(this.topOnly)break;}}return r||this.emit(g.POINTER_MOVE,t,i),e;},processWheelEvent:function(t){for(var e=0,i=this._temp,n=this._eventData,s=this._eventContainer,r=n.cancelled=!1,o=t.deltaX,a=t.deltaY,h=t.deltaZ,u=0;u<i.length;u++){var l=i[u];if(l.input){if(e++,l.emit(g.GAMEOBJECT_POINTER_WHEEL,t,o,a,h,s),n.cancelled||!l.input){r=!0;break;}if(this.emit(g.GAMEOBJECT_WHEEL,t,l,o,a,h,s),n.cancelled||!l.input){r=!0;break;}}}return r||this.emit(g.POINTER_WHEEL,t,i,o,a,h),e;},processOverEvents:function(t){var e=this._temp,i=0,n=e.length,s=[];if(0<n){for(var r=this.manager,o=this._eventData,a=this._eventContainer,h=o.cancelled=!1,u=0;u<n;u++){var l=e[u];if(l.input){if(s.push(l),r.setCursor(l.input),l.emit(g.GAMEOBJECT_POINTER_OVER,t,l.input.localX,l.input.localY,a),i++,o.cancelled||!l.input){h=!0;break;}if(this.emit(g.GAMEOBJECT_OVER,t,l,a),o.cancelled||!l.input){h=!0;break;}}}h||this.emit(g.POINTER_OVER,t,s);}return this._over[t.id]=s,i;},processOutEvents:function(t){var e=this._over[t.id],i=0,n=e.length;if(0<n){var s=this.manager,r=this._eventData,o=this._eventContainer,a=r.cancelled=!1;this.sortGameObjects(e,t);for(var h=0;h<n;h++){var u=e[h];if((u=e[h]).input){if(s.resetCursor(u.input),u.emit(g.GAMEOBJECT_POINTER_OUT,t,o),i++,r.cancelled||!u.input){a=!0;break;}if(this.emit(g.GAMEOBJECT_OUT,t,u,o),r.cancelled||!u.input){a=!0;break;}a||this.emit(g.POINTER_OUT,t,e);}}this._over[t.id]=[];}return i;},processOverOutEvents:function(t){for(var e,i=this._temp,n=[],s=[],r=[],o=this._over[t.id],a=this._drag[t.id],h=this.manager,u=0;u<o.length;u++)e=o[u],-1===i.indexOf(e)&&-1===a.indexOf(e)?n.push(e):r.push(e);for(u=0;u<i.length;u++)e=i[u],-1===o.indexOf(e)&&s.push(e);var l=n.length,c=0,d=this._eventData,f=this._eventContainer,p=d.cancelled=!1;if(0<l){for(this.sortGameObjects(n,t),u=0;u<l;u++)if((e=n[u]).input){if(h.resetCursor(e.input),e.emit(g.GAMEOBJECT_POINTER_OUT,t,f),c++,d.cancelled||!e.input){p=!0;break;}if(this.emit(g.GAMEOBJECT_OUT,t,e,f),d.cancelled||!e.input){p=!0;break;}}p||this.emit(g.POINTER_OUT,t,n);}if(l=s.length,p=d.cancelled=!1,0<l){for(this.sortGameObjects(s,t),u=0;u<l;u++)if((e=s[u]).input){if(h.setCursor(e.input),e.emit(g.GAMEOBJECT_POINTER_OVER,t,e.input.localX,e.input.localY,f),c++,d.cancelled||!e.input){p=!0;break;}if(this.emit(g.GAMEOBJECT_OVER,t,e,f),d.cancelled||!e.input){p=!0;break;}}p||this.emit(g.POINTER_OVER,t,s);}return o=r.concat(s),this._over[t.id]=this.sortGameObjects(o,t),c;},processUpEvents:function(t){for(var e=this._temp,i=this._eventData,n=this._eventContainer,s=i.cancelled=!1,r=0;r<e.length;r++){var o=e[r];if(o.input){if(o.emit(g.GAMEOBJECT_POINTER_UP,t,o.input.localX,o.input.localY,n),i.cancelled||!o.input){s=!0;break;}if(this.emit(g.GAMEOBJECT_UP,t,o,n),i.cancelled||!o.input){s=!0;break;}}}return!s&&this.manager&&(t.upElement===this.manager.game.canvas?this.emit(g.POINTER_UP,t,e):this.emit(g.POINTER_UP_OUTSIDE,t)),e.length;},queueForInsertion:function(t){return-1===this._pendingInsertion.indexOf(t)&&-1===this._list.indexOf(t)&&this._pendingInsertion.push(t),this;},queueForRemoval:function(t){return this._pendingRemoval.push(t),this;},setDraggable:function(t,e){void 0===e&&(e=!0),Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var n=t[i];n.input.draggable=e;var s=this._draggable.indexOf(n);e&&-1===s?this._draggable.push(n):!e&&-1<s&&this._draggable.splice(s,1);}return this;},makePixelPerfect:function(t){void 0===t&&(t=1);var e=this.systems.textures;return s(e,t);},setHitArea:function(t,e,i){if(void 0===e)return this.setHitAreaFromTexture(t);Array.isArray(t)||(t=[t]);var n,s,r=!1,o=!1,a=!1,h=!1,u=!1,l=!0;m(e)?(e=v(n=e,"hitArea",null),i=v(n,"hitAreaCallback",null),r=v(n,"draggable",!1),o=v(n,"dropZone",!1),a=v(n,"cursor",!1),h=v(n,"useHandCursor",!1),u=v(n,"pixelPerfect",!1),s=v(n,"alphaTolerance",1),u&&(e={},i=this.makePixelPerfect(s)),e&&i||(this.setHitAreaFromTexture(t),l=!1)):"function"!=typeof e||i||(i=e,e={});for(var c=0;c<t.length;c++){var d,f=t[c];u&&"Container"===f.type?console.warn("Cannot pixelPerfect test a Container. Use a custom callback."):((d=f.input?f.input:p(f,e,i)).customHitArea=l,d.dropZone=o,d.cursor=h?"pointer":a,f.input=d,r&&this.setDraggable(f),this.queueForInsertion(f));}return this;},setHitAreaCircle:function(t,e,i,n,s){void 0===s&&(s=a);var r=new o(e,i,n);return this.setHitArea(t,r,s);},setHitAreaEllipse:function(t,e,i,n,s,r){void 0===r&&(r=l);var o=new u(e,i,n,s);return this.setHitArea(t,o,r);},setHitAreaFromTexture:function(t,e){void 0===e&&(e=T),Array.isArray(t)||(t=[t]);for(var i=0;i<t.length;i++){var n=t[i],s=n.frame,r=0,o=0;n.width?(r=n.width,o=n.height):s&&(r=s.realWidth,o=s.realHeight),"Container"!==n.type||0!==r&&0!==o?0!==r&&0!==o&&(n.input=p(n,new x(0,0,r,o),e),this.queueForInsertion(n)):console.warn("Container.setInteractive must specify a Shape or call setSize() first");}return this;},setHitAreaRectangle:function(t,e,i,n,s,r){void 0===r&&(r=T);var o=new x(e,i,n,s);return this.setHitArea(t,o,r);},setHitAreaTriangle:function(t,e,i,n,s,r,o,a){void 0===a&&(a=b);var h=new E(e,i,n,s,r,o);return this.setHitArea(t,h,a);},enableDebug:function(o,a){void 0===a&&(a=65280);var t=o.input;if(!t||!t.hitArea)return this;var e=t.hitArea,i=e.type,h=t.hitAreaDebug,n=this.systems.add,s=this.systems.updateList;h&&(s.remove(h),h.destroy(),h=null);var u=0,l=0;switch(i){case d.CIRCLE:h=n.arc(0,0,e.radius),u=e.x-e.radius,l=e.y-e.radius;break;case d.ELLIPSE:h=n.ellipse(0,0,e.width,e.height),u=e.x-e.width/2,l=e.y-e.height/2;break;case d.LINE:h=n.line(0,0,e.x1,e.y1,e.x2,e.y2);break;case d.POLYGON:h=n.polygon(0,0,e.points);break;case d.RECTANGLE:h=n.rectangle(0,0,e.width,e.height),u=e.x,l=e.y;break;case d.TRIANGLE:h=n.triangle(0,0,e.x1,e.y1,e.x2,e.y2,e.x3,e.y3);}return h&&(h.isFilled=!1,h.preUpdate=function(){h.setStrokeStyle(1/o.scale,a),h.setDisplayOrigin(o.displayOriginX,o.displayOriginY);var t,e=o.x,i=o.y,n=o.rotation,s=o.scaleX,r=o.scaleY;o.parentContainer&&(e=(t=o.getWorldTransformMatrix()).tx,i=t.ty,n=t.rotation,s=t.scaleX,r=t.scaleY),h.setRotation(n),h.setScale(s,r),h.setPosition(e+u,i+l),h.setScrollFactor(o.scrollFactorX,o.scrollFactorY),h.setDepth(o.depth);},s.add(h),t.hitAreaDebug=h),this;},removeDebug:function(t){var e,i=t.input;return i&&i.hitAreaDebug&&(e=i.hitAreaDebug,this.systems.updateList.remove(e),e.destroy(),i.hitAreaDebug=null),this;},setPollAlways:function(){return this.setPollRate(0);},setPollOnMove:function(){return this.setPollRate(-1);},setPollRate:function(t){return this.pollRate=t,this._pollTimer=0,this;},setGlobalTopOnly:function(t){return this.manager.globalTopOnly=t,this;},setTopOnly:function(t){return this.topOnly=t,this;},sortGameObjects:function(t,e){if(t.length<2)return t;var i=e.camera.renderList;return t.sort(function(t,e){return i.indexOf(e)-i.indexOf(t);});},sortDropZones:function(t){return t.length<2?t:(this.scene.sys.depthSort(),t.sort(this.sortDropZoneHandler.bind(this)));},sortDropZoneHandler:function(t,e){if(t.parentContainer||e.parentContainer){if(t.parentContainer===e.parentContainer)return e.parentContainer.getIndex(e)-t.parentContainer.getIndex(t);if(t.parentContainer===e)return-1;if(e.parentContainer===t)return 1;for(var i=t.getIndexList(),n=e.getIndexList(),s=Math.min(i.length,n.length),r=0;r<s;r++){var o=i[r],a=n[r];if(o!==a)return a-o;}return n.length-i.length;}return this.displayList.getIndex(e)-this.displayList.getIndex(t);},stopPropagation:function(){return this.manager._tempSkip=!0,this;},addPointer:function(t){return this.manager.addPointer(t);},setDefaultCursor:function(t){return this.manager.setDefaultCursor(t),this;},transitionIn:function(){this.enabled=this.settings.transitionAllowInput;},transitionComplete:function(){this.settings.transitionAllowInput||(this.enabled=!0);},transitionOut:function(){this.enabled=this.settings.transitionAllowInput;},shutdown:function(){this.pluginEvents.emit(g.SHUTDOWN),this._temp.length=0,this._list.length=0,this._draggable.length=0,this._pendingRemoval.length=0,this._pendingInsertion.length=0;for(var t=this._dragState.length=0;t<10;t++)this._drag[t]=[],this._over[t]=[];this.removeAllListeners();var e=this.manager;e.canvas.style.cursor=e.defaultCursor;var i=this.systems.events;i.off(w.TRANSITION_START,this.transitionIn,this),i.off(w.TRANSITION_OUT,this.transitionOut,this),i.off(w.TRANSITION_COMPLETE,this.transitionComplete,this),i.off(w.PRE_UPDATE,this.preUpdate,this),e.events.off(g.GAME_OUT,this.onGameOut,this),e.events.off(g.GAME_OVER,this.onGameOver,this),i.off(w.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.pluginEvents.emit(g.DESTROY),this.pluginEvents.removeAllListeners(),this.scene.sys.events.off(w.START,this.start,this),this.scene=null,this.cameras=null,this.manager=null,this.events=null,this.mouse=null;},x:{get:function(){return this.manager.activePointer.x;}},y:{get:function(){return this.manager.activePointer.y;}},isOver:{get:function(){return this.manager.isOver;}},mousePointer:{get:function(){return this.manager.mousePointer;}},activePointer:{get:function(){return this.manager.activePointer;}},pointer1:{get:function(){return this.manager.pointers[1];}},pointer2:{get:function(){return this.manager.pointers[2];}},pointer3:{get:function(){return this.manager.pointers[3];}},pointer4:{get:function(){return this.manager.pointers[4];}},pointer5:{get:function(){return this.manager.pointers[5];}},pointer6:{get:function(){return this.manager.pointers[6];}},pointer7:{get:function(){return this.manager.pointers[7];}},pointer8:{get:function(){return this.manager.pointers[8];}},pointer9:{get:function(){return this.manager.pointers[9];}},pointer10:{get:function(){return this.manager.pointers[10];}}});y.register("InputPlugin",S,"input"),t.exports=S;},function(t,e,i){t.exports={Events:i(154),KeyboardManager:i(410),KeyboardPlugin:i(1330),Key:i(512),KeyCodes:i(143),KeyCombo:i(513),AdvanceKeyCombo:i(515),ProcessKeyCombo:i(514),ResetKeyCombo:i(516),JustDown:i(1332),JustUp:i(1333),DownDuration:i(1334),UpDuration:i(1335)};},function(t,e){t.exports="keydown";},function(t,e){t.exports="keyup";},function(t,e){t.exports="keycombomatch";},function(t,e){t.exports="down";},function(t,e){t.exports="keydown-";},function(t,e){t.exports="keyup-";},function(t,e){t.exports="up";},function(t,e,i){var n=i(0),s=i(9),h=i(154),r=i(22),o=i(6),a=i(51),u=i(153),l=i(512),c=i(143),d=i(513),f=i(1331),p=i(20),g=i(76),v=new n({Extends:s,initialize:function(t){s.call(this),this.game=t.systems.game,this.scene=t.scene,this.settings=this.scene.sys.settings,this.sceneInputPlugin=t,this.manager=t.manager.keyboard,this.enabled=!0,this.keys=[],this.combos=[],this.prevCode=null,this.prevTime=0,this.prevType=null,t.pluginEvents.once(a.BOOT,this.boot,this),t.pluginEvents.on(a.START,this.start,this);},boot:function(){var t=this.settings.input;this.enabled=o(t,"keyboard",!0);var e=o(t,"keyboard.capture",null);e&&this.addCaptures(e),this.sceneInputPlugin.pluginEvents.once(a.DESTROY,this.destroy,this);},start:function(){this.sceneInputPlugin.manager.events.on(a.MANAGER_PROCESS,this.update,this),this.sceneInputPlugin.pluginEvents.once(a.SHUTDOWN,this.shutdown,this),this.game.events.on(r.BLUR,this.resetKeys,this),this.scene.sys.events.on(p.PAUSE,this.resetKeys,this),this.scene.sys.events.on(p.SLEEP,this.resetKeys,this);},isActive:function(){return this.enabled&&this.scene.sys.isActive();},addCapture:function(t){return this.manager.addCapture(t),this;},removeCapture:function(t){return this.manager.removeCapture(t),this;},getCaptures:function(){return this.manager.captures;},enableGlobalCapture:function(){return this.manager.preventDefault=!0,this;},disableGlobalCapture:function(){return this.manager.preventDefault=!1,this;},clearCaptures:function(){return this.manager.clearCaptures(),this;},createCursorKeys:function(){return this.addKeys({up:c.UP,down:c.DOWN,left:c.LEFT,right:c.RIGHT,space:c.SPACE,shift:c.SHIFT});},addKeys:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1);var n={};if("string"==typeof t){t=t.split(",");for(var s=0;s<t.length;s++){var r=t[s].trim();r&&(n[r]=this.addKey(r,e,i));}}else for(var o in t)n[o]=this.addKey(t[o],e,i);return n;},addKey:function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1);var n=this.keys;if(t instanceof l){var s=n.indexOf(t);return-1<s?n[s]=t:n[t.keyCode]=t,e&&this.addCapture(t.keyCode),t.setEmitOnRepeat(i),t;}return"string"==typeof t&&(t=c[t.toUpperCase()]),n[t]||(n[t]=new l(this,t),e&&this.addCapture(t),n[t].setEmitOnRepeat(i)),n[t];},removeKey:function(t,e){void 0===e&&(e=!1);var i,n,s=this.keys;return t instanceof l?-1<(n=s.indexOf(t))&&(i=this.keys[n],this.keys[n]=void 0):"string"==typeof t&&(t=c[t.toUpperCase()]),s[t]&&(i=s[t],s[t]=void 0),i&&(i.plugin=null,e&&i.destroy()),this;},removeAllKeys:function(t){for(var e=this.keys,i=0;i<e.length;i++){var n=e[i];n&&(e[i]=void 0,t&&n.destroy());}return this;},createCombo:function(t,e){return new d(this,t,e);},checkDown:function(t,e){if(void 0===e&&(e=0),this.enabled&&t.isDown){var i=g(this.time-t.timeDown,e);if(i>t._tick)return t._tick=i,!0;}return!1;},update:function(){var t=this.manager.queue,e=t.length;if(this.isActive()&&0!==e)for(var i=this.keys,n=0;n<e;n++){var s=t[n],r=s.keyCode,o=i[r],a=!1;void 0===s.cancelled&&(s.cancelled=0,s.stopImmediatePropagation=function(){s.cancelled=1;},s.stopPropagation=function(){s.cancelled=-1;}),-1!==s.cancelled&&(r===this.prevCode&&s.timeStamp===this.prevTime&&s.type===this.prevType||(this.prevCode=r,this.prevTime=s.timeStamp,this.prevType=s.type,"keydown"===s.type?(o&&(a=o.isDown,o.onDown(s)),s.cancelled||o&&a||(f[r]&&this.emit(h.KEY_DOWN+f[r],s),s.cancelled||this.emit(h.ANY_KEY_DOWN,s))):(o&&o.onUp(s),s.cancelled||(f[r]&&this.emit(h.KEY_UP+f[r],s),s.cancelled||this.emit(h.ANY_KEY_UP,s))),1===s.cancelled&&(s.cancelled=0)));}},resetKeys:function(){for(var t=this.keys,e=0;e<t.length;e++)t[e]&&t[e].reset();return this;},shutdown:function(){this.removeAllKeys(!0),this.removeAllListeners(),this.sceneInputPlugin.manager.events.off(a.MANAGER_PROCESS,this.update,this),this.game.events.off(r.BLUR,this.resetKeys),this.scene.sys.events.off(p.PAUSE,this.resetKeys,this),this.scene.sys.events.off(p.SLEEP,this.resetKeys,this),this.queue=[];},destroy:function(){this.shutdown();for(var t=this.keys,e=0;e<t.length;e++)t[e]&&t[e].destroy();this.keys=[],this.combos=[],this.queue=[],this.scene=null,this.settings=null,this.sceneInputPlugin=null,this.manager=null;},time:{get:function(){return this.sceneInputPlugin.manager.time;}}});u.register("KeyboardPlugin",v,"keyboard","keyboard","inputKeyboard"),t.exports=v;},function(t,e,i){var n=i(143),s={};for(var r in n)s[n[r]]=r;t.exports=s;},function(t,e){t.exports=function(t){return!!t._justDown&&!(t._justDown=!1);};},function(t,e){t.exports=function(t){return!!t._justUp&&!(t._justUp=!1);};},function(t,e){t.exports=function(t,e){void 0===e&&(e=50);var i=t.plugin.game.loop.time-t.timeDown;return t.isDown&&i<e;};},function(t,e){t.exports=function(t,e){void 0===e&&(e=50);var i=t.plugin.game.loop.time-t.timeUp;return t.isUp&&i<e;};},function(t,e,i){t.exports={MouseManager:i(411)};},function(t,e,i){t.exports={TouchManager:i(413)};},function(t,e,i){var n=i(21),s=i(17)(!1,s={Events:i(95),FileTypes:i(1339),File:i(23),FileTypesManager:i(8),GetURL:i(155),LoaderPlugin:i(1365),MergeXHRSettings:i(240),MultiFile:i(49),XHRLoader:i(517),XHRSettings:i(156)},n);t.exports=s;},function(t,e,i){t.exports={AnimationJSONFile:i(1340),AsepriteFile:i(1341),AtlasJSONFile:i(1342),AtlasXMLFile:i(1343),AudioFile:i(518),AudioSpriteFile:i(1344),BinaryFile:i(1345),BitmapFontFile:i(1346),CSSFile:i(1347),GLSLFile:i(1348),HTML5AudioFile:i(519),HTMLFile:i(1349),HTMLTextureFile:i(1350),ImageFile:i(71),JSONFile:i(61),MultiAtlasFile:i(1351),MultiScriptFile:i(1352),OBJFile:i(1353),PackFile:i(1354),PluginFile:i(1355),SceneFile:i(1356),ScenePluginFile:i(1357),ScriptFile:i(520),SpriteSheetFile:i(1358),SVGFile:i(1359),TextFile:i(242),TilemapCSVFile:i(1360),TilemapImpactFile:i(1361),TilemapJSONFile:i(1362),UnityAtlasFile:i(1363),VideoFile:i(1364),XMLFile:i(241)};},function(t,e,i){var n=i(0),s=i(8),r=i(61),o=i(95),a=new n({Extends:r,initialize:function(t,e,i,n,s){r.call(this,t,e,i,n,s),this.type="animationJSON";},onProcess:function(){this.loader.once(o.POST_PROCESS,this.onLoadComplete,this),r.prototype.onProcess.call(this);},onLoadComplete:function(){this.loader.systems.anims.fromJSON(this.data);}});s.register("animation",function(t,e,i,n){if(Array.isArray(t))for(var s=0;s<t.length;s++)this.addFile(new a(this,t[s]));else this.addFile(new a(this,t,e,n,i));return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(8),u=i(2),l=i(71),c=i(7),d=i(61),f=i(49),a=new n({Extends:f,initialize:function(t,e,i,n,s,r){var o,a,h=c(e)?(e=u(a=e,"key"),o=new l(t,{key:e,url:u(a,"textureURL"),extension:u(a,"textureExtension","png"),normalMap:u(a,"normalMap"),xhrSettings:u(a,"textureXhrSettings")}),new d(t,{key:e,url:u(a,"atlasURL"),extension:u(a,"atlasExtension","json"),xhrSettings:u(a,"atlasXhrSettings")})):(o=new l(t,e,i,s),new d(t,e,n,r));o.linkFile?f.call(this,t,"atlasjson",e,[o,h,o.linkFile]):f.call(this,t,"atlasjson",e,[o,h]);},addToCache:function(){var t,e,i;this.isReadyToProcess()&&(t=this.files[0],e=this.files[1],i=this.files[2]?this.files[2].data:null,this.loader.textureManager.addAtlas(t.key,t.data,e.data,i),e.addToCache(),this.complete=!0);}});s.register("aseprite",function(t,e,i,n,s){var r;if(Array.isArray(t))for(var o=0;o<t.length;o++)r=new a(this,t[o]),this.addFile(r.files);else r=new a(this,t,e,i,n,s),this.addFile(r.files);return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(8),u=i(2),l=i(71),c=i(7),d=i(61),f=i(49),a=new n({Extends:f,initialize:function(t,e,i,n,s,r){var o,a,h=c(e)?(e=u(a=e,"key"),o=new l(t,{key:e,url:u(a,"textureURL"),extension:u(a,"textureExtension","png"),normalMap:u(a,"normalMap"),xhrSettings:u(a,"textureXhrSettings")}),new d(t,{key:e,url:u(a,"atlasURL"),extension:u(a,"atlasExtension","json"),xhrSettings:u(a,"atlasXhrSettings")})):(o=new l(t,e,i,s),new d(t,e,n,r));o.linkFile?f.call(this,t,"atlasjson",e,[o,h,o.linkFile]):f.call(this,t,"atlasjson",e,[o,h]);},addToCache:function(){var t,e,i;this.isReadyToProcess()&&(t=this.files[0],e=this.files[1],i=this.files[2]?this.files[2].data:null,this.loader.textureManager.addAtlas(t.key,t.data,e.data,i),e.pendingDestroy(),this.complete=!0);}});s.register("atlas",function(t,e,i,n,s){var r;if(Array.isArray(t))for(var o=0;o<t.length;o++)r=new a(this,t[o]),this.addFile(r.files);else r=new a(this,t,e,i,n,s),this.addFile(r.files);return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(8),u=i(2),l=i(71),c=i(7),d=i(49),f=i(241),a=new n({Extends:d,initialize:function(t,e,i,n,s,r){var o,a,h=c(e)?(e=u(a=e,"key"),o=new l(t,{key:e,url:u(a,"textureURL"),extension:u(a,"textureExtension","png"),normalMap:u(a,"normalMap"),xhrSettings:u(a,"textureXhrSettings")}),new f(t,{key:e,url:u(a,"atlasURL"),extension:u(a,"atlasExtension","xml"),xhrSettings:u(a,"atlasXhrSettings")})):(o=new l(t,e,i,s),new f(t,e,n,r));o.linkFile?d.call(this,t,"atlasxml",e,[o,h,o.linkFile]):d.call(this,t,"atlasxml",e,[o,h]);},addToCache:function(){var t,e,i;this.isReadyToProcess()&&(t=this.files[0],e=this.files[1],i=this.files[2]?this.files[2].data:null,this.loader.textureManager.addAtlasXML(t.key,t.data,e.data,i),e.pendingDestroy(),this.complete=!0);}});s.register("atlasXML",function(t,e,i,n,s){var r;if(Array.isArray(t))for(var o=0;o<t.length;o++)r=new a(this,t[o]),this.addFile(r.files);else r=new a(this,t,e,i,n,s),this.addFile(r.files);return this;}),t.exports=a;},function(t,e,i){var l=i(518),n=i(0),s=i(8),c=i(2),d=i(7),f=i(61),p=i(49),g=new n({Extends:p,initialize:function(t,e,i,n,s,r,o){var a,h,u;d(e)&&(e=c(a=e,"key"),i=c(a,"jsonURL"),n=c(a,"audioURL"),s=c(a,"audioConfig"),r=c(a,"audioXhrSettings"),o=c(a,"jsonXhrSettings")),n?(u=l.create(t,e,n,s,r))&&(h=new f(t,e,i,o),p.call(this,t,"audiosprite",e,[u,h]),this.config.resourceLoad=!1):(h=new f(t,e,i,o),p.call(this,t,"audiosprite",e,[h]),this.config.resourceLoad=!0,this.config.audioConfig=s,this.config.audioXhrSettings=r);},onFileComplete:function(t){var e,i,n,s;-1!==this.files.indexOf(t)&&(this.pending--,this.config.resourceLoad&&"json"===t.type&&t.data.hasOwnProperty("resources")&&(e=t.data.resources,i=c(this.config,"audioConfig"),n=c(this.config,"audioXhrSettings"),(s=l.create(this.loader,t.key,e,i,n))&&(this.addToMultiFile(s),this.loader.addFile(s))));},addToCache:function(){var t,e;this.isReadyToProcess()&&(t=this.files[0],e=this.files[1],t.addToCache(),e.addToCache(),this.complete=!0);}});s.register("audioSprite",function(t,e,i,n,s,r){var o,a=this.systems.game,h=a.config.audio,u=a.device.audio;if(h&&h.noAudio||!u.webAudio&&!u.audioData)return this;if(Array.isArray(t))for(var l=0;l<t.length;l++)(o=new g(this,t[l])).files&&this.addFile(o.files);else(o=new g(this,t,e,i,n,s,r)).files&&this.addFile(o.files);return this;});},function(t,e,i){var n=i(0),s=i(21),h=i(23),r=i(8),u=i(2),l=i(7),o=new n({Extends:h,initialize:function(t,e,i,n,s){var r,o="bin";l(e)&&(e=u(r=e,"key"),i=u(r,"url"),n=u(r,"xhrSettings"),o=u(r,"extension",o),s=u(r,"dataType",s));var a={type:"binary",cache:t.cacheManager.binary,extension:o,responseType:"arraybuffer",key:e,url:i,xhrSettings:n,config:{dataType:s}};h.call(this,t,a);},onProcess:function(){this.state=s.FILE_PROCESSING;var t=this.config.dataType;this.data=t?new t(this.xhrLoader.response):this.xhrLoader.response,this.onProcessComplete();}});r.register("binary",function(t,e,i,n){if(Array.isArray(t))for(var s=0;s<t.length;s++)this.addFile(new o(this,t[s]));else this.addFile(new o(this,t,e,n,i));return this;}),t.exports=o;},function(t,e,i){var n=i(0),s=i(8),u=i(2),l=i(71),c=i(7),d=i(49),r=i(212),f=i(241),a=new n({Extends:d,initialize:function(t,e,i,n,s,r){var o,a,h=c(e)?(e=u(a=e,"key"),o=new l(t,{key:e,url:u(a,"textureURL"),extension:u(a,"textureExtension","png"),normalMap:u(a,"normalMap"),xhrSettings:u(a,"textureXhrSettings")}),new f(t,{key:e,url:u(a,"fontDataURL"),extension:u(a,"fontDataExtension","xml"),xhrSettings:u(a,"fontDataXhrSettings")})):(o=new l(t,e,i,s),new f(t,e,n,r));o.linkFile?d.call(this,t,"bitmapfont",e,[o,h,o.linkFile]):d.call(this,t,"bitmapfont",e,[o,h]);},addToCache:function(){var t,e,i,n;this.isReadyToProcess()&&(t=this.files[0],e=this.files[1],t.addToCache(),e.pendingDestroy(),i=t.cache.get(t.key),n=r(e.data,t.cache.getFrame(t.key),0,0,i),this.loader.cacheManager.bitmapFont.add(t.key,{data:n,texture:t.key,frame:null}),this.complete=!0);}});s.register("bitmapFont",function(t,e,i,n,s){var r;if(Array.isArray(t))for(var o=0;o<t.length;o++)r=new a(this,t[o]),this.addFile(r.files);else r=new a(this,t,e,i,n,s),this.addFile(r.files);return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(21),a=i(23),r=i(8),h=i(2),u=i(7),o=new n({Extends:a,initialize:function(t,e,i,n){var s,r="css";u(e)&&(e=h(s=e,"key"),i=h(s,"url"),n=h(s,"xhrSettings"),r=h(s,"extension",r));var o={type:"script",cache:!1,extension:r,responseType:"text",key:e,url:i,xhrSettings:n};a.call(this,t,o);},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=document.createElement("style"),this.data.defer=!1,this.data.innerHTML=this.xhrLoader.responseText,document.head.appendChild(this.data),this.onProcessComplete();}});r.register("css",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new o(this,t[n]));else this.addFile(new o(this,t,e,i));return this;}),t.exports=o;},function(t,e,i){var n=i(0),s=i(21),h=i(23),r=i(8),u=i(2),l=i(7),a=i(396),o=new n({Extends:h,initialize:function(t,e,i,n,s){var r,o="glsl";l(e)?(e=u(r=e,"key"),i=u(r,"url"),n=u(r,"shaderType","fragment"),s=u(r,"xhrSettings"),o=u(r,"extension",o)):void 0===n&&(n="fragment");var a={type:"glsl",cache:t.cacheManager.shader,extension:o,responseType:"text",key:e,url:i,config:{shaderType:n},xhrSettings:s};h.call(this,t,a);},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=this.xhrLoader.responseText,this.onProcessComplete();},addToCache:function(){var t=this.data.split("\n"),e=this.extractBlock(t,0);if(e)for(;e;){var i,n=this.getShaderName(e.header),s=this.getShaderType(e.header),r=this.getShaderUniforms(e.header),o=e.shader;this.cache.has(n)?(i=this.cache.get(n),"fragment"===s?i.fragmentSrc=o:i.vertexSrc=o,i.uniforms||(i.uniforms=r)):"fragment"===s?this.cache.add(n,new a(n,o,"",r)):this.cache.add(n,new a(n,"",o,r)),e=this.extractBlock(t,e.offset);}else"fragment"===this.config.shaderType?this.cache.add(this.key,new a(this.key,this.data)):this.cache.add(this.key,new a(this.key,"",this.data));this.pendingDestroy();},getShaderName:function(t){for(var e=0;e<t.length;e++){var i=t[e].trim();if("name:"===i.substring(0,5))return i.substring(5).trim();}return this.key;},getShaderType:function(t){for(var e=0;e<t.length;e++){var i=t[e].trim();if("type:"===i.substring(0,5))return i.substring(5).trim();}return this.config.shaderType;},getShaderUniforms:function(t){for(var e={},i=0;i<t.length;i++){var n=t[i].trim();if("uniform."===n.substring(0,8)){var s=n.indexOf(":");if(s){var r=n.substring(8,s);try{e[r]=JSON.parse(n.substring(s+1));}catch(t){console.warn("Invalid uniform JSON: "+r);}}}}return e;},extractBlock:function(t,e){for(var i=-1,n=-1,s=-1,r=!1,o=!1,a=[],h=[],u=e;u<t.length;u++){var l=t[u].trim();if("---"===l){if(-1===i)i=u,r=!0;else{if(!r){o=!1;break;}n=u,o=!(r=!1);}}else r?a.push(l):o&&(h.push(l),s=u);}return r||-1===n?null:{header:a,shader:h.join("\n"),offset:s};}});r.register("glsl",function(t,e,i,n){if(Array.isArray(t))for(var s=0;s<t.length;s++)this.addFile(new o(this,t[s]));else this.addFile(new o(this,t,e,i,n));return this;}),t.exports=o;},function(t,e,i){var n=i(0),s=i(21),a=i(23),r=i(8),h=i(2),u=i(7),o=new n({Extends:a,initialize:function(t,e,i,n){var s,r="html";u(e)&&(e=h(s=e,"key"),i=h(s,"url"),n=h(s,"xhrSettings"),r=h(s,"extension",r));var o={type:"text",cache:t.cacheManager.html,extension:r,responseType:"text",key:e,url:i,xhrSettings:n};a.call(this,t,o);},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=this.xhrLoader.responseText,this.onProcessComplete();}});r.register("html",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new o(this,t[n]));else this.addFile(new o(this,t,e,i));return this;}),t.exports=o;},function(t,e,i){var n=i(0),o=i(21),u=i(23),s=i(8),l=i(2),c=i(7),a=new n({Extends:u,initialize:function(t,e,i,n,s,r){void 0===n&&(n=512),void 0===s&&(s=512);var o,a="html";c(e)&&(e=l(o=e,"key"),i=l(o,"url"),r=l(o,"xhrSettings"),a=l(o,"extension",a),n=l(o,"width",n),s=l(o,"height",s));var h={type:"html",cache:t.textureManager,extension:a,responseType:"text",key:e,url:i,xhrSettings:r,config:{width:n,height:s}};u.call(this,t,h);},onProcess:function(){this.state=o.FILE_PROCESSING;var t=this.config.width,e=this.config.height,i=[];i.push('<svg width="'+t+'px" height="'+e+'px" viewBox="0 0 '+t+" "+e+'" xmlns="http://www.w3.org/2000/svg">'),i.push('<foreignObject width="100%" height="100%">'),i.push('<body xmlns="http://www.w3.org/1999/xhtml">'),i.push(this.xhrLoader.responseText),i.push("</body>"),i.push("</foreignObject>"),i.push("</svg>");var n=[i.join("\n")],s=this;try{var r=new window.Blob(n,{type:"image/svg+xml;charset=utf-8"});}catch(t){return s.state=o.FILE_ERRORED,void s.onProcessComplete();}this.data=new Image(),this.data.crossOrigin=this.crossOrigin,this.data.onload=function(){u.revokeObjectURL(s.data),s.onProcessComplete();},this.data.onerror=function(){u.revokeObjectURL(s.data),s.onProcessError();},u.createObjectURL(this.data,r,"image/svg+xml");},addToCache:function(){var t=this.cache.addImage(this.key,this.data);this.pendingDestroy(t);}});s.register("htmlTexture",function(t,e,i,n,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.addFile(new a(this,t[r]));else this.addFile(new a(this,t,e,i,n,s));return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(8),v=i(2),m=i(71),u=i(7),l=i(61),c=i(49),a=new n({Extends:c,initialize:function(t,e,i,n,s,r,o){var a;u(e)&&(e=v(a=e,"key"),i=v(a,"url",!1)?v(a,"url"):v(a,"atlasURL"),r=v(a,"xhrSettings"),n=v(a,"path"),s=v(a,"baseURL"),o=v(a,"textureXhrSettings"));var h=new l(t,e,i,r);c.call(this,t,"multiatlas",e,[h]),this.config.path=n,this.config.baseURL=s,this.config.textureXhrSettings=o;},onFileComplete:function(t){if(-1!==this.files.indexOf(t)&&(this.pending--,"json"===t.type&&t.data.hasOwnProperty("textures"))){var e=t.data.textures,i=this.config,n=this.loader,s=n.baseURL,r=n.path,o=n.prefix,a=v(i,"baseURL",this.baseURL),h=v(i,"path",this.path),u=v(i,"prefix",this.prefix),l=v(i,"textureXhrSettings");n.setBaseURL(a),n.setPath(h),n.setPrefix(u);for(var c=0;c<e.length;c++){var d,f=e[c].image,p="MA"+this.multiKeyIndex+"_"+f,g=new m(n,p,f,l);this.addToMultiFile(g),n.addFile(g),e[c].normalMap&&((d=new m(n,p,e[c].normalMap,l)).type="normalMap",g.setLink(d),this.addToMultiFile(d),n.addFile(d));}n.setBaseURL(s),n.setPath(r),n.setPrefix(o);}},addToCache:function(){if(this.isReadyToProcess()){for(var t=this.files[0],e=[],i=[],n=[],s=1;s<this.files.length;s++){var r=this.files[s];if("normalMap"!==r.type)for(var o=r.key.indexOf("_"),a=r.key.substr(o+1),h=r.data,u=0;u<t.data.textures.length;u++){var l=t.data.textures[u];if(l.image===a){i.push(h),e.push(l),r.linkFile&&n.push(r.linkFile.data);break;}}}for(0===n.length&&(n=void 0),this.loader.textureManager.addAtlasJSONArray(this.key,i,e,n),this.complete=!0,s=0;s<this.files.length;s++)this.files[s].pendingDestroy();}}});s.register("multiatlas",function(t,e,i,n,s){var r;if(Array.isArray(t))for(var o=0;o<t.length;o++)r=new a(this,t[o]),this.addFile(r.files);else r=new a(this,t,e,i,n,s),this.addFile(r.files);return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(8),u=i(2),l=i(7),c=i(49),d=i(520),r=new n({Extends:c,initialize:function(t,e,i,n){var s,r="js",o=[];l(e)&&(e=u(s=e,"key"),i=u(s,"url"),n=u(s,"xhrSettings"),r=u(s,"extension",r)),Array.isArray(i)||(i=[i]);for(var a=0;a<i.length;a++){var h=new d(t,{key:e+"_"+a.toString(),url:i[a],extension:r,xhrSettings:n});h.onProcess=function(){this.onProcessComplete();},o.push(h);}c.call(this,t,"scripts",e,o);},addToCache:function(){if(this.isReadyToProcess()){for(var t=0;t<this.files.length;t++){var e=this.files[t];e.data=document.createElement("script"),e.data.language="javascript",e.data.type="text/javascript",e.data.defer=!1,e.data.text=e.xhrLoader.responseText,document.head.appendChild(e.data);}this.complete=!0;}}});s.register("scripts",function(t,e,i){var n;if(Array.isArray(t))for(var s=0;s<t.length;s++)n=new r(this,t[s]),this.addFile(n.files);else n=new r(this,t,e,i),this.addFile(n.files);return this;}),t.exports=r;},function(t,e,i){var n=i(0),s=i(8),l=i(2),c=i(7),d=i(49),r=i(498),o=i(499),f=i(242),a=new n({Extends:d,initialize:function(t,e,i,n,s,r){var o,a,h,u=t.cacheManager.obj;c(e)?(e=l(h=e,"key"),o=new f(t,{key:e,type:"obj",cache:u,url:l(h,"url"),extension:l(h,"extension","obj"),xhrSettings:l(h,"xhrSettings"),config:{flipUV:l(h,"flipUV",s)}}),(n=l(h,"matURL"))&&(a=new f(t,{key:e,type:"mat",cache:u,url:n,extension:l(h,"matExtension","mat"),xhrSettings:l(h,"xhrSettings")}))):(o=new f(t,{key:e,url:i,type:"obj",cache:u,extension:"obj",xhrSettings:r,config:{flipUV:s}}),n&&(a=new f(t,{key:e,url:n,type:"mat",cache:u,extension:"mat",xhrSettings:r}))),d.call(this,t,"obj",e,[o,a]);},addToCache:function(){var t,e,i;this.isReadyToProcess()&&(t=this.files[0],e=this.files[1],i=r(t.data,t.config.flipUV),e&&(i.materials=o(e.data)),t.cache.add(t.key,i),this.complete=!0);}});s.register("obj",function(t,e,i,n,s){var r;if(Array.isArray(t))for(var o=0;o<t.length;o++)r=new a(this,t[o]),this.addFile(r.files);else r=new a(this,t,e,i,n,s),this.addFile(r.files);return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(21),r=i(8),o=i(61),a=new n({Extends:o,initialize:function(t,e,i,n,s){o.call(this,t,e,i,n,s),this.type="packfile";},onProcess:function(){this.state!==s.FILE_POPULATED&&(this.state=s.FILE_PROCESSING,this.data=JSON.parse(this.xhrLoader.responseText)),this.loader.addPack(this.data,this.config),this.onProcessComplete();}});r.register("pack",function(t,e,i,n){if(Array.isArray(t))for(var s=0;s<t.length;s++)this.addFile(new a(this,t[s]));else this.addFile(new a(this,t,e,n,i));return this;}),t.exports=a;},function(t,e,i){var n=i(0),u=i(21),l=i(23),s=i(8),c=i(2),d=i(7),o=new n({Extends:l,initialize:function(t,e,i,n,s,r){var o,a="js";d(e)&&(e=c(o=e,"key"),i=c(o,"url"),r=c(o,"xhrSettings"),a=c(o,"extension",a),n=c(o,"start"),s=c(o,"mapping"));var h={type:"plugin",cache:!1,extension:a,responseType:"text",key:e,url:i,xhrSettings:r,config:{start:n,mapping:s}};l.call(this,t,h),"function"==typeof i&&(this.data=i,this.state=u.FILE_POPULATED);},onProcess:function(){var t,e=this.loader.systems.plugins,i=this.config,n=c(i,"start",!1),s=c(i,"mapping",null);this.state===u.FILE_POPULATED?e.install(this.key,this.data,n,s):(this.state=u.FILE_PROCESSING,this.data=document.createElement("script"),this.data.language="javascript",this.data.type="text/javascript",this.data.defer=!1,this.data.text=this.xhrLoader.responseText,document.head.appendChild(this.data),t=e.install(this.key,window[this.key],n,s),(n||s)&&(this.loader.systems[s]=t,this.loader.scene[s]=t)),this.onProcessComplete();}});s.register("plugin",function(t,e,i,n,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.addFile(new o(this,t[r]));else this.addFile(new o(this,t,e,i,n,s));return this;}),t.exports=o;},function(t,e,i){var n=i(0),s=i(21),a=i(23),r=i(8),h=i(2),u=i(7),o=new n({Extends:a,initialize:function(t,e,i,n){var s,r="js";u(e)&&(e=h(s=e,"key"),i=h(s,"url"),n=h(s,"xhrSettings"),r=h(s,"extension",r));var o={type:"text",extension:r,responseType:"text",key:e,url:i,xhrSettings:n};a.call(this,t,o);},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=this.xhrLoader.responseText,this.onProcessComplete();},addToCache:function(){var t=this.data.concat("(function(){\nreturn new "+this.key+"();\n}).call(this);"),e=eval;this.loader.sceneManager.add(this.key,e(t)),this.complete=!0;}});r.register("sceneFile",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new o(this,t[n]));else this.addFile(new o(this,t,e,i));return this;}),t.exports=o;},function(t,e,i){var n=i(0),u=i(21),l=i(23),s=i(8),c=i(2),d=i(7),o=new n({Extends:l,initialize:function(t,e,i,n,s,r){var o,a="js";d(e)&&(e=c(o=e,"key"),i=c(o,"url"),r=c(o,"xhrSettings"),a=c(o,"extension",a),n=c(o,"systemKey"),s=c(o,"sceneKey"));var h={type:"scenePlugin",cache:!1,extension:a,responseType:"text",key:e,url:i,xhrSettings:r,config:{systemKey:n,sceneKey:s}};l.call(this,t,h),"function"==typeof i&&(this.data=i,this.state=u.FILE_POPULATED);},onProcess:function(){var t=this.loader.systems.plugins,e=this.config,i=this.key,n=c(e,"systemKey",i),s=c(e,"sceneKey",i);this.state===u.FILE_POPULATED?t.installScenePlugin(n,this.data,s,this.loader.scene,!0):(this.state=u.FILE_PROCESSING,this.data=document.createElement("script"),this.data.language="javascript",this.data.type="text/javascript",this.data.defer=!1,this.data.text=this.xhrLoader.responseText,document.head.appendChild(this.data),t.installScenePlugin(n,window[this.key],s,this.loader.scene,!0)),this.onProcessComplete();}});s.register("scenePlugin",function(t,e,i,n,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.addFile(new o(this,t[r]));else this.addFile(new o(this,t,e,i,n,s));return this;}),t.exports=o;},function(t,e,i){var n=i(0),s=i(8),r=i(71),o=new n({Extends:r,initialize:function(t,e,i,n,s){r.call(this,t,e,i,s,n),this.type="spritesheet";},addToCache:function(){var t=this.cache.addSpriteSheet(this.key,this.data,this.config);this.pendingDestroy(t);}});s.register("spritesheet",function(t,e,i,n){if(Array.isArray(t))for(var s=0;s<t.length;s++)this.addFile(new o(this,t[s]));else this.addFile(new o(this,t,e,i,n));return this;}),t.exports=o;},function(t,e,i){var n=i(0),f=i(21),p=i(23),s=i(8),h=i(2),u=i(7),r=new n({Extends:p,initialize:function(t,e,i,n,s){var r,o="svg";u(e)&&(e=h(r=e,"key"),i=h(r,"url"),n=h(r,"svgConfig",{}),s=h(r,"xhrSettings"),o=h(r,"extension",o));var a={type:"svg",cache:t.textureManager,extension:o,responseType:"text",key:e,url:i,xhrSettings:s,config:{width:h(n,"width"),height:h(n,"height"),scale:h(n,"scale")}};p.call(this,t,a);},onProcess:function(){this.state=f.FILE_PROCESSING;var t=this.xhrLoader.responseText,e=[t],i=this.config.width,n=this.config.height,s=this.config.scale;t:if(i&&n||s){var r,o=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("svg")[0],a=o.hasAttribute("viewBox"),h=parseFloat(o.getAttribute("width")),u=parseFloat(o.getAttribute("height"));if(!a&&h&&u?o.setAttribute("viewBox","0  0 "+h+" "+u):!a||h||u||(h=(r=o.getAttribute("viewBox").split(/\s+|,/))[2],u=r[3]),s){if(!h||!u)break t;i=h*s,n=u*s;}o.setAttribute("width",i.toString()+"px"),o.setAttribute("height",n.toString()+"px"),e=[new XMLSerializer().serializeToString(o)];}try{var l=new window.Blob(e,{type:"image/svg+xml;charset=utf-8"});}catch(t){return void this.onProcessError();}this.data=new Image(),this.data.crossOrigin=this.crossOrigin;var c=this,d=!1;this.data.onload=function(){d||p.revokeObjectURL(c.data),c.onProcessComplete();},this.data.onerror=function(){d?c.onProcessError():(d=!0,p.revokeObjectURL(c.data),c.data.src="data:image/svg+xml,"+encodeURIComponent(e.join("")));},p.createObjectURL(this.data,l,"image/svg+xml");},addToCache:function(){var t=this.cache.addImage(this.key,this.data);this.pendingDestroy(t);}});s.register("svg",function(t,e,i,n){if(Array.isArray(t))for(var s=0;s<t.length;s++)this.addFile(new r(this,t[s]));else this.addFile(new r(this,t,e,i,n));return this;}),t.exports=r;},function(t,e,i){var n=i(0),s=i(21),a=i(23),r=i(8),h=i(2),u=i(7),l=i(40),o=new n({Extends:a,initialize:function(t,e,i,n){var s,r="csv";u(e)&&(e=h(s=e,"key"),i=h(s,"url"),n=h(s,"xhrSettings"),r=h(s,"extension",r));var o={type:"tilemapCSV",cache:t.cacheManager.tilemap,extension:r,responseType:"text",key:e,url:i,xhrSettings:n};a.call(this,t,o),this.tilemapFormat=l.CSV;},onProcess:function(){this.state=s.FILE_PROCESSING,this.data=this.xhrLoader.responseText,this.onProcessComplete();},addToCache:function(){var t={format:this.tilemapFormat,data:this.data};this.cache.add(this.key,t),this.pendingDestroy(t);}});r.register("tilemapCSV",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new o(this,t[n]));else this.addFile(new o(this,t,e,i));return this;}),t.exports=o;},function(t,e,i){var n=i(0),s=i(8),r=i(61),o=i(40),a=new n({Extends:r,initialize:function(t,e,i,n){r.call(this,t,e,i,n),this.type="tilemapJSON",this.cache=t.cacheManager.tilemap;},addToCache:function(){var t={format:o.WELTMEISTER,data:this.data};this.cache.add(this.key,t),this.pendingDestroy(t);}});s.register("tilemapImpact",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new a(this,t[n]));else this.addFile(new a(this,t,e,i));return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(8),r=i(61),o=i(40),a=new n({Extends:r,initialize:function(t,e,i,n){r.call(this,t,e,i,n),this.type="tilemapJSON",this.cache=t.cacheManager.tilemap;},addToCache:function(){var t={format:o.TILED_JSON,data:this.data};this.cache.add(this.key,t),this.pendingDestroy(t);}});s.register("tilemapTiledJSON",function(t,e,i){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addFile(new a(this,t[n]));else this.addFile(new a(this,t,e,i));return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(8),u=i(2),l=i(71),c=i(7),d=i(49),f=i(242),a=new n({Extends:d,initialize:function(t,e,i,n,s,r){var o,a,h=c(e)?(e=u(a=e,"key"),o=new l(t,{key:e,url:u(a,"textureURL"),extension:u(a,"textureExtension","png"),normalMap:u(a,"normalMap"),xhrSettings:u(a,"textureXhrSettings")}),new f(t,{key:e,url:u(a,"atlasURL"),extension:u(a,"atlasExtension","txt"),xhrSettings:u(a,"atlasXhrSettings")})):(o=new l(t,e,i,s),new f(t,e,n,r));o.linkFile?d.call(this,t,"unityatlas",e,[o,h,o.linkFile]):d.call(this,t,"unityatlas",e,[o,h]);},addToCache:function(){var t,e,i;this.isReadyToProcess()&&(t=this.files[0],e=this.files[1],i=this.files[2]?this.files[2].data:null,this.loader.textureManager.addUnityAtlas(t.key,t.data,e.data,i),e.pendingDestroy(),this.complete=!0);}});s.register("unityAtlas",function(t,e,i,n,s){var r;if(Array.isArray(t))for(var o=0;o<t.length;o++)r=new a(this,t[o]),this.addFile(r.files);else r=new a(this,t,e,i,n,s),this.addFile(r.files);return this;}),t.exports=a;},function(t,e,i){var n=i(0),s=i(21),h=i(23),r=i(8),o=i(155),u=i(2),l=i(7),c=new n({Extends:h,initialize:function(t,e,i,n,s,r,o){void 0===n&&(n="loadeddata"),void 0===s&&(s=!1),void 0===r&&(r=!1),"loadeddata"!==n&&"canplay"!==n&&"canplaythrough"!==n&&(n="loadeddata");var a={type:"video",cache:t.cacheManager.video,extension:i.type,responseType:"blob",key:e,url:i.url,xhrSettings:o,config:{loadEvent:n,asBlob:s,noAudio:r}};this.onLoadCallback=this.onVideoLoadHandler.bind(this),this.onErrorCallback=this.onVideoErrorHandler.bind(this),h.call(this,t,a);},onProcess:function(){var t,e;this.state=s.FILE_PROCESSING,this.config.asBlob?(t=this.createVideoElement(),this.data=t,(e=this).data.onloadeddata=function(){e.onProcessComplete();},this.data.onerror=function(){h.revokeObjectURL(e.data),e.onProcessError();},h.createObjectURL(t,this.xhrLoader.response,""),t.load()):this.onProcessComplete();},createVideoElement:function(){var t=document.createElement("video");return t.controls=!1,t.crossOrigin=this.loader.crossOrigin,this.config.noAudio&&(t.muted=!0,t.defaultMuted=!0,t.setAttribute("autoplay","autoplay")),t.setAttribute("playsinline","playsinline"),t.setAttribute("preload","auto"),t;},onVideoLoadHandler:function(t){var e=t.target;e.removeEventListener(this.config.loadEvent,this.onLoadCallback,!0),e.removeEventListener("error",this.onErrorCallback,!0),this.data=e,this.resetXHR(),this.loader.nextFile(this,!0);},onVideoErrorHandler:function(t){var e=t.target;e&&(e.removeEventListener(this.config.loadEvent,this.onLoadCallback,!0),e.removeEventListener("error",this.onErrorCallback,!0)),this.resetXHR(),this.loader.nextFile(this,!1);},load:function(){var t,e=this.config.loadEvent;this.config.asBlob?h.prototype.load.call(this):(this.percentComplete=0,(t=this.createVideoElement()).addEventListener(e,this.onLoadCallback,!0),t.addEventListener("error",this.onErrorCallback,!0),t.src=o(this,this.loader.baseURL),t.load());}});c.create=function(t,e,i,n,s,r,o){var a=t.systems.game;l(e)&&(i=u(e,"url",[]),n=u(e,"loadEvent","loadeddata"),s=u(e,"asBlob",!1),r=u(e,"noAudio",!1),o=u(e,"xhrSettings"),e=u(e,"key"));var h=c.getVideoURL(a,i);if(h)return new c(t,e,h,n,s,r,o);},c.getVideoURL=function(t,e){Array.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var n,s=u(e[i],"url",e[i]);if(0===s.indexOf("blob:"))return{url:s,type:""};if(n=0===s.indexOf("data:")?s.split(",")[0].match(/\/(.*?);/):s.match(/\.([a-zA-Z0-9]+)($|\?)/),n=u(e[i],"type",n?n[1]:"").toLowerCase(),t.device.video[n])return{url:s,type:n};}return null;},r.register("video",function(t,e,i,n,s,r){var o;if(Array.isArray(t))for(var a=0;a<t.length;a++)(o=c.create(this,t[a]))&&this.addFile(o);else(o=c.create(this,t,e,i,n,s,r))&&this.addFile(o);return this;}),t.exports=c;},function(t,e,i){var n=i(0),s=i(21),r=i(149),o=i(9),a=i(95),h=i(8),v=i(2),u=i(24),l=i(20),c=i(156),d=new n({Extends:o,initialize:function(t){o.call(this);var e=t.sys.game.config,i=t.sys.settings.loader;this.scene=t,this.systems=t.sys,this.cacheManager=t.sys.cache,this.textureManager=t.sys.textures,this.sceneManager=t.sys.game.scene,h.install(this),this.prefix="",this.path="",this.baseURL="",this.setBaseURL(v(i,"baseURL",e.loaderBaseURL)),this.setPath(v(i,"path",e.loaderPath)),this.setPrefix(v(i,"prefix",e.loaderPrefix)),this.maxParallelDownloads=v(i,"maxParallelDownloads",e.loaderMaxParallelDownloads),this.xhr=c(v(i,"responseType",e.loaderResponseType),v(i,"async",e.loaderAsync),v(i,"user",e.loaderUser),v(i,"password",e.loaderPassword),v(i,"timeout",e.loaderTimeout),v(i,"withCredentials",e.loaderWithCredentials)),this.crossOrigin=v(i,"crossOrigin",e.loaderCrossOrigin),this.totalToLoad=0,this.progress=0,this.list=new r(),this.inflight=new r(),this.queue=new r(),this._deleteQueue=new r(),this.totalFailed=0,this.totalComplete=0,this.state=s.LOADER_IDLE,this.multiKeyIndex=0,t.sys.events.once(l.BOOT,this.boot,this),t.sys.events.on(l.START,this.pluginStart,this);},boot:function(){this.systems.events.once(l.DESTROY,this.destroy,this);},pluginStart:function(){this.systems.events.once(l.SHUTDOWN,this.shutdown,this);},setBaseURL:function(t){return void 0===t&&(t=""),""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.baseURL=t,this;},setPath:function(t){return void 0===t&&(t=""),""!==t&&"/"!==t.substr(-1)&&(t=t.concat("/")),this.path=t,this;},setPrefix:function(t){return void 0===t&&(t=""),this.prefix=t,this;},setCORS:function(t){return this.crossOrigin=t,this;},addFile:function(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];this.keyExists(i)||(this.list.set(i),this.emit(a.ADD,i.key,i.type,this,i),this.isLoading()&&(this.totalToLoad++,this.updateProgress()));}},keyExists:function(e){var i=e.hasCacheConflict();return i||this.list.iterate(function(t){if(t.type===e.type&&t.key===e.key)return!(i=!0);}),!i&&this.isLoading()&&(this.inflight.iterate(function(t){if(t.type===e.type&&t.key===e.key)return!(i=!0);}),this.queue.iterate(function(t){if(t.type===e.type&&t.key===e.key)return!(i=!0);})),i;},addPack:function(t,e){e&&t.hasOwnProperty(e)&&(t={packKey:t[e]});var i=0,n=this.baseURL,s=this.path,r=this.prefix;for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)){var a=t[o],h=v(a,"baseURL",n),u=v(a,"path",s),l=v(a,"prefix",r),c=v(a,"files",null),d=v(a,"defaultType","void");if(Array.isArray(c)){this.setBaseURL(h),this.setPath(u),this.setPrefix(l);for(var f=0;f<c.length;f++){var p=c[f],g=p.hasOwnProperty("type")?p.type:d;this[g]&&(this[g](p),i++);}}}return this.setBaseURL(n),this.setPath(s),this.setPrefix(r),0<i;},isLoading:function(){return this.state===s.LOADER_LOADING||this.state===s.LOADER_PROCESSING;},isReady:function(){return this.state===s.LOADER_IDLE||this.state===s.LOADER_COMPLETE;},start:function(){this.isReady()&&(this.progress=0,this.totalFailed=0,this.totalComplete=0,this.totalToLoad=this.list.size,this.emit(a.START,this),0===this.list.size?this.loadComplete():(this.state=s.LOADER_LOADING,this.inflight.clear(),this.queue.clear(),this.updateProgress(),this.checkLoadQueue(),this.systems.events.on(l.UPDATE,this.update,this)));},updateProgress:function(){this.progress=1-(this.list.size+this.inflight.size)/this.totalToLoad,this.emit(a.PROGRESS,this.progress);},update:function(){this.state===s.LOADER_LOADING&&0<this.list.size&&this.inflight.size<this.maxParallelDownloads&&this.checkLoadQueue();},checkLoadQueue:function(){this.list.each(function(t){if((t.state===s.FILE_POPULATED||t.state===s.FILE_PENDING&&this.inflight.size<this.maxParallelDownloads)&&(this.inflight.set(t),this.list.delete(t),t.crossOrigin||(t.crossOrigin=this.crossOrigin),t.load()),this.inflight.size===this.maxParallelDownloads)return!1;},this);},nextFile:function(t,e){this.inflight&&(this.inflight.delete(t),this.updateProgress(),e?(this.totalComplete++,this.queue.set(t),this.emit(a.FILE_LOAD,t),t.onProcess()):(this.totalFailed++,this._deleteQueue.set(t),this.emit(a.FILE_LOAD_ERROR,t),this.fileProcessComplete(t)));},fileProcessComplete:function(t){this.scene&&this.systems&&this.systems.game&&!this.systems.game.pendingDestroy&&(t.state===s.FILE_ERRORED?t.multiFile&&t.multiFile.onFileFailed(t):t.state===s.FILE_COMPLETE&&(t.multiFile?t.multiFile.isReadyToProcess()&&t.multiFile.addToCache():t.addToCache()),this.queue.delete(t),0===this.list.size&&0===this.inflight.size&&0===this.queue.size&&this.loadComplete());},loadComplete:function(){this.emit(a.POST_PROCESS,this),this.list.clear(),this.inflight.clear(),this.queue.clear(),this.progress=1,this.state=s.LOADER_COMPLETE,this.systems.events.off(l.UPDATE,this.update,this),this._deleteQueue.iterateLocal("destroy"),this._deleteQueue.clear(),this.emit(a.COMPLETE,this,this.totalComplete,this.totalFailed);},flagForRemoval:function(t){this._deleteQueue.set(t);},saveJSON:function(t,e){return this.save(JSON.stringify(t),e);},save:function(t,e,i){void 0===e&&(e="file.json"),void 0===i&&(i="application/json");var n=new Blob([t],{type:i}),s=URL.createObjectURL(n),r=document.createElement("a");return r.download=e,r.textContent="Download "+e,r.href=s,r.click(),this;},reset:function(){this.list.clear(),this.inflight.clear(),this.queue.clear();var t=this.systems.game.config,e=this.systems.settings.loader;this.setBaseURL(v(e,"baseURL",t.loaderBaseURL)),this.setPath(v(e,"path",t.loaderPath)),this.setPrefix(v(e,"prefix",t.loaderPrefix)),this.state=s.LOADER_IDLE;},shutdown:function(){this.reset(),this.state=s.LOADER_SHUTDOWN,this.systems.events.off(l.UPDATE,this.update,this),this.systems.events.off(l.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.state=s.LOADER_DESTROYED,this.systems.events.off(l.UPDATE,this.update,this),this.systems.events.off(l.START,this.pluginStart,this),this.list=null,this.inflight=null,this.queue=null,this.scene=null,this.systems=null,this.textureManager=null,this.cacheManager=null,this.sceneManager=null;}});u.register("Loader",d,"load"),t.exports=d;},function(t,e,i){var n=i(62),s=i(17)(!1,s={ArcadePhysics:i(1367),Body:i(527),Collider:i(528),Components:i(243),Events:i(245),Factory:i(521),GetOverlapX:i(246),GetOverlapY:i(247),SeparateX:i(537),SeparateY:i(538),Group:i(524),Image:i(522),Sprite:i(157),StaticBody:i(539),StaticGroup:i(525),Tilemap:i(1391),World:i(526)},n);t.exports=s;},function(t,e,i){var n=i(0),s=i(36),o=i(50),c=i(353),r=i(521),a=i(2),h=i(127),u=i(523),l=i(244),d=i(24),f=i(20),p=i(3),g=i(526),v=new n({initialize:function(t){this.scene=t,this.systems=t.sys,this.config=this.getConfig(),this.world,this.add,t.sys.events.once(f.BOOT,this.boot,this),t.sys.events.on(f.START,this.start,this);},boot:function(){this.world=new g(this.scene,this.config),this.add=new r(this.world),this.systems.events.once(f.DESTROY,this.destroy,this);},start:function(){this.world||(this.world=new g(this.scene,this.config),this.add=new r(this.world));var t=this.systems.events;a(this.config,"customUpdate",!1)||t.on(f.UPDATE,this.world.update,this.world),t.on(f.POST_UPDATE,this.world.postUpdate,this.world),t.once(f.SHUTDOWN,this.shutdown,this);},enableUpdate:function(){this.systems.events.on(f.UPDATE,this.world.update,this.world);},disableUpdate:function(){this.systems.events.off(f.UPDATE,this.world.update,this.world);},getConfig:function(){var t=this.systems.game.config.physics,e=this.systems.settings.physics;return h(a(e,"arcade",{}),a(t,"arcade",{}));},overlap:function(t,e,i,n,s){return void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=i),this.world.collideObjects(t,e,i,n,s,!0);},collide:function(t,e,i,n,s){return void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=i),this.world.collideObjects(t,e,i,n,s,!1);},collideTiles:function(t,e,i,n,s){return this.world.collideTiles(t,e,i,n,s);},overlapTiles:function(t,e,i,n,s){return this.world.overlapTiles(t,e,i,n,s);},pause:function(){return this.world.pause();},resume:function(){return this.world.resume();},accelerateTo:function(t,e,i,n,s,r){void 0===n&&(n=60);var o=Math.atan2(i-t.y,e-t.x);return t.body.acceleration.setToPolar(o,n),void 0!==s&&void 0!==r&&t.body.maxVelocity.set(s,r),o;},accelerateToObject:function(t,e,i,n,s){return this.accelerateTo(t,e.x,e.y,i,n,s);},closest:function(t,e){e=e||this.world.bodies.entries;for(var i=Number.MAX_VALUE,n=null,s=t.x,r=t.y,o=e.length,a=0;a<o;a++){var h,u=e[a],l=u.body||u;t!==u&&t!==l&&t!==l.gameObject&&t!==l.center&&(h=c(s,r,l.center.x,l.center.y))<i&&(n=u,i=h);}return n;},furthest:function(t,e){e=e||this.world.bodies.entries;for(var i=-1,n=null,s=t.x,r=t.y,o=e.length,a=0;a<o;a++){var h,u=e[a],l=u.body||u;t!==u&&t!==l&&t!==l.gameObject&&t!==l.center&&i<(h=c(s,r,l.center.x,l.center.y))&&(n=u,i=h);}return n;},moveTo:function(t,e,i,n,s){void 0===n&&(n=60),void 0===s&&(s=0);var r=Math.atan2(i-t.y,e-t.x);return 0<s&&(n=o(t.x,t.y,e,i)/(s/1e3)),t.body.velocity.setToPolar(r,n),r;},moveToObject:function(t,e,i,n){return this.moveTo(t,e.x,e.y,i,n);},velocityFromAngle:function(t,e,i){return void 0===e&&(e=60),void 0===i&&(i=new p()),i.setToPolar(s(t),e);},velocityFromRotation:function(t,e,i){return void 0===e&&(e=60),void 0===i&&(i=new p()),i.setToPolar(t,e);},overlapRect:function(t,e,i,n,s,r){return l(this.world,t,e,i,n,s,r);},overlapCirc:function(t,e,i,n,s){return u(this.world,t,e,i,n,s);},shutdown:function(){var t;this.world&&((t=this.systems.events).off(f.UPDATE,this.world.update,this.world),t.off(f.POST_UPDATE,this.world.postUpdate,this.world),t.off(f.SHUTDOWN,this.shutdown,this),this.add.destroy(),this.world.destroy(),this.add=null,this.world=null);},destroy:function(){this.shutdown(),this.scene.sys.events.off(f.START,this.start,this),this.scene=null,this.systems=null;}});d.register("ArcadePhysics",v,"arcadePhysics"),t.exports=v;},function(t,e){t.exports={setAcceleration:function(t,e){return this.body.acceleration.set(t,e),this;},setAccelerationX:function(t){return this.body.acceleration.x=t,this;},setAccelerationY:function(t){return this.body.acceleration.y=t,this;}};},function(t,e){t.exports={setAngularVelocity:function(t){return this.body.angularVelocity=t,this;},setAngularAcceleration:function(t){return this.body.angularAcceleration=t,this;},setAngularDrag:function(t){return this.body.angularDrag=t,this;}};},function(t,e){t.exports={setBounce:function(t,e){return this.body.bounce.set(t,e),this;},setBounceX:function(t){return this.body.bounce.x=t,this;},setBounceY:function(t){return this.body.bounce.y=t,this;},setCollideWorldBounds:function(t,e,i){return this.body.setCollideWorldBounds(t,e,i),this;}};},function(t,e){t.exports={setDebug:function(t,e,i){return this.debugShowBody=t,this.debugShowVelocity=e,this.debugBodyColor=i,this;},setDebugBodyColor:function(t){return this.body.debugBodyColor=t,this;},debugShowBody:{get:function(){return this.body.debugShowBody;},set:function(t){this.body.debugShowBody=t;}},debugShowVelocity:{get:function(){return this.body.debugShowVelocity;},set:function(t){this.body.debugShowVelocity=t;}},debugBodyColor:{get:function(){return this.body.debugBodyColor;},set:function(t){this.body.debugBodyColor=t;}}};},function(t,e){t.exports={setDrag:function(t,e){return this.body.drag.set(t,e),this;},setDragX:function(t){return this.body.drag.x=t,this;},setDragY:function(t){return this.body.drag.y=t,this;},setDamping:function(t){return this.body.useDamping=t,this;}};},function(t,e){var i={enableBody:function(t,e,i,n,s){return t&&this.body.reset(e,i),n&&(this.body.gameObject.active=!0),s&&(this.body.gameObject.visible=!0),this.body.enable=!0,this;},disableBody:function(t,e){return void 0===t&&(t=!1),void 0===e&&(e=!1),this.body.stop(),this.body.enable=!1,t&&(this.body.gameObject.active=!1),e&&(this.body.gameObject.visible=!1),this;},refreshBody:function(){return this.body.updateFromGameObject(),this;}};t.exports=i;},function(t,e){t.exports={setFriction:function(t,e){return this.body.friction.set(t,e),this;},setFrictionX:function(t){return this.body.friction.x=t,this;},setFrictionY:function(t){return this.body.friction.y=t,this;}};},function(t,e){t.exports={setGravity:function(t,e){return this.body.gravity.set(t,e),this;},setGravityX:function(t){return this.body.gravity.x=t,this;},setGravityY:function(t){return this.body.gravity.y=t,this;}};},function(t,e){var i={setImmovable:function(t){return void 0===t&&(t=!0),this.body.immovable=t,this;}};t.exports=i;},function(t,e){t.exports={setMass:function(t){return this.body.mass=t,this;}};},function(t,e){var i={setPushable:function(t){return void 0===t&&(t=!0),this.body.pushable=t,this;}};t.exports=i;},function(t,e){t.exports={setOffset:function(t,e){return this.body.setOffset(t,e),this;},setSize:function(t,e,i){return this.body.setSize(t,e,i),this;},setBodySize:function(t,e,i){return this.body.setSize(t,e,i),this;},setCircle:function(t,e,i){return this.body.setCircle(t,e,i),this;}};},function(t,e){t.exports={setVelocity:function(t,e){return this.body.setVelocity(t,e),this;},setVelocityX:function(t){return this.body.setVelocityX(t),this;},setVelocityY:function(t){return this.body.setVelocityY(t),this;},setMaxVelocity:function(t,e){return this.body.maxVelocity.set(t,e),this;}};},function(t,e){t.exports="collide";},function(t,e){t.exports="overlap";},function(t,e){t.exports="pause";},function(t,e){t.exports="resume";},function(t,e){t.exports="tilecollide";},function(t,e){t.exports="tileoverlap";},function(t,e){t.exports="worldbounds";},function(t,e){t.exports="worldstep";},function(t,e){var r,o,a,h,u,l,c,d,f,p,g,v,m,y,x,T,w,E=function(){return p&&x&&o.blocked.right?(r.processX(-w,c,!1,!0),1):f&&T&&o.blocked.left?(r.processX(w,c,!0),1):m&&T&&r.blocked.right?(o.processX(-w,d,!1,!0),2):v&&x&&r.blocked.left?(o.processX(w,d,!0),2):0;},b=function(t){var e;return a&&h?(w*=.5,0===t||3===t?(r.processX(w,u),o.processX(-w,l)):(r.processX(-w,u),o.processX(w,l))):a&&!h?0===t||3===t?r.processX(w,c,!0):r.processX(-w,c,!1,!0):!a&&h?0===t||3===t?o.processX(-w,d,!1,!0):o.processX(w,d,!0):(e=.5*w,0===t?y?(r.processX(w,0,!0),o.processX(0,null,!1,!0)):m?(r.processX(e,0,!0),o.processX(-e,0,!1,!0)):(r.processX(e,o.velocity.x,!0),o.processX(-e,null,!1,!0)):1===t?g?(r.processX(0,null,!1,!0),o.processX(w,0,!0)):p?(r.processX(-e,0,!1,!0),o.processX(e,0,!0)):(r.processX(-e,null,!1,!0),o.processX(e,r.velocity.x,!0)):2===t?y?(r.processX(-w,0,!1,!0),o.processX(0,null,!0)):v?(r.processX(-e,0,!1,!0),o.processX(e,0,!0)):(r.processX(-e,o.velocity.x,!1,!0),o.processX(e,null,!0)):3===t&&(g?(r.processX(0,null,!0),o.processX(-w,0,!1,!0)):f?(r.processX(e,0,!0),o.processX(-e,0,!1,!0)):(r.processX(e,o.velocity.y,!0),o.processX(-e,null,!1,!0)))),!0;};t.exports={BlockCheck:E,Check:function(){var t=r.velocity.x,e=o.velocity.x,i=Math.sqrt(e*e*o.mass/r.mass)*(0<e?1:-1),n=Math.sqrt(t*t*r.mass/o.mass)*(0<t?1:-1),s=.5*(i+n);return n-=s,u=s+(i-=s)*r.bounce.x,l=s+n*o.bounce.x,f&&T?b(0):v&&x?b(1):p&&x?b(2):!(!m||!T)&&b(3);},Set:function(t,e,i){o=e;var n=(r=t).velocity.x,s=o.velocity.x;return a=r.pushable,f=r._dx<0,p=0<r._dx,g=0===r._dx,x=Math.abs(r.right-o.x)<=Math.abs(o.right-r.x),c=s-n*r.bounce.x,h=o.pushable,v=o._dx<0,m=0<o._dx,y=0===o._dx,T=!x,d=n-s*o.bounce.x,w=Math.abs(i),E();},Run:b,RunImmovableBody1:function(t){1===t?o.velocity.x=0:x?o.processX(w,d,!0):o.processX(-w,d,!1,!0),r.moves&&(o.y+=(r.y-r.prev.y)*r.friction.y,o._dy=o.y-o.prev.y);},RunImmovableBody2:function(t){2===t?r.velocity.x=0:T?r.processX(w,c,!0):r.processX(-w,c,!1,!0),o.moves&&(r.y+=(o.y-o.prev.y)*o.friction.y,r._dy=r.y-r.prev.y);}};},function(t,e){var r,o,a,h,u,l,c,d,f,p,g,v,m,y,x,T,w,E=function(){return p&&x&&o.blocked.down?(r.processY(-w,c,!1,!0),1):f&&T&&o.blocked.up?(r.processY(w,c,!0),1):m&&T&&r.blocked.down?(o.processY(-w,d,!1,!0),2):v&&x&&r.blocked.up?(o.processY(w,d,!0),2):0;},b=function(t){var e;return a&&h?(w*=.5,0===t||3===t?(r.processY(w,u),o.processY(-w,l)):(r.processY(-w,u),o.processY(w,l))):a&&!h?0===t||3===t?r.processY(w,c,!0):r.processY(-w,c,!1,!0):!a&&h?0===t||3===t?o.processY(-w,d,!1,!0):o.processY(w,d,!0):(e=.5*w,0===t?y?(r.processY(w,0,!0),o.processY(0,null,!1,!0)):m?(r.processY(e,0,!0),o.processY(-e,0,!1,!0)):(r.processY(e,o.velocity.y,!0),o.processY(-e,null,!1,!0)):1===t?g?(r.processY(0,null,!1,!0),o.processY(w,0,!0)):p?(r.processY(-e,0,!1,!0),o.processY(e,0,!0)):(r.processY(-e,null,!1,!0),o.processY(e,r.velocity.y,!0)):2===t?y?(r.processY(-w,0,!1,!0),o.processY(0,null,!0)):v?(r.processY(-e,0,!1,!0),o.processY(e,0,!0)):(r.processY(-e,o.velocity.y,!1,!0),o.processY(e,null,!0)):3===t&&(g?(r.processY(0,null,!0),o.processY(-w,0,!1,!0)):f?(r.processY(e,0,!0),o.processY(-e,0,!1,!0)):(r.processY(e,o.velocity.y,!0),o.processY(-e,null,!1,!0)))),!0;};t.exports={BlockCheck:E,Check:function(){var t=r.velocity.y,e=o.velocity.y,i=Math.sqrt(e*e*o.mass/r.mass)*(0<e?1:-1),n=Math.sqrt(t*t*r.mass/o.mass)*(0<t?1:-1),s=.5*(i+n);return n-=s,u=s+(i-=s)*r.bounce.y,l=s+n*o.bounce.y,f&&T?b(0):v&&x?b(1):p&&x?b(2):!(!m||!T)&&b(3);},Set:function(t,e,i){o=e;var n=(r=t).velocity.y,s=o.velocity.y;return a=r.pushable,f=r._dy<0,p=0<r._dy,g=0===r._dy,x=Math.abs(r.bottom-o.y)<=Math.abs(o.bottom-r.y),c=s-n*r.bounce.y,h=o.pushable,v=o._dy<0,m=0<o._dy,y=0===o._dy,T=!x,d=n-s*o.bounce.y,w=Math.abs(i),E();},Run:b,RunImmovableBody1:function(t){1===t?o.velocity.y=0:x?o.processY(w,d,!0):o.processY(-w,d,!1,!0),r.moves&&(o.x+=(r.x-r.prev.x)*r.friction.x,o._dx=o.x-o.prev.x);},RunImmovableBody2:function(t){2===t?r.velocity.y=0:T?r.processY(w,c,!0):r.processY(-w,c,!1,!0),o.moves&&(r.x+=(o.x-o.prev.x)*o.friction.x,r._dx=r.x-r.prev.x);}};},function(t,e,i){var n={ProcessTileCallbacks:i(530),ProcessTileSeparationX:i(534),ProcessTileSeparationY:i(536),SeparateTile:i(532),TileCheckX:i(533),TileCheckY:i(535),TileIntersectsBody:i(248)};t.exports=n;},,,,,,,,,,,,function(t,e,i){t.exports={BasePlugin:i(540),DefaultPlugins:i(197),PluginCache:i(24),PluginManager:i(414),ScenePlugin:i(1404)};},function(t,e,i){var n=i(540),s=i(0),r=i(20),o=new s({Extends:n,initialize:function(t,e,i){n.call(this,e),this.scene=t,this.systems=t.sys,this.pluginKey=i,t.sys.events.once(r.BOOT,this.boot,this);},boot:function(){},destroy:function(){this.pluginManager=null,this.game=null,this.scene=null,this.systems=null;}});t.exports=o;},function(t,e,i){t.exports={Canvas:i(1406),Events:i(91),Snapshot:i(1407),WebGL:i(1408)};},function(t,e,i){t.exports={CanvasRenderer:i(368),GetBlendModes:i(370),SetTransform:i(30)};},function(t,e,i){t.exports={Canvas:i(369),WebGL:i(383)};},function(t,e,i){var n=i(107),s=i(17)(!1,s={PipelineManager:i(372),Pipelines:i(1409),RenderTarget:i(141),Utils:i(12),WebGLPipeline:i(58),WebGLRenderer:i(371),WebGLShader:i(375)},n);t.exports=s;},function(t,e,i){var n=i(92),s=i(17)(!1,s={BitmapMaskPipeline:i(373),Events:i(374),GraphicsPipeline:i(376),LightPipeline:i(377),MultiPipeline:i(108),PointLightPipeline:i(378),PostFXPipeline:i(1410),RopePipeline:i(379),SinglePipeline:i(380),UtilityPipeline:i(381)},n);t.exports=s;},function(t,e,i){var n=i(0),s=i(198),r=i(2),o=i(1411),a=i(382),h=i(58),u=new n({Extends:h,initialize:function(t){t.renderTarget=r(t,"renderTarget",1),t.fragShader=r(t,"fragShader",o),t.vertShader=r(t,"vertShader",a),t.attributes=r(t,"attributes",[{name:"inPosition",size:2},{name:"inTexCoord",size:2}]),t.batchSize=1,t.vertices=[-1,-1,0,0,-1,1,0,1,1,1,1,1,-1,-1,0,0,1,1,1,1,1,-1,1,0],h.call(this,t),this.isPostFX=!0,this.gameObject,this.colorMatrix=new s(),this.fullFrame1,this.fullFrame2,this.halfFrame1,this.halfFrame2,this.renderer.isBooted&&(this.manager=this.renderer.pipelines,this.boot());},boot:function(){h.prototype.boot.call(this);var t=this.manager.UTILITY_PIPELINE;this.fullFrame1=t.fullFrame1,this.fullFrame2=t.fullFrame2,this.halfFrame1=t.halfFrame1,this.halfFrame2=t.halfFrame2,this.set1i("uMainSampler",0);},onDraw:function(t){this.bindAndDraw(t);},copyFrame:function(t,e,i,n,s){this.manager.copyFrame(t,e,i,n,s);},copyToGame:function(t){this.manager.copyToGame(t);},drawFrame:function(t,e,i){this.manager.drawFrame(t,e,i,this.colorMatrix);},blendFrames:function(t,e,i,n,s){this.manager.blendFrames(t,e,i,n,s);},blendFramesAdditive:function(t,e,i,n,s){this.manager.blendFramesAdditive(t,e,i,n,s);},clearFrame:function(t,e){this.manager.clearFrame(t,e);},blitFrame:function(t,e,i,n,s,r){this.manager.blitFrame(t,e,i,n,s,r);},copyFrameRect:function(t,e,i,n,s,r,o,a){this.manager.copyFrameRect(t,e,i,n,s,r,o,a);},bindAndDraw:function(t,e,i,n,s){void 0===i&&(i=!0),void 0===n&&(n=!0);var r=this.gl,o=this.renderer;this.bind(s),this.set1i("uMainSampler",0),e?(r.viewport(0,0,e.width,e.height),r.bindFramebuffer(r.FRAMEBUFFER,e.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.texture,0),i&&(n?r.clearColor(0,0,0,0):r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT))):(o.popFramebuffer(!1,!1,!1),o.currentFramebuffer||r.viewport(0,0,o.width,o.height)),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,t.texture),r.bufferData(r.ARRAY_BUFFER,this.vertexData,r.STATIC_DRAW),r.drawArrays(r.TRIANGLES,0,6),e?(r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null)):o.resetTextures();}});t.exports=u;},function(t,e){t.exports=["#define SHADER_NAME PHASER_POSTFX_FS","","precision mediump float;","","uniform sampler2D uMainSampler;","","varying vec2 outTexCoord;","","void main ()","{","    gl_FragColor = texture2D(uMainSampler, outTexCoord);","}",""].join("\n");},function(t,e,i){var n=i(17),s=i(201),r=n(!1,r={Center:i(403),Events:i(104),Orientation:i(404),ScaleManager:i(415),ScaleModes:i(405),Zoom:i(406)},s.CENTER);r=n(!1,r,s.ORIENTATION),r=n(!1,r,s.SCALE_MODE),r=n(!1,r,s.ZOOM),t.exports=r;},function(t,e,i){var n=i(144),s=i(17)(!1,s={Events:i(20),GetPhysicsPlugins:i(419),GetScenePlugins:i(420),SceneManager:i(417),ScenePlugin:i(1414),Settings:i(421),Systems:i(204)},n);t.exports=s;},function(t,e,i){var n=i(18),s=i(0),a=i(20),h=i(2),r=i(24),o=new s({initialize:function(t){this.scene=t,this.systems=t.sys,this.settings=t.sys.settings,this.key=t.sys.settings.key,this.manager=t.sys.game.scene,this.transitionProgress=0,this._elapsed=0,this._target=null,this._duration=0,this._onUpdate,this._onUpdateScope,this._willSleep=!1,this._willRemove=!1,t.sys.events.once(a.BOOT,this.boot,this),t.sys.events.on(a.START,this.pluginStart,this);},boot:function(){this.systems.events.once(a.DESTROY,this.destroy,this);},pluginStart:function(){this._target=null,this.systems.events.once(a.SHUTDOWN,this.shutdown,this);},start:function(t,e){return void 0===t&&(t=this.key),this.manager.queueOp("stop",this.key),this.manager.queueOp("start",t,e),this;},restart:function(t){var e=this.key;return this.manager.queueOp("stop",e),this.manager.queueOp("start",e,t),this;},transition:function(t){void 0===t&&(t={});var e=h(t,"target",!1),i=this.manager.getScene(e);if(!e||!this.checkValidTransition(i))return!1;var n=h(t,"duration",1e3);this._elapsed=0,this._target=i,this._duration=n,this._willSleep=h(t,"sleep",!1),this._willRemove=h(t,"remove",!1);var s=h(t,"onUpdate",null);s&&(this._onUpdate=s,this._onUpdateScope=h(t,"onUpdateScope",this.scene));var r=h(t,"allowInput",!1);this.settings.transitionAllowInput=r;var o=i.sys.settings;return o.isTransition=!0,o.transitionFrom=this.scene,o.transitionDuration=n,o.transitionAllowInput=r,h(t,"moveAbove",!1)?this.manager.moveAbove(this.key,e):h(t,"moveBelow",!1)&&this.manager.moveBelow(this.key,e),i.sys.isSleeping()?i.sys.wake(h(t,"data")):this.manager.start(e,h(t,"data")),this.systems.events.emit(a.TRANSITION_OUT,i,n),this.systems.events.on(a.UPDATE,this.step,this),!0;},checkValidTransition:function(t){return!(!t||t.sys.isActive()||t.sys.isTransitioning()||t===this.scene||this.systems.isTransitioning());},step:function(t,e){this._elapsed+=e,this.transitionProgress=n(this._elapsed/this._duration,0,1),this._onUpdate&&this._onUpdate.call(this._onUpdateScope,this.transitionProgress),this._elapsed>=this._duration&&this.transitionComplete();},transitionComplete:function(){var t=this._target.sys,e=this._target.sys.settings;this.systems.events.off(a.UPDATE,this.step,this),t.events.emit(a.TRANSITION_COMPLETE,this.scene),e.isTransition=!1,e.transitionFrom=null,this._duration=0,this._target=null,this._onUpdate=null,this._onUpdateScope=null,this._willRemove?this.manager.remove(this.key):this._willSleep?this.systems.sleep():this.manager.stop(this.key);},add:function(t,e,i,n){return this.manager.add(t,e,i,n);},launch:function(t,e){return t&&t!==this.key&&this.manager.queueOp("start",t,e),this;},run:function(t,e){return t&&t!==this.key&&this.manager.queueOp("run",t,e),this;},pause:function(t,e){return void 0===t&&(t=this.key),this.manager.queueOp("pause",t,e),this;},resume:function(t,e){return void 0===t&&(t=this.key),this.manager.queueOp("resume",t,e),this;},sleep:function(t,e){return void 0===t&&(t=this.key),this.manager.queueOp("sleep",t,e),this;},wake:function(t,e){return void 0===t&&(t=this.key),this.manager.queueOp("wake",t,e),this;},switch:function(t){return t!==this.key&&this.manager.queueOp("switch",this.key,t),this;},stop:function(t,e){return void 0===t&&(t=this.key),this.manager.queueOp("stop",t,e),this;},setActive:function(t,e,i){void 0===e&&(e=this.key);var n=this.manager.getScene(e);return n&&n.sys.setActive(t,i),this;},setVisible:function(t,e){void 0===e&&(e=this.key);var i=this.manager.getScene(e);return i&&i.sys.setVisible(t),this;},isSleeping:function(t){return void 0===t&&(t=this.key),this.manager.isSleeping(t);},isActive:function(t){return void 0===t&&(t=this.key),this.manager.isActive(t);},isPaused:function(t){return void 0===t&&(t=this.key),this.manager.isPaused(t);},isVisible:function(t){return void 0===t&&(t=this.key),this.manager.isVisible(t);},swapPosition:function(t,e){return void 0===e&&(e=this.key),t!==e&&this.manager.swapPosition(t,e),this;},moveAbove:function(t,e){return void 0===e&&(e=this.key),t!==e&&this.manager.moveAbove(t,e),this;},moveBelow:function(t,e){return void 0===e&&(e=this.key),t!==e&&this.manager.moveBelow(t,e),this;},remove:function(t){return void 0===t&&(t=this.key),this.manager.remove(t),this;},moveUp:function(t){return void 0===t&&(t=this.key),this.manager.moveUp(t),this;},moveDown:function(t){return void 0===t&&(t=this.key),this.manager.moveDown(t),this;},bringToTop:function(t){return void 0===t&&(t=this.key),this.manager.bringToTop(t),this;},sendToBack:function(t){return void 0===t&&(t=this.key),this.manager.sendToBack(t),this;},get:function(t){return this.manager.getScene(t);},getIndex:function(t){return void 0===t&&(t=this.key),this.manager.getIndex(t);},shutdown:function(){var t=this.systems.events;t.off(a.SHUTDOWN,this.shutdown,this),t.off(a.POST_UPDATE,this.step,this),t.off(a.TRANSITION_OUT);},destroy:function(){this.shutdown(),this.scene.sys.events.off(a.START,this.start,this),this.scene=null,this.systems=null,this.settings=null,this.manager=null;}});r.register("ScenePlugin",o,"scenePlugin"),t.exports=o;},function(t,e,i){t.exports={Events:i(438),List:i(110),Map:i(102),ProcessQueue:i(211),RTree:i(531),Set:i(149),Size:i(416)};},function(t,e,i){var n=i(17),s=i(1417),r=n(!1,r={CanvasTexture:i(423),Events:i(106),FilterMode:s,Frame:i(109),Parsers:i(425),Texture:i(206),TextureManager:i(422),TextureSource:i(424)},s);t.exports=r;},function(t,e){t.exports={LINEAR:0,NEAREST:1};},function(t,e,i){var n=i(17),s=i(1419),r=n(!1,r={Components:i(251),Parsers:i(1452),Formats:i(40),ImageCollection:i(576),ParseToTilemap:i(262),Tile:i(85),Tilemap:i(580),TilemapCreator:i(1459),TilemapFactory:i(1460),Tileset:i(122),TilemapLayer:i(581),Orientation:i(29),LayerData:i(120),MapData:i(121),ObjectLayer:i(572)},s.ORIENTATION);t.exports=r;},function(t,e,i){var n={ORIENTATION:i(29)};t.exports=n;},function(t,e,i){var p=i(26),g=i(63);t.exports=function(t,e,i,n,s,r,o,a){void 0===o&&(o=!0),t<0&&(t=0),e<0&&(e=0);for(var h=p(t,e,i,n,null,a),u=s-t,l=r-e,c=0;c<h.length;c++){var d=h[c].x+u,f=h[c].y+l;0<=d&&d<a.width&&0<=f&&f<a.height&&a.data[f][d]&&a.data[f][d].copy(h[c]);}o&&g(s-1,r-1,i+2,n+2,a);};},function(t,e,i){var d=i(26),f=i(542);t.exports=function(t,e,i,n,s,r){i=i||{},Array.isArray(t)||(t=[t]);var o=r.tilemapLayer;n=n||o.scene,s=s||n.cameras.main;for(var a=d(0,0,r.width,r.height,null,r),h=[],u=0;u<a.length;u++){var l,c=a[u];-1!==t.indexOf(c.index)&&(l=o.tileToWorldXY(c.x,c.y,void 0,s,r),i.x=l.x,i.y=l.y,h.push(n.make.sprite(i)));}if("number"==typeof e)for(u=0;u<t.length;u++)f(t[u],e,0,0,r.width,r.height,r);else if(Array.isArray(e))for(u=0;u<t.length;u++)f(t[u],e[u],0,0,r.width,r.height,r);return h;};},function(t,e,i){var l=i(26),c=i(63),d=i(72);t.exports=function(t,e,i,n,s,r,o){for(var a=-1!==o.collideIndexes.indexOf(t),h=l(e,i,n,s,null,o),u=0;u<h.length;u++)h[u].index=t,d(h[u],a);r&&c(e-1,i-1,n+2,s+2,o);};},function(t,e,i){var h=i(26);t.exports=function(t,e,i,n,s,r,o,a){return h(i,n,s,r,o,a).filter(t,e);};},function(t,e){t.exports=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=!1);var s,r,o,a=0;if(i){for(r=n.height-1;0<=r;r--)for(s=n.width-1;0<=s;s--)if((o=n.data[r][s])&&o.index===t){if(a===e)return o;a+=1;}}else for(r=0;r<n.height;r++)for(s=0;s<n.width;s++)if((o=n.data[r][s])&&o.index===t){if(a===e)return o;a+=1;}return null;};},function(t,e,i){var h=i(26);t.exports=function(t,e,i,n,s,r,o,a){return h(i,n,s,r,o,a).find(t,e)||null;};},function(t,e,i){var h=i(26);t.exports=function(t,e,i,n,s,r,o,a){h(i,n,s,r,o,a).forEach(t,e);};},function(t,e,i){var n=i(29),s=i(544),r=i(545),o=i(547),a=i(1),h=i(548);t.exports=function(t){return t===n.ORTHOGONAL?s:t===n.HEXAGONAL?r:t===n.STAGGERED?h:t===n.ISOMETRIC?o:a;};},function(t,e,i){var r=i(158),o=new(i(3))();t.exports=function(t,e,i,n,s){return s.tilemapLayer.worldToTileXY(t,e,!0,o,n),r(o.x,o.y,i,s);};},function(t,e,i){function y(t,e){return w.RectangleToTriangle(e,t);}var x=i(483),T=i(26),w=i(484),E=i(1),n=i(3),b=new n(),S=new n(),A=new n();t.exports=function(t,e,i,n){if(void 0===t)return[];var s=E;t instanceof x.Circle?s=w.CircleToRectangle:t instanceof x.Rectangle?s=w.RectangleToRectangle:t instanceof x.Triangle?s=y:t instanceof x.Line&&(s=w.LineToRectangle),n.tilemapLayer.worldToTileXY(t.left,t.top,!0,S,i);var r=S.x,o=S.y;n.tilemapLayer.worldToTileXY(t.right,t.bottom,!0,A,i);var a=Math.ceil(A.x),h=Math.ceil(A.y),u=Math.max(a-r,1),l=Math.max(h-o,1),c=T(r,o,u,l,e,n),d=n.tileWidth,f=n.tileHeight;n.tilemapLayer&&(d*=n.tilemapLayer.scaleX,f*=n.tilemapLayer.scaleY);for(var p=[],g=new x.Rectangle(0,0,d,f),v=0;v<c.length;v++){var m=c[v];n.tilemapLayer.tileToWorldXY(m.x,m.y,b,i),g.x=b.x,g.y=b.y,s(t,g)&&p.push(m);}return p;};},function(t,e,i){var n=i(29),s=i(1),r=i(253);t.exports=function(t){return t===n.ORTHOGONAL?r:s;};},function(t,e,i){var n=i(29),s=i(550),r=i(551),o=i(1),a=i(552),h=i(553);t.exports=function(t){return t===n.ORTHOGONAL?h:t===n.ISOMETRIC?r:t===n.HEXAGONAL?s:t===n.STAGGERED?a:o;};},function(t,e,i){var n=i(29),s=i(554),r=i(1),o=i(555),a=i(254);t.exports=function(t){return t===n.ORTHOGONAL?a:t===n.HEXAGONAL?s:t===n.STAGGERED?o:r;};},function(t,e,i){var n=i(29),s=i(1),r=i(255);t.exports=function(t){return t===n.ORTHOGONAL?r:s;};},function(t,e,i){var n=i(29),s=i(556),r=i(557),o=i(1),a=i(558),h=i(559);t.exports=function(t){return t===n.ORTHOGONAL?h:t===n.ISOMETRIC?r:t===n.HEXAGONAL?s:t===n.STAGGERED?a:o;};},function(t,e,i){var n=i(29),s=i(560),r=i(1),o=i(561),a=i(256);t.exports=function(t){return t===n.ORTHOGONAL?a:t===n.HEXAGONAL?s:t===n.STAGGERED?o:r;};},function(t,e,i){var o=i(562),a=new(i(3))();t.exports=function(t,e,i,n){n.tilemapLayer.worldToTileXY(t,e,!0,a,i);var s=a.x,r=a.y;return o(s,r,n);};},function(t,e,i){var o=i(257),a=new(i(3))();t.exports=function(t,e,i,n,s,r){return r.tilemapLayer.worldToTileXY(e,i,!0,a,s,r),o(t,a.x,a.y,n,r);};},function(t,e,i){var l=i(63),c=i(257);t.exports=function(t,e,i,n,s){if(void 0===n&&(n=!0),!Array.isArray(t))return null;Array.isArray(t[0])||(t=[t]);for(var r=t.length,o=t[0].length,a=0;a<r;a++)for(var h=0;h<o;h++){var u=t[a][h];c(u,e+h,i+a,!1,s);}n&&l(e-1,i-1,o+2,r+2,s);};},function(t,e,i){var h=i(26),u=i(210);t.exports=function(t,e,i,n,s,r){var o,a=h(t,e,i,n,{},r);if(!s)for(s=[],o=0;o<a.length;o++)-1===s.indexOf(a[o].index)&&s.push(a[o].index);for(o=0;o<a.length;o++)a[o].index=u(s);};},function(t,e,i){var o=i(563),a=new(i(3))();t.exports=function(t,e,i,n,s,r){return r.tilemapLayer.worldToTileXY(t,e,!0,a,s,r),o(a.x,a.y,i,n,r);};},function(t,e,i){var p=i(26),n=i(397),g=new n(105,210,231,150),v=new n(243,134,48,200),m=new n(40,39,37,150);t.exports=function(t,e,i){void 0===e&&(e={});var n=void 0!==e.tileColor?e.tileColor:g,s=void 0!==e.collidingTileColor?e.collidingTileColor:v,r=void 0!==e.faceColor?e.faceColor:m,o=p(0,0,i.width,i.height,null,i);t.translateCanvas(i.tilemapLayer.x,i.tilemapLayer.y),t.scaleCanvas(i.tilemapLayer.scaleX,i.tilemapLayer.scaleY);for(var a=0;a<o.length;a++){var h=o[a],u=h.width,l=h.height,c=h.pixelX,d=h.pixelY,f=h.collides?s:n;null!==f&&(t.fillStyle(f.color,f.alpha/255),t.fillRect(c,d,u,l)),c+=1,d+=1,u-=2,l-=2,null!==r&&(t.lineStyle(1,r.color,r.alpha/255),h.faceTop&&t.lineBetween(c,d,c+u,d),h.faceRight&&t.lineBetween(c+u,d,c+u,d+l),h.faceBottom&&t.lineBetween(c,d+l,c+u,d+l),h.faceLeft&&t.lineBetween(c,d,c,d+l));}};},function(t,e,i){var u=i(72),l=i(63),c=i(160);t.exports=function(t,e,i,n,s){void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===s&&(s=!0),Array.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++)c(t[r],e,n);if(s)for(var o=0;o<n.height;o++)for(var a=0;a<n.width;a++){var h=n.data[o][a];h&&-1!==t.indexOf(h.index)&&u(h,e);}i&&l(0,0,n.width,n.height,n);};},function(t,e,i){var l=i(72),c=i(63),d=i(160);t.exports=function(t,e,i,n,s,r){if(void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===r&&(r=!0),!(e<t)){for(var o=t;o<=e;o++)d(o,i,s);if(r)for(var a=0;a<s.height;a++)for(var h=0;h<s.width;h++){var u=s.data[a][h];u&&u.index>=t&&u.index<=e&&l(u,i);}n&&c(0,0,s.width,s.height,s);}};},function(t,e,i){var a=i(72),h=i(63),u=i(160);t.exports=function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=!0),Array.isArray(t)||(t=[t]);for(var s=0;s<n.height;s++)for(var r=0;r<n.width;r++){var o=n.data[s][r];o&&-1===t.indexOf(o.index)&&(a(o,e),u(o.index,e,n));}i&&h(0,0,n.width,n.height,n);};},function(t,e,i){var l=i(72),c=i(63),d=i(126);t.exports=function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=!0);for(var s=0;s<n.height;s++)for(var r=0;r<n.width;r++){var o=n.data[s][r];if(o)for(var a in t)if(d(o.properties,a)){var h=t[a];Array.isArray(h)||(h=[h]);for(var u=0;u<h.length;u++)o.properties[a]===h[u]&&l(o,e);}}i&&c(0,0,n.width,n.height,n);};},function(t,e,i){var a=i(72),h=i(63);t.exports=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!0);for(var n=0;n<i.height;n++)for(var s=0;s<i.width;s++){var r,o=i.data[n][s];o&&(r=o.getCollisionGroup())&&r.objects&&0<r.objects.length&&a(o,t);}e&&h(0,0,i.width,i.height,i);};},function(t,e){t.exports=function(t,e,i,n){if("number"==typeof t)n.callbacks[t]=null!==e?{callback:e,callbackContext:i}:void 0;else for(var s=0,r=t.length;s<r;s++)n.callbacks[t[s]]=null!==e?{callback:e,callbackContext:i}:void 0;};},function(t,e,i){var u=i(26);t.exports=function(t,e,i,n,s,r,o){for(var a=u(t,e,i,n,null,o),h=0;h<a.length;h++)a[h].setCollisionCallback(s,r);};},function(t,e,i){var h=i(26),u=i(131);t.exports=function(t,e,i,n,s){var r=h(t,e,i,n,null,s),o=r.map(function(t){return t.index;});u(o);for(var a=0;a<r.length;a++)r[a].index=o[a];};},function(t,e,i){var u=i(26);t.exports=function(t,e,i,n,s,r,o){for(var a=u(i,n,s,r,null,o),h=0;h<a.length;h++)a[h]&&(a[h].index===t?a[h].index=e:a[h].index===e&&(a[h].index=t));};},function(t,e,i){var p=i(26);t.exports=function(t,e,i,n,s,r){if(s){for(var o=p(t,e,i,n,null,r),a=0,h=0;h<s.length;h++)a+=s[h].weight;if(!(a<=0))for(h=0;h<o.length;h++){for(var u=Math.random()*a,l=0,c=-1,d=0;d<s.length;d++)if(u<=(l+=s[d].weight)){var f=s[d].index,c=Array.isArray(f)?f[Math.floor(Math.random()*f.length)]:f;break;}o[h].index=c;}}};},function(t,e,i){t.exports={FromOrientationString:i(258),Parse:i(564),Parse2DArray:i(259),ParseCSV:i(565),Impact:i(1454),Tiled:i(1455)};},function(t,e){t.exports=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=i;if(n.name&&""!==n.name&&(s=n.name),Array.isArray(n.wangtiles)&&0<n.wangtiles.length){var r,o,a,h={},u={};if(Array.isArray(n.edgecolors))for(r=0;r<n.edgecolors.length;r++)a=1+r,""!==(o=n.edgecolors[r]).name&&(h[a]=o.name);if(Array.isArray(n.cornercolors))for(r=0;r<n.cornercolors.length;r++)a=1+r,""!==(o=n.cornercolors[r]).name&&(u[a]=o.name);if(Array.isArray(n.colors))for(r=0;r<n.colors.length;r++)a=1+r,""!==(o=n.colors[r]).name&&(h[a]=u[a]=o.name);for(var l=[h,u,h,u,h,u,h,u],c=0;c<n.wangtiles.length;c++){for(var d,f=n.wangtiles[c],p=(p=e[f.tileid]||(e[f.tileid]={})).wangid||(p.wangid={}),g=[],v=0;v<Math.min(l.length,f.wangid.length);v++){0!==(o=f.wangid[v])?void 0===(d=l[v][o])?g.push(o):g.push(d):g.push(void 0);}p[s]=g;}}}};},function(t,e,i){t.exports={ParseTileLayers:i(578),ParseTilesets:i(579),ParseWeltmeister:i(577)};},function(t,e,i){t.exports={AssignTileProperties:i(567),Base64Decode:i(574),BuildTilesetIndex:i(568),CreateGroupLayer:i(161),ParseGID:i(261),ParseImageLayers:i(569),ParseJSONTiled:i(566),ParseObject:i(260),ParseObjectLayers:i(570),ParseTileLayers:i(573),ParseTilesets:i(575)};},function(t,e,i){var n=i(1),s=i(1),n=i(1457),s=i(1458);t.exports={renderWebGL:n,renderCanvas:s};},function(t,e,i){var R=i(12);t.exports=function(t,e,i){var n=e.cull(i),s=n.length,r=i.alpha*e.alpha;if(!(0===s||r<=0)){var o=e.gidMap,a=t.pipelines.set(e.pipeline,e),h=R.getTintAppendFloatAlpha,u=e.scrollFactorX,l=e.scrollFactorY,c=e.x,d=e.y,f=e.scaleX,p=e.scaleY;t.pipelines.preBatch(e);for(var g=0;g<s;g++){var v,m,y,x,T,w,E,b,S,A,_=n[g],C=o[_.index];C&&null!==(v=C.getTileTextureCoordinates(_.index))&&(m=C.glTexture,y=a.setTexture2D(m,e),x=C.tileWidth,T=C.tileHeight,w=v.x,E=v.y,b=.5*C.tileWidth,S=.5*C.tileHeight,A=h(_.tint,r*_.alpha),a.batchTexture(e,m,m.width,m.height,c+(b+_.pixelX)*f,d+(S+_.pixelY)*p,_.width,_.height,f,p,_.rotation,_.flipX,_.flipY,u,l,b,S,w,E,x,T,A,A,A,A,!1,0,0,i,null,!0,y));}t.pipelines.postBatch(e);}};},function(t,e,i){var n=i(25),w=new n(),E=new n(),b=new n();t.exports=function(t,e,i,n){var s=e.cull(i),r=s.length,o=i.alpha*e.alpha;if(!(0===r||o<=0)){var a=w,h=E,u=b;h.applyITRS(e.x,e.y,e.rotation,e.scaleX,e.scaleY),a.copyFrom(i.matrix);var l=t.currentContext,c=e.gidMap;l.save(),n?(a.multiplyWithOffset(n,-i.scrollX*e.scrollFactorX,-i.scrollY*e.scrollFactorY),h.e=e.x,h.f=e.y,a.multiply(h,u),u.copyToContext(l)):(h.e-=i.scrollX*e.scrollFactorX,h.f-=i.scrollY*e.scrollFactorY,h.copyToContext(l)),(!t.antialias||1<e.scaleX||1<e.scaleY)&&(l.imageSmoothingEnabled=!1);for(var d=0;d<r;d++){var f,p,g,v,m,y,x=s[d],T=c[x.index];T&&(f=T.image.getSourceImage(),null!==(p=T.getTileTextureCoordinates(x.index))&&(m=.5*(g=T.tileWidth),y=.5*(v=T.tileHeight),l.save(),l.translate(x.pixelX+m,x.pixelY+y),0!==x.rotation&&l.rotate(x.rotation),(x.flipX||x.flipY)&&l.scale(x.flipX?-1:1,x.flipY?-1:1),l.globalAlpha=o*x.alpha,l.drawImage(f,p.x,p.y,g,v,-m,-y,g,v),l.restore()));}l.restore();}};},function(t,e,i){var n=i(16),s=i(262);n.register("tilemap",function(t){var e=void 0!==t?t:{};return s(this.scene,e.key,e.tileWidth,e.tileHeight,e.width,e.height,e.data,e.insertNull);});},function(t,e,i){var n=i(5),a=i(262);n.register("tilemap",function(t,e,i,n,s,r,o){return null===t&&(t=void 0),null===e&&(e=void 0),null===i&&(i=void 0),null===n&&(n=void 0),null===s&&(s=void 0),a(this.scene,t,e,i,n,s,r,o);});},function(t,e,i){t.exports={Clock:i(1462),TimerEvent:i(582)};},function(t,e,i){var n=i(0),s=i(24),r=i(20),o=i(582),a=i(93),h=new n({initialize:function(t){this.scene=t,this.systems=t.sys,this.now=0,this.timeScale=1,this.paused=!1,this._active=[],this._pendingInsertion=[],this._pendingRemoval=[],t.sys.events.once(r.BOOT,this.boot,this),t.sys.events.on(r.START,this.start,this);},boot:function(){this.now=this.systems.game.loop.time,this.systems.events.once(r.DESTROY,this.destroy,this);},start:function(){var t=this.systems.events;t.on(r.PRE_UPDATE,this.preUpdate,this),t.on(r.UPDATE,this.update,this),t.once(r.SHUTDOWN,this.shutdown,this);},addEvent:function(t){var e;return t instanceof o?(e=t,this.removeEvent(e),e.elapsed=e.startAt,e.hasDispatched=!1,e.repeatCount=-1===e.repeat||e.loop?999999999999:e.repeat):e=new o(t),this._pendingInsertion.push(e),e;},delayedCall:function(t,e,i,n){return this.addEvent({delay:t,callback:e,args:i,callbackScope:n});},clearPendingEvents:function(){return this._pendingInsertion=[],this;},removeEvent:function(t){Array.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];a(this._pendingRemoval,i),a(this._pendingInsertion,i),a(this._active,i);}return this;},removeAllEvents:function(){return this._pendingRemoval=this._pendingRemoval.concat(this._active),this;},preUpdate:function(){var t=this._pendingRemoval.length,e=this._pendingInsertion.length;if(0!==t||0!==e){for(var i,n=0;n<t;n++){i=this._pendingRemoval[n];var s=this._active.indexOf(i);-1<s&&this._active.splice(s,1),i.destroy();}for(n=0;n<e;n++)i=this._pendingInsertion[n],this._active.push(i);this._pendingRemoval.length=0,this._pendingInsertion.length=0;}},update:function(t,e){if(this.now=t,!this.paused){e*=this.timeScale;for(var i=0;i<this._active.length;i++){var n,s=this._active[i];s.paused||(s.elapsed+=e*s.timeScale,s.elapsed>=s.delay&&(n=s.elapsed-s.delay,s.elapsed=s.delay,!s.hasDispatched&&s.callback&&(s.hasDispatched=!0,s.callback.apply(s.callbackScope,s.args)),0<s.repeatCount?(s.repeatCount--,s.elapsed=n,s.hasDispatched=!1):this._pendingRemoval.push(s)));}}},shutdown:function(){for(var t=0;t<this._pendingInsertion.length;t++)this._pendingInsertion[t].destroy();for(t=0;t<this._active.length;t++)this._active[t].destroy();for(t=0;t<this._pendingRemoval.length;t++)this._pendingRemoval[t].destroy();this._active.length=0,this._pendingRemoval.length=0,this._pendingInsertion.length=0;var e=this.systems.events;e.off(r.PRE_UPDATE,this.preUpdate,this),e.off(r.UPDATE,this.update,this),e.off(r.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.scene.sys.events.off(r.START,this.start,this),this.scene=null,this.systems=null;}});s.register("Clock",h,"time"),t.exports=h;},function(t,e,i){var n=i(100),s=i(17)(!1,s={Builders:i(1464),Events:i(267),TweenManager:i(1480),Tween:i(266),TweenData:i(268),Timeline:i(588)},n);t.exports=s;},function(t,e,i){t.exports={GetBoolean:i(99),GetEaseFunction:i(80),GetNewValue:i(162),GetProps:i(583),GetTargets:i(263),GetTweens:i(584),GetValueOp:i(264),NumberTweenBuilder:i(585),StaggerBuilder:i(586),TimelineBuilder:i(587),TweenBuilder:i(163)};},function(t,e){t.exports=["callbackScope","completeDelay","delay","duration","ease","easeParams","flipX","flipY","hold","loop","loopDelay","offset","onActive","onActiveParams","onActiveScope","onComplete","onCompleteParams","onCompleteScope","onLoop","onLoopParams","onLoopScope","onRepeat","onRepeatParams","onRepeatScope","onStart","onStartParams","onStartScope","onStop","onStopParams","onStopScope","onUpdate","onUpdateParams","onUpdateScope","onYoyo","onYoyoParams","onYoyoScope","paused","props","repeat","repeatDelay","targets","useFrames","yoyo"];},function(t,e){t.exports="complete";},function(t,e){t.exports="loop";},function(t,e){t.exports="pause";},function(t,e){t.exports="resume";},function(t,e){t.exports="start";},function(t,e){t.exports="update";},function(t,e){t.exports="active";},function(t,e){t.exports="complete";},function(t,e){t.exports="loop";},function(t,e){t.exports="repeat";},function(t,e){t.exports="start";},function(t,e){t.exports="stop";},function(t,e){t.exports="update";},function(t,e){t.exports="yoyo";},function(t,e,i){var n=i(93),s=i(0),r=i(585),o=i(24),a=i(20),h=i(586),u=i(587),l=i(100),c=i(163),d=new s({initialize:function(t){this.scene=t,this.systems=t.sys,this.timeScale=1,this._add=[],this._pending=[],this._active=[],this._destroy=[],this._toProcess=0,t.sys.events.once(a.BOOT,this.boot,this),t.sys.events.on(a.START,this.start,this);},boot:function(){this.systems.events.once(a.DESTROY,this.destroy,this);},start:function(){var t=this.systems.events;t.on(a.PRE_UPDATE,this.preUpdate,this),t.on(a.UPDATE,this.update,this),t.once(a.SHUTDOWN,this.shutdown,this),this.timeScale=1;},createTimeline:function(t){return u(this,t);},timeline:function(t){var e=u(this,t);return e.paused||(this._add.push(e),this._toProcess++),e;},create:function(t){return c(this,t);},add:function(t){var e=c(this,t);return this._add.push(e),this._toProcess++,e;},existing:function(t){return this._add.push(t),this._toProcess++,this;},addCounter:function(t){var e=r(this,t);return this._add.push(e),this._toProcess++,e;},stagger:function(t,e){return h(t,e);},preUpdate:function(){if(0!==this._toProcess){for(var t,e=this._destroy,i=this._active,n=this._pending,s=0;s<e.length;s++){t=e[s];var r=i.indexOf(t);-1===r?-1<(r=n.indexOf(t))&&(t.state=l.REMOVED,n.splice(r,1)):(t.state=l.REMOVED,i.splice(r,1));}for(e.length=0,e=this._add,s=0;s<e.length;s++)(t=e[s]).state===l.PENDING_ADD&&(t.init()?(t.play(),this._active.push(t)):this._pending.push(t));e.length=0,this._toProcess=0;}},update:function(t,e){var i,n=this._active;e*=this.timeScale;for(var s=0;s<n.length;s++)(i=n[s]).update(t,e)&&(this._destroy.push(i),this._toProcess++);},remove:function(t){return n(this._add,t),n(this._pending,t),n(this._active,t),n(this._destroy,t),t.state=l.REMOVED,this;},makeActive:function(t){if(-1!==this._add.indexOf(t)||-1!==this._active.indexOf(t))return this;var e=this._pending.indexOf(t);return-1!==e&&this._pending.splice(e,1),this._add.push(t),t.state=l.PENDING_ADD,this._toProcess++,this;},each:function(t,e){for(var i=[null],n=1;n<arguments.length;n++)i.push(arguments[n]);for(var s in this.list)i[0]=this.list[s],t.apply(e,i);},getAllTweens:function(){for(var t=this._active,e=[],i=0;i<t.length;i++)e.push(t[i]);return e;},getGlobalTimeScale:function(){return this.timeScale;},getTweensOf:function(t,e){void 0===e&&(e=!1);var i,n,s,r=this._active,o=[];for(Array.isArray(t)||(t=[t]),n=0;n<r.length;n++)for(i=r[n],s=0;s<t.length;s++)i.hasTarget(t[s])&&o.push(i);if(e)for(r=this._pending,n=0;n<r.length;n++)for(i=r[n],s=0;s<t.length;s++)i.hasTarget(t[s])&&o.push(i);return o;},isTweening:function(t){for(var e,i=this._active,n=0;n<i.length;n++)if((e=i[n]).hasTarget(t)&&e.isPlaying())return!0;return!1;},killAll:function(){for(var t=this.getAllTweens(),e=0;e<t.length;e++)t[e].stop();return this;},killTweensOf:function(t){for(var e=this.getTweensOf(t),i=0;i<e.length;i++)e[i].stop();return this;},pauseAll:function(){for(var t=this._active,e=0;e<t.length;e++)t[e].pause();return this;},resumeAll:function(){for(var t=this._active,e=0;e<t.length;e++)t[e].resume();return this;},setGlobalTimeScale:function(t){return this.timeScale=t,this;},shutdown:function(){this.killAll(),this._add=[],this._pending=[],this._active=[],this._destroy=[],this._toProcess=0;var t=this.systems.events;t.off(a.PRE_UPDATE,this.preUpdate,this),t.off(a.UPDATE,this.update,this),t.off(a.SHUTDOWN,this.shutdown,this);},destroy:function(){this.shutdown(),this.scene.sys.events.off(a.START,this.start,this),this.scene=null,this.systems=null;}});o.register("TweenManager",d,"tweens"),t.exports=d;},function(t,e,i){t.exports={Array:i(208),Base64:i(1482),Objects:i(1484),String:i(1488),NOOP:i(1)};},function(t,e,i){t.exports={ArrayBufferToBase64:i(1483),Base64ToArrayBuffer:i(433)};},function(t,e){var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t.exports=function(t,e){for(var i=new Uint8Array(t),n=i.length,s=e?"data:"+e+";base64,":"",r=0;r<n;r+=3)s+=o[i[r]>>2],s+=o[(3&i[r])<<4|i[r+1]>>4],s+=o[(15&i[r+1])<<2|i[r+2]>>6],s+=o[63&i[r+2]];return n%3==2?s=s.substring(0,s.length-1)+"=":n%3==1&&(s=s.substring(0,s.length-2)+"=="),s;};},function(t,e,i){t.exports={Clone:i(77),DeepCopy:i(175),Extend:i(17),GetAdvancedValue:i(13),GetFastValue:i(2),GetMinMaxValue:i(1485),GetValue:i(6),HasAll:i(1486),HasAny:i(455),HasValue:i(126),IsPlainObject:i(7),Merge:i(127),MergeRight:i(1487),Pick:i(571),SetValue:i(478)};},function(t,e,i){var o=i(6),a=i(18);t.exports=function(t,e,i,n,s){void 0===s&&(s=i);var r=o(t,e,s);return a(r,i,n);};},function(t,e){t.exports=function(t,e){for(var i=0;i<e.length;i++)if(!t.hasOwnProperty(e[i]))return!1;return!0;};},function(t,e,i){var s=i(77);t.exports=function(t,e){var i=s(t);for(var n in e)i.hasOwnProperty(n)&&(i[n]=e[n]);return i;};},function(t,e,i){t.exports={Format:i(1489),Pad:i(186),RemoveAt:i(1490),Reverse:i(1491),UppercaseFirst:i(205),UUID:i(222)};},function(t,e){t.exports=function(t,i){return t.replace(/%([0-9]+)/g,function(t,e){return i[Number(e)-1];});};},function(t,e){t.exports=function(t,e){return 0===e?t.slice(1):t.slice(0,e-1)+t.slice(e);};},function(t,e){t.exports=function(t){return t.split("").reverse().join("");};},function(t,e,i){t.exports={SoundManagerCreator:i(426),Events:i(70),BaseSound:i(146),BaseSoundManager:i(145),WebAudioSound:i(434),WebAudioSoundManager:i(432),HTML5AudioSound:i(429),HTML5AudioSoundManager:i(427),NoAudioSound:i(431),NoAudioSoundManager:i(430)};},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(s,t,r){(function(t){var e=r(33),i=r(17),n={Actions:r(275),Animations:r(723),BlendModes:r(35),Cache:r(735),Cameras:r(738),Core:r(806),Class:r(0),Create:r(888),Curves:r(894),Data:r(896),Display:r(898),DOM:r(917),Events:r(918),Game:r(920),GameObjects:r(1011),Geom:r(483),Input:r(1308),Loader:r(1338),Math:r(193),Physics:{Arcade:r(1366)},Plugins:r(1403),Renderer:r(1405),Scale:r(1412),ScaleModes:r(168),Scene:r(418),Scenes:r(1413),Structs:r(1415),Textures:r(1416),Tilemaps:r(1418),Time:r(1461),Tweens:r(1463),Utils:r(1481)};n.Sound=r(1492),n=i(!1,n,e),s.exports=n,t.Phaser=n;}).call(this,r(600));}],s.c=n,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i});},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0});},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t];}.bind(null,n));return i;},s.n=function(t){var e=t&&t.__esModule?function(){return t.default;}:function(){return t;};return s.d(e,"a",e),e;},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e);},s.p="",s(s.s=1529);function s(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports;}var i,n;});;class PhaserUnit extends Phaser.GameObjects.Container{constructor(scene,unit){super(scene);this.unit=unit;this.attributes=[];const key=`unit/${unit._stats.type}`;const sprite=this.sprite=scene.add.sprite(0,0,key);this.add(sprite);const label=this.label=scene.add.text(0,0,'cccccc');label.setOrigin(0.5);this.add(label);scene.add.existing(this);this.followListener=unit.on('follow',()=>{console.log('PhaserUnit follow',unit.id());// TODO remove
scene.cameras.main.startFollow(this,true,0.05,0.05);});this.stopFollowListener=unit.on('stop-follow',()=>{console.log('PhaserUnit stop-follow',unit.id());// TODO remove
scene.cameras.main.stopFollow();});this.playAnimationListener=unit.on('play-animation',animationId=>{console.log('PhaserUnit play-animation',`${key}/${animationId}`);// TODO remove
sprite.play(`${key}/${animationId}`);});this.updateLabelListener=unit.on('update-label',config=>{console.log('PhaserUnit update-label',unit.id());// TODO remove
label.visible=true;label.setFontFamily('Verdana');label.setFontSize(16);label.setFontStyle(config.bold?'bold':'normal');label.setFill(config.color||'#fff');const strokeThickness=ige.game.data.settings.addStrokeToNameAndAttributes!==false?4:0;label.setStroke('#000',strokeThickness);label.setText(config.text||'');label.y=-25-Math.max(sprite.displayHeight,sprite.displayWidth)/2;label.setScale(1.25);});this.hideLabelListener=unit.on('hide-label',()=>{console.log('PhaserUnit hide-label',unit.id());// TODO remove
label.visible=false;});const attributes=this.attributes;this.renderAttributesListener=unit.on('render-attributes',data=>{console.log('PhaserUnit render-attributes',data);// TODO remove
// release all existing attribute bars
attributes.forEach(a=>{PhaserAttributeBar.release(a);});attributes.length=0;// add attribute bars based on passed data
data.attrs.forEach(ad=>{const a=PhaserAttributeBar.get(this);a.render(ad);attributes.push(a);});});this.updateAttributeListener=unit.on('update-attribute',data=>{console.log('PhaserUnit update-attribute',data);// TODO remove
let a;let i=0;for(;i<attributes.length;i++){if(attributes[i].name===data.attr.type){a=attributes[i];break;}}if(!data.shouldRender){if(a){PhaserAttributeBar.release(a);attributes.splice(i,1);}return;}if(!a){a=PhaserAttributeBar.get(this);attributes.push(a);}a.render(data.attr);});this.renderChatListener=unit.on('render-chat-bubble',text=>{console.log('create-chat',text);// TODO remove
if(this.chat){this.chat.showMessage(text);}else{this.chat=new PhaserChatBubble(scene,text,this);}});/*this.renderChatBubble =
            unit.on('render-chat-bubble', (data: {
                attrs: AttributeData[]
            }) => {
                console.log('PhaserUnit render-attributes', data); // TODO remove

                // release all existing attribute bars
                attributes.forEach((a) => {
                    PhaserAttributeBar.release(a);
                });
                attributes.length = 0;

                // add attribute bars based on passed data
                data.attrs.forEach((ad) => {
                    const a = PhaserAttributeBar.get(this);
                    a.render(ad);
                    attributes.push(a);
                });
            });*/scene.events.on('update',this.update,this);}update(){const unit=this.unit;const container=unit._pixiContainer;const texture=unit._pixiTexture;if(unit._destroyed||container._destroyed){unit.off('follow',this.followListener);this.followListener=null;unit.off('stop-follow',this.stopFollowListener);this.stopFollowListener=null;unit.off('play-animation',this.playAnimationListener);this.playAnimationListener=null;unit.off('update-label',this.updateLabelListener);this.updateLabelListener=null;unit.off('hide-label',this.hideLabelListener);this.hideLabelListener=null;unit.off('render-attributes',this.renderAttributesListener);this.renderAttributesListener=null;unit.off('update-attribute',this.updateAttributeListener);this.updateAttributeListener=null;unit.off('render-chat-bubble',this.renderChatListener);this.renderChatListener=null;if(this.chat)this.chat.destroy();// release all instantiated attribute bars
this.attributes.forEach(a=>{PhaserAttributeBar.release(a);});this.attributes.length=0;this.attributes=null;this.scene.events.off('update',this.update,this);this.label=null;this.sprite=null;this.destroy();return;}this.x=container.x;this.y=container.y;if(this.chat)this.chat.update(this.x,this.y);const sprite=this.sprite;sprite.rotation=texture.rotation;sprite.setScale(texture.scale.x,texture.scale.y);}};class PhaserProjectile extends Phaser.GameObjects.Container{constructor(scene,projectile){super(scene);this.projectile=projectile;const key=`projectile/${projectile._stats.type}`;const sprite=this.sprite=scene.add.sprite(0,0,key);this.add(sprite);scene.add.existing(this);scene.events.on('update',this.update,this);this.playAnimationListener=projectile.on('play-animation',animationId=>{console.log('PhaserProjectile play-animation',`${key}/${animationId}`);// TODO remove
sprite.play(`${key}/${animationId}`);});}update(){const projectile=this.projectile;const container=projectile._pixiContainer;const texture=projectile._pixiTexture;if(projectile._destroyed||container._destroyed){projectile.off('play-animation',this.playAnimationListener);this.playAnimationListener=null;this.destroy();return;}this.x=container.x;this.y=container.y;const sprite=this.sprite;sprite.rotation=texture.rotation;sprite.setScale(texture.scale.x,texture.scale.y);}};class PhaserAttributeBar extends Phaser.GameObjects.Container{constructor(unit){const scene=unit.scene;super(scene);this.unit=unit;const bar=this.bar=scene.add.graphics();this.add(bar);const text=this.text=scene.add.text(0,0,'',{fontFamily:'Arial',color:'#000000',align:'center'});text.setFontStyle('bold');text.setFontSize(14);text.setOrigin(0.5);this.add(text);unit.add(this);}static get(unit){if(!this.pool){this.pool=unit.scene.make.group({});}let bar=this.pool.getFirstDead(false);if(!bar){bar=new PhaserAttributeBar(unit);this.pool.add(bar);}bar.setActive(true);bar.unit=unit;unit.add(bar);bar.setVisible(true);return bar;}static release(bar){bar.resetFadeOut();bar.setVisible(false);bar.unit.remove(bar);bar.unit=null;bar.name=null;bar.setActive(false);}render(data){this.name=data.type||data.key;const bar=this.bar;const text=this.text;const w=94;const h=16;const borderRadius=h/2-1;bar.clear();bar.fillStyle(Phaser.Display.Color.HexStringToColor(data.color).color);bar.fillRoundedRect(-w/2,-h/2,w*data.value/data.max,h,borderRadius);bar.lineStyle(2,0x000000,1);bar.strokeRoundedRect(-w/2,-h/2,w,h,borderRadius);text.setText(data.displayValue?typeof data.value==='number'?data.value.toFixed(0):'0':'');const sprite=this.unit.sprite;this.y=25+Math.max(sprite.displayHeight,sprite.displayWidth)/2+data.index*h*1.1;this.resetFadeOut();if(data.showWhen instanceof Array&&data.showWhen.indexOf('valueChanges')>-1||data.showWhen==='valueChanges'){this.fadeOut();}}fadeOut(){const scene=this.scene;this.fadeTimerEvent=scene.time.delayedCall(1000,()=>{this.fadeTimerEvent=null;this.fadeTween=scene.tweens.add({targets:this,alpha:0,duration:500,onComplete:()=>{this.fadeTween=null;const unit=this.unit;if(unit){const attributes=unit.attributes;const index=attributes.indexOf(this);if(index!==-1){attributes.splice(index,1);PhaserAttributeBar.release(this);}}}});});}resetFadeOut(){// reset fade timer and tween
if(this.fadeTimerEvent){this.scene.time.removeEvent(this.fadeTimerEvent);this.fadeTimerEvent=null;}if(this.fadeTween){this.fadeTween.remove();this.fadeTween=null;}this.alpha=1;}};class PhaserItem extends Phaser.GameObjects.Container{constructor(scene,item){super(scene);this.item=item;const key=`item/${item._stats.itemTypeId}`;const sprite=this.sprite=scene.add.sprite(0,0,key);this.add(sprite);scene.add.existing(this);this.hide=item.on('hide',()=>{this.sprite.setActive(false).setVisible(false);});this.show=item.on('show',()=>{this.sprite.setActive(true).setVisible(true);});this.playAnimationListener=item.on('play-animation',animationId=>{console.log('PhaserItem play-animation',`${key}/${animationId}`);// TODO remove
sprite.play(`${key}/${animationId}`);});scene.events.on('update',this.update,this);}update(){const item=this.item;const container=item._pixiContainer;const texture=item._pixiTexture;if(item._destroyed||container._destroyed){item.off('hide',this.hide);this.hide=null;item.off('show',this.show);this.show=null;item.off('play-animation',this.playAnimationListener);this.playAnimationListener=null;this.scene.events.off('update',this.update,this);this.sprite=null;this.destroy();return;}this.x=container.x;this.y=container.y;const sprite=this.sprite;sprite.rotation=texture.rotation;sprite.setScale(texture.scale.x,texture.scale.y);}};class PhaserChatBubble extends Phaser.GameObjects.Container{constructor(scene,chatText,unit){super(scene);this.unit=unit;this.unit=unit;let words=chatText;if(words.length>40){words=words.substring(0,40);words+='...';}this.offset=120;//draw text
const text=this.text=scene.add.text(0,0,words,{fontFamily:'Arial',color:'#ffffff',align:'center'});text.setFontSize(11);text.setOrigin(0.5);text.depth=1;// draw bubble
const bubble=this.bubble=scene.add.graphics();const width=text.width+10;const height=25;const borderRadius=3;bubble.fillStyle(0x000000,0.5);bubble.fillRoundedRect(-width/2,-height/2,width,height,borderRadius);bubble.lineStyle(2,0x000000,1);//temporary for bubble scaling after changing text width
this.basicWidth=width;// draw triangle
const triangle=this.triangle=scene.add.graphics();const geometry=Phaser.Geom.Triangle.BuildRight(0,0,10,10);const rotatedTriangle=Phaser.Geom.Triangle.Rotate(geometry,-Math.PI/4);triangle.fillStyle(0x000000,0.5);triangle.fillTriangleShape(rotatedTriangle);triangle.lineStyle(2,0x000000,1);triangle.x=-2.5;triangle.y=18.5;this.x=unit.x;this.y=unit.y-this.offset;this.add(triangle);this.add(bubble);this.add(text);scene.add.existing(this);this.fadeOut();}showMessage(chatText){let words=chatText;if(words.length>40){words=words.substring(0,40);words+='...';}//need to change it later - draw new rectangle, instead of resizing, now problem with z-index
this.text.text=words;const width=this.text.width+10;this.bubble.scaleX=width/this.basicWidth;/*this.bubble.clear();
        const bubble = this.bubble = this.scene.add.graphics();
        const width = this.text.width * 2 + 20;
        const height = 25;
        const borderRadius = 5;

        bubble.fillStyle(0x000000, 0.5);
        bubble.fillRoundedRect(
            -width / 2,
            -height / 2,
            width * 10 / 20,
            height,
            borderRadius
        );
        bubble.lineStyle(2, 0x000000, 1);
        bubble.setDepth(0);
        this.bubble.x = this.text.x + width / 4;
        this.add(bubble);*/this.setVisible(true);this.resetFadeOut();this.fadeOut();}fadeOut(){const scene=this.scene;this.fadeTimerEvent=scene.time.delayedCall(3000,()=>{this.fadeTimerEvent=null;this.fadeTween=scene.tweens.add({targets:this,alpha:0,duration:500,onComplete:()=>{this.fadeTween=null;this.setVisible(false);}});});}resetFadeOut(){// reset fade timer and tween
if(this.fadeTimerEvent){this.scene.time.removeEvent(this.fadeTimerEvent);this.fadeTimerEvent=null;}if(this.fadeTween){this.fadeTween.remove();this.fadeTween=null;}this.alpha=1;}//need to add scaling
updateScale(){/*this.scaleTo(
            1 / ige.pixi.viewport.scale.x,
            1 / ige.pixi.viewport.scale.y,
            1 / ige.pixi.viewport.scale.z
        );*/}update(x,y){this.x=x;this.y=y-this.offset;}};class GameScene extends Phaser.Scene{constructor(){super({key:'Game'});}init(){// TODO move to css once pixi is gone
// phaser canvas adjustments
const canvas=this.game.canvas;canvas.style.position='fixed';canvas.style.opacity='0.5';canvas.style.backgroundColor='transparent';//canvas.style.pointerEvents = 'none'; // TODO remove after pixi is gone
const camera=this.cameras.main;this.scale.on(Phaser.Scale.Events.RESIZE,(gameSize,baseSize,displaySize,previousWidth,previousHeight)=>{console.log(Phaser.Scale.Events.RESIZE,// TODO remove
gameSize,baseSize,displaySize,previousWidth,previousHeight);camera.zoom*=gameSize.height/previousHeight;/*camera.centerOn(
                camera.scrollX + (gameSize.width - previousWidth) / 2,
                camera.scrollY + (gameSize.height - previousHeight) / 2
            );*/});ige.client.on('zoom',height=>{console.log('GameScene zoom event',height);// TODO remove
camera.zoomTo(this.scale.height/height,1000,Phaser.Math.Easing.Quadratic.Out);});ige.client.on('fetch-mouse-position',controlComponent=>{const currentMouseTransform=[this.input.activePointer.worldX,this.input.activePointer.worldY];controlComponent.newMousePosition=currentMouseTransform;});ige.client.on('create-unit',unit=>{console.log('create-unit',unit);// TODO remove
new PhaserUnit(this,unit);});ige.client.on('create-item',item=>{console.log('create-item',item);// TODO remove
new PhaserItem(this,item);});ige.client.on('create-projectile',projectile=>{console.log('create-projectile',projectile);// TODO remove
new PhaserProjectile(this,projectile);});}preload(){this.load.crossOrigin='anonymous';const data=ige.game.data;for(let type in data.unitTypes){this.loadEntity(`unit/${type}`,data.unitTypes[type]);}for(let type in data.projectileTypes){this.loadEntity(`projectile/${type}`,data.projectileTypes[type]);}for(let type in data.itemTypes){this.loadEntity(`item/${type}`,data.itemTypes[type]);}data.map.tilesets.forEach(tileset=>{this.load.image(`tiles/${tileset.name}`,tileset.image);});this.load.tilemapTiledJSON('map',data.map);}loadEntity(key,data){const cellSheet=data.cellSheet;if(!cellSheet){// skip if no cell sheet data
return;}this.load.once(`filecomplete-image-${key}`,()=>{// create spritesheet,
// even if it has only one sprite
const texture=this.textures.get(key);const width=texture.source[0].width;const height=texture.source[0].height;Phaser.Textures.Parsers.SpriteSheet(texture,0,0,0,width,height,{frameWidth:width/cellSheet.columnCount,frameHeight:height/cellSheet.rowCount});// add animations
for(let animationsKey in data.animations){const animation=data.animations[animationsKey];const frames=animation.frames;const animationFrames=[];for(let i=0;i<frames.length;i++){// correction for 0-based indexing
animationFrames.push(frames[i]-1);}this.anims.create({key:`${key}/${animation.name}`,frames:this.anims.generateFrameNumbers(key,{frames:animationFrames}),frameRate:animation.framesPerSecond||15,repeat:animation.loopCount-1// correction for loop/repeat values
});}});this.load.image(key,cellSheet.url);}create(){ige.client.phaserLoaded.resolve();const map=this.make.tilemap({key:'map'});const data=ige.game.data;data.map.tilesets.forEach(tileset=>{map.addTilesetImage(tileset.name,`tiles/${tileset.name}`);});data.map.layers.forEach(layer=>{if(layer.type!=='tilelayer'){return;}console.log(layer.name);map.createLayer(layer.name,map.tilesets[0],0,0);});const camera=this.cameras.main;camera.centerOn(map.width*map.tileWidth/2,map.height*map.tileHeight/2);camera.zoom=this.scale.width/800;}};class MobileControlsScene extends Phaser.Scene{constructor(){super({key:'MobileControls'});}create(){/*this.mobileControls.zIndex = 10;

        // make the mobileControls container fit to width and anchored to bottom
        this.mobileControls.y = window.innerHeight - 540;
        const scaleToFit = window.innerWidth / 960;
        this.mobileControls.scale.set(scaleToFit, scaleToFit);*/}};class PhaserRenderer{constructor(){const forceCanvas=JSON.parse(localStorage.getItem('forceCanvas'))||{};this.game=new Phaser.Game({type:forceCanvas[gameId]?Phaser.CANVAS:Phaser.AUTO,scale:{width:ige.pixi.initialWindowWidth,height:ige.pixi.initialWindowHeight,parent:'game-div',mode:Phaser.Scale.ScaleModes.RESIZE},render:{pixelArt:false,transparent:!false,mipmapFilter:'NEAREST'},scene:[GameScene,MobileControlsScene]});}};showMiniMap=false;showAllLayers=false;curLayerPainting='floor';let mouseIsDown=false;// be very careful with arrow functions.
// arrow functions on these callbacks break mouse input
$(document).mousedown(function(){mouseIsDown=true;}).mouseup(function(){mouseIsDown=false;});const statsPanels={};// will we need this?
const Client=$i_3.extend({classId:'Client',init:function(){//
this.data=[];this.previousScore=0;this.host=window.isStandalone?'https://www.modd.io':'';this.loadedTextures={};console.log('window.location.hostname: ',window.location.hostname);// unnecessary
if(window.location.hostname=='localhost')ige.env='local';this.entityUpdateQueue={};this.errorLogs=[];this.tickAndUpdateData={};pathArray=window.location.href.split('/');$('coin-icon').append($('<img/>',{src:`${this.host}/assets/images/coin.png`,width:32,height:32}));this.igeEngineStarted=$.Deferred();this.physicsConfigLoaded=$.Deferred();this.texturesLoaded=$.Deferred();this.mapLoaded=$.Deferred();this.phaserLoaded=$.Deferred();// after rewrite then testing, this obviously stayed 'pending' so lets comment it out for now
// this.miniMapLoaded = $.Deferred(); // well are we using it
this.mapRenderEnabled=true;// check where we use this
this.unitRenderEnabled=true;// check where we use this
this.itemRenderEnabled=true;// check where we use this
this.uiEntityRenderEnabled=true;// check where we use this
this.miniMapEnabled=false;this.clearEveryFrame=true;this.cameraEnabled=true;this.ctxAlphaEnabled=true;this.viewportClippingEnabled=true;this.extrapolation=false;//old comment => 'disabling due to item bug'
this.resolution=0;//old comment => 'autosize'
this.scaleMode=0;//old comment => 'none'
this.isActiveTab=true;this._trackTranslateSmoothing=15;this.inactiveTabEntityStream=[];this.eventLog=[];this.fontTexture=new $i_53('/assets/fonts/verdana_12pt.png');this.servers=[{ip:'127.0.0.1',port:2001,playerCount:0,maxPlayers:32,acceptingPlayers:true,gameId:gameId,url:'ws://localhost:2001'}];this.cellSheets={};this.allowTickAndUpdate=['baseScene','vpMiniMap','minimapScene','objectScene','rootScene','vp1','tilelayer'];this.keysToAddBeforeRender=['abilities','animations','bodies','bonus','cellSheet','sound','states','inventorySize','particles','price','skin','variables','canBuyItem','canBePurchasedBy','inventoryImage','isPurchasable','bulletStartPosition','canBePurchasedBy','carriedBy','damage','description','handle','hits','inventoryImage','isGun','isStackable','deployMethod','maxQuantity','texture','raycastCollidesWith','effects','penetration','bulletDistance','bulletType','ammoSize','ammo','ammoTotal','reloadRate','recoilForce','fireRate','knockbackForce','canBeUsedBy','spawnChance','consumeBonus','isConsumedImmediately','type','lifeSpan','removeWhenEmpty','spawnPosition','baseSpeed','bonusSpeed','controls'];// can we just comment this out
this.tradeOffers=[undefined,undefined,undefined,undefined,undefined];// add utility
this.implement(ClientNetworkEvents);ige.addComponent(IgeInitPixi);$('#dev-error-button').on('click',()=>{$('#error-log-modal').modal('show');});$('#bandwidth-usage').on('click',()=>{// maybe we could rename 'bandwidth-usage'
$('#dev-status-modal').modal('show');});$('#leaderboard-link').on('click',e=>{$('leaderboard-modal').modal('show');});document.addEventListener('visibilitychange',()=>{//this should not be changed to jQ.on()
//old comment => 'apply entities' merged stats saved during inactive tab
if(!document.hidden){this.applyInactiveTabEntityStream();}this.isActiveTab=!document.hidden;});//go fetch
ige.addComponent(GameComponent);// we're going to try and insert the fetch here
let promise=new Promise((resolve,reject)=>{if(gameId){$.ajax({url:`${this.host}/api/game-client/${gameId}`,dataType:'json',type:'GET',success:game=>{//
resolve(game);}});}else{$.ajax({url:'/src/game.json',dataType:'json',type:'GET',success:game=>{//
const data={data:{}};game.defaultData=game;for(let[key,value]of Object.entries(game)){//
data['data'][key]=value;}for(let[key,value]of Object.entries(game.data)){//
data['data'][key]=value;}resolve(data);}});}});promise.then(game=>{ige.game.data=game.data;ige.phaser=new PhaserRenderer();// add components to ige instance
// old comment => 'components required for client-side game logic'
ige.addComponent(Ige$i_28Component);ige.addComponent(SoundComponent);ige.addComponent(MenuUiComponent);ige.addComponent(TradeUiComponent);// could we comment this one out?
ige.addComponent(MobileControlsComponent);}).catch(err=>{console.error(err);}).finally(()=>{this.configureEngine();});// these were under separate conditionals before. idk why.
if(mode=='play'){$('#igeFrontBuffer').click(()=>{$('#more-games').removeClass('slideup-menu-animation').addClass('slidedown-menu-animation');});setTimeout(()=>{// console.log('loading removed'); // not necessary in production
$('#loading-container').addClass('slider-out');},2000);// let's try getting our server here
//
// if our url vars contained a serverId we are adding it to params
// ADDING check for engine start resolved
$.when(this.igeEngineStarted).done(()=>{//
const params=this.getUrlVars();this.serverFound=false;if(!window.isStandalone){//
this.servers=this.getServersArray();}// undefined if our params did not have a serverId
this.preSelectedServerId=params.serverId;if(this.preSelectedServerId){//
for(let serverObj of this.servers){//
// old comment => 'preselected server found! (via direct url)'
if(serverObj.id==this.preSelectedServerId){//
console.log('pre-selected server found. connecting...');// prod console log
this.serverFound=true;this.server=serverObj;break;}}}if(!this.server){//
// if we didn't provide server, we search for the best one
const bestServer=this.getBestServer();if(bestServer){//
this.server=bestServer;this.serverFound=true;}}$('#server-list').val(this.server.id);// console.log(`best server selected: ${this.server, this.server.id}`);
});}},loadPhysics:function(){// this will be empty string in data if no client-side physics
const clientPhysicsEngine=ige.game.data.defaultData.clientPhysicsEngine;const serverPhysicsEngine=ige.game.data.defaultData.physicsEngine;window.igeLoader.loadPhysicsConfig(//
clientPhysicsEngine,serverPhysicsEngine,// this callback fires when we have loaded all of the files
()=>{//
// console.log('Physics engine files loaded');
if(clientPhysicsEngine){//
ige.addComponent(PhysicsComponent).physics.sleep(true);}// we want as little as possible in here so we can start our other loading
this.physicsConfigLoaded.resolve();});},loadMap:function(){//
//we need the contents of physicsConfig to progress
ige.addComponent(MapComponent);ige.addComponent(RegionManager);ige.menuUi.clipImageForShop();ige.scaleMap(ige.game.data.map);// IgePixiMap contains ige.client.mapLoaded.resolve();
ige.map.load(ige.game.data.map);},//
// new language for old 'initEngine' method
//
configureEngine:function(){//
// let's make it easier by assigning the game data to a variable
const gameData=ige.game.data;if(!gameData.isDeveloper){// .isDeveloper property seems to be outdated
//
gameData.isDeveloper=window.isStandalone;}this.loadPhysics();$.when(this.physicsConfigLoaded).done(()=>{//this is a really important async chain
//
// it *was* written as a dependency for $i_102Start,
// but I don't think it was actually waiting until it was finished
// to fire the event
ige.client.loadGameTextures().then(()=>{//
// ige.map.load could not run in tandem with texture loading
// we could potentially speed this up by adding a second instance of pixi loader
// and then delete it when finished.
// this.loadMap(); // this runs fine here instead of in a `finally` block. Not sure it is functionally different.
// eventually added a temporary PIXI.Loader instance to handle map so we can load in tandem.
// as such, moved this.loadMap() outside of this promisified chain.
this.texturesLoaded.resolve();}).catch(err=>{console.error(err);});this.loadMap();// still doing things only after physics load
let engineTickFrameRate=15;if(gameData.defaultData&&!isNaN(gameData.defaultData.frameRate)){//
engineTickFrameRate=Math.max(// old comment => 'keep fps range between 15 and 60'
15,Math.min(//
parseInt(gameData.defaultData.frameRate),60));}ige._physicsTickRate=engineTickFrameRate;if(ige.physics){// old comment => 'always enable CSP'
this.loadCSP();}// added important configuration details for sandbox
if(mode=='sandbox'){$.when(this.mapLoaded,this.phaserLoaded).done(()=>{ige.mapEditor.scanMapLayers();ige.mapEditor.drawTile();ige.mapEditor.addUI();ige.mapEditor.customEditor();if(!gameData.isDeveloper){//
ige.mapEditor.selectEntities=false;}ige.setFps(15);$('#loading-container').addClass('slider-out');}).fail(err=>{$('#loading-container').addClass('slider-out');console.error(err);// for now
});}// don't really know if this needs to be inside this
ige.addComponent(VariableComponent);if(gameData.isDeveloper){//
ige.addComponent(DevConsoleComponent);}// so let's try calling start$i_102 here.
// depends on physics loading
this.start$i_102();});//this doesn't depend on physics config
if(gameData.isDeveloper){//
$('#mod-this-game-menu-item').removeClass('d-none');}//don't think these depend on physcis
ige.menuUi.toggleScoreBoard();ige.menuUi.toggleLeaderBoard();// this is viewport stuff
// doing these with this.igeEngineStarted.done()
// we can move the Deferred for mapLoaded to before engine start
//
$.when(this.igeEngineStarted,this.mapLoaded,this.phaserLoaded).done(()=>{// old comment => 'center camera while loading'
const tileWidth=ige.scaleMapDetails.tileWidth;const tileHeight=ige.scaleMapDetails.tileHeight;ige.client.vp1.camera.translateTo(ige.map.data.width*tileWidth/2,ige.map.data.height*tileHeight/2,0);ige.addComponent(AdComponent);let zoom=1000;if(gameData.settings.camera&&gameData.settings.camera.zoom&&gameData.settings.camera.zoom.default){zoom=gameData.settings.camera.zoom.default;this._trackTranslateSmoothing=gameData.settings.camera.trackingDelay||15;}this.setZoom(zoom);ige.addComponent(TimerComponent).addComponent(ThemeComponent).addComponent(PlayerUiComponent).addComponent(UnitUiComponent).addComponent(ItemUiComponent).addComponent(ScoreboardComponent)// old comment => 'game data is needed to populate shop
.addComponent(ShopComponent);if(gameData.defaultData.enableMiniMap){//
ige.miniMap.createMiniMap();}ige.shop.enableShop();//old comments => 'load sound and music when game starts'
ige.sound.preLoadSound();ige.sound.preLoadMusic();window.activatePlayGame=true;// is there a reason this line was repeated?
$('#play-game-button-wrapper').removeClass('d-none-important');// $('.modal-videochat-backdrop, .modal-videochat').removeClass('d-none'); // hmmm
// $('.modal-videochat').show(); // no
//
$('.modal-step-link[data-step=2]').click();// ok this is going to have to be explained
if(// big if
//
this.preSelectedServerId&&this.serverFound&&params.joinGame=='true'&&userId){//
this.connectToServer();}// const params = ige.client.getUrlVars(); //PUT THIS SOMEWHERE
// unit image loading???
// we're not gonna do minimap for now but I will add it and comment out.
// if (mode == 'play' && gameData.defaultData.enableMiniMap) {
// 	//
// 	$('#leaderboard').css({
// 		//
// 		top: 190
// 	});
// 	this.miniMapEnabled = true;
// 	ige.miniMap.updateMiniMap();
// }
});},//
// Not sure if we should be doing it this way,
// but i'll replicate the old start$i_102 method.
//
// I am changing the 'texturesLoaded emit callback to a $.when()
// with a texturesLoaded Deferred object
//
start$i_102:function(){//
$.when(this.texturesLoaded).done(()=>{//
ige.start(success=>{//
if(success){//
this.rootScene=new $i_69().id('rootScene').drawBounds(false);this.minimapScene=new $i_69().id('minimapScene').drawBounds(false);this.tilesheetScene=new $i_69().id('tilesheetScene').drawBounds(true).drawMouse(true);this.mainScene=new $i_69().id('baseScene')// torturing me with the naming
.mount(this.rootScene).drawMouse(true);this.objectScene=new $i_69().id('objectScene').mount(this.mainScene);// moving this up here so we can give sandbox the map pan component below
this.vp1=new $i_68().id('vp1').autoSize(true).scene(this.rootScene).drawBounds(false).mount(ige);// old comment => 'Create the UI scene'
this.uiScene=new $i_69().id('uiScene').depth(1000).ignoreCamera(true).mount(this.rootScene);ige.mobileControls.attach(this.uiScene);// sandbox check for minimap
if(mode=='sandbox'){//
ige.addComponent(MapEditorComponent).mapEditor.createMiniMap();//
// sandbox also gets a second viewport
// moved the code under a duplicate conditional
this.vp2=new $i_68().id('vp2').layer(100).drawBounds(true).height(0).width(0).borderColor('#0bcc38').borderWidth(20).bottom(0).right(0).scene(this.tilesheetScene).mount(ige);// sandbox also gets map pan components
this.vp1.addComponent(MapPanComponent).mapPan.enabled(true);this.vp2.addComponent(MapPanComponent).mapPan.enabled(true);ige.client.vp1.drawBounds(true);//
}else if(mode=='play'){//
ige.addComponent(MiniMapComponent).addComponent(MiniMapUnit);//
}else{//
console.error('mode was not == to "sandbox" or "play"');}// moved this down here
ige._selectedViewport=this.vp1;this.igeEngineStarted.resolve();}});});},//
getServersArray:function(){const serversList=[];let serverOptions=$('#server-list > option').toArray();// could this be const? idk jQ
serverOptions.forEach(serverOption=>{let server={playerCount:parseInt($(serverOption).attr('player-count')),maxPlayers:parseInt($(serverOption).attr('max-players')),owner:$(serverOption).attr('owner'),url:$(serverOption).attr('data-url'),gameId:gameId,id:$(serverOption).attr('value')};serversList.push(server);});return serversList;},// we never call this inside Client with a parameter. I assume its an array?
//
getBestServer:function(ignoreServerIds){let firstChoice=null;// old comment => 'server which has max players and is under 80% capacity
let secondChoice=null;const validServers=this.servers.filter(server=>{return!ignoreServerIds||ignoreServerIds.indexOf(server.id)==-1;});// old comment => 'max number of players for a server which is under 80% of its capacity
const overloadCriteria=0.8;let maxPlayersInUnderLoadedServer=0;let minPlayerCount=Number.MAX_SAFE_INTEGER;// ok this seems really unnecessary
for(let server of validServers){const capacity=server.playerCount/server.maxPlayers;if(capacity<overloadCriteria&&server.playerCount>maxPlayersInUnderLoadedServer){firstChoice=server;maxPlayersInUnderLoadedServer=server.playerCount;}if(server.playerCount<minPlayerCount){secondChoice=server;minPlayerCount=server.playerCount;}}return firstChoice||secondChoice;},// load game textures with ige.pixi.loader
// this is was previously the only thing required before ige.start() // lets change that
//
loadGameTextures:function(){return new Promise(resolve=>{const version=1;const pixiLoader=ige.pixi.loader;// renamed this from 'resource' to 'pixiLoader'
// old comment => 'used when texture is not loaded in cache'
pixiLoader.add('emptyTexture',`https://cache.modd.io/asset/spriteImage/1560747844626_dot.png?version=${version}`,{crossOrigin:true});const iterateAndAddByEntityType=type=>{//
let entityType=type;for(let key in ige.game.data[`${entityType}Types`]){//
const entity=ige.game.data[`${entityType}Types`][key];const cellSheet=entity.cellSheet;if(cellSheet&&!ige.client.loadedTextures[cellSheet.url]){//
ige.client.loadedTextures[cellSheet.url]=cellSheet;pixiLoader.add(cellSheet.url,`${cellSheet.url}?version=${version}`,{crossOrigin:true});}}};iterateAndAddByEntityType('unit');iterateAndAddByEntityType('projectile');iterateAndAddByEntityType('item');pixiLoader.load(loadedResource=>{//
for(let imageName in loadedResource.resources){//
const resource=loadedResource.resources[imageName];resource.animation=new IgePixiAnimation();if(resource&&resource.url){//
const cellSheet=ige.client.loadedTextures[resource.name];if(cellSheet){//
resource.animation.getAnimationSprites(resource.url,cellSheet.columnCount,cellSheet.rowCount);}}}return resolve();});});},//
setZoom:function(zoom){// old comment => 'on mobile increase default zoom by 25%'
if(ige.mobileControls.isMobile){zoom*=0.75;}ige.pixi.zoom(zoom);// there was a bunch of stuff involving viewports and view areas in the old method,
// it appeared to be out of use.
this.emit('zoom',zoom);},//
connectToServer:function(){// if typeof args[1] == 'function', callback(args[0])
ige.network.start(ige.client.server,clientServer=>{// changed param from 'data' to clientServer
//
for(let serverObj of ige.client.servers){//
if(serverObj.url==clientServer.url){//
ige.client.server=serverObj;break;}}if(ige.client.server){// i feel like this is a goofy conditional
const serverIP=ige.client.server.url.split('://')[1];if(serverIP){//
const serverName=serverIP.split('.')[0];if(serverName){//
$('#server-text').text(`to ${serverName}`);}}}$('#loading-container').addClass('slider-out');console.log('connected to ',ige.client.server.url,'clientId ',ige.network.id());// idk if this needs to be in production
ige.client.defineNetworkEvents();ige.network.send('igeChatJoinRoom','1');ige.addComponent($i_34);ige.addComponent(VideoChatComponent);// shall we talk about the elephant in the room?
ige.chat.on('messageFromServer',msgData=>{ige.chat.postMessage(msgData);});const sendInterval=ige.game.data.settings.latency||ige._fpsRate>0?1000/ige._fpsRate:70;// old comment => 'check for all of the existing entities in the game
ige.network.addComponent($i_24);// old comment => 'render the simulation renderLatency ms in the past'
ige.network.stream.renderLatency(50);ige.network.stream._streamInterval=sendInterval;// old comment => 'create a listener that will fire whenever an entity is created because of the incoming stream data'
ige.network.stream.on('entityCreated',entity=>{//
if(entity._category=='unit'){// old comment => 'unit detected. add it to units array'
const unit=entity;unit.equipSkin();if(unit._stats.ownerId){// this one can probably be refactored, but i'm not sure what it may break
const ownerPlayer=ige.$(unit._stats.ownerId);if(ownerPlayer){//
unit.setOwnerPlayer(unit._stats.ownerId,{dontUpdateName:true});}}unit.renderMobileControl();// old comment => 'avoid race condition for item mounting'
}else if(entity._category=='player'){// old comment => 'apply skin to all units owned by this player'
const player=entity;if(player._stats.controlledBy=='human'){// old comment => 'if the player is me'
if(player._stats.clientId==ige.network.id()){//
ige.client.eventLog.push([ige._currentTime-ige.client.eventLogStartTime,'My player created']);// old comment => 'declare my player'
ige.client.myPlayer=player;if(typeof startVideoChat=='function'){// the elephant is back
startVideoChat(player.id());}player.redrawUnits(['nameLabel']);}// old comment => 'if there are pre-existing units that belong to the newly detected player,
// assign those units' owner as this player
const unitsObject=ige.game.getUnitsByClientId(player._stats.clientId);for(let unitId in unitsObject){//
unitsObject[unitId].setOwnerPlayer(player.id(),{dontUpdateName:true});}if(player._stats&&player._stats.selectedUnitId){//
const unit=ige.$(player._stats.selectedUnitId);if(unit){//
unit.equipSkin();}}if(ige.game.data.isDeveloper||ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod){//
ige.menuUi.kickPlayerFromGame();// we should rename this method
}}}});ige.network.stream.on('entityDestroyed',entityBeingDestroyed=>{// renamed param from 'unitBeingDestroyed' to 'entityBeingDestroyed'
//
if(entityBeingDestroyed._category=='unit'){//
entityBeingDestroyed.remove();//
}else if((ige.game.data.isDeveloper||// yeah idk why i did this
ige.client.myPlayer&&ige.client.myPlayer._stats.isUserMod)&&entityBeingDestroyed._category=='player'){//
ige.menuUi.kickPlayerFromGame(entityBeingDestroyed.id());// this is inside the 'Moderate' menu
}});const params=ige.client.getUrlVars();ige.game.start();ige.menuUi.playGame();if(params.guestmode=='on'){// i removed 'this params.joinGame == 'true' || ' from the condition
// old comment => 'hide menu and skin shop button'
ige.client.guestmode=true;$('.open-menu-button').hide();$('.open-modd-shop-button').hide();}if(window.isStandalone){//
$('#toggle-dev-panels').show();}});},//This method should be looked at...
//
loadCSP:function(){//
ige.game.cspEnabled=!!ige.game.data.defaultData.clientSidePredictionEnabled;const gravity=ige.game.data.settings.gravity;if(gravity){//
console.log('setting gravity: ',gravity);// not in prod please
ige.physics.gravity(gravity.x,gravity.y);}if(ige.physics.engine=='CRASH'){ige.physics.addBorders();}ige.physics.createWorld();ige.physics.start();ige.addComponent(TriggerComponent);// ige.addComponent(VariableComponent); // this appears twice
ige.addComponent(ScriptComponent);ige.addComponent(ConditionComponent);ige.addComponent(ActionComponent);if(typeof mode=='string'&&mode=='sandbox'){//
ige.script.runScript('initialize',{});// why are we doing this?
}},// not much here except definitions
defineNetworkEvents:function(){//
ige.network.define('makePlayerSelectUnit',this._onMakePlayerSelectUnit);ige.network.define('makePlayerCameraTrackUnit',this._onMakePlayerCameraTrackUnit);ige.network.define('changePlayerCameraPanSpeed',this._onChangePlayerCameraPanSpeed);ige.network.define('hideUnitFromPlayer',this._onHideUnitFromPlayer);ige.network.define('showUnitFromPlayer',this._onShowUnitFromPlayer);ige.network.define('hideUnitNameLabelFromPlayer',this._onHideUnitNameLabelFromPlayer);ige.network.define('showUnitNameLabelFromPlayer',this._onShowUnitNameLabelFromPlayer);ige.network.define('updateAllEntities',this._onUpdateAllEntities);ige.network.define('teleport',this._onTeleport);ige.network.define('updateEntityAttribute',this._onUpdateEntityAttribute);ige.network.define('updateUiText',this._onUpdateUiText);ige.network.define('updateUiTextForTime',this._onUpdateUiTextForTime);ige.network.define('alertHighscore',this._onAlertHighscore);ige.network.define('item',this._onItem);ige.network.define('clientDisconnect',this._onClientDisconnect);ige.network.define('ui',this._onUi);ige.network.define('playAd',this._onPlayAd);ige.network.define('buySkin',this._onBuySkin);ige.network.define('videoChat',this._onVideoChat);ige.network.define('devLogs',this._onDevLogs);ige.network.define('errorLogs',this._onErrorLogs);ige.network.define('sound',this._onSound);ige.network.define('particle',this._onParticle);ige.network.define('camera',this._onCamera);ige.network.define('gameSuggestion',this._onGameSuggestion);ige.network.define('minimap',this._onMinimapEvent);ige.network.define('createFloatingText',this._onCreateFloatingText);ige.network.define('openShop',this._onOpenShop);ige.network.define('openDialogue',this._onOpenDialogue);ige.network.define('closeDialogue',this._onCloseDialogue);ige.network.define('setOwner',this._setOwner);ige.network.define('userJoinedGame',this._onUserJoinedGame);ige.network.define('trade',this._onTrade);},//
//i'm not going to change the login.
//
login:function(){//
console.log('attempting to login');// no console logs in production.
$.ajax({url:'/login',data:{username:$('input[name="username"]').val(),password:$('input[name="password"]').val()},dataType:'json',jsonpCallback:'callback',type:'POST',success:data=>{//
if(data.response=='success'){//
this.joinGame();//
}else{//
$('#login-error-message').html(data.message).show().fadeOut(7000);}}});},//
//i'm not going to change the join game function
//
joinGame:function(){//
let isAdBlockEnabled=true;const data={number:Math.floor(Math.random()*999)+100// yeah ok cool, why?
};ige.client.removeOutsideEntities=undefined;window.joinedGame=true;$('#dev-console').hide();if(typeof userId!='undefined'&&typeof sessionId!='undefined'){//
data._id=userId;}if(ige.mobileControls&&!ige.mobileControls.isMobile){//
$('.game-ui').show();}// old comment => 'try loading an ad to find out whether adblocker is active or not
if(window.isStandalone){//
isAdBlockEnabled=false;//
if(typeof adBlockStatus=='function'){//
adBlockStatus(false);}//
}else{//
$.ajax('/showads.js',{async:false,success:()=>{isAdBlockEnabled=false;adBlockStatus(true);},fail:()=>{adBlockStatus(true);}});//notify for ad block
if(window.isAdBlockEnabled){//
notifyAboutAdBlocker();}}// old comment => 'show popover on settings icon for low fram rate'
if(!ige.mobileControls.isMobile){//
setTimeout(()=>{//
this.lowFPSInterval=setInterval(()=>{//
if(this.resolutionQuality!='low'&&ige._renderFPS<40){// do we still use this?
//
$('#setting').popover('show');clearInterval(this.lowFPSInterval);}},60000);},60000);}document.addEventListener('click',()=>{// changed this to addEventListener so we capture the actual event
$('#setting').popover('hide');});data.isAdBlockEnabled=!!isAdBlockEnabled;ige.network.send('joinGame',data);window.joinGameSent.start=Date.now();console.log('joinGame sent');// you already know how I feel about these
// old comment => 'if game was paused'
if(!window.playerJoined){//
ige.client.eventLog.push([0,`joinGame sent. userId: ${userId}`]);ige.client.eventLogStartTime=ige._currentTime;//
}},//
// not going to touch that regex.
//
getUrlVars:function(){// old comment => 'edited for play/:gameId'
const tempGameId=window.location.pathname.split('/')[2];const vars={gameId:tempGameId};// old comment => 'if serverId is present then add it to vars
window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(m,key,value)=>{// not sure about this after looking up .replace()
//
vars[key]=value;});return vars;},//
// again not really touching this one
//
applyInactiveTabEntityStream:function(){//
for(let entityId in this.inactiveTabEntityStream){//
const entityData=_.cloneDeep(this.inactiveTabEntityStream[entityId]);this.inactiveTabEntityStream[entityId]=[];const entity=ige.$(entityId);if(entity&&entityData){//
entity.streamUpdateData(entityData);}}},//
positionCamera:function(x,y){//
if(x!=undefined&&y!=undefined){//
ige.pixi.viewport.removePlugin('follow');//
console.log(ige.pixi.viewport);// ok i understand this one...
ige.pixi.viewport.moveCenter(x,y);}}});if(typeof module!='undefined'&&typeof module.exports!='undefined'){module.exports=Client;};var Game=$i_2.extend({classId:'Game',init(App,options){// Create the engine
ige=new $i_102(options);console.log('ige initialized',ige.isClient,ige.isServer);if(ige.isClient){ige.client=new App();}if(ige.isServer){ige.server=new App(options);}}});if(typeof module!=='undefined'&&typeof module.exports!=='undefined'){module.exports=Game;}else{var game=new Game(Client);};